(function(){var global=this,objectPrototype=Object.prototype,toString=objectPrototype.toString,enumerables=true,enumerablesTest={toString:1},emptyFn=function(){},i;if(typeof Ext==="undefined"){global.Ext={}}Ext.global=global;for(i in enumerablesTest){enumerables=null}if(enumerables){enumerables=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}Ext.enumerables=enumerables;Ext.apply=function(object,config,defaults){if(defaults){Ext.apply(object,defaults)}if(object&&config&&typeof config==="object"){var i,j,k;for(i in config){object[i]=config[i]}if(enumerables){for(j=enumerables.length;j--;){k=enumerables[j];if(config.hasOwnProperty(k)){object[k]=config[k]}}}}return object};Ext.buildSettings=Ext.apply({baseCSSPrefix:"x-",scopeResetCSS:false},Ext.buildSettings||{});Ext.apply(Ext,{emptyFn:emptyFn,baseCSSPrefix:Ext.buildSettings.baseCSSPrefix,applyIf:function(object,config){var property;if(object){for(property in config){if(object[property]===undefined){object[property]=config[property]}}}return object},iterate:function(object,fn,scope){if(Ext.isEmpty(object)){return}if(scope===undefined){scope=object}if(Ext.isIterable(object)){Ext.Array.each.call(Ext.Array,object,fn,scope)}else{Ext.Object.each.call(Ext.Object,object,fn,scope)}}});Ext.apply(Ext,{extend:function(){var objectConstructor=objectPrototype.constructor,inlineOverrides=function(o){for(var m in o){if(!o.hasOwnProperty(m)){continue}this[m]=o[m]}};return function(subclass,superclass,overrides){if(Ext.isObject(superclass)){overrides=superclass;superclass=subclass;subclass=overrides.constructor!==objectConstructor?overrides.constructor:function(){superclass.apply(this,arguments)}}var F=function(){},subclassProto,superclassProto=superclass.prototype;F.prototype=superclassProto;subclassProto=subclass.prototype=new F();subclassProto.constructor=subclass;subclass.superclass=superclassProto;if(superclassProto.constructor===objectConstructor){superclassProto.constructor=superclass}subclass.override=function(overrides){Ext.override(subclass,overrides)};subclassProto.override=inlineOverrides;subclassProto.proto=subclassProto;subclass.override(overrides);subclass.extend=function(o){return Ext.extend(subclass,o)};return subclass}}(),override:function(cls,overrides){if(cls.$isClass){return cls.override(overrides)}else{Ext.apply(cls.prototype,overrides)}}});Ext.apply(Ext,{valueFrom:function(value,defaultValue,allowBlank){return Ext.isEmpty(value,allowBlank)?defaultValue:value},typeOf:function(value){if(value===null){return"null"}var type=typeof value;if(type==="undefined"||type==="string"||type==="number"||type==="boolean"){return type}var typeToString=toString.call(value);switch(typeToString){case"[object Array]":return"array";case"[object Date]":return"date";case"[object Boolean]":return"boolean";case"[object Number]":return"number";case"[object RegExp]":return"regexp"}if(type==="function"){return"function"}if(type==="object"){if(value.nodeType!==undefined){if(value.nodeType===3){return(/\S/).test(value.nodeValue)?"textnode":"whitespace"}else{return"element"}}return"object"}},isEmpty:function(value,allowEmptyString){return(value===null)||(value===undefined)||(!allowEmptyString?value==="":false)||(Ext.isArray(value)&&value.length===0)},isArray:("isArray" in Array)?Array.isArray:function(value){return toString.call(value)==="[object Array]"},isDate:function(value){return toString.call(value)==="[object Date]"},isMSDate:function(value){if(!Ext.isString(value)){return false}else{return value.match("\\\\?/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\\\?/")!==null}},isObject:(toString.call(null)==="[object Object]")?function(value){return value!==null&&value!==undefined&&toString.call(value)==="[object Object]"&&value.ownerDocument===undefined}:function(value){return toString.call(value)==="[object Object]"},isSimpleObject:function(value){return value instanceof Object&&value.constructor===Object},isPrimitive:function(value){var type=typeof value;return type==="string"||type==="number"||type==="boolean"},isFunction:(typeof document!=="undefined"&&typeof document.getElementsByTagName("body")==="function")?function(value){return toString.call(value)==="[object Function]"}:function(value){return typeof value==="function"},isNumber:function(value){return typeof value==="number"&&isFinite(value)},isNumeric:function(value){return !isNaN(parseFloat(value))&&isFinite(value)},isString:function(value){return typeof value==="string"},isBoolean:function(value){return typeof value==="boolean"},isElement:function(value){return value?value.nodeType===1:false},isTextNode:function(value){return value?value.nodeName==="#text":false},isDefined:function(value){return typeof value!=="undefined"},isIterable:function(value){return(value&&typeof value!=="string")?value.length!==undefined:false}});Ext.apply(Ext,{clone:function(item){if(item===null||item===undefined){return item}if(item.nodeType&&item.cloneNode){return item.cloneNode(true)}var type=toString.call(item);if(type==="[object Date]"){return new Date(item.getTime())}var i,j,k,clone,key;if(type==="[object Array]"){i=item.length;clone=[];while(i--){clone[i]=Ext.clone(item[i])}}else{if(type==="[object Object]"&&item.constructor===Object){clone={};for(key in item){clone[key]=Ext.clone(item[key])}if(enumerables){for(j=enumerables.length;j--;){k=enumerables[j];clone[k]=item[k]}}}}return clone||item},getUniqueGlobalNamespace:function(){var uniqueGlobalNamespace=this.uniqueGlobalNamespace;if(uniqueGlobalNamespace===undefined){var i=0;do{uniqueGlobalNamespace="ExtBox"+(++i)}while(Ext.global[uniqueGlobalNamespace]!==undefined);Ext.global[uniqueGlobalNamespace]=Ext;this.uniqueGlobalNamespace=uniqueGlobalNamespace}return uniqueGlobalNamespace},functionFactory:function(){var args=Array.prototype.slice.call(arguments),ln=args.length;if(ln>0){args[ln-1]="var Ext=window."+this.getUniqueGlobalNamespace()+";"+args[ln-1]}return Function.prototype.constructor.apply(Function.prototype,args)},globalEval:("execScript" in global)?function(code){global.execScript(code)}:function(code){(function(){eval(code)})()}});Ext.type=Ext.typeOf})();(function(){var a="2.3.1.410",b;Ext.Version=b=Ext.extend(Object,{constructor:function(e){var d=this.toNumber,g,f;if(e instanceof b){return e}this.version=this.shortVersion=String(e).toLowerCase().replace(/_/g,".").replace(/[\-+]/g,"");f=this.version.search(/([^\d\.])/);if(f!==-1){this.release=this.version.substr(f,e.length);this.shortVersion=this.version.substr(0,f)}this.shortVersion=this.shortVersion.replace(/[^\d]/g,"");g=this.version.split(".");this.major=d(g.shift());this.minor=d(g.shift());this.patch=d(g.shift());this.build=d(g.shift());return this},toNumber:function(d){d=parseInt(d||0,10);if(isNaN(d)){d=0}return d},toString:function(){return this.version},valueOf:function(){return this.version},getMajor:function(){return this.major||0},getMinor:function(){return this.minor||0},getPatch:function(){return this.patch||0},getBuild:function(){return this.build||0},getRelease:function(){return this.release||""},isGreaterThan:function(d){return b.compare(this.version,d)===1},isGreaterThanOrEqual:function(d){return b.compare(this.version,d)>=0},isLessThan:function(d){return b.compare(this.version,d)===-1},isLessThanOrEqual:function(d){return b.compare(this.version,d)<=0},equals:function(d){return b.compare(this.version,d)===0},match:function(d){d=String(d);return this.version.substr(0,d.length)===d},toArray:function(){return[this.getMajor(),this.getMinor(),this.getPatch(),this.getBuild(),this.getRelease()]},getShortVersion:function(){return this.shortVersion},gt:function(){return this.isGreaterThan.apply(this,arguments)},lt:function(){return this.isLessThan.apply(this,arguments)},gtEq:function(){return this.isGreaterThanOrEqual.apply(this,arguments)},ltEq:function(){return this.isLessThanOrEqual.apply(this,arguments)}});Ext.apply(b,{releaseValueMap:{dev:-6,alpha:-5,a:-5,beta:-4,b:-4,rc:-3,"#":-2,p:-1,pl:-1},getComponentValue:function(d){return !d?0:(isNaN(d)?this.releaseValueMap[d]||d:parseInt(d,10))},compare:function(h,g){var e,f,d;h=new b(h).toArray();g=new b(g).toArray();for(d=0;d<Math.max(h.length,g.length);d++){e=this.getComponentValue(h[d]);f=this.getComponentValue(g[d]);if(e<f){return -1}else{if(e>f){return 1}}}return 0}});Ext.apply(Ext,{versions:{},lastRegisteredVersion:null,setVersion:function(e,d){Ext.versions[e]=new b(d);Ext.lastRegisteredVersion=Ext.versions[e];return this},getVersion:function(d){if(d===undefined){return Ext.lastRegisteredVersion}return Ext.versions[d]},deprecate:function(d,f,g,e){if(b.compare(Ext.getVersion(d),f)<1){g.call(e)}}});Ext.setVersion("core",a)})();Ext.String={trimRegex:/^[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+|[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+$/g,escapeRe:/('|\\)/g,formatRe:/\{(\d+)\}/g,escapeRegexRe:/([-.*+?^${}()|[\]\/\\])/g,htmlEncode:(function(){var e={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;"},b=[],d,a;for(d in e){b.push(d)}a=new RegExp("("+b.join("|")+")","g");return function(f){return(!f)?f:String(f).replace(a,function(h,g){return e[g]})}})(),htmlDecode:(function(){var e={"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"'},b=[],d,a;for(d in e){b.push(d)}a=new RegExp("("+b.join("|")+"|&#[0-9]{1,5};)","g");return function(f){return(!f)?f:String(f).replace(a,function(h,g){if(g in e){return e[g]}else{return String.fromCharCode(parseInt(g.substr(2),10))}})}})(),urlAppend:function(b,a){if(!Ext.isEmpty(a)){return b+(b.indexOf("?")===-1?"?":"&")+a}return b},trim:function(a){return a.replace(Ext.String.trimRegex,"")},capitalize:function(a){return a.charAt(0).toUpperCase()+a.substr(1)},ellipsis:function(d,a,e){if(d&&d.length>a){if(e){var f=d.substr(0,a-2),b=Math.max(f.lastIndexOf(" "),f.lastIndexOf("."),f.lastIndexOf("!"),f.lastIndexOf("?"));if(b!==-1&&b>=(a-15)){return f.substr(0,b)+"..."}}return d.substr(0,a-3)+"..."}return d},escapeRegex:function(a){return a.replace(Ext.String.escapeRegexRe,"\\$1")},escape:function(a){return a.replace(Ext.String.escapeRe,"\\$1")},toggle:function(b,d,a){return b===d?a:d},leftPad:function(b,d,e){var a=String(b);e=e||" ";while(a.length<d){a=e+a}return a},format:function(b){var a=Ext.Array.toArray(arguments,1);return b.replace(Ext.String.formatRe,function(d,e){return a[e]})},repeat:function(f,e,b){for(var a=[],d=e;d--;){a.push(f)}return a.join(b||"")}};Ext.htmlEncode=Ext.String.htmlEncode;Ext.htmlDecode=Ext.String.htmlDecode;Ext.urlAppend=Ext.String.urlAppend;(function(){var g=Array.prototype,p=g.slice,r=function(){var C=[],e,B=20;if(!C.splice){return false}while(B--){C.push("A")}C.splice(15,0,"F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F","F");e=C.length;C.splice(13,0,"XXX");if(e+1!=C.length){return false}return true}(),k="forEach" in g,w="map" in g,q="indexOf" in g,A="every" in g,d="some" in g,f="filter" in g,o=function(){var e=[1,2,3,4,5].sort(function(){return 0});return e[0]===1&&e[1]===2&&e[2]===3&&e[3]===4&&e[4]===5}(),l=true,a;try{if(typeof document!=="undefined"){p.call(document.getElementsByTagName("body"))}}catch(u){l=false}function n(B,e){return(e<0)?Math.max(0,B.length+e):Math.min(B.length,e)}function z(I,H,B,L){var M=L?L.length:0,D=I.length,J=n(I,H);if(J===D){if(M){I.push.apply(I,L)}}else{var G=Math.min(B,D-J),K=J+G,C=K+M-G,e=D-K,E=D-G,F;if(C<K){for(F=0;F<e;++F){I[C+F]=I[K+F]}}else{if(C>K){for(F=e;F--;){I[C+F]=I[K+F]}}}if(M&&J===E){I.length=E;I.push.apply(I,L)}else{I.length=E+M;for(F=0;F<M;++F){I[J+F]=L[F]}}}return I}function j(D,e,C,B){if(B&&B.length){if(e<D.length){D.splice.apply(D,[e,C].concat(B))}else{D.push.apply(D,B)}}else{D.splice(e,C)}return D}function b(C,e,B){return z(C,e,B)}function s(C,e,B){C.splice(e,B);return C}function m(E,e,C){var D=n(E,e),B=E.slice(e,n(E,D+C));if(arguments.length<4){z(E,D,C)}else{z(E,D,C,p.call(arguments,3))}return B}function h(e){return e.splice.apply(e,p.call(arguments,1))}var y=r?s:b,v=r?j:z,x=r?h:m;a=Ext.Array={each:function(F,D,C,e){F=a.from(F);var B,E=F.length;if(e!==true){for(B=0;B<E;B++){if(D.call(C||F[B],F[B],B,F)===false){return B}}}else{for(B=E-1;B>-1;B--){if(D.call(C||F[B],F[B],B,F)===false){return B}}}return true},forEach:k?function(C,B,e){return C.forEach(B,e)}:function(E,C,B){var e=0,D=E.length;for(;e<D;e++){C.call(B,E[e],e,E)}},indexOf:(q)?function(C,e,B){return C.indexOf(e,B)}:function(E,C,D){var e,B=E.length;for(e=(D<0)?Math.max(0,B+D):D||0;e<B;e++){if(E[e]===C){return e}}return -1},contains:q?function(B,e){return B.indexOf(e)!==-1}:function(D,C){var e,B;for(e=0,B=D.length;e<B;e++){if(D[e]===C){return true}}return false},toArray:function(C,E,e){if(!C||!C.length){return[]}if(typeof C==="string"){C=C.split("")}if(l){return p.call(C,E||0,e||C.length)}var D=[],B;E=E||0;e=e?((e<0)?C.length+e:e):C.length;for(B=E;B<e;B++){D.push(C[B])}return D},pluck:function(F,e){var B=[],C,E,D;for(C=0,E=F.length;C<E;C++){D=F[C];B.push(D[e])}return B},map:w?function(C,B,e){return C.map(B,e)}:function(F,E,D){var C=[],B=0,e=F.length;for(;B<e;B++){C[B]=E.call(D,F[B],B,F)}return C},every:function(E,C,B){if(A){return E.every(C,B)}var e=0,D=E.length;for(;e<D;++e){if(!C.call(B,E[e],e,E)){return false}}return true},some:function(E,C,B){if(d){return E.some(C,B)}var e=0,D=E.length;for(;e<D;++e){if(C.call(B,E[e],e,E)){return true}}return false},clean:function(E){var B=[],e=0,D=E.length,C;for(;e<D;e++){C=E[e];if(!Ext.isEmpty(C)){B.push(C)}}return B},unique:function(E){var D=[],e=0,C=E.length,B;for(;e<C;e++){B=E[e];if(a.indexOf(D,B)===-1){D.push(B)}}return D},filter:function(F,D,C){if(f){return F.filter(D,C)}var B=[],e=0,E=F.length;for(;e<E;e++){if(D.call(C,F[e],e,F)){B.push(F[e])}}return B},from:function(B,e){if(B===undefined||B===null){return[]}if(Ext.isArray(B)){return(e)?p.call(B):B}if(B&&B.length!==undefined&&typeof B!=="string"){return a.toArray(B)}return[B]},remove:function(C,B){var e=a.indexOf(C,B);if(e!==-1){y(C,e,1)}return C},include:function(B,e){if(!a.contains(B,e)){B.push(e)}},clone:function(e){return p.call(e)},merge:function(){var e=p.call(arguments),D=[],B,C;for(B=0,C=e.length;B<C;B++){D=D.concat(e[B])}return a.unique(D)},intersect:function(){var e=[],E=p.call(arguments),D,F,C,B;if(!E.length){return e}E=E.sort(function(H,G){if(H.length>G.length){return 1}else{if(H.length<G.length){return -1}else{return 0}}});F=a.unique(E[0]);for(C=0;C<F.length;C++){D=F[C];for(B=1;B<E.length;B++){if(E[B].indexOf(D)===-1){break}if(B==(E.length-1)){e.push(D)}}}return e},difference:function(B,e){var G=p.call(B),E=G.length,D,C,F;for(D=0,F=e.length;D<F;D++){for(C=0;C<E;C++){if(G[C]===e[D]){y(G,C,1);C--;E--}}}return G},slice:function(C,B,e){return p.call(C,B,e)},sort:function(H,G){if(o){if(G){return H.sort(G)}else{return H.sort()}}var E=H.length,D=0,F,e,C,B;for(;D<E;D++){C=D;for(e=D+1;e<E;e++){if(G){F=G(H[e],H[C]);if(F<0){C=e}}else{if(H[e]<H[C]){C=e}}}if(C!==D){B=H[D];H[D]=H[C];H[C]=B}}return H},flatten:function(C){var B=[];function e(D){var F,G,E;for(F=0,G=D.length;F<G;F++){E=D[F];if(Ext.isArray(E)){e(E)}else{B.push(E)}}return B}return e(C)},min:function(F,E){var B=F[0],e,D,C;for(e=0,D=F.length;e<D;e++){C=F[e];if(E){if(E(B,C)===1){B=C}}else{if(C<B){B=C}}}return B},max:function(F,E){var e=F[0],B,D,C;for(B=0,D=F.length;B<D;B++){C=F[B];if(E){if(E(e,C)===-1){e=C}}else{if(C>e){e=C}}}return e},mean:function(e){return e.length>0?a.sum(e)/e.length:undefined},sum:function(E){var B=0,e,D,C;for(e=0,D=E.length;e<D;e++){C=E[e];B+=C}return B},erase:y,insert:function(C,B,e){return v(C,B,0,e)},replace:v,splice:x};Ext.each=a.each;a.union=a.merge;Ext.min=a.min;Ext.max=a.max;Ext.sum=a.sum;Ext.mean=a.mean;Ext.flatten=a.flatten;Ext.clean=a.clean;Ext.unique=a.unique;Ext.pluck=a.pluck;Ext.toArray=function(){return a.toArray.apply(a,arguments)}})();(function(){var a=(0.9).toFixed()!=="1";Ext.Number={constrain:function(e,d,b){e=parseFloat(e);if(!isNaN(d)){e=Math.max(e,d)}if(!isNaN(b)){e=Math.min(e,b)}return e},snap:function(f,d,e,h){var g=f,b;if(!(d&&f)){return f}b=f%d;if(b!==0){g-=b;if(b*2>=d){g+=d}else{if(b*2<-d){g-=d}}}return Ext.Number.constrain(g,e,h)},toFixed:function(e,b){if(a){b=b||0;var d=Math.pow(10,b);return(Math.round(e*d)/d).toFixed(b)}return e.toFixed(b)},from:function(d,b){if(isFinite(d)){d=parseFloat(d)}return !isNaN(d)?d:b}}})();Ext.num=function(){return Ext.Number.from.apply(this,arguments)};(function(){var a=function(){};var b=Ext.Object={chain:("create" in Object)?function(d){return Object.create(d)}:function(e){a.prototype=e;var d=new a();a.prototype=null;return d},toQueryObjects:function(f,k,e){var d=b.toQueryObjects,j=[],g,h;if(Ext.isArray(k)){for(g=0,h=k.length;g<h;g++){if(e){j=j.concat(d(f+"["+g+"]",k[g],true))}else{j.push({name:f,value:k[g]})}}}else{if(Ext.isObject(k)){for(g in k){if(k.hasOwnProperty(g)){if(e){j=j.concat(d(f+"["+g+"]",k[g],true))}else{j.push({name:f,value:k[g]})}}}}else{j.push({name:f,value:k})}}return j},toQueryString:function(g,e){var h=[],f=[],l,k,m,d,n;for(l in g){if(g.hasOwnProperty(l)){h=h.concat(b.toQueryObjects(l,g[l],e))}}for(k=0,m=h.length;k<m;k++){d=h[k];n=d.value;if(Ext.isEmpty(n)){n=""}else{if(Ext.isDate(n)){n=Ext.Date.toString(n)}}f.push(encodeURIComponent(d.name)+"="+encodeURIComponent(String(n)))}return f.join("&")},fromQueryString:function(e,r){var m=e.replace(/^\?/,"").split("&"),v={},s,k,x,n,q,g,o,p,d,h,u,l,w,f;for(q=0,g=m.length;q<g;q++){o=m[q];if(o.length>0){k=o.split("=");x=decodeURIComponent(k[0]);n=(k[1]!==undefined)?decodeURIComponent(k[1]):"";if(!r){if(v.hasOwnProperty(x)){if(!Ext.isArray(v[x])){v[x]=[v[x]]}v[x].push(n)}else{v[x]=n}}else{h=x.match(/(\[):?([^\]]*)\]/g);u=x.match(/^([^\[]+)/);x=u[0];l=[];if(h===null){v[x]=n;continue}for(p=0,d=h.length;p<d;p++){w=h[p];w=(w.length===2)?"":w.substring(1,w.length-1);l.push(w)}l.unshift(x);s=v;for(p=0,d=l.length;p<d;p++){w=l[p];if(p===d-1){if(Ext.isArray(s)&&w===""){s.push(n)}else{s[w]=n}}else{if(s[w]===undefined||typeof s[w]==="string"){f=l[p+1];s[w]=(Ext.isNumeric(f)||f==="")?[]:{}}s=s[w]}}}}}return v},each:function(d,f,e){for(var g in d){if(d.hasOwnProperty(g)){if(f.call(e||d,g,d[g],d)===false){return}}}},merge:function(d){var j=1,k=arguments.length,e=b.merge,g=Ext.clone,h,m,l,f;for(;j<k;j++){h=arguments[j];for(m in h){l=h[m];if(l&&l.constructor===Object){f=d[m];if(f&&f.constructor===Object){e(f,l)}else{d[m]=g(l)}}else{d[m]=l}}}return d},mergeIf:function(k){var g=1,h=arguments.length,e=Ext.clone,d,f,j;for(;g<h;g++){d=arguments[g];for(f in d){if(!(f in k)){j=d[f];if(j&&j.constructor===Object){k[f]=e(j)}else{k[f]=j}}}}return k},getKey:function(d,f){for(var e in d){if(d.hasOwnProperty(e)&&d[e]===f){return e}}return null},getValues:function(e){var d=[],f;for(f in e){if(e.hasOwnProperty(f)){d.push(e[f])}}return d},getKeys:("keys" in Object)?Object.keys:function(d){var e=[],f;for(f in d){if(d.hasOwnProperty(f)){e.push(f)}}return e},getSize:function(d){var e=0,f;for(f in d){if(d.hasOwnProperty(f)){e++}}return e},classify:function(g){var k=[],d=[],f={},e=function(){var m=0,n=k.length,o;for(;m<n;m++){o=k[m];this[o]=new f[o]}n=d.length;for(m=0;m<n;m++){o=d[m];this[o]=g[o].slice()}},h,l,j;for(h in g){if(g.hasOwnProperty(h)){l=g[h];if(l){j=l.constructor;if(j===Object){k.push(h);f[h]=b.classify(l)}else{if(j===Array){d.push(h)}}}}}e.prototype=g;return e},equals:function(d,g){var h=typeof d,f=typeof g,e;if(f===f){if(h==="object"){for(e in d){if(!(e in g)){return false}if(!b.equals(d[e],g[e])){return false}}for(e in g){if(!(e in d)){return false}}return true}else{return d===g}}return false},defineProperty:("defineProperty" in Object)?Object.defineProperty:function(e,d,f){if(f.get){e.__defineGetter__(d,f.get)}if(f.set){e.__defineSetter__(d,f.set)}}};Ext.merge=Ext.Object.merge;Ext.mergeIf=Ext.Object.mergeIf;Ext.urlEncode=function(){var d=Ext.Array.from(arguments),e="";if((typeof d[1]==="string")){e=d[1]+"&";d[1]=false}return e+b.toQueryString.apply(b,d)};Ext.urlDecode=function(){return b.fromQueryString.apply(b,arguments)}})();Ext.Function={flexSetter:function(a){return function(e,d){var f,g;if(e===null){return this}if(typeof e!=="string"){for(f in e){if(e.hasOwnProperty(f)){a.call(this,f,e[f])}}if(Ext.enumerables){for(g=Ext.enumerables.length;g--;){f=Ext.enumerables[g];if(e.hasOwnProperty(f)){a.call(this,f,e[f])}}}}else{a.call(this,e,d)}return this}},bind:function(e,d,b,a){if(arguments.length===2){return function(){return e.apply(d,arguments)}}var g=e,f=Array.prototype.slice;return function(){var h=b||arguments;if(a===true){h=f.call(arguments,0);h=h.concat(b)}else{if(typeof a=="number"){h=f.call(arguments,0);Ext.Array.insert(h,a,b)}}return g.apply(d||window,h)}},pass:function(d,a,b){if(!Ext.isArray(a)){a=Ext.Array.clone(a)}return function(){a.push.apply(a,arguments);return d.apply(b||this,a)}},alias:function(b,a){return function(){return b[a].apply(b,arguments)}},clone:function(a){return function(){return a.apply(this,arguments)}},createInterceptor:function(e,d,b,a){var f=e;if(!Ext.isFunction(d)){return e}else{return function(){var h=this,g=arguments;d.target=h;d.method=e;return(d.apply(b||h||window,g)!==false)?e.apply(h||window,g):a||null}}},createDelayed:function(f,d,e,b,a){if(e||b){f=Ext.Function.bind(f,e,b,a)}return function(){var h=this,g=Array.prototype.slice.call(arguments);setTimeout(function(){f.apply(h,g)},d)}},defer:function(f,d,e,b,a){f=Ext.Function.bind(f,e,b,a);if(d>0){return setTimeout(f,d)}f();return 0},createSequence:function(b,d,a){if(!d){return b}else{return function(){var e=b.apply(this,arguments);d.apply(a||this,arguments);return e}}},createBuffered:function(f,b,e,d){var a;return function(){var h=d||Array.prototype.slice.call(arguments,0),g=e||this;if(a){clearTimeout(a)}a=setTimeout(function(){f.apply(g,h)},b)}},createThrottled:function(f,b,e){var g,a,d,j,h=function(){f.apply(e||this,d);g=new Date().getTime()};return function(){a=new Date().getTime()-g;d=arguments;clearTimeout(j);if(!g||(a>=b)){h()}else{j=setTimeout(h,b-a)}}},interceptBefore:function(b,a,e,d){var f=b[a]||Ext.emptyFn;return(b[a]=function(){var g=e.apply(d||this,arguments);f.apply(this,arguments);return g})},interceptAfter:function(b,a,e,d){var f=b[a]||Ext.emptyFn;return(b[a]=function(){f.apply(this,arguments);return e.apply(d||this,arguments)})}};Ext.defer=Ext.Function.alias(Ext.Function,"defer");Ext.pass=Ext.Function.alias(Ext.Function,"pass");Ext.bind=Ext.Function.alias(Ext.Function,"bind");Ext.JSON=new (function(){var useHasOwn=!!{}.hasOwnProperty,isNative=function(){var useNative=null;return function(){if(useNative===null){useNative=Ext.USE_NATIVE_JSON&&window.JSON&&JSON.toString()=="[object JSON]"}return useNative}}(),pad=function(n){return n<10?"0"+n:n},doDecode=function(json){return eval("("+json+")")},doEncode=function(o){if(!Ext.isDefined(o)||o===null){return"null"}else{if(Ext.isArray(o)){return encodeArray(o)}else{if(Ext.isDate(o)){return Ext.JSON.encodeDate(o)}else{if(Ext.isString(o)){if(Ext.isMSDate(o)){return encodeMSDate(o)}else{return encodeString(o)}}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"}else{if(Ext.isBoolean(o)){return String(o)}else{if(Ext.isObject(o)){return encodeObject(o)}else{if(typeof o==="function"){return"null"}}}}}}}}return"undefined"},m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\","\x0b":"\\u000b"},charToReplace=/[\\\"\x00-\x1f\x7f-\uffff]/g,encodeString=function(s){return'"'+s.replace(charToReplace,function(a){var c=m[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"'},encodeArray=function(o){var a=["[",""],len=o.length,i;for(i=0;i<len;i+=1){a.push(doEncode(o[i]),",")}a[a.length-1]="]";return a.join("")},encodeObject=function(o){var a=["{",""],i;for(i in o){if(!useHasOwn||o.hasOwnProperty(i)){a.push(doEncode(i),":",doEncode(o[i]),",")}}a[a.length-1]="}";return a.join("")},encodeMSDate=function(o){return'"'+o+'"'};this.encodeDate=function(o){return'"'+o.getFullYear()+"-"+pad(o.getMonth()+1)+"-"+pad(o.getDate())+"T"+pad(o.getHours())+":"+pad(o.getMinutes())+":"+pad(o.getSeconds())+'"'};this.encode=function(){var ec;return function(o){if(!ec){ec=isNative()?JSON.stringify:doEncode}return ec(o)}}();this.decode=function(){var dc;return function(json,safe){if(!dc){dc=isNative()?JSON.parse:doDecode}try{return dc(json)}catch(e){if(safe===true){return null}Ext.Error.raise({sourceClass:"Ext.JSON",sourceMethod:"decode",msg:"You're trying to decode an invalid JSON String: "+json})}}}()})();Ext.encode=Ext.JSON.encode;Ext.decode=Ext.JSON.decode;Ext.Error={raise:function(a){throw new Error(a.msg)}};Ext.Date={now:Date.now,toString:function(a){if(!a){a=new Date()}var b=Ext.String.leftPad;return a.getFullYear()+"-"+b(a.getMonth()+1,2,"0")+"-"+b(a.getDate(),2,"0")+"T"+b(a.getHours(),2,"0")+":"+b(a.getMinutes(),2,"0")+":"+b(a.getSeconds(),2,"0")}};(function(a){var d=[],b=function(){};Ext.apply(b,{$className:"Ext.Base",$isClass:true,create:function(){return Ext.create.apply(Ext,[this].concat(Array.prototype.slice.call(arguments,0)))},extend:function(j){var e=j.prototype,g,h,k,f,l;g=this.prototype=Ext.Object.chain(e);g.self=this;this.superclass=g.superclass=e;if(!j.$isClass){Ext.apply(g,Ext.Base.prototype);g.constructor=function(){e.constructor.apply(this,arguments)}}l=e.$inheritableStatics;if(l){for(h=0,k=l.length;h<k;h++){f=l[h];if(!this.hasOwnProperty(f)){this[f]=j[f]}}}if(j.$onExtended){this.$onExtended=j.$onExtended.slice()}g.config=g.defaultConfig=new g.configClass;g.initConfigList=g.initConfigList.slice();g.initConfigMap=Ext.Object.chain(g.initConfigMap)},"$onExtended":[],triggerExtended:function(){var g=this.$onExtended,f=g.length,e,h;if(f>0){for(e=0;e<f;e++){h=g[e];h.fn.apply(h.scope||this,arguments)}}},onExtended:function(f,e){this.$onExtended.push({fn:f,scope:e});return this},addConfig:function(g,k){var l=this.prototype,h=l.initConfigList,f=l.initConfigMap,j=l.defaultConfig,n,e,m;k=Boolean(k);for(e in g){if(g.hasOwnProperty(e)&&(k||!(e in j))){m=g[e];n=f[e];if(m!==null){if(!n){f[e]=true;h.push(e)}}else{if(n){f[e]=false;Ext.Array.remove(h,e)}}}}if(k){Ext.merge(j,g)}else{Ext.mergeIf(j,g)}l.configClass=Ext.Object.classify(j)},addStatics:function(e){var g,f;for(f in e){if(e.hasOwnProperty(f)){g=e[f];this[f]=g}}return this},addInheritableStatics:function(f){var j,e,h=this.prototype,g,k;j=h.$inheritableStatics;e=h.$hasInheritableStatics;if(!j){j=h.$inheritableStatics=[];e=h.$hasInheritableStatics={}}for(g in f){if(f.hasOwnProperty(g)){k=f[g];this[g]=k;if(!e[g]){e[g]=true;j.push(g)}}}return this},addMembers:function(e){var g=this.prototype,h=[],f,j;for(f in e){if(e.hasOwnProperty(f)){j=e[f];if(typeof j=="function"&&!j.$isClass&&j!==Ext.emptyFn){j.$owner=this;j.$name=f}g[f]=j}}return this},addMember:function(e,f){if(typeof f=="function"&&!f.$isClass&&f!==Ext.emptyFn){f.$owner=this;f.$name=e}this.prototype[e]=f;return this},implement:function(){this.addMembers.apply(this,arguments)},borrow:function(j,g){var n=this.prototype,m=j.prototype,h,k,f,l,e;g=Ext.Array.from(g);for(h=0,k=g.length;h<k;h++){f=g[h];e=m[f];if(typeof e=="function"){l=function(){return e.apply(this,arguments)};l.$owner=this;l.$name=f;n[f]=l}else{n[f]=e}}return this},override:function(h){var q=this,s=Ext.enumerables,o=q.prototype,k=Ext.Function.clone,m=o.config,f,n,j,r,p,l,g,e;if(arguments.length===2){f=h;h={};h[f]=arguments[1];s=null}do{p=[];r=null;for(f in h){if(f=="statics"){r=h[f]}else{if(f=="config"){g=h[f];q.addConfig(g,true)}else{p.push(f)}}}if(s){p.push.apply(p,s)}for(n=p.length;n--;){f=p[n];if(h.hasOwnProperty(f)){j=h[f];if(typeof j=="function"&&!j.$className&&j!==Ext.emptyFn){if(typeof j.$owner!="undefined"){j=k(j)}j.$owner=q;j.$name=f;l=o[f];if(l){j.$previous=l}}o[f]=j}}o=q;h=r}while(h);return this},callParent:function(e){var f;return(f=this.callParent.caller)&&(f.$previous||((f=f.$owner?f:f.caller)&&f.$owner.superclass.$class[f.$name])).apply(this,e||d)},mixin:function(g,j){var e=j.prototype,f=this.prototype,h;if(typeof e.onClassMixedIn!="undefined"){e.onClassMixedIn.call(j,this)}if(!f.hasOwnProperty("mixins")){if("mixins" in f){f.mixins=Ext.Object.chain(f.mixins)}else{f.mixins={}}}for(h in e){if(h==="mixins"){Ext.merge(f.mixins,e[h])}else{if(typeof f[h]=="undefined"&&h!="mixinId"&&h!="config"){f[h]=e[h]}}}if("config" in e){this.addConfig(e.config,false)}f.mixins[g]=e},getName:function(){return Ext.getClassName(this)},createAlias:a(function(f,e){this.override(f,function(){return this[e].apply(this,arguments)})}),addXtype:function(j){var f=this.prototype,h=f.xtypesMap,g=f.xtypes,e=f.xtypesChain;if(!f.hasOwnProperty("xtypesMap")){h=f.xtypesMap=Ext.merge({},f.xtypesMap||{});g=f.xtypes=f.xtypes?[].concat(f.xtypes):[];e=f.xtypesChain=f.xtypesChain?[].concat(f.xtypesChain):[];f.xtype=j}if(!h[j]){h[j]=true;g.push(j);e.push(j);Ext.ClassManager.setAlias(this,"widget."+j)}return this}});b.implement({isInstance:true,$className:"Ext.Base",configClass:Ext.emptyFn,initConfigList:[],initConfigMap:{},statics:function(){var f=this.statics.caller,e=this.self;if(!f){return e}return f.$owner},callParent:function(f){var g,e=(g=this.callParent.caller)&&(g.$previous||((g=g.$owner?g:g.caller)&&g.$owner.superclass[g.$name]));return e.apply(this,f||d)},callSuper:function(f){var g,e=(g=this.callSuper.caller)&&((g=g.$owner?g:g.caller)&&g.$owner.superclass[g.$name]);return e.apply(this,f||d)},callOverridden:function(e){var f=this.callOverridden.caller;return f&&f.$previous.apply(this,e||d)},self:b,constructor:function(){return this},wasInstantiated:false,initConfig:function(n){var m=Ext.Class.configNameCache,q=this.self.prototype,j=this.initConfigList,g=this.initConfigMap,h=new this.configClass,k=this.defaultConfig,l,p,f,r,o,e;this.initConfig=Ext.emptyFn;this.initialConfig=n||{};if(n){Ext.merge(h,n)}this.config=h;if(!q.hasOwnProperty("wasInstantiated")){q.wasInstantiated=true;for(l=0,p=j.length;l<p;l++){f=j[l];o=m[f];r=k[f];if(!(o.apply in q)&&!(o.update in q)&&q[o.set].$isDefault&&typeof r!="object"){q[o.internal]=k[f];g[f]=false;Ext.Array.remove(j,f);l--;p--}}}if(n){j=j.slice();for(f in n){if(f in k&&!g[f]){j.push(f)}}}for(l=0,p=j.length;l<p;l++){f=j[l];o=m[f];this[o.get]=this[o.initGet]}this.beforeInitConfig(h);for(l=0,p=j.length;l<p;l++){f=j[l];o=m[f];e=o.get;if(this.hasOwnProperty(e)){this[o.set].call(this,h[f]);delete this[e]}}return this},beforeInitConfig:Ext.emptyFn,getCurrentConfig:function(){var e=this.defaultConfig,h=Ext.Class.configNameCache,g={},f,j;for(f in e){j=h[f];g[f]=this[j.get].call(this)}return g},setConfig:function(f,m){if(!f){return this}var j=Ext.Class.configNameCache,k=this.config,g=this.defaultConfig,p=this.initialConfig,l=[],e,h,o,n;m=Boolean(m);for(e in f){if((m&&(e in p))){continue}k[e]=f[e];if(e in g){l.push(e);n=j[e];this[n.get]=this[n.initGet]}}for(h=0,o=l.length;h<o;h++){e=l[h];n=j[e];this[n.set].call(this,f[e]);delete this[n.get]}return this},set:function(e,f){return this[Ext.Class.configNameCache[e].set].call(this,f)},get:function(e){return this[Ext.Class.configNameCache[e].get].call(this)},getConfig:function(e){return this[Ext.Class.configNameCache[e].get].call(this)},hasConfig:function(e){return(e in this.defaultConfig)},getInitialConfig:function(f){var e=this.config;if(!f){return e}else{return e[f]}},onConfigUpdate:function(k,m,n){var o=this.self,g,j,e,h,l,f;k=Ext.Array.from(k);n=n||this;for(g=0,j=k.length;g<j;g++){e=k[g];h="update"+Ext.String.capitalize(e);l=this[h]||Ext.emptyFn;f=function(){l.apply(this,arguments);n[m].apply(n,arguments)};f.$name=h;f.$owner=o;this[h]=f}},link:function(e,f){this.$links={};this.link=this.doLink;return this.link.apply(this,arguments)},doLink:function(e,f){this.$links[e]=true;this[e]=f;return f},unlink:function(){var e,g,f,h;for(e=0,g=arguments.length;e<g;e++){f=arguments[e];if(this.hasOwnProperty(f)){h=this[f];if(h){if(h.isInstance&&!h.isDestroyed){h.destroy()}else{if(h.parentNode&&"nodeType" in h){h.parentNode.removeChild(h)}}}delete this[f]}}return this},destroy:function(){this.destroy=Ext.emptyFn;this.isDestroyed=true;if(this.hasOwnProperty("$links")){this.unlink.apply(this,Ext.Object.getKeys(this.$links));delete this.$links}}});Ext.Base=b})(Ext.Function.flexSetter);(function(){var b,a=Ext.Base,f=[],e,d;for(e in a){if(a.hasOwnProperty(e)){f.push(e)}}d=f.length;Ext.Class=b=function(h,j,g){if(typeof h!="function"){g=j;j=h;h=null}if(!j){j={}}h=b.create(h);b.process(h,j,g);return h};Ext.apply(b,{onBeforeCreated:function(h,j,g){h.addMembers(j);g.onCreated.call(h,h)},create:function(g){var h,j;if(!g){g=function(){return this.constructor.apply(this,arguments)}}for(j=0;j<d;j++){h=f[j];g[h]=a[h]}return g},process:function(h,n,l){var k=n.preprocessors||b.defaultPreprocessors,r=this.preprocessors,v={onBeforeCreated:this.onBeforeCreated,onCreated:l||Ext.emptyFn},o=0,g,w,q,m,p,s,u,j;delete n.preprocessors;j=function(y,z,x){s=null;while(s===null){g=k[o++];if(g){w=r[g];q=w.properties;if(q===true){s=w.fn}else{for(m=0,p=q.length;m<p;m++){u=q[m];if(z.hasOwnProperty(u)){s=w.fn;break}}}}else{x.onBeforeCreated.apply(this,arguments);return}}if(s.call(this,y,z,x,j)!==false){j.apply(this,arguments)}};j.call(this,h,n,v)},preprocessors:{},registerPreprocessor:function(h,l,j,g,k){if(!g){g="last"}if(!j){j=[h]}this.preprocessors[h]={name:h,properties:j||false,fn:l};this.setDefaultPreprocessorPosition(h,g,k);return this},getPreprocessor:function(g){return this.preprocessors[g]},getPreprocessors:function(){return this.preprocessors},defaultPreprocessors:[],getDefaultPreprocessors:function(){return this.defaultPreprocessors},setDefaultPreprocessors:function(g){this.defaultPreprocessors=Ext.Array.from(g);return this},setDefaultPreprocessorPosition:function(j,l,k){var g=this.defaultPreprocessors,h;if(typeof l=="string"){if(l==="first"){g.unshift(j);return this}else{if(l==="last"){g.push(j);return this}}l=(l==="after")?1:-1}h=Ext.Array.indexOf(g,k);if(h!==-1){Ext.Array.splice(g,Math.max(0,h+l),0,j)}return this},configNameCache:{},getConfigNameMap:function(j){var h=this.configNameCache,k=h[j],g;if(!k){g=j.charAt(0).toUpperCase()+j.substr(1);k=h[j]={name:j,internal:"_"+j,initializing:"is"+g+"Initializing",apply:"apply"+g,update:"update"+g,set:"set"+g,get:"get"+g,initGet:"initGet"+g,doSet:"doSet"+g,changeEvent:j.toLowerCase()+"change"}}return k},generateSetter:function(k){var h=k.internal,j=k.get,g=k.apply,m=k.update,l;l=function(p){var o=this[h],n=this[g],q=this[m];delete this[j];if(n){p=n.call(this,p,o);if(typeof p=="undefined"){return this}}this[h]=p;if(q&&p!==o){q.call(this,p,o)}return this};l.$isDefault=true;return l},generateInitGetter:function(l){var g=l.name,k=l.set,h=l.get,j=l.initializing;return function(){this[j]=true;delete this[h];this[k].call(this,this.config[g]);delete this[j];return this[h].apply(this,arguments)}},generateGetter:function(h){var g=h.internal;return function(){return this[g]}}});b.registerPreprocessor("extend",function(g,k){var j=Ext.Base,l=k.extend,h;delete k.extend;if(l&&l!==Object){h=l}else{h=j}g.extend(h);g.triggerExtended.apply(g,arguments);if(k.onClassExtended){g.onExtended(k.onClassExtended,g);delete k.onClassExtended}},true);b.registerPreprocessor("statics",function(g,h){g.addStatics(h.statics);delete h.statics});b.registerPreprocessor("inheritableStatics",function(g,h){g.addInheritableStatics(h.inheritableStatics);delete h.inheritableStatics});b.registerPreprocessor("platformConfig",function(k,r,v){var s=r.platformConfig,n=r.config||{},m,q,h,p,u,o,g,l;delete r.platformConfig;if(!Ext.filterPlatform){Ext.filterPlatform=function(z){var I=false,x=navigator.userAgent,B,F;z=[].concat(z);function E(J){var j=/Mobile(\/|\s)/.test(J);return/(iPhone|iPod)/.test(J)||(!/(Silk)/.test(J)&&(/(Android)/.test(J)&&(/(Android 2)/.test(J)||j)))||(/(BlackBerry|BB)/.test(J)&&j)||/(Windows Phone)/.test(J)}function D(j){return !E(j)&&(/iPad/.test(j)||/Android/.test(j)||/(RIM Tablet OS)/.test(j)||(/MSIE 10/.test(j)&&/; Touch/.test(j)))}var w=window.location.search.substr(1),y=w.split("&"),A={},G,C;for(C=0;C<y.length;C++){var H=y[C].split("=");A[H[0]]=H[1]}G=A.platform;if(G){return z.indexOf(G)!=-1}for(B=0,F=z.length;B<F;B++){switch(z[B]){case"phone":I=E(x);break;case"tablet":I=D(x);break;case"desktop":I=!E(x)&&!D(x);break;case"ios":I=/(iPad|iPhone|iPod)/.test(x);break;case"android":I=/(Android|Silk)/.test(x);break;case"blackberry":I=/(BlackBerry|BB)/.test(x);break;case"safari":I=/Safari/.test(x)&&!(/(BlackBerry|BB)/.test(x));break;case"chrome":I=/Chrome/.test(x);break;case"ie10":I=/MSIE 10/.test(x);break;case"windows":I=/MSIE 10/.test(x)||/Trident/.test(x);break;case"tizen":I=/Tizen/.test(x);break;case"firefox":I=/Firefox/.test(x)}if(I){return true}}return false}}for(p=0,u=s.length;p<u;p++){h=s[p];m=h.platform;l=h.exclude||[];delete h.platform;q=[].concat(h.theme);g=q.length;delete h.theme;if(m&&Ext.filterPlatform(m)&&!Ext.filterPlatform(l)){Ext.merge(n,h)}if(g){for(o=0;o<g;o++){if(Ext.theme.name==q[o]){Ext.merge(n,h)}}}}});b.registerPreprocessor("config",function(j,o){var l=o.config,r=j.prototype,n=r.config,q,h,p,g,k,m,s;delete o.config;for(h in l){if(l.hasOwnProperty(h)&&!(h in n)){s=l[h];q=this.getConfigNameMap(h);p=q.set;g=q.get;k=q.initGet;m=q.internal;o[k]=this.generateInitGetter(q);if(s===null&&!o.hasOwnProperty(m)){o[m]=null}if(!o.hasOwnProperty(g)){o[g]=this.generateGetter(q)}if(!o.hasOwnProperty(p)){o[p]=this.generateSetter(q)}}}j.addConfig(l,true)});b.registerPreprocessor("mixins",function(k,o,g){var h=o.mixins,l,j,m,n;delete o.mixins;Ext.Function.interceptBefore(g,"onCreated",function(){if(h instanceof Array){for(m=0,n=h.length;m<n;m++){j=h[m];l=j.prototype.mixinId||j.$className;k.mixin(l,j)}}else{for(l in h){if(h.hasOwnProperty(l)){k.mixin(l,h[l])}}}})});Ext.extend=function(j,k,h){if(arguments.length===2&&Ext.isObject(k)){h=k;k=j;j=null}var g;if(!k){throw new Error("[Ext.extend] Attempting to extend from a class which has not been loaded on the page.")}h.extend=k;h.preprocessors=["extend","statics","inheritableStatics","mixins","platformConfig","config"];if(j){g=new b(j,h)}else{g=new b(h)}g.prototype.override=function(n){for(var l in n){if(n.hasOwnProperty(l)){this[l]=n[l]}}};return g}})();(function(b,e,g,d,f){var a=Ext.ClassManager={classes:{},existCache:{},namespaceRewrites:[{from:"Ext.",to:Ext}],maps:{alternateToName:{},aliasToName:{},nameToAliases:{},nameToAlternates:{}},enableNamespaceParseCache:true,namespaceParseCache:{},instantiators:[],isCreated:function(m){var l=this.existCache,k,n,j,h,o;if(this.classes[m]||l[m]){return true}h=f;o=this.parseNamespace(m);for(k=0,n=o.length;k<n;k++){j=o[k];if(typeof j!="string"){h=j}else{if(!h||!h[j]){return false}h=h[j]}}l[m]=true;this.triggerCreated(m);return true},createdListeners:[],nameCreatedListeners:{},triggerCreated:function(r){var u=this.createdListeners,l=this.nameCreatedListeners,m=this.maps.nameToAlternates[r],s=[r],o,q,n,p,k,h;for(o=0,q=u.length;o<q;o++){k=u[o];k.fn.call(k.scope,r)}if(m){s.push.apply(s,m)}for(o=0,q=s.length;o<q;o++){h=s[o];u=l[h];if(u){for(n=0,p=u.length;n<p;n++){k=u[n];k.fn.call(k.scope,h)}delete l[h]}}},onCreated:function(m,l,k){var j=this.createdListeners,h=this.nameCreatedListeners,n={fn:m,scope:l};if(k){if(this.isCreated(k)){m.call(l,k);return}if(!h[k]){h[k]=[]}h[k].push(n)}else{j.push(n)}},parseNamespace:function(k){var h=this.namespaceParseCache;if(this.enableNamespaceParseCache){if(h.hasOwnProperty(k)){return h[k]}}var l=[],n=this.namespaceRewrites,p=f,j=k,s,r,q,m,o;for(m=0,o=n.length;m<o;m++){s=n[m];r=s.from;q=s.to;if(j===r||j.substring(0,r.length)===r){j=j.substring(r.length);if(typeof q!="string"){p=q}else{l=l.concat(q.split("."))}break}}l.push(p);l=l.concat(j.split("."));if(this.enableNamespaceParseCache){h[k]=l}return l},setNamespace:function(l,o){var j=f,p=this.parseNamespace(l),n=p.length-1,h=p[n],m,k;for(m=0;m<n;m++){k=p[m];if(typeof k!="string"){j=k}else{if(!j[k]){j[k]={}}j=j[k]}}j[h]=o;return j[h]},createNamespaces:function(){var h=f,o,l,m,k,n,p;for(m=0,n=arguments.length;m<n;m++){o=this.parseNamespace(arguments[m]);for(k=0,p=o.length;k<p;k++){l=o[k];if(typeof l!="string"){h=l}else{if(!h[l]){h[l]={}}h=h[l]}}}return h},set:function(h,m){var l=this,o=l.maps,n=o.nameToAlternates,k=l.getName(m),j;l.classes[h]=l.setNamespace(h,m);if(k&&k!==h){o.alternateToName[h]=k;j=n[k]||(n[k]=[]);j.push(h)}return this},get:function(k){var m=this.classes;if(m[k]){return m[k]}var h=f,o=this.parseNamespace(k),j,l,n;for(l=0,n=o.length;l<n;l++){j=o[l];if(typeof j!="string"){h=j}else{if(!h||!h[j]){return null}h=h[j]}}return h},setAlias:function(h,j){var l=this.maps.aliasToName,m=this.maps.nameToAliases,k;if(typeof h=="string"){k=h}else{k=this.getName(h)}if(j&&l[j]!==k){l[j]=k}if(!m[k]){m[k]=[]}if(j){Ext.Array.include(m[k],j)}return this},addNameAliasMappings:function(h){var n=this.maps.aliasToName,o=this.maps.nameToAliases,l,m,k,j;for(l in h){m=o[l]||(o[l]=[]);for(j=0;j<h[l].length;j++){k=h[l][j];if(!n[k]){n[k]=l;m.push(k)}}}return this},addNameAlternateMappings:function(l){var h=this.maps.alternateToName,o=this.maps.nameToAlternates,k,m,n,j;for(k in l){m=o[k]||(o[k]=[]);for(j=0;j<l[k].length;j++){n=l[k];if(!h[n]){h[n]=k;m.push(n)}}}return this},getByAlias:function(h){return this.get(this.getNameByAlias(h))},getNameByAlias:function(h){return this.maps.aliasToName[h]||""},getNameByAlternate:function(h){return this.maps.alternateToName[h]||""},getAliasesByName:function(h){return this.maps.nameToAliases[h]||[]},getName:function(h){return h&&h.$className||""},getClass:function(h){return h&&h.self||null},create:function(j,k,h){k.$className=j;return new b(k,function(){var n=k.postprocessors||a.defaultPostprocessors,v=a.postprocessors,r=0,w=[],u,l,o,s,m,q,p,x;delete k.postprocessors;for(o=0,s=n.length;o<s;o++){u=n[o];if(typeof u=="string"){u=v[u];p=u.properties;if(p===true){w.push(u.fn)}else{if(p){for(m=0,q=p.length;m<q;m++){x=p[m];if(k.hasOwnProperty(x)){w.push(u.fn);break}}}}}else{w.push(u)}}l=function(z,y,A){u=w[r++];if(!u){a.set(j,y);if(h){h.call(y,y)}a.triggerCreated(j);return}if(u.call(this,z,y,A,l)!==false){l.apply(this,arguments)}};l.call(a,j,this,k)})},createOverride:function(k,m,h){var l=m.override,j=Ext.Array.from(m.requires);delete m.override;delete m.requires;this.existCache[k]=true;Ext.require(j,function(){this.onCreated(function(){var n=this.get(l);if(n.singleton){n.self.override(m)}else{n.override(m)}if(h){h.call(n,n)}this.triggerCreated(k)},this,l)},this);return this},instantiateByAlias:function(){var j=arguments[0],h=g.call(arguments),k=this.getNameByAlias(j);if(!k){k=this.maps.aliasToName[j];Ext.syncRequire(k)}h[0]=k;return this.instantiate.apply(this,h)},instantiate:function(){var k=arguments[0],j=g.call(arguments,1),l=k,m,h;if(typeof k!="function"){h=this.get(k)}else{h=k}if(!h){m=this.getNameByAlias(k);if(m){k=m;h=this.get(k)}}if(!h){m=this.getNameByAlternate(k);if(m){k=m;h=this.get(k)}}if(!h){Ext.syncRequire(k);h=this.get(k)}return this.getInstantiator(j.length)(h,j)},dynInstantiate:function(j,h){h=d(h,true);h.unshift(j);return this.instantiate.apply(this,h)},getInstantiator:function(l){var k=this.instantiators,m;m=k[l];if(!m){var j=l,h=[];for(j=0;j<l;j++){h.push("a["+j+"]")}m=k[l]=new Function("c","a","return new c("+h.join(",")+")")}return m},postprocessors:{},defaultPostprocessors:[],registerPostprocessor:function(j,m,k,h,l){if(!h){h="last"}if(!k){k=[j]}this.postprocessors[j]={name:j,properties:k||false,fn:m};this.setDefaultPostprocessorPosition(j,h,l);return this},setDefaultPostprocessors:function(h){this.defaultPostprocessors=d(h);return this},setDefaultPostprocessorPosition:function(j,m,l){var k=this.defaultPostprocessors,h;if(typeof m=="string"){if(m==="first"){k.unshift(j);return this}else{if(m==="last"){k.push(j);return this}}m=(m==="after")?1:-1}h=Ext.Array.indexOf(k,l);if(h!==-1){Ext.Array.splice(k,Math.max(0,h+m),0,j)}return this},getNamesByExpression:function(p){var n=this.maps.nameToAliases,q=[],h,m,k,j,r,l,o;if(p.indexOf("*")!==-1){p=p.replace(/\*/g,"(.*?)");r=new RegExp("^"+p+"$");for(h in n){if(n.hasOwnProperty(h)){k=n[h];if(h.search(r)!==-1){q.push(h)}else{for(l=0,o=k.length;l<o;l++){m=k[l];if(m.search(r)!==-1){q.push(h);break}}}}}}else{j=this.getNameByAlias(p);if(j){q.push(j)}else{j=this.getNameByAlternate(p);if(j){q.push(j)}else{q.push(p)}}}return q}};a.registerPostprocessor("alias",function(k,j,n){var h=n.alias,l,m;for(l=0,m=h.length;l<m;l++){e=h[l];this.setAlias(j,e)}},["xtype","alias"]);a.registerPostprocessor("singleton",function(j,h,l,k){k.call(this,j,new h(),l);return false});a.registerPostprocessor("alternateClassName",function(j,h,n){var l=n.alternateClassName,k,m,o;if(!(l instanceof Array)){l=[l]}for(k=0,m=l.length;k<m;k++){o=l[k];this.set(o,h)}});Ext.apply(Ext,{create:e(a,"instantiate"),widget:function(j){var h=g.call(arguments);h[0]="widget."+j;return a.instantiateByAlias.apply(a,h)},createByAlias:e(a,"instantiateByAlias"),define:function(j,k,h){if("override" in k){return a.createOverride.apply(a,arguments)}return a.create.apply(a,arguments)},getClassName:e(a,"getName"),getDisplayName:function(h){if(h){if(h.displayName){return h.displayName}if(h.$name&&h.$class){return Ext.getClassName(h.$class)+"#"+h.$name}if(h.$className){return h.$className}}return"Anonymous"},getClass:e(a,"getClass"),namespace:e(a,"createNamespaces")});Ext.createWidget=Ext.widget;Ext.ns=Ext.namespace;b.registerPreprocessor("className",function(h,j){if(j.$className){h.$className=j.$className}},true,"first");b.registerPreprocessor("alias",function(u,n){var r=u.prototype,k=d(n.xtype),h=d(n.alias),v="widget.",s=v.length,o=Array.prototype.slice.call(r.xtypesChain||[]),l=Ext.merge({},r.xtypesMap||{}),m,q,p,j;for(m=0,q=h.length;m<q;m++){p=h[m];if(p.substring(0,s)===v){j=p.substring(s);Ext.Array.include(k,j)}}u.xtype=n.xtype=k[0];n.xtypes=k;for(m=0,q=k.length;m<q;m++){j=k[m];if(!l[j]){l[j]=true;o.push(j)}}n.xtypesChain=o;n.xtypesMap=l;Ext.Function.interceptAfter(n,"onClassCreated",function(){var w=r.mixins,y,x;for(y in w){if(w.hasOwnProperty(y)){x=w[y];k=x.xtypes;if(k){for(m=0,q=k.length;m<q;m++){j=k[m];if(!l[j]){l[j]=true;o.push(j)}}}}}});for(m=0,q=k.length;m<q;m++){j=k[m];Ext.Array.include(h,v+j)}n.alias=h},["xtype","alias"])})(Ext.Class,Ext.Function.alias,Array.prototype.slice,Ext.Array.from,Ext.global);(function(a,d,e,j,l,k,h,m){var f=["extend","mixins","requires"],b,g=0;b=Ext.Loader={isInHistory:{},history:[],config:{enabled:true,disableCaching:true,disableCachingParam:"_dc",paths:{Ext:"."}},setConfig:function(n,o){if(Ext.isObject(n)&&arguments.length===1){Ext.merge(this.config,n)}else{this.config[n]=(Ext.isObject(o))?Ext.merge(this.config[n],o):o}g+=1;return this},getConfig:function(n){if(n){return this.config[n]}return this.config},setPath:e(function(n,o){this.config.paths[n]=o;g+=1;return this}),addClassPathMappings:function(o){var n;if(g==0){b.config.paths=o}else{for(n in o){b.config.paths[n]=o[n]}}g++;return b},getPath:function(n){var p="",q=this.config.paths,o=this.getPrefix(n);if(o.length>0){if(o===n){return q[o]}p=q[o];n=n.substring(o.length+1)}if(p.length>0){p+="/"}return p.replace(/\/\.\//g,"/")+n.replace(/\./g,"/")+".js"},getPrefix:function(o){var q=this.config.paths,p,n="";if(q.hasOwnProperty(o)){return o}for(p in q){if(q.hasOwnProperty(p)&&p+"."===o.substring(0,p.length+1)){if(p.length>n.length){n=p}}}return n},require:function(p,o,n,q){if(o){o.call(n)}},syncRequire:function(){},exclude:function(o){var n=this;return{require:function(r,q,p){return n.require(r,q,p,o)},syncRequire:function(r,q,p){return n.syncRequire(r,q,p,o)}}},onReady:function(q,p,r,n){var o;if(r!==false&&Ext.onDocumentReady){o=q;q=function(){Ext.onDocumentReady(o,p,n)}}q.call(p)}};Ext.apply(b,{documentHead:typeof document!="undefined"&&(document.head||document.getElementsByTagName("head")[0]),isLoading:false,queue:[],isClassFileLoaded:{},isFileLoaded:{},readyListeners:[],optionalRequires:[],requiresMap:{},numPendingFiles:0,numLoadedFiles:0,hasFileLoadError:false,classNameToFilePathMap:{},syncModeEnabled:false,scriptElements:{},refreshQueue:function(){var n=this.queue,u=n.length,q,s,o,r,p;if(u===0){this.triggerReady();return}for(q=0;q<u;q++){s=n[q];if(s){r=s.requires;p=s.references;if(r.length>this.numLoadedFiles){continue}o=0;do{if(a.isCreated(r[o])){h(r,o,1)}else{o++}}while(o<r.length);if(s.requires.length===0){h(n,q,1);s.callback.call(s.scope);this.refreshQueue();break}}}return this},injectScriptElement:function(n,u,q,w,o){var v=document.createElement("script"),s=this,r=function(){s.cleanupScriptElement(v);u.call(w)},p=function(){s.cleanupScriptElement(v);q.call(w)};v.type="text/javascript";v.src=n;v.onload=r;v.onerror=p;v.onreadystatechange=function(){if(this.readyState==="loaded"||this.readyState==="complete"){r()}};if(o){v.charset=o}this.documentHead.appendChild(v);return v},removeScriptElement:function(o){var n=this.scriptElements;if(n[o]){this.cleanupScriptElement(n[o],true);delete n[o]}return this},cleanupScriptElement:function(o,n){o.onload=null;o.onreadystatechange=null;o.onerror=null;if(n){this.documentHead.removeChild(o)}return this},loadScriptFile:function(o,w,r,A,n){var v=this,B=this.isFileLoaded,p=this.scriptElements,z=o+(this.getConfig("disableCaching")?("?"+this.getConfig("disableCachingParam")+"="+Ext.Date.now()):""),y,q,u,x;if(B[o]){return this}A=A||this;this.isLoading=true;if(!n){x=function(){};if(!Ext.isReady&&Ext.onDocumentReady){Ext.onDocumentReady(function(){if(!B[o]){p[o]=v.injectScriptElement(z,w,x,A)}})}else{p[o]=this.injectScriptElement(z,w,x,A)}}else{if(typeof XMLHttpRequest!="undefined"){y=new XMLHttpRequest()}else{y=new ActiveXObject("Microsoft.XMLHTTP")}try{y.open("GET",z,false);y.send(null)}catch(s){}q=(y.status==1223)?204:y.status;u=y.responseText;if((q>=200&&q<300)||q==304||(q==0&&u.length>0)){Ext.globalEval(u+"\n//@ sourceURL="+o);w.call(A)}else{}y=null}},syncRequire:function(){var n=this.syncModeEnabled;if(!n){this.syncModeEnabled=true}this.require.apply(this,arguments);if(!n){this.syncModeEnabled=false}this.refreshQueue()},require:function(J,x,q,u){var z={},p={},C=this.queue,G=this.classNameToFilePathMap,E=this.isClassFileLoaded,w=[],L=[],I=[],o=[],v,K,B,A,n,s,H,F,D,y,r;if(u){u=k(u);for(F=0,y=u.length;F<y;F++){n=u[F];if(typeof n=="string"&&n.length>0){w=a.getNamesByExpression(n);for(D=0,r=w.length;D<r;D++){z[w[D]]=true}}}}J=k(J);if(x){if(x.length>0){v=function(){var O=[],N,P,M;for(N=0,P=o.length;N<P;N++){M=o[N];O.push(a.get(M))}return x.apply(this,O)}}else{v=x}}else{v=Ext.emptyFn}q=q||Ext.global;for(F=0,y=J.length;F<y;F++){A=J[F];if(typeof A=="string"&&A.length>0){L=a.getNamesByExpression(A);r=L.length;for(D=0;D<r;D++){H=L[D];if(z[H]!==true){o.push(H);if(!a.isCreated(H)&&!p[H]){p[H]=true;I.push(H)}}}}}if(I.length>0){if(!this.config.enabled){throw new Error("Ext.Loader is not enabled, so dependencies cannot be resolved dynamically. Missing required class"+((I.length>1)?"es":"")+": "+I.join(", "))}}else{v.call(q);return this}K=this.syncModeEnabled;if(!K){C.push({requires:I.slice(),callback:v,scope:q})}y=I.length;for(F=0;F<y;F++){s=I[F];B=this.getPath(s);if(K&&E.hasOwnProperty(s)){this.numPendingFiles--;this.removeScriptElement(B);delete E[s]}if(!E.hasOwnProperty(s)){E[s]=false;G[s]=B;this.numPendingFiles++;this.loadScriptFile(B,l(this.onFileLoaded,[s,B],this),l(this.onFileLoadError,[s,B]),this,K)}}if(K){v.call(q);if(y===1){return a.get(s)}}return this},onFileLoaded:function(o,n){this.numLoadedFiles++;this.isClassFileLoaded[o]=true;this.isFileLoaded[n]=true;this.numPendingFiles--;if(this.numPendingFiles===0){this.refreshQueue()}},onFileLoadError:function(p,o,n,q){this.numPendingFiles--;this.hasFileLoadError=true},addOptionalRequires:function(p){var r=this.optionalRequires,o,q,n;p=k(p);for(o=0,q=p.length;o<q;o++){n=p[o];m(r,n)}return this},triggerReady:function(o){var q=this.readyListeners,p=this.optionalRequires,n;if(this.isLoading||o){this.isLoading=false;if(p.length!==0){p=p.slice();this.optionalRequires.length=0;this.require(p,l(this.triggerReady,[true],this),this);return this}while(q.length){n=q.shift();n.fn.call(n.scope);if(this.isLoading){return this}}}return this},onReady:function(q,p,r,n){var o;if(r!==false&&Ext.onDocumentReady){o=q;q=function(){Ext.onDocumentReady(o,p,n)}}if(!this.isLoading){q.call(p)}else{this.readyListeners.push({fn:q,scope:p})}},historyPush:function(o){var n=this.isInHistory;if(o&&this.isClassFileLoaded.hasOwnProperty(o)&&!n[o]){n[o]=true;this.history.push(o)}return this}});Ext.require=j(b,"require");Ext.syncRequire=j(b,"syncRequire");Ext.exclude=j(b,"exclude");Ext.onReady=function(p,o,n){b.onReady(p,o,true,n)};d.registerPreprocessor("loader",function(B,p,A,z){var x=this,v=[],w=a.getName(B),q,o,u,s,y,r,n;for(q=0,u=f.length;q<u;q++){r=f[q];if(p.hasOwnProperty(r)){n=p[r];if(typeof n=="string"){v.push(n)}else{if(n instanceof Array){for(o=0,s=n.length;o<s;o++){y=n[o];if(typeof y=="string"){v.push(y)}}}else{if(typeof n!="function"){for(o in n){if(n.hasOwnProperty(o)){y=n[o];if(typeof y=="string"){v.push(y)}}}}}}}}if(v.length===0){return}b.require(v,function(){for(q=0,u=f.length;q<u;q++){r=f[q];if(p.hasOwnProperty(r)){n=p[r];if(typeof n=="string"){p[r]=a.get(n)}else{if(n instanceof Array){for(o=0,s=n.length;o<s;o++){y=n[o];if(typeof y=="string"){p[r][o]=a.get(y)}}}else{if(typeof n!="function"){for(var C in n){if(n.hasOwnProperty(C)){y=n[C];if(typeof y=="string"){p[r][C]=a.get(y)}}}}}}}}z.call(x,B,p,A)});return false},true,"after","className");a.registerPostprocessor("uses",function(q,o,v){var n=k(v.uses),p=[],r,u,s;for(r=0,u=n.length;r<u;r++){s=n[r];if(typeof s=="string"){p.push(s)}}b.addOptionalRequires(p)});a.onCreated(function(n){this.historyPush(n)},b)})(Ext.ClassManager,Ext.Class,Ext.Function.flexSetter,Ext.Function.alias,Ext.Function.pass,Ext.Array.from,Ext.Array.erase,Ext.Array.include);(function(){var a=document.getElementsByTagName("script"),b=a[a.length-1],e=b.src,d=e.substring(0,e.lastIndexOf("/")+1),f=Ext.Loader;f.setConfig({enabled:true,disableCaching:!/[?&](cache|breakpoint)/i.test(location.search),paths:{Ext:d+"src"}})})();Ext.setVersion("touch","2.3.1.410");Ext.apply(Ext,{version:Ext.getVersion("touch"),idSeed:0,repaint:function(){var a=Ext.getBody().createChild({cls:Ext.baseCSSPrefix+"mask "+Ext.baseCSSPrefix+"mask-transparent"});setTimeout(function(){a.destroy()},0)},id:function(a,b){if(a&&a.id){return a.id}a=Ext.getDom(a)||{};if(a===document||a===document.documentElement){a.id="ext-app"}else{if(a===document.body){a.id="ext-body"}else{if(a===window){a.id="ext-window"}}}a.id=a.id||((b||"ext-")+(++Ext.idSeed));return a.id},getBody:function(){if(!Ext.documentBodyElement){if(!document.body){throw new Error("[Ext.getBody] document.body does not exist at this point")}Ext.documentBodyElement=Ext.get(document.body)}return Ext.documentBodyElement},getHead:function(){if(!Ext.documentHeadElement){Ext.documentHeadElement=Ext.get(document.head||document.getElementsByTagName("head")[0])}return Ext.documentHeadElement},getDoc:function(){if(!Ext.documentElement){Ext.documentElement=Ext.get(document)}return Ext.documentElement},getCmp:function(a){return Ext.ComponentMgr.get(a)},copyTo:function(a,b,e,d){if(typeof e=="string"){e=e.split(/[,;\s]/)}Ext.each(e,function(f){if(d||b.hasOwnProperty(f)){a[f]=b[f]}},this);return a},destroy:function(){var a=arguments,e=a.length,b,d;for(b=0;b<e;b++){d=a[b];if(d){if(Ext.isArray(d)){this.destroy.apply(this,d)}else{if(Ext.isFunction(d.destroy)){d.destroy()}}}}},getDom:function(a){if(!a||!document){return null}return a.dom?a.dom:(typeof a=="string"?document.getElementById(a):a)},removeNode:function(a){if(a&&a.parentNode&&a.tagName!="BODY"){Ext.get(a).clearListeners();a.parentNode.removeChild(a);delete Ext.cache[a.id]}},defaultSetupConfig:{eventPublishers:{dom:{xclass:"Ext.event.publisher.Dom"},touchGesture:{xclass:"Ext.event.publisher.TouchGesture",recognizers:{drag:{xclass:"Ext.event.recognizer.Drag"},tap:{xclass:"Ext.event.recognizer.Tap"},doubleTap:{xclass:"Ext.event.recognizer.DoubleTap"},longPress:{xclass:"Ext.event.recognizer.LongPress"},swipe:{xclass:"Ext.event.recognizer.Swipe"},pinch:{xclass:"Ext.event.recognizer.Pinch"},rotate:{xclass:"Ext.event.recognizer.Rotate"},edgeSwipe:{xclass:"Ext.event.recognizer.EdgeSwipe"}}},componentDelegation:{xclass:"Ext.event.publisher.ComponentDelegation"},componentPaint:{xclass:"Ext.event.publisher.ComponentPaint"},elementPaint:{xclass:"Ext.event.publisher.ElementPaint"},elementSize:{xclass:"Ext.event.publisher.ElementSize"},seriesItemEvents:{xclass:"Ext.chart.series.ItemPublisher"}},animator:{xclass:"Ext.fx.Runner"},viewport:{xclass:"Ext.viewport.Viewport"}},isSetup:false,frameStartTime:+new Date(),setupListeners:[],onSetup:function(b,a){if(Ext.isSetup){b.call(a)}else{Ext.setupListeners.push({fn:b,scope:a})}},setup:function(v){var m=Ext.defaultSetupConfig,o=Ext.emptyFn,b=v.onReady||o,g=v.onUpdated||o,a=v.scope,e=Ext.Array.from(v.requires),n=Ext.onReady,j=Ext.getHead(),h,s,k;Ext.setup=function(){throw new Error("Ext.setup has already been called before")};delete v.requires;delete v.onReady;delete v.onUpdated;delete v.scope;Ext.require(["Ext.event.Dispatcher"]);h=function(){var y=Ext.setupListeners,z=y.length,x,A;delete Ext.setupListeners;Ext.isSetup=true;for(x=0;x<z;x++){A=y[x];A.fn.call(A.scope)}Ext.onReady=n;Ext.onReady(b,a)};Ext.onUpdated=g;Ext.onReady=function(z,y){var x=b;b=function(){x();Ext.onReady(z,y)}};v=Ext.merge({},m,v);Ext.onDocumentReady(function(){Ext.factoryConfig(v,function(y){Ext.event.Dispatcher.getInstance().setPublishers(y.eventPublishers);if(y.logger){Ext.Logger=y.logger}if(y.animator){Ext.Animator=y.animator}if(y.viewport){Ext.Viewport=s=y.viewport;if(!a){a=s}Ext.require(e,function(){Ext.Viewport.on("ready",h,null,{single:true})})}else{Ext.require(e,h)}});if(!Ext.microloaded&&navigator.userAgent.match(/IEMobile\/10\.0/)){var x=document.createElement("style");x.appendChild(document.createTextNode("@media screen and (orientation: portrait) {@-ms-viewport {width: 320px !important;}}@media screen and (orientation: landscape) {@-ms-viewport {width: 560px !important;}}"));j.appendChild(x)}});function l(x,y){var z=document.createElement("meta");z.setAttribute("name",x);z.setAttribute("content",y);j.append(z)}function p(x,z,A){var y=document.createElement("link");y.setAttribute("rel","apple-touch-icon"+(A?"-precomposed":""));y.setAttribute("href",x);if(z){y.setAttribute("sizes",z)}j.append(y)}function f(x,z){var y=document.createElement("link");y.setAttribute("rel","apple-touch-startup-image");y.setAttribute("href",x);if(z){y.setAttribute("media",z)}j.append(y)}var r=v.icon,w=Boolean(v.isIconPrecomposed),u=v.startupImage||{},d=v.statusBarStyle||"black",q=window.devicePixelRatio||1;if(navigator.standalone){l("viewport","width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0")}else{l("viewport","initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0")}l("apple-mobile-web-app-capable","yes");l("apple-touch-fullscreen","yes");if(Ext.browser.is.ie){l("msapplication-tap-highlight","no")}if(d){l("apple-mobile-web-app-status-bar-style",d)}if(Ext.isString(r)){r={57:r,72:r,114:r,144:r}}else{if(!r){r={}}}if(Ext.os.is.iPad){if(q>=2){if("1496x2048" in u){f(u["1496x2048"],"(orientation: landscape)")}if("1536x2008" in u){f(u["1536x2008"],"(orientation: portrait)")}if("144" in r){p(r["144"],"144x144",w)}}else{if("748x1024" in u){f(u["748x1024"],"(orientation: landscape)")}if("768x1004" in u){f(u["768x1004"],"(orientation: portrait)")}if("72" in r){p(r["72"],"72x72",w)}}}else{if(q>=2&&Ext.os.version.gtEq("4.3")){if(Ext.os.is.iPhone5){f(u["640x1096"])}else{f(u["640x920"])}if("114" in r){p(r["114"],"114x114",w)}}else{f(u["320x460"]);if("57" in r){p(r["57"],null,w)}}}},application:function(b){var a=b.name,f,e,d;if(!b){b={}}if(!Ext.Loader.config.paths[a]){Ext.Loader.setPath(a,b.appFolder||"app")}d=Ext.Array.from(b.requires);b.requires=["Ext.app.Application"];f=b.onReady;e=b.scope;b.onReady=function(){b.requires=d;new Ext.app.Application(b);if(f){f.call(e)}};Ext.setup(b)},factoryConfig:function(a,m){var h=Ext.isSimpleObject(a);if(h&&a.xclass){var g=a.xclass;delete a.xclass;Ext.require(g,function(){Ext.factoryConfig(a,function(o){m(Ext.create(g,o))})});return}var e=Ext.isArray(a),n=[],l,k,d,f;if(h||e){if(h){for(l in a){if(a.hasOwnProperty(l)){k=a[l];if(Ext.isSimpleObject(k)||Ext.isArray(k)){n.push(l)}}}}else{for(d=0,f=a.length;d<f;d++){k=a[d];if(Ext.isSimpleObject(k)||Ext.isArray(k)){n.push(d)}}}d=0;f=n.length;if(f===0){m(a);return}function j(o){a[l]=o;d++;b()}function b(){if(d>=f){m(a);return}l=n[d];k=a[l];Ext.factoryConfig(k,j)}b();return}m(a)},factory:function(b,f,a,g){var e=Ext.ClassManager,d;if(!b||b.isInstance){if(a&&a!==b){a.destroy()}return b}if(g){if(typeof b=="string"){return e.instantiateByAlias(g+"."+b)}else{if(Ext.isObject(b)&&"type" in b){return e.instantiateByAlias(g+"."+b.type,b)}}}if(b===true){return a||e.instantiate(f)}if("xtype" in b){d=e.instantiateByAlias("widget."+b.xtype,b)}else{if("xclass" in b){d=e.instantiate(b.xclass,b)}}if(d){if(a){a.destroy()}return d}if(a){return a.setConfig(b)}return e.instantiate(f,b)},deprecateClassMember:function(b,d,a,e){return this.deprecateProperty(b.prototype,d,a,e)},deprecateClassMembers:function(b,d){var e=b.prototype,f,a;for(f in d){if(d.hasOwnProperty(f)){a=d[f];this.deprecateProperty(e,f,a)}}},deprecateProperty:function(b,d,a,e){if(!e){e="'"+d+"' is deprecated"}if(a){e+=", please use '"+a+"' instead"}if(a){Ext.Object.defineProperty(b,d,{get:function(){return this[a]},set:function(f){this[a]=f},configurable:true})}},deprecatePropertyValue:function(b,a,e,d){Ext.Object.defineProperty(b,a,{get:function(){return e},configurable:true})},deprecateMethod:function(b,a,e,d){b[a]=function(){if(e){return e.apply(this,arguments)}}},deprecateClassMethod:function(a,b,j,e){if(typeof b!="string"){var h,g;for(h in b){if(b.hasOwnProperty(h)){g=b[h];Ext.deprecateClassMethod(a,h,g)}}return}var d=typeof j=="string",f;if(!e){e="'"+b+"()' is deprecated, please use '"+(d?j:j.name)+"()' instead"}if(d){f=function(){return this[j].apply(this,arguments)}}else{f=function(){return j.apply(this,arguments)}}if(b in a.prototype){Ext.Object.defineProperty(a.prototype,b,{value:null,writable:true,configurable:true})}a.addMember(b,f)},isReady:false,readyListeners:[],triggerReady:function(){var b=Ext.readyListeners,a,d,e;if(!Ext.isReady){Ext.isReady=true;for(a=0,d=b.length;a<d;a++){e=b[a];e.fn.call(e.scope)}delete Ext.readyListeners}},onDocumentReady:function(e,d){if(Ext.isReady){e.call(d)}else{var b=Ext.triggerReady;Ext.readyListeners.push({fn:e,scope:d});if((Ext.browser.is.WebWorks||Ext.browser.is.PhoneGap)&&!Ext.os.is.Desktop){if(!Ext.readyListenerAttached){Ext.readyListenerAttached=true;document.addEventListener(Ext.browser.is.PhoneGap?"deviceready":"webworksready",b,false)}}else{var a=(/MSIE 10/.test(navigator.userAgent))?/complete|loaded/:/interactive|complete|loaded/;if(document.readyState.match(a)!==null){b()}else{if(!Ext.readyListenerAttached){Ext.readyListenerAttached=true;window.addEventListener("DOMContentLoaded",function(){if(navigator.standalone){setTimeout(function(){setTimeout(function(){b()},1)},1)}else{setTimeout(function(){b()},1)}},false)}}}}},callback:function(e,d,b,a){if(Ext.isFunction(e)){b=b||[];d=d||window;if(a){Ext.defer(e,a,d,b)}else{e.apply(d,b)}}}});Ext.define("Ext.env.Browser",{statics:{browserNames:{ie:"IE",firefox:"Firefox",safari:"Safari",chrome:"Chrome",opera:"Opera",dolfin:"Dolfin",webosbrowser:"webOSBrowser",chromeMobile:"ChromeMobile",chromeiOS:"ChromeiOS",silk:"Silk",other:"Other"},engineNames:{webkit:"WebKit",gecko:"Gecko",presto:"Presto",trident:"Trident",other:"Other"},enginePrefixes:{webkit:"AppleWebKit/",gecko:"Gecko/",presto:"Presto/",trident:"Trident/"},browserPrefixes:{ie:"MSIE ",firefox:"Firefox/",chrome:"Chrome/",safari:"Version/",opera:"OPR/",dolfin:"Dolfin/",webosbrowser:"wOSBrowser/",chromeMobile:"CrMo/",chromeiOS:"CriOS/",silk:"Silk/"}},styleDashPrefixes:{WebKit:"-webkit-",Gecko:"-moz-",Trident:"-ms-",Presto:"-o-",Other:""},stylePrefixes:{WebKit:"Webkit",Gecko:"Moz",Trident:"ms",Presto:"O",Other:""},propertyPrefixes:{WebKit:"webkit",Gecko:"moz",Trident:"ms",Presto:"o",Other:""},is:Ext.emptyFn,name:null,version:null,engineName:null,engineVersion:null,setFlag:function(a,b){if(typeof b=="undefined"){b=true}this.is[a]=b;this.is[a.toLowerCase()]=b;return this},constructor:function(q){this.userAgent=q;var m=this.statics(),d=q.match(new RegExp("((?:"+Ext.Object.getValues(m.browserPrefixes).join(")|(?:")+"))([\\w\\._]+)")),b=q.match(new RegExp("((?:"+Ext.Object.getValues(m.enginePrefixes).join(")|(?:")+"))([\\w\\._]+)")),h=m.browserNames,l=h.other,g=m.engineNames,p=g.other,o="",n="",j=false,f,e,a;f=this.is=function(r){return f[r]===true};if(d){l=h[Ext.Object.getKey(m.browserPrefixes,d[1])];o=new Ext.Version(d[2])}if(b){p=g[Ext.Object.getKey(m.enginePrefixes,b[1])];n=new Ext.Version(b[2])}if(p=="Trident"&&l!="IE"){l="IE";var k=q.match(/.*rv:(\d+.\d+)/);if(k&&k.length){k=k[1];o=new Ext.Version(k)}}if(q.match(/FB/)&&l=="Other"){l=h.safari;p=g.webkit}if(q.match(/Android.*Chrome/g)){l="ChromeMobile"}if(q.match(/OPR/)){l="Opera";d=q.match(/OPR\/(\d+.\d+)/);o=new Ext.Version(d[1])}Ext.apply(this,{engineName:p,engineVersion:n,name:l,version:o});this.setFlag(l);if(o){this.setFlag(l+(o.getMajor()||""));this.setFlag(l+o.getShortVersion())}for(e in h){if(h.hasOwnProperty(e)){a=h[e];this.setFlag(a,l===a)}}this.setFlag(a);if(n){this.setFlag(p+(n.getMajor()||""));this.setFlag(p+n.getShortVersion())}for(e in g){if(g.hasOwnProperty(e)){a=g[e];this.setFlag(a,p===a)}}this.setFlag("Standalone",!!navigator.standalone);this.setFlag("Ripple",!!document.getElementById("tinyhippos-injected")&&!Ext.isEmpty(window.top.ripple));this.setFlag("WebWorks",!!window.blackberry);if(typeof window.PhoneGap!="undefined"||typeof window.Cordova!="undefined"||typeof window.cordova!="undefined"){j=true;this.setFlag("PhoneGap");this.setFlag("Cordova")}else{if(!!window.isNK){j=true;this.setFlag("Sencha")}}if(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)(?!.*FBAN)/i.test(q)){j=true}this.setFlag("WebView",j);this.isStrict=document.compatMode=="CSS1Compat";this.isSecure=/^https/i.test(window.location.protocol);return this},getStyleDashPrefix:function(){return this.styleDashPrefixes[this.engineName]},getStylePrefix:function(){return this.stylePrefixes[this.engineName]},getVendorProperyName:function(a){var b=this.propertyPrefixes[this.engineName];if(b.length>0){return b+Ext.String.capitalize(a)}return a},getPreferredTranslationMethod:function(a){if(typeof a=="object"&&"translationMethod" in a&&a.translationMethod!=="auto"){return a.translationMethod}else{if(this.is.AndroidStock2||this.is.IE){return"scrollposition"}else{return"csstransform"}}}},function(){var a=Ext.browser=new this(Ext.global.navigator.userAgent)});Ext.define("Ext.env.OS",{statics:{names:{ios:"iOS",android:"Android",windowsPhone:"WindowsPhone",webos:"webOS",blackberry:"BlackBerry",rimTablet:"RIMTablet",mac:"MacOS",win:"Windows",tizen:"Tizen",linux:"Linux",bada:"Bada",chrome:"ChromeOS",other:"Other"},prefixes:{tizen:"(Tizen )",ios:"i(?:Pad|Phone|Pod)(?:.*)CPU(?: iPhone)? OS ",android:"(Android |HTC_|Silk/)",windowsPhone:"Windows Phone ",blackberry:"(?:BlackBerry|BB)(?:.*)Version/",rimTablet:"RIM Tablet OS ",webos:"(?:webOS|hpwOS)/",bada:"Bada/",chrome:"CrOS "}},is:Ext.emptyFn,name:null,version:null,setFlag:function(a,b){if(typeof b=="undefined"){b=true}this.is[a]=b;this.is[a.toLowerCase()]=b;return this},constructor:function(p,b,l){var m=this.statics(),k=m.names,e=m.prefixes,a,j="",d,h,g,o,f,n;l=l||Ext.browser;f=this.is=function(q){return this.is[q]===true};for(d in e){if(e.hasOwnProperty(d)){h=e[d];g=p.match(new RegExp("(?:"+h+")([^\\s;]+)"));if(g){a=k[d];n=g[1];if(n&&n=="HTC_"){j=new Ext.Version("2.3")}else{if(n&&n=="Silk/"){j=new Ext.Version("2.3")}else{j=new Ext.Version(g[g.length-1])}}break}}}if(!a){a=k[(p.toLowerCase().match(/mac|win|linux/)||["other"])[0]];j=new Ext.Version("")}this.name=a;this.version=j;if(b){this.setFlag(b.replace(/ simulator$/i,""))}this.setFlag(a);if(j){this.setFlag(a+(j.getMajor()||""));this.setFlag(a+j.getShortVersion())}for(d in k){if(k.hasOwnProperty(d)){o=k[d];if(!f.hasOwnProperty(a)){this.setFlag(o,(a===o))}}}if(this.name=="iOS"&&window.screen.height==568){this.setFlag("iPhone5")}if(l.is.Safari||l.is.Silk){if(this.is.Android2||this.is.Android3||l.version.shortVersion==501){l.setFlag("AndroidStock");l.setFlag("AndroidStock2")}if(this.is.Android4){l.setFlag("AndroidStock");l.setFlag("AndroidStock4")}}return this}},function(){var a=Ext.global.navigator,f=a.userAgent,b,h,e;Ext.os=b=new this(f,a.platform);h=b.name;var d=window.location.search.match(/deviceType=(Tablet|Phone)/),g=window.deviceType;if(d&&d[1]){e=d[1]}else{if(g==="iPhone"){e="Phone"}else{if(g==="iPad"){e="Tablet"}else{if(!b.is.Android&&!b.is.iOS&&!b.is.WindowsPhone&&/Windows|Linux|MacOS/.test(h)){e="Desktop";Ext.browser.is.WebView=Ext.browser.is.Ripple?true:false}else{if(b.is.iPad||b.is.RIMTablet||b.is.Android3||Ext.browser.is.Silk||(b.is.Android4&&f.search(/mobile/i)==-1)){e="Tablet"}else{e="Phone"}}}}}b.setFlag(e,true);b.deviceType=e});Ext.define("Ext.env.Feature",{constructor:function(){this.testElements={};this.has=function(a){return !!this.has[a]};if(!Ext.theme){Ext.theme={name:"Default"}}Ext.theme.is={};Ext.theme.is[Ext.theme.name]=true;Ext.onDocumentReady(function(){this.registerTest({ProperHBoxStretching:function(){var b=document.createElement("div"),d=b.appendChild(document.createElement("div")),e=d.appendChild(document.createElement("div")),a;b.setAttribute("style","width: 100px; height: 100px; position: relative;");d.setAttribute("style","position: absolute; display: -ms-flexbox; display: -webkit-flex; display: -moz-flexbox; display: flex; -ms-flex-direction: row; -webkit-flex-direction: row; -moz-flex-direction: row; flex-direction: row; min-width: 100%;");e.setAttribute("style","width: 200px; height: 50px;");document.body.appendChild(b);a=d.offsetWidth;document.body.removeChild(b);return(a>100)}})},this)},getTestElement:function(a,b){if(a===undefined){a="div"}else{if(typeof a!=="string"){return a}}if(b){return document.createElement(a)}if(!this.testElements[a]){this.testElements[a]=document.createElement(a)}return this.testElements[a]},isStyleSupported:function(d,b){var e=this.getTestElement(b).style,a=Ext.String.capitalize(d);if(typeof e[d]!=="undefined"||typeof e[Ext.browser.getStylePrefix(d)+a]!=="undefined"){return true}return false},isStyleSupportedWithoutPrefix:function(b,a){var d=this.getTestElement(a).style;if(typeof d[b]!=="undefined"){return true}return false},isEventSupported:function(d,a){if(a===undefined){a=window}var f=this.getTestElement(a),b="on"+d.toLowerCase(),e=(b in f);if(!e){if(f.setAttribute&&f.removeAttribute){f.setAttribute(b,"");e=typeof f[b]==="function";if(typeof f[b]!=="undefined"){f[b]=undefined}f.removeAttribute(b)}}return e},getSupportedPropertyName:function(b,a){var d=Ext.browser.getVendorProperyName(a);if(d in b){return d}else{if(a in b){return a}}return null},registerTest:Ext.Function.flexSetter(function(a,b){this.has[a]=b.call(this);return this})},function(){Ext.feature=new this;var a=Ext.feature.has;Ext.feature.registerTest({Canvas:function(){var b=this.getTestElement("canvas");return !!(b&&b.getContext&&b.getContext("2d"))},Svg:function(){var b=document;return !!(b.createElementNS&&!!b.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect)},Vml:function(){var d=this.getTestElement(),b=false;d.innerHTML="<!--[if vml]><br><![endif]-->";b=(d.childNodes.length===1);d.innerHTML="";return b},Touch:function(){return Ext.browser.is.Ripple||(this.isEventSupported("touchstart")&&!(Ext.os&&Ext.os.name.match(/Windows|MacOS|Linux/)&&!Ext.os.is.BlackBerry6))},Pointer:function(){return !!window.navigator.msPointerEnabled},Orientation:function(){return("orientation" in window)&&this.isEventSupported("orientationchange")},OrientationChange:function(){return this.isEventSupported("orientationchange")},DeviceMotion:function(){return this.isEventSupported("devicemotion")},Geolocation:function(){return"geolocation" in window.navigator},SqlDatabase:function(){return"openDatabase" in window},WebSockets:function(){return"WebSocket" in window},Range:function(){return !!document.createRange},CreateContextualFragment:function(){var b=!!document.createRange?document.createRange():false;return b&&!!b.createContextualFragment},History:function(){return("history" in window&&"pushState" in window.history)},CssTransforms:function(){return this.isStyleSupported("transform")},CssTransformNoPrefix:function(){return this.isStyleSupportedWithoutPrefix("transform")},Css3dTransforms:function(){return this.has("CssTransforms")&&this.isStyleSupported("perspective")&&!Ext.browser.is.AndroidStock2},CssAnimations:function(){return this.isStyleSupported("animationName")},CssTransitions:function(){return this.isStyleSupported("transitionProperty")},Audio:function(){return !!this.getTestElement("audio").canPlayType},Video:function(){return !!this.getTestElement("video").canPlayType},ClassList:function(){return"classList" in this.getTestElement()},LocalStorage:function(){var b=false;try{if("localStorage" in window&&window.localStorage!==null){localStorage.setItem("sencha-localstorage-test","test success");localStorage.removeItem("sencha-localstorage-test");b=true}}catch(d){}return b},XHR2:function(){return window.ProgressEvent&&window.FormData&&window.XMLHttpRequest&&("withCredentials" in new XMLHttpRequest)},XHRUploadProgress:function(){if(window.XMLHttpRequest&&!Ext.browser.is.AndroidStock){var b=new XMLHttpRequest();return b&&("upload" in b)&&("onprogress" in b.upload)}return false},NumericInputPlaceHolder:function(){return !(Ext.browser.is.AndroidStock4&&Ext.os.version.getMinor()<2)}})});Ext.define("Ext.dom.Query",{select:function(k,b){var h=[],e,g,f,d,a;b=b||document;if(typeof b=="string"){b=document.getElementById(b)}k=k.split(",");for(g=0,d=k.length;g<d;g++){if(typeof k[g]=="string"){if(k[g][0]=="@"){e=b.getAttributeNode(k[g].substring(1));h.push(e)}else{e=b.querySelectorAll(k[g]);for(f=0,a=e.length;f<a;f++){h.push(e[f])}}}}return h},selectNode:function(b,a){return this.select(b,a)[0]},is:function(d,g){var a,f,b,e;if(typeof d=="string"){d=document.getElementById(d)}if(Ext.isArray(d)){f=true;e=d.length;for(b=0;b<e;b++){if(!this.is(d[b],g)){f=false;break}}}else{a=d.parentNode;if(!a){a=document.createDocumentFragment();a.appendChild(d);f=this.select(g,a).indexOf(d)!==-1;a.removeChild(d);a=null}else{f=this.select(g,a).indexOf(d)!==-1}}return f},isXml:function(a){var b=(a?a.ownerDocument||a:0).documentElement;return b?b.nodeName!=="HTML":false}},function(){Ext.ns("Ext.core");Ext.core.DomQuery=Ext.DomQuery=new this();Ext.query=Ext.Function.alias(Ext.DomQuery,"select")});Ext.define("Ext.dom.Helper",{emptyTags:/^(?:br|frame|hr|img|input|link|meta|range|spacer|wbr|area|param|col)$/i,confRe:/tag|children|cn|html|tpl|tplData$/i,endRe:/end/i,attribXlat:{cls:"class",htmlFor:"for"},closeTags:{},decamelizeName:function(){var d=/([a-z])([A-Z])/g,b={};function a(e,g,f){return g+"-"+f.toLowerCase()}return function(e){return b[e]||(b[e]=e.replace(d,a))}}(),generateMarkup:function(e,d){var h=this,b,j,a,f,g;if(typeof e=="string"){d.push(e)}else{if(Ext.isArray(e)){for(f=0;f<e.length;f++){if(e[f]){h.generateMarkup(e[f],d)}}}else{a=e.tag||"div";d.push("<",a);for(b in e){if(e.hasOwnProperty(b)){j=e[b];if(!h.confRe.test(b)){if(typeof j=="object"){d.push(" ",b,'="');h.generateStyles(j,d).push('"')}else{d.push(" ",h.attribXlat[b]||b,'="',j,'"')}}}}if(h.emptyTags.test(a)){d.push("/>")}else{d.push(">");if((j=e.tpl)){j.applyOut(e.tplData,d)}if((j=e.html)){d.push(j)}if((j=e.cn||e.children)){h.generateMarkup(j,d)}g=h.closeTags;d.push(g[a]||(g[a]="</"+a+">"))}}}return d},generateStyles:function(f,d){var b=d||[],e;for(e in f){if(f.hasOwnProperty(e)){b.push(this.decamelizeName(e),":",f[e],";")}}return d||b.join("")},markup:function(a){if(typeof a=="string"){return a}var b=this.generateMarkup(a,[]);return b.join("")},applyStyles:function(a,b){Ext.fly(a).applyStyles(b)},createContextualFragment:function(d){var g=document.createElement("div"),a=document.createDocumentFragment(),b=0,e,f;g.innerHTML=d;f=g.childNodes;e=f.length;for(;b<e;b++){a.appendChild(f[b].cloneNode(true))}return a},insertHtml:function(f,a,g){var l,h,m,d,b,j;f=f.toLowerCase();if(Ext.isTextNode(a)){if(f=="afterbegin"){f="beforebegin"}else{if(f=="beforeend"){f="afterend"}}}b=f=="beforebegin";j=f=="afterbegin";h=Ext.feature.has.CreateContextualFragment?a.ownerDocument.createRange():undefined;l="setStart"+(this.endRe.test(f)?"After":"Before");if(b||f=="afterend"){if(h){h[l](a);m=h.createContextualFragment(g)}else{m=this.createContextualFragment(g)}a.parentNode.insertBefore(m,b?a:a.nextSibling);return a[(b?"previous":"next")+"Sibling"]}else{d=(j?"first":"last")+"Child";if(a.firstChild){if(h){try{h[l](a[d]);m=h.createContextualFragment(g)}catch(k){m=this.createContextualFragment(g)}}else{m=this.createContextualFragment(g)}if(j){a.insertBefore(m,a.firstChild)}else{a.appendChild(m)}}else{a.innerHTML=g}return a[d]}},insertBefore:function(a,d,b){return this.doInsert(a,d,b,"beforebegin")},insertAfter:function(a,d,b){return this.doInsert(a,d,b,"afterend")},insertFirst:function(a,d,b){return this.doInsert(a,d,b,"afterbegin")},append:function(a,d,b){return this.doInsert(a,d,b,"beforeend")},overwrite:function(a,d,b){a=Ext.getDom(a);a.innerHTML=this.markup(d);return b?Ext.get(a.firstChild):a.firstChild},doInsert:function(b,e,d,f){var a=this.insertHtml(f,Ext.getDom(b),this.markup(e));return d?Ext.get(a,true):a},createTemplate:function(b){var a=this.markup(b);return new Ext.Template(a)}},function(){Ext.ns("Ext.core");Ext.core.DomHelper=Ext.DomHelper=new this});Ext.define("Ext.mixin.Identifiable",{statics:{uniqueIds:{}},isIdentifiable:true,mixinId:"identifiable",idCleanRegex:/\.|[^\w\-]/g,defaultIdPrefix:"ext-",defaultIdSeparator:"-",getOptimizedId:function(){return this.id},getUniqueId:function(){var g=this.id,b,e,f,a,d;if(!g){b=this.self.prototype;e=this.defaultIdSeparator;a=Ext.mixin.Identifiable.uniqueIds;if(!b.hasOwnProperty("identifiablePrefix")){f=this.xtype;if(f){d=this.defaultIdPrefix+f+e}else{d=b.$className.replace(this.idCleanRegex,e).toLowerCase()+e}b.identifiablePrefix=d}d=this.identifiablePrefix;if(!a.hasOwnProperty(d)){a[d]=0}g=this.id=d+(++a[d])}this.getUniqueId=this.getOptimizedId;return g},setId:function(a){this.id=a},getId:function(){var a=this.id;if(!a){a=this.getUniqueId()}this.getId=this.getOptimizedId;return a}});Ext.define("Ext.dom.Element",{alternateClassName:"Ext.Element",mixins:[Ext.mixin.Identifiable],observableType:"element",xtype:"element",statics:{CREATE_ATTRIBUTES:{style:"style",className:"className",cls:"cls",classList:"classList",text:"text",hidden:"hidden",html:"html",children:"children"},create:function(d,b){var g=this.CREATE_ATTRIBUTES,f,j,l,k,a,e,h;if(!d){d={}}if(d.isElement){return d.dom}else{if("nodeType" in d){return d}}if(typeof d=="string"){return document.createTextNode(d)}l=d.tag;if(!l){l="div"}if(d.namespace){f=document.createElementNS(d.namespace,l)}else{f=document.createElement(l)}j=f.style;for(a in d){if(a!="tag"){k=d[a];switch(a){case g.style:if(typeof k=="string"){f.setAttribute(a,k)}else{for(e in k){if(k.hasOwnProperty(e)){j[e]=k[e]}}}break;case g.className:case g.cls:f.className=k;break;case g.classList:f.className=k.join(" ");break;case g.text:f.textContent=k;break;case g.hidden:if(k){f.style.display="none"}break;case g.html:f.innerHTML=k;break;case g.children:for(e=0,h=k.length;e<h;e++){f.appendChild(this.create(k[e],true))}break;default:f.setAttribute(a,k)}}}if(b){return f}else{return this.get(f)}},documentElement:null,cache:{},get:function(d){var b=this.cache,a,e,f;if(!d){return null}if(typeof d=="string"){e=document.getElementById(d);if(b.hasOwnProperty(d)){a=b[d]}if(e){if(a){a.dom=e}else{a=b[d]=new this(e)}}else{if(!a){a=null}}return a}if("tagName" in d){f=d.id;if(b.hasOwnProperty(f)){a=b[f];a.dom=d;return a}else{a=new this(d);b[a.getId()]=a}return a}if(d.isElement){return d}if(d.isComposite){return d}if(Ext.isArray(d)){return this.select(d)}if(d===document){if(!this.documentElement){this.documentElement=new this(document.documentElement);this.documentElement.setId("ext-application")}return this.documentElement}return null},data:function(d,b,f){var a=Ext.cache,g,e;d=this.get(d);if(!d){return null}g=d.id;e=a[g].data;if(!e){a[g].data=e={}}if(arguments.length==2){return e[b]}else{return(e[b]=f)}},serializeForm:function(d){var f=d.elements||(document.forms[d]||Ext.getDom(d)).elements,q=false,p=encodeURIComponent,j="",h=f.length,k,a,n,s,r,l,g,m,b;for(l=0;l<h;l++){k=f[l];a=k.name;n=k.type;s=k.options;if(!k.disabled&&a){if(/select-(one|multiple)/i.test(n)){m=s.length;for(g=0;g<m;g++){b=s[g];if(b.selected){r=b.hasAttribute?b.hasAttribute("value"):b.getAttributeNode("value").specified;j+=Ext.String.format("{0}={1}&",p(a),p(r?b.value:b.text))}}}else{if(!(/file|undefined|reset|button/i.test(n))){if(!(/radio|checkbox/i.test(n)&&!k.checked)&&!(n=="submit"&&q)){j+=p(a)+"="+p(k.value)+"&";q=/submit/i.test(n)}}}}}return j.substr(0,j.length-1)},serializeNode:function(e){var b="",d,g,a,f;if(e.nodeType===document.TEXT_NODE){return e.nodeValue}b+="<"+e.nodeName;if(e.attributes.length){for(d=0,g=e.attributes.length;d<g;d++){a=e.attributes[d];b+=" "+a.name+'="'+a.value+'"'}}b+=">";if(e.childNodes&&e.childNodes.length){for(d=0,g=e.childNodes.length;d<g;d++){f=e.childNodes[d];b+=this.serializeNode(f)}}b+="</"+e.nodeName+">";return b}},isElement:true,constructor:function(a){if(typeof a=="string"){a=document.getElementById(a)}if(!a){throw new Error("Invalid domNode reference or an id of an existing domNode: "+a)}this.dom=a;this.getUniqueId()},attach:function(a){this.dom=a;this.id=a.id;return this},getUniqueId:function(){var b=this.id,a;if(!b){a=this.dom;if(a.id.length>0){this.id=b=a.id}else{a.id=b=this.mixins.identifiable.getUniqueId.call(this)}Ext.Element.cache[b]=this}return b},setId:function(d){var a=this.id,b=Ext.Element.cache;if(a){delete b[a]}this.dom.id=d;this.id=d;b[d]=this;return this},setHtml:function(a){this.dom.innerHTML=a},getHtml:function(){return this.dom.innerHTML},setText:function(a){this.dom.textContent=a},redraw:function(){var b=this.dom,a=b.style;a.display="none";b.offsetHeight;a.display=""},isPainted:(function(){return !Ext.browser.is.IE?function(){var a=this.dom;return Boolean(a&&a.offsetParent)}:function(){var a=this.dom;return Boolean(a&&(a.offsetHeight!==0&&a.offsetWidth!==0))}})(),set:function(a,b){var f=this.dom,d,e;for(d in a){if(a.hasOwnProperty(d)){e=a[d];if(d=="style"){this.applyStyles(e)}else{if(d=="cls"){f.className=e}else{if(b!==false){if(e===undefined){f.removeAttribute(d)}else{f.setAttribute(d,e)}}else{f[d]=e}}}}}return this},is:function(a){return Ext.DomQuery.is(this.dom,a)},getValue:function(b){var a=this.dom.value;return b?parseInt(a,10):a},getAttribute:function(a,b){var d=this.dom;return d.getAttributeNS(b,a)||d.getAttribute(b+":"+a)||d.getAttribute(a)||d[a]},setSizeState:function(e){var d=["x-sized","x-unsized","x-stretched"],a=[true,false,null],b=a.indexOf(e),f;if(b!==-1){f=d[b];d.splice(b,1);this.addCls(f)}this.removeCls(d);return this},destroy:function(){this.isDestroyed=true;var a=Ext.Element.cache,b=this.dom;if(b&&b.parentNode&&b.tagName!="BODY"){b.parentNode.removeChild(b)}delete a[this.id];delete this.dom}},function(a){Ext.elements=Ext.cache=a.cache;this.addStatics({Fly:new Ext.Class({extend:a,constructor:function(b){this.dom=b}}),_flyweights:{},fly:function(f,d){var g=null,e=a._flyweights,b;d=d||"_global";f=Ext.getDom(f);if(f){g=e[d]||(e[d]=new a.Fly());g.dom=f;g.isSynchronized=false;b=Ext.cache[f.id];if(b&&b.isElement){b.isSynchronized=false}}return g}});Ext.get=function(b){return a.get(b)};Ext.fly=function(){return a.fly.apply(a,arguments)};Ext.ClassManager.onCreated(function(){a.mixin("observable",Ext.mixin.Observable)},null,"Ext.mixin.Observable")});Ext.dom.Element.addStatics({numberRe:/\d+$/,unitRe:/\d+(px|em|%|en|ex|pt|in|cm|mm|pc)$/i,camelRe:/(-[a-z])/gi,cssRe:/([a-z0-9-]+)\s*:\s*([^;\s]+(?:\s*[^;\s]+)*);?/gi,opacityRe:/alpha\(opacity=(.*)\)/i,propertyCache:{},defaultUnit:"px",borders:{l:"border-left-width",r:"border-right-width",t:"border-top-width",b:"border-bottom-width"},paddings:{l:"padding-left",r:"padding-right",t:"padding-top",b:"padding-bottom"},margins:{l:"margin-left",r:"margin-right",t:"margin-top",b:"margin-bottom"},addUnits:function(b,a){if(b===""||b=="auto"||b===undefined||b===null){return b||""}if(Ext.isNumber(b)||this.numberRe.test(b)){return b+(a||this.defaultUnit||"px")}else{if(!this.unitRe.test(b)){return b||""}}return b},isAncestor:function(b,d){var a=false;b=Ext.getDom(b);d=Ext.getDom(d);if(b&&d){if(b.contains){return b.contains(d)}else{if(b.compareDocumentPosition){return !!(b.compareDocumentPosition(d)&16)}else{while((d=d.parentNode)){a=d==b||a}}}}return a},parseBox:function(b){if(typeof b!="string"){b=b.toString()}var d=b.split(" "),a=d.length;if(a==1){d[1]=d[2]=d[3]=d[0]}else{if(a==2){d[2]=d[0];d[3]=d[1]}else{if(a==3){d[3]=d[1]}}}return{top:d[0]||0,right:d[1]||0,bottom:d[2]||0,left:d[3]||0}},unitizeBox:function(d,a){var b=this;d=b.parseBox(d);return b.addUnits(d.top,a)+" "+b.addUnits(d.right,a)+" "+b.addUnits(d.bottom,a)+" "+b.addUnits(d.left,a)},camelReplaceFn:function(b,d){return d.charAt(1).toUpperCase()},normalize:function(a){return this.propertyCache[a]||(this.propertyCache[a]=a.replace(this.camelRe,this.camelReplaceFn))},fromPoint:function(a,b){return Ext.get(document.elementFromPoint(a,b))},parseStyles:function(d){var a={},b=this.cssRe,e;if(d){b.lastIndex=0;while((e=b.exec(d))){a[e[1]]=e[2]}}return a}});Ext.dom.Element.addMembers({appendChild:function(a){this.dom.appendChild(Ext.getDom(a));return this},removeChild:function(a){this.dom.removeChild(Ext.getDom(a));return this},append:function(){this.appendChild.apply(this,arguments)},appendTo:function(a){Ext.getDom(a).appendChild(this.dom);return this},insertBefore:function(a){a=Ext.getDom(a);a.parentNode.insertBefore(this.dom,a);return this},insertAfter:function(a){a=Ext.getDom(a);a.parentNode.insertBefore(this.dom,a.nextSibling);return this},insertFirst:function(b){var a=Ext.getDom(b),e=this.dom,d=e.firstChild;if(!d){e.appendChild(a)}else{e.insertBefore(a,d)}return this},insertSibling:function(f,d,e){var g=this,b,a=(d||"before").toLowerCase()=="after",h;if(Ext.isArray(f)){h=g;Ext.each(f,function(j){b=Ext.fly(h,"_internal").insertSibling(j,d,e);if(a){h=b}});return b}f=f||{};if(f.nodeType||f.dom){b=g.dom.parentNode.insertBefore(Ext.getDom(f),a?g.dom.nextSibling:g.dom);if(!e){b=Ext.get(b)}}else{if(a&&!g.dom.nextSibling){b=Ext.core.DomHelper.append(g.dom.parentNode,f,!e)}else{b=Ext.core.DomHelper[a?"insertAfter":"insertBefore"](g.dom,f,!e)}}return b},replace:function(a){a=Ext.getDom(a);a.parentNode.replaceChild(this.dom,a);return this},replaceWith:function(a){var b=this;if(a.nodeType||a.dom||typeof a=="string"){a=Ext.get(a);b.dom.parentNode.insertBefore(a.dom,b.dom)}else{a=Ext.core.DomHelper.insertBefore(b.dom,a)}delete Ext.cache[b.id];Ext.removeNode(b.dom);b.id=Ext.id(b.dom=a);return b},doReplaceWith:function(a){var b=this.dom;b.parentNode.replaceChild(Ext.getDom(a),b)},createChild:function(b,a,d){b=b||{tag:"div"};if(a){return Ext.core.DomHelper.insertBefore(a,b,d!==true)}else{return Ext.core.DomHelper[!this.dom.firstChild?"insertFirst":"append"](this.dom,b,d!==true)}},wrap:function(b,d){var f=this.dom,g=this.self.create(b,d),e=(d)?g:g.dom,a=f.parentNode;if(a){a.insertBefore(e,f)}e.appendChild(f);return g},wrapAllChildren:function(a){var e=this.dom,b=e.childNodes,f=this.self.create(a),d=f.dom;while(b.length>0){d.appendChild(e.firstChild)}e.appendChild(d);return f},unwrapAllChildren:function(){var d=this.dom,b=d.childNodes,a=d.parentNode;if(a){while(b.length>0){a.insertBefore(d,d.firstChild)}this.destroy()}},unwrap:function(){var d=this.dom,a=d.parentNode,b;if(a){b=a.parentNode;b.insertBefore(d,a);b.removeChild(a)}else{b=document.createDocumentFragment();b.appendChild(d)}return this},detach:function(){var a=this.dom;if(a&&a.parentNode&&a.tagName!=="BODY"){a.parentNode.removeChild(a)}return this},insertHtml:function(b,d,a){var e=Ext.core.DomHelper.insertHtml(b,this.dom,d);return a?Ext.get(e):e}});Ext.dom.Element.override({getX:function(){return this.getXY()[0]},getY:function(){return this.getXY()[1]},getXY:function(){var b=this.dom.getBoundingClientRect(),a=Math.round;return[a(b.left+window.pageXOffset),a(b.top+window.pageYOffset)]},getOffsetsTo:function(a){var d=this.getXY(),b=Ext.fly(a,"_internal").getXY();return[d[0]-b[0],d[1]-b[1]]},setX:function(a){return this.setXY([a,this.getY()])},setY:function(a){return this.setXY([this.getX(),a])},setXY:function(e){var b=this;if(arguments.length>1){e=[e,arguments[1]]}var d=b.translatePoints(e),a=b.dom.style;for(e in d){if(!d.hasOwnProperty(e)){continue}if(!isNaN(d[e])){a[e]=d[e]+"px"}}return b},getLeft:function(){return parseInt(this.getStyle("left"),10)||0},getRight:function(){return parseInt(this.getStyle("right"),10)||0},getTop:function(){return parseInt(this.getStyle("top"),10)||0},getBottom:function(){return parseInt(this.getStyle("bottom"),10)||0},translatePoints:function(a,h){h=isNaN(a[1])?h:a[1];a=isNaN(a[0])?a:a[0];var e=this,f=e.isStyle("position","relative"),g=e.getXY(),b=parseInt(e.getStyle("left"),10),d=parseInt(e.getStyle("top"),10);b=!isNaN(b)?b:(f?0:e.dom.offsetLeft);d=!isNaN(d)?d:(f?0:e.dom.offsetTop);return{left:(a-g[0]+b),top:(h-g[1]+d)}},setBox:function(e){var d=this,b=e.width,a=e.height,g=e.top,f=e.left;if(f!==undefined){d.setLeft(f)}if(g!==undefined){d.setTop(g)}if(b!==undefined){d.setWidth(b)}if(a!==undefined){d.setHeight(a)}return this},getBox:function(h,m){var j=this,f=j.dom,d=f.offsetWidth,n=f.offsetHeight,p,g,e,a,o,k;if(!m){p=j.getXY()}else{if(h){p=[0,0]}else{p=[parseInt(j.getStyle("left"),10)||0,parseInt(j.getStyle("top"),10)||0]}}if(!h){g={x:p[0],y:p[1],0:p[0],1:p[1],width:d,height:n}}else{e=j.getBorderWidth.call(j,"l")+j.getPadding.call(j,"l");a=j.getBorderWidth.call(j,"r")+j.getPadding.call(j,"r");o=j.getBorderWidth.call(j,"t")+j.getPadding.call(j,"t");k=j.getBorderWidth.call(j,"b")+j.getPadding.call(j,"b");g={x:p[0]+e,y:p[1]+o,0:p[0]+e,1:p[1]+o,width:d-(e+a),height:n-(o+k)}}g.left=g.x;g.top=g.y;g.right=g.x+g.width;g.bottom=g.y+g.height;return g},getPageBox:function(f){var j=this,d=j.dom;if(!d){return new Ext.util.Region()}var m=d.offsetWidth,g=d.offsetHeight,o=j.getXY(),n=o[1],a=o[0]+m,k=o[1]+g,e=o[0];if(f){return new Ext.util.Region(n,a,k,e)}else{return{left:e,top:n,width:m,height:g,right:a,bottom:k}}}});Ext.dom.Element.addMembers({WIDTH:"width",HEIGHT:"height",MIN_WIDTH:"min-width",MIN_HEIGHT:"min-height",MAX_WIDTH:"max-width",MAX_HEIGHT:"max-height",TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",VISIBILITY:1,DISPLAY:2,OFFSETS:3,SEPARATOR:"-",trimRe:/^\s+|\s+$/g,wordsRe:/\w/g,spacesRe:/\s+/,styleSplitRe:/\s*(?::|;)\s*/,transparentRe:/^(?:transparent|(?:rgba[(](?:\s*\d+\s*[,]){3}\s*0\s*[)]))$/i,classNameSplitRegex:/[\s]+/,borders:{t:"border-top-width",r:"border-right-width",b:"border-bottom-width",l:"border-left-width"},paddings:{t:"padding-top",r:"padding-right",b:"padding-bottom",l:"padding-left"},margins:{t:"margin-top",r:"margin-right",b:"margin-bottom",l:"margin-left"},defaultUnit:"px",isSynchronized:false,synchronize:function(){var h=this.dom,a={},e=h.className,g,d,f,b;if(e.length>0){g=h.className.split(this.classNameSplitRegex);for(d=0,f=g.length;d<f;d++){b=g[d];a[b]=true}}else{g=[]}this.classList=g;this.hasClassMap=a;this.isSynchronized=true;return this},addCls:function(k,h,l){if(!k){return this}if(!this.isSynchronized){this.synchronize()}var f=this.dom,d=this.hasClassMap,e=this.classList,a=this.SEPARATOR,g,j,b;h=h?h+a:"";l=l?a+l:"";if(typeof k=="string"){k=k.split(this.spacesRe)}for(g=0,j=k.length;g<j;g++){b=h+k[g]+l;if(!d[b]){d[b]=true;e.push(b)}}f.className=e.join(" ");return this},removeCls:function(k,h,l){if(!k){return this}if(!this.isSynchronized){this.synchronize()}if(!l){l=""}var f=this.dom,d=this.hasClassMap,e=this.classList,a=this.SEPARATOR,g,j,b;h=h?h+a:"";l=l?a+l:"";if(typeof k=="string"){k=k.split(this.spacesRe)}for(g=0,j=k.length;g<j;g++){b=h+k[g]+l;if(d[b]){delete d[b];Ext.Array.remove(e,b)}}f.className=e.join(" ");return this},replaceCls:function(e,l,j,m){if(!e&&!l){return this}e=e||[];l=l||[];if(!this.isSynchronized){this.synchronize()}if(!m){m=""}var g=this.dom,d=this.hasClassMap,f=this.classList,a=this.SEPARATOR,h,k,b;j=j?j+a:"";m=m?a+m:"";if(typeof e=="string"){e=e.split(this.spacesRe)}if(typeof l=="string"){l=l.split(this.spacesRe)}for(h=0,k=e.length;h<k;h++){b=j+e[h]+m;if(d[b]){delete d[b];Ext.Array.remove(f,b)}}for(h=0,k=l.length;h<k;h++){b=j+l[h]+m;if(!d[b]){d[b]=true;f.push(b)}}g.className=f.join(" ");return this},hasCls:function(a){if(!this.isSynchronized){this.synchronize()}return this.hasClassMap.hasOwnProperty(a)},setCls:function(d){var f=this.hasClassMap,b,e,a;if(typeof d=="string"){d=d.split(this.spacesRe)}for(b=0,e=d.length;b<e;b++){a=d[b];if(!f[a]){f[a]=true}}this.classList=d.slice();this.dom.className=d.join(" ")},toggleCls:function(a,b){if(typeof b!=="boolean"){b=!this.hasCls(a)}return(b)?this.addCls(a):this.removeCls(a)},swapCls:function(b,g,a,e){if(a===undefined){a=true}var f=a?b:g,d=a?g:b;if(d){this.removeCls(e?e+"-"+d:d)}if(f){this.addCls(e?e+"-"+f:f)}return this},setWidth:function(a){return this.setLengthValue(this.WIDTH,a)},setHeight:function(a){return this.setLengthValue(this.HEIGHT,a)},setSize:function(b,a){if(Ext.isObject(b)){a=b.height;b=b.width}this.setWidth(b);this.setHeight(a);return this},setMinWidth:function(a){return this.setLengthValue(this.MIN_WIDTH,a)},setMinHeight:function(a){return this.setLengthValue(this.MIN_HEIGHT,a)},setMaxWidth:function(a){return this.setLengthValue(this.MAX_WIDTH,a)},setMaxHeight:function(a){return this.setLengthValue(this.MAX_HEIGHT,a)},setTop:function(a){return this.setLengthValue(this.TOP,a)},setRight:function(a){return this.setLengthValue(this.RIGHT,a)},setBottom:function(a){return this.setLengthValue(this.BOTTOM,a)},setLeft:function(a){return this.setLengthValue(this.LEFT,a)},setMargin:function(b){var a=this.dom.style;if(b||b===0){b=this.self.unitizeBox((b===true)?5:b);a.setProperty("margin",b,"important")}else{a.removeProperty("margin-top");a.removeProperty("margin-right");a.removeProperty("margin-bottom");a.removeProperty("margin-left")}},setPadding:function(b){var a=this.dom.style;if(b||b===0){b=this.self.unitizeBox((b===true)?5:b);a.setProperty("padding",b,"important")}else{a.removeProperty("padding-top");a.removeProperty("padding-right");a.removeProperty("padding-bottom");a.removeProperty("padding-left")}},setBorder:function(a){var b=this.dom.style;if(a||a===0){a=this.self.unitizeBox((a===true)?1:a);b.setProperty("border-width",a,"important")}else{b.removeProperty("border-top-width");b.removeProperty("border-right-width");b.removeProperty("border-bottom-width");b.removeProperty("border-left-width")}},setLengthValue:function(a,d){var b=this.dom.style;if(d===null){b.removeProperty(a);return this}if(typeof d=="number"){d=d+"px"}b.setProperty(a,d,"important");return this},setVisible:function(b){var a=this.getVisibilityMode(),d=b?"removeCls":"addCls";switch(a){case this.VISIBILITY:this.removeCls(["x-hidden-display","x-hidden-offsets"]);this[d]("x-hidden-visibility");break;case this.DISPLAY:this.removeCls(["x-hidden-visibility","x-hidden-offsets"]);this[d]("x-hidden-display");break;case this.OFFSETS:this.removeCls(["x-hidden-visibility","x-hidden-display"]);this[d]("x-hidden-offsets");break}return this},getVisibilityMode:function(){var b=this.dom,a=Ext.dom.Element.data(b,"visibilityMode");if(a===undefined){Ext.dom.Element.data(b,"visibilityMode",a=this.DISPLAY)}return a},setVisibilityMode:function(a){this.self.data(this.dom,"visibilityMode",a);return this},show:function(){var a=this.dom;if(a){a.style.removeProperty("display")}},hide:function(){this.dom.style.setProperty("display","none","important")},setVisibility:function(a){var b=this.dom.style;if(a){b.removeProperty("visibility")}else{b.setProperty("visibility","hidden","important")}},styleHooks:{},addStyles:function(j,h){var b=0,g=j.match(this.wordsRe),f=0,a=g.length,e,d;for(;f<a;f++){e=g[f];d=e&&parseInt(this.getStyle(h[e]),10);if(d){b+=Math.abs(d)}}return b},isStyle:function(a,b){return this.getStyle(a)==b},getStyleValue:function(a){return this.dom.style.getPropertyValue(a)},getStyle:function(g){var d=this,f=d.dom,e=d.styleHooks[g],b,a;if(f==document){return null}if(!e){d.styleHooks[g]=e={name:Ext.dom.Element.normalize(g)}}if(e.get){return e.get(f,d)}b=window.getComputedStyle(f,"");a=(b&&b[e.name]);return a},setStyle:function(a,j){var g=this,e=g.dom,k=g.styleHooks,b=e.style,f=Ext.valueFrom,d,h;if(typeof a=="string"){h=k[a];if(!h){k[a]=h={name:Ext.dom.Element.normalize(a)}}j=f(j,"");if(h.set){h.set(e,j,g)}else{b[h.name]=j}}else{for(d in a){if(a.hasOwnProperty(d)){h=k[d];if(!h){k[d]=h={name:Ext.dom.Element.normalize(d)}}j=f(a[d],"");if(h.set){h.set(e,j,g)}else{b[h.name]=j}}}}return g},getHeight:function(b){var d=this.dom,a=b?(d.clientHeight-this.getPadding("tb")):d.offsetHeight;return a>0?a:0},getWidth:function(a){var d=this.dom,b=a?(d.clientWidth-this.getPadding("lr")):d.offsetWidth;return b>0?b:0},getBorderWidth:function(a){return this.addStyles(a,this.borders)},getPadding:function(a){return this.addStyles(a,this.paddings)},applyStyles:function(e){if(e){var f=this.dom,d,b,a;if(typeof e=="function"){e=e.call()}d=typeof e;if(d=="string"){e=Ext.util.Format.trim(e).split(this.styleSplitRe);for(b=0,a=e.length;b<a;){f.style[Ext.dom.Element.normalize(e[b++])]=e[b++]}}else{if(d=="object"){this.setStyle(e)}}}return this},getSize:function(b){var a=this.dom;return{width:Math.max(0,b?(a.clientWidth-this.getPadding("lr")):a.offsetWidth),height:Math.max(0,b?(a.clientHeight-this.getPadding("tb")):a.offsetHeight)}},repaint:function(){var a=this.dom;this.addCls(Ext.baseCSSPrefix+"repaint");setTimeout(function(){Ext.fly(a).removeCls(Ext.baseCSSPrefix+"repaint")},1);return this},getMargin:function(b){var d=this,e={t:"top",l:"left",r:"right",b:"bottom"},f={},a;if(!b){for(a in d.margins){f[e[a]]=parseFloat(d.getStyle(d.margins[a]))||0}return f}else{return d.addStyles.call(d,b,d.margins)}},translate:function(){var a="webkitTransform" in document.createElement("div").style?"webkitTransform":"transform";return function(b,e,d){this.dom.style[a]="translate3d("+(b||0)+"px, "+(e||0)+"px, "+(d||0)+"px)"}}()});Ext.dom.Element.addMembers({getParent:function(){return Ext.get(this.dom.parentNode)},getFirstChild:function(){return Ext.get(this.dom.firstElementChild)},contains:function(a){if(!a){return false}var b=Ext.getDom(a);return(b===this.dom)||this.self.isAncestor(this.dom,b)},findParent:function(j,h,d){var f=this.dom,a=document.body,g=0,e;h=h||50;if(isNaN(h)){e=Ext.getDom(h);h=Number.MAX_VALUE}while(f&&f.nodeType==1&&g<h&&f!=a&&f!=e){if(Ext.DomQuery.is(f,j)){return d?Ext.get(f):f}g++;f=f.parentNode}return null},findParentNode:function(e,d,a){var b=Ext.fly(this.dom.parentNode,"_internal");return b?b.findParent(e,d,a):null},up:function(b,a){return this.findParentNode(b,a,true)},select:function(a,b){return Ext.dom.Element.select(a,b,this.dom)},query:function(a){return Ext.DomQuery.select(a,this.dom)},down:function(a,b){var d=Ext.DomQuery.selectNode(a,this.dom);return b?d:Ext.get(d)},child:function(a,b){var e,d=this,f;f=Ext.get(d).id;f=f.replace(/[\.:]/g,"\\$0");e=Ext.DomQuery.selectNode("#"+f+" > "+a,d.dom);return b?e:Ext.get(e)},parent:function(a,b){return this.matchNode("parentNode","parentNode",a,b)},next:function(a,b){return this.matchNode("nextSibling","nextSibling",a,b)},prev:function(a,b){return this.matchNode("previousSibling","previousSibling",a,b)},first:function(a,b){return this.matchNode("nextSibling","firstChild",a,b)},last:function(a,b){return this.matchNode("previousSibling","lastChild",a,b)},matchNode:function(b,f,a,d){if(!this.dom){return null}var e=this.dom[f];while(e){if(e.nodeType==1&&(!a||Ext.DomQuery.is(e,a))){return !d?Ext.get(e):e}e=e[b]}return null},isAncestor:function(a){return this.self.isAncestor.call(this.self,this.dom,a)}});Ext.define("Ext.dom.CompositeElementLite",{alternateClassName:["Ext.CompositeElementLite","Ext.CompositeElement"],statics:{importElementMethods:function(){}},constructor:function(b,a){this.elements=[];this.add(b,a);this.el=new Ext.dom.Element.Fly()},isComposite:true,getElement:function(a){return this.el.attach(a).synchronize()},transformElement:function(a){return Ext.getDom(a)},getCount:function(){return this.elements.length},add:function(d,a){var f=this.elements,b,e;if(!d){return this}if(typeof d=="string"){d=Ext.dom.Element.selectorFunction(d,a)}else{if(d.isComposite){d=d.elements}else{if(!Ext.isIterable(d)){d=[d]}}}for(b=0,e=d.length;b<e;++b){f.push(this.transformElement(d[b]))}return this},invoke:function(e,a){var g=this.elements,f=g.length,d,b;for(b=0;b<f;b++){d=g[b];if(d){Ext.dom.Element.prototype[e].apply(this.getElement(d),a)}}return this},item:function(b){var d=this.elements[b],a=null;if(d){a=this.getElement(d)}return a},addListener:function(b,j,h,g){var f=this.elements,a=f.length,d,k;for(d=0;d<a;d++){k=f[d];if(k){k.on(b,j,h||k,g)}}return this},each:function(g,f){var h=this,d=h.elements,a=d.length,b,j;for(b=0;b<a;b++){j=d[b];if(j){j=this.getElement(j);if(g.call(f||j,j,h,b)===false){break}}}return h},fill:function(a){var b=this;b.elements=[];b.add(a);return b},filter:function(a){var b=[],e=this,d=Ext.isFunction(a)?a:function(f){return f.is(a)};e.each(function(h,f,g){if(d(h,g)!==false){b[b.length]=e.transformElement(h)}});e.elements=b;return e},indexOf:function(a){return Ext.Array.indexOf(this.elements,this.transformElement(a))},replaceElement:function(f,e,a){var b=!isNaN(f)?f:this.indexOf(f),g;if(b>-1){e=Ext.getDom(e);if(a){g=this.elements[b];g.parentNode.insertBefore(e,g);Ext.removeNode(g)}Ext.Array.splice(this.elements,b,1,e)}return this},clear:function(){this.elements=[]},addElements:function(d,a){if(!d){return this}if(typeof d=="string"){d=Ext.dom.Element.selectorFunction(d,a)}var b=this.elements;Ext.each(d,function(f){b.push(Ext.get(f))});return this},first:function(){return this.item(0)},last:function(){return this.item(this.getCount()-1)},contains:function(a){return this.indexOf(a)!=-1},removeElement:function(d,f){var b=this,e=this.elements,a;Ext.each(d,function(g){if((a=(e[g]||e[g=b.indexOf(g)]))){if(f){if(a.dom){a.remove()}else{Ext.removeNode(a)}}Ext.Array.erase(e,g,1)}});return this}},function(){var a=Ext.dom.Element,e=a.prototype,d=this.prototype,b;for(b in e){if(typeof e[b]=="function"){(function(f){if(f==="destroy"){d[f]=function(){return this.invoke(f,arguments)}}else{d[f]=d[f]||function(){return this.invoke(f,arguments)}}}).call(d,b)}}d.on=d.addListener;a.selectorFunction=Ext.DomQuery.select;Ext.dom.Element.select=function(f,j,g){var h;if(typeof f=="string"){h=Ext.dom.Element.selectorFunction(f,g)}else{if(f.length!==undefined){h=f}else{}}return(j===true)?new Ext.dom.CompositeElement(h):new Ext.dom.CompositeElementLite(h)};Ext.select=function(){return a.select.apply(a,arguments)}});Ext.define("Ext.event.ListenerStack",{currentOrder:"current",length:0,constructor:function(){this.listeners={before:[],current:[],after:[]};this.lateBindingMap={};return this},add:function(j,k,l,f){var a=this.lateBindingMap,h=this.getAll(f),g=h.length,b,e,d;if(typeof j=="string"&&k.isIdentifiable){d=k.getId();b=a[d];if(b){if(b[j]){return false}else{b[j]=true}}else{a[d]=b={};b[j]=true}}else{if(g>0){while(g--){e=h[g];if(e.fn===j&&e.scope===k){e.options=l;return false}}}}e=this.create(j,k,l,f);if(l&&l.prepend){delete l.prepend;h.unshift(e)}else{h.push(e)}this.length++;return true},getAt:function(b,a){return this.getAll(a)[b]},getAll:function(a){if(!a){a=this.currentOrder}return this.listeners[a]},count:function(a){return this.getAll(a).length},create:function(e,d,b,a){return{stack:this,fn:e,firingFn:false,boundFn:false,isLateBinding:typeof e=="string",scope:d,options:b||{},order:a}},remove:function(j,k,f){var h=this.getAll(f),g=h.length,b=false,a=this.lateBindingMap,e,d;if(g>0){while(g--){e=h[g];if(e.fn===j&&e.scope===k){h.splice(g,1);b=true;this.length--;if(typeof j=="string"&&k.isIdentifiable){d=k.getId();if(a[d]&&a[d][j]){delete a[d][j]}}break}}}return b}});Ext.define("Ext.event.Controller",{isFiring:false,listenerStack:null,constructor:function(a){this.firingListeners=[];this.firingArguments=[];this.setInfo(a);return this},setInfo:function(a){this.info=a},getInfo:function(){return this.info},setListenerStacks:function(a){this.listenerStacks=a},fire:function(j,f){var o=this.listenerStacks,n=this.firingListeners,e=this.firingArguments,l=n.push,h=o.length,k,m,d,p,a=false,b=false,g;n.length=0;if(f){if(f.order!=="after"){a=true}else{b=true}}if(h===1){k=o[0].listeners;m=k.before;d=k.current;p=k.after;if(m.length>0){l.apply(n,m)}if(a){l.call(n,f)}if(d.length>0){l.apply(n,d)}if(b){l.call(n,f)}if(p.length>0){l.apply(n,p)}}else{for(g=0;g<h;g++){m=o[g].listeners.before;if(m.length>0){l.apply(n,m)}}if(a){l.call(n,f)}for(g=0;g<h;g++){d=o[g].listeners.current;if(d.length>0){l.apply(n,d)}}if(b){l.call(n,f)}for(g=0;g<h;g++){p=o[g].listeners.after;if(p.length>0){l.apply(n,p)}}}if(n.length===0){return this}if(!j){j=[]}e.length=0;e.push.apply(e,j);e.push(null,this);this.doFire();return this},doFire:function(){var l=this.firingListeners,d=this.firingArguments,h=d.length-2,e,g,b,p,j,o,a,k,m,f,n;this.isPausing=false;this.isPaused=false;this.isStopped=false;this.isFiring=true;for(e=0,g=l.length;e<g;e++){b=l[e];p=b.options;j=b.fn;o=b.firingFn;a=b.boundFn;k=b.isLateBinding;m=b.scope;if(k&&a&&a!==m[j]){a=false;o=false}if(!a){if(k){a=m[j];if(!a){continue}}else{a=j}b.boundFn=a}if(!o){o=a;if(p.buffer){o=Ext.Function.createBuffered(o,p.buffer,m)}if(p.delay){o=Ext.Function.createDelayed(o,p.delay,m)}b.firingFn=o}d[h]=p;f=d;if(p.args){f=p.args.concat(f)}if(p.single===true){b.stack.remove(j,m,b.order)}n=o.apply(m,f);if(n===false){this.stop()}if(this.isStopped){break}if(this.isPausing){this.isPaused=true;l.splice(0,e+1);return}}this.isFiring=false;this.listenerStacks=null;l.length=0;d.length=0;this.connectingController=null},connect:function(a){this.connectingController=a},resume:function(){var a=this.connectingController;this.isPausing=false;if(this.isPaused&&this.firingListeners.length>0){this.isPaused=false;this.doFire()}if(a){a.resume()}return this},isInterrupted:function(){return this.isStopped||this.isPaused},stop:function(){var a=this.connectingController;this.isStopped=true;if(a){this.connectingController=null;a.stop()}this.isFiring=false;this.listenerStacks=null;return this},pause:function(){var a=this.connectingController;this.isPausing=true;if(a){a.pause()}return this}});Ext.define("Ext.event.Dispatcher",{statics:{getInstance:function(){if(!this.instance){this.instance=new this()}return this.instance},setInstance:function(a){this.instance=a;return this}},config:{publishers:{}},wildcard:"*",constructor:function(a){this.listenerStacks={};this.activePublishers={};this.publishersCache={};this.noActivePublishers=[];this.controller=null;this.initConfig(a);return this},getListenerStack:function(f,h,d,b){var e=this.listenerStacks,g=e[f],a;b=Boolean(b);if(!g){if(b){e[f]=g={}}else{return null}}g=g[h];if(!g){if(b){e[f][h]=g={}}else{return null}}a=g[d];if(!a){if(b){g[d]=a=new Ext.event.ListenerStack()}else{return null}}return a},getController:function(e,g,d,b){var a=this.controller,f={targetType:e,target:g,eventName:d};if(!a){this.controller=a=new Ext.event.Controller()}if(a.isFiring){a=new Ext.event.Controller()}a.setInfo(f);if(b&&a!==b){a.connect(b)}return a},applyPublishers:function(d){var a,b;this.publishersCache={};for(a in d){if(d.hasOwnProperty(a)){b=d[a];this.registerPublisher(b)}}return d},registerPublisher:function(b){var a=this.activePublishers,d=b.getTargetType(),e=a[d];if(!e){a[d]=e=[]}e.push(b);b.setDispatcher(this);return this},getCachedActivePublishers:function(d,b){var a=this.publishersCache,e;if((e=a[d])&&(e=e[b])){return e}return null},cacheActivePublishers:function(d,b,e){var a=this.publishersCache;if(!a[d]){a[d]={}}a[d][b]=e;return e},getActivePublishers:function(g,b){var h,a,d,f,e;if((h=this.getCachedActivePublishers(g,b))){return h}a=this.activePublishers[g];if(a){h=[];for(d=0,f=a.length;d<f;d++){e=a[d];if(e.handles(b)){h.push(e)}}}else{h=this.noActivePublishers}return this.cacheActivePublishers(g,b,h)},hasListener:function(d,e,b){var a=this.getListenerStack(d,e,b);if(a){return a.count()>0}return false},addListener:function(f,g,b){var h=this.getActivePublishers(f,b),e=h.length,d,a;a=this.doAddListener.apply(this,arguments);if(a&&e>0){for(d=0;d<e;d++){h[d].subscribe(g,b)}}return a},doAddListener:function(h,j,d,g,f,e,a){var b=this.getListenerStack(h,j,d,true);return b.add(g,f,e,a)},removeListener:function(f,g,b){var h=this.getActivePublishers(f,b),e=h.length,d,a;a=this.doRemoveListener.apply(this,arguments);if(a&&e>0){for(d=0;d<e;d++){h[d].unsubscribe(g,b)}}return a},doRemoveListener:function(g,h,d,f,e,a){var b=this.getListenerStack(g,h,d);if(b===null){return false}return b.remove(f,e,a)},clearListeners:function(a,f,e){var k=this.listenerStacks,g=arguments.length,b,j,d,h;if(g===3){if(k[a]&&k[a][f]){this.removeListener(a,f,e);delete k[a][f][e]}}else{if(g===2){if(k[a]){b=k[a][f];if(b){for(e in b){if(b.hasOwnProperty(e)){j=this.getActivePublishers(a,e);for(d=0,g=j.length;d<g;d++){j[d].unsubscribe(f,e,true)}}}delete k[a][f]}}}else{if(g===1){j=this.activePublishers[a];for(d=0,g=j.length;d<g;d++){j[d].unsubscribeAll()}delete k[a]}else{j=this.activePublishers;for(a in j){if(j.hasOwnProperty(a)){h=j[a];for(d=0,g=h.length;d<g;d++){h[d].unsubscribeAll()}}}delete this.listenerStacks;this.listenerStacks={}}}}return this},dispatchEvent:function(e,f,a){var g=this.getActivePublishers(e,a),d=g.length,b;if(d>0){for(b=0;b<d;b++){g[b].notify(f,a)}}return this.doDispatchEvent.apply(this,arguments)},doDispatchEvent:function(a,h,g,k,d,b){var j=this.getListenerStack(a,h,g),e=this.getWildcardListenerStacks(a,h,g),f;if((j===null||j.length==0)){if(e.length==0&&!d){return}}else{e.push(j)}f=this.getController(a,h,g,b);f.setListenerStacks(e);f.fire(k,d);return !f.isInterrupted()},getWildcardListenerStacks:function(h,j,e){var g=[],b=this.wildcard,d=e!==b,f=j!==b,a;if(d&&(a=this.getListenerStack(h,j,b))){g.push(a)}if(f&&(a=this.getListenerStack(h,b,e))){g.push(a)}return g},getPublisher:function(a){return this.getPublishers()[a]}});Ext.define("Ext.mixin.Mixin",{onClassExtended:function(b,f){var a=f.mixinConfig,e,g,d;if(a){e=b.superclass.mixinConfig;if(e){a=f.mixinConfig=Ext.merge({},e,a)}f.mixinId=a.id;g=a.beforeHooks;d=a.hooks||a.afterHooks;if(g||d){Ext.Function.interceptBefore(f,"onClassMixedIn",function(j){var h=this.prototype;if(g){Ext.Object.each(g,function(l,k){j.override(k,function(){if(h[l].apply(this,arguments)!==false){return this.callOverridden(arguments)}})})}if(d){Ext.Object.each(d,function(l,k){j.override(k,function(){var m=this.callOverridden(arguments);h[l].apply(this,arguments);return m})})}})}}}});Ext.define("Ext.mixin.Observable",{extend:Ext.mixin.Mixin,mixins:[Ext.mixin.Identifiable],mixinConfig:{id:"observable",hooks:{destroy:"destroy"}},alternateClassName:"Ext.util.Observable",isObservable:true,observableType:"observable",validIdRegex:/^([\w\-]+)$/,observableIdPrefix:"#",listenerOptionsRegex:/^(?:delegate|single|delay|buffer|args|prepend)$/,eventFiringSuspended:false,config:{listeners:null,bubbleEvents:null},constructor:function(a){this.initConfig(a)},applyListeners:function(a){if(a){this.addListener(a)}},applyBubbleEvents:function(a){if(a){this.enableBubble(a)}},getOptimizedObservableId:function(){return this.observableId},getObservableId:function(){if(!this.observableId){var a=this.getUniqueId();this.observableId=this.observableIdPrefix+a;this.getObservableId=this.getOptimizedObservableId}return this.observableId},getOptimizedEventDispatcher:function(){return this.eventDispatcher},getEventDispatcher:function(){if(!this.eventDispatcher){this.eventDispatcher=Ext.event.Dispatcher.getInstance();this.getEventDispatcher=this.getOptimizedEventDispatcher;this.getListeners();this.getBubbleEvents()}return this.eventDispatcher},getManagedListeners:function(d,b){var e=d.getUniqueId(),a=this.managedListeners;if(!a){this.managedListeners=a={}}if(!a[e]){a[e]={};d.doAddListener("destroy","clearManagedListeners",this,{single:true,args:[d]})}if(!a[e][b]){a[e][b]=[]}return a[e][b]},getUsedSelectors:function(){var a=this.usedSelectors;if(!a){a=this.usedSelectors=[];a.$map={}}return a},fireEvent:function(a){var b=Array.prototype.slice.call(arguments,1);return this.doFireEvent(a,b)},fireAction:function(d,f,h,g,e,a){var b=typeof h,j;if(f===undefined){f=[]}if(b!="undefined"){j={fn:h,isLateBinding:b=="string",scope:g||this,options:e||{},order:a}}return this.doFireEvent(d,f,j)},doFireEvent:function(d,f,h,a){var g=this,e=true,b;if(g.eventFiringSuspended){b=g.eventQueue;if(!b){g.eventQueue=b=[]}b.push([d,f,h,a])}else{e=g.getEventDispatcher().dispatchEvent(g.observableType,g.getObservableId(),d,f,h,a)}return e},doAddListener:function(a,k,m,n,d){var f=(m&&m!==this&&m.isIdentifiable),b=this.getUsedSelectors(),g=b.$map,e=this.getObservableId(),h,l,j;if(!n){n={}}if(!m){m=this}if(n.delegate){j=n.delegate;e+=" "+j}if(!(e in g)){g[e]=true;b.push(e)}h=this.addDispatcherListener(e,a,k,m,n,d);if(h&&f){l=this.getManagedListeners(m,a);l.push({delegate:j,scope:m,fn:k,order:d})}return h},addDispatcherListener:function(b,e,g,f,d,a){return this.getEventDispatcher().addListener(this.observableType,b,e,g,f,d,a)},doRemoveListener:function(b,l,n,o,e){var h=(n&&n!==this&&n.isIdentifiable),f=this.getObservableId(),a,m,g,j,d,k;if(o&&o.delegate){k=o.delegate;f+=" "+k}if(!n){n=this}a=this.removeDispatcherListener(f,b,l,n,e);if(a&&h){m=this.getManagedListeners(n,b);for(g=0,j=m.length;g<j;g++){d=m[g];if(d.fn===l&&d.scope===n&&d.delegate===k&&d.order===e){m.splice(g,1);break}}}return a},removeDispatcherListener:function(b,d,f,e,a){return this.getEventDispatcher().removeListener(this.observableType,b,d,f,e,a)},clearManagedListeners:function(e){var k=this.managedListeners,a,d,j,g,f,h,b,l;if(!k){return this}if(e){if(typeof e!="string"){a=e.getUniqueId()}else{a=e}d=k[a];for(g in d){if(d.hasOwnProperty(g)){j=d[g];for(f=0,h=j.length;f<h;f++){b=j[f];l={};if(b.delegate){l.delegate=b.delegate}if(this.doRemoveListener(g,b.fn,b.scope,l,b.order)){f--;h--}}}}delete k[a];return this}for(a in k){if(k.hasOwnProperty(a)){this.clearManagedListeners(a)}}},changeListener:function(m,j,o,q,r,e){var b,n,h,k,a,p,g,l,d,f;if(typeof o!="undefined"){if(typeof j!="string"){for(g=0,l=j.length;g<l;g++){a=j[g];m.call(this,a,o,q,r,e)}return this}m.call(this,j,o,q,r,e)}else{if(Ext.isArray(j)){n=j;for(g=0,l=n.length;g<l;g++){d=n[g];m.call(this,d.event,d.fn,d.scope,d,d.order)}}else{h=this.listenerOptionsRegex;r=j;b=[];n=[];k={};for(a in r){p=r[a];if(a==="scope"){q=p;continue}else{if(a==="order"){e=p;continue}}if(!h.test(a)){f=typeof p;if(f!="string"&&f!="function"){m.call(this,a,p.fn,p.scope||q,p,p.order||e);continue}b.push(a);n.push(p)}else{k[a]=p}}for(g=0,l=b.length;g<l;g++){m.call(this,b[g],n[g],q,k,e)}}}return this},addListener:function(b,f,e,d,a){return this.changeListener(this.doAddListener,b,f,e,d,a)},toggleListener:function(b,d,g,f,e,a){return this.changeListener(b?this.doAddListener:this.doRemoveListener,d,g,f,e,a)},addBeforeListener:function(a,e,d,b){return this.addListener(a,e,d,b,"before")},addAfterListener:function(a,e,d,b){return this.addListener(a,e,d,b,"after")},removeListener:function(b,f,e,d,a){return this.changeListener(this.doRemoveListener,b,f,e,d,a)},removeBeforeListener:function(a,e,d,b){return this.removeListener(a,e,d,b,"before")},removeAfterListener:function(a,e,d,b){return this.removeListener(a,e,d,b,"after")},clearListeners:function(){var f=this.getUsedSelectors(),d=this.getEventDispatcher(),b,e,a;for(b=0,e=f.length;b<e;b++){a=f[b];d.clearListeners(this.observableType,a)}},hasListener:function(a){return this.getEventDispatcher().hasListener(this.observableType,this.getObservableId(),a)},suspendEvents:function(){this.eventFiringSuspended=true},resumeEvents:function(f){var e=this,a=e.eventQueue||[],b,d;e.eventFiringSuspended=false;if(!f){for(b=0,d=a.length;b<d;b++){e.doFireEvent.apply(e,a[b])}}e.eventQueue=[]},relayEvents:function(b,e,h){var d,g,f,a;if(typeof h=="undefined"){h=""}if(typeof e=="string"){e=[e]}if(Ext.isArray(e)){for(d=0,g=e.length;d<g;d++){f=e[d];a=h+f;b.addListener(f,this.createEventRelayer(a),this)}}else{for(f in e){if(e.hasOwnProperty(f)){a=h+e[f];b.addListener(f,this.createEventRelayer(a),this)}}}return this},relayEvent:function(f,g,j,k,a){var h=typeof g,d=f[f.length-1],e=d.getInfo().eventName,b;f=Array.prototype.slice.call(f,0,-2);f[0]=this;if(h!="undefined"){b={fn:g,scope:j||this,options:k||{},order:a,isLateBinding:h=="string"}}return this.doFireEvent(e,f,b,d)},createEventRelayer:function(a){return function(){return this.doFireEvent(a,Array.prototype.slice.call(arguments,0,-2))}},enableBubble:function(e){var a=this.isBubblingEnabled,d,f,b;if(!a){a=this.isBubblingEnabled={}}if(typeof e=="string"){e=Ext.Array.clone(arguments)}for(d=0,f=e.length;d<f;d++){b=e[d];if(!a[b]){a[b]=true;this.addListener(b,this.createEventBubbler(b),this)}}},createEventBubbler:function(a){return function b(){var d=("getBubbleTarget" in this)?this.getBubbleTarget():null;if(d&&d!==this&&d.isObservable){d.fireAction(a,Array.prototype.slice.call(arguments,0,-2),b,d,null,"after")}}},getBubbleTarget:function(){return false},destroy:function(){if(this.observableId){this.fireEvent("destroy",this);this.clearListeners();this.clearManagedListeners()}},addEvents:Ext.emptyFn},function(){this.createAlias({on:"addListener",un:"removeListener",onBefore:"addBeforeListener",onAfter:"addAfterListener",unBefore:"removeBeforeListener",unAfter:"removeAfterListener"})});Ext.define("Ext.Evented",{alternateClassName:"Ext.EventedBase",mixins:[Ext.mixin.Observable],statics:{generateSetter:function(f){var d=f.internal,b=f.apply,a=f.changeEvent,e=f.doSet;return function(j){var k=this.initialized,h=this[d],g=this[b];if(g){j=g.call(this,j,h);if(typeof j=="undefined"){return this}}h=this[d];if(j!==h){if(k){this.fireAction(a,[this,j,h],this.doSet,this,{nameMap:f})}else{this[d]=j;if(this[e]){this[e].call(this,j,h)}}}return this}}},initialized:false,constructor:function(a){this.initialConfig=a;this.initialize()},initialize:function(){this.initConfig(this.initialConfig);this.initialized=true},doSet:function(d,e,b,a){var f=a.nameMap;d[f.internal]=e;if(d[f.doSet]){d[f.doSet].call(this,e,b)}},onClassExtended:function(a,f){if(!f.hasOwnProperty("eventedConfig")){return}var e=Ext.Class,d=f.config,h=f.eventedConfig,b,g;f.config=(d)?Ext.applyIf(d,h):h;for(b in h){if(h.hasOwnProperty(b)){g=e.getConfigNameMap(b);f[g.set]=this.generateSetter(g)}}}});Ext.define("Ext.AbstractComponent",{extend:Ext.Evented,onClassExtended:function(b,g){if(!g.hasOwnProperty("cachedConfig")){return}var h=b.prototype,d=g.config,f=g.cachedConfig,e=h.cachedConfigList,k=h.hasCachedConfig,a,j;delete g.cachedConfig;h.cachedConfigList=e=(e)?e.slice():[];h.hasCachedConfig=k=(k)?Ext.Object.chain(k):{};if(!d){g.config=d={}}for(a in f){if(f.hasOwnProperty(a)){j=f[a];if(!k[a]){k[a]=true;e.push(a)}d[a]=j}}},getElementConfig:Ext.emptyFn,referenceAttributeName:"reference",referenceSelector:"[reference]",addReferenceNode:function(a,b){Ext.Object.defineProperty(this,a,{get:function(){var d;delete this[a];this[a]=d=new Ext.Element(b);return d},configurable:true})},initElement:function(){var l=this.self.prototype,o=this.getId(),u=[],h=true,z=this.referenceAttributeName,q=false,f,x,b,p,v,e,m,d,g,k,y,n,a,r,j,A,w,s;if(l.hasOwnProperty("renderTemplate")){f=this.renderTemplate.cloneNode(true);x=f.firstChild}else{h=false;q=true;f=document.createDocumentFragment();x=Ext.Element.create(this.getElementConfig(),true);f.appendChild(x)}p=f.querySelectorAll(this.referenceSelector);for(v=0,e=p.length;v<e;v++){m=p[v];d=m.getAttribute(z);if(h){m.removeAttribute(z)}if(d=="element"){m.id=o;this.element=b=new Ext.Element(m)}else{this.addReferenceNode(d,m)}u.push(d)}this.referenceList=u;if(!this.innerElement){this.innerElement=b}if(!this.bodyElement){this.bodyElement=this.innerElement}if(x===b.dom){this.renderElement=b}else{this.addReferenceNode("renderElement",x)}if(q){g=Ext.Class.configNameCache;k=this.config;y=this.cachedConfigList;n=this.initConfigList;a=this.initConfigMap;r=[];for(v=0,e=y.length;v<e;v++){A=y[v];w=g[A];if(a[A]){a[A]=false;Ext.Array.remove(n,A)}if(k[A]!==null){r.push(A);this[w.get]=this[w.initGet]}}for(v=0,e=r.length;v<e;v++){A=r[v];w=g[A];s=w.internal;this[s]=null;this[w.set].call(this,k[A]);delete this[w.get];l[s]=this[s]}x=this.renderElement.dom;l.renderTemplate=f=document.createDocumentFragment();f.appendChild(x.cloneNode(true));j=f.querySelectorAll("[id]");for(v=0,e=j.length;v<e;v++){b=j[v];b.removeAttribute("id")}for(v=0,e=u.length;v<e;v++){d=u[v];this[d].dom.removeAttribute("reference")}}return this}});Ext.define("Ext.util.HashMap",{mixins:{observable:Ext.mixin.Observable},constructor:function(a){this.callParent();this.mixins.observable.constructor.call(this);this.clear(true)},getCount:function(){return this.length},getData:function(a,b){if(b===undefined){b=a;a=this.getKey(b)}return[a,b]},getKey:function(a){return a.id},add:function(a,e){var b=this,d;if(b.containsKey(a)){throw new Error("This key already exists in the HashMap")}d=this.getData(a,e);a=d[0];e=d[1];b.map[a]=e;++b.length;b.fireEvent("add",b,a,e);return e},replace:function(b,e){var d=this,f=d.map,a;if(!d.containsKey(b)){d.add(b,e)}a=f[b];f[b]=e;d.fireEvent("replace",d,b,e,a);return e},remove:function(b){var a=this.findKey(b);if(a!==undefined){return this.removeByKey(a)}return false},removeByKey:function(a){var b=this,d;if(b.containsKey(a)){d=b.map[a];delete b.map[a];--b.length;b.fireEvent("remove",b,a,d);return true}return false},get:function(a){return this.map[a]},clear:function(a){var b=this;b.map={};b.length=0;if(a!==true){b.fireEvent("clear",b)}return b},containsKey:function(a){return this.map[a]!==undefined},contains:function(a){return this.containsKey(this.findKey(a))},getKeys:function(){return this.getArray(true)},getValues:function(){return this.getArray(false)},getArray:function(e){var a=[],b,d=this.map;for(b in d){if(d.hasOwnProperty(b)){a.push(e?b:d[b])}}return a},each:function(e,d){var a=Ext.apply({},this.map),b,f=this.length;d=d||this;for(b in a){if(a.hasOwnProperty(b)){if(e.call(d,b,a[b],f)===false){break}}}return this},clone:function(){var d=new Ext.util.HashMap(),b=this.map,a;d.suspendEvents();for(a in b){if(b.hasOwnProperty(a)){d.add(a,b[a])}}d.resumeEvents();return d},findKey:function(b){var a,d=this.map;for(a in d){if(d.hasOwnProperty(a)&&d[a]===b){return a}}return undefined}});Ext.define("Ext.AbstractManager",{typeName:"type",constructor:function(a){Ext.apply(this,a||{});this.all=Ext.create("Ext.util.HashMap");this.types={}},get:function(a){return this.all.get(a)},register:function(a){this.all.add(a)},unregister:function(a){this.all.remove(a)},registerType:function(b,a){this.types[b]=a;a[this.typeName]=b},isRegistered:function(a){return this.types[a]!==undefined},create:function(a,e){var b=a[this.typeName]||a.type||e,d=this.types[b];return new d(a)},onAvailable:function(f,d,b){var a=this.all,e;if(a.containsKey(f)){e=a.get(f);d.call(b||e,e)}else{a.on("add",function(j,g,h){if(g==f){d.call(b||h,h);a.un("add",d,b)}})}},each:function(b,a){this.all.each(b,a||this)},getCount:function(){return this.all.getCount()}});Ext.define("Ext.mixin.Traversable",{extend:Ext.mixin.Mixin,mixinConfig:{id:"traversable"},setParent:function(a){this.parent=a;return this},hasParent:function(){return Boolean(this.parent)},getParent:function(){return this.parent},getAncestors:function(){var b=[],a=this.getParent();while(a){b.push(a);a=a.getParent()}return b},getAncestorIds:function(){var b=[],a=this.getParent();while(a){b.push(a.getId());a=a.getParent()}return b}});Ext.define("Ext.ComponentManager",{alternateClassName:"Ext.ComponentMgr",singleton:true,constructor:function(){var a={};this.all={map:a,getArray:function(){var b=[],d;for(d in a){if(a.hasOwnProperty(d)){b.push(a[d])}}return b}};this.map=a},register:function(a){var b=a.getId();this.map[a.getId()]=a},unregister:function(a){delete this.map[a.getId()]},isRegistered:function(a){return this.map[a]!==undefined},get:function(a){return this.map[a]},create:function(a,d){if(a.isComponent){return a}else{if(Ext.isString(a)){return Ext.createByAlias("widget."+a)}else{var b=a.xtype||d;return Ext.createByAlias("widget."+b,a)}}},registerType:Ext.emptyFn});(function(){function b(e){var d=Array.prototype.slice.call(arguments,1);return e.replace(/\{(\d+)\}/g,function(f,g){return d[g]})}Ext.DateExtras={now:Date.now||function(){return +new Date()},getElapsed:function(e,d){return Math.abs(e-(d||new Date()))},useStrict:false,formatCodeToRegex:function(e,d){var f=a.parseCodes[e];if(f){f=typeof f=="function"?f():f;a.parseCodes[e]=f}return f?Ext.applyIf({c:f.c?b(f.c,d||"{0}"):f.c},f):{g:0,c:null,s:Ext.String.escapeRegex(e)}},parseFunctions:{MS:function(e,d){var f=new RegExp("\\\\?/Date\\(([-+])?(\\d+)(?:[+-]\\d{4})?\\)\\\\?/");var g=(e||"").match(f);return g?new Date(((g[1]||"")+g[2])*1):null}},parseRegexes:[],formatFunctions:{MS:function(){return"\\/Date("+this.getTime()+")\\/"}},y2kYear:50,MILLI:"ms",SECOND:"s",MINUTE:"mi",HOUR:"h",DAY:"d",MONTH:"mo",YEAR:"y",defaults:{},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNumbers:{Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},defaultFormat:"m/d/Y",getShortMonthName:function(d){return a.monthNames[d].substring(0,3)},getShortDayName:function(d){return a.dayNames[d].substring(0,3)},getMonthNumber:function(d){return a.monthNumbers[d.substring(0,1).toUpperCase()+d.substring(1,3).toLowerCase()]},formatCodes:{d:"Ext.String.leftPad(this.getDate(), 2, '0')",D:"Ext.Date.getShortDayName(this.getDay())",j:"this.getDate()",l:"Ext.Date.dayNames[this.getDay()]",N:"(this.getDay() ? this.getDay() : 7)",S:"Ext.Date.getSuffix(this)",w:"this.getDay()",z:"Ext.Date.getDayOfYear(this)",W:"Ext.String.leftPad(Ext.Date.getWeekOfYear(this), 2, '0')",F:"Ext.Date.monthNames[this.getMonth()]",m:"Ext.String.leftPad(this.getMonth() + 1, 2, '0')",M:"Ext.Date.getShortMonthName(this.getMonth())",n:"(this.getMonth() + 1)",t:"Ext.Date.getDaysInMonth(this)",L:"(Ext.Date.isLeapYear(this) ? 1 : 0)",o:"(this.getFullYear() + (Ext.Date.getWeekOfYear(this) == 1 && this.getMonth() > 0 ? +1 : (Ext.Date.getWeekOfYear(this) >= 52 && this.getMonth() < 11 ? -1 : 0)))",Y:"Ext.String.leftPad(this.getFullYear(), 4, '0')",y:"('' + this.getFullYear()).substring(2, 4)",a:"(this.getHours() < 12 ? 'am' : 'pm')",A:"(this.getHours() < 12 ? 'AM' : 'PM')",g:"((this.getHours() % 12) ? this.getHours() % 12 : 12)",G:"this.getHours()",h:"Ext.String.leftPad((this.getHours() % 12) ? this.getHours() % 12 : 12, 2, '0')",H:"Ext.String.leftPad(this.getHours(), 2, '0')",i:"Ext.String.leftPad(this.getMinutes(), 2, '0')",s:"Ext.String.leftPad(this.getSeconds(), 2, '0')",u:"Ext.String.leftPad(this.getMilliseconds(), 3, '0')",O:"Ext.Date.getGMTOffset(this)",P:"Ext.Date.getGMTOffset(this, true)",T:"Ext.Date.getTimezone(this)",Z:"(this.getTimezoneOffset() * -60)",c:function(){for(var j="Y-m-dTH:i:sP",g=[],f=0,d=j.length;f<d;++f){var h=j.charAt(f);g.push(h=="T"?"'T'":a.getFormatCode(h))}return g.join(" + ")},U:"Math.round(this.getTime() / 1000)"},isValid:function(o,e,n,k,g,j,f){k=k||0;g=g||0;j=j||0;f=f||0;var l=a.add(new Date(o<100?100:o,e-1,n,k,g,j,f),a.YEAR,o<100?o-100:0);return o==l.getFullYear()&&e==l.getMonth()+1&&n==l.getDate()&&k==l.getHours()&&g==l.getMinutes()&&j==l.getSeconds()&&f==l.getMilliseconds()},parse:function(e,g,d){var f=a.parseFunctions;if(f[g]==null){a.createParser(g)}return f[g](e,Ext.isDefined(d)?d:a.useStrict)},parseDate:function(e,f,d){return a.parse(e,f,d)},getFormatCode:function(e){var d=a.formatCodes[e];if(d){d=typeof d=="function"?d():d;a.formatCodes[e]=d}return d||("'"+Ext.String.escape(e)+"'")},createFormat:function(h){var g=[],d=false,f="";for(var e=0;e<h.length;++e){f=h.charAt(e);if(!d&&f=="\\"){d=true}else{if(d){d=false;g.push("'"+Ext.String.escape(f)+"'")}else{if(f=="\n"){g.push(Ext.JSON.encode(f))}else{g.push(a.getFormatCode(f))}}}}a.formatFunctions[h]=Ext.functionFactory("return "+g.join("+"))},createParser:(function(){var d=["var dt, y, m, d, h, i, s, ms, o, z, zz, u, v,","def = Ext.Date.defaults,","results = String(input).match(Ext.Date.parseRegexes[{0}]);","if(results){","{1}","if(u != null){","v = new Date(u * 1000);","}else{","dt = Ext.Date.clearTime(new Date);","y = Ext.Number.from(y, Ext.Number.from(def.y, dt.getFullYear()));","m = Ext.Number.from(m, Ext.Number.from(def.m - 1, dt.getMonth()));","d = Ext.Number.from(d, Ext.Number.from(def.d, dt.getDate()));","h  = Ext.Number.from(h, Ext.Number.from(def.h, dt.getHours()));","i  = Ext.Number.from(i, Ext.Number.from(def.i, dt.getMinutes()));","s  = Ext.Number.from(s, Ext.Number.from(def.s, dt.getSeconds()));","ms = Ext.Number.from(ms, Ext.Number.from(def.ms, dt.getMilliseconds()));","if(z >= 0 && y >= 0){","v = Ext.Date.add(new Date(y < 100 ? 100 : y, 0, 1, h, i, s, ms), Ext.Date.YEAR, y < 100 ? y - 100 : 0);","v = !strict? v : (strict === true && (z <= 364 || (Ext.Date.isLeapYear(v) && z <= 365))? Ext.Date.add(v, Ext.Date.DAY, z) : null);","}else if(strict === true && !Ext.Date.isValid(y, m + 1, d, h, i, s, ms)){","v = null;","}else{","v = Ext.Date.add(new Date(y < 100 ? 100 : y, m, d, h, i, s, ms), Ext.Date.YEAR, y < 100 ? y - 100 : 0);","}","}","}","if(v){","if(zz != null){","v = Ext.Date.add(v, Ext.Date.SECOND, -v.getTimezoneOffset() * 60 - zz);","}else if(o){","v = Ext.Date.add(v, Ext.Date.MINUTE, -v.getTimezoneOffset() + (sn == '+'? -1 : 1) * (hr * 60 + mn));","}","}","return v;"].join("\n");return function(m){var f=a.parseRegexes.length,n=1,g=[],l=[],k=false,e="";for(var j=0;j<m.length;++j){e=m.charAt(j);if(!k&&e=="\\"){k=true}else{if(k){k=false;l.push(Ext.String.escape(e))}else{var h=a.formatCodeToRegex(e,n);n+=h.g;l.push(h.s);if(h.g&&h.c){g.push(h.c)}}}}a.parseRegexes[f]=new RegExp("^"+l.join("")+"$","i");a.parseFunctions[m]=Ext.functionFactory("input","strict",b(d,f,g.join("")))}})(),parseCodes:{d:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},j:{g:1,c:"d = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},D:function(){for(var d=[],e=0;e<7;d.push(a.getShortDayName(e)),++e){}return{g:0,c:null,s:"(?:"+d.join("|")+")"}},l:function(){return{g:0,c:null,s:"(?:"+a.dayNames.join("|")+")"}},N:{g:0,c:null,s:"[1-7]"},S:{g:0,c:null,s:"(?:st|nd|rd|th)"},w:{g:0,c:null,s:"[0-6]"},z:{g:1,c:"z = parseInt(results[{0}], 10);\n",s:"(\\d{1,3})"},W:{g:0,c:null,s:"(?:\\d{2})"},F:function(){return{g:1,c:"m = parseInt(Ext.Date.getMonthNumber(results[{0}]), 10);\n",s:"("+a.monthNames.join("|")+")"}},M:function(){for(var d=[],e=0;e<12;d.push(a.getShortMonthName(e)),++e){}return Ext.applyIf({s:"("+d.join("|")+")"},a.formatCodeToRegex("F"))},m:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{2})"},n:{g:1,c:"m = parseInt(results[{0}], 10) - 1;\n",s:"(\\d{1,2})"},t:{g:0,c:null,s:"(?:\\d{2})"},L:{g:0,c:null,s:"(?:1|0)"},o:function(){return a.formatCodeToRegex("Y")},Y:{g:1,c:"y = parseInt(results[{0}], 10);\n",s:"(\\d{4})"},y:{g:1,c:"var ty = parseInt(results[{0}], 10);\ny = ty > Ext.Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"},a:{g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(am|pm|AM|PM)"},A:{g:1,c:"if (/(am)/i.test(results[{0}])) {\nif (!h || h == 12) { h = 0; }\n} else { if (!h || h < 12) { h = (h || 0) + 12; }}",s:"(AM|PM|am|pm)"},g:function(){return a.formatCodeToRegex("G")},G:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{1,2})"},h:function(){return a.formatCodeToRegex("H")},H:{g:1,c:"h = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},i:{g:1,c:"i = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},s:{g:1,c:"s = parseInt(results[{0}], 10);\n",s:"(\\d{2})"},u:{g:1,c:"ms = results[{0}]; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n",s:"(\\d+)"},O:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(3,5) / 60),","mn = o.substring(3,5) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + Ext.String.leftPad(hr, 2, '0') + Ext.String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{4})"},P:{g:1,c:["o = results[{0}];","var sn = o.substring(0,1),","hr = o.substring(1,3)*1 + Math.floor(o.substring(4,6) / 60),","mn = o.substring(4,6) % 60;","o = ((-12 <= (hr*60 + mn)/60) && ((hr*60 + mn)/60 <= 14))? (sn + Ext.String.leftPad(hr, 2, '0') + Ext.String.leftPad(mn, 2, '0')) : null;\n"].join("\n"),s:"([+-]\\d{2}:\\d{2})"},T:{g:0,c:null,s:"[A-Z]{1,4}"},Z:{g:1,c:"zz = results[{0}] * 1;\nzz = (-43200 <= zz && zz <= 50400)? zz : null;\n",s:"([+-]?\\d{1,5})"},c:function(){var f=[],d=[a.formatCodeToRegex("Y",1),a.formatCodeToRegex("m",2),a.formatCodeToRegex("d",3),a.formatCodeToRegex("h",4),a.formatCodeToRegex("i",5),a.formatCodeToRegex("s",6),{c:"ms = results[7] || '0'; ms = parseInt(ms, 10)/Math.pow(10, ms.length - 3);\n"},{c:["if(results[8]) {","if(results[8] == 'Z'){","zz = 0;","}else if (results[8].indexOf(':') > -1){",a.formatCodeToRegex("P",8).c,"}else{",a.formatCodeToRegex("O",8).c,"}","}"].join("\n")}];for(var g=0,e=d.length;g<e;++g){f.push(d[g].c)}return{g:1,c:f.join(""),s:[d[0].s,"(?:","-",d[1].s,"(?:","-",d[2].s,"(?:","(?:T| )?",d[3].s,":",d[4].s,"(?::",d[5].s,")?","(?:(?:\\.|,)(\\d+))?","(Z|(?:[-+]\\d{2}(?::)?\\d{2}))?",")?",")?",")?"].join("")}},U:{g:1,c:"u = parseInt(results[{0}], 10);\n",s:"(-?\\d+)"}},dateFormat:function(d,e){return a.format(d,e)},format:function(e,f){if(a.formatFunctions[f]==null){a.createFormat(f)}var d=a.formatFunctions[f].call(e);return d+""},getTimezone:function(d){return d.toString().replace(/^.* (?:\((.*)\)|([A-Z]{1,4})(?:[\-+][0-9]{4})?(?: -?\d+)?)$/,"$1$2").replace(/[^A-Z]/g,"")},getGMTOffset:function(d,e){var f=d.getTimezoneOffset();return(f>0?"-":"+")+Ext.String.leftPad(Math.floor(Math.abs(f)/60),2,"0")+(e?":":"")+Ext.String.leftPad(Math.abs(f%60),2,"0")},getDayOfYear:function(g){var f=0,j=Ext.Date.clone(g),e=g.getMonth(),h;for(h=0,j.setDate(1),j.setMonth(0);h<e;j.setMonth(++h)){f+=a.getDaysInMonth(j)}return f+g.getDate()-1},getWeekOfYear:(function(){var d=86400000,e=7*d;return function(g){var h=Date.UTC(g.getFullYear(),g.getMonth(),g.getDate()+3)/d,f=Math.floor(h/7),j=new Date(f*e).getUTCFullYear();return f-Math.floor(Date.UTC(j,0,7)/e)+1}})(),isLeapYear:function(d){var e=d.getFullYear();return !!((e&3)==0&&(e%100||(e%400==0&&e)))},getFirstDayOfMonth:function(e){var d=(e.getDay()-(e.getDate()-1))%7;return(d<0)?(d+7):d},getLastDayOfMonth:function(d){return a.getLastDateOfMonth(d).getDay()},getFirstDateOfMonth:function(d){return new Date(d.getFullYear(),d.getMonth(),1)},getLastDateOfMonth:function(d){return new Date(d.getFullYear(),d.getMonth(),a.getDaysInMonth(d))},getDaysInMonth:(function(){var d=[31,28,31,30,31,30,31,31,30,31,30,31];return function(f){var e=f.getMonth();return e==1&&a.isLeapYear(f)?29:d[e]}})(),getSuffix:function(d){switch(d.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},clone:function(d){return new Date(d.getTime())},isDST:function(d){return new Date(d.getFullYear(),0,1).getTimezoneOffset()!=d.getTimezoneOffset()},clearTime:function(e,j){if(j){return Ext.Date.clearTime(Ext.Date.clone(e))}var g=e.getDate();e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);if(e.getDate()!=g){for(var f=1,h=a.add(e,Ext.Date.HOUR,f);h.getDate()!=g;f++,h=a.add(e,Ext.Date.HOUR,f)){}e.setDate(g);e.setHours(h.getHours())}return e},add:function(g,f,h){var j=Ext.Date.clone(g);if(!f||h===0){return j}switch(f.toLowerCase()){case Ext.Date.MILLI:j=new Date(j.valueOf()+h);break;case Ext.Date.SECOND:j=new Date(j.valueOf()+h*1000);break;case Ext.Date.MINUTE:j=new Date(j.valueOf()+h*60000);break;case Ext.Date.HOUR:j=new Date(j.valueOf()+h*3600000);break;case Ext.Date.DAY:j=new Date(j.valueOf()+h*86400000);break;case Ext.Date.MONTH:var e=g.getDate();if(e>28){e=Math.min(e,Ext.Date.getLastDateOfMonth(Ext.Date.add(Ext.Date.getFirstDateOfMonth(g),"mo",h)).getDate())}j.setDate(e);j.setMonth(g.getMonth()+h);break;case Ext.Date.YEAR:j.setFullYear(g.getFullYear()+h);break}return j},between:function(e,g,d){var f=e.getTime();return g.getTime()<=f&&f<=d.getTime()},diff:function(f,d,h){var e=Ext.Date,g,j=+d-f;switch(h){case e.MILLI:return j;case e.SECOND:return Math.floor(j/1000);case e.MINUTE:return Math.floor(j/60000);case e.HOUR:return Math.floor(j/3600000);case e.DAY:return Math.floor(j/86400000);case"w":return Math.floor(j/604800000);case e.MONTH:g=(d.getFullYear()*12+d.getMonth())-(f.getFullYear()*12+f.getMonth());if(Ext.Date.add(f,h,g)>d){return g-1}else{return g}case e.YEAR:g=d.getFullYear()-f.getFullYear();if(Ext.Date.add(f,h,g)>d){return g-1}else{return g}}},align:function(e,g,f){var d=new Date(+e);switch(g.toLowerCase()){case Ext.Date.MILLI:return d;break;case Ext.Date.SECOND:d.setUTCSeconds(d.getUTCSeconds()-d.getUTCSeconds()%f);d.setUTCMilliseconds(0);return d;break;case Ext.Date.MINUTE:d.setUTCMinutes(d.getUTCMinutes()-d.getUTCMinutes()%f);d.setUTCSeconds(0);d.setUTCMilliseconds(0);return d;break;case Ext.Date.HOUR:d.setUTCHours(d.getUTCHours()-d.getUTCHours()%f);d.setUTCMinutes(0);d.setUTCSeconds(0);d.setUTCMilliseconds(0);return d;break;case Ext.Date.DAY:if(f==7||f==14){d.setUTCDate(d.getUTCDate()-d.getUTCDay()+1)}d.setUTCHours(0);d.setUTCMinutes(0);d.setUTCSeconds(0);d.setUTCMilliseconds(0);return d;break;case Ext.Date.MONTH:d.setUTCMonth(d.getUTCMonth()-(d.getUTCMonth()-1)%f,1);d.setUTCHours(0);d.setUTCMinutes(0);d.setUTCSeconds(0);d.setUTCMilliseconds(0);return d;break;case Ext.Date.YEAR:d.setUTCFullYear(d.getUTCFullYear()-d.getUTCFullYear()%f,1,1);d.setUTCHours(0);d.setUTCMinutes(0);d.setUTCSeconds(0);d.setUTCMilliseconds(0);return e;break}}};var a=Ext.DateExtras;Ext.apply(Ext.Date,a)})();Ext.define("Ext.util.Format",{singleton:true,defaultDateFormat:"m/d/Y",escapeRe:/('|\\)/g,trimRe:/^[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+|[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u2028\u2029\u202f\u205f\u3000]+$/g,formatRe:/\{(\d+)\}/g,escapeRegexRe:/([-.*+?^${}()|[\]\/\\])/g,dashesRe:/-/g,iso8601TestRe:/\d\dT\d\d/,iso8601SplitRe:/[- :T\.Z\+]/,ellipsis:function(d,a,e){if(d&&d.length>a){if(e){var f=d.substr(0,a-2),b=Math.max(f.lastIndexOf(" "),f.lastIndexOf("."),f.lastIndexOf("!"),f.lastIndexOf("?"));if(b!=-1&&b>=(a-15)){return f.substr(0,b)+"..."}}return d.substr(0,a-3)+"..."}return d},escapeRegex:function(a){return a.replace(Ext.util.Format.escapeRegexRe,"\\$1")},escape:function(a){return a.replace(Ext.util.Format.escapeRe,"\\$1")},toggle:function(b,d,a){return b==d?a:d},trim:function(a){return a.replace(Ext.util.Format.trimRe,"")},leftPad:function(e,b,d){var a=String(e);d=d||" ";while(a.length<b){a=d+a}return a},format:function(b){var a=Ext.toArray(arguments,1);return b.replace(Ext.util.Format.formatRe,function(d,e){return a[e]})},htmlEncode:function(a){return !a?a:String(a).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},htmlDecode:function(a){return !a?a:String(a).replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},date:function(g,h){var b=g;if(!g){return""}if(!Ext.isDate(g)){b=new Date(Date.parse(g));if(isNaN(b)){if(this.iso8601TestRe.test(g)){if(Ext.os.is.Android&&Ext.os.version.isLessThan("3.0")){var j=[1,4,5,6,7,10,11];var f,e=0;if((f=/^(\d{4}|[+\-]\d{6})(?:-(\d{2})(?:-(\d{2}))?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(?:\.(\d{3}))?)?(?:(Z)|([+\-])(\d{2})(?::(\d{2}))?)?)?$/.exec(g))){for(var d=0,a;(a=j[d]);++d){f[a]=+f[a]||0}f[2]=(+f[2]||1)-1;f[3]=+f[3]||1;if(f[8]!=="Z"&&f[9]!==undefined){e=f[10]*60+f[11];if(f[9]==="+"){e=0-e}}b=new Date(Date.UTC(f[1],f[2],f[3],f[4],f[5]+e,f[6],f[7]))}}else{b=g.split(this.iso8601SplitRe);b=new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])}}}if(isNaN(b)){b=new Date(Date.parse(g.replace(this.dashesRe,"/")))}g=b}return Ext.Date.format(g,h||Ext.util.Format.defaultDateFormat)}});Ext.define("Ext.Template",{inheritableStatics:{from:function(b,a){b=Ext.getDom(b);return new this(b.value||b.innerHTML,a||"")}},constructor:function(e){var g=this,b=arguments,a=[],d=0,f=b.length,h;g.initialConfig={};if(f===1&&Ext.isArray(e)){b=e;f=b.length}if(f>1){for(;d<f;d++){h=b[d];if(typeof h=="object"){Ext.apply(g.initialConfig,h);Ext.apply(g,h)}else{a.push(h)}}}else{a.push(e)}g.html=a.join("");if(g.compiled){g.compile()}},isTemplate:true,disableFormats:false,re:/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,apply:function(a){var h=this,e=h.disableFormats!==true,g=Ext.util.Format,d=h,b;if(h.compiled){return h.compiled(a).join("")}function f(j,l,n,k){if(n&&e){if(k){k=[a[l]].concat(Ext.functionFactory("return ["+k+"];")())}else{k=[a[l]]}if(n.substr(0,5)=="this."){return d[n.substr(5)].apply(d,k)}else{return g[n].apply(g,k)}}else{return a[l]!==undefined?a[l]:""}}b=h.html.replace(h.re,f);return b},applyOut:function(a,b){var d=this;if(d.compiled){b.push.apply(b,d.compiled(a))}else{b.push(d.apply(a))}return b},applyTemplate:function(){return this.apply.apply(this,arguments)},set:function(a,d){var b=this;b.html=a;b.compiled=null;return d?b.compile():b},compileARe:/\\/g,compileBRe:/(\r\n|\n)/g,compileCRe:/'/g,compile:function(){var me=this,fm=Ext.util.Format,useFormat=me.disableFormats!==true,body,bodyReturn;function fn(m,name,format,args){if(format&&useFormat){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format="this."+format.substr(5)+"("}}else{args="";format="(values['"+name+"'] == undefined ? '' : "}return"',"+format+"values['"+name+"']"+args+") ,'"}bodyReturn=me.html.replace(me.compileARe,"\\\\").replace(me.compileBRe,"\\n").replace(me.compileCRe,"\\'").replace(me.re,fn);body="this.compiled = function(values){ return ['"+bodyReturn+"'];};";eval(body);return me},insertFirst:function(b,a,d){return this.doInsert("afterBegin",b,a,d)},insertBefore:function(b,a,d){return this.doInsert("beforeBegin",b,a,d)},insertAfter:function(b,a,d){return this.doInsert("afterEnd",b,a,d)},append:function(b,a,d){return this.doInsert("beforeEnd",b,a,d)},doInsert:function(b,e,a,f){var d=Ext.DomHelper.insertHtml(b,Ext.getDom(e),this.apply(a));return f?Ext.get(d):d},overwrite:function(d,a,e){var b=Ext.DomHelper.overwrite(Ext.getDom(d),this.apply(a));return e?Ext.get(b):b}});Ext.define("Ext.XTemplateParser",{constructor:function(a){Ext.apply(this,a)},doTpl:Ext.emptyFn,parse:function(n){var w=this,q=n.length,p={elseif:"elif"},r=w.topRe,d=w.actionsRe,f,e,k,o,h,l,j,v,u,b,g,a;w.level=0;w.stack=e=[];for(f=0;f<q;f=b){r.lastIndex=f;o=r.exec(n);if(!o){w.doText(n.substring(f,q));break}u=o.index;b=r.lastIndex;if(f<u){w.doText(n.substring(f,u))}if(o[1]){b=n.indexOf("%}",u+2);w.doEval(n.substring(u+2,b));b+=2}else{if(o[2]){b=n.indexOf("]}",u+2);w.doExpr(n.substring(u+2,b));b+=2}else{if(o[3]){w.doTag(o[3])}else{if(o[4]){g=null;while((v=d.exec(o[4]))!==null){k=v[2]||v[3];if(k){k=Ext.String.htmlDecode(k);h=v[1];h=p[h]||h;g=g||{};l=g[h];if(typeof l=="string"){g[h]=[l,k]}else{if(l){g[h].push(k)}else{g[h]=k}}}}if(!g){if(w.elseRe.test(o[4])){w.doElse()}else{if(w.defaultRe.test(o[4])){w.doDefault()}else{w.doTpl();e.push({type:"tpl"})}}}else{if(g["if"]){w.doIf(g["if"],g);e.push({type:"if"})}else{if(g["switch"]){w.doSwitch(g["switch"],g);e.push({type:"switch"})}else{if(g["case"]){w.doCase(g["case"],g)}else{if(g.elif){w.doElseIf(g.elif,g)}else{if(g["for"]){++w.level;if(a=w.propRe.exec(o[4])){g.propName=a[1]||a[2]}w.doFor(g["for"],g);e.push({type:"for",actions:g})}else{if(g.exec){w.doExec(g.exec,g);e.push({type:"exec",actions:g})}}}}}}}}else{if(o[0].length===5){e.push({type:"tpl"})}else{j=e.pop();w.doEnd(j.type,j.actions);if(j.type=="for"){--w.level}}}}}}}},topRe:/(?:(\{\%)|(\{\[)|\{([^{}]*)\})|(?:<tpl([^>]*)\>)|(?:<\/tpl>)/g,actionsRe:/\s*(elif|elseif|if|for|exec|switch|case|eval)\s*\=\s*(?:(?:"([^"]*)")|(?:'([^']*)'))\s*/g,propRe:/prop=(?:(?:"([^"]*)")|(?:'([^']*)'))/,defaultRe:/^\s*default\s*$/,elseRe:/^\s*else\s*$/});Ext.define("Ext.XTemplateCompiler",{extend:Ext.XTemplateParser,useEval:Ext.isGecko,useIndex:Ext.isIE6||Ext.isIE7,useFormat:true,propNameRe:/^[\w\d\$]*$/,compile:function(a){var d=this,b=d.generate(a);return d.useEval?d.evalTpl(b):(new Function("Ext",b))(Ext)},generate:function(a){var e=this,b="var fm=Ext.util.Format,ts=Object.prototype.toString;",d;e.maxLevel=0;e.body=["var c0=values, a0="+e.createArrayTest(0)+", p0=parent, n0=xcount, i0=xindex, v;\n"];if(e.definitions){if(typeof e.definitions==="string"){e.definitions=[e.definitions,b]}else{e.definitions.push(b)}}else{e.definitions=[b]}e.switches=[];e.parse(a);e.definitions.push((e.useEval?"$=":"return")+" function ("+e.fnArgs+") {",e.body.join(""),"}");d=e.definitions.join("\n");e.definitions.length=e.body.length=e.switches.length=0;delete e.definitions;delete e.body;delete e.switches;return d},doText:function(d){var b=this,a=b.body;d=d.replace(b.aposRe,"\\'").replace(b.newLineRe,"\\n");if(b.useIndex){a.push("out[out.length]='",d,"'\n")}else{a.push("out.push('",d,"')\n")}},doExpr:function(b){var a=this.body;a.push("v="+b+"; if (v !== undefined && v !== null) out");if(this.useIndex){a.push("[out.length]=v+''\n")}else{a.push(".push(v+'')\n")}},doTag:function(a){this.doExpr(this.parseTag(a))},doElse:function(){this.body.push("} else {\n")},doEval:function(a){this.body.push(a,"\n")},doIf:function(b,d){var a=this;if(b==="."){a.body.push("if (values) {\n")}else{if(a.propNameRe.test(b)){a.body.push("if (",a.parseTag(b),") {\n")}else{a.body.push("if (",a.addFn(b),a.callFn,") {\n")}}if(d.exec){a.doExec(d.exec)}},doElseIf:function(b,d){var a=this;if(b==="."){a.body.push("else if (values) {\n")}else{if(a.propNameRe.test(b)){a.body.push("} else if (",a.parseTag(b),") {\n")}else{a.body.push("} else if (",a.addFn(b),a.callFn,") {\n")}}if(d.exec){a.doExec(d.exec)}},doSwitch:function(b){var a=this;if(b==="."){a.body.push("switch (values) {\n")}else{if(a.propNameRe.test(b)){a.body.push("switch (",a.parseTag(b),") {\n")}else{a.body.push("switch (",a.addFn(b),a.callFn,") {\n")}}a.switches.push(0)},doCase:function(f){var e=this,d=Ext.isArray(f)?f:[f],g=e.switches.length-1,a,b;if(e.switches[g]){e.body.push("break;\n")}else{e.switches[g]++}for(b=0,g=d.length;b<g;++b){a=e.intRe.exec(d[b]);d[b]=a?a[1]:("'"+d[b].replace(e.aposRe,"\\'")+"'")}e.body.push("case ",d.join(": case "),":\n")},doDefault:function(){var a=this,b=a.switches.length-1;if(a.switches[b]){a.body.push("break;\n")}else{a.switches[b]++}a.body.push("default:\n")},doEnd:function(b,e){var d=this,a=d.level-1;if(b=="for"){if(e.exec){d.doExec(e.exec)}d.body.push("}\n");d.body.push("parent=p",a,";values=r",a+1,";xcount=n",a,";xindex=i",a,"\n")}else{if(b=="if"||b=="switch"){d.body.push("}\n")}}},doFor:function(g,j){var f=this,e,b=f.level,a=b-1,d="p"+b,h;if(g==="."){e="values"}else{if(f.propNameRe.test(g)){e=f.parseTag(g)}else{e=f.addFn(g)+f.callFn}}if(f.maxLevel<b){f.maxLevel=b;f.body.push("var ")}if(g=="."){h="c"+b}else{h="a"+a+"?c"+a+"[i"+a+"]:p"+b}f.body.push("i",b,"=0,n",b,"=0,c",b,"=",e,",a",b,"=",f.createArrayTest(b),",p",b,"=c",a,",r",b,"=values;\n","parent=",h,"\n","if (c",b,"){if(a",b,"){n",b,"=c",b,".length;}else if (c",b,".isMixedCollection){c",b,"=c",b,".items;n",b,"=c",b,".length;}else if(c",b,".isStore){c",b,"=c",b,".data.items;n",b,"=c",b,".length;}else{c",b,"=[c",b,"];n",b,"=1;}}\n","for (xcount=n",b,";i",b,"<n"+b+";++i",b,"){\n","values=c",b,"[i",b,"]");if(j.propName){f.body.push(".",j.propName)}f.body.push("\n","xindex=i",b,"+1\n")},createArrayTest:("isArray" in Array)?function(a){return"Array.isArray(c"+a+")"}:function(a){return"ts.call(c"+a+')==="[object Array]"'},doExec:function(d,e){var b=this,a="f"+b.definitions.length;b.definitions.push("function "+a+"("+b.fnArgs+") {"," try { with(values) {","  "+d," }} catch(e) {","}","}");b.body.push(a+b.callFn+"\n")},addFn:function(a){var d=this,b="f"+d.definitions.length;if(a==="."){d.definitions.push("function "+b+"("+d.fnArgs+") {"," return values","}")}else{if(a===".."){d.definitions.push("function "+b+"("+d.fnArgs+") {"," return parent","}")}else{d.definitions.push("function "+b+"("+d.fnArgs+") {"," try { with(values) {","  return("+a+")"," }} catch(e) {","}","}")}}return b},parseTag:function(b){var h=this,a=h.tagRe.exec(b),f=a[1],j=a[2],e=a[3],g=a[4],d;if(f=="."){if(!h.validTypes){h.definitions.push("var validTypes={string:1,number:1,boolean:1};");h.validTypes=true}d='validTypes[typeof values] || ts.call(values) === "[object Date]" ? values : ""'}else{if(f=="#"){d="xindex"}else{if(f.substr(0,7)=="parent."){d=f}else{if(isNaN(f)&&f.indexOf("-")==-1&&f.indexOf(".")!=-1){d="values."+f}else{d="values['"+f+"']"}}}}if(g){d="("+d+g+")"}if(j&&h.useFormat){e=e?","+e:"";if(j.substr(0,5)!="this."){j="fm."+j+"("}else{j+="("}}else{return d}return j+d+e+")"},evalTpl:function($){eval($);return $},newLineRe:/\r\n|\r|\n/g,aposRe:/[']/g,intRe:/^\s*(\d+)\s*$/,tagRe:/([\w-\.\#\$]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\/]\s?[\d\.\+\-\*\/\(\)]+)?/},function(){var a=this.prototype;a.fnArgs="out,values,parent,xindex,xcount";a.callFn=".call(this,"+a.fnArgs+")"});Ext.define("Ext.XTemplate",{extend:Ext.Template,emptyObj:{},apply:function(a){return this.applyOut(a,[]).join("")},applyOut:function(a,b,f){var h=this,g=a.xindex,k=a.xcount,d;if(!h.fn){d=new Ext.XTemplateCompiler({useFormat:h.disableFormats!==true,definitions:h.definitions});h.fn=d.compile(h.html)}try{g=typeof g==="number"?g:1;k=typeof k==="number"?k:1;h.fn.call(h,b,a,f||h.emptyObj,g,k)}catch(j){}return b},compile:function(){return this},statics:{getTpl:function(a,d){var b=a[d],e;if(b&&!b.isTemplate){b=Ext.ClassManager.dynInstantiate("Ext.XTemplate",b);if(a.hasOwnProperty(d)){a[d]=b}else{for(e=a.self.prototype;e;e=e.superclass){if(e.hasOwnProperty(d)){e[d]=b;break}}}}return b||null}}});Ext.define("Ext.behavior.Behavior",{constructor:function(a){this.component=a;a.on("destroy","onComponentDestroy",this)},onComponentDestroy:Ext.emptyFn});Ext.define("Ext.fx.easing.Abstract",{config:{startTime:0,startValue:0},isEasing:true,isEnded:false,constructor:function(a){this.initConfig(a);return this},applyStartTime:function(a){if(!a){a=Ext.Date.now()}return a},updateStartTime:function(a){this.reset()},reset:function(){this.isEnded=false},getValue:Ext.emptyFn});Ext.define("Ext.fx.easing.Linear",{extend:Ext.fx.easing.Abstract,alias:"easing.linear",config:{duration:0,endValue:0},updateStartValue:function(a){this.distance=this.getEndValue()-a},updateEndValue:function(a){this.distance=a-this.getStartValue()},getValue:function(){var a=Ext.Date.now()-this.getStartTime(),b=this.getDuration();if(a>b){this.isEnded=true;return this.getEndValue()}else{return this.getStartValue()+((a/b)*this.distance)}}});Ext.define("Ext.util.translatable.Abstract",{extend:Ext.Evented,config:{useWrapper:null,easing:null,easingX:null,easingY:null},x:0,y:0,activeEasingX:null,activeEasingY:null,isAnimating:false,isTranslatable:true,constructor:function(a){this.initConfig(a)},factoryEasing:function(a){return Ext.factory(a,Ext.fx.easing.Linear,null,"easing")},applyEasing:function(a){if(!this.getEasingX()){this.setEasingX(this.factoryEasing(a))}if(!this.getEasingY()){this.setEasingY(this.factoryEasing(a))}},applyEasingX:function(a){return this.factoryEasing(a)},applyEasingY:function(a){return this.factoryEasing(a)},doTranslate:Ext.emptyFn,translate:function(a,d,b){if(b){return this.translateAnimated(a,d,b)}if(this.isAnimating){this.stopAnimation()}if(!isNaN(a)&&typeof a=="number"){this.x=a}if(!isNaN(d)&&typeof d=="number"){this.y=d}this.doTranslate(a,d)},translateAxis:function(b,e,d){var a,f;if(b=="x"){a=e}else{f=e}return this.translate(a,f,d)},animate:function(b,a){this.activeEasingX=b;this.activeEasingY=a;this.isAnimating=true;this.lastX=null;this.lastY=null;Ext.AnimationQueue.start(this.doAnimationFrame,this);this.fireEvent("animationstart",this,this.x,this.y);return this},translateAnimated:function(b,h,f){if(!Ext.isObject(f)){f={}}if(this.isAnimating){this.stopAnimation()}var e=Ext.Date.now(),g=f.easing,d=(typeof b=="number")?(f.easingX||g||this.getEasingX()||true):null,a=(typeof h=="number")?(f.easingY||g||this.getEasingY()||true):null;if(d){d=this.factoryEasing(d);d.setStartTime(e);d.setStartValue(this.x);d.setEndValue(b);if("duration" in f){d.setDuration(f.duration)}}if(a){a=this.factoryEasing(a);a.setStartTime(e);a.setStartValue(this.y);a.setEndValue(h);if("duration" in f){a.setDuration(f.duration)}}return this.animate(d,a)},doAnimationFrame:function(){var f=this,d=f.activeEasingX,b=f.activeEasingY,e=Date.now(),a,g;if(!f.isAnimating){return}f.lastRun=e;if(d===null&&b===null){f.stopAnimation();return}if(d!==null){f.x=a=Math.round(d.getValue());if(d.isEnded){f.activeEasingX=null;f.fireEvent("axisanimationend",f,"x",a)}}else{a=f.x}if(b!==null){f.y=g=Math.round(b.getValue());if(b.isEnded){f.activeEasingY=null;f.fireEvent("axisanimationend",f,"y",g)}}else{g=f.y}if(f.lastX!==a||f.lastY!==g){f.doTranslate(a,g);f.lastX=a;f.lastY=g}f.fireEvent("animationframe",f,a,g)},stopAnimation:function(){if(!this.isAnimating){return}this.activeEasingX=null;this.activeEasingY=null;this.isAnimating=false;Ext.AnimationQueue.stop(this.doAnimationFrame,this);this.fireEvent("animationend",this,this.x,this.y)},refresh:function(){this.translate(this.x,this.y)},destroy:function(){if(this.isAnimating){this.stopAnimation()}this.callParent(arguments)}});Ext.define("Ext.util.translatable.Dom",{extend:Ext.util.translatable.Abstract,config:{element:null},applyElement:function(a){if(!a){return}return Ext.get(a)},updateElement:function(){this.refresh()}});Ext.define("Ext.util.translatable.CssTransform",{extend:Ext.util.translatable.Dom,doTranslate:function(a,d){var b=this.getElement();if(!this.isDestroyed&&!b.isDestroyed){b.translate(a,d)}},destroy:function(){var a=this.getElement();if(a&&!a.isDestroyed){a.dom.style.webkitTransform=null}this.callSuper()}});Ext.define("Ext.util.translatable.ScrollPosition",{extend:Ext.util.translatable.Dom,type:"scrollposition",config:{useWrapper:true},getWrapper:function(){var d=this.wrapper,b=this.getElement(),a;if(!d){a=b.getParent();if(!a){return null}if(a.hasCls(Ext.baseCSSPrefix+"translatable-hboxfix")){a=a.getParent()}if(this.getUseWrapper()){d=b.wrap()}else{d=a}b.addCls("x-translatable");d.addCls("x-translatable-container");this.wrapper=d;d.on("painted",function(){if(!this.isAnimating){this.refresh()}},this);this.refresh()}return d},doTranslate:function(a,e){var d=this.getWrapper(),b;if(d){b=d.dom;if(typeof a=="number"){b.scrollLeft=500000-a}if(typeof e=="number"){b.scrollTop=500000-e}}},destroy:function(){var a=this.getElement(),b=this.wrapper;if(b){if(!a.isDestroyed){if(this.getUseWrapper()){b.doReplaceWith(a)}a.removeCls("x-translatable")}if(!b.isDestroyed){b.removeCls("x-translatable-container");b.un("painted","refresh",this)}delete this.wrapper;delete this._element}this.callSuper()}});Ext.define("Ext.util.translatable.CssPosition",{extend:Ext.util.translatable.Dom,doTranslate:function(a,d){var b=this.getElement().dom.style;if(typeof a=="number"){b.left=a+"px"}if(typeof d=="number"){b.top=d+"px"}},destroy:function(){var a=this.getElement().dom.style;a.left=null;a.top=null;this.callParent(arguments)}});Ext.define("Ext.util.Translatable",{constructor:function(a){var b=Ext.util.translatable;switch(Ext.browser.getPreferredTranslationMethod(a)){case"scrollposition":return new b.ScrollPosition(a);case"csstransform":return new b.CssTransform(a);case"cssposition":return new b.CssPosition(a)}}});Ext.define("Ext.behavior.Translatable",{extend:Ext.behavior.Behavior,setConfig:function(d){var a=this.translatable,b=this.component;if(d){if(!a){this.translatable=a=new Ext.util.Translatable(d);a.setElement(b.renderElement);a.on("destroy","onTranslatableDestroy",this)}else{if(Ext.isObject(d)){a.setConfig(d)}}}else{if(a){a.destroy()}}return this},getTranslatable:function(){return this.translatable},onTranslatableDestroy:function(){delete this.translatable},onComponentDestroy:function(){var a=this.translatable;if(a){a.destroy()}}});Ext.define("Ext.util.Draggable",{isDraggable:true,mixins:[Ext.mixin.Observable],config:{cls:Ext.baseCSSPrefix+"draggable",draggingCls:Ext.baseCSSPrefix+"dragging",element:null,constraint:"container",disabled:null,direction:"both",initialOffset:{x:0,y:0},translatable:{}},DIRECTION_BOTH:"both",DIRECTION_VERTICAL:"vertical",DIRECTION_HORIZONTAL:"horizontal",defaultConstraint:{min:{x:-Infinity,y:-Infinity},max:{x:Infinity,y:Infinity}},containerWidth:0,containerHeight:0,width:0,height:0,constructor:function(a){var b;this.extraConstraint={};this.initialConfig=a;this.offset={x:0,y:0};this.listeners={dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",resize:"onElementResize",scope:this};if(a&&a.element){b=a.element;delete a.element;this.setElement(b)}return this},applyElement:function(a){if(!a){return}return Ext.get(a)},updateElement:function(a){a.on(this.listeners);this.initConfig(this.initialConfig)},updateInitialOffset:function(b){if(typeof b=="number"){b={x:b,y:b}}var d=this.offset,a,e;d.x=a=b.x;d.y=e=b.y;this.getTranslatable().translate(a,e)},updateCls:function(a){this.getElement().addCls(a)},applyTranslatable:function(a,b){a=Ext.factory(a,Ext.util.Translatable,b);if(a){a.setElement(this.getElement())}return a},setExtraConstraint:function(a){this.extraConstraint=a||{};this.refreshConstraint();return this},addExtraConstraint:function(a){Ext.merge(this.extraConstraint,a);this.refreshConstraint();return this},applyConstraint:function(a){this.currentConstraint=a;if(!a){a=this.defaultConstraint}if(a==="container"){return Ext.merge(this.getContainerConstraint(),this.extraConstraint)}return Ext.merge({},this.extraConstraint,a)},updateConstraint:function(){this.refreshOffset()},getContainerConstraint:function(){var a=this.getContainer(),b=this.getElement();if(!a||!b.dom){return this.defaultConstraint}return{min:{x:0,y:0},max:{x:this.containerWidth-this.width,y:this.containerHeight-this.height}}},getContainer:function(){var a=this.container;if(!a){a=this.getElement().getParent();if(a){this.container=a;a.on({resize:"onContainerResize",destroy:"onContainerDestroy",scope:this})}}return a},onElementResize:function(a,b){this.width=b.width;this.height=b.height;this.refresh()},onContainerResize:function(a,b){this.containerWidth=b.width;this.containerHeight=b.height;this.refresh()},onContainerDestroy:function(){delete this.container;delete this.containerSizeMonitor},detachListeners:function(){this.getElement().un(this.listeners)},isAxisEnabled:function(a){var b=this.getDirection();if(a==="x"){return(b===this.DIRECTION_BOTH||b===this.DIRECTION_HORIZONTAL)}return(b===this.DIRECTION_BOTH||b===this.DIRECTION_VERTICAL)},onDragStart:function(a){if(this.getDisabled()){return false}var b=this.offset;this.fireAction("dragstart",[this,a,b.x,b.y],this.initDragStart)},initDragStart:function(b,d,a,f){this.dragStartOffset={x:a,y:f};this.isDragging=true;this.getElement().addCls(this.getDraggingCls())},onDrag:function(b){if(!this.isDragging){return}var a=this.dragStartOffset;this.fireAction("drag",[this,b,a.x+b.deltaX,a.y+b.deltaY],this.doDrag)},doDrag:function(b,d,a,f){b.setOffset(a,f)},onDragEnd:function(a){if(!this.isDragging){return}this.onDrag(a);this.isDragging=false;this.getElement().removeCls(this.getDraggingCls());this.fireEvent("dragend",this,a,this.offset.x,this.offset.y)},setOffset:function(k,j,b){var g=this.offset,a=this.getConstraint(),f=a.min,d=a.max,e=Math.min,h=Math.max;if(this.isAxisEnabled("x")&&typeof k=="number"){k=e(h(k,f.x),d.x)}else{k=g.x}if(this.isAxisEnabled("y")&&typeof j=="number"){j=e(h(j,f.y),d.y)}else{j=g.y}g.x=k;g.y=j;this.getTranslatable().translate(k,j,b)},getOffset:function(){return this.offset},refreshConstraint:function(){this.setConstraint(this.currentConstraint)},refreshOffset:function(){var a=this.offset;this.setOffset(a.x,a.y)},refresh:function(){this.refreshConstraint();this.getTranslatable().refresh();this.refreshOffset()},enable:function(){return this.setDisabled(false)},disable:function(){return this.setDisabled(true)},destroy:function(){var a=this.getTranslatable();var b=this.getElement();if(b&&!b.isDestroyed){b.removeCls(this.getCls())}this.detachListeners();if(a){a.destroy()}}},function(){});Ext.define("Ext.behavior.Draggable",{extend:Ext.behavior.Behavior,setConfig:function(d){var a=this.draggable,b=this.component;if(d){if(!a){b.setTranslatable(d.translatable);this.draggable=a=new Ext.util.Draggable(d);a.setTranslatable(b.getTranslatable());a.setElement(b.renderElement);a.on("destroy","onDraggableDestroy",this);b.on(this.listeners)}else{if(Ext.isObject(d)){a.setConfig(d)}}}else{if(a){a.destroy()}}return this},getDraggable:function(){return this.draggable},onDraggableDestroy:function(){delete this.draggable},onComponentDestroy:function(){var a=this.draggable;if(a){a.destroy()}}});(function(a){Ext.define("Ext.Component",{extend:Ext.AbstractComponent,alternateClassName:"Ext.lib.Component",mixins:[Ext.mixin.Traversable],xtype:"component",observableType:"component",cachedConfig:{baseCls:null,cls:null,floatingCls:a+"floating",hiddenCls:a+"item-hidden",ui:null,margin:null,padding:null,border:null,styleHtmlCls:a+"html",styleHtmlContent:null},eventedConfig:{flex:null,left:null,top:null,right:null,bottom:null,width:null,height:null,minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,docked:null,centered:null,hidden:null,disabled:null},config:{style:null,html:null,draggable:null,translatable:null,renderTo:null,zIndex:null,tpl:null,enterAnimation:null,exitAnimation:null,showAnimation:null,hideAnimation:null,tplWriteMode:"overwrite",data:null,disabledCls:a+"item-disabled",contentEl:null,itemId:undefined,record:null,plugins:null},listenerOptionsRegex:/^(?:delegate|single|delay|buffer|args|prepend|element)$/,alignmentRegex:/^([a-z]+)-([a-z]+)(\?)?$/,isComponent:true,floating:false,rendered:false,isInner:true,activeAnimation:null,dockPositions:{top:true,right:true,bottom:true,left:true},innerElement:null,element:null,template:[],widthLayoutSized:false,heightLayoutSized:false,layoutStretched:false,sizeState:false,sizeFlags:0,LAYOUT_WIDTH:1,LAYOUT_HEIGHT:2,LAYOUT_BOTH:3,LAYOUT_STRETCHED:4,constructor:function(d){var e=this,b=e.config,f;e.onInitializedListeners=[];e.initialConfig=d;if(d!==undefined&&"id" in d){f=d.id}else{if("id" in b){f=b.id}else{f=e.getId()}}e.id=f;e.setId(f);Ext.ComponentManager.register(e);e.initElement();e.initConfig(e.initialConfig);e.refreshSizeState=e.doRefreshSizeState;e.refreshFloating=e.doRefreshFloating;if(e.refreshSizeStateOnInitialized){e.refreshSizeState()}if(e.refreshFloatingOnInitialized){e.refreshFloating()}e.initialize();e.triggerInitialized();if(e.config.fullscreen){e.fireEvent("fullscreen",e)}e.fireEvent("initialize",e)},beforeInitConfig:function(b){this.beforeInitialize.apply(this,arguments)},beforeInitialize:Ext.emptyFn,initialize:Ext.emptyFn,getTemplate:function(){return this.template},getElementConfig:function(){return{reference:"element",classList:["x-unsized"],children:this.getTemplate()}},triggerInitialized:function(){var g=this.onInitializedListeners,h=g.length,j,f,e,b,d;if(!this.initialized){this.initialized=true;if(h>0){for(d=0;d<h;d++){j=g[d];f=j.fn;e=j.scope;b=j.args;if(typeof f=="string"){e[f].apply(e,b)}else{f.apply(e,b)}}g.length=0}}},onInitialized:function(f,e,b){var d=this.onInitializedListeners;if(!e){e=this}if(this.initialized){if(typeof f=="string"){e[f].apply(e,b)}else{f.apply(e,b)}}else{d.push({fn:f,scope:e,args:b})}},renderTo:function(b,e){var g=this.renderElement.dom,f=Ext.getDom(b),d=Ext.getDom(e);if(f){if(d){f.insertBefore(g,d)}else{f.appendChild(g)}this.setRendered(Boolean(g.offsetParent))}},setParent:function(d){var b=this.parent;if(d&&b&&b!==d){b.remove(this,false)}this.parent=d;return this},applyPlugins:function(b){var e,d,f;if(!b){return b}b=[].concat(b);for(d=0,e=b.length;d<e;d++){f=b[d];b[d]=Ext.factory(f,"Ext.plugin.Plugin",null,"plugin")}return b},updatePlugins:function(f,b){var e,d;if(f){for(d=0,e=f.length;d<e;d++){f[d].init(this)}}if(b){for(d=0,e=b.length;d<e;d++){Ext.destroy(b[d])}}},updateRenderTo:function(b){this.renderTo(b)},updateStyle:function(b){this.element.applyStyles(b)},updateBorder:function(b){this.element.setBorder(b)},updatePadding:function(b){this.innerElement.setPadding(b)},updateMargin:function(b){this.element.setMargin(b)},updateUi:function(b,f){var e=this.getBaseCls(),d=this.element,g=this.currentUi;if(e){if(f){if(g){d.removeCls(g)}else{d.removeCls(e+"-"+f)}}if(b){d.addCls(b,e);this.currentUi=e+"-"+b;if(!this.self.prototype.currentUi){this.self.prototype.currentUi=this.currentUi}}}},applyBaseCls:function(b){return b||a+this.xtype},updateBaseCls:function(b,d){var e=this,f=e.getUi();if(d){this.element.removeCls(d);if(f){this.element.removeCls(this.currentUi)}}if(b){this.element.addCls(b);if(f){this.element.addCls(b,null,f);this.currentUi=b+"-"+f}}},addCls:function(b,j,k){var f=this.getCls(),h=(f)?f.slice():[],g,e,d;j=j||"";k=k||"";if(typeof b=="string"){b=[b]}g=b.length;if(!h.length&&j===""&&k===""){h=b}else{for(e=0;e<g;e++){d=j+b[e]+k;if(h.indexOf(d)==-1){h.push(d)}}}this.setCls(h)},removeCls:function(b,h,j){var e=this.getCls(),g=(e)?e.slice():[],f,d;h=h||"";j=j||"";if(typeof b=="string"){g=Ext.Array.remove(g,h+b+j)}else{f=b.length;for(d=0;d<f;d++){g=Ext.Array.remove(g,h+b[d]+j)}}this.setCls(g)},replaceCls:function(f,k,e,j){var l=this.getCls(),g=(l)?l.slice():[],h,d,b;e=e||"";j=j||"";if(typeof f=="string"){g=Ext.Array.remove(g,e+f+j)}else{if(f){h=f.length;for(d=0;d<h;d++){g=Ext.Array.remove(g,e+f[d]+j)}}}if(typeof k=="string"){g.push(e+k+j)}else{if(k){h=k.length;if(!g.length&&e===""&&j===""){g=k}else{for(d=0;d<h;d++){b=e+k[d]+j;if(g.indexOf(b)==-1){g.push(b)}}}}}this.setCls(g)},toggleCls:function(b,d){this.element.toggleCls(b,d);return this},applyCls:function(b){if(typeof b=="string"){b=[b]}if(!b||!b.length){b=null}return b},updateCls:function(d,b){if(this.element&&((d&&!b)||(!d&&b)||d.length!=b.length||Ext.Array.difference(d,b).length>0)){this.element.replaceCls(b,d)}},updateStyleHtmlCls:function(e,b){var f=this.innerHtmlElement,d=this.innerElement;if(this.getStyleHtmlContent()&&b){if(f){f.replaceCls(b,e)}else{d.replaceCls(b,e)}}},applyStyleHtmlContent:function(b){return Boolean(b)},updateStyleHtmlContent:function(e){var b=this.getStyleHtmlCls(),d=this.innerElement,f=this.innerHtmlElement;if(e){if(f){f.addCls(b)}else{d.addCls(b)}}else{if(f){f.removeCls(b)}else{d.addCls(b)}}},applyContentEl:function(b){if(b){return Ext.get(b)}},updateContentEl:function(b,d){if(d){d.hide();Ext.getBody().append(d)}if(b){this.setHtml(b.dom);b.show()}},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},isCentered:function(){return Boolean(this.getCentered())},isFloating:function(){return this.floating},isDocked:function(){return Boolean(this.getDocked())},isInnerItem:function(){return this.isInner},setIsInner:function(b){if(b!==this.isInner){this.isInner=b;if(this.initialized){this.fireEvent("innerstatechange",this,b)}}},filterLengthValue:function(b){if(b==="auto"||(!b&&b!==0)){return null}return b},applyTop:function(b){return this.filterLengthValue(b)},applyRight:function(b){return this.filterLengthValue(b)},applyBottom:function(b){return this.filterLengthValue(b)},applyLeft:function(b){return this.filterLengthValue(b)},applyWidth:function(b){return this.filterLengthValue(b)},applyHeight:function(b){return this.filterLengthValue(b)},applyMinWidth:function(b){return this.filterLengthValue(b)},applyMinHeight:function(b){return this.filterLengthValue(b)},applyMaxWidth:function(b){return this.filterLengthValue(b)},applyMaxHeight:function(b){return this.filterLengthValue(b)},doSetTop:function(b){this.element.setTop(b);this.refreshFloating()},doSetRight:function(b){this.element.setRight(b);this.refreshFloating()},doSetBottom:function(b){this.element.setBottom(b);this.refreshFloating()},doSetLeft:function(b){this.element.setLeft(b);this.refreshFloating()},doSetWidth:function(b){this.element.setWidth(b);this.refreshSizeState()},doSetHeight:function(b){this.element.setHeight(b);this.refreshSizeState()},applyFlex:function(b){if(b){b=Number(b);if(isNaN(b)){b=null}}else{b=null}return b},doSetFlex:Ext.emptyFn,refreshSizeState:function(){this.refreshSizeStateOnInitialized=true},doRefreshSizeState:function(){var d=this.getWidth()!==null||this.widthLayoutSized||(this.getLeft()!==null&&this.getRight()!==null),e=this.getHeight()!==null||this.heightLayoutSized||(this.getTop()!==null&&this.getBottom()!==null),g=this.layoutStretched||this.hasCSSMinHeight||(!e&&this.getMinHeight()!==null),f=d&&e,b=(d&&this.LAYOUT_WIDTH)|(e&&this.LAYOUT_HEIGHT)|(g&&this.LAYOUT_STRETCHED);if(!f&&g){f=null}this.setSizeState(f);this.setSizeFlags(b)},setLayoutSizeFlags:function(b){this.layoutStretched=!!(b&this.LAYOUT_STRETCHED);this.widthLayoutSized=!!(b&this.LAYOUT_WIDTH);this.heightLayoutSized=!!(b&this.LAYOUT_HEIGHT);this.refreshSizeState()},setSizeFlags:function(b){if(b!==this.sizeFlags){this.sizeFlags=b;var d=!!(b&this.LAYOUT_WIDTH),e=!!(b&this.LAYOUT_HEIGHT),f=!!(b&this.LAYOUT_STRETCHED);if(d&&!f&&!e){this.element.addCls("x-has-width")}else{this.element.removeCls("x-has-width")}if(e&&!f&&!d){this.element.addCls("x-has-height")}else{this.element.removeCls("x-has-height")}if(this.initialized){this.fireEvent("sizeflagschange",this,b)}}},getSizeFlags:function(){if(!this.initialized){this.doRefreshSizeState()}return this.sizeFlags},setSizeState:function(b){if(b!==this.sizeState){this.sizeState=b;this.element.setSizeState(b);if(this.initialized){this.fireEvent("sizestatechange",this,b)}}},getSizeState:function(){if(!this.initialized){this.doRefreshSizeState()}return this.sizeState},doSetMinWidth:function(b){this.element.setMinWidth(b)},doSetMinHeight:function(b){this.element.setMinHeight(b);this.refreshSizeState()},doSetMaxWidth:function(b){this.element.setMaxWidth(b)},doSetMaxHeight:function(b){this.element.setMaxHeight(b)},applyCentered:function(b){b=Boolean(b);if(b){this.refreshInnerState=Ext.emptyFn;if(this.isFloating()){this.resetFloating()}if(this.isDocked()){this.setDocked(false)}this.setIsInner(false);delete this.refreshInnerState}return b},doSetCentered:function(b){this.toggleCls(this.getFloatingCls(),b);if(!b){this.refreshInnerState()}},applyDocked:function(b){if(!b){return null}this.refreshInnerState=Ext.emptyFn;if(this.isFloating()){this.resetFloating()}if(this.isCentered()){this.setCentered(false)}this.setIsInner(false);delete this.refreshInnerState;return b},doSetDocked:function(d,b){this.fireEvent("afterdockedchange",this,d,b);if(!d){this.refreshInnerState()}},resetFloating:function(){this.setTop(null);this.setRight(null);this.setBottom(null);this.setLeft(null)},refreshInnerState:function(){this.setIsInner(!this.isCentered()&&!this.isFloating()&&!this.isDocked())},refreshFloating:function(){this.refreshFloatingOnInitialized=true},doRefreshFloating:function(){var d=true,b=this.getFloatingCls();if(this.getTop()===null&&this.getBottom()===null&&this.getRight()===null&&this.getLeft()===null){d=false}else{this.refreshSizeState()}if(d!==this.floating){this.floating=d;if(d){this.refreshInnerState=Ext.emptyFn;if(this.isCentered()){this.setCentered(false)}if(this.isDocked()){this.setDocked(false)}this.setIsInner(false);delete this.refreshInnerState}this.element.toggleCls(b,d);if(this.initialized){this.fireEvent("floatingchange",this,d)}if(!d){this.refreshInnerState()}}},updateFloatingCls:function(b,d){if(this.isFloating()){this.replaceCls(d,b)}},applyDisabled:function(b){return Boolean(b)},doSetDisabled:function(b){this.element[b?"addCls":"removeCls"](this.getDisabledCls())},updateDisabledCls:function(b,d){if(this.isDisabled()){this.element.replaceCls(d,b)}},disable:function(){this.setDisabled(true)},enable:function(){this.setDisabled(false)},isDisabled:function(){return this.getDisabled()},applyZIndex:function(b){if(!b&&b!==0){b=null}if(b!==null){b=Number(b);if(isNaN(b)){b=null}}return b},updateZIndex:function(e){var d=this.element,b;if(d&&!d.isDestroyed){b=d.dom.style;if(e!==null){b.setProperty("z-index",e,"important")}else{b.removeProperty("z-index")}}},getInnerHtmlElement:function(){var b=this.innerHtmlElement,d;if(!b||!b.dom||!b.dom.parentNode){this.innerHtmlElement=b=Ext.Element.create({cls:"x-innerhtml"});if(this.getStyleHtmlContent()){d=this.getStyleHtmlCls();this.innerHtmlElement.addCls(d);this.innerElement.removeCls(d)}this.innerElement.appendChild(b)}return b},updateHtml:function(b){if(!this.isDestroyed){var d=this.getInnerHtmlElement();if(Ext.isElement(b)){d.setHtml("");d.append(b)}else{d.setHtml(b)}}},applyHidden:function(b){return Boolean(b)},doSetHidden:function(d){var b=this.renderElement;if(b.isDestroyed){return}if(d){b.hide()}else{b.show()}if(this.element){this.element[d?"addCls":"removeCls"](this.getHiddenCls())}this.fireEvent(d?"hide":"show",this)},updateHiddenCls:function(b,d){if(this.isHidden()){this.element.replaceCls(d,b)}},isHidden:function(){return this.getHidden()},hide:function(b){this.setCurrentAlignmentInfo(null);if(this.activeAnimation){this.activeAnimation.on({animationend:function(){this.hide(b)},scope:this,single:true});return this}if(!this.getHidden()){if(b===undefined||(b&&b.isComponent)){b=this.getHideAnimation()}if(b){if(b===true){b="fadeOut"}this.onBefore({hiddenchange:"animateFn",scope:this,single:true,args:[b]})}this.setHidden(true)}return this},show:function(d){if(this.activeAnimation){this.activeAnimation.on({animationend:function(){this.show(d)},scope:this,single:true});return this}var b=this.getHidden();if(b||b===null){if(d===true){d="fadeIn"}else{if(d===undefined||(d&&d.isComponent)){d=this.getShowAnimation()}}if(d){this.beforeShowAnimation();this.onBefore({hiddenchange:"animateFn",scope:this,single:true,args:[d]})}this.setHidden(false)}return this},beforeShowAnimation:function(){if(this.element){this.renderElement.show();this.element.removeCls(this.getHiddenCls())}},animateFn:function(h,f,j,e,d,b){var g=this;if(h&&(!j||(j&&this.isPainted()))){this.activeAnimation=new Ext.fx.Animation(h);this.activeAnimation.setElement(f.element);if(!Ext.isEmpty(j)){this.activeAnimation.setOnEnd(function(){g.activeAnimation=null;b.resume()});b.pause()}Ext.Animator.run(g.activeAnimation)}},setVisibility:function(b){this.renderElement.setVisibility(b)},isRendered:function(){return this.rendered},isPainted:function(){return this.renderElement.isPainted()},applyTpl:function(b){return(Ext.isObject(b)&&b.isTemplate)?b:new Ext.XTemplate(b)},applyData:function(b){if(Ext.isObject(b)){return Ext.apply({},b)}else{if(!b){b={}}}return b},updateData:function(e){var f=this;if(e){var d=f.getTpl(),b=f.getTplWriteMode();if(d){d[b](f.getInnerHtmlElement(),e)}this.fireEvent("updatedata",f,e)}},applyRecord:function(b){if(b&&Ext.isObject(b)&&b.isModel){return b}return null},updateRecord:function(d,b){var e=this;if(b){b.unjoin(e)}if(!d){e.updateData("")}else{d.join(e);e.updateData(d.getData(true))}},afterEdit:function(){this.updateRecord(this.getRecord())},afterErase:function(){this.setRecord(null)},applyItemId:function(b){return b||this.getId()},isXType:function(d,b){if(b){return this.xtypes.indexOf(d)!=-1}return Boolean(this.xtypesMap[d])},getXTypes:function(){return this.xtypesChain.join("/")},getDraggableBehavior:function(){var b=this.draggableBehavior;if(!b){b=this.draggableBehavior=new Ext.behavior.Draggable(this)}return b},applyDraggable:function(b){this.getDraggableBehavior().setConfig(b)},getDraggable:function(){return this.getDraggableBehavior().getDraggable()},getTranslatableBehavior:function(){var b=this.translatableBehavior;if(!b){b=this.translatableBehavior=new Ext.behavior.Translatable(this)}return b},applyTranslatable:function(b){this.getTranslatableBehavior().setConfig(b)},getTranslatable:function(){return this.getTranslatableBehavior().getTranslatable()},translateAxis:function(d,f,e){var b,g;if(d==="x"){b=f}else{g=f}return this.translate(b,g,e)},translate:function(){var b=this.getTranslatable();if(!b){this.setTranslatable(true);b=this.getTranslatable()}b.translate.apply(b,arguments)},setRendered:function(d){var b=this.rendered;if(d!==b){this.rendered=d;return true}return false},setSize:function(d,b){if(d!=undefined){this.setWidth(d)}if(b!=undefined){this.setHeight(b)}},doAddListener:function(e,g,f,d,b){if(d&&"element" in d){return this[d.element].doAddListener(e,g,f||this,d,b)}if(e=="painted"||e=="resize"){return this.element.doAddListener(e,g,f||this,d,b)}return this.callParent(arguments)},doRemoveListener:function(e,g,f,d,b){if(d&&"element" in d){this[d.element].doRemoveListener(e,g,f||this,d,b)}return this.callParent(arguments)},showBy:function(d,g){var f=this,b=Ext.Viewport,e=f.getParent();f.setVisibility(false);if(e!==b){b.add(f)}f.show();f.on({hide:"onShowByErased",destroy:"onShowByErased",single:true,scope:f});b.on("resize","alignTo",f,{args:[d,g]});f.alignTo(d,g);f.setVisibility(true)},onShowByErased:function(){Ext.Viewport.un("resize","alignTo",this)},getAlignmentInfo:function(l,k){var d=l.isComponent?l.renderElement:l,h=d.getPageBox(),e=this.renderElement,f=e.getPageBox(),g={alignToBox:h,alignment:k,top:h.top,left:h.left,alignToWidth:h.width,alignToHeight:h.height,width:f.width,height:f.height},b=this.getCurrentAlignmentInfo(),j=true;if(!Ext.isEmpty(b)){Ext.Object.each(g,function(m,n){if(!Ext.isObject(n)&&b[m]!=n){j=false;return false}return true})}else{j=false}return{isAligned:j,stats:g}},getCurrentAlignmentInfo:function(){return this.$currentAlignmentInfo},setCurrentAlignmentInfo:function(b){this.$currentAlignmentInfo=Ext.isEmpty(b)?null:Ext.merge({},b.stats?b.stats:b)},alignTo:function(n,j){var q=this.getAlignmentInfo(n,j);if(q.isAligned){return}var p=q.stats.alignToBox,C=this.getParent().element.getPageBox(),z=q.stats.alignToHeight,o=q.stats.alignToWidth,u=q.stats.height,w=q.stats.width;C.bottom-=5;C.height-=10;C.left+=5;C.right-=5;C.top+=5;C.width-=10;if(!j||j==="auto"){if(C.bottom-p.bottom<u){if(p.top-C.top<u){if(p.left-C.left<w){j="cl-cr?"}else{j="cr-cl?"}}else{j="bc-tc?"}}else{j="tc-bc?"}}var b=j.match(this.alignmentRegex);var x=b[1].split(""),d=b[2].split(""),A=(b[3]==="?"),h=x[0],v=x[1]||h,l=d[0],m=d[1]||l,r=p.top,e=p.left,k=z/2,f=o/2,g=w/2,s=u/2,y,B;switch(h){case"t":switch(l){case"c":r+=k;break;case"b":r+=z}break;case"b":switch(l){case"c":r-=(u-k);break;case"t":r-=u;break;case"b":r-=u-z}break;case"c":switch(l){case"t":r-=s;break;case"c":r-=(s-k);break;case"b":r-=(s-z)}break}switch(v){case"l":switch(m){case"c":e+=k;break;case"r":e+=o}break;case"r":switch(m){case"r":e-=(w-o);break;case"c":e-=(w-g);break;case"l":e-=w}break;case"c":switch(m){case"l":e-=g;break;case"c":e-=(g-f);break;case"r":e-=(g-o)}break}if(A){y=(C.left+C.width)-w;B=(C.top+C.height)-u;e=Math.max(C.left,Math.min(y,e));r=Math.max(C.top,Math.min(B,r))}this.setLeft(e);this.setTop(r);this.setCurrentAlignmentInfo(q)},up:function(d){var b=this.parent;if(d){for(;b;b=b.parent){if(Ext.ComponentQuery.is(b,d)){return b}}}return b},getBubbleTarget:function(){return this.getParent()},destroy:function(){this.destroy=Ext.emptyFn;var f=this.getParent(),d=this.referenceList,e,g,b;this.isDestroying=true;Ext.destroy(this.getTranslatable(),this.getPlugins());if(f){f.remove(this,false)}for(e=0,g=d.length;e<g;e++){b=d[e];this[b].destroy();delete this[b]}Ext.destroy(this.innerHtmlElement);this.setRecord(null);this.callSuper();Ext.ComponentManager.unregister(this)}},function(){})})(Ext.baseCSSPrefix);Ext.define("Ext.mixin.Bindable",{extend:Ext.mixin.Mixin,mixinConfig:{id:"bindable"},bind:function(a,e,j,d,b){if(!j){j=e}var g=a[e],f,h;if(g&&g.hasOwnProperty("$binding")){h=g.$binding;if(h.bindingMethod===j&&h.bindingScope===this){return this}}a[e]=f=function(){var m=f.$binding,l=m.bindingScope,k=Array.prototype.slice.call(arguments);k.push(arguments);if(b){k.push.apply(k,b)}if(!m.preventDefault&&l[m.bindingMethod].apply(l,k)!==false){return m.boundFn.apply(this,arguments)}};f.$binding={preventDefault:!!d,boundFn:g,bindingMethod:j,bindingScope:this};return this},unbind:function(a,b,h){if(!h){h=b}var e=a[b],f=e.$binding,d,g;while(f){d=f.boundFn;if(f.bindingMethod===h&&f.bindingScope===this){if(g){g.boundFn=d}else{a[b]=d}return this}g=f;f=d.$binding}return this}});Ext.define("Ext.util.Wrapper",{mixins:[Ext.mixin.Bindable],constructor:function(d,b){var a=this.link("element",Ext.Element.create(d));if(b){a.insertBefore(b);this.wrap(b)}},bindSize:function(b){var d=this.wrappedElement,a;this.boundSizeName=b;this.boundMethodName=a=b==="width"?"setWidth":"setHeight";this.bind(d,a,"onBoundSizeChange");d[a].call(d,d.getStyleValue(b))},onBoundSizeChange:function(d,a){var b=this.element;if(typeof d==="string"&&d.substr(-1)==="%"){a[0]="100%"}else{d=""}b[this.boundMethodName].call(b,d)},wrap:function(d){var b=this.element,a;this.wrappedElement=d;a=b.dom;while(a.firstElementChild!==null){a=a.firstElementChild}a.appendChild(d.dom)},destroy:function(){var e=this.element,g=e.dom,f=this.wrappedElement,b=this.boundMethodName,a=g.parentNode,d;if(b){this.unbind(f,b,"onBoundSizeChange");d=e.getStyle(this.boundSizeName);if(d){f[b].call(f,d)}}if(a){if(!f.isDestroyed){a.replaceChild(g.firstElementChild,g)}delete this.wrappedElement}this.callSuper()}});Ext.define("Ext.layout.wrapper.Dock",{config:{direction:"horizontal",element:{className:"x-dock"},bodyElement:{className:"x-dock-body"},innerWrapper:null,sizeState:false,container:null},positionMap:{top:"start",left:"start",bottom:"end",right:"end"},constructor:function(a){this.items={start:[],end:[]};this.itemsCount=0;this.initConfig(a)},addItems:function(a){var b,e,d;for(b=0,e=a.length;b<e;b++){d=a[b];this.addItem(d)}},addItem:function(p){var q=p.getDocked(),j=this.positionMap[q],b=p.$dockWrapper,d=this.getContainer(),k=d.indexOf(p),n=this.items,m=n[j],a,h,g,l,o,f,e;if(b){b.removeItem(p)}p.$dockWrapper=this;a=p.link("$dockItemWrapper",new Ext.util.Wrapper({className:"x-dock-item"}));p.addCls("x-docked-"+q);h=a.element;for(g=0,l=m.length;g<l;g++){o=m[g];e=d.indexOf(o);if(e>k){f=o.element;m.splice(g,0,p);break}}if(!f){m.push(p);f=this.getBodyElement()}this.itemsCount++;if(j==="start"){h.insertBefore(f)}else{h.insertAfter(f)}a.wrap(p.element);a.bindSize(this.getDirection()==="horizontal"?"width":"height")},removeItem:function(d){var a=d.getDocked(),b=this.items[this.positionMap[a]];d.removeCls("x-docked-"+a);Ext.Array.remove(b,d);d.unlink("$dockItemWrapper");d.element.detach();delete d.$dockWrapper;if(--this.itemsCount===0){this.destroy()}},getItemsSlice:function(d){var a=this.getContainer(),b=this.items,j=[],h,e,g,f;for(h=b.start,e=0,g=h.length;e<g;e++){f=h[e];if(a.indexOf(f)>d){j.push(f)}}for(h=b.end,e=0,g=h.length;e<g;e++){f=h[e];if(a.indexOf(f)>d){j.push(f)}}return j},applyElement:function(a){return Ext.Element.create(a)},updateElement:function(a){a.addCls("x-dock-"+this.getDirection())},applyBodyElement:function(a){return Ext.Element.create(a)},updateBodyElement:function(a){this.getElement().append(a)},updateInnerWrapper:function(a,d){var b=this.getBodyElement();if(d&&d.$outerWrapper===this){b.remove(d.getElement());delete d.$outerWrapper}if(a){a.setSizeState(this.getSizeState());a.$outerWrapper=this;b.append(a.getElement())}},updateSizeState:function(b){var a=this.getInnerWrapper();this.getElement().setSizeState(b);if(a){a.setSizeState(b)}},destroy:function(){var b=this.getInnerWrapper(),a=this.$outerWrapper;if(b){if(a){a.setInnerWrapper(b)}else{b.getElement().replace(this.getElement());delete b.$outerWrapper}}delete this.$outerWrapper;this.setInnerWrapper(null);this.unlink("_bodyElement","_element");this.callSuper()}});Ext.define("Ext.layout.Abstract",{mixins:[Ext.mixin.Observable],isLayout:true,constructor:function(a){this.initialConfig=a},setContainer:function(a){this.container=a;this.initConfig(this.initialConfig);return this},onItemAdd:function(){},onItemRemove:function(){},onItemMove:function(){},onItemCenteredChange:function(){},onItemFloatingChange:function(){},onItemDockedChange:function(){},onItemInnerStateChange:function(){}});Ext.define("Ext.layout.wrapper.BoxDock",{config:{direction:"horizontal",element:{className:"x-dock"},bodyElement:{className:"x-dock-body"},innerWrapper:null,sizeState:false,container:null},positionMap:{top:"start",left:"start",bottom:"end",right:"end"},constructor:function(a){this.items={start:[],end:[]};this.itemsCount=0;this.initConfig(a)},addItems:function(a){var b,e,d;for(b=0,e=a.length;b<e;b++){d=a[b];this.addItem(d)}},addItem:function(o){var p=o.getDocked(),h=this.positionMap[p],a=o.$dockWrapper,b=this.getContainer(),j=b.indexOf(o),g=o.element,m=this.items,l=m[h],f,k,n,e,d;if(a){a.removeItem(o)}o.$dockWrapper=this;o.addCls("x-dock-item");o.addCls("x-docked-"+p);for(f=0,k=l.length;f<k;f++){n=l[f];d=b.indexOf(n);if(d>j){e=n.element;l.splice(f,0,o);break}}if(!e){l.push(o);e=this.getBodyElement()}this.itemsCount++;if(h==="start"){g.insertBefore(e)}else{g.insertAfter(e)}},removeItem:function(d){var a=d.getDocked(),b=this.items[this.positionMap[a]];Ext.Array.remove(b,d);d.element.detach();delete d.$dockWrapper;d.removeCls("x-dock-item");d.removeCls("x-docked-"+a);if(--this.itemsCount===0){this.destroy()}},getItemsSlice:function(d){var a=this.getContainer(),b=this.items,j=[],h,e,g,f;for(h=b.start,e=0,g=h.length;e<g;e++){f=h[e];if(a.indexOf(f)>d){j.push(f)}}for(h=b.end,e=0,g=h.length;e<g;e++){f=h[e];if(a.indexOf(f)>d){j.push(f)}}return j},applyElement:function(a){return Ext.Element.create(a)},updateElement:function(a){a.addCls("x-dock-"+this.getDirection())},applyBodyElement:function(a){return Ext.Element.create(a)},updateBodyElement:function(a){this.getElement().append(a)},updateInnerWrapper:function(a,d){var b=this.getBodyElement();if(d&&d.$outerWrapper===this){d.getElement().detach();delete d.$outerWrapper}if(a){a.setSizeState(this.getSizeState());a.$outerWrapper=this;b.append(a.getElement())}},updateSizeState:function(b){var a=this.getInnerWrapper();this.getElement().setSizeState(b);if(a){a.setSizeState(b)}},destroy:function(){var d=this.getInnerWrapper(),b=this.$outerWrapper,a;if(d){if(b){b.setInnerWrapper(d)}else{a=d.getElement();if(!a.isDestroyed){a.replace(this.getElement())}delete d.$outerWrapper}}delete this.$outerWrapper;this.setInnerWrapper(null);this.unlink("_bodyElement","_element");this.callSuper()}});Ext.define("Ext.layout.wrapper.Inner",{config:{sizeState:null,container:null},constructor:function(a){this.initConfig(a)},getElement:function(){return this.getContainer().bodyElement},setInnerWrapper:Ext.emptyFn,getInnerWrapper:Ext.emptyFn});Ext.define("Ext.layout.Default",{extend:Ext.layout.Abstract,isAuto:true,alias:["layout.default","layout.auto"],config:{animation:null},centerWrapperClass:"x-center",dockWrapperClass:"x-dock",positionMap:{top:"start",left:"start",middle:"center",bottom:"end",right:"end"},positionDirectionMap:{top:"vertical",bottom:"vertical",left:"horizontal",right:"horizontal"},setContainer:function(a){var b={delegate:"> component"};this.dockedItems=[];this.callSuper(arguments);a.on("centeredchange","onItemCenteredChange",this,b,"before").on("floatingchange","onItemFloatingChange",this,b,"before").on("dockedchange","onBeforeItemDockedChange",this,b,"before").on("afterdockedchange","onAfterItemDockedChange",this,b)},monitorSizeStateChange:function(){this.monitorSizeStateChange=Ext.emptyFn;this.container.on("sizestatechange","onContainerSizeStateChange",this)},monitorSizeFlagsChange:function(){this.monitorSizeFlagsChange=Ext.emptyFn;this.container.on("sizeflagschange","onContainerSizeFlagsChange",this)},onItemAdd:function(a){var b=a.getDocked();if(b!==null){this.dockItem(a)}else{if(a.isCentered()){this.onItemCenteredChange(a,true)}else{if(a.isFloating()){this.onItemFloatingChange(a,true)}else{this.onItemInnerStateChange(a,true)}}}},onItemInnerStateChange:function(b,a,d){if(a){this.insertInnerItem(b,this.container.innerIndexOf(b))}else{this.removeInnerItem(b)}},insertInnerItem:function(g,e){var b=this.container,j=b.innerElement.dom,f=g.element.dom,h=e!==-1?b.getInnerAt(e+1):null,d=null,a;if(h){a=h.getTranslatable();if(a&&a.getUseWrapper()){d=a.getWrapper().dom}else{d=h?h.element.dom:null}}j.insertBefore(f,d);return this},insertBodyItem:function(d){var a=this.container.setUseBodyElement(true),b=a.bodyElement.dom;if(d.getZIndex()===null){d.setZIndex((a.indexOf(d)+1)*2)}b.insertBefore(d.element.dom,b.firstChild);return this},removeInnerItem:function(a){a.element.detach()},removeBodyItem:function(a){a.setZIndex(null);a.element.detach()},onItemRemove:function(b,a,d){var e=b.getDocked();if(e){this.undockItem(b)}else{if(b.isCentered()){this.onItemCenteredChange(b,false)}else{if(b.isFloating()){this.onItemFloatingChange(b,false)}else{this.onItemInnerStateChange(b,false,d)}}}},onItemMove:function(b,d,a){if(b.isCentered()||b.isFloating()){b.setZIndex((d+1)*2)}else{if(b.isInnerItem()){this.insertInnerItem(b,this.container.innerIndexOf(b))}else{this.undockItem(b);this.dockItem(b)}}},onItemCenteredChange:function(d,a){var b="$centerWrapper";if(a){this.insertBodyItem(d);d.link(b,new Ext.util.Wrapper({className:this.centerWrapperClass},d.element))}else{d.unlink(b);this.removeBodyItem(d)}},onItemFloatingChange:function(a,b){if(b){this.insertBodyItem(a)}else{this.removeBodyItem(a)}},onBeforeItemDockedChange:function(a,d,b){if(b){this.undockItem(a)}},onAfterItemDockedChange:function(a,d,b){if(d){this.dockItem(a)}},onContainerSizeStateChange:function(){var a=this.getDockWrapper();if(a){a.setSizeState(this.container.getSizeState())}},onContainerSizeFlagsChange:function(){var a=this.dockedItems,b,e,d;for(b=0,e=a.length;b<e;b++){d=a[b];this.refreshDockedItemLayoutSizeFlags(d)}},refreshDockedItemLayoutSizeFlags:function(e){var b=this.container,f=this.positionDirectionMap[e.getDocked()],d=(f==="horizontal")?b.LAYOUT_HEIGHT:b.LAYOUT_WIDTH,a=(b.getSizeFlags()&d);e.setLayoutSizeFlags(a)},dockItem:function(u){var b=Ext.layout.wrapper.BoxDock,q=this.dockedItems,h=q.length,j=this.container,v=j.indexOf(u),g=this.positionDirectionMap,w=g[u.getDocked()],s=this.dockInnerWrapper,m,n,x,f,r,l,o,a,e,p,d,k;this.monitorSizeStateChange();this.monitorSizeFlagsChange();if(!s){s=this.link("dockInnerWrapper",new Ext.layout.wrapper.Inner({container:this.container}))}if(h===0){q.push(u);p=new b({container:this.container,direction:w});p.addItem(u);p.getElement().replace(s.getElement());p.setInnerWrapper(s);j.onInitialized("onContainerSizeStateChange",this)}else{for(n=0;n<h;n++){x=q[n];f=j.indexOf(x);if(f>v){o=r||q[0];q.splice(n,0,u);break}r=x}if(!o){o=q[h-1];q.push(u)}a=o.getDocked();e=o.$dockWrapper;m=g[a];if(w===m){e.addItem(u)}else{l=e.getItemsSlice(v);p=new b({container:this.container,direction:w});if(l.length>0){if(l.length===e.itemsCount){d=e;p.setSizeState(d.getSizeState());p.getElement().replace(d.getElement())}else{d=new b({container:this.container,direction:m});d.setInnerWrapper(e.getInnerWrapper());d.addItems(l);e.setInnerWrapper(p)}p.setInnerWrapper(d)}else{k=e.getInnerWrapper();e.setInnerWrapper(null);p.setInnerWrapper(k);e.setInnerWrapper(p)}p.addItem(u)}}j.onInitialized("refreshDockedItemLayoutSizeFlags",this,[u])},getDockWrapper:function(){var a=this.dockedItems;if(a.length>0){return a[0].$dockWrapper}return null},undockItem:function(b){var a=this.dockedItems;if(b.$dockWrapper){b.$dockWrapper.removeItem(b)}Ext.Array.remove(a,b);b.setLayoutSizeFlags(0)},destroy:function(){this.dockedItems.length=0;delete this.dockedItems;this.callSuper()}});Ext.define("Ext.layout.Float",{extend:Ext.layout.Default,alias:"layout.float",config:{direction:"left"},layoutClass:"layout-float",itemClass:"layout-float-item",setContainer:function(a){this.callSuper(arguments);a.innerElement.addCls(this.layoutClass)},onItemInnerStateChange:function(b,a){this.callSuper(arguments);b.toggleCls(this.itemClass,a)},updateDirection:function(d,a){var b="direction-";this.container.innerElement.swapCls(b+d,b+a)}});Ext.define("Ext.layout.Fit",{extend:Ext.layout.Default,isFit:true,alias:"layout.fit",layoutClass:"x-layout-fit",itemClass:"x-layout-fit-item",setContainer:function(a){this.callSuper(arguments);a.innerElement.addCls(this.layoutClass);this.onContainerSizeFlagsChange();this.monitorSizeFlagsChange()},onContainerSizeFlagsChange:function(){var a=this.container,b=a.getSizeFlags(),h=Boolean(b&a.LAYOUT_STRETCHED),g=a.innerItems,d,f,e;this.callSuper();for(d=0,f=g.length;d<f;d++){e=g[d];e.setLayoutSizeFlags(b)}a.innerElement.toggleCls("x-stretched",h)},onItemInnerStateChange:function(b,a){this.callSuper(arguments);b.toggleCls(this.itemClass,a);b.setLayoutSizeFlags(a?this.container.getSizeFlags():0)}});Ext.define("Ext.fx.layout.card.Abstract",{extend:Ext.Evented,isAnimation:true,config:{direction:"left",duration:null,reverse:null,layout:null},updateLayout:function(){this.enable()},enable:function(){var a=this.getLayout();if(a){a.onBefore("activeitemchange","onActiveItemChange",this)}},disable:function(){var a=this.getLayout();if(this.isAnimating){this.stopAnimation()}if(a){a.unBefore("activeitemchange","onActiveItemChange",this)}},onActiveItemChange:Ext.emptyFn,destroy:function(){var a=this.getLayout();if(this.isAnimating){this.stopAnimation()}if(a){a.unBefore("activeitemchange","onActiveItemChange",this)}this.setLayout(null);if(this.observableId){this.fireEvent("destroy",this);this.clearListeners();this.clearManagedListeners()}}});Ext.define("Ext.fx.State",{isAnimatable:{"background-color":true,"background-image":true,"background-position":true,"border-bottom-color":true,"border-bottom-width":true,"border-color":true,"border-left-color":true,"border-left-width":true,"border-right-color":true,"border-right-width":true,"border-spacing":true,"border-top-color":true,"border-top-width":true,"border-width":true,bottom:true,color:true,crop:true,"font-size":true,"font-weight":true,height:true,left:true,"letter-spacing":true,"line-height":true,"margin-bottom":true,"margin-left":true,"margin-right":true,"margin-top":true,"max-height":true,"max-width":true,"min-height":true,"min-width":true,opacity:true,"outline-color":true,"outline-offset":true,"outline-width":true,"padding-bottom":true,"padding-left":true,"padding-right":true,"padding-top":true,right:true,"text-indent":true,"text-shadow":true,top:true,"vertical-align":true,visibility:true,width:true,"word-spacing":true,"z-index":true,zoom:true,transform:true},constructor:function(a){this.data={};this.set(a)},setConfig:function(a){this.set(a);return this},setRaw:function(a){this.data=a;return this},clear:function(){return this.setRaw({})},setTransform:function(d,h){var g=this.data,a=Ext.isArray(h),b=g.transform,f,e;if(!b){b=g.transform={translateX:0,translateY:0,translateZ:0,scaleX:1,scaleY:1,scaleZ:1,rotate:0,rotateX:0,rotateY:0,rotateZ:0,skewX:0,skewY:0}}if(typeof d=="string"){switch(d){case"translate":if(a){f=h.length;if(f==0){break}b.translateX=h[0];if(f==1){break}b.translateY=h[1];if(f==2){break}b.translateZ=h[2]}else{b.translateX=h}break;case"rotate":if(a){f=h.length;if(f==0){break}b.rotateX=h[0];if(f==1){break}b.rotateY=h[1];if(f==2){break}b.rotateZ=h[2]}else{b.rotate=h}break;case"scale":if(a){f=h.length;if(f==0){break}b.scaleX=h[0];if(f==1){break}b.scaleY=h[1];if(f==2){break}b.scaleZ=h[2]}else{b.scaleX=h;b.scaleY=h}break;case"skew":if(a){f=h.length;if(f==0){break}b.skewX=h[0];if(f==1){break}b.skewY=h[1]}else{b.skewX=h}break;default:b[d]=h}}else{for(e in d){if(d.hasOwnProperty(e)){h=d[e];this.setTransform(e,h)}}}},set:function(a,e){var d=this.data,b;if(typeof a!="string"){for(b in a){e=a[b];if(b==="transform"){this.setTransform(e)}else{d[b]=e}}}else{if(a==="transform"){this.setTransform(e)}else{d[a]=e}}return this},unset:function(a){var b=this.data;if(b.hasOwnProperty(a)){delete b[a]}return this},getData:function(){return this.data}});Ext.define("Ext.fx.animation.Abstract",{extend:Ext.Evented,isAnimation:true,config:{name:"",element:null,before:null,from:{},to:{},after:null,states:{},duration:300,easing:"linear",iteration:1,direction:"normal",delay:0,onBeforeStart:null,onEnd:null,onBeforeEnd:null,scope:null,reverse:null,preserveEndState:false,replacePrevious:true},STATE_FROM:"0%",STATE_TO:"100%",DIRECTION_UP:"up",DIRECTION_DOWN:"down",DIRECTION_LEFT:"left",DIRECTION_RIGHT:"right",stateNameRegex:/^(?:[\d\.]+)%$/,constructor:function(){this.states={};this.callParent(arguments);return this},applyElement:function(a){return Ext.get(a)},applyBefore:function(a,b){if(a){return Ext.factory(a,Ext.fx.State,b)}},applyAfter:function(b,a){if(b){return Ext.factory(b,Ext.fx.State,a)}},setFrom:function(a){return this.setState(this.STATE_FROM,a)},setTo:function(a){return this.setState(this.STATE_TO,a)},getFrom:function(){return this.getState(this.STATE_FROM)},getTo:function(){return this.getState(this.STATE_TO)},setStates:function(a){var d=this.stateNameRegex,b;for(b in a){if(d.test(b)){this.setState(b,a[b])}}return this},getStates:function(){return this.states},stop:function(){this.fireEvent("stop",this)},destroy:function(){this.stop();this.callParent()},setState:function(b,e){var a=this.getStates(),d;d=Ext.factory(e,Ext.fx.State,a[b]);if(d){a[b]=d}return this},getState:function(a){return this.getStates()[a]},getData:function(){var m=this.getStates(),f={},h=this.getBefore(),d=this.getAfter(),j=m[this.STATE_FROM],k=m[this.STATE_TO],l=j.getData(),g=k.getData(),e,b,a;for(b in m){if(m.hasOwnProperty(b)){a=m[b];e=a.getData();f[b]=e}}if(Ext.browser.is.AndroidStock2){f["0.0001%"]=l}return{before:h?h.getData():{},after:d?d.getData():{},states:f,from:l,to:g,duration:this.getDuration(),iteration:this.getIteration(),direction:this.getDirection(),easing:this.getEasing(),delay:this.getDelay(),onEnd:this.getOnEnd(),onBeforeEnd:this.getOnBeforeEnd(),onBeforeStart:this.getOnBeforeStart(),scope:this.getScope(),preserveEndState:this.getPreserveEndState(),replacePrevious:this.getReplacePrevious()}}});Ext.define("Ext.fx.animation.Slide",{extend:Ext.fx.animation.Abstract,alternateClassName:"Ext.fx.animation.SlideIn",alias:["animation.slide","animation.slideIn"],config:{direction:"left",out:false,offset:0,easing:"auto",containerBox:"auto",elementBox:"auto",isElementBoxFit:true,useCssTransform:true},reverseDirectionMap:{up:"down",down:"up",left:"right",right:"left"},applyEasing:function(a){if(a==="auto"){return"ease-"+((this.getOut())?"in":"out")}return a},getContainerBox:function(){var a=this._containerBox;if(a==="auto"){a=this.getElement().getParent().getPageBox()}return a},getElementBox:function(){var a=this._elementBox;if(this.getIsElementBoxFit()){return this.getContainerBox()}if(a==="auto"){a=this.getElement().getPageBox()}return a},getData:function(){var r=this.getElementBox(),d=this.getContainerBox(),h=r?r:d,p=this.getFrom(),q=this.getTo(),g=this.getOut(),f=this.getOffset(),o=this.getDirection(),b=this.getUseCssTransform(),j=this.getReverse(),e=0,a=0,n,l,m,k;if(j){o=this.reverseDirectionMap[o]}switch(o){case this.DIRECTION_UP:if(g){a=d.top-h.top-h.height-f}else{a=d.bottom-h.bottom+h.height+f}break;case this.DIRECTION_DOWN:if(g){a=d.bottom-h.bottom+h.height+f}else{a=d.top-h.height-h.top-f}break;case this.DIRECTION_RIGHT:if(g){e=d.right-h.right+h.width+f}else{e=d.left-h.left-h.width-f}break;case this.DIRECTION_LEFT:if(g){e=d.left-h.left-h.width-f}else{e=d.right-h.right+h.width+f}break}n=(g)?0:e;l=(g)?0:a;if(b){p.setTransform({translateX:n,translateY:l})}else{p.set("left",n);p.set("top",l)}m=(g)?e:0;k=(g)?a:0;if(b){q.setTransform({translateX:m,translateY:k})}else{q.set("left",m);q.set("top",k)}return this.callParent(arguments)}});Ext.define("Ext.fx.animation.SlideOut",{extend:Ext.fx.animation.Slide,alias:["animation.slideOut"],config:{out:true}});Ext.define("Ext.fx.animation.Fade",{extend:Ext.fx.animation.Abstract,alternateClassName:"Ext.fx.animation.FadeIn",alias:["animation.fade","animation.fadeIn"],config:{out:false,before:{display:null,opacity:0},after:{opacity:null},reverse:null},updateOut:function(a){var d=this.getTo(),b=this.getFrom();if(a){b.set("opacity",1);d.set("opacity",0)}else{b.set("opacity",0);d.set("opacity",1)}}});Ext.define("Ext.fx.animation.FadeOut",{extend:Ext.fx.animation.Fade,alias:"animation.fadeOut",config:{out:true,before:{}}});Ext.define("Ext.fx.animation.Flip",{extend:Ext.fx.animation.Abstract,alias:"animation.flip",config:{easing:"ease-in",direction:"right",half:false,out:null},getData:function(){var j=this.getFrom(),k=this.getTo(),h=this.getDirection(),b=this.getOut(),n=this.getHalf(),d=(n)?90:180,f=1,a=1,m=0,l=0,g=0,e=0;if(b){a=0.8}else{f=0.8}switch(h){case this.DIRECTION_UP:if(b){g=d}else{m=-d}break;case this.DIRECTION_DOWN:if(b){g=-d}else{m=d}break;case this.DIRECTION_RIGHT:if(b){e=d}else{l=-d}break;case this.DIRECTION_LEFT:if(b){e=-d}else{l=d}break}j.setTransform({rotateX:m,rotateY:l,scale:f});k.setTransform({rotateX:g,rotateY:e,scale:a});return this.callParent(arguments)}});Ext.define("Ext.fx.animation.Pop",{extend:Ext.fx.animation.Abstract,alias:["animation.pop","animation.popIn"],alternateClassName:"Ext.fx.animation.PopIn",config:{out:false,before:{display:null,opacity:0},after:{opacity:null}},getData:function(){var d=this.getTo(),b=this.getFrom(),a=this.getOut();if(a){b.set("opacity",1);b.setTransform({scale:1});d.set("opacity",0);d.setTransform({scale:0})}else{b.set("opacity",0);b.setTransform({scale:0});d.set("opacity",1);d.setTransform({scale:1})}return this.callParent(arguments)}});Ext.define("Ext.fx.animation.PopOut",{extend:Ext.fx.animation.Pop,alias:"animation.popOut",config:{out:true,before:{}}});Ext.define("Ext.fx.Animation",{constructor:function(b){var a=Ext.fx.animation.Abstract,d;if(typeof b=="string"){d=b;b={}}else{if(b&&b.type){d=b.type}}if(d){if(Ext.browser.is.AndroidStock2){if(d=="pop"){d="fade"}if(d=="popIn"){d="fadeIn"}if(d=="popOut"){d="fadeOut"}}a=Ext.ClassManager.getByAlias("animation."+d)}return Ext.factory(b,a)}});Ext.define("Ext.fx.layout.card.Style",{extend:Ext.fx.layout.card.Abstract,config:{inAnimation:{before:{visibility:null},preserveEndState:false,replacePrevious:true},outAnimation:{preserveEndState:false,replacePrevious:true}},constructor:function(b){var d,a;this.initConfig(b);this.endAnimationCounter=0;d=this.getInAnimation();a=this.getOutAnimation();d.on("animationend","incrementEnd",this);a.on("animationend","incrementEnd",this)},updateDirection:function(a){this.getInAnimation().setDirection(a);this.getOutAnimation().setDirection(a)},updateDuration:function(a){this.getInAnimation().setDuration(a);this.getOutAnimation().setDuration(a)},updateReverse:function(a){this.getInAnimation().setReverse(a);this.getOutAnimation().setReverse(a)},incrementEnd:function(){this.endAnimationCounter++;if(this.endAnimationCounter>1){this.endAnimationCounter=0;this.fireEvent("animationend",this)}},applyInAnimation:function(b,a){return Ext.factory(b,Ext.fx.Animation,a)},applyOutAnimation:function(b,a){return Ext.factory(b,Ext.fx.Animation,a)},updateInAnimation:function(a){a.setScope(this)},updateOutAnimation:function(a){a.setScope(this)},onActiveItemChange:function(a,f,j,k,e){var b=this.getInAnimation(),h=this.getOutAnimation(),g,d;if(f&&j&&j.isPainted()){g=f.renderElement;d=j.renderElement;b.setElement(g);h.setElement(d);h.setOnBeforeEnd(function(l,m){if(m||Ext.Animator.hasRunningAnimations(l)){e.firingArguments[1]=null;e.firingArguments[2]=null}});h.setOnEnd(function(){e.resume()});g.dom.style.setProperty("visibility","hidden","important");f.show();Ext.Animator.run([h,b]);e.pause()}},destroy:function(){Ext.destroy(this.getInAnimation(),this.getOutAnimation());this.callParent(arguments)}});Ext.define("Ext.fx.layout.card.Slide",{extend:Ext.fx.layout.card.Style,alias:"fx.layout.card.slide",config:{inAnimation:{type:"slide",easing:"ease-out"},outAnimation:{type:"slide",easing:"ease-out",out:true}},updateReverse:function(a){this.getInAnimation().setReverse(a);this.getOutAnimation().setReverse(a)}});Ext.define("Ext.fx.layout.card.Cover",{extend:Ext.fx.layout.card.Style,alias:"fx.layout.card.cover",config:{reverse:null,inAnimation:{before:{"z-index":100},after:{"z-index":0},type:"slide",easing:"ease-out"},outAnimation:{easing:"ease-out",from:{opacity:0.99},to:{opacity:1},out:true}},updateReverse:function(a){this.getInAnimation().setReverse(a);this.getOutAnimation().setReverse(a)}});Ext.define("Ext.fx.layout.card.Reveal",{extend:Ext.fx.layout.card.Style,alias:"fx.layout.card.reveal",config:{inAnimation:{easing:"ease-out",from:{opacity:0.99},to:{opacity:1}},outAnimation:{before:{"z-index":100},after:{"z-index":0},type:"slide",easing:"ease-out",out:true}},updateReverse:function(a){this.getInAnimation().setReverse(a);this.getOutAnimation().setReverse(a)}});Ext.define("Ext.fx.layout.card.Fade",{extend:Ext.fx.layout.card.Style,alias:"fx.layout.card.fade",config:{reverse:null,inAnimation:{type:"fade",easing:"ease-out"},outAnimation:{type:"fade",easing:"ease-out",out:true}}});Ext.define("Ext.fx.layout.card.Flip",{extend:Ext.fx.layout.card.Style,alias:"fx.layout.card.flip",config:{duration:500,inAnimation:{type:"flip",half:true,easing:"ease-out",before:{"backface-visibility":"hidden"},after:{"backface-visibility":null}},outAnimation:{type:"flip",half:true,easing:"ease-in",before:{"backface-visibility":"hidden"},after:{"backface-visibility":null},out:true}},onActiveItemChange:function(f,d,g,b,a){var e=d.element.getParent();e.addCls("x-layout-card-perspective");this.on("animationend",function(){e.removeCls("x-layout-card-perspective")},this,{single:true});this.callParent(arguments)},updateDuration:function(e){var d=e/2,b=this.getInAnimation(),a=this.getOutAnimation();b.setDelay(d);b.setDuration(d);a.setDuration(d)}});Ext.define("Ext.fx.layout.card.Pop",{extend:Ext.fx.layout.card.Style,alias:"fx.layout.card.pop",config:{duration:500,inAnimation:{type:"pop",easing:"ease-out"},outAnimation:{type:"pop",easing:"ease-in",out:true}},updateDuration:function(e){var d=e/2,b=this.getInAnimation(),a=this.getOutAnimation();b.setDelay(d);b.setDuration(d);a.setDuration(d)}});Ext.define("Ext.fx.layout.card.Scroll",{extend:Ext.fx.layout.card.Abstract,alias:"fx.layout.card.scroll",config:{duration:150},constructor:function(a){this.initConfig(a)},getEasing:function(){var a=this.easing;if(!a){this.easing=a=new Ext.fx.easing.Linear()}return a},updateDuration:function(a){this.getEasing().setDuration(a)},onActiveItemChange:function(a,e,n,o,d){var k=this.getDirection(),h=this.getEasing(),m,f,b,j,l,g;if(e&&n){if(this.isAnimating){this.stopAnimation()}e.setWidth("100%");e.setHeight("100%");m=this.getLayout().container.innerElement;j=m.getWidth();l=m.getHeight();f=e.renderElement;b=n.renderElement;this.oldItem=n;this.newItem=e;this.currentEventController=d;this.containerElement=m;this.isReverse=g=this.getReverse();e.show();if(k=="right"){k="left";this.isReverse=g=!g}else{if(k=="down"){k="up";this.isReverse=g=!g}}if(k=="left"){if(g){h.setConfig({startValue:j,endValue:0});m.dom.scrollLeft=j;b.setLeft(j)}else{h.setConfig({startValue:0,endValue:j});f.setLeft(j)}}else{if(g){h.setConfig({startValue:l,endValue:0});m.dom.scrollTop=l;b.setTop(l)}else{h.setConfig({startValue:0,endValue:l});f.setTop(l)}}this.startAnimation();d.pause()}},startAnimation:function(){this.isAnimating=true;this.getEasing().setStartTime(Date.now());Ext.AnimationQueue.start(this.doAnimationFrame,this)},doAnimationFrame:function(){var e=this.getEasing(),d=this.getDirection(),a="scrollTop",b;if(d=="left"||d=="right"){a="scrollLeft"}if(e.isEnded){this.stopAnimation()}else{b=e.getValue();this.containerElement.dom[a]=b}},stopAnimation:function(){var d=this,f=d.getDirection(),a="setTop",e=d.oldItem,b=d.newItem;if(f=="left"||f=="right"){a="setLeft"}d.currentEventController.resume();if(d.isReverse&&e&&e.renderElement&&e.renderElement.dom){e.renderElement[a](null)}else{if(b&&b.renderElement&&b.renderElement.dom){b.renderElement[a](null)}}Ext.AnimationQueue.stop(this.doAnimationFrame,this);d.isAnimating=false;d.fireEvent("animationend",d)}});Ext.define("Ext.fx.layout.Card",{constructor:function(b){var a=Ext.fx.layout.card.Abstract,d;if(!b){return null}if(typeof b=="string"){d=b;b={}}else{if(b.type){d=b.type}}b.elementBox=false;if(d){if(Ext.browser.is.AndroidStock2){if(d!="fade"){d="scroll"}}a=Ext.ClassManager.getByAlias("fx.layout.card."+d)}return Ext.factory(b,a)}});Ext.define("Ext.layout.Card",{extend:Ext.layout.Default,alias:"layout.card",isCard:true,layoutClass:"x-layout-card",itemClass:"x-layout-card-item",applyAnimation:function(a){return new Ext.fx.layout.Card(a)},updateAnimation:function(b,a){if(b&&b.isAnimation){b.setLayout(this)}if(a){a.destroy()}},setContainer:function(a){this.callSuper(arguments);a.innerElement.addCls(this.layoutClass);a.onInitialized("onContainerInitialized",this)},onContainerInitialized:function(){var a=this.container,b=a.getInnerAt(0),d=a.getActiveItem();if(d){d.show();if(b&&b!==d){b.hide()}}a.on("activeitemchange","onContainerActiveItemChange",this)},onContainerActiveItemChange:function(a){this.relayEvent(arguments,"doActiveItemChange")},onItemInnerStateChange:function(d,b,e){this.callSuper(arguments);var a=this.container,f=a.getActiveItem();d.toggleCls(this.itemClass,b);d.setLayoutSizeFlags(b?a.LAYOUT_BOTH:0);if(b){if(f!==a.innerIndexOf(d)&&f!==d&&d!==a.pendingActiveItem){d.hide()}}else{if(!e&&!d.isDestroyed&&d.isDestroying!==true){d.show()}}},doActiveItemChange:function(b,d,a){if(a){a.hide()}if(d){d.show()}},destroy:function(){this.callParent(arguments);Ext.destroy(this.getAnimation())}});Ext.define("Ext.layout.Box",{extend:Ext.layout.Default,config:{orient:"horizontal",align:"start",pack:"start"},alias:"layout.tablebox",layoutBaseClass:"x-layout-tablebox",itemClass:"x-layout-tablebox-item",setContainer:function(a){this.callSuper(arguments);a.innerElement.addCls(this.layoutBaseClass);a.on("flexchange","onItemFlexChange",this,{delegate:"> component"})},onItemInnerStateChange:function(b,a){this.callSuper(arguments);b.toggleCls(this.itemClass,a)},onItemFlexChange:function(){}});Ext.define("Ext.layout.FlexBox",{extend:Ext.layout.Box,alias:"layout.box",config:{align:"stretch"},layoutBaseClass:"x-layout-box",itemClass:"x-layout-box-item",setContainer:function(a){this.callSuper(arguments);this.monitorSizeFlagsChange()},applyOrient:function(a){return a},updateOrient:function(d,b){var a=this.container,e={delegate:"> component"};if(d==="horizontal"){this.sizePropertyName="width"}else{this.sizePropertyName="height"}a.innerElement.swapCls("x-"+d,"x-"+b);if(b){a.un(b==="horizontal"?"widthchange":"heightchange","onItemSizeChange",this,e);this.redrawContainer()}a.on(d==="horizontal"?"widthchange":"heightchange","onItemSizeChange",this,e)},onItemInnerStateChange:function(e,d){this.callSuper(arguments);var a,b;e.toggleCls(this.itemClass,d);if(d){a=e.getFlex();b=e.get(this.sizePropertyName);if(a){this.doItemFlexChange(e,a)}else{if(b){this.doItemSizeChange(e,b)}}}this.refreshItemSizeState(e)},refreshItemSizeState:function(f){var d=f.isInnerItem(),a=this.container,g=a.LAYOUT_HEIGHT,e=a.LAYOUT_WIDTH,h=this.sizePropertyName,b=0,j=a.getSizeFlags();if(d){b|=a.LAYOUT_STRETCHED;if(this.getAlign()==="stretch"){b|=j&(h==="width"?g:e)}if(f.getFlex()){b|=j&(h==="width"?e:g)}}f.setLayoutSizeFlags(b)},refreshAllItemSizedStates:function(){var e=this.container.innerItems,a,d,b;for(a=0,d=e.length;a<d;a++){b=e[a];this.refreshItemSizeState(b)}},onContainerSizeFlagsChange:function(){this.refreshAllItemSizedStates();this.callSuper(arguments)},onItemSizeChange:function(b,a){if(b.isInnerItem()){this.doItemSizeChange(b,a)}},doItemSizeChange:function(b,a){if(a){b.setFlex(null);this.redrawContainer()}},onItemFlexChange:function(b,a){if(b.isInnerItem()){this.doItemFlexChange(b,a);this.refreshItemSizeState(b)}},doItemFlexChange:function(b,a){this.setItemFlex(b,a);if(a){b.set(this.sizePropertyName,null)}else{this.redrawContainer()}},redrawContainer:function(){var a=this.container,b=a.element.dom.parentNode;if(b&&b.nodeType!==11){a.innerElement.redraw()}},setItemFlex:function(d,a){var b=d.element;b.toggleCls("x-flexed",!!a);if(!a){a=""}else{a=String(a)}if(Ext.browser.is.WebKit){b.dom.style.setProperty("-webkit-box-flex",a,null)}else{if(Ext.browser.is.IE){b.dom.style.setProperty("-ms-flex",a+" 0 0px",null)}else{b.dom.style.setProperty("flex",a+" 0 0px",null)}}},convertPosition:function(a){var b=this.positionMap;if(b.hasOwnProperty(a)){return b[a]}return a},applyAlign:function(a){return this.convertPosition(a)},updateAlign:function(d,b){var a=this.container;a.innerElement.swapCls(d,b,true,"x-align");if(b!==undefined){this.refreshAllItemSizedStates()}},applyPack:function(a){return this.convertPosition(a)},updatePack:function(a,b){this.container.innerElement.swapCls(a,b,true,"x-pack")}});Ext.define("Ext.layout.HBox",{extend:Ext.layout.FlexBox,alias:"layout.hbox"});Ext.define("Ext.layout.VBox",{extend:Ext.layout.FlexBox,alias:"layout.vbox",config:{orient:"vertical"}});Ext.define("Ext.util.Filter",{isFilter:true,config:{property:null,value:null,filterFn:Ext.emptyFn,anyMatch:false,exactMatch:false,caseSensitive:false,root:null,id:undefined,scope:null},applyId:function(a){if(!a){if(this.getProperty()){a=this.getProperty()+"-"+String(this.getValue())}if(!a){a=Ext.id(null,"ext-filter-")}}return a},constructor:function(a){this.initConfig(a)},applyFilterFn:function(b){if(b===Ext.emptyFn){b=this.getInitialConfig("filter");if(b){return b}var a=this.getValue();if(!this.getProperty()&&!a&&a!==0){return Ext.emptyFn}else{return this.createFilterFn()}}return b},createFilterFn:function(){var a=this,b=a.createValueMatcher();return function(e){var d=a.getRoot(),f=a.getProperty();if(d){e=e[d]}return b.test(e[f])}},createValueMatcher:function(){var e=this,f=e.getValue(),g=e.getAnyMatch(),d=e.getExactMatch(),a=e.getCaseSensitive(),b=Ext.String.escapeRegex;if(f===null||f===undefined||!f.exec){f=String(f);if(g===true){f=b(f)}else{f="^"+b(f);if(d===true){f+="$"}}f=new RegExp(f,a?"":"i")}return f}});Ext.define("Ext.util.AbstractMixedCollection",{mixins:{observable:Ext.mixin.Observable},constructor:function(b,a){var d=this;d.items=[];d.map={};d.keys=[];d.length=0;d.allowFunctions=b===true;if(a){d.getKey=a}d.mixins.observable.constructor.call(d)},allowFunctions:false,add:function(b,f){var e=this,g=f,d=b,a;if(arguments.length==1){g=d;d=e.getKey(g)}if(typeof d!="undefined"&&d!==null){a=e.map[d];if(typeof a!="undefined"){return e.replace(d,g)}e.map[d]=g}e.length++;e.items.push(g);e.keys.push(d);e.fireEvent("add",e.length-1,g,d);return g},getKey:function(a){return a.id},replace:function(d,f){var e=this,a,b;if(arguments.length==1){f=arguments[0];d=e.getKey(f)}a=e.map[d];if(typeof d=="undefined"||d===null||typeof a=="undefined"){return e.add(d,f)}b=e.indexOfKey(d);e.items[b]=f;e.map[d]=f;e.fireEvent("replace",d,a,f);return f},addAll:function(g){var f=this,e=0,b,a,d;if(arguments.length>1||Ext.isArray(g)){b=arguments.length>1?arguments:g;for(a=b.length;e<a;e++){f.add(b[e])}}else{for(d in g){if(g.hasOwnProperty(d)){if(f.allowFunctions||typeof g[d]!="function"){f.add(d,g[d])}}}}},each:function(f,e){var b=[].concat(this.items),d=0,a=b.length,g;for(;d<a;d++){g=b[d];if(f.call(e||g,g,d,a)===false){break}}},eachKey:function(f,e){var g=this.keys,b=this.items,d=0,a=g.length;for(;d<a;d++){f.call(e||window,g[d],b[d],d,a)}},findBy:function(f,e){var g=this.keys,b=this.items,d=0,a=b.length;for(;d<a;d++){if(f.call(e||window,b[d],g[d])){return b[d]}}return null},insert:function(a,b,f){var e=this,d=b,g=f;if(arguments.length==2){g=d;d=e.getKey(g)}if(e.containsKey(d)){e.suspendEvents();e.removeAtKey(d);e.resumeEvents()}if(a>=e.length){return e.add(d,g)}e.length++;Ext.Array.splice(e.items,a,0,g);if(typeof d!="undefined"&&d!==null){e.map[d]=g}Ext.Array.splice(e.keys,a,0,d);e.fireEvent("add",a,g,d);return g},remove:function(a){return this.removeAt(this.indexOf(a))},removeAll:function(a){Ext.each(a||[],function(b){this.remove(b)},this);return this},removeAt:function(a){var d=this,e,b;if(a<d.length&&a>=0){d.length--;e=d.items[a];Ext.Array.erase(d.items,a,1);b=d.keys[a];if(typeof b!="undefined"){delete d.map[b]}Ext.Array.erase(d.keys,a,1);d.fireEvent("remove",e,b);return e}return false},removeAtKey:function(a){return this.removeAt(this.indexOfKey(a))},getCount:function(){return this.length},indexOf:function(a){return Ext.Array.indexOf(this.items,a)},indexOfKey:function(a){return Ext.Array.indexOf(this.keys,a)},get:function(b){var e=this,a=e.map[b],d=a!==undefined?a:(typeof b=="number")?e.items[b]:undefined;return typeof d!="function"||e.allowFunctions?d:null},getAt:function(a){return this.items[a]},getByKey:function(a){return this.map[a]},contains:function(a){return Ext.Array.contains(this.items,a)},containsKey:function(a){return typeof this.map[a]!="undefined"},clear:function(){var a=this;a.length=0;a.items=[];a.keys=[];a.map={};a.fireEvent("clear")},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},sum:function(h,b,j,a){var d=this.extractValues(h,b),g=d.length,f=0,e;j=j||0;a=(a||a===0)?a:g-1;for(e=j;e<=a;e++){f+=d[e]}return f},collect:function(k,f,h){var l=this.extractValues(k,f),a=l.length,b={},d=[],j,g,e;for(e=0;e<a;e++){j=l[e];g=String(j);if((h||!Ext.isEmpty(j))&&!b[g]){b[g]=true;d.push(j)}}return d},extractValues:function(d,a){var b=this.items;if(a){b=Ext.Array.pluck(b,a)}return Ext.Array.pluck(b,d)},getRange:function(g,a){var f=this,d=f.items,b=[],e;if(d.length<1){return b}g=g||0;a=Math.min(typeof a=="undefined"?f.length-1:a,f.length-1);if(g<=a){for(e=g;e<=a;e++){b[b.length]=d[e]}}else{for(e=g;e>=a;e--){b[b.length]=d[e]}}return b},filter:function(e,d,g,a){var b=[],f;if(Ext.isString(e)){b.push(Ext.create("Ext.util.Filter",{property:e,value:d,anyMatch:g,caseSensitive:a}))}else{if(Ext.isArray(e)||e instanceof Ext.util.Filter){b=b.concat(e)}}f=function(h){var n=true,o=b.length,j;for(j=0;j<o;j++){var m=b[j],l=m.getFilterFn(),k=m.getScope();n=n&&l.call(k,h)}return n};return this.filterBy(f)},filterBy:function(f,e){var j=this,a=new this.self(),h=j.keys,b=j.items,g=b.length,d;a.getKey=j.getKey;for(d=0;d<g;d++){if(f.call(e||j,b[d],h[d])){a.add(h[d],b[d])}}return a},findIndex:function(d,b,f,e,a){if(Ext.isEmpty(b,false)){return -1}b=this.createValueMatcher(b,e,a);return this.findIndexBy(function(g){return g&&b.test(g[d])},null,f)},findIndexBy:function(f,e,j){var h=this,g=h.keys,b=h.items,d=j||0,a=b.length;for(;d<a;d++){if(f.call(e||h,b[d],g[d])){return d}}return -1},createValueMatcher:function(d,f,a,b){if(!d.exec){var e=Ext.String.escapeRegex;d=String(d);if(f===true){d=e(d)}else{d="^"+e(d);if(b===true){d+="$"}}d=new RegExp(d,a?"":"i")}return d},clone:function(){var f=this,g=new this.self(),e=f.keys,b=f.items,d=0,a=b.length;for(;d<a;d++){g.add(e[d],b[d])}g.getKey=f.getKey;return g}});Ext.define("Ext.util.Sorter",{isSorter:true,config:{property:null,sorterFn:null,root:null,transform:null,direction:"ASC",id:undefined},constructor:function(a){this.initConfig(a)},applyId:function(a){if(!a){a=this.getProperty();if(!a){a=Ext.id(null,"ext-sorter-")}}return a},createSortFunction:function(b){var d=this,a=d.getDirection().toUpperCase()=="DESC"?-1:1;return function(f,e){return a*b.call(d,f,e)}},defaultSortFn:function(f,d){var h=this,g=h._transform,b=h._root,e,a,j=h._property;if(b!==null&&b!==undefined){f=f[b];d=d[b]}e=f[j];a=d[j];if(g){e=g(e);a=g(a)}return e>a?1:(e<a?-1:0)},updateDirection:function(){this.updateSortFn()},updateSortFn:function(){this.sort=this.createSortFunction(this.getSorterFn()||this.defaultSortFn)},toggle:function(){this.setDirection(Ext.String.toggle(this.getDirection(),"ASC","DESC"))}});Ext.define("Ext.util.Sortable",{extend:Ext.mixin.Mixin,isSortable:true,mixinConfig:{hooks:{destroy:"destroy"}},defaultSortDirection:"ASC",initSortable:function(){var a=this,b=a.sorters;a.sorters=Ext.create("Ext.util.AbstractMixedCollection",false,function(d){return d.id||d.property});if(b){a.sorters.addAll(a.decodeSorters(b))}},sort:function(h,g,d,f){var e=this,j,b,a;if(Ext.isArray(h)){f=d;d=g;a=h}else{if(Ext.isObject(h)){f=d;d=g;a=[h]}else{if(Ext.isString(h)){j=e.sorters.get(h);if(!j){j={property:h,direction:g};a=[j]}else{if(g===undefined){j.toggle()}else{j.setDirection(g)}}}}}if(a&&a.length){a=e.decodeSorters(a);if(Ext.isString(d)){if(d==="prepend"){h=e.sorters.clone().items;e.sorters.clear();e.sorters.addAll(a);e.sorters.addAll(h)}else{e.sorters.addAll(a)}}else{e.sorters.clear();e.sorters.addAll(a)}if(f!==false){e.onBeforeSort(a)}}if(f!==false){h=e.sorters.items;if(h.length){b=function(m,l){var k=h[0].sort(m,l),o=h.length,n;for(n=1;n<o;n++){k=k||h[n].sort.call(this,m,l)}return k};e.doSort(b)}}return h},onBeforeSort:Ext.emptyFn,decodeSorters:function(g){if(!Ext.isArray(g)){if(g===undefined){g=[]}else{g=[g]}}var e=g.length,h=Ext.util.Sorter,a=this.model?this.model.prototype.fields:null,f,b,d;for(d=0;d<e;d++){b=g[d];if(!(b instanceof h)){if(Ext.isString(b)){b={property:b}}Ext.applyIf(b,{root:this.sortRoot,direction:"ASC"});if(b.fn){b.sorterFn=b.fn}if(typeof b=="function"){b={sorterFn:b}}if(a&&!b.transform){f=a.get(b.property);b.transform=f?f.sortType:undefined}g[d]=Ext.create("Ext.util.Sorter",b)}}return g},getSorters:function(){return this.sorters.items},destroy:function(){this.callSuper();Ext.destroy(this.sorters)}});Ext.define("Ext.util.MixedCollection",{extend:Ext.util.AbstractMixedCollection,mixins:{sortable:Ext.util.Sortable},constructor:function(){var a=this;a.callParent(arguments);a.mixins.sortable.initSortable.call(a)},doSort:function(a){this.sortBy(a)},_sort:function(k,a,j){var h=this,d,e,b=String(a).toUpperCase()=="DESC"?-1:1,g=[],l=h.keys,f=h.items;j=j||function(n,m){return n-m};for(d=0,e=f.length;d<e;d++){g[g.length]={key:l[d],value:f[d],index:d}}Ext.Array.sort(g,function(n,m){var o=j(n[k],m[k])*b;if(o===0){o=(n.index<m.index?-1:1)}return o});for(d=0,e=g.length;d<e;d++){f[d]=g[d].value;l[d]=g[d].key}h.fireEvent("sort",h)},sortBy:function(d){var h=this,b=h.items,g=h.keys,f=b.length,a=[],e;for(e=0;e<f;e++){a[e]={key:g[e],value:b[e],index:e}}Ext.Array.sort(a,function(k,j){var l=d(k.value,j.value);if(l===0){l=(k.index<j.index?-1:1)}return l});for(e=0;e<f;e++){b[e]=a[e].value;g[e]=a[e].key}h.fireEvent("sort",h,b,g)},reorder:function(e){var h=this,b=h.items,d=0,g=b.length,a=[],f=[],j;h.suspendEvents();for(j in e){a[e[j]]=b[j]}for(d=0;d<g;d++){if(e[d]==undefined){f.push(b[d])}}for(d=0;d<g;d++){if(a[d]==undefined){a[d]=f.shift()}}h.clear();h.addAll(a);h.resumeEvents();h.fireEvent("sort",h)},sortByKey:function(a,b){this._sort("key",a,b||function(e,d){var g=String(e).toUpperCase(),f=String(d).toUpperCase();return g>f?1:(g<f?-1:0)})}});Ext.define("Ext.ItemCollection",{extend:Ext.util.MixedCollection,getKey:function(a){return a.getItemId()},has:function(a){return this.map.hasOwnProperty(a.getId())}});Ext.define("Ext.fx.easing.Momentum",{extend:Ext.fx.easing.Abstract,config:{acceleration:30,friction:0,startVelocity:0},alpha:0,updateFriction:function(b){var a=Math.log(1-(b/10));this.theta=a;this.alpha=a/this.getAcceleration()},updateStartVelocity:function(a){this.velocity=a*this.getAcceleration()},updateAcceleration:function(a){this.velocity=this.getStartVelocity()*a;this.alpha=this.theta/a},getValue:function(){return this.getStartValue()-this.velocity*(1-this.getFrictionFactor())/this.theta},getFrictionFactor:function(){var a=Ext.Date.now()-this.getStartTime();return Math.exp(a*this.alpha)},getVelocity:function(){return this.getFrictionFactor()*this.velocity}});Ext.define("Ext.fx.easing.Bounce",{extend:Ext.fx.easing.Abstract,config:{springTension:0.3,acceleration:30,startVelocity:0},getValue:function(){var b=Ext.Date.now()-this.getStartTime(),d=(b/this.getAcceleration()),a=d*Math.pow(Math.E,-this.getSpringTension()*d);return this.getStartValue()+(this.getStartVelocity()*a)}});Ext.define("Ext.fx.easing.BoundMomentum",{extend:Ext.fx.easing.Abstract,config:{momentum:null,bounce:null,minMomentumValue:0,maxMomentumValue:0,minVelocity:0.01,startVelocity:0},applyMomentum:function(a,b){return Ext.factory(a,Ext.fx.easing.Momentum,b)},applyBounce:function(a,b){return Ext.factory(a,Ext.fx.easing.Bounce,b)},updateStartTime:function(a){this.getMomentum().setStartTime(a);this.callParent(arguments)},updateStartVelocity:function(a){this.getMomentum().setStartVelocity(a)},updateStartValue:function(a){this.getMomentum().setStartValue(a)},reset:function(){this.lastValue=null;this.isBouncingBack=false;this.isOutOfBound=false;return this.callParent(arguments)},getValue:function(){var a=this.getMomentum(),l=this.getBounce(),f=a.getStartVelocity(),g=f>0?1:-1,h=this.getMinMomentumValue(),e=this.getMaxMomentumValue(),d=(g==1)?e:h,j=this.lastValue,k,b;if(f===0){return this.getStartValue()}if(!this.isOutOfBound){k=a.getValue();b=a.getVelocity();if(Math.abs(b)<this.getMinVelocity()){this.isEnded=true}if(k>=h&&k<=e){return k}this.isOutOfBound=true;l.setStartTime(Ext.Date.now()).setStartVelocity(b).setStartValue(d)}k=l.getValue();if(!this.isEnded){if(!this.isBouncingBack){if(j!==null){if((g==1&&k<j)||(g==-1&&k>j)){this.isBouncingBack=true}}}else{if(Math.round(k)==d){this.isEnded=true}}}this.lastValue=k;return k}});Ext.define("Ext.fx.easing.EaseOut",{extend:Ext.fx.easing.Linear,alias:"easing.ease-out",config:{exponent:4,duration:1500},getValue:function(){var g=Ext.Date.now()-this.getStartTime(),e=this.getDuration(),b=this.getStartValue(),j=this.getEndValue(),a=this.distance,d=g/e,h=1-d,f=1-Math.pow(h,this.getExponent()),k=b+(f*a);if(g>=e){this.isEnded=true;return j}return k}});Ext.define("Ext.scroll.Scroller",{extend:Ext.Evented,config:{element:null,direction:"auto",fps:"auto",disabled:null,directionLock:false,momentumEasing:{momentum:{acceleration:30,friction:0.5},bounce:{acceleration:30,springTension:0.3},minVelocity:1},bounceEasing:{duration:400},outOfBoundRestrictFactor:0.5,startMomentumResetTime:300,maxAbsoluteVelocity:6,containerSize:"auto",size:"auto",autoRefresh:true,initialOffset:{x:0,y:0},slotSnapSize:{x:0,y:0},slotSnapOffset:{x:0,y:0},slotSnapEasing:{duration:150},translatable:{translationMethod:"auto",useWrapper:false}},cls:Ext.baseCSSPrefix+"scroll-scroller",containerCls:Ext.baseCSSPrefix+"scroll-container",dragStartTime:0,dragEndTime:0,isDragging:false,isAnimating:false,constructor:function(a){var b=a&&a.element;this.listeners={scope:this,touchstart:"onTouchStart",touchend:"onTouchEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd"};this.minPosition={x:0,y:0};this.startPosition={x:0,y:0};this.position={x:0,y:0};this.velocity={x:0,y:0};this.isAxisEnabledFlags={x:false,y:false};this.flickStartPosition={x:0,y:0};this.flickStartTime={x:0,y:0};this.lastDragPosition={x:0,y:0};this.dragDirection={x:0,y:0};this.initialConfig=a;if(b){this.setElement(b)}return this},applyElement:function(a){if(!a){return}return Ext.get(a)},updateElement:function(a){this.initialize();if(!this.FixedHBoxStretching){a.addCls(this.cls)}if(!this.getDisabled()){this.attachListeneners()}this.onConfigUpdate(["containerSize","size"],"refreshMaxPosition");this.on("maxpositionchange","snapToBoundary");this.on("minpositionchange","snapToBoundary");return this},applyTranslatable:function(b,a){return Ext.factory(b,Ext.util.Translatable,a)},updateTranslatable:function(a){a.setConfig({element:this.getElement(),listeners:{animationframe:"onAnimationFrame",animationend:"onAnimationEnd",scope:this}})},updateFps:function(a){if(a!=="auto"){this.getTranslatable().setFps(a)}},attachListeneners:function(){this.getContainer().on(this.listeners)},detachListeners:function(){this.getContainer().un(this.listeners)},updateDisabled:function(a){if(a){this.detachListeners()}else{this.attachListeneners()}},updateInitialOffset:function(d){if(typeof d=="number"){d={x:d,y:d}}var b=this.position,a,e;b.x=a=d.x;b.y=e=d.y;this.getTranslatable().translate(-a,-e)},applyDirection:function(a){var f=this.getMinPosition(),e=this.getMaxPosition(),d,b;this.givenDirection=a;if(a==="auto"){d=e.x>f.x;b=e.y>f.y;if(d&&b){a="both"}else{if(d){a="horizontal"}else{a="vertical"}}}return a},updateDirection:function(g,f){var b=this.isAxisEnabledFlags,e=this.cls+"-vertical",a=this.cls+"-horizontal",d=this.getElement();if(f==="both"||f==="horizontal"){d.removeCls(a)}if(f==="both"||f==="vertical"){d.removeCls(e)}b.x=b.y=false;if(g==="both"||g==="horizontal"){b.x=true;d.addCls(a)}if(g==="both"||g==="vertical"){b.y=true;d.addCls(e)}},isAxisEnabled:function(a){this.getDirection();return this.isAxisEnabledFlags[a]},applyMomentumEasing:function(b){var a=Ext.fx.easing.BoundMomentum;return{x:Ext.factory(b,a),y:Ext.factory(b,a)}},applyBounceEasing:function(b){var a=Ext.fx.easing.EaseOut;return{x:Ext.factory(b,a),y:Ext.factory(b,a)}},updateBounceEasing:function(a){this.getTranslatable().setEasingX(a.x).setEasingY(a.y)},applySlotSnapEasing:function(b){var a=Ext.fx.easing.EaseOut;return{x:Ext.factory(b,a),y:Ext.factory(b,a)}},getMinPosition:function(){var a=this.minPosition;if(!a){this.minPosition=a={x:0,y:0};this.fireEvent("minpositionchange",this,a)}return a},getMaxPosition:function(){var d=this.maxPosition,a,b;if(!d){a=this.getSize();b=this.getContainerSize();this.maxPosition=d={x:Math.max(0,a.x-b.x),y:Math.max(0,a.y-b.y)};this.fireEvent("maxpositionchange",this,d)}return d},refreshMaxPosition:function(){this.maxPosition=null;this.getMaxPosition()},applyContainerSize:function(b){var d=this.getContainer().dom,a,e;if(!d){return}this.givenContainerSize=b;if(b==="auto"){a=d.offsetWidth;e=d.offsetHeight}else{a=b.x;e=b.y}return{x:a,y:e}},applySize:function(b){var d=this.getElement().dom,a,e;if(!d){return}this.givenSize=b;if(b==="auto"){a=d.offsetWidth;e=d.offsetHeight}else{if(typeof b=="number"){a=b;e=b}else{a=b.x;e=b.y}}return{x:a,y:e}},updateAutoRefresh:function(a){this.getElement().toggleListener(a,"resize","onElementResize",this);this.getContainer().toggleListener(a,"resize","onContainerResize",this)},applySlotSnapSize:function(a){if(typeof a=="number"){return{x:a,y:a}}return a},applySlotSnapOffset:function(a){if(typeof a=="number"){return{x:a,y:a}}return a},getContainer:function(){var a=this.container,b;if(!a){b=this.getElement().getParent();this.container=a=this.FixedHBoxStretching?b.getParent():b;a.addCls(this.containerCls)}return a},refresh:function(){this.stopAnimation();this.getTranslatable().refresh();this.setSize(this.givenSize);this.setContainerSize(this.givenContainerSize);this.setDirection(this.givenDirection);this.fireEvent("refresh",this);return this},onElementResize:function(a,b){this.setSize({x:b.width,y:b.height});this.refresh()},onContainerResize:function(a,b){this.setContainerSize({x:b.width,y:b.height});this.refresh()},scrollTo:function(d,j,h){if(this.isDestroyed){return this}var b=this.getTranslatable(),a=this.position,e=false,g,f;if(this.isAxisEnabled("x")){if(isNaN(d)||typeof d!="number"){d=a.x}else{if(a.x!==d){a.x=d;e=true}}g=-d}if(this.isAxisEnabled("y")){if(isNaN(j)||typeof j!="number"){j=a.y}else{if(a.y!==j){a.y=j;e=true}}f=-j}if(e){if(h!==undefined&&h!==false){b.translateAnimated(g,f,h)}else{this.fireEvent("scroll",this,a.x,a.y);b.translate(g,f)}}return this},scrollToTop:function(b){var a=this.getInitialOffset();return this.scrollTo(a.x,a.y,b)},scrollToEnd:function(d){var b=this.getSize(),a=this.getContainerSize();return this.scrollTo(b.x-a.x,b.y-a.y,d)},scrollBy:function(b,e,d){var a=this.position;b=(typeof b=="number")?b+a.x:null;e=(typeof e=="number")?e+a.y:null;return this.scrollTo(b,e,d)},onTouchStart:function(){this.isTouching=true;this.stopAnimation()},onTouchEnd:function(){var a=this.position;this.isTouching=false;if(!this.isDragging&&this.snapToSlot()){this.fireEvent("scrollstart",this,a.x,a.y)}},onDragStart:function(n){var q=this.getDirection(),h=n.absDeltaX,g=n.absDeltaY,l=this.getDirectionLock(),k=this.startPosition,f=this.flickStartPosition,m=this.flickStartTime,j=this.lastDragPosition,d=this.position,b=this.dragDirection,p=d.x,o=d.y,a=Ext.Date.now();this.isDragging=true;if(l&&q!=="both"){if((q==="horizontal"&&h>g)||(q==="vertical"&&g>h)){n.stopPropagation()}else{this.isDragging=false;return}}j.x=p;j.y=o;f.x=p;f.y=o;k.x=p;k.y=o;m.x=a;m.y=a;b.x=0;b.y=0;this.dragStartTime=a;this.isDragging=true;this.fireEvent("scrollstart",this,p,o)},onAxisDrag:function(k,s){if(!this.isAxisEnabled(k)){return}var j=this.flickStartPosition,n=this.flickStartTime,l=this.lastDragPosition,f=this.dragDirection,h=this.position[k],m=this.getMinPosition()[k],q=this.getMaxPosition()[k],e=this.startPosition[k],r=l[k],p=e-s,d=f[k],o=this.getOutOfBoundRestrictFactor(),g=this.getStartMomentumResetTime(),b=Ext.Date.now(),a;if(p<m){p*=o}else{if(p>q){a=p-q;p=q+a*o}}if(p>r){f[k]=1}else{if(p<r){f[k]=-1}}if((d!==0&&(f[k]!==d))||(b-n[k])>g){j[k]=h;n[k]=b}l[k]=p},onDrag:function(b){if(!this.isDragging){return}var a=this.lastDragPosition;this.onAxisDrag("x",b.deltaX);this.onAxisDrag("y",b.deltaY);this.scrollTo(a.x,a.y)},onDragEnd:function(d){var b,a;if(!this.isDragging){return}this.dragEndTime=Ext.Date.now();this.onDrag(d);this.isDragging=false;b=this.getAnimationEasing("x",d);a=this.getAnimationEasing("y",d);if(b||a){this.getTranslatable().animate(b,a)}else{this.onScrollEnd()}},getAnimationEasing:function(h,l){if(!this.isAxisEnabled(h)){return null}var g=this.position[h],d=this.getMinPosition()[h],k=this.getMaxPosition()[h],a=this.getMaxAbsoluteVelocity(),f=null,b=this.dragEndTime,j=l.flick.velocity[h],m;if(g<d){f=d}else{if(g>k){f=k}}if(f!==null){m=this.getBounceEasing()[h];m.setConfig({startTime:b,startValue:-g,endValue:-f});return m}if(j===0){return null}if(j<-a){j=-a}else{if(j>a){j=a}}if(Ext.browser.is.IE){j*=2}m=this.getMomentumEasing()[h];m.setConfig({startTime:b,startValue:-g,startVelocity:j*1.5,minMomentumValue:-k,maxMomentumValue:0});return m},onAnimationFrame:function(d,b,e){var a=this.position;a.x=-b;a.y=-e;this.fireEvent("scroll",this,a.x,a.y)},onAnimationEnd:function(){this.snapToBoundary();this.onScrollEnd()},stopAnimation:function(){this.getTranslatable().stopAnimation()},onScrollEnd:function(){var a=this.position;if(this.isTouching||!this.snapToSlot()){this.fireEvent("scrollend",this,a.x,a.y)}},snapToSlot:function(){var b=this.getSnapPosition("x"),a=this.getSnapPosition("y"),d=this.getSlotSnapEasing();if(b!==null||a!==null){this.scrollTo(b,a,{easingX:d.x,easingY:d.y});return true}return false},getSnapPosition:function(d){var h=this.getSlotSnapSize()[d],e=null,a,g,f,b;if(h!==0&&this.isAxisEnabled(d)){a=this.position[d];g=this.getSlotSnapOffset()[d];f=this.getMaxPosition()[d];if(a>=f){return null}b=Math.floor((a-g)%h);if(b!==0){if(a!==f){if(Math.abs(b)>h/2){e=Math.min(f,a+((b>0)?h-b:b-h))}else{e=a-b}}else{e=a-b}}}return e},snapToBoundary:function(){var h=this.position,d=this.getMinPosition(),g=this.getMaxPosition(),f=d.x,e=d.y,b=g.x,a=g.y,k=Math.round(h.x),j=Math.round(h.y);if(k<f){k=f}else{if(k>b){k=b}}if(j<e){j=e}else{if(j>a){j=a}}this.scrollTo(k,j)},destroy:function(){var d=this.getElement(),b=this.sizeMonitors,a;if(b){b.element.destroy();b.container.destroy()}if(d&&!d.isDestroyed){d.removeCls(this.cls);a=this.getContainer();if(a&&!a.isDestroyed){a.removeCls(this.containerCls)}}Ext.destroy(this.getTranslatable());this.callParent(arguments)}},function(){});(function(){var d=0,f=["ms","moz","webkit","o"],b=f.length,a,e;for(a=0;a<b&&!window.requestAnimationFrame;++a){e=f[a];if(window[e+"RequestAnimationFrame"]){window.requestAnimationFrame=window[e+"RequestAnimationFrame"];window.cancelAnimationFrame=window[e+"CancelAnimationFrame"]||window[e+"CancelRequestAnimationFrame"]}}if(!window.Ext){window.Ext={}}Ext.performance={};if(window.performance&&window.performance.now){Ext.performance.now=function(){return window.performance.now()}}else{Ext.performance.now=function(){return Date.now()}}if(!window.requestAnimationFrame){window.requestAnimationFrame=function(k){var g=Ext.performance.now(),h=Math.max(0,16-(g-d)),j=window.setTimeout(function(){k(g+h)},h);d=g+h;return j}}else{Ext.trueRequestAnimationFrames=true}if(!window.cancelAnimationFrame){window.cancelAnimationFrame=function(g){clearTimeout(g)}}}());(function(a){Ext.define("Ext.AnimationQueue",{singleton:true,constructor:function(){var b=Ext.Function.bind;this.queue=[];this.taskQueue=[];this.runningQueue=[];this.idleQueue=[];this.isRunning=false;this.isIdle=true;this.run=b(this.run,this);this.whenIdle=b(this.whenIdle,this);this.processIdleQueueItem=b(this.processIdleQueueItem,this);this.processTaskQueueItem=b(this.processTaskQueueItem,this);if(Ext.os.is.iOS){setInterval(this.watch,500)}},start:function(e,d,b){this.queue.push(arguments);if(!this.isRunning){if(this.hasOwnProperty("idleTimer")){clearTimeout(this.idleTimer);delete this.idleTimer}if(this.hasOwnProperty("idleQueueTimer")){clearTimeout(this.idleQueueTimer);delete this.idleQueueTimer}this.isIdle=false;this.isRunning=true;this.doStart()}},watch:function(){if(this.isRunning&&Date.now()-this.lastRunTime>=500){this.run()}},run:function(){if(!this.isRunning){return}var b=this.runningQueue,d,e;this.lastRunTime=Date.now();this.frameStartTime=Ext.performance.now();b.push.apply(b,this.queue);for(d=0,e=b.length;d<e;d++){this.invoke(b[d])}b.length=0;this.doIterate()},doStart:function(){this.animationFrameId=requestAnimationFrame(this.run);this.lastRunTime=Date.now()},doIterate:function(){this.animationFrameId=requestAnimationFrame(this.run)},doStop:function(){cancelAnimationFrame(this.animationFrameId)},stop:function(g,f,d){if(!this.isRunning){return}var b=this.queue,j=b.length,e,h;for(e=0;e<j;e++){h=b[e];if(h[0]===g&&h[1]===f&&h[2]===d){b.splice(e,1);e--;j--}}if(j===0){this.doStop();this.isRunning=false;this.idleTimer=setTimeout(this.whenIdle,100)}},onIdle:function(g,f,b){var e=this.idleQueue,d,h,j;for(d=0,h=e.length;d<h;d++){j=e[d];if(g===j[0]&&f===j[1]&&b===j[2]){return}}e.push(arguments);if(this.isIdle){this.processIdleQueue()}},unIdle:function(g,f,b){var e=this.idleQueue,d,h,j;for(d=0,h=e.length;d<h;d++){j=e[d];if(g===j[0]&&f===j[1]&&b===j[2]){e.splice(d,1);return true}}return false},queueTask:function(e,d,b){this.taskQueue.push(arguments);this.processTaskQueue()},dequeueTask:function(g,f,b){var e=this.taskQueue,d,h,j;for(d=0,h=e.length;d<h;d++){j=e[d];if(g===j[0]&&f===j[1]&&b===j[2]){e.splice(d,1);d--;h--}}},invoke:function(f){var e=f[0],d=f[1],b=f[2];e=(typeof e=="string"?d[e]:e);if(Ext.isArray(b)){e.apply(d,b)}else{e.call(d,b)}},whenIdle:function(){this.isIdle=true;this.processIdleQueue()},processIdleQueue:function(){if(!this.hasOwnProperty("idleQueueTimer")){this.idleQueueTimer=setTimeout(this.processIdleQueueItem,1)}},processIdleQueueItem:function(){delete this.idleQueueTimer;if(!this.isIdle){return}var b=this.idleQueue,d;if(b.length>0){d=b.shift();this.invoke(d);this.processIdleQueue()}},processTaskQueue:function(){if(!this.hasOwnProperty("taskQueueTimer")){this.taskQueueTimer=setTimeout(this.processTaskQueueItem,15)}},processTaskQueueItem:function(){delete this.taskQueueTimer;var b=this.taskQueue,d;if(b.length>0){d=b.shift();this.invoke(d);this.processTaskQueue()}},showFps:function(){if(!Ext.trueRequestAnimationFrames){alert("This browser does not support requestAnimationFrame. The FPS listed will not be accurate")}Ext.onReady(function(){Ext.Viewport.add([{xtype:"component",bottom:50,left:0,width:50,height:20,html:"Average",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__averageFps",xtype:"component",bottom:0,left:0,width:50,height:50,html:"0",style:"background-color: red; color: white; text-align: center; line-height: 50px;"},{xtype:"component",bottom:50,left:50,width:50,height:20,html:"Min (Last 1k)",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__minFps",xtype:"component",bottom:0,left:50,width:50,height:50,html:"0",style:"background-color: orange; color: white; text-align: center; line-height: 50px;"},{xtype:"component",bottom:50,left:100,width:50,height:20,html:"Max (Last 1k)",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__maxFps",xtype:"component",bottom:0,left:100,width:50,height:50,html:"0",style:"background-color: yellow; color: black; text-align: center; line-height: 50px;"},{xtype:"component",bottom:50,left:150,width:50,height:20,html:"Current",style:"background-color: black; color: white; text-align: center; line-height: 20px; font-size: 8px;"},{id:"__currentFps",xtype:"component",bottom:0,left:150,width:50,height:50,html:"0",style:"background-color: green; color: white; text-align: center; line-height: 50px;"}]);Ext.AnimationQueue.resetFps()})},resetFps:function(){var e=Ext.getCmp("__currentFps"),d=Ext.getCmp("__averageFps"),k=Ext.getCmp("__minFps"),j=Ext.getCmp("__maxFps"),f=1000,b=0,h=0,g=0;Ext.AnimationQueue.onFpsChanged=function(l){h++;if(!(h%10)){f=1000;b=0}g+=l;f=Math.min(f,l);b=Math.max(b,l);e.setHtml(Math.round(l));d.setHtml(Math.round(g/h));k.setHtml(Math.round(f));j.setHtml(Math.round(b))}}},function(){})})(this);Ext.define("Ext.TaskQueue",{singleton:true,pending:false,mode:true,constructor:function(){this.readQueue=[];this.writeQueue=[];this.run=Ext.Function.bind(this.run,this);this.watch=Ext.Function.bind(this.watch,this);if(Ext.os.is.iOS){setInterval(this.watch,500)}},requestRead:function(d,b,a){this.request(true);this.readQueue.push(arguments)},requestWrite:function(d,b,a){this.request(false);this.writeQueue.push(arguments)},request:function(a){if(!this.pending){this.pendingTime=Date.now();this.pending=true;this.mode=a;if(a){setTimeout(this.run,1)}else{requestAnimationFrame(this.run)}}},watch:function(){if(this.pending&&Date.now()-this.pendingTime>=500){this.run()}},run:function(){this.pending=false;var k=this.readQueue,f=this.writeQueue,d=null,g;if(this.mode){g=k;if(f.length>0){d=false}}else{g=f;if(k.length>0){d=true}}var b=g.slice(),e,h,a,j,l;g.length=0;for(e=0,h=b.length;e<h;e++){a=b[e];j=a[0];l=a[1];if(typeof j=="string"){j=l[j]}if(a.length>2){j.apply(l,a[2])}else{j.call(l)}}b.length=0;if(d!==null){this.request(d)}}});Ext.define("Ext.scroll.indicator.Abstract",{extend:Ext.Component,config:{baseCls:"x-scroll-indicator",axis:"x",value:null,length:null,minLength:6,hidden:true,ui:"dark",autoHide:true},cachedConfig:{ratio:1,barCls:"x-scroll-bar",active:true},barElement:null,barLength:0,gapLength:0,getElementConfig:function(){return{reference:"barElement",children:[this.callParent()]}},applyRatio:function(a){if(isNaN(a)||a>1){a=1}return a},refresh:function(){var g=this.barElement,f=g.dom,d=this.getRatio(),b=this.getAxis(),a=(b==="x")?f.offsetWidth:f.offsetHeight,e=a*d;this.barLength=a;this.gapLength=a-e;this.setLength(e);this.updateValue(this.getValue())},updateBarCls:function(a){this.barElement.addCls(a)},updateAxis:function(a){this.element.addCls(this.getBaseCls(),null,a);this.barElement.addCls(this.getBarCls(),null,a)},updateValue:function(g){var b=this.barLength,d=this.gapLength,e=this.getLength(),f,h,a;if(g<=0){h=0;this.updateLength(this.applyLength(e+g*b))}else{if(g>=1){a=Math.round((g-1)*b);f=this.applyLength(e-a);a=e-f;this.updateLength(f);h=d+a}else{h=d*g}}this.setOffset(h)},updateActive:function(a){this.barElement[a?"addCls":"removeCls"]("active")},doSetHidden:function(b){var a=this;if(b){a.getAutoHide()&&a.setOffset(-10000)}else{delete a.lastLength;delete a.lastOffset;a.updateValue(a.getValue())}},applyLength:function(a){return Math.max(this.getMinLength(),a)},updateLength:function(a){a=Math.round(a);if(this.lastLength===a){return}this.lastLength=a;Ext.TaskQueue.requestWrite("doUpdateLength",this,[a])},doUpdateLength:function(d){if(!this.isDestroyed){var b=this.getAxis(),a=this.element;if(b==="x"){a.setWidth(d)}else{a.setHeight(d)}}},setOffset:function(a){a=Math.round(a);if(this.lastOffset===a||this.lastOffset===-10000){return}this.lastOffset=a;Ext.TaskQueue.requestWrite("doSetOffset",this,[a])},doSetOffset:function(d){if(!this.isDestroyed){var b=this.getAxis(),a=this.element;if(b==="x"){a.translate(d,0)}else{a.translate(0,d)}}}});Ext.define("Ext.scroll.indicator.CssTransform",{extend:Ext.scroll.indicator.Abstract,config:{cls:"csstransform"}});Ext.define("Ext.scroll.indicator.ScrollPosition",{extend:Ext.scroll.indicator.Abstract,config:{cls:"scrollposition"},getElementConfig:function(){var a=this.callParent(arguments);a.children.unshift({className:"x-scroll-bar-stretcher"});return a},updateValue:function(a){if(this.gapLength===0){if(a>=1){a--}this.setOffset(this.barLength*a)}else{this.setOffset(this.gapLength*a)}},doUpdateLength:function(){if(!this.isDestroyed){var a=this.barLength,b=this.element;this.callParent(arguments);if(this.getAxis()==="x"){b.setLeft(a)}else{b.setTop(a)}}},doSetOffset:function(e){if(!this.isDestroyed){var b=this.barLength,a=this.getMinLength(),d=this.barElement.dom;if(e!==-10000){e=Math.min(b-a,Math.max(e,a-this.getLength()));e=b-e}if(this.getAxis()==="x"){d.scrollLeft=e}else{d.scrollTop=e}}}});Ext.define("Ext.scroll.indicator.Rounded",{extend:Ext.scroll.indicator.Abstract,config:{cls:"rounded"},constructor:function(){this.callParent(arguments);this.transformPropertyName=Ext.browser.getVendorProperyName("transform")},getElementConfig:function(){var a=this.callParent();a.children[0].children=[{reference:"startElement"},{reference:"middleElement"},{reference:"endElement"}];return a},refresh:function(){var e=this.getAxis(),d=this.startElement.dom,a=this.endElement.dom,f=this.middleElement,b,g;if(e==="x"){b=d.offsetWidth;g=a.offsetWidth;f.setLeft(b)}else{b=d.offsetHeight;g=a.offsetHeight;f.setTop(b)}this.startElementLength=b;this.endElementLength=g;this.callParent()},doUpdateLength:function(d){if(!this.isDestroyed){var b=this.getAxis(),a=this.endElement,f=this.middleElement.dom.style,e=this.endElementLength,j=d-e,h=j-this.startElementLength,g=this.transformPropertyName;if(b==="x"){a.translate(j,0);f[g]="translate3d(0, 0, 0) scaleX("+h+")"}else{a.translate(0,j);f[g]="translate3d(0, 0, 0) scaleY("+h+")"}}}});Ext.define("Ext.scroll.Indicator",{alternateClassName:"Ext.util.Indicator",constructor:function(a){var b=Ext.scroll.indicator;switch(Ext.browser.getPreferredTranslationMethod(a)){case"scrollposition":return new b.ScrollPosition(a);case"csstransform":if(Ext.browser.is.AndroidStock4){return new b.CssTransform(a)}else{return new b.Rounded(a)}}}});Ext.define("Ext.scroll.View",{extend:Ext.Evented,alternateClassName:"Ext.util.ScrollView",config:{indicatorsUi:"dark",element:null,scroller:{},indicators:{x:{axis:"x"},y:{axis:"y"}},indicatorsHidingDelay:100,cls:Ext.baseCSSPrefix+"scroll-view"},processConfig:function(d){if(!d){return null}if(typeof d=="string"){d={direction:d}}d=Ext.merge({},d);var a=d.scroller,b;if(!a){d.scroller=a={}}for(b in d){if(d.hasOwnProperty(b)){if(!this.hasConfig(b)){a[b]=d[b];delete d[b]}}}return d},constructor:function(a){a=this.processConfig(a);this.useIndicators={x:true,y:true};this.doHideIndicators=Ext.Function.bind(this.doHideIndicators,this);this.initConfig(a)},setConfig:function(a){return this.callParent([this.processConfig(a)])},updateIndicatorsUi:function(a){var b=this.getIndicators();b.x.setUi(a);b.y.setUi(a)},applyScroller:function(a,b){return Ext.factory(a,Ext.scroll.Scroller,b)},applyIndicators:function(b,e){var a=Ext.scroll.Indicator,d=this.useIndicators;if(!b){b={}}if(!b.x){d.x=false;b.x={}}if(!b.y){d.y=false;b.y={}}return{x:Ext.factory(b.x,a,e&&e.x),y:Ext.factory(b.y,a,e&&e.y)}},updateIndicators:function(a){this.indicatorsGrid=Ext.Element.create({className:"x-scroll-bar-grid-wrapper",children:[{className:"x-scroll-bar-grid",children:[{children:[{},{children:[a.y.barElement]}]},{children:[{children:[a.x.barElement]},{}]}]}]})},updateScroller:function(a){a.on({scope:this,scrollstart:"onScrollStart",scroll:"onScroll",scrollend:"onScrollEnd",refresh:"refreshIndicators"})},isAxisEnabled:function(a){return this.getScroller().isAxisEnabled(a)&&this.useIndicators[a]},applyElement:function(a){if(a){return Ext.get(a)}},updateElement:function(d){var b=this.getScroller(),a;a=d.getFirstChild().getFirstChild();if(this.FixedHBoxStretching){a=a.getFirstChild()}d.addCls(this.getCls());d.insertFirst(this.indicatorsGrid);b.setElement(a);this.refreshIndicators();return this},showIndicators:function(){var a=this.getIndicators();if(this.hasOwnProperty("indicatorsHidingTimer")){clearTimeout(this.indicatorsHidingTimer);delete this.indicatorsHidingTimer}if(this.isAxisEnabled("x")){a.x.show()}if(this.isAxisEnabled("y")){a.y.show()}},hideIndicators:function(){var a=this.getIndicatorsHidingDelay();if(a>0){this.indicatorsHidingTimer=setTimeout(this.doHideIndicators,a)}else{this.doHideIndicators()}},doHideIndicators:function(){var a=this.getIndicators();if(this.isAxisEnabled("x")){a.x.hide()}if(this.isAxisEnabled("y")){a.y.hide()}},onScrollStart:function(){this.onScroll.apply(this,arguments);this.showIndicators()},onScrollEnd:function(){this.hideIndicators()},onScroll:function(b,a,d){this.setIndicatorValue("x",a);this.setIndicatorValue("y",d)},setIndicatorValue:function(b,g){if(!this.isAxisEnabled(b)){return this}var a=this.getScroller(),d=a.getMaxPosition()[b],f=a.getContainerSize()[b],e;if(d===0){e=g/f;if(g>=0){e+=1}}else{if(g>d){e=1+((g-d)/f)}else{if(g<0){e=g/f}else{e=g/d}}}this.getIndicators()[b].setValue(e)},refreshIndicator:function(e){if(!this.isAxisEnabled(e)){return this}var a=this.getScroller(),b=this.getIndicators()[e],f=a.getContainerSize()[e],g=a.getSize()[e],d=f/g;b.setRatio(d);b.refresh()},refresh:function(){return this.getScroller().refresh()},refreshIndicators:function(){var a=this.getIndicators();a.x.setActive(this.isAxisEnabled("x"));a.y.setActive(this.isAxisEnabled("y"));this.refreshIndicator("x");this.refreshIndicator("y")},destroy:function(){var a=this.getElement(),b=this.getIndicators();Ext.destroy(this.getScroller(),this.indicatorsGrid);if(this.hasOwnProperty("indicatorsHidingTimer")){clearTimeout(this.indicatorsHidingTimer);delete this.indicatorsHidingTimer}if(a&&!a.isDestroyed){a.removeCls(this.getCls())}b.x.destroy();b.y.destroy();delete this.indicatorsGrid;this.callParent(arguments)}});Ext.define("Ext.behavior.Scrollable",{extend:Ext.behavior.Behavior,constructor:function(){this.listeners={painted:"onComponentPainted",scope:this};this.callParent(arguments)},onComponentPainted:function(){this.scrollView.refresh()},setConfig:function(g){var d=this.scrollView,f=this.component,b,e,a,h;if(g){if(!d){this.scrollView=d=new Ext.scroll.View(g);d.on("destroy","onScrollViewDestroy",this);f.setUseBodyElement(true);this.scrollerElement=b=f.innerElement;if(!Ext.feature.has.ProperHBoxStretching){a=d.getScroller();h=(Ext.isObject(g)?g.direction:g)||"auto";if(h!=="vertical"){e=b.wrap();e.addCls(Ext.baseCSSPrefix+"translatable-hboxfix");if(h=="horizontal"){e.setStyle({height:"100%"})}this.scrollContainer=e.wrap();d.FixedHBoxStretching=a.FixedHBoxStretching=true}else{this.scrollContainer=b.wrap()}}else{this.scrollContainer=b.wrap()}d.setElement(f.bodyElement);if(f.isPainted()){this.onComponentPainted()}f.on(this.listeners)}else{if(Ext.isString(g)||Ext.isObject(g)){d.setConfig(g)}}}else{if(d){d.destroy()}}return this},getScrollView:function(){return this.scrollView},onScrollViewDestroy:function(){var b=this.component,a=this.scrollerElement;if(!a.isDestroyed){this.scrollerElement.unwrap()}this.scrollContainer.destroy();if(!b.isDestroyed){b.un(this.listeners)}delete this.scrollerElement;delete this.scrollView;delete this.scrollContainer},onComponentDestroy:function(){var a=this.scrollView;if(a){a.destroy()}}});Ext.define("Ext.util.InputBlocker",{singleton:true,blockInputs:function(){if(Ext.browser.is.ie){Ext.select(".x-field-text .x-field-input:not(.x-item-disabled) .x-input-el, .x-field-textarea .x-field-input:not(.x-item-disabled) .x-input-el, .x-field-search .x-field-input:not(.x-item-disabled) .x-input-el").each(function(a){if(a.dom.offsetWidth>0){a.dom.setAttribute("disabled",true);a.dom.setAttribute("overlayfix",true)}})}},unblockInputs:function(){if(Ext.browser.is.ie){Ext.select("[overlayfix]").each(function(a){a.dom.removeAttribute("disabled");a.dom.removeAttribute("overlayfix")})}}});Ext.define("Ext.Mask",{extend:Ext.Component,xtype:"mask",config:{baseCls:Ext.baseCSSPrefix+"mask",transparent:false,top:0,left:0,right:0,bottom:0},initialize:function(){this.callSuper();this.element.on("*","onEvent",this);this.on({hide:"onHide"})},onHide:function(){Ext.util.InputBlocker.unblockInputs();if(Ext.browser.is.AndroidStock4&&Ext.os.version.getMinor()===0){var a=this.element.getFirstChild();if(a){a.redraw()}}},onEvent:function(b){var a=arguments[arguments.length-1];if(a.info.eventName==="tap"){this.fireEvent("tap",this,b);return false}if(b&&b.stopEvent){b.stopEvent()}return false},updateTransparent:function(a){this[a?"addCls":"removeCls"](this.getBaseCls()+"-transparent")}});Ext.define("Ext.Container",{extend:Ext.Component,alternateClassName:"Ext.lib.Container",xtype:"container",eventedConfig:{activeItem:0,scrollable:null},config:{layout:null,control:{},defaults:null,items:null,autoDestroy:true,defaultType:null,useBodyElement:null,masked:null,modal:null,hideOnMaskTap:null},isContainer:true,constructor:function(a){var b=this;b._items=b.items=new Ext.ItemCollection();b.innerItems=[];b.onItemAdd=b.onFirstItemAdd;b.callParent(arguments)},getElementConfig:function(){return{reference:"element",classList:["x-container","x-unsized"],children:[{reference:"innerElement",className:"x-inner"}]}},applyMasked:function(b){var a=true,d;if(b===false){b=true;a=false}d=Ext.factory(b,Ext.Mask,this.getMasked());if(d){this.add(d);d.setHidden(!a)}return d},mask:function(a){this.setMasked(a||true)},unmask:function(){this.setMasked(false)},setParent:function(a){this.callSuper(arguments);if(a){var b=this.getModal();if(b){a.insertBefore(b,this);b.setZIndex(this.getZIndex()-1)}}},applyModal:function(d,b){var a=true;if(d===false){d=true;a=false}b=Ext.factory(d,Ext.Mask,b);if(b){b.setVisibility(a)}return b},updateModal:function(b){var a=this.getParent();if(a){if(b){a.insertBefore(b,this);b.setZIndex(this.getZIndex()-1)}else{a.remove(b)}}},updateHideOnMaskTap:function(b){var a=this.getModal();if(a){a[b?"on":"un"].call(a,"tap","hide",this)}},updateZIndex:function(b){var a=this.getModal();this.callParent(arguments);if(a){a.setZIndex(b-1)}},updateBaseCls:function(a,b){var d=this,e=d.getUi();if(b){this.element.removeCls(b);this.innerElement.removeCls(a,null,"inner");if(e){this.element.removeCls(this.currentUi)}}if(a){this.element.addCls(a);this.innerElement.addCls(a,null,"inner");if(e){this.element.addCls(a,null,e);this.currentUi=a+"-"+e}}},updateUseBodyElement:function(a){if(a){this.link("bodyElement",this.innerElement.wrap({cls:"x-body"}))}},applyItems:function(a,e){if(a){var b=this;b.getDefaultType();b.getDefaults();if(b.initialized&&e.length>0){b.removeAll()}b.add(a);if(b.initialized){var d=b.initialConfig.activeItem||b.config.activeItem||0;b.setActiveItem(d)}}},applyControl:function(d){var a,b,f,e;for(a in d){e=d[a];for(b in e){f=e[b];if(Ext.isObject(f)){f.delegate=a}}e.delegate=a;this.addListener(e)}return d},onFirstItemAdd:function(){delete this.onItemAdd;if(this.innerHtmlElement&&!this.getHtml()){this.innerHtmlElement.destroy();delete this.innerHtmlElement}this.on("innerstatechange","onItemInnerStateChange",this,{delegate:"> component"});return this.onItemAdd.apply(this,arguments)},getLayout:function(){var a=this.layout;if(!a){a=this.link("_layout",this.link("layout",Ext.factory(this._layout||"default",Ext.layout.Default,null,"layout")));a.setContainer(this)}return a},updateDefaultType:function(a){this.defaultItemClass=Ext.ClassManager.getByAlias("widget."+a)},applyDefaults:function(a){if(a){this.factoryItem=this.factoryItemWithDefaults;return a}},factoryItem:function(a){return Ext.factory(a,this.defaultItemClass)},factoryItemWithDefaults:function(d){var b=this,e=b.getDefaults(),a;if(!e){return Ext.factory(d,b.defaultItemClass)}if(d.isComponent){a=d;if(e&&d.isInnerItem()&&!b.has(a)){a.setConfig(e,true)}}else{if(e&&!d.ignoreDefaults){if(!(d.hasOwnProperty("left")&&d.hasOwnProperty("right")&&d.hasOwnProperty("top")&&d.hasOwnProperty("bottom")&&d.hasOwnProperty("docked")&&d.hasOwnProperty("centered"))){d=Ext.mergeIf({},d,e)}}a=Ext.factory(d,b.defaultItemClass)}return a},add:function(a){var f=this,b,e,d,g;if(Ext.isArray(a)){for(b=0,e=a.length;b<e;b++){d=f.factoryItem(a[b]);this.doAdd(d);if(!g&&!this.getActiveItem()&&this.innerItems.length>0&&d.isInnerItem()){g=d}}}else{d=f.factoryItem(a);this.doAdd(d);if(!g&&!this.getActiveItem()&&this.innerItems.length>0&&d.isInnerItem()){g=d}}if(g){this.setActiveItem(g)}return d},doAdd:function(e){var d=this,a=d.getItems(),b;if(!a.has(e)){b=a.length;a.add(e);if(e.isInnerItem()){d.insertInner(e)}e.setParent(d);d.onItemAdd(e,b)}},remove:function(e,b){var d=this,a=d.indexOf(e),f=d.getInnerItems();if(b===undefined){b=d.getAutoDestroy()}if(a!==-1){if(!d.removingAll&&f.length>1&&e===d.getActiveItem()){d.on({activeitemchange:"doRemove",scope:d,single:true,order:"after",args:[e,a,b]});d.doResetActiveItem(f.indexOf(e))}else{d.doRemove(e,a,b);if(f.length===0){d.setActiveItem(null)}}}return d},doResetActiveItem:function(a){if(a===0){this.setActiveItem(1)}else{this.setActiveItem(0)}},doRemove:function(e,a,b){var d=this;d.items.remove(e);if(e.isInnerItem()){d.removeInner(e)}d.onItemRemove(e,a,b);e.setParent(null);if(b){e.destroy()}},removeAll:function(d,g){var a=this.items,f=a.length,b=0,e;if(typeof d!="boolean"){d=this.getAutoDestroy()}g=Boolean(g);this.removingAll=true;for(;b<f;b++){e=a.getAt(b);if(e&&(g||e.isInnerItem())){this.doRemove(e,b,d);b--;f--}}this.setActiveItem(null);this.removingAll=false;return this},getAt:function(a){return this.items.getAt(a)},getInnerAt:function(a){return this.innerItems[a]},removeAt:function(a){var b=this.getAt(a);if(b){this.remove(b)}return this},removeInnerAt:function(a){var b=this.getInnerItems()[a];if(b){this.remove(b)}return this},has:function(a){return this.getItems().indexOf(a)!=-1},hasInnerItem:function(a){return this.innerItems.indexOf(a)!=-1},indexOf:function(a){return this.getItems().indexOf(a)},innerIndexOf:function(a){return this.innerItems.indexOf(a)},insertInner:function(e,b){var a=this.getItems().items,g=this.innerItems,h=g.indexOf(e),d=-1,f;if(h!==-1){g.splice(h,1)}if(typeof b=="number"){do{f=a[++b]}while(f&&!f.isInnerItem());if(f){d=g.indexOf(f);g.splice(d,0,e)}}if(d===-1){g.push(e);d=g.length-1}if(h!==-1){this.onInnerItemMove(e,d,h)}return this},onInnerItemMove:Ext.emptyFn,removeInner:function(a){Ext.Array.remove(this.innerItems,a);return this},insert:function(a,e){var d=this,b;if(Ext.isArray(e)){for(b=e.length-1;b>=0;b--){d.insert(a,e[b])}return d}e=this.factoryItem(e);this.doInsert(a,e);return e},doInsert:function(e,g){var f=this,b=f.items,d=b.length,a,h;h=g.isInnerItem();if(e>d){e=d}if(b[e-1]===g){return f}a=f.indexOf(g);if(a!==-1){if(a<e){e-=1}b.removeAt(a)}b.insert(e,g);if(a===-1){g.setParent(f)}if(h){f.insertInner(g,e)}if(a!==-1){f.onItemMove(g,e,a)}else{f.onItemAdd(g,e)}},insertFirst:function(a){return this.insert(0,a)},insertLast:function(a){return this.insert(this.getItems().length,a)},insertBefore:function(d,a){var b=this.indexOf(a);if(b!==-1){this.insert(b,d)}return this},insertAfter:function(d,a){var b=this.indexOf(a);if(b!==-1){this.insert(b+1,d)}return this},onItemAdd:function(b,a){this.doItemLayoutAdd(b,a);if(this.initialized){this.fireEvent("add",this,b,a)}},doItemLayoutAdd:function(d,a){var b=this.getLayout();if(this.isRendered()&&d.setRendered(true)){d.fireAction("renderedchange",[this,d,true],"onItemAdd",b,{args:[d,a]})}else{b.onItemAdd(d,a)}},onItemRemove:function(b,a,d){this.doItemLayoutRemove(b,a,d);this.fireEvent("remove",this,b,a)},doItemLayoutRemove:function(d,a,e){var b=this.getLayout();if(this.isRendered()&&d.setRendered(false)){d.fireAction("renderedchange",[this,d,false],"onItemRemove",b,{args:[d,a,e]})}else{b.onItemRemove(d,a,e)}},onItemMove:function(b,d,a){if(b.isDocked()){b.setDocked(null)}this.doItemLayoutMove(b,d,a);this.fireEvent("move",this,b,d,a)},doItemLayoutMove:function(b,d,a){this.getLayout().onItemMove(b,d,a)},onItemInnerStateChange:function(d,a){var b=this.getLayout();if(a){this.insertInner(d,this.items.indexOf(d))}else{this.removeInner(d)}b.onItemInnerStateChange.apply(b,arguments)},getInnerItems:function(){return this.innerItems},getDockedItems:function(){var a=this.getItems().items,d=[],f=a.length,e,b;for(b=0;b<f;b++){e=a[b];if(e.isDocked()){d.push(e)}}return d},applyActiveItem:function(e,a){var d=this.getInnerItems();this.getItems();if(!e&&d.length===0){return 0}else{if(typeof e=="number"){e=Math.max(0,Math.min(e,d.length-1));e=d[e];if(e){return e}else{if(a){return null}}}else{if(e){var b;if(typeof e=="string"){b=this.child(e);e={xtype:e}}if(!b||!b.isComponent){b=this.factoryItem(e)}this.pendingActiveItem=b;if(!this.has(b)){this.add(b)}return b}}}},animateActiveItem:function(e,d){var b=this.getLayout(),a;if(this.activeItemAnimation){this.activeItemAnimation.destroy()}this.activeItemAnimation=d=new Ext.fx.layout.Card(d);if(d&&b.isCard){d.setLayout(b);a=b.getAnimation();if(a){a.disable()}d.on("animationend",function(){if(a){a.enable()}d.destroy()},this)}return this.setActiveItem(e)},doSetActiveItem:function(b,a){delete this.pendingActiveItem;if(a){a.fireEvent("deactivate",a,this,b)}if(b){b.fireEvent("activate",b,this,a)}},show:function(){this.callParent(arguments);var a=this.getModal();if(a){a.setHidden(false)}return this},hide:function(){this.callParent(arguments);var a=this.getModal();if(a){a.setHidden(true)}return this},doSetHidden:function(b){var a=this.getModal();if(a&&(a.getHidden()!==b)){a.setHidden(b)}this.callSuper(arguments)},setRendered:function(e){if(this.callParent(arguments)){var a=this.items.items,b,d;for(b=0,d=a.length;b<d;b++){a[b].setRendered(e)}return true}return false},getScrollableBehavior:function(){var a=this.scrollableBehavior;if(!a){a=this.scrollableBehavior=new Ext.behavior.Scrollable(this)}return a},applyScrollable:function(a){if(typeof a==="boolean"){this.getScrollableBehavior().setConfig({disabled:!a})}else{if(a&&!a.isObservable){this.getScrollableBehavior().setConfig(a)}}return a},doSetScrollable:function(){},getScrollable:function(){return this.getScrollableBehavior().getScrollView()},getRefItems:function(a){var b=this.getItems().items.slice(),f=b.length,d,e;if(a){for(d=0;d<f;d++){e=b[d];if(e.getRefItems){b=b.concat(e.getRefItems(true))}}}return b},getComponent:function(a){if(Ext.isObject(a)){a=a.getItemId()}return this.getItems().get(a)},getDockedComponent:function(a){if(Ext.isObject(a)){a=a.getItemId()}var d=this.getDockedItems(),f=d.length,e,b;if(Ext.isNumber(a)){return d[a]}for(b=0;b<f;b++){e=d[b];if(e.id==a){return e}}return false},query:function(a){return Ext.ComponentQuery.query(a,this)},child:function(a){return this.query("> "+a)[0]||null},down:function(a){return this.query(a)[0]||null},destroy:function(){var b=this,a=b.getModal();if(a){a.destroy()}b.removeAll(true,true);b.unlink("_scrollable");Ext.destroy(b.items);b.callSuper()}},function(){this.addMember("defaultItemClass",this)});Ext.define("Ext.util.Point",{radianToDegreeConstant:180/Math.PI,statics:{fromEvent:function(b){var a=b.changedTouches,d=(a&&a.length>0)?a[0]:b;return this.fromTouch(d)},fromTouch:function(a){return new this(a.pageX,a.pageY)},from:function(a){if(!a){return new this(0,0)}if(!(a instanceof this)){return new this(a.x,a.y)}return a}},constructor:function(a,b){if(typeof a=="undefined"){a=0}if(typeof b=="undefined"){b=0}this.x=a;this.y=b;return this},clone:function(){return new this.self(this.x,this.y)},copy:function(){return this.clone.apply(this,arguments)},copyFrom:function(a){this.x=a.x;this.y=a.y;return this},toString:function(){return"Point["+this.x+","+this.y+"]"},equals:function(a){return(this.x===a.x&&this.y===a.y)},isCloseTo:function(d,b){if(typeof b=="number"){b={x:b};b.y=b.x}var a=d.x,g=d.y,f=b.x,e=b.y;return(this.x<=a+f&&this.x>=a-f&&this.y<=g+e&&this.y>=g-e)},isWithin:function(){return this.isCloseTo.apply(this,arguments)},translate:function(a,b){this.x+=a;this.y+=b;return this},roundedEquals:function(a){if(typeof a!="object"){a={x:0,y:0}}return(Math.round(this.x)===Math.round(a.x)&&Math.round(this.y)===Math.round(a.y))},getDistanceTo:function(b){if(typeof b!="object"){b={x:0,y:0}}var d=this.x-b.x,a=this.y-b.y;return Math.sqrt(d*d+a*a)},getAngleTo:function(b){if(typeof b!="object"){b={x:0,y:0}}var d=this.x-b.x,a=this.y-b.y;return Math.atan2(a,d)*this.radianToDegreeConstant}});Ext.define("Ext.util.LineSegment",{constructor:function(b,a){var d=Ext.util.Point;this.point1=d.from(b);this.point2=d.from(a)},intersects:function(n){var q=this.point1,o=this.point2,k=n.point1,g=n.point2,e=q.x,b=o.x,a=k.x,s=g.x,r=q.y,p=o.y,m=k.y,j=g.y,h=(e-b)*(m-j)-(r-p)*(a-s),l,f;if(h==0){return null}l=((a-s)*(e*p-r*b)-(e-b)*(a*j-m*s))/h;f=((m-j)*(e*p-r*b)-(r-p)*(a*j-m*s))/h;if(l<Math.min(e,b)||l>Math.max(e,b)||l<Math.min(a,s)||l>Math.max(a,s)||f<Math.min(r,p)||f>Math.max(r,p)||f<Math.min(m,j)||f>Math.max(m,j)){return null}return new Ext.util.Point(l,f)},getLength:function(){return Math.abs(this.point1.getDistanceTo(this.point2))},getAngleToX:function(){var e=this.point1,d=this.point2,a=d.y-e.y,b=d.x-e.x;return Math.atan2(a,b)},getInBetweenPoint:function(f){var b=this.point1,d=this.getAngleToX(),a=b.x+Math.cos(d)*f,e=b.y+Math.sin(d)*f;return new Ext.util.Point(a,e)},toString:function(){return this.point1.toString()+" "+this.point2.toString()}});Ext.define("Ext.Panel",{extend:Ext.Container,alternateClassName:"Ext.lib.Panel",xtype:"panel",isPanel:true,config:{baseCls:Ext.baseCSSPrefix+"panel",bodyPadding:null,bodyMargin:null,bodyBorder:null},getElementConfig:function(){return{reference:"element",classList:["x-container","x-unsized"],children:[{reference:"innerElement",className:"x-inner"},{reference:"tipElement",className:"x-anchor",hidden:true}]}},applyBodyPadding:function(a){if(a===true){a=5}if(a){a=Ext.dom.Element.unitizeBox(a)}return a},updateBodyPadding:function(a){this.element.setStyle("padding",a)},applyBodyMargin:function(a){if(a===true){a=5}if(a){a=Ext.dom.Element.unitizeBox(a)}return a},updateBodyMargin:function(a){this.element.setStyle("margin",a)},applyBodyBorder:function(a){if(a===true){a=1}if(a){a=Ext.dom.Element.unitizeBox(a)}return a},updateBodyBorder:function(a){this.element.setStyle("border-width",a)},alignTo:function(p,k){var v=this.getAlignmentInfo(p,k);if(v.isAligned){return}var B=this.tipElement;B.hide();if(this.currentTipPosition){B.removeCls("x-anchor-"+this.currentTipPosition)}this.callParent(arguments);var g=Ext.util.LineSegment,e=p.isComponent?p.renderElement:p,a=this.renderElement,q=e.getPageBox(),n=a.getPageBox(),b=n.left,y=n.top,H=n.right,j=n.bottom,m=b+(n.width/2),l=y+(n.height/2),r={x:b,y:y},o={x:H,y:y},G={x:b,y:j},I={x:H,y:j},D={x:m,y:l},x=q.left+(q.width/2),u=q.top+(q.height/2),A={x:x,y:u},d=new g(D,A),h=0,F=0,f,E,w,s,C,z;B.setVisibility(false);B.show();f=B.getSize();E=f.width;w=f.height;if(d.intersects(new g(r,o))){C=Math.min(Math.max(x,b+E),H-(E));z=y;F=w+10;s="top"}else{if(d.intersects(new g(r,G))){C=b;z=Math.min(Math.max(u+(E/2),E*1.6),j-(E/2.2));h=w+10;s="left"}else{if(d.intersects(new g(G,I))){C=Math.min(Math.max(x,b+E),H-E);z=j;F=-w-10;s="bottom"}else{if(d.intersects(new g(o,I))){C=H;z=Math.max(Math.min(u-w,j-E*1.3),E/2);h=-w-10;s="right"}}}}if(C||z){this.currentTipPosition=s;B.addCls("x-anchor-"+s);B.setLeft(C-b);B.setTop(z-y);B.setVisibility(true);this.setLeft(this.getLeft()+h);this.setTop(this.getTop()+F)}}});Ext.define("Ext.Button",{extend:Ext.Component,xtype:"button",cachedConfig:{pressedCls:Ext.baseCSSPrefix+"button-pressing",badgeCls:Ext.baseCSSPrefix+"badge",hasBadgeCls:Ext.baseCSSPrefix+"hasbadge",labelCls:Ext.baseCSSPrefix+"button-label",iconCls:null},config:{badgeText:null,text:null,icon:false,iconAlign:"left",pressedDelay:0,handler:null,scope:null,autoEvent:null,ui:"normal",baseCls:Ext.baseCSSPrefix+"button"},template:[{tag:"span",reference:"badgeElement",hidden:true},{tag:"span",className:Ext.baseCSSPrefix+"button-icon",reference:"iconElement"},{tag:"span",reference:"textElement",hidden:true}],initialize:function(){this.callParent();this.element.on({scope:this,tap:"onTap",touchstart:"onPress",touchend:"onRelease"})},updateBadgeText:function(d){var a=this.element,b=this.badgeElement;if(d){b.show();b.setText(d)}else{b.hide()}a[(d)?"addCls":"removeCls"](this.getHasBadgeCls())},updateText:function(b){var a=this.textElement;if(a){if(b){a.show();a.setHtml(b)}else{a.hide()}this.refreshIconAlign()}},updateHtml:function(b){var a=this.textElement;if(b){a.show();a.setHtml(b)}else{a.hide()}},updateBadgeCls:function(b,a){this.badgeElement.replaceCls(a,b)},updateHasBadgeCls:function(b,d){var a=this.element;if(a.hasCls(d)){a.replaceCls(d,b)}},updateLabelCls:function(b,a){this.textElement.replaceCls(a,b)},updatePressedCls:function(b,d){var a=this.element;if(a.hasCls(d)){a.replaceCls(d,b)}},updateIcon:function(b){var d=this,a=d.iconElement;if(b){d.showIconElement();a.setStyle("background-image","url("+b+")");d.refreshIconAlign()}else{a.setStyle("background-image","");d.hideIconElement()}},updateIconCls:function(d,a){var e=this,b=e.iconElement;if(d){e.showIconElement();b.replaceCls(a,d);e.refreshIconAlign()}else{b.removeCls(a);e.hideIconElement()}},updateIconAlign:function(e,d){var b=this.element,a=Ext.baseCSSPrefix+"iconalign-";if(!this.getText()){e="center"}b.removeCls(a+"center");b.removeCls(a+d);if(this.getIcon()||this.getIconCls()){b.addCls(a+e)}},refreshIconAlign:function(){this.updateIconAlign(this.getIconAlign())},applyAutoEvent:function(b){var a=this;if(typeof b=="string"){b={name:b,scope:a.scope||a}}return b},updateAutoEvent:function(d){var a=d.name,b=d.scope;this.setHandler(function(){b.fireEvent(a,b,this)});this.setScope(b)},hideIconElement:function(){this.iconElement.removeCls(Ext.baseCSSPrefix+"shown");this.iconElement.addCls(Ext.baseCSSPrefix+"hidden")},showIconElement:function(){this.iconElement.removeCls(Ext.baseCSSPrefix+"hidden");this.iconElement.addCls(Ext.baseCSSPrefix+"shown")},applyUi:function(a){if(a&&Ext.isString(a)){var b=a.split("-");if(b&&(b[1]=="back"||b[1]=="forward")){return b}}return a},getUi:function(){var a=this._ui;if(Ext.isArray(a)){return a.join("-")}return a},applyPressedDelay:function(a){if(Ext.isNumber(a)){return a}return(a)?100:0},onPress:function(){var d=this,a=d.element,e=d.getPressedDelay(),b=d.getPressedCls();if(!d.getDisabled()){if(e>0){d.pressedTimeout=setTimeout(function(){delete d.pressedTimeout;if(a){a.addCls(b)}},e)}else{a.addCls(b)}}},onRelease:function(a){this.fireAction("release",[this,a],"doRelease")},doRelease:function(a,b){if(!a.getDisabled()){if(a.hasOwnProperty("pressedTimeout")){clearTimeout(a.pressedTimeout);delete a.pressedTimeout}else{a.element.removeCls(a.getPressedCls())}}},onTap:function(a){if(this.getDisabled()){return false}this.fireAction("tap",[this,a],"doTap")},doTap:function(d,f){var b=d.getHandler(),a=d.getScope()||d;if(!b){return}if(typeof b=="string"){b=a[b]}if(f&&f.preventDefault){f.preventDefault()}b.apply(a,arguments)}},function(){});Ext.define("Ext.Sheet",{extend:Ext.Panel,xtype:"sheet",config:{baseCls:Ext.baseCSSPrefix+"sheet",modal:true,centered:true,stretchX:null,stretchY:null,enter:"bottom",exit:"bottom",showAnimation:!Ext.browser.is.AndroidStock2?{type:"slideIn",duration:250,easing:"ease-out"}:null,hideAnimation:!Ext.browser.is.AndroidStock2?{type:"slideOut",duration:250,easing:"ease-in"}:null},isInputRegex:/^(input|textarea|select|a)$/i,beforeInitialize:function(){var a=this;Ext.os.is.iOS&&this.element.dom.addEventListener("touchstart",function(b){if(!a.isInputRegex.test(b.target.tagName)){b.preventDefault()}},true)},platformConfig:[{theme:["Windows"],enter:"top",exit:"top"}],applyHideAnimation:function(b){var a=this.getExit(),e=a;if(a===null){return null}if(b===true){b={type:"slideOut"}}if(Ext.isString(b)){b={type:b}}var d=Ext.factory(b,Ext.fx.Animation);if(d){if(a=="bottom"){e="down"}if(a=="top"){e="up"}d.setDirection(e)}return d},applyShowAnimation:function(a){var e=this.getEnter(),d=e;if(e===null){return null}if(a===true){a={type:"slideIn"}}if(Ext.isString(a)){a={type:a}}var b=Ext.factory(a,Ext.fx.Animation);if(b){if(e=="bottom"){d="down"}if(e=="top"){d="up"}b.setBefore({display:null});b.setReverse(true);b.setDirection(d)}return b},updateStretchX:function(a){this.getLeft();this.getRight();if(a){this.setLeft(0);this.setRight(0)}},updateStretchY:function(a){this.getTop();this.getBottom();if(a){this.setTop(0);this.setBottom(0)}}});Ext.define("Ext.data.Connection",{mixins:{observable:Ext.mixin.Observable},statics:{requestId:0},config:{url:null,async:true,method:null,username:"",password:"",disableCaching:true,disableCachingParam:"_dc",timeout:30000,extraParams:null,defaultHeaders:null,useDefaultHeader:true,defaultPostHeader:"application/x-www-form-urlencoded; charset=UTF-8",useDefaultXhrHeader:true,defaultXhrHeader:"XMLHttpRequest",autoAbort:false},textAreaRe:/textarea/i,multiPartRe:/multipart\/form-data/i,lineBreakRe:/\r\n/g,constructor:function(a){this.initConfig(a);this.requests={}},request:function(m){m=m||{};var g=this,l=m.scope||window,f=m.username||g.getUsername(),j=m.password||g.getPassword()||"",h=m.xhr2===true&&Ext.feature.has.XHR2,b,d,e,a,k;if(!Ext.isEmpty(f)&&!Ext.isEmpty(j,true)&&Ext.isEmpty(m.withCredentials)){m.withCredentials=true}if(g.fireEvent("beforerequest",g,m)!==false){d=g.setOptions(m,l);if(this.isFormUpload(m)===true){this.upload(m.form,d.url,d.data,m);return null}if(m.autoAbort===true||g.getAutoAbort()){g.abort()}k=this.getXhrInstance();b=m.async!==false?(m.async||g.getAsync()):false;if(f){k.open(d.method,d.url,b,f,j)}else{k.open(d.method,d.url,b)}a=g.setupHeaders(k,m,d.data,d.params);e={id:++Ext.data.Connection.requestId,xhr:k,headers:a,options:m,async:b,timeout:setTimeout(function(){e.timedout=true;g.abort(e)},m.timeout||g.getTimeout())};g.requests[e.id]=e;if(b){k[h?"onload":"onreadystatechange"]=Ext.Function.bind(g.onStateChange,g,[e])}if(h){k.onerror=Ext.Function.bind(g.onStateChange,g,[e])}if(m.progress){k.onprogress=function(n){if(m.progress.isProgressable){if(n.total===0&&m.progress.getDynamic()){Ext.Logger.warn("Server is not configured to properly return Content-Length. Dynamic progress will be disabled");m.progress.setState.call(m.progress,"download");m.progress.setDynamic(false);k.onprogress=null;return}Ext.callback(m.progress.updateProgress,m.progress,[(n.loaded/n.total),"download"]);if(n.total>0&&!m.progress.getDynamic()&&m.progress.getInitialConfig().dynamic){m.progress.setDynamic(true)}}else{if(Ext.isFunction(m.progress)){Ext.callback(m.progress,m.progressScope||e,[n,"download"])}}};if(Ext.feature.has.XHRUploadProgress){k.upload.onprogress=function(n){g.fireEvent("requestuploadprogress",g,e,n);if(m.progress.isProgressable){Ext.callback(m.progress.updateProgress,m.progress,[(n.loaded/n.total),"upload"])}else{if(Ext.isFunction(m.progress)){Ext.callback(m.progress,m.progressScope||e,[n,"upload"])}}}}if(m.progress.isProgressable){if(!Ext.feature.has.XHRUploadProgress){m.progress.setDynamic(false)}Ext.callback(m.progress.startProgress,m.progress)}}k.send(d.data);if(!b){return this.onComplete(e)}return e}else{Ext.callback(m.callback,m.scope,[m,undefined,undefined]);return null}},upload:function(f,d,k,n){f=Ext.getDom(f);n=n||{};var e=Ext.id(),m=this,j=document.createElement("iframe"),l=[],h="multipart/form-data",g={target:f.target,method:f.method,encoding:f.encoding,enctype:f.enctype,action:f.action},b=function(o,p){a=document.createElement("input");Ext.fly(a).set({type:"hidden",value:p,name:o});f.appendChild(a);l.push(a)},a;Ext.fly(j).set({id:e,name:e,cls:Ext.baseCSSPrefix+"hide-display",src:Ext.SSL_SECURE_URL});document.body.appendChild(j);if(document.frames){document.frames[e].name=e}Ext.fly(f).set({target:e,method:"POST",enctype:h,encoding:h,action:d||g.action});if(k){Ext.iterate(Ext.Object.fromQueryString(k),function(o,p){if(Ext.isArray(p)){Ext.each(p,function(q){b(o,q)})}else{b(o,p)}})}j.addEventListener("load",function(){Ext.callback(m.onUploadComplete,m,[j,n,e]);j.removeEventListener("load",arguments.callee)});f.submit();Ext.fly(f).set(g);Ext.each(l,function(o){Ext.removeNode(o)})},onUploadComplete:function(h,b,j){var a={responseText:"",responseXML:null},g,f;try{g=h.contentWindow||h.contentWindow.document||h.contentDocument||window.frames[j].document;if(g){if(g.hasOwnProperty("body")&&g.body){if(this.textAreaRe.test((f=g.body.firstChild||{}).tagName)){a.responseText=f.value}else{a.responseText=g.body.innerHTML}}a.responseXML=g.XMLDocument||g}}catch(d){a.success=false;a.message="Cross-Domain access is not permitted between frames. XHR2 is recommended for this type of request.";a.error=d}this.onAfterUploadComplete(a,h,b)},onAfterUploadComplete:function(a,e,b){var d=this;d.fireEvent("requestcomplete",d,a,b);Ext.callback(b.success,b.scope,[a,b]);Ext.callback(b.callback,b.scope,[b,true,a]);setTimeout(function(){Ext.removeNode(e)},100)},isFormUpload:function(a){var b=this.getForm(a);if(b){return(a.isUpload||(this.multiPartRe).test(b.getAttribute("enctype")))}return false},getForm:function(a){return Ext.getDom(a.form)||null},setOptions:function(m,l){var j=this,f=m.params||{},h=j.getExtraParams(),e=m.urlParams,d=m.url||j.getUrl(),k=m.jsonData,b,a,g;if(Ext.isFunction(f)){f=f.call(l,m)}if(Ext.isFunction(d)){d=d.call(l,m)}d=this.setupUrl(m,d);g=m.data||m.rawData||m.binaryData||m.xmlData||k||null;if(k&&!Ext.isPrimitive(k)){g=Ext.encode(g)}if(m.binaryData){if(g instanceof Array){g=(new Uint8Array(m.binaryData))}if(g instanceof Uint8Array){g=g.buffer}}if(Ext.isObject(f)){f=Ext.Object.toQueryString(f)}if(Ext.isObject(h)){h=Ext.Object.toQueryString(h)}f=f+((h)?((f)?"&":"")+h:"");e=Ext.isObject(e)?Ext.Object.toQueryString(e):e;f=this.setupParams(m,f);b=(m.method||j.getMethod()||((f||g)?"POST":"GET")).toUpperCase();this.setupMethod(m,b);a=m.disableCaching!==false?(m.disableCaching||j.getDisableCaching()):false;if(a){d=Ext.urlAppend(d,(m.disableCachingParam||j.getDisableCachingParam())+"="+(new Date().getTime()))}if((b=="GET"||g)&&f){d=Ext.urlAppend(d,f);f=null}if(e){d=Ext.urlAppend(d,e)}return{url:d,method:b,data:g||f||null}},setupUrl:function(b,a){var d=this.getForm(b);if(d){a=a||d.action}return a},setupParams:function(a,e){var d=this.getForm(a),b;if(d&&!this.isFormUpload(a)){b=Ext.Element.serializeForm(d);e=e?(e+"&"+b):b}return e},setupMethod:function(a,b){if(this.isFormUpload(a)){return"POST"}return b},setupHeaders:function(n,o,f,d){var j=this,b=Ext.apply({},o.headers||{},j.getDefaultHeaders()||{}),m=j.getDefaultPostHeader(),k=o.jsonData,a=o.xmlData,l,g;if(!b["Content-Type"]&&(f||d)){if(f){if(o.rawData){m="text/plain"}else{if(a&&Ext.isDefined(a)){m="text/xml"}else{if(k&&Ext.isDefined(k)){m="application/json"}}}}if(!(Ext.feature.has.XHR2&&f instanceof FormData)){b["Content-Type"]=m}}if(((j.getUseDefaultXhrHeader()&&o.useDefaultXhrHeader!==false)||o.useDefaultXhrHeader)&&!b["X-Requested-With"]){b["X-Requested-With"]=j.getDefaultXhrHeader()}if(!Ext.isEmpty(o.username)&&!Ext.isEmpty(o.password)){b.Authorization="Basic "+btoa(o.username+":"+o.password)}try{for(l in b){if(b.hasOwnProperty(l)){g=b[l];n.setRequestHeader(l,g)}}}catch(h){j.fireEvent("exception",l,g)}if(o.responseType){try{n.responseType=o.responseType==="blob"&&Ext.browser.is.Safari?"arraybuffer":o.responseType}catch(h){}}if(o.withCredentials){n.withCredentials=o.withCredentials}return b},getXhrInstance:(function(){var b=[function(){return new XMLHttpRequest()},function(){return new ActiveXObject("MSXML2.XMLHTTP.3.0")},function(){return new ActiveXObject("MSXML2.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],d=0,a=b.length,g;for(;d<a;++d){try{g=b[d];g();break}catch(f){}}return g})(),isLoading:function(a){if(!(a&&a.xhr)){return false}var b=a.xhr.readyState;return !(b===0||b==4)},abort:function(b){var a=this,e=a.requests,d;if(b&&a.isLoading(b)){b.xhr.onreadystatechange=null;b.xhr.abort();a.clearTimeout(b);if(!b.timedout){b.aborted=true}a.onComplete(b);a.cleanup(b)}else{if(!b){for(d in e){if(e.hasOwnProperty(d)){a.abort(e[d])}}}}},abortAll:function(){this.abort()},onStateChange:function(a){if(a.xhr.readyState==4){this.clearTimeout(a);this.onComplete(a);this.cleanup(a)}},clearTimeout:function(a){clearTimeout(a.timeout);delete a.timeout},cleanup:function(a){a.xhr=null;delete a.xhr},onComplete:function(g){var f=this,d=g.options,a,j,b;try{a=f.parseStatus(g.xhr.status,g.xhr);if(g.timedout){a.success=false}}catch(h){a={success:false,isException:false}}j=a.success;if(j){b=f.createResponse(g);f.fireEvent("requestcomplete",f,b,d);Ext.callback(d.success,d.scope,[b,d])}else{if(a.isException||g.aborted||g.timedout){b=f.createException(g)}else{b=f.createResponse(g)}f.fireEvent("requestexception",f,b,d);Ext.callback(d.failure,d.scope,[b,d])}Ext.callback(d.callback,d.scope,[d,j,b]);if(d.progress&&d.progress.isProgressable){Ext.callback(d.progress.endProgress,d.progress,[a])}delete f.requests[g.id];return b},parseStatus:function(a,e){a=a==1223?204:a;var d=(a>=200&&a<300)||a==304||(a==0&&e.responseText&&e.responseText.length>0),b=false;if(!d){switch(a){case 12002:case 12029:case 12030:case 12031:case 12152:case 13030:b=true;break}}return{success:d,isException:b}},createResponse:function(e){var l=e.xhr,a={},m,g,n,h,k,b,f=l.responseType==="blob"||l.responseType==="arraybuffer",j=l.responseType==="text",d=l.responseType==="document";if(e.timedout||e.aborted){e.success=false;m=[]}else{m=l.getAllResponseHeaders().replace(this.lineBreakRe,"\n").split("\n")}g=m.length;while(g--){n=m[g];h=n.indexOf(":");if(h>=0){k=n.substr(0,h).toLowerCase();if(n.charAt(h+1)==" "){++h}a[k]=n.substr(h+1)}}e.xhr=null;delete e.xhr;b={request:e,requestId:e.id,status:l.status,statusText:l.statusText,getResponseHeader:function(o){return a[o.toLowerCase()]},getAllResponseHeaders:function(){return a},responseText:f?null:d?null:l.responseText,responseXML:f?null:j?null:l.responseXML,responseBytes:f?l.response:null};if(e.options.responseType==="blob"&&l.responseType==="arraybuffer"){b.responseBytes=new Blob([b.responseBytes],{type:l.getResponseHeader("Content-Type")})}l=null;return b},createException:function(a){return{request:a,requestId:a.id,status:a.aborted?-1:0,statusText:a.aborted?"transaction aborted":"communication failure",aborted:a.aborted,timedout:a.timedout}}});Ext.define("Ext.Ajax",{extend:Ext.data.Connection,singleton:true,autoAbort:false});Ext.define("Ext.ComponentQuery",{singleton:true},function(){var h=this,l=["var r = [],","i = 0,","it = items,","l = it.length,","c;","for (; i < l; i++) {","c = it[i];","if (c.{0}) {","r.push(c);","}","}","return r;"].join(""),f=function(q,p){return p.method.apply(this,[q].concat(p.args))},a=function(r,w){var p=[],s=0,v=r.length,u,q=w!==">";for(;s<v;s++){u=r[s];if(u.getRefItems){p=p.concat(u.getRefItems(q))}}return p},g=function(q){var p=[],r=0,u=q.length,s;for(;r<u;r++){s=q[r];while(!!(s=(s.ownerCt||s.floatParent))){p.push(s)}}return p},n=function(q,w,v){if(w==="*"){return q.slice()}else{var p=[],r=0,u=q.length,s;for(;r<u;r++){s=q[r];if(s.isXType(w,v)){p.push(s)}}return p}},k=function(q,u){var w=Ext.Array,p=[],r=0,v=q.length,s;for(;r<v;r++){s=q[r];if(s.el?s.el.hasCls(u):w.contains(s.initCls(),u)){p.push(s)}}return p},o=function(u,x,q,w){var z=[],s=0,p=u.length,y,v,r;for(;s<p;s++){y=u[s];v=Ext.Class.getConfigNameMap(x).get;if(y[v]){r=y[v]();if(!w?!!r:(String(r)===w)){z.push(y)}}else{if(y.config&&y.config[x]){if(!w?!!y.config[x]:(String(y.config[x])===w)){z.push(y)}}else{if(!w?!!y[x]:(String(y[x])===w)){z.push(y)}}}}return z},e=function(q,v){var p=[],r=0,u=q.length,s;for(;r<u;r++){s=q[r];if(s.getId()===v||s.getItemId()===v){p.push(s)}}return p},m=function(p,q,r){return h.pseudos[q](p,r)},j=/^(\s?([>\^])\s?|\s|$)/,d=/^(#)?([\w\-]+|\*)(?:\((true|false)\))?/,b=[{re:/^\.([\w\-]+)(?:\((true|false)\))?/,method:n},{re:/^(?:[\[](?:@)?([\w\-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]])/,method:o},{re:/^#([\w\-]+)/,method:e},{re:/^\:([\w\-]+)(?:\(((?:\{[^\}]+\})|(?:(?!\{)[^\s>\/]*?(?!\})))\))?/,method:m},{re:/^(?:\{([^\}]+)\})/,method:l}];h.Query=Ext.extend(Object,{constructor:function(p){p=p||{};Ext.apply(this,p)},execute:function(q){var s=this.operations,u=0,v=s.length,r,p;if(!q){p=Ext.ComponentManager.all.getArray()}else{if(Ext.isArray(q)){p=q}}for(;u<v;u++){r=s[u];if(r.mode==="^"){p=g(p||[q])}else{if(r.mode){p=a(p||[q],r.mode)}else{p=f(p||a([q]),r)}}if(u===v-1){return p}}return[]},is:function(r){var q=this.operations,v=Ext.isArray(r)?r:[r],p=v.length,w=q[q.length-1],u,s;v=f(v,w);if(v.length===p){if(q.length>1){for(s=0,u=v.length;s<u;s++){if(Ext.Array.indexOf(this.execute(),v[s])===-1){return false}}}return true}return false}});Ext.apply(this,{cache:{},pseudos:{not:function(w,p){var x=Ext.ComponentQuery,u=0,v=w.length,s=[],r=-1,q;for(;u<v;++u){q=w[u];if(!x.is(q,p)){s[++r]=q}}return s}},query:function(q,y){var z=q.split(","),p=z.length,r=0,s=[],A=[],x={},v,u,w;for(;r<p;r++){q=Ext.String.trim(z[r]);v=this.parse(q);s=s.concat(v.execute(y))}if(p>1){u=s.length;for(r=0;r<u;r++){w=s[r];if(!x[w.id]){A.push(w);x[w.id]=true}}s=A}return s},is:function(q,p){if(!p){return true}var r=this.cache[p];if(!r){this.cache[p]=r=this.parse(p)}return r.is(q)},parse:function(s){var q=[],r=b.length,x,u,y,z,A,v,w,p;while(s&&x!==s){x=s;u=s.match(d);if(u){y=u[1];if(y==="#"){q.push({method:e,args:[Ext.String.trim(u[2])]})}else{if(y==="."){q.push({method:k,args:[Ext.String.trim(u[2])]})}else{q.push({method:n,args:[Ext.String.trim(u[2]),Boolean(u[3])]})}}s=s.replace(u[0],"")}while(!(z=s.match(j))){for(v=0;s&&v<r;v++){w=b[v];A=s.match(w.re);p=w.method;if(A){q.push({method:Ext.isString(w.method)?Ext.functionFactory("items",Ext.String.format.apply(Ext.String,[p].concat(A.slice(1)))):w.method,args:A.slice(1)});s=s.replace(A[0],"");break}}}if(z[1]){q.push({mode:z[2]||z[1]});s=s.replace(z[0],"")}}return new h.Query({operations:q})}})});Ext.define("Ext.Decorator",{extend:Ext.Component,isDecorator:true,config:{component:{}},statics:{generateProxySetter:function(a){return function(d){var b=this.getComponent();b[a].call(b,d);return this}},generateProxyGetter:function(a){return function(){var b=this.getComponent();return b[a].call(b)}}},onClassExtended:function(d,f){if(!f.hasOwnProperty("proxyConfig")){return}var g=Ext.Class,k=f.proxyConfig,e=f.config;f.config=(e)?Ext.applyIf(e,k):k;var b,j,h,a;for(b in k){if(k.hasOwnProperty(b)){j=g.getConfigNameMap(b);h=j.set;a=j.get;f[h]=this.generateProxySetter(h);f[a]=this.generateProxyGetter(a)}}},applyComponent:function(a){return Ext.factory(a,Ext.Component)},updateComponent:function(a,b){if(b){if(this.isRendered()&&b.setRendered(false)){b.fireAction("renderedchange",[this,b,false],"doUnsetComponent",this,{args:[b]})}else{this.doUnsetComponent(b)}}if(a){if(this.isRendered()&&a.setRendered(true)){a.fireAction("renderedchange",[this,a,true],"doSetComponent",this,{args:[a]})}else{this.doSetComponent(a)}}},doUnsetComponent:function(a){if(a.renderElement.dom){a.setLayoutSizeFlags(0);this.innerElement.dom.removeChild(a.renderElement.dom)}},doSetComponent:function(a){if(a.renderElement.dom){a.setLayoutSizeFlags(this.getSizeFlags());this.innerElement.dom.appendChild(a.renderElement.dom)}},setRendered:function(b){var a;if(this.callParent(arguments)){a=this.getComponent();if(a){a.setRendered(b)}return true}return false},setDisabled:function(a){this.callParent(arguments);this.getComponent().setDisabled(a)},destroy:function(){Ext.destroy(this.getComponent());this.callParent()}});Ext.define("Ext.Label",{extend:Ext.Component,xtype:"label",config:{baseCls:Ext.baseCSSPrefix+"label"}});Ext.define("Ext.LoadMask",{extend:Ext.Mask,xtype:"loadmask",config:{message:"Loading...",cls:Ext.baseCSSPrefix+"loading-mask",messageCls:Ext.baseCSSPrefix+"mask-message",indicator:true},getTemplate:function(){var a=Ext.baseCSSPrefix;return[{reference:"innerElement",cls:a+"mask-inner",children:[{reference:"indicatorElement",cls:a+"loading-spinner-outer",children:[{cls:a+"loading-spinner",children:[{tag:"span",cls:a+"loading-top"},{tag:"span",cls:a+"loading-right"},{tag:"span",cls:a+"loading-bottom"},{tag:"span",cls:a+"loading-left"}]}]},{reference:"messageElement"}]}]},updateMessage:function(b){var a=Ext.baseCSSPrefix+"has-message";if(b){this.addCls(a)}else{this.removeCls(a)}this.messageElement.setHtml(b)},updateMessageCls:function(b,a){this.messageElement.replaceCls(a,b)},updateIndicator:function(a){this[a?"removeCls":"addCls"](Ext.baseCSSPrefix+"indicator-hidden")}},function(){});Ext.define("Ext.Title",{extend:Ext.Component,xtype:"title",config:{baseCls:"x-title",title:""},updateTitle:function(a){this.setHtml(a)}});Ext.define("Ext.Spacer",{extend:Ext.Component,alias:"widget.spacer",config:{},constructor:function(a){a=a||{};if(!a.width){a.flex=1}this.callParent([a])}});Ext.define("Ext.Toolbar",{extend:Ext.Container,xtype:"toolbar",isToolbar:true,config:{baseCls:Ext.baseCSSPrefix+"toolbar",ui:"dark",title:null,defaultType:"button",minHeight:null,layout:{type:"hbox",align:"center"}},hasCSSMinHeight:true,constructor:function(a){a=a||{};if(a.docked=="left"||a.docked=="right"){a.layout={type:"vbox",align:"stretch"}}this.callParent([a])},applyTitle:function(a){if(typeof a=="string"){a={title:a,centered:Ext.theme.is.Tizen?false:true}}return Ext.factory(a,Ext.Title,this.getTitle())},updateTitle:function(b,a){if(b){this.add(b)}if(a){a.destroy()}},showTitle:function(){var a=this.getTitle();if(a){a.show()}},hideTitle:function(){var a=this.getTitle();if(a){a.hide()}}},function(){});Ext.define("Ext.field.Input",{extend:Ext.Component,xtype:"input",tag:"input",cachedConfig:{cls:Ext.baseCSSPrefix+"form-field",focusCls:Ext.baseCSSPrefix+"field-focus",maskCls:Ext.baseCSSPrefix+"field-mask",useMask:"auto",type:"text",checked:false},config:{baseCls:Ext.baseCSSPrefix+"field-input",name:null,value:null,isFocused:false,tabIndex:null,placeHolder:null,minValue:null,maxValue:null,stepValue:null,maxLength:null,autoComplete:null,autoCapitalize:null,autoCorrect:null,readOnly:null,maxRows:null,pattern:null,startValue:false,fastFocus:true},getTemplate:function(){var a=[{reference:"input",tag:this.tag},{reference:"mask",classList:[this.config.maskCls]},{reference:"clearIcon",cls:"x-clear-icon"}];return a},initElement:function(){var a=this;a.callParent();a.input.on({scope:a,keyup:"onKeyUp",keydown:"onKeyDown",focus:"onFocus",blur:"onBlur",input:"onInput",paste:"onPaste",tap:"onInputTap"});a.mask.on({scope:a,tap:"onMaskTap"});if(a.clearIcon){a.clearIcon.on({tap:"onClearIconTap",touchstart:"onClearIconPress",touchend:"onClearIconRelease",scope:a})}if(Ext.browser.is.ie&&Ext.browser.version.major>=10){a.input.on({scope:a,keypress:"onKeyPress"})}},updateFastFocus:function(a){if(a){if(this.getFastFocus()&&Ext.os.is.iOS){this.input.on({scope:this,touchstart:"onTouchStart"})}}else{this.input.un({scope:this,touchstart:"onTouchStart"})}},useManualMaxLength:function(){return Boolean((Ext.os.is.Android&&!Ext.browser.is.Chrome))},applyUseMask:function(a){if(a==="auto"){a=Ext.os.is.iOS&&Ext.os.version.lt("5")}return Boolean(a)},updateUseMask:function(a){this.mask[a?"show":"hide"]()},updatePattern:function(a){this.updateFieldAttribute("pattern",a)},updateFieldAttribute:function(b,d){var a=this.input;if(!Ext.isEmpty(d,true)){a.dom.setAttribute(b,d)}else{a.dom.removeAttribute(b)}},updateCls:function(b,a){this.input.addCls(Ext.baseCSSPrefix+"input-el");this.input.replaceCls(a,b)},updateType:function(a,d){var b=Ext.baseCSSPrefix+"input-";this.input.replaceCls(b+d,b+a);this.updateFieldAttribute("type",a)},updateName:function(a){this.updateFieldAttribute("name",a)},getValue:function(){var a=this.input;if(a){this._value=a.dom.value}return this._value},applyValue:function(a){return(Ext.isEmpty(a))?"":a},updateValue:function(b){var a=this.input;if(a){a.dom.value=b}},setValue:function(b){var a=this._value;this.updateValue(this.applyValue(b));b=this.getValue();if(String(b)!=String(a)&&this.initialized){this.onChange(this,b,a)}return this},updateTabIndex:function(a){this.updateFieldAttribute("tabIndex",a)},testAutoFn:function(a){return[true,"on"].indexOf(a)!==-1},updateMaxLength:function(a){if(!this.useManualMaxLength()){this.updateFieldAttribute("maxlength",a)}},updatePlaceHolder:function(a){this.updateFieldAttribute("placeholder",a)},applyAutoComplete:function(a){return this.testAutoFn(a)},updateAutoComplete:function(a){var b=a?"on":"off";this.updateFieldAttribute("autocomplete",b)},applyAutoCapitalize:function(a){return this.testAutoFn(a)},updateAutoCapitalize:function(b){var a=b?"on":"off";this.updateFieldAttribute("autocapitalize",a)},applyAutoCorrect:function(a){return this.testAutoFn(a)},updateAutoCorrect:function(a){var b=a?"on":"off";this.updateFieldAttribute("autocorrect",b)},updateMinValue:function(a){this.updateFieldAttribute("min",a)},updateMaxValue:function(a){this.updateFieldAttribute("max",a)},updateStepValue:function(a){this.updateFieldAttribute("step",a)},checkedRe:/^(true|1|on)/i,getChecked:function(){var a=this.input,b;if(a){b=a.dom.checked;this._checked=b}return b},applyChecked:function(a){return !!this.checkedRe.test(String(a))},setChecked:function(a){this.updateChecked(this.applyChecked(a));this._checked=a},updateChecked:function(a){this.input.dom.checked=a},updateReadOnly:function(a){this.updateFieldAttribute("readonly",a?true:null)},updateMaxRows:function(a){this.updateFieldAttribute("rows",a)},doSetDisabled:function(a){this.callParent(arguments);if(Ext.browser.is.Safari&&!Ext.os.is.BlackBerry){this.input.dom.tabIndex=(a)?-1:0}this.input.dom.disabled=(Ext.browser.is.Safari&&!Ext.os.is.BlackBerry)?false:a;if(!a){this.blur()}},isDirty:function(){if(this.getDisabled()){return false}return String(this.getValue())!==String(this.originalValue)},reset:function(){this.setValue(this.originalValue)},onInputTap:function(a){this.fireAction("inputtap",[this,a],"doInputTap")},doInputTap:function(a,b){if(a.getDisabled()){return false}if(this.getFastFocus()&&Ext.os.is.iOS){a.focus()}},onMaskTap:function(a){this.fireAction("masktap",[this,a],"doMaskTap")},doMaskTap:function(a,b){if(a.getDisabled()){return false}a.focus()},showMask:function(){if(this.getUseMask()){this.mask.setStyle("display","block")}},hideMask:function(){if(this.getUseMask()){this.mask.setStyle("display","none")}},focus:function(){var b=this,a=b.input;if(a&&a.dom.focus){a.dom.focus()}return b},blur:function(){var b=this,a=this.input;if(a&&a.dom.blur){a.dom.blur()}return b},select:function(){var b=this,a=b.input;if(a&&a.dom.setSelectionRange){a.dom.setSelectionRange(0,9999)}return b},onFocus:function(a){this.fireAction("focus",[a],"doFocus")},doFocus:function(b){var a=this;a.hideMask();if(!a.getIsFocused()){a.setStartValue(a.getValue())}a.setIsFocused(true)},onTouchStart:function(a){if(document.activeElement!=a.target){a.preventDefault()}},onBlur:function(a){this.fireAction("blur",[a],"doBlur")},doBlur:function(f){var b=this,d=b.getValue(),a=b.getStartValue();b.showMask();b.setIsFocused(false);if(String(d)!=String(a)){b.onChange(b,d,a)}},onClearIconTap:function(a){this.fireEvent("clearicontap",this,a);if(Ext.os.is.Android){this.focus()}},onClearIconPress:function(){this.clearIcon.addCls(Ext.baseCSSPrefix+"pressing")},onClearIconRelease:function(){this.clearIcon.removeCls(Ext.baseCSSPrefix+"pressing")},onClick:function(a){this.fireEvent("click",a)},onChange:function(b,d,a){if(this.useManualMaxLength()){this.trimValueToMaxLength()}this.fireEvent("change",b,d,a)},onPaste:function(a){if(this.useManualMaxLength()){this.trimValueToMaxLength()}this.fireEvent("paste",a)},onKeyUp:function(a){if(this.useManualMaxLength()){this.trimValueToMaxLength()}this.fireEvent("keyup",a)},onKeyDown:function(){this.ignoreInput=true},onInput:function(b){var a=this;if(a.ignoreInput){a.ignoreInput=false;return}setTimeout(function(){if(!a.ignoreInput){a.fireEvent("keyup",b);a.ignoreInput=false}},10)},onKeyPress:function(a){if(a.browserEvent.keyCode==13){this.fireEvent("keyup",a)}},onMouseDown:function(a){this.fireEvent("mousedown",a)},trimValueToMaxLength:function(){var a=this.getMaxLength();if(a){var b=this.getValue();if(b.length>this.getMaxLength()){this.setValue(b.slice(0,a))}}}});Ext.define("Ext.field.Field",{extend:Ext.Decorator,alternateClassName:"Ext.form.Field",xtype:"field",isField:true,isFormField:true,config:{baseCls:Ext.baseCSSPrefix+"field",label:null,labelAlign:"left",labelWidth:"30%",labelWrap:false,clearIcon:null,required:false,inputType:null,name:null,value:null,tabIndex:null},platformConfig:[{theme:["Windows","MountainView","Blackberry","Tizen"],labelAlign:"top"}],cachedConfig:{labelCls:null,requiredCls:Ext.baseCSSPrefix+"field-required",inputCls:null},getElementConfig:function(){var a=Ext.baseCSSPrefix;return{reference:"element",className:"x-container",children:[{reference:"label",cls:a+"form-label",children:[{reference:"labelspan",tag:"span"}]},{reference:"innerElement",cls:a+"component-outer"}]}},updateLabel:function(b,e){var a=this.renderElement,d=Ext.baseCSSPrefix;if(b){this.labelspan.setHtml(b);a.addCls(d+"field-labeled")}else{a.removeCls(d+"field-labeled")}},updateLabelAlign:function(b,d){var a=this.renderElement,e=Ext.baseCSSPrefix;if(b){a.addCls(e+"label-align-"+b);if(b=="top"||b=="bottom"){this.label.setWidth("100%")}else{this.updateLabelWidth(this.getLabelWidth())}}if(d){a.removeCls(e+"label-align-"+d)}},updateLabelCls:function(a,b){if(a){this.label.addCls(a)}if(b){this.label.removeCls(b)}},updateLabelWidth:function(b){var a=this.getLabelAlign();if(b){if(a=="top"||a=="bottom"){this.label.setWidth("100%")}else{this.label.setWidth(b)}}},updateLabelWrap:function(b,d){var a=Ext.baseCSSPrefix+"form-label-nowrap";if(!b){this.addCls(a)}else{this.removeCls(a)}},updateRequired:function(a){this.renderElement[a?"addCls":"removeCls"](this.getRequiredCls())},updateRequiredCls:function(a,b){if(this.getRequired()){this.renderElement.replaceCls(b,a)}},initialize:function(){var a=this;a.callParent();a.doInitValue()},doInitValue:function(){this.originalValue=this.getInitialConfig().value},reset:function(){this.setValue(this.originalValue);return this},resetOriginalValue:function(){this.originalValue=this.getValue()},isDirty:function(){return false}},function(){});Ext.define("Ext.field.Text",{extend:Ext.field.Field,xtype:"textfield",alternateClassName:"Ext.form.Text",config:{ui:"text",clearIcon:true,placeHolder:null,maxLength:null,autoComplete:null,autoCapitalize:null,autoCorrect:null,readOnly:null,component:{xtype:"input",type:"text",fastFocus:true},bubbleEvents:["action"]},initialize:function(){var a=this;a.callParent();a.getComponent().on({scope:this,keyup:"onKeyUp",change:"onChange",focus:"onFocus",blur:"onBlur",paste:"onPaste",mousedown:"onMouseDown",clearicontap:"onClearIconTap"});a.originalValue=a.getValue()||"";a.getComponent().originalValue=a.originalValue;a.syncEmptyCls()},syncEmptyCls:function(){var b=(this._value)?this._value.length:false,a=Ext.baseCSSPrefix+"empty";if(b){this.removeCls(a)}else{this.addCls(a)}},updateValue:function(d){var b=this.getComponent(),a=d!==undefined&&d!==null&&d!=="";if(b){b.setValue(d)}this[a&&this.isDirty()?"showClearIcon":"hideClearIcon"]();this.syncEmptyCls()},getValue:function(){var a=this;a._value=a.getComponent().getValue();a.syncEmptyCls();return a._value},updatePlaceHolder:function(a){this.getComponent().setPlaceHolder(a)},updateMaxLength:function(a){this.getComponent().setMaxLength(a)},updateAutoComplete:function(a){this.getComponent().setAutoComplete(a)},updateAutoCapitalize:function(a){this.getComponent().setAutoCapitalize(a)},updateAutoCorrect:function(a){this.getComponent().setAutoCorrect(a)},updateReadOnly:function(a){if(a){this.hideClearIcon()}else{this.showClearIcon()}this.getComponent().setReadOnly(a)},updateInputType:function(a){var b=this.getComponent();if(b){b.setType(a)}},updateName:function(a){var b=this.getComponent();if(b){b.setName(a)}},updateTabIndex:function(b){var a=this.getComponent();if(a){a.setTabIndex(b)}},updateInputCls:function(a,b){var d=this.getComponent();if(d){d.replaceCls(b,a)}},doSetDisabled:function(b){var d=this;d.callParent(arguments);var a=d.getComponent();if(a){a.setDisabled(b)}if(b){d.hideClearIcon()}else{d.showClearIcon()}},showClearIcon:function(){var b=this,d=b.getValue(),a=d!==undefined&&d!==null&&d!=="";if(b.getClearIcon()&&!b.getDisabled()&&!b.getReadOnly()&&a){b.element.addCls(Ext.baseCSSPrefix+"field-clearable")}return b},hideClearIcon:function(){if(this.getClearIcon()){this.element.removeCls(Ext.baseCSSPrefix+"field-clearable")}},onKeyUp:function(a){this.fireAction("keyup",[this,a],"doKeyUp")},doKeyUp:function(b,f){var d=b.getValue(),a=d!==undefined&&d!==null&&d!=="";this[a?"showClearIcon":"hideClearIcon"]();if(f.browserEvent.keyCode===13){b.fireAction("action",[b,f],"doAction")}},doAction:function(){this.blur()},onClearIconTap:function(a){this.fireAction("clearicontap",[this,a],"doClearIconTap")},doClearIconTap:function(a,b){a.setValue("");a.getValue()},onChange:function(b,d,a){b.fireEvent("change",this,d,a)},onFocus:function(a){this.addCls(Ext.baseCSSPrefix+"field-focused");this.isFocused=true;this.fireEvent("focus",this,a)},onBlur:function(b){var a=this;this.removeCls(Ext.baseCSSPrefix+"field-focused");this.isFocused=false;a.fireEvent("blur",a,b);setTimeout(function(){a.isFocused=false},50)},onPaste:function(a){this.fireEvent("paste",this,a)},onMouseDown:function(a){this.fireEvent("mousedown",this,a)},focus:function(){this.getComponent().focus();return this},blur:function(){this.getComponent().blur();return this},select:function(){this.getComponent().select();return this},resetOriginalValue:function(){this.callParent();var a=this.getComponent();if(a&&a.hasOwnProperty("originalValue")){this.getComponent().originalValue=this.originalValue}this.reset()},reset:function(){this.getComponent().reset();this.getValue();this[this.isDirty()?"showClearIcon":"hideClearIcon"]()},isDirty:function(){var a=this.getComponent();if(a){return a.isDirty()}return false}});Ext.define("Ext.field.TextAreaInput",{extend:Ext.field.Input,xtype:"textareainput",tag:"textarea"});Ext.define("Ext.field.TextArea",{extend:Ext.field.Text,xtype:"textareafield",alternateClassName:"Ext.form.TextArea",config:{ui:"textarea",autoCapitalize:false,component:{xtype:"textareainput"},maxRows:null},updateMaxRows:function(a){this.getComponent().setMaxRows(a)},doSetHeight:function(a){this.callParent(arguments);var b=this.getComponent();b.input.setHeight(a)},doSetWidth:function(b){this.callParent(arguments);var a=this.getComponent();a.input.setWidth(b)},doKeyUp:function(a){var b=a.getValue();a[b?"showClearIcon":"hideClearIcon"]()}});Ext.define("Ext.MessageBox",{extend:Ext.Sheet,config:{ui:"dark",baseCls:Ext.baseCSSPrefix+"msgbox",iconCls:null,showAnimation:{type:"popIn",duration:250,easing:"ease-out"},hideAnimation:{type:"popOut",duration:250,easing:"ease-out"},zIndex:999,defaultTextHeight:75,title:null,buttons:null,message:null,prompt:null,modal:true,layout:{type:"vbox",pack:"center"}},platformConfig:[{theme:["Windows"],ui:"light",showAnimation:{type:"fadeIn"},hideAnimation:{type:"fadeOut"}},{theme:["Blackberry"],ui:"plain"},{theme:["MoutainView"]}],statics:{OK:{text:"OK",itemId:"ok",ui:"action"},YES:{text:"Yes",itemId:"yes",ui:"action"},NO:{text:"No",itemId:"no"},CANCEL:{text:"Cancel",itemId:"cancel"},INFO:Ext.baseCSSPrefix+"msgbox-info",WARNING:Ext.baseCSSPrefix+"msgbox-warning",QUESTION:Ext.baseCSSPrefix+"msgbox-question",ERROR:Ext.baseCSSPrefix+"msgbox-error",OKCANCEL:[{text:"Cancel",itemId:"cancel"},{text:"OK",itemId:"ok",ui:"action"}],YESNOCANCEL:[{text:"Cancel",itemId:"cancel"},{text:"No",itemId:"no"},{text:"Yes",itemId:"yes",ui:"action"}],YESNO:[{text:"No",itemId:"no"},{text:"Yes",itemId:"yes",ui:"action"}]},constructor:function(a){a=a||{};if(a.hasOwnProperty("promptConfig")){Ext.applyIf(a,{prompt:a.promptConfig});delete a.promptConfig}if(a.hasOwnProperty("multiline")||a.hasOwnProperty("multiLine")){a.prompt=a.prompt||{};Ext.applyIf(a.prompt,{multiLine:a.multiline||a.multiLine});delete a.multiline;delete a.multiLine}this.defaultAllowedConfig={};var f=["ui","showAnimation","hideAnimation","title","message","prompt","iconCls","buttons","defaultTextHeight"],e=f.length,b,d;for(b=0;b<e;b++){d=f[b];this.defaultAllowedConfig[d]=this.defaultConfig[d]}this.callParent([a])},applyTitle:function(a){if(typeof a=="string"){a={title:a}}var b="1.3em";if(Ext.theme.is.Cupertino){b="1.5em"}else{if(Ext.filterPlatform("blackberry")||Ext.filterPlatform("ie10")){b="2.6em"}}Ext.applyIf(a,{docked:"top",minHeight:b,ui:Ext.filterPlatform("blackberry")?"light":"dark",cls:this.getBaseCls()+"-title"});if(Ext.theme.is.Tizen){Ext.applyIf(a,{centered:false})}return Ext.factory(a,Ext.Toolbar,this.getTitle())},updateTitle:function(a){if(a){this.add(a)}},updateButtons:function(a){var e=this;a=(!a||a.length===0)?false:a;if(a){if(e.buttonsToolbar){e.buttonsToolbar.show();e.buttonsToolbar.removeAll();e.buttonsToolbar.setItems(a)}else{var d={type:"hbox",pack:"center"};var b=Ext.theme.is.CupertinoClassic||Ext.theme.is.MountainView||Ext.theme.is.Blackberry;e.buttonsToolbar=Ext.create("Ext.Toolbar",{docked:"bottom",defaultType:"button",defaults:{flex:(b)?1:undefined,ui:(Ext.theme.is.Blackberry)?"action":undefined},layout:d,ui:e.getUi(),cls:e.getBaseCls()+"-buttons",items:a});e.add(e.buttonsToolbar)}}else{if(e.buttonsToolbar){e.buttonsToolbar.hide()}}},applyMessage:function(a){a={html:a,cls:this.getBaseCls()+"-text"};return Ext.factory(a,Ext.Component,this._message)},updateMessage:function(a){if(a){this.add(a)}},getMessage:function(){if(this._message){return this._message.getHtml()}return null},applyIconCls:function(a){a={xtype:"component",docked:"left",width:40,height:40,baseCls:Ext.baseCSSPrefix+"icon",hidden:(a)?false:true,cls:a};return Ext.factory(a,Ext.Component,this._iconCls)},updateIconCls:function(a,b){this.getTitle();this.getButtons();if(a){this.add(a)}else{this.remove(b)}},getIconCls:function(){var b=this._iconCls,a;if(b){a=b.getCls();return(a)?a[0]:null}return null},applyPrompt:function(a){if(a){var b={label:false};if(Ext.isObject(a)){Ext.apply(b,a)}if(b.multiLine){b.height=Ext.isNumber(b.multiLine)?parseFloat(b.multiLine):this.getDefaultTextHeight();return Ext.factory(b,Ext.field.TextArea,this.getPrompt())}else{return Ext.factory(b,Ext.field.Text,this.getPrompt())}}return a},updatePrompt:function(a,b){if(a){this.add(a)}if(b){this.remove(b)}},onClick:function(d){if(d){var b=d.config.userConfig||{},e=d.getInitialConfig(),a=this.getPrompt();if(typeof b.fn=="function"){d.disable();this.on({hiddenchange:function(){b.fn.call(b.scope||null,e.itemId||e.text,a?a.getValue():null,b);d.enable()},single:true,scope:this})}if(b.input){b.input.dom.blur()}}this.hide()},show:function(g){Ext.util.InputBlocker.blockInputs();if(!this.getParent()&&Ext.Viewport){Ext.Viewport.add(this)}if(!g){return this.callParent()}var b=Ext.Object.merge({},{value:""},g);var f=g.buttons||Ext.MessageBox.OK||[],e=[],d=g;Ext.each(f,function(h){if(!h){return}e.push(Ext.apply({userConfig:d,scope:this,handler:"onClick"},h))},this);b.buttons=e;if(b.promptConfig){}b.prompt=(b.promptConfig||b.prompt)||null;if(b.multiLine){b.prompt=b.prompt||{};b.prompt.multiLine=b.multiLine;delete b.multiLine}b=Ext.merge({},this.defaultAllowedConfig,b);this.setConfig(b);var a=this.getPrompt();if(a){a.setValue(g.value||"")}this.callParent();return this},alert:function(e,d,b,a){return this.show({title:e||null,message:d||null,buttons:Ext.MessageBox.OK,promptConfig:false,fn:function(){if(b){b.apply(a,arguments)}},scope:a})},confirm:function(e,d,b,a){return this.show({title:e||null,message:d||null,buttons:Ext.MessageBox.YESNO,promptConfig:false,scope:a,fn:function(){if(b){b.apply(a,arguments)}}})},prompt:function(h,e,d,b,g,f,a){return this.show({title:h||null,message:e||null,buttons:Ext.MessageBox.OKCANCEL,scope:b,prompt:a||true,multiLine:g,value:f,fn:function(){if(d){d.apply(b,arguments)}}})}},function(a){Ext.onSetup(function(){Ext.Msg=new a})});Ext.define("Ext.SegmentedButton",{extend:Ext.Container,xtype:"segmentedbutton",config:{baseCls:Ext.baseCSSPrefix+"segmentedbutton",pressedCls:Ext.baseCSSPrefix+"button-pressed",allowMultiple:false,allowDepress:false,allowToggle:true,pressedButtons:[],layout:{type:"hbox",align:"stretch"},defaultType:"button"},initialize:function(){var a=this;a.callParent();a.on({delegate:"> button",scope:a,tap:"onButtonRelease"});a.onAfter({delegate:"> button",scope:a,hide:"onButtonHiddenChange",show:"onButtonHiddenChange"})},updateAllowMultiple:function(a){if(!this.initialized&&!this.getInitialConfig().hasOwnProperty("allowDepress")&&a){this.setAllowDepress(true)}},applyItems:function(){var f=this,g=[],e,b,d,a;f.callParent(arguments);a=this.getItems();e=a.length;for(b=0;b<e;b++){d=a.items[b];if(d.getInitialConfig("pressed")){g.push(a.items[b])}}f.updateFirstAndLastCls(a);f.setPressedButtons(g)},onButtonRelease:function(a){if(!this.getAllowToggle()){return}var e=this,f=e.getPressedButtons()||[],d=[],b;if(!e.getDisabled()&&!a.getDisabled()){if(e.getAllowMultiple()){d=f.concat(d)}b=(d.indexOf(a)!==-1)||(f.indexOf(a)!==-1);if(b&&e.getAllowDepress()){Ext.Array.remove(d,a)}else{if(!b||!e.getAllowDepress()){d.push(a)}}e.setPressedButtons(d)}},onItemAdd:function(){this.callParent(arguments);this.updateFirstAndLastCls(this.getItems())},onItemRemove:function(){this.callParent(arguments);this.updateFirstAndLastCls(this.getItems())},onButtonHiddenChange:function(){this.updateFirstAndLastCls(this.getItems())},updateFirstAndLastCls:function(b){var f=b.length,g=Ext.baseCSSPrefix,a=g+"first",h=g+"last",e,d;for(d=0;d<f;d++){e=b.items[d];e.removeCls(a);e.removeCls(h)}for(d=0;d<f;d++){e=b.items[d];if(!e.isHidden()){e.addCls(a);break}}for(d=f-1;d>=0;d--){e=b.items[d];if(!e.isHidden()){e.addCls(h);break}}},applyPressedButtons:function(a){var f=this,g=[],d,e,b;if(f.getAllowToggle()){if(Ext.isArray(a)){e=a.length;for(b=0;b<e;b++){d=f.getComponent(a[b]);if(d&&g.indexOf(d)===-1){g.push(d)}}}else{d=f.getComponent(a);if(d&&g.indexOf(d)===-1){g.push(d)}}}return g},updatePressedButtons:function(k,d){var j=this,h=j.getItems(),l=j.getPressedCls(),n=[],m,b,g,a,f;g=h.length;if(d&&d.length){for(a=0;a<g;a++){m=h.items[a];if(d.indexOf(m)!=-1&&k.indexOf(m)==-1){m.removeCls([l,m.getPressedCls()]);n.push({item:m,toggle:false})}}}g=k.length;for(a=0;a<g;a++){b=k[a];if(!d||d.indexOf(b)==-1){b.addCls(l);n.push({item:b,toggle:true})}}g=n.length;if(g&&d!==undefined){Ext.defer(function(){for(a=0;a<g;a++){f=n[a];j.fireEvent("toggle",j,f.item,f.toggle)}},50)}},isPressed:function(a){var b=this.getPressedButtons();return b.indexOf(a)!=-1},doSetDisabled:function(a){var b=this;b.items.each(function(d){d.setDisabled(a)},b);b.callParent(arguments)}},function(){});Ext.define("Ext.TitleBar",{extend:Ext.Container,xtype:"titlebar",isToolbar:true,config:{baseCls:Ext.baseCSSPrefix+"toolbar",cls:Ext.baseCSSPrefix+"navigation-bar",ui:"dark",title:null,titleAlign:"center",defaultType:"button",minHeight:null,layout:{type:"hbox"},items:[],maxButtonWidth:"40%"},platformConfig:[{theme:["Blackberry","Tizen"],titleAlign:"left"},{theme:["Cupertino"],maxButtonWidth:"80%"}],hasCSSMinHeight:true,beforeInitialize:function(){this.applyItems=this.applyInitialItems},initialize:function(){delete this.applyItems;this.add(this.initialItems);delete this.initialItems;this.on({painted:"refreshTitlePosition",single:true})},applyInitialItems:function(a){var d=this,b=d.getTitleAlign(),e=d.getDefaults()||{};d.initialItems=a;d.leftBox=d.add({xtype:"container",style:"position: relative",layout:{type:"hbox",align:"center"},listeners:{resize:"refreshTitlePosition",scope:d}});d.spacer=d.add({xtype:"component",style:"position: relative",flex:1,listeners:{resize:"refreshTitlePosition",scope:d}});d.rightBox=d.add({xtype:"container",style:"position: relative",layout:{type:"hbox",align:"center"},listeners:{resize:"refreshTitlePosition",scope:d}});switch(b){case"left":d.titleComponent=d.leftBox.add({xtype:"title",cls:Ext.baseCSSPrefix+"title-align-left",hidden:e.hidden});d.refreshTitlePosition=Ext.emptyFn;break;case"right":d.titleComponent=d.rightBox.add({xtype:"title",cls:Ext.baseCSSPrefix+"title-align-right",hidden:e.hidden});d.refreshTitlePosition=Ext.emptyFn;break;default:d.titleComponent=d.add({xtype:"title",hidden:e.hidden,centered:true});break}d.doAdd=d.doBoxAdd;d.remove=d.doBoxRemove;d.doInsert=d.doBoxInsert},doBoxAdd:function(a){if(a.config.align=="right"){this.rightBox.add(a)}else{this.leftBox.add(a)}},doBoxRemove:function(b,a){if(b.config.align=="right"){this.rightBox.remove(b,a)}else{this.leftBox.remove(b,a)}},doBoxInsert:function(a,b){if(b.config.align=="right"){this.rightBox.insert(a,b)}else{this.leftBox.insert(a,b)}},calculateMaxButtonWidth:function(){var a=this.getMaxButtonWidth();if(Ext.isString(a)){a=parseInt(a.replace("%",""),10)}a=Math.round((this.element.getWidth()/100)*a);return a},refreshTitlePosition:function(){if(this.isDestroyed){return}var h=this.titleComponent.renderElement;h.setWidth(null);h.setLeft(null);var b=this.leftBox,e=b.down("button"),a=b.getItems().getCount()==1,k,p;if(e&&a){if(e.getWidth()==null){e.renderElement.setWidth("auto")}k=b.renderElement.getWidth();p=this.calculateMaxButtonWidth();if(k>p){e.renderElement.setWidth(p)}}var m=this.spacer.renderElement.getPageBox();if(Ext.browser.is.IE){h.setWidth(m.width)}var n=h.getPageBox(),j=n.width-m.width,f=n.left,l=n.right,d,o,g;if(j>0){d=j/2;f+=d;l-=d;h.setWidth(m.width)}o=m.left-f;g=l-m.right;if(o>0){h.setLeft(o)}else{if(g>0){h.setLeft(-g)}}h.repaint()},updateTitle:function(a){this.titleComponent.setTitle(a);if(this.isPainted()){this.refreshTitlePosition()}}});Ext.define("Ext.app.Action",{config:{scope:null,application:null,controller:null,action:null,args:[],url:undefined,data:{},title:null,beforeFilters:[],currentFilterIndex:-1},constructor:function(a){this.initConfig(a);this.getUrl()},applyBeforeFilters:function(a){return a||[]},execute:function(){this.resume()},resume:function(){var b=this.getCurrentFilterIndex()+1,d=this.getBeforeFilters(),a=this.getController(),e=d[b];if(e){this.setCurrentFilterIndex(b);e.call(a,this)}else{a[this.getAction()].apply(a,this.getArgs())}},applyUrl:function(a){if(a===null||a===undefined){a=this.urlEncode()}return a},applyController:function(a){var d=this.getApplication(),b=d.getCurrentProfile();if(Ext.isString(a)){a=d.getController(a,b?b.getNamespace():null)}return a},urlEncode:function(){var a=this.getController(),b;if(a instanceof Ext.app.Controller){b=a.$className.split(".");a=b[b.length-1]}return a+"/"+this.getAction()}});Ext.define("Ext.app.Controller",{mixins:{observable:Ext.mixin.Observable},config:{refs:{},routes:{},control:{},before:{},application:{},stores:[],models:[],views:[]},constructor:function(a){this.initConfig(a);this.mixins.observable.constructor.call(this,a)},init:Ext.emptyFn,launch:Ext.emptyFn,redirectTo:function(a){return this.getApplication().redirectTo(a)},execute:function(b,a){b.setBeforeFilters(this.getBefore()[b.getAction()]);b.execute()},applyBefore:function(f){var e,a,d,b;for(a in f){e=Ext.Array.from(f[a]);d=e.length;for(b=0;b<d;b++){e[b]=this[e[b]]}f[a]=e}return f},applyControl:function(a){this.control(a,this);return a},applyRefs:function(a){this.ref(a);return a},applyRoutes:function(a){var g=this instanceof Ext.app.Application?this:this.getApplication(),d=g.getRouter(),b,f,e;for(f in a){b=a[f];e={controller:this.$className};if(Ext.isString(b)){e.action=b}else{Ext.apply(e,b)}d.connect(f,e)}return a},applyStores:function(a){return this.getFullyQualified(a,"store")},applyModels:function(a){return this.getFullyQualified(a,"model")},applyViews:function(a){return this.getFullyQualified(a,"view")},getFullyQualified:function(b,f){var g=b.length,a=this.getApplication().getName(),d,e;for(e=0;e<g;e++){d=b[e];if(Ext.isString(d)&&(Ext.Loader.getPrefix(d)===""||d===a)){b[e]=a+"."+f+"."+d}}return b},control:function(a){this.getApplication().control(a,this)},ref:function(b){var e=this,g,d,a,f;for(g in b){a=b[g];d="get"+Ext.String.capitalize(g);if(!this[d]){if(Ext.isString(b[g])){f={ref:g,selector:a}}else{f=b[g]}this[d]=function(k,j){var h=[k,j];return function(){return e.getRef.apply(e,h.concat.apply(h,arguments))}}(g,f)}this.references=this.references||[];this.references.push(g.toLowerCase())}},getRef:function(e,f,a){this.refCache=this.refCache||{};f=f||{};a=a||{};Ext.apply(f,a);if(f.forceCreate){return Ext.ComponentManager.create(f,"component")}var d=this,b=d.refCache[e];if(!b){d.refCache[e]=b=Ext.ComponentQuery.query(f.selector)[0];if(!b&&f.autoCreate){d.refCache[e]=b=Ext.ComponentManager.create(f,"component")}if(b){b.on("destroy",function(){d.refCache[e]=null})}}return b},hasRef:function(a){return this.references&&this.references.indexOf(a.toLowerCase())!==-1}},function(){});Ext.define("Ext.app.History",{mixins:[Ext.mixin.Observable],config:{actions:[],updateUrl:true,token:""},constructor:function(a){if(Ext.feature.has.History){window.addEventListener("hashchange",Ext.bind(this.detectStateChange,this))}else{setInterval(Ext.bind(this.detectStateChange,this),100)}this.initConfig(a);if(a&&Ext.isEmpty(a.token)){this.setToken(window.location.hash.substr(1))}},add:function(d,a){d=Ext.factory(d,Ext.app.Action);this.getActions().push(d);var b=d.getUrl();if(this.getUpdateUrl()){this.setToken(b);window.location.hash=b}if(a!==true){this.fireEvent("change",b)}this.setToken(b)},back:function(){var b=this.getActions(),a=b[b.length-2];if(a){b.pop();a.getController().getApplication().redirectTo(a.getUrl())}else{b[b.length-1].getController().getApplication().redirectTo("")}},applyToken:function(a){return a[0]=="#"?a.substr(1):a},detectStateChange:function(){var b=this.applyToken(window.location.hash),a=this.getToken();if(b!=a){this.onStateChange();this.setToken(b)}},onStateChange:function(){this.fireEvent("change",window.location.hash.substr(1))}});Ext.define("Ext.app.Profile",{mixins:{observable:Ext.mixin.Observable},config:{namespace:"auto",name:"auto",controllers:[],models:[],views:[],stores:[],application:null},constructor:function(a){this.initConfig(a);this.mixins.observable.constructor.apply(this,arguments)},isActive:function(){return false},launch:Ext.emptyFn,applyNamespace:function(a){if(a=="auto"){a=this.getName()}return a.toLowerCase()},applyName:function(a){if(a=="auto"){var b=this.$className.split(".");a=b[b.length-1]}return a},getDependencies:function(){var d=[],h=Ext.String.format,b=this.getApplication().getName(),e=this.getNamespace(),g={model:this.getModels(),view:this.getViews(),controller:this.getControllers(),store:this.getStores()},f,j,a;for(f in g){j=[];Ext.each(g[f],function(k){if(Ext.isString(k)){if(Ext.isString(k)&&(Ext.Loader.getPrefix(k)===""||k===b)){k=b+"."+f+"."+e+"."+k}j.push(k);d.push(k)}},this);g[f]=j}g.all=d;return g}});Ext.define("Ext.app.Route",{config:{conditions:{},url:null,controller:null,action:null,initialized:false},constructor:function(a){this.initConfig(a)},recognize:function(b){if(!this.getInitialized()){this.initialize()}if(this.recognizes(b)){var d=this.matchesFor(b),a=b.match(this.matcherRegex);a.shift();return Ext.applyIf(d,{controller:this.getController(),action:this.getAction(),url:b,args:a,historyUrl:b})}},initialize:function(){this.paramMatchingRegex=new RegExp(/:([0-9A-Za-z\_]*)/g);this.paramsInMatchString=this.getUrl().match(this.paramMatchingRegex)||[];this.matcherRegex=this.createMatcherRegex(this.getUrl());this.setInitialized(true)},recognizes:function(a){return this.matcherRegex.test(a)},matchesFor:function(b){var g={},f=this.paramsInMatchString,a=b.match(this.matcherRegex),e=f.length,d;a.shift();for(d=0;d<e;d++){g[f[d].replace(":","")]=a[d]}return g},argsFor:function(d){var b=[],g=this.paramsInMatchString,a=d.match(this.matcherRegex),f=g.length,e;a.shift();for(e=0;e<f;e++){b.push(g[e].replace(":",""));params[g[e].replace(":","")]=a[e]}return params},urlFor:function(b){var a=this.getUrl();for(var d in b){a=a.replace(":"+d,b[d])}return a},createMatcherRegex:function(a){var f=this.paramsInMatchString,e=f.length,b,d,g;for(b=0;b<e;b++){d=this.getConditions()[f[b]];g=Ext.util.Format.format("({0})",d||"[%a-zA-Z0-9\\-\\_\\s,]+");a=a.replace(new RegExp(f[b]),g)}return new RegExp("^"+a+"$")}});Ext.define("Ext.app.Router",{config:{routes:[],defaults:{action:"index"}},constructor:function(a){this.initConfig(a)},connect:function(b,d){d=Ext.apply({url:b},d||{},this.getDefaults());var a=Ext.create("Ext.app.Route",d);this.getRoutes().push(a);return a},recognize:function(d){var b=this.getRoutes(),f=b.length,e,a;for(e=0;e<f;e++){a=b[e].recognize(d);if(a!==undefined){return a}}return undefined},draw:function(a){a.call(this,this)},clear:function(){this.setRoutes([])}},function(){});Ext.define("Ext.app.Application",{extend:Ext.app.Controller,config:{profiles:[],controllers:[],history:{},name:null,appFolder:"app",router:{},controllerInstances:[],profileInstances:[],currentProfile:null,launch:Ext.emptyFn,enableLoader:true,requires:[],themeVariationPrefix:Ext.baseCSSPrefix+"theme-variation-",themeVariationTransitionCls:null,themeVariation:null},constructor:function(a){a=a||{};Ext.applyIf(a,{application:this});this.initConfig(a);for(var b in a){this[b]=a[b]}Ext.require(this.getRequires(),function(){if(this.getEnableLoader()!==false){Ext.require(this.getProfiles(),this.onProfilesLoaded,this)}},this)},dispatch:function(f,e){f=f||{};Ext.applyIf(f,{application:this});f=Ext.factory(f,Ext.app.Action);if(f){var d=this.getCurrentProfile(),b=d?d.getNamespace():undefined,a=this.getController(f.getController(),b);if(a){if(e!==false){this.getHistory().add(f,true)}a.execute(f)}}},redirectTo:function(d){if(Ext.data&&Ext.data.Model&&d instanceof Ext.data.Model){var a=d;d=a.toUrl()}var b=this.getRouter().recognize(d);if(b){b.url=d;if(a){b.data={};b.data.record=a}return this.dispatch(b)}},control:function(j,e){e=e||this;var k=this.getEventDispatcher(),h=(e)?e.getRefs():{},d,f,b,g,a;for(d in j){if(j.hasOwnProperty(d)){g=j[d];a=h[d];if(a){d=a.selector||a}for(f in g){b=g[f];if(Ext.isString(b)){b=e[b]}k.addListener("component",d,f,b,e)}}}},getController:function(b,e){var g=this.getControllerInstances(),a=this.getName(),f=Ext.String.format,d;if(b instanceof Ext.app.Controller){return b}if(g[b]){return g[b]}else{d=f("{0}.controller.{1}",a,b);e=f("{0}.controller.{1}.{2}",a,e,b);return g[e]||g[d]}},onProfilesLoaded:function(){var b=this.getProfiles(),f=b.length,h=[],e=this.gatherDependencies(),g,d,a;for(d=0;d<f;d++){h[d]=Ext.create(b[d],{application:this});a=h[d].getDependencies();e=e.concat(a.all);if(h[d].isActive()&&!g){g=h[d];this.setCurrentProfile(g);this.setControllers(this.getControllers().concat(a.controller));this.setModels(this.getModels().concat(a.model));this.setViews(this.getViews().concat(a.view));this.setStores(this.getStores().concat(a.store))}}this.setProfileInstances(h);Ext.require(e,this.loadControllerDependencies,this)},loadControllerDependencies:function(){this.instantiateControllers();var h=this.getControllerInstances(),g=[],d=[],f,b,a,e;for(e in h){b=h[e];a=b.getStores();d=d.concat(a);g=g.concat(b.getModels().concat(b.getViews()).concat(a))}this.setStores(this.getStores().concat(d));Ext.require(g,this.onDependenciesLoaded,this)},onDependenciesLoaded:function(){var d=this,b=this.getCurrentProfile(),f=this.getLaunch(),e,a;this.instantiateStores();e=this.getControllerInstances();for(a in e){e[a].init(this)}if(b){b.launch()}f.call(d);for(a in e){e[a].launch(this)}d.redirectTo(window.location.hash.substr(1))},gatherDependencies:function(){var a=this.getModels().concat(this.getViews()).concat(this.getControllers());Ext.each(this.getStores(),function(b){if(Ext.isString(b)){a.push(b)}},this);return a},instantiateStores:function(){var b=this.getStores(),g=b.length,d,a,e,h,f;for(f=0;f<g;f++){d=b[f];if(Ext.data&&Ext.data.Store&&!(d instanceof Ext.data.Store)){if(Ext.isString(d)){e=d;a=Ext.ClassManager.classes[d];d={xclass:d};if(a.prototype.defaultConfig.storeId===undefined){h=e.split(".");d.id=h[h.length-1]}}b[f]=Ext.factory(d,Ext.data.Store)}}this.setStores(b)},instantiateControllers:function(){var f=this.getControllers(),e={},d=f.length,a,b;for(b=0;b<d;b++){a=f[b];e[a]=Ext.create(a,{application:this})}return this.setControllerInstances(e)},applyControllers:function(a){return this.getFullyQualified(a,"controller")},applyProfiles:function(a){return this.getFullyQualified(a,"profile")},applyName:function(a){var b;if(a&&a.match(/ /g)){b=a;a=a.replace(/ /g,"")}return a},updateName:function(a){Ext.ClassManager.setNamespace(a+".app",this);if(!Ext.Loader.config.paths[a]){Ext.Loader.setPath(a,this.getAppFolder())}},applyRouter:function(a){return Ext.factory(a,Ext.app.Router,this.getRouter())},applyHistory:function(a){var b=Ext.factory(a,Ext.app.History,this.getHistory());b.on("change",this.onHistoryChange,this);return b},onHistoryChange:function(a){this.dispatch(this.getRouter().recognize(a),false)},updateThemeVariation:function(j,m){var g=Ext.getBody().getParent(),e=this.getThemeVariationPrefix()||"",l=this.getThemeVariationTransitionCls();if(Ext.isFunction(j)){j=j.call(this)}if(!Ext.isString(j)){Ext.Error.raise("Theme variation must be a String.'")}if(l){var h="",d=0,n=document.styleSheets[0].cssRules,f,k,a,b;g.addCls(l);for(f in n){k=n[f];if(k.selectorText&&k.selectorText.indexOf("."+l)>=1){h+=k.cssText}}a=h.match(/[0-9]+s/g);for(f in a){b=parseInt(a[f]);if(b>d){d=b}}if(this.$themeVariationChangeTimeout){clearTimeout(this.$themeVariationChangeTimeout);this.$themeVariationChangeTimeout=null}this.$themeVariationChangeTimeout=Ext.defer(function(){g.removeCls(l)},b*1000)}g.removeCls(e+m);g.addCls(e+j)}},function(){});Ext.define("Ext.mixin.Sortable",{extend:Ext.mixin.Mixin,mixinConfig:{id:"sortable"},config:{sorters:null,defaultSortDirection:"ASC",sortRoot:null},dirtySortFn:false,sortFn:null,sorted:false,applySorters:function(a,b){if(!b){b=this.createSortersCollection()}b.clear();this.sorted=false;if(a){this.addSorters(a)}return b},createSortersCollection:function(){this._sorters=Ext.create("Ext.util.Collection",function(a){return a.getId()});return this._sorters},addSorter:function(b,a){this.addSorters([b],a)},addSorters:function(d,a){var b=this.getSorters();return this.insertSorters(b?b.length:0,d,a)},insertSorter:function(a,d,b){return this.insertSorters(a,[d],b)},insertSorters:function(f,j,a){if(!Ext.isArray(j)){j=[j]}var g=j.length,k=a||this.getDefaultSortDirection(),d=this.getSortRoot(),l=this.getSorters(),m=[],h,b,n,e;if(!l){l=this.createSortersCollection()}for(b=0;b<g;b++){n=j[b];h={direction:k,root:d};if(typeof n==="string"){e=l.get(n);if(!e){h.property=n}else{if(a){e.setDirection(a)}else{e.toggle()}continue}}else{if(Ext.isFunction(n)){h.sorterFn=n}else{if(Ext.isObject(n)){if(!n.isSorter){if(n.fn){n.sorterFn=n.fn;delete n.fn}h=Ext.apply(h,n)}else{m.push(n);if(!n.getRoot()){n.setRoot(d)}continue}}}}n=Ext.create("Ext.util.Sorter",h);m.push(n)}for(b=0,g=m.length;b<g;b++){l.insert(f+b,m[b])}this.dirtySortFn=true;if(l.length){this.sorted=true}return l},removeSorter:function(a){return this.removeSorters([a])},removeSorters:function(e){if(!Ext.isArray(e)){e=[e]}var b=e.length,d=this.getSorters(),a,f;for(a=0;a<b;a++){f=e[a];if(typeof f==="string"){d.removeAtKey(f)}else{if(typeof f==="function"){d.each(function(g){if(g.getSorterFn()===f){d.remove(g)}})}else{if(f.isSorter){d.remove(f)}}}}if(!d.length){this.sorted=false}},updateSortFn:function(){var a=this.getSorters().items;this.sortFn=function(e,d){var g=a.length,b,f;for(f=0;f<g;f++){b=a[f].sort.call(this,e,d);if(b!==0){break}}return b};this.dirtySortFn=false;return this.sortFn},getSortFn:function(){if(this.dirtySortFn){return this.updateSortFn()}return this.sortFn},sort:function(a){Ext.Array.sort(a,this.getSortFn());return a},findInsertionIndex:function(b,f,h){var j=0,a=b.length-1,e=h||this.getSortFn(),d,g;while(j<=a){d=(j+a)>>1;g=e(f,b[d]);if(g>=0){j=d+1}else{if(g<0){a=d-1}}}return j}});Ext.define("Ext.mixin.Filterable",{extend:Ext.mixin.Mixin,mixinConfig:{id:"filterable"},config:{filters:null,filterRoot:null},dirtyFilterFn:false,filterFn:null,filtered:false,applyFilters:function(a,b){if(!b){b=this.createFiltersCollection()}b.clear();this.filtered=false;this.dirtyFilterFn=true;if(a){this.addFilters(a)}return b},createFiltersCollection:function(){this._filters=Ext.create("Ext.util.Collection",function(a){return a.getId()});return this._filters},addFilter:function(a){this.addFilters([a])},addFilters:function(b){var a=this.getFilters();return this.insertFilters(a?a.length:0,b)},insertFilter:function(a,b){return this.insertFilters(a,[b])},insertFilters:function(j,d){if(!Ext.isArray(d)){d=[d]}var k=d.length,a=this.getFilterRoot(),e=this.getFilters(),f=[],g,h,b;if(!e){e=this.createFiltersCollection()}for(h=0;h<k;h++){b=d[h];g={root:a};if(Ext.isFunction(b)){g.filterFn=b}else{if(Ext.isObject(b)){if(!b.isFilter){if(b.fn){b.filterFn=b.fn;delete b.fn}g=Ext.apply(g,b)}else{f.push(b);if(!b.getRoot()){b.setRoot(a)}continue}}}b=Ext.create("Ext.util.Filter",g);f.push(b)}for(h=0,k=f.length;h<k;h++){e.insert(j+h,f[h])}this.dirtyFilterFn=true;if(e.length){this.filtered=true}return e},removeFilters:function(f){if(!Ext.isArray(f)){f=[f]}var e=f.length,d=this.getFilters(),a,b;for(a=0;a<e;a++){b=f[a];if(typeof b==="string"){d.each(function(g){if(g.getProperty()===b){d.remove(g)}})}else{if(typeof b==="function"){d.each(function(g){if(g.getFilterFn()===b){d.remove(g)}})}else{if(b.isFilter){d.remove(b)}else{if(b.property!==undefined&&b.value!==undefined){d.each(function(g){if(g.getProperty()===b.property&&g.getValue()===b.value){d.remove(g)}})}}}}}if(!d.length){this.filtered=false}},updateFilterFn:function(){var a=this.getFilters().items;this.filterFn=function(j){var g=true,h=a.length,b;for(b=0;b<h;b++){var f=a[b],e=f.getFilterFn(),d=f.getScope()||this;g=g&&e.call(d,j)}return g};this.dirtyFilterFn=false;return this.filterFn},filter:function(a){return this.getFilters().length?Ext.Array.filter(a,this.getFilterFn()):a},isFiltered:function(a){return this.getFilters().length?!this.getFilterFn()(a):false},getFilterFn:function(){if(this.dirtyFilterFn){return this.updateFilterFn()}return this.filterFn}});Ext.define("Ext.util.Collection",{config:{autoFilter:true,autoSort:true},mixins:{sortable:Ext.mixin.Sortable,filterable:Ext.mixin.Filterable},constructor:function(b,a){var d=this;d.all=[];d.items=[];d.keys=[];d.indices={};d.map={};d.length=0;if(b){d.getKey=b}this.initConfig(a)},updateAutoSort:function(a,b){if(b===false&&a&&this.items.length){this.sort()}},updateAutoFilter:function(b,a){if(a===false&&b&&this.all.length){this.filter()}},insertSorters:function(){this.mixins.sortable.insertSorters.apply(this,arguments);if(this.getAutoSort()&&this.items.length){this.sort()}return this},removeSorters:function(a){this.mixins.sortable.removeSorters.call(this,a);if(this.sorted&&this.getAutoSort()&&this.items.length){this.sort()}return this},applyFilters:function(a){var b=this.mixins.filterable.applyFilters.call(this,a);if(!a&&this.all.length&&this.getAutoFilter()){this.filter()}return b},addFilters:function(a){this.mixins.filterable.addFilters.call(this,a);if(this.items.length&&this.getAutoFilter()){this.filter()}return this},removeFilters:function(a){this.mixins.filterable.removeFilters.call(this,a);if(this.filtered&&this.all.length&&this.getAutoFilter()){this.filter()}return this},filter:function(d,b,e,a){if(d){if(Ext.isString(d)){this.addFilters({property:d,value:b,anyMatch:e,caseSensitive:a});return this.items}else{this.addFilters(d);return this.items}}this.items=this.mixins.filterable.filter.call(this,this.all.slice());this.updateAfterFilter();if(this.sorted&&this.getAutoSort()){this.sort()}},updateAfterFilter:function(){var a=this.items,g=this.keys,h=this.indices={},f=a.length,d,e,b;g.length=0;for(d=0;d<f;d++){e=a[d];b=this.getKey(e);h[b]=d;g[d]=b}this.length=a.length;this.dirtyIndices=false},sort:function(f,a){var e=this.items,j=this.keys,h=this.indices,d=e.length,b,k,g;if(f){this.addSorters(f,a);return this.items}for(b=0;b<d;b++){e[b]._current_key=j[b]}this.handleSort(e);for(b=0;b<d;b++){k=e[b];g=k._current_key;j[b]=g;h[g]=b;delete k._current_key}this.dirtyIndices=true},handleSort:function(a){this.mixins.sortable.sort.call(this,a)},add:function(k,m){var h=this,e=this.filtered,f=this.sorted,j=this.all,g=this.items,n=this.keys,l=this.indices,a=this.mixins.filterable,b=g.length,d=b;if(arguments.length==1){m=k;k=h.getKey(m)}if(typeof k!="undefined"&&k!==null){if(typeof h.map[k]!="undefined"){return h.replace(k,m)}h.map[k]=m}j.push(m);if(e&&this.getAutoFilter()&&a.isFiltered.call(h,m)){return null}h.length++;if(f&&this.getAutoSort()){d=this.findInsertionIndex(g,m)}if(d!==b){this.dirtyIndices=true;Ext.Array.splice(n,d,0,k);Ext.Array.splice(g,d,0,m)}else{l[k]=b;n.push(k);g.push(m)}return m},getKey:function(a){return a.id},replace:function(e,o){var k=this,h=k.sorted,g=k.filtered,b=k.mixins.filterable,j=k.items,p=k.keys,m=k.all,d=k.map,n=null,a=j.length,q,f,l;if(arguments.length==1){o=e;e=l=k.getKey(o)}else{l=k.getKey(o)}q=d[e];if(typeof e=="undefined"||e===null||typeof q=="undefined"){return k.add(l,o)}k.map[l]=o;if(l!==e){delete k.map[e]}if(h&&k.getAutoSort()){Ext.Array.remove(j,q);Ext.Array.remove(p,e);Ext.Array.remove(m,q);m.push(o);k.dirtyIndices=true;if(g&&k.getAutoFilter()){if(b.isFiltered.call(k,o)){if(a!==j.length){k.length--}return null}else{if(a===j.length){k.length++;n=o}}}f=this.findInsertionIndex(j,o);Ext.Array.splice(p,f,0,l);Ext.Array.splice(j,f,0,o)}else{if(g){if(k.getAutoFilter()&&b.isFiltered.call(k,o)){if(k.indexOf(q)!==-1){Ext.Array.remove(j,q);Ext.Array.remove(p,e);k.length--;k.dirtyIndices=true}return null}else{if(k.indexOf(q)===-1){j.push(o);p.push(l);k.indices[l]=k.length;k.length++;return o}}}f=k.indexOf(q);p[f]=l;j[f]=o;if(l!==e){this.dirtyIndices=true}}return n},addAll:function(j){var r=this,f=r.filtered,a=r.sorted,b=r.all,l=r.items,k=r.keys,q=r.map,m=r.getAutoFilter(),n=r.getAutoSort(),s=[],g=[],d=r.mixins.filterable,e=[],h,u,o,p;if(Ext.isObject(j)){for(u in j){if(j.hasOwnProperty(u)){g.push(l[u]);s.push(u)}}}else{g=j;h=j.length;for(o=0;o<h;o++){s.push(r.getKey(j[o]))}}for(o=0;o<h;o++){u=s[o];p=g[o];if(typeof u!="undefined"&&u!==null){if(typeof q[u]!="undefined"){r.replace(u,p);continue}q[u]=p}b.push(p);if(f&&m&&d.isFiltered.call(r,p)){continue}r.length++;k.push(u);l.push(p);e.push(p)}if(e.length){r.dirtyIndices=true;if(a&&n){r.sort()}return e}return null},each:function(f,e){var b=this.items.slice(),d=0,a=b.length,g;for(;d<a;d++){g=b[d];if(f.call(e||g,g,d,a)===false){break}}},eachKey:function(e,d){var g=this.keys,a=this.items,f=g.length,b;for(b=0;b<f;b++){e.call(d||window,g[b],a[b],b,f)}},findBy:function(f,e){var g=this.keys,b=this.items,d=0,a=b.length;for(;d<a;d++){if(f.call(e||window,b[d],g[d])){return b[d]}}return null},filterBy:function(f,e){var j=this,d=new this.self(),h=j.keys,a=j.all,g=a.length,b;d.getKey=j.getKey;for(b=0;b<g;b++){if(f.call(e||j,a[b],j.getKey(a[b]))){d.add(h[b],a[b])}}return d},insert:function(d,e,g){var f=this,a=this.sorted,h=this.map,b=this.filtered;if(arguments.length==2){g=e;e=f.getKey(g)}if(d>=f.length||(a&&f.getAutoSort())){return f.add(e,g)}if(typeof e!="undefined"&&e!==null){if(typeof h[e]!="undefined"){f.replace(e,g);return false}h[e]=g}this.all.push(g);if(b&&this.getAutoFilter()&&this.mixins.filterable.isFiltered.call(f,g)){return null}f.length++;Ext.Array.splice(f.items,d,0,g);Ext.Array.splice(f.keys,d,0,e);f.dirtyIndices=true;return g},insertAll:function(h,e){if(h>=this.items.length||(this.sorted&&this.getAutoSort())){return this.addAll(e)}var u=this,j=this.filtered,a=this.sorted,b=this.all,n=this.items,m=this.keys,s=this.map,o=this.getAutoFilter(),p=this.getAutoSort(),v=[],k=[],g=[],d=this.mixins.filterable,f=false,l,w,q,r;if(a&&this.getAutoSort()){}if(Ext.isObject(e)){for(w in e){if(e.hasOwnProperty(w)){k.push(n[w]);v.push(w)}}}else{k=e;l=e.length;for(q=0;q<l;q++){v.push(u.getKey(e[q]))}}for(q=0;q<l;q++){w=v[q];r=k[q];if(typeof w!="undefined"&&w!==null){if(typeof s[w]!="undefined"){u.replace(w,r);continue}s[w]=r}b.push(r);if(j&&o&&d.isFiltered.call(u,r)){continue}u.length++;Ext.Array.splice(n,h+q,0,r);Ext.Array.splice(m,h+q,0,w);f=true;g.push(r)}if(f){this.dirtyIndices=true;if(a&&p){this.sort()}return g}return null},remove:function(d){var a=this.items.indexOf(d);if(a===-1){Ext.Array.remove(this.all,d);if(typeof this.getKey=="function"){var b=this.getKey(d);if(b!==undefined){delete this.map[b]}}return d}return this.removeAt(this.items.indexOf(d))},removeAll:function(a){if(a){var d=a.length,b;for(b=0;b<d;b++){this.remove(a[b])}}return this},removeAt:function(b){var h=this,a=h.items,g=h.keys,e=h.all,f,d;if(b<h.length&&b>=0){f=a[b];d=g[b];if(typeof d!="undefined"){delete h.map[d]}Ext.Array.erase(a,b,1);Ext.Array.erase(g,b,1);Ext.Array.remove(e,f);delete h.indices[d];h.length--;this.dirtyIndices=true;return f}return false},removeAtKey:function(a){return this.removeAt(this.indexOfKey(a))},getCount:function(){return this.length},indexOf:function(b){if(this.dirtyIndices){this.updateIndices()}var a=b?this.indices[this.getKey(b)]:-1;return(a===undefined)?-1:a},indexOfKey:function(b){if(this.dirtyIndices){this.updateIndices()}var a=this.indices[b];return(a===undefined)?-1:a},updateIndices:function(){var a=this.items,f=a.length,g=this.indices={},d,e,b;for(d=0;d<f;d++){e=a[d];b=this.getKey(e);g[b]=d}this.dirtyIndices=false},get:function(b){var e=this,a=e.map[b],d;if(a!==undefined){d=a}else{if(typeof b=="number"){d=e.items[b]}}return typeof d!="function"||e.getAllowFunctions()?d:null},getAt:function(a){return this.items[a]},getByKey:function(a){return this.map[a]},contains:function(b){var a=this.getKey(b);if(a){return this.containsKey(a)}else{return Ext.Array.contains(this.items,b)}},containsKey:function(a){return typeof this.map[a]!="undefined"},clear:function(){var a=this;a.length=0;a.items.length=0;a.keys.length=0;a.all.length=0;a.dirtyIndices=true;a.indices={};a.map={}},first:function(){return this.items[0]},last:function(){return this.items[this.length-1]},getRange:function(g,a){var f=this,d=f.items,b=[],e;if(d.length<1){return b}g=g||0;a=Math.min(typeof a=="undefined"?f.length-1:a,f.length-1);if(g<=a){for(e=g;e<=a;e++){b[b.length]=d[e]}}else{for(e=g;e>=a;e--){b[b.length]=d[e]}}return b},findIndexBy:function(e,d,j){var h=this,g=h.keys,a=h.items,b=j||0,f=a.length;for(;b<f;b++){if(e.call(d||h,a[b],g[b])){return b}}return -1},clone:function(){var f=this,g=new this.self(),e=f.keys,a=f.items,b=0,d=a.length;for(;b<d;b++){g.add(e[b],a[b])}g.getKey=f.getKey;return g},destroy:function(){this.callSuper();this.clear()}});Ext.define("Ext.data.ResultSet",{config:{loaded:true,count:null,total:null,success:false,records:null,message:null},constructor:function(a){this.initConfig(a)},applyCount:function(a){if(!a&&a!==0){return this.getRecords().length}return a},updateRecords:function(a){this.setCount(a.length)}});Ext.define("Ext.data.reader.Reader",{alternateClassName:["Ext.data.Reader","Ext.data.DataReader"],mixins:[Ext.mixin.Observable],isReader:true,config:{idProperty:undefined,clientIdProperty:"clientId",totalProperty:"total",successProperty:"success",messageProperty:null,rootProperty:"",implicitIncludes:true,model:undefined},constructor:function(a){this.initConfig(a)},fieldCount:0,applyModel:function(a){if(typeof a=="string"){a=Ext.data.ModelManager.getModel(a);if(!a){Ext.Logger.error("Model with name "+arguments[0]+" doesnt exist.")}}if(a&&!a.prototype.isModel&&Ext.isObject(a)){a=Ext.data.ModelManager.registerType(a.storeId||a.id||Ext.id(),a)}return a},applyIdProperty:function(a){if(!a&&this.getModel()){a=this.getModel().getIdProperty()}return a},updateModel:function(a){if(a){if(!this.getIdProperty()){this.setIdProperty(a.getIdProperty())}this.buildExtractors()}},createAccessor:Ext.emptyFn,createFieldAccessExpression:function(){return"undefined"},buildExtractors:function(){if(!this.getModel()){return}var b=this,d=b.getTotalProperty(),a=b.getSuccessProperty(),e=b.getMessageProperty();if(d){b.getTotal=b.createAccessor(d)}if(a){b.getSuccess=b.createAccessor(a)}if(e){b.getMessage=b.createAccessor(e)}b.extractRecordData=b.buildRecordDataExtractor()},buildRecordDataExtractor:function(){var l=this,f=l.getModel(),h=f.getFields(),k=h.length,a=[],j=l.getModel().getClientIdProperty(),g="__field",b=["var me = this,\n","    fields = me.getModel().getFields(),\n","    idProperty = me.getIdProperty(),\n",'    idPropertyIsFn = (typeof idProperty == "function"),',"    value,\n","    internalId"],e,m,d,n;h=h.items;for(e=0;e<k;e++){m=h[e];n=m.getName();if(n===f.getIdProperty()){a[e]="idField"}else{a[e]=g+e}b.push(",\n    ",a[e],' = fields.get("',m.getName(),'")')}b.push(";\n\n    return function(source) {\n        var dest = {};\n");b.push("        if (idPropertyIsFn) {\n");b.push("            idField.setMapping(idProperty);\n");b.push("        }\n");for(e=0;e<k;e++){m=h[e];d=a[e];n=m.getName();if(n===f.getIdProperty()&&m.getMapping()===null&&f.getIdProperty()!==this.getIdProperty()){m.setMapping(this.getIdProperty())}b.push("        try {\n");b.push("            value = ",l.createFieldAccessExpression(m,d,"source"),";\n");b.push("            if (value !== undefined) {\n");b.push('                dest["'+m.getName()+'"] = value;\n');b.push("            }\n");b.push("        } catch(e){}\n")}if(j){b.push("        internalId = "+l.createFieldAccessExpression(Ext.create("Ext.data.Field",{name:j}),null,"source")+";\n");b.push("        if (internalId !== undefined) {\n");b.push('            dest["_clientId"] = internalId;\n        }\n')}b.push("        return dest;\n");b.push("    };");return Ext.functionFactory(b.join("")).call(l)},getFields:function(){return this.getModel().getFields().items},getData:function(a){return a},getResponseData:function(a){return a},getRoot:function(a){return a},read:function(d){var h=d,j=this.getModel(),f,b,e,g,a;if(d){h=this.getResponseData(d)}if(h){f=this.readRecords(h);b=f.getRecords();for(e=0,g=b.length;e<g;e++){a=b[e];b[e]=new j(a.data,a.id,a.node)}return f}else{return this.nullResultSet}},process:function(a){var b=a;if(a){b=this.getResponseData(a)}if(b){return this.readRecords(b)}else{return this.nullResultSet}},readRecords:function(d){var f=this;f.rawData=d;d=f.getData(d);if(d.metaData){f.onMetaChange(d.metaData)}var e=Ext.isArray(d),h=e?d:f.getRoot(d),k=true,b=0,g,j,a,l;if(e&&Ext.isEmpty(d.length)){return f.nullResultSet}if(f.getTotal){j=parseInt(f.getTotal(d),10);if(!isNaN(j)){g=j}}if(f.getSuccess){j=f.getSuccess(d);if(j===false||j==="false"){k=false}}if(f.getMessage){l=f.getMessage(d)}if(h){a=f.extractData(h);b=a.length}else{b=0;a=[]}return new Ext.data.ResultSet({total:g,count:b,records:a,success:k,message:l})},extractData:function(m){var k=this,f=[],d=m.length,j=k.getModel(),n=j.getIdProperty(),l=j.getFields(),e,h,g,b,a;if(l.isDirty){k.buildExtractors(true);delete l.isDirty}if(!m.length&&Ext.isObject(m)){m=[m];d=1}for(h=0;h<d;h++){a=null;b=null;e=m[h];if(e.isModel){g=e.data}else{g=k.extractRecordData(e)}if(g._clientId!==undefined){a=g._clientId;delete g._clientId}if(g[n]!==undefined){b=g[n]}if(k.getImplicitIncludes()){k.readAssociated(g,e)}f.push({clientId:a,id:b,data:g,node:e})}return f},readAssociated:function(b,j){var g=this.getModel().associations.items,h=g.length,f=0,a,e,d;for(;f<h;f++){a=g[f];d=a.getAssociationKey();e=this.getAssociatedDataRoot(j,d);if(e){b[d]=e}}},getAssociatedDataRoot:function(e,a){var d=/[\[\.]/,b=String(a).search(d);if(b>=0){return Ext.functionFactory("obj","return obj"+(b>0?".":"")+a)(e)}return e[a]},onMetaChange:function(g){var a=g.fields,f=this,e,d,b;f.metaData=g;if(g.rootProperty!==undefined){f.setRootProperty(g.rootProperty)}else{if(g.root!==undefined){f.setRootProperty(g.root)}}if(g.idProperty!==undefined){f.setIdProperty(g.idProperty)}if(g.totalProperty!==undefined){f.setTotalProperty(g.totalProperty)}if(g.successProperty!==undefined){f.setSuccessProperty(g.successProperty)}if(g.messageProperty!==undefined){f.setMessageProperty(g.messageProperty)}if(a){if(f.getModel()){f.getModel().setFields(a);f.buildExtractors()}else{b=f.getIdProperty();d={fields:a};if(b){d.idProperty=b}e=Ext.define("Ext.data.reader.MetaModel"+Ext.id(),{extend:"Ext.data.Model",config:d});f.setModel(e)}}else{f.buildExtractors()}}},function(){Ext.apply(this.prototype,{nullResultSet:new Ext.data.ResultSet({total:0,count:0,records:[],success:false})})});Ext.define("Ext.data.reader.Json",{extend:Ext.data.reader.Reader,alternateClassName:"Ext.data.JsonReader",alias:"reader.json",config:{record:null,useSimpleAccessors:false},objectRe:/[\[\.]/,getResponseData:function(a){var e=a;if(a&&a.responseText){e=a.responseText}if(typeof e!=="string"){return e}var d;try{d=Ext.decode(e)}catch(b){this.fireEvent("exception",this,a,"Unable to parse the JSON returned by the server: "+b.toString());Ext.Logger.warn("Unable to parse the JSON returned by the server: "+b.toString())}return d},buildExtractors:function(){var b=this,a=b.getRootProperty();b.callParent(arguments);if(a){b.rootAccessor=b.createAccessor(a)}else{delete b.rootAccessor}},getRoot:function(b){var a=this.getModel().getFields();if(a.isDirty){this.buildExtractors(true);delete a.isDirty}if(this.rootAccessor){return this.rootAccessor.call(this,b)}else{return b}},extractData:function(a){var f=this.getRecord(),e=[],d,b;if(f){d=a.length;if(!d&&Ext.isObject(a)){d=1;a=[a]}for(b=0;b<d;b++){e[b]=a[b][f]}}else{e=a}return this.callParent([e])},createAccessor:function(){var a=/[\[\.]/;return function(d){if(Ext.isEmpty(d)){return Ext.emptyFn}if(Ext.isFunction(d)){return d}if(this.getUseSimpleAccessors()!==true){var b=String(d).search(a);if(b>=0){return Ext.functionFactory("obj","var value; try {value = obj"+(b>0?".":"")+d+"} catch(e) {}; return value;")}}return function(e){return e[d]}}}(),createFieldAccessExpression:function(h,b,d){var g=this,j=g.objectRe,f=(h.getMapping()!==null),a=f?h.getMapping():h.getName(),k,e;if(typeof a==="function"){k=b+".getMapping()("+d+", this)"}else{if(g.getUseSimpleAccessors()===true||((e=String(a).search(j))<0)){if(!f||isNaN(a)){a='"'+a+'"'}k=d+"["+a+"]"}else{k=d+(e>0?".":"")+a}}return k}});Ext.define("Ext.data.writer.Writer",{alias:"writer.base",alternateClassName:["Ext.data.DataWriter","Ext.data.Writer"],config:{writeAllFields:true,nameProperty:"name"},constructor:function(a){this.initConfig(a)},write:function(f){var d=f.getOperation(),b=d.getRecords()||[],a=b.length,e=0,g=[];for(;e<a;e++){g.push(this.getRecordData(b[e]))}return this.writeRecords(f,g)},writeDate:function(d,b){if(!b){return null}var a=d.getDateFormat()||"timestamp";switch(a){case"timestamp":return b.getTime()/1000;case"time":return b.getTime();default:return Ext.Date.format(b,a)}},getRecordData:function(f){var l=f.phantom===true,b=this.getWriteAllFields()||l,d=this.getNameProperty(),g=f.getFields(),e={},j,a,h,m,k;if(b){g.each(function(n){if(n.getPersist()){a=n.config[d]||n.getName();k=f.get(n.getName());if(n.getType().type=="date"){k=this.writeDate(n,k)}e[a]=k}},this)}else{j=f.getChanges();for(m in j){if(j.hasOwnProperty(m)){h=g.get(m);if(h.getPersist()){a=h.config[d]||h.getName();k=j[m];if(h.getType().type=="date"){k=this.writeDate(h,k)}e[a]=k}}}if(!l){e[f.getIdProperty()]=f.getId()}}return e}});Ext.define("Ext.data.writer.Json",{extend:Ext.data.writer.Writer,alternateClassName:"Ext.data.JsonWriter",alias:"writer.json",config:{rootProperty:undefined,encode:false,allowSingle:true,encodeRequest:false},applyRootProperty:function(a){if(!a&&(this.getEncode()||this.getEncodeRequest())){a="data"}return a},writeRecords:function(e,f){var a=this.getRootProperty(),g=e.getParams(),b=this.getAllowSingle(),d;if(this.getAllowSingle()&&f&&f.length==1){f=f[0]}if(this.getEncodeRequest()){d=e.getJsonData()||{};if(f&&(f.length||(b&&Ext.isObject(f)))){d[a]=f}e.setJsonData(Ext.apply(d,g||{}));e.setParams(null);e.setMethod("POST");return e}if(!f||!(f.length||(b&&Ext.isObject(f)))){return e}if(this.getEncode()){if(a){g[a]=Ext.encode(f)}else{}}else{d=e.getJsonData()||{};if(a){d[a]=f}else{d=f}e.setJsonData(d)}return e}});Ext.define("Ext.data.Batch",{mixins:{observable:Ext.mixin.Observable},config:{autoStart:false,pauseOnException:true,proxy:null},current:-1,total:0,isRunning:false,isComplete:false,hasException:false,constructor:function(a){var b=this;b.initConfig(a);b.operations=[]},add:function(a){this.total++;a.setBatch(this);this.operations.push(a)},start:function(){this.hasException=false;this.isRunning=true;this.runNextOperation()},runNextOperation:function(){this.runOperation(this.current+1)},pause:function(){this.isRunning=false},runOperation:function(e){var f=this,d=f.operations,b=d[e],a;if(b===undefined){f.isRunning=false;f.isComplete=true;f.fireEvent("complete",f,d[d.length-1])}else{f.current=e;a=function(g){var h=g.hasException();if(h){f.hasException=true;f.fireEvent("exception",f,g)}else{f.fireEvent("operationcomplete",f,g)}if(h&&f.getPauseOnException()){f.pause()}else{g.setCompleted();f.runNextOperation()}};b.setStarted();f.getProxy()[b.getAction()](b,a,f)}}});Ext.define("Ext.data.Operation",{config:{synchronous:true,action:null,filters:null,sorters:null,grouper:null,start:null,limit:null,batch:null,callback:null,scope:null,resultSet:null,records:null,request:null,response:null,withCredentials:null,params:null,url:null,page:null,node:null,model:undefined,addRecords:false},started:false,running:false,complete:false,success:undefined,exception:false,error:undefined,constructor:function(a){this.initConfig(a)},applyModel:function(a){if(typeof a=="string"){a=Ext.data.ModelManager.getModel(a);if(!a){Ext.Logger.error("Model with name "+arguments[0]+" doesnt exist.")}}if(a&&!a.prototype.isModel&&Ext.isObject(a)){a=Ext.data.ModelManager.registerType(a.storeId||a.id||Ext.id(),a)}return a},getRecords:function(){var a=this.getResultSet();return this._records||(a?a.getRecords():[])},setStarted:function(){this.started=true;this.running=true},setCompleted:function(){this.complete=true;this.running=false},setSuccessful:function(){this.success=true},setException:function(a){this.exception=true;this.success=false;this.running=false;this.error=a},hasException:function(){return this.exception===true},getError:function(){return this.error},isStarted:function(){return this.started===true},isRunning:function(){return this.running===true},isComplete:function(){return this.complete===true},wasSuccessful:function(){return this.isComplete()&&this.success===true},allowWrite:function(){return this.getAction()!="read"},process:function(e,b,d,a){if(b.getSuccess()!==false){this.setResponse(a);this.setResultSet(b);this.setCompleted();this.setSuccessful()}else{this.setResponse(a);this.setResultSet(b);return false}return this["process"+Ext.String.capitalize(e)].call(this,b,d,a)},processRead:function(e){var b=e.getRecords(),h=[],g=this.getModel(),f=b.length,d,a;for(d=0;d<f;d++){a=b[d];h.push(new g(a.data,a.id,a.node))}this.setRecords(h);e.setRecords(h);return true},processCreate:function(f){var d=f.getRecords(),b=this.getRecords(),g=d.length,e,a,h;for(e=0;e<g;e++){h=d[e];if(h.clientId===null&&b.length==1&&d.length==1){a=b[e]}else{a=this.findCurrentRecord(h.clientId)}if(a){this.updateRecord(a,h)}}return true},processUpdate:function(f){var d=f.getRecords(),b=this.getRecords(),g=d.length,e,a,h;for(e=0;e<g;e++){h=d[e];a=b[e];if(a){this.updateRecord(a,h)}}return true},processDestroy:function(e){var b=e.getRecords(),f=b.length,d,a,g;for(d=0;d<f;d++){g=b[d];a=this.findCurrentRecord(g.id);if(a){a.setIsErased(true);a.notifyStores("afterErase",a)}}},findCurrentRecord:function(a){var d=this.getRecords(),f=d.length,e,b;for(e=0;e<f;e++){b=d[e];if(b.getId()===a){return b}}},updateRecord:function(b,e){var a=e.data,d=e.id;b.beginEdit();b.set(a);if(d!==null){b.setId(d)}b.endEdit(true);b.commit()}});Ext.define("Ext.data.proxy.Proxy",{extend:Ext.Evented,alias:"proxy.proxy",alternateClassName:["Ext.data.DataProxy","Ext.data.Proxy"],config:{batchOrder:"create,update,destroy",batchActions:true,model:null,reader:{type:"json"},writer:{type:"json"}},isProxy:true,applyModel:function(a){if(typeof a=="string"){a=Ext.data.ModelManager.getModel(a);if(!a){Ext.Logger.error("Model with name "+arguments[0]+" doesnt exist.")}}if(a&&!a.prototype.isModel&&Ext.isObject(a)){a=Ext.data.ModelManager.registerType(a.storeId||a.id||Ext.id(),a)}return a},updateModel:function(b){if(b){var a=this.getReader();if(a&&!a.getModel()){a.setModel(b)}}},applyReader:function(b,a){return Ext.factory(b,Ext.data.Reader,a,"reader")},updateReader:function(a){if(a){var b=this.getModel();if(!b){b=a.getModel();if(b){this.setModel(b)}}else{a.setModel(b)}if(a.onMetaChange){a.onMetaChange=Ext.Function.createSequence(a.onMetaChange,this.onMetaChange,this)}}},onMetaChange:function(b){var a=this.getReader().getModel();if(!this.getModel()&&a){this.setModel(a)}this.fireEvent("metachange",this,b)},applyWriter:function(b,a){return Ext.factory(b,Ext.data.Writer,a,"writer")},create:Ext.emptyFn,read:Ext.emptyFn,update:Ext.emptyFn,destroy:Ext.emptyFn,onDestroy:function(){Ext.destroy(this.getReader(),this.getWriter());Ext.Evented.prototype.destroy.apply(this,arguments)},batch:function(f,g){var h=this,e=h.getBatchActions(),d=h.getModel(),b,a;if(f.operations===undefined){f={operations:f,listeners:g}}if(f.batch&&f.batch.isBatch){b=f.batch}else{b=new Ext.data.Batch(f.batch||{})}b.setProxy(h);b.on("complete",Ext.bind(h.onBatchComplete,h,[f],0));if(f.listeners){b.on(f.listeners)}Ext.each(h.getBatchOrder().split(","),function(j){a=f.operations[j];if(a){if(e){b.add(new Ext.data.Operation({action:j,records:a,model:d}))}else{Ext.each(a,function(k){b.add(new Ext.data.Operation({action:j,records:[k],model:d}))})}}},h);b.start();return b},onBatchComplete:function(a,b){var d=a.scope||this;if(b.hasException){if(Ext.isFunction(a.failure)){Ext.callback(a.failure,d,[b,a])}}else{if(Ext.isFunction(a.success)){Ext.callback(a.success,d,[b,a])}}if(Ext.isFunction(a.callback)){Ext.callback(a.callback,d,[b,a])}Ext.destroy(b)}},function(){});Ext.define("Ext.data.proxy.Client",{extend:Ext.data.proxy.Proxy,alternateClassName:"Ext.proxy.ClientProxy",clear:function(){}});Ext.define("Ext.data.proxy.Memory",{extend:Ext.data.proxy.Client,alias:"proxy.memory",alternateClassName:"Ext.data.MemoryProxy",isMemoryProxy:true,config:{data:[]},finishOperation:function(b,g,e){if(b){var d=0,f=b.getRecords(),a=f.length;for(d;d<a;d++){f[d].commit()}b.setCompleted();b.setSuccessful();Ext.callback(g,e||this,[b])}},create:function(){this.finishOperation.apply(this,arguments)},update:function(){this.finishOperation.apply(this,arguments)},destroy:function(){this.finishOperation.apply(this,arguments)},read:function(b,f,d){var e=this,a=e.getReader();if(b.process("read",a.process(e.getData()))===false){this.fireEvent("exception",this,null,b)}Ext.callback(f,d||e,[b])},clear:Ext.emptyFn});Ext.define("Ext.data.reader.Array",{extend:Ext.data.reader.Json,alternateClassName:"Ext.data.ArrayReader",alias:"reader.array",config:{totalProperty:undefined,successProperty:undefined},createFieldAccessExpression:function(h,d,b){var g=this,f=h.getMapping(),e=(f==null)?g.getModel().getFields().indexOf(h):f,a;if(typeof e==="function"){a=d+".getMapping()("+b+", this)"}else{if(isNaN(e)){e='"'+e+'"'}a=b+"["+e+"]"}return a}});Ext.define("Ext.data.StoreManager",{extend:Ext.util.Collection,alternateClassName:["Ext.StoreMgr","Ext.data.StoreMgr","Ext.StoreManager"],singleton:true,register:function(){for(var a=0,b;(b=arguments[a]);a++){this.add(b)}},unregister:function(){for(var a=0,b;(b=arguments[a]);a++){this.remove(this.lookup(b))}},lookup:function(d){if(Ext.isArray(d)){var b=["field1"],f=!Ext.isArray(d[0]),g=d,e,a;if(f){g=[];for(e=0,a=d.length;e<a;++e){g.push([d[e]])}}else{for(e=2,a=d[0].length;e<=a;++e){b.push("field"+e)}}return Ext.create("Ext.data.ArrayStore",{data:g,fields:b,autoDestroy:true,autoCreated:true,expanded:f})}if(Ext.isString(d)){return this.get(d)}else{if(d instanceof Ext.data.Store){return d}else{return Ext.factory(d,Ext.data.Store,null,"store")}}},getKey:function(a){return a.getStoreId()}},function(){Ext.regStore=function(d,b){var a;if(Ext.isObject(d)){b=d}else{if(b instanceof Ext.data.Store){b.setStoreId(d)}else{b.storeId=d}}if(b instanceof Ext.data.Store){a=b}else{a=Ext.create("Ext.data.Store",b)}return Ext.data.StoreManager.register(a)};Ext.getStore=function(a){return Ext.data.StoreManager.lookup(a)}});Ext.define("Ext.mixin.Selectable",{extend:Ext.mixin.Mixin,mixinConfig:{id:"selectable",hooks:{updateStore:"updateStore"}},config:{disableSelection:null,mode:"SINGLE",allowDeselect:false,lastSelected:null,lastFocused:null,deselectOnContainerClick:true},modes:{SINGLE:true,SIMPLE:true,MULTI:true},selectableEventHooks:{addrecords:"onSelectionStoreAdd",removerecords:"onSelectionStoreRemove",updaterecord:"onSelectionStoreUpdate",load:"refreshSelection",refresh:"refreshSelection"},constructor:function(){this.selected=new Ext.util.MixedCollection();this.callParent(arguments)},applyMode:function(a){a=a?a.toUpperCase():"SINGLE";return this.modes[a]?a:"SINGLE"},updateStore:function(a,d){var b=this,e=Ext.apply({},b.selectableEventHooks,{scope:b});if(d&&Ext.isObject(d)&&d.isStore){if(d.autoDestroy){d.destroy()}else{d.un(e);if(a){a.un("clear","onSelectionStoreClear",this)}}}if(a){a.on(e);a.onBefore("clear","onSelectionStoreClear",this);b.refreshSelection()}},selectAll:function(a){var d=this,b=d.getStore().getRange();d.select(b,true,a)},deselectAll:function(d){var b=this,a=b.getStore().getRange();b.deselect(a,d);b.selected.clear();b.setLastSelected(null);b.setLastFocused(null)},selectWithEvent:function(a){var d=this,b=d.isSelected(a);switch(d.getMode()){case"MULTI":case"SIMPLE":if(b){d.deselect(a)}else{d.select(a,true)}break;case"SINGLE":if(d.getAllowDeselect()&&b){d.deselect(a)}else{d.select(a,false)}break}},selectRange:function(d,h,j){var g=this,b=g.getStore(),a=[],f,e;if(g.getDisableSelection()){return}if(d>h){f=h;h=d;d=f}for(e=d;e<=h;e++){a.push(b.getAt(e))}this.doMultiSelect(a,j)},select:function(d,f,b){var e=this,a;if(e.getDisableSelection()){return}if(typeof d==="number"){d=[e.getStore().getAt(d)]}if(!d){return}if(e.getMode()=="SINGLE"&&d){a=d.length?d[0]:d;e.doSingleSelect(a,b)}else{e.doMultiSelect(d,f,b)}},doSingleSelect:function(a,b){var e=this,d=e.selected;if(e.getDisableSelection()){return}if(e.isSelected(a)){return}if(d.getCount()>0){e.deselect(e.getLastSelected(),b)}d.add(a);e.setLastSelected(a);e.onItemSelect(a,b);e.setLastFocused(a);if(!b){e.fireSelectionChange([a])}},doMultiSelect:function(a,k,j){if(a===null||this.getDisableSelection()){return}a=!Ext.isArray(a)?[a]:a;var g=this,b=g.selected,f=a.length,h=false,d=0,e;if(!k&&b.getCount()>0){h=true;g.deselect(g.getSelection(),true)}for(;d<f;d++){e=a[d];if(k&&g.isSelected(e)){continue}h=true;g.setLastSelected(e);b.add(e);if(!j){g.setLastFocused(e)}g.onItemSelect(e,j)}if(h&&!j){this.fireSelectionChange(a)}},deselect:function(a,k){var g=this;if(g.getDisableSelection()){return}a=Ext.isArray(a)?a:[a];var b=g.selected,h=false,d=0,j=g.getStore(),f=a.length,e;for(;d<f;d++){e=a[d];if(typeof e==="number"){e=j.getAt(e)}if(b.remove(e)){if(g.getLastSelected()==e){g.setLastSelected(b.last())}h=true}if(e){g.onItemDeselect(e,k)}}if(h&&!k){g.fireSelectionChange(a)}},updateLastFocused:function(b,a){this.onLastFocusChanged(a,b)},fireSelectionChange:function(a){var b=this;b.fireAction("selectionchange",[b,a],"getSelection")},getSelection:function(){return this.selected.getRange()},isSelected:function(a){a=Ext.isNumber(a)?this.getStore().getAt(a):a;return this.selected.indexOf(a)!==-1},hasSelection:function(){return this.selected.getCount()>0},refreshSelection:function(){var b=this,a=b.getSelection();b.deselectAll(true);if(a.length){b.select(a,false,true)}},onSelectionStoreRemove:function(d,b){var h=this,f=h.selected,g=b.length,a,e;if(h.getDisableSelection()){return}for(e=0;e<g;e++){a=b[e];if(f.remove(a)){if(h.getLastSelected()==a){h.setLastSelected(null)}if(h.getLastFocused()==a){h.setLastFocused(null)}h.fireSelectionChange([a])}}},onSelectionStoreClear:function(b){var a=b.getData().items;this.onSelectionStoreRemove(b,a)},getSelectionCount:function(){return this.selected.getCount()},onSelectionStoreAdd:Ext.emptyFn,onSelectionStoreUpdate:Ext.emptyFn,onItemSelect:Ext.emptyFn,onItemDeselect:Ext.emptyFn,onLastFocusChanged:Ext.emptyFn,onEditorKey:Ext.emptyFn},function(){});Ext.define("Ext.dataview.component.DataItem",{extend:Ext.Container,xtype:"dataitem",config:{baseCls:Ext.baseCSSPrefix+"data-item",defaultType:"component",record:null,itemCls:null,dataMap:{},dataview:null,width:"100%",items:[{xtype:"component"}]},updateBaseCls:function(a,b){var d=this;d.callParent(arguments)},updateItemCls:function(b,a){if(a){this.removeCls(a)}if(b){this.addCls(b)}},doMapData:function(e,h,g){var a,f,d,b;for(a in e){d=e[a];f=this[a]();if(f){for(b in d){if(h&&f[b]&&h[d[b]]!==undefined&&h[d[b]]!==null){f[b](h[d[b]])}}}}if(g){g.updateData(h)}},updateRecord:function(e){if(!e){return}this._record=e;var g=this,a=g.dataview||this.getDataview(),h=a.prepareData(e.getData(true),a.getStore().indexOf(e),e),d=g.getItems(),f=d.first(),b=g.getDataMap();if(!f){return}if(b){this.doMapData(b,h,f)}g.fireEvent("updatedata",g,h)}});Ext.define("Ext.dataview.component.Container",{extend:Ext.Container,constructor:function(){this.itemCache=[];this.callParent(arguments)},doInitialize:function(){this.innerElement.on({touchstart:"onItemTouchStart",touchend:"onItemTouchEnd",tap:"onItemTap",taphold:"onItemTapHold",touchmove:"onItemTouchMove",singletap:"onItemSingleTap",doubletap:"onItemDoubleTap",swipe:"onItemSwipe",delegate:"> ."+Ext.baseCSSPrefix+"data-item",scope:this})},initialize:function(){this.callParent();this.doInitialize()},onItemTouchStart:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);a.on({touchmove:"onItemTouchMove",scope:b,single:true});b.fireEvent("itemtouchstart",b,a,b.indexOf(a),f)},onItemTouchMove:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);b.fireEvent("itemtouchmove",b,a,b.indexOf(a),f)},onItemTouchEnd:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);a.un({touchmove:"onItemTouchMove",scope:b});b.fireEvent("itemtouchend",b,a,b.indexOf(a),f)},onItemTap:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);b.fireEvent("itemtap",b,a,b.indexOf(a),f)},onItemTapHold:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);b.fireEvent("itemtaphold",b,a,b.indexOf(a),f)},onItemSingleTap:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);b.fireEvent("itemsingletap",b,a,b.indexOf(a),f)},onItemDoubleTap:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);b.fireEvent("itemdoubletap",b,a,b.indexOf(a),f)},onItemSwipe:function(f){var b=this,d=f.getTarget(),a=Ext.getCmp(d.id);b.fireEvent("itemswipe",b,a,b.indexOf(a),f)},moveItemsToCache:function(k,l){var j=this,d=j.dataview,a=d.getMaxItemCache(),h=j.getViewItems(),g=j.itemCache,f=g.length,m=d.getPressedCls(),e=d.getSelectedCls(),b=l-k,n;for(;b>=0;b--){n=h[k+b];if(f!==a){j.remove(n,false);n.removeCls([m,e]);g.push(n);f++}else{n.destroy()}}if(j.getViewItems().length==0){this.dataview.showEmptyText()}},moveItemsFromCache:function(b){var m=this,f=m.dataview,n=f.getStore(),l=b.length,a=f.getDefaultType(),j=f.getItemConfig(),h=m.itemCache,g=h.length,k=[],d,o,e;if(l){f.hideEmptyText()}for(d=0;d<l;d++){b[d]._tmpIndex=n.indexOf(b[d])}Ext.Array.sort(b,function(q,p){return q._tmpIndex>p._tmpIndex?1:-1});for(d=0;d<l;d++){e=b[d];if(g){g--;o=h.pop();this.updateListItem(e,o)}else{o=m.getDataItemConfig(a,e,j)}o=this.insert(e._tmpIndex,o);delete e._tmpIndex}return k},getViewItems:function(){return this.getInnerItems()},updateListItem:function(a,b){if(b.updateRecord){if(b.getRecord()===a){b.updateRecord(a)}else{b.setRecord(a)}}},getDataItemConfig:function(f,b,d){var a=this.dataview,e={xtype:f,record:b,itemCls:a.getItemCls(),defaults:d,dataview:a};return Ext.merge(e,d)},doRemoveItemCls:function(a){var b=this.getViewItems(),e=b.length,d=0;for(;d<e;d++){b[d].removeCls(a)}},doAddItemCls:function(a){var b=this.getViewItems(),e=b.length,d=0;for(;d<e;d++){b[d].addCls(a)}},updateAtNewIndex:function(d,b,a){this.moveItemsToCache(d,d);this.moveItemsFromCache([a])},destroy:function(){var e=this,b=e.itemCache,d=b.length,a=0;for(;a<d;a++){b[a].destroy()}this.callParent()}});Ext.define("Ext.dataview.element.Container",{extend:Ext.Component,doInitialize:function(){this.element.on({touchstart:"onItemTouchStart",touchend:"onItemTouchEnd",tap:"onItemTap",taphold:"onItemTapHold",touchmove:"onItemTouchMove",singletap:"onItemSingleTap",doubletap:"onItemDoubleTap",swipe:"onItemSwipe",delegate:"> div",scope:this})},initialize:function(){this.callParent();this.doInitialize()},updateBaseCls:function(a,b){var d=this;d.callParent([a+"-container",b])},onItemTouchStart:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);Ext.get(d).on({touchmove:"onItemTouchMove",scope:b,single:true});b.fireEvent("itemtouchstart",b,Ext.get(d),a,f)},onItemTouchEnd:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);Ext.get(d).un({touchmove:"onItemTouchMove",scope:b});b.fireEvent("itemtouchend",b,Ext.get(d),a,f)},onItemTouchMove:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);b.fireEvent("itemtouchmove",b,Ext.get(d),a,f)},onItemTap:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);b.fireEvent("itemtap",b,Ext.get(d),a,f)},onItemTapHold:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);b.fireEvent("itemtaphold",b,Ext.get(d),a,f)},onItemDoubleTap:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);b.fireEvent("itemdoubletap",b,Ext.get(d),a,f)},onItemSingleTap:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);b.fireEvent("itemsingletap",b,Ext.get(d),a,f)},onItemSwipe:function(f){var b=this,d=f.getTarget(),a=b.getViewItems().indexOf(d);b.fireEvent("itemswipe",b,Ext.get(d),a,f)},updateListItem:function(b,g){var f=this,a=f.dataview,d=a.getStore(),e=d.indexOf(b),h=a.prepareData(b.getData(true),e,b);h.xcount=d.getCount();h.xindex=typeof h.xindex==="number"?h.xindex:e;g.innerHTML=a.getItemTpl().apply(h)},addListItem:function(f,d){var j=this,e=j.dataview,k=e.getStore(),a=e.prepareData(d.getData(true),f,d),b=j.element,l=b.dom.childNodes,h=l.length,g;a.xcount=typeof a.xcount==="number"?a.xcount:k.getCount();a.xindex=typeof a.xindex==="number"?a.xindex:f;g=Ext.Element.create(this.getItemElementConfig(f,a));if(!h||f==h){g.appendTo(b)}else{g.insertBefore(l[f])}},getItemElementConfig:function(d,f){var b=this.dataview,e=b.getItemCls(),a=b.getBaseCls()+"-item";if(e){a+=" "+e}return{cls:a,html:b.getItemTpl().apply(f)}},doRemoveItemCls:function(a){var e=this.getViewItems(),d=e.length,b=0;for(;b<d;b++){Ext.fly(e[b]).removeCls(a)}},doAddItemCls:function(a){var e=this.getViewItems(),d=e.length,b=0;for(;b<d;b++){Ext.fly(e[b]).addCls(a)}},moveItemsToCache:function(g,f){var e=this,a=e.getViewItems(),b=f-g,d;for(;b>=0;b--){d=a[g+b];Ext.get(d).destroy()}if(e.getViewItems().length==0){this.dataview.showEmptyText()}},moveItemsFromCache:function(e){var h=this,b=h.dataview,d=b.getStore(),g=e.length,f,a;if(g){b.hideEmptyText()}for(f=0;f<g;f++){e[f]._tmpIndex=d.indexOf(e[f])}Ext.Array.sort(e,function(k,j){return k._tmpIndex>j._tmpIndex?1:-1});for(f=0;f<g;f++){a=e[f];h.addListItem(a._tmpIndex,a);delete a._tmpIndex}},getViewItems:function(){return Array.prototype.slice.call(this.element.dom.childNodes)},updateAtNewIndex:function(d,b,a){this.moveItemsToCache(d,d);this.moveItemsFromCache([a])},destroy:function(){var d=this.getViewItems(),b=d.length,a=0;for(;a<b;a++){Ext.get(d[a]).destroy()}this.callParent()}});Ext.define("Ext.dataview.DataView",{extend:Ext.Container,alternateClassName:"Ext.DataView",mixins:[Ext.mixin.Selectable],xtype:"dataview",config:{store:null,data:null,baseCls:Ext.baseCSSPrefix+"dataview",emptyText:null,deferEmptyText:true,itemTpl:"<div>{text}</div>",pressedCls:"x-item-pressed",itemCls:null,selectedCls:"x-item-selected",triggerEvent:"itemtap",triggerCtEvent:"tap",deselectOnContainerClick:true,scrollable:true,inline:null,pressedDelay:100,loadingText:"Loading...",useComponents:null,itemConfig:{},maxItemCache:20,defaultType:"dataitem",scrollToTopOnRefresh:true},constructor:function(a){var d=this,b;d.hasLoadedStore=false;d.mixins.selectable.constructor.apply(d,arguments);d.indexOffset=0;d.callParent(arguments)},updateItemCls:function(d,b){var a=this.container;if(a){if(b){a.doRemoveItemCls(b)}if(d){a.doAddItemCls(d)}}},storeEventHooks:{beforeload:"onBeforeLoad",load:"onLoad",refresh:"refresh",addrecords:"onStoreAdd",removerecords:"onStoreRemove",updaterecord:"onStoreUpdate"},initialize:function(){this.callParent();var b=this,a,d=b.getTriggerEvent();b.on(b.getTriggerCtEvent(),b.onContainerTrigger,b);a=b.container=this.add(new Ext.dataview[b.getUseComponents()?"component":"element"].Container({baseCls:this.getBaseCls()}));a.dataview=b;if(d){b.on(d,b.onItemTrigger,b)}a.on({itemtouchstart:"onItemTouchStart",itemtouchend:"onItemTouchEnd",itemtap:"onItemTap",itemtaphold:"onItemTapHold",itemtouchmove:"onItemTouchMove",itemsingletap:"onItemSingleTap",itemdoubletap:"onItemDoubleTap",itemswipe:"onItemSwipe",scope:b});if(b.getStore()){if(b.isPainted()){b.refresh()}else{b.on({painted:"refresh",single:true})}}},applyInline:function(a){if(Ext.isObject(a)){a=Ext.apply({},a)}return a},updateInline:function(d,b){var a=this.getBaseCls();if(b){this.removeCls([a+"-inlineblock",a+"-nowrap"])}if(d){this.addCls(a+"-inlineblock");if(Ext.isObject(d)&&d.wrap===false){this.addCls(a+"-nowrap")}else{this.removeCls(a+"-nowrap")}}},prepareData:function(d,b,a){return d},onContainerTrigger:function(b){var a=this;if(b.target!=a.element.dom){return}if(a.getDeselectOnContainerClick()&&a.getStore()){a.deselectAll()}},onItemTrigger:function(b,a){if(!this.isDestroyed){this.selectWithEvent(this.getStore().getAt(a))}},doAddPressedCls:function(a){var d=this,b=d.getItemAt(d.getStore().indexOf(a));if(Ext.isElement(b)){b=Ext.get(b)}if(b){if(b.isComponent){b.renderElement.addCls(d.getPressedCls())}else{b.addCls(d.getPressedCls())}}},onItemTouchStart:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);g.fireAction("itemtouchstart",[g,f,j,a,h],"doItemTouchStart")},doItemTouchStart:function(d,b,f,a){var e=d.getPressedDelay();if(a){if(e>0){d.pressedTimeout=Ext.defer(d.doAddPressedCls,e,d,[a])}else{d.doAddPressedCls(a)}}},onItemTouchEnd:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);if(this.hasOwnProperty("pressedTimeout")){clearTimeout(this.pressedTimeout);delete this.pressedTimeout}if(a&&j){if(j.isComponent){j.renderElement.removeCls(g.getPressedCls())}else{j.removeCls(g.getPressedCls())}}g.fireEvent("itemtouchend",g,f,j,a,h)},onItemTouchMove:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);if(g.hasOwnProperty("pressedTimeout")){clearTimeout(g.pressedTimeout);delete g.pressedTimeout}if(a&&j){if(j.isComponent){j.renderElement.removeCls(g.getPressedCls())}else{j.removeCls(g.getPressedCls())}}g.fireEvent("itemtouchmove",g,f,j,a,h)},onItemTap:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);g.fireEvent("itemtap",g,f,j,a,h)},onItemTapHold:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);g.fireEvent("itemtaphold",g,f,j,a,h)},onItemSingleTap:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);g.fireEvent("itemsingletap",g,f,j,a,h)},onItemDoubleTap:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);g.fireEvent("itemdoubletap",g,f,j,a,h)},onItemSwipe:function(b,j,f,h){var g=this,d=g.getStore(),a=d&&d.getAt(f);g.fireEvent("itemswipe",g,f,j,a,h)},onItemSelect:function(a,b){var d=this;if(b){d.doItemSelect(d,a)}else{d.fireAction("select",[d,a],"doItemSelect")}},doItemSelect:function(d,a){if(d.container&&!d.isDestroyed){var b=d.getItemAt(d.getStore().indexOf(a));if(Ext.isElement(b)){b=Ext.get(b)}if(b){if(b.isComponent){b.renderElement.removeCls(d.getPressedCls());b.renderElement.addCls(d.getSelectedCls())}else{b.removeCls(d.getPressedCls());b.addCls(d.getSelectedCls())}}}},onItemDeselect:function(a,b){var d=this;if(d.container&&!d.isDestroyed){if(b){d.doItemDeselect(d,a)}else{d.fireAction("deselect",[d,a,b],"doItemDeselect")}}},doItemDeselect:function(d,a){var b=d.getItemAt(d.getStore().indexOf(a));if(Ext.isElement(b)){b=Ext.get(b)}if(b){if(b.isComponent){b.renderElement.removeCls([d.getPressedCls(),d.getSelectedCls()])}else{b.removeCls([d.getPressedCls(),d.getSelectedCls()])}}},updateData:function(b){var a=this.getStore();if(!a){this.setStore(Ext.create("Ext.data.Store",{data:b,autoDestroy:true}))}else{a.add(b)}},applyStore:function(b){var e=this,f=Ext.apply({},e.storeEventHooks,{scope:e}),d,a;if(b){b=Ext.data.StoreManager.lookup(b);if(b&&Ext.isObject(b)&&b.isStore){b.on(f);d=b.getProxy();if(d){a=d.getReader();if(a){a.on("exception","handleException",this)}}}}return b},handleException:function(){this.setMasked(false)},updateStore:function(b,f){var e=this,g=Ext.apply({},e.storeEventHooks,{scope:e}),d,a;if(f&&Ext.isObject(f)&&f.isStore){f.un(g);if(!e.isDestroyed){e.onStoreClear()}if(f.getAutoDestroy()){f.destroy()}else{d=f.getProxy();if(d){a=d.getReader();if(a){a.un("exception","handleException",this)}}}}if(b){if(b.isLoaded()){this.hasLoadedStore=true}if(b.isLoading()){e.onBeforeLoad()}if(e.container){e.refresh()}}},onBeforeLoad:function(){var a=this.getLoadingText();if(a&&this.isPainted()){this.setMasked({xtype:"loadmask",message:a})}this.hideEmptyText()},updateEmptyText:function(d,e){var b=this,a;if(e&&b.emptyTextCmp){b.remove(b.emptyTextCmp,true);delete b.emptyTextCmp}if(d){b.emptyTextCmp=b.add({xtype:"component",cls:b.getBaseCls()+"-emptytext",html:d,hidden:true});a=b.getStore();if(a&&b.hasLoadedStore&&!a.getCount()){this.showEmptyText()}}},onLoad:function(a){this.hasLoadedStore=true;this.setMasked(false);if(!a.getCount()){this.showEmptyText()}},refresh:function(){var b=this,a=b.container;if(!b.getStore()){if(!b.hasLoadedStore&&!b.getDeferEmptyText()){b.showEmptyText()}return}if(a){b.fireAction("refresh",[b],"doRefresh")}},applyItemTpl:function(a){return(Ext.isObject(a)&&a.isTemplate)?a:new Ext.XTemplate(a)},onAfterRender:function(){var a=this;a.callParent(arguments);a.updateStore(a.getStore())},getItemAt:function(a){return this.getViewItems()[a-this.indexOffset]},getItemIndex:function(b){var a=this.getViewItems().indexOf(b);return(a===-1)?a:this.indexOffset+a},getViewItems:function(){return this.container.getViewItems()},doRefresh:function(h){var a=h.container,m=h.getStore(),b=m.getRange(),g=h.getViewItems(),k=b.length,p=g.length,d=k-p,j=h.getScrollable(),e,n;if(this.getScrollToTopOnRefresh()&&j){j.getScroller().scrollToTop()}if(k<1){h.onStoreClear();return}else{h.hideEmptyText()}if(d<0){a.moveItemsToCache(p+d,p-1);g=h.getViewItems();p=g.length}else{if(d>0){a.moveItemsFromCache(m.getRange(p))}}for(e=0;e<p;e++){n=g[e];a.updateListItem(b[e],n)}if(this.hasSelection()){var l=this.getSelection(),o=this.getSelectionCount(),f;for(e=0;e<o;e++){f=l[e];this.doItemSelect(this,f)}}},showEmptyText:function(){if(this.getEmptyText()&&(this.hasLoadedStore||!this.getDeferEmptyText())){this.emptyTextCmp.show()}},hideEmptyText:function(){if(this.getEmptyText()){this.emptyTextCmp.hide()}},destroy:function(){var b=this.getStore(),d=(b&&b.getProxy()),a=(d&&d.getReader());if(a){a.clearListeners()}this.callParent(arguments);this.setStore(null)},onStoreClear:function(){var d=this,a=d.container,b=d.getViewItems();a.moveItemsToCache(0,b.length-1);this.showEmptyText()},onStoreAdd:function(b,a){if(a){this.hideEmptyText();this.container.moveItemsFromCache(a)}},onStoreRemove:function(d,b,g){var a=this.container,f=b.length,e;for(e=0;e<f;e++){a.moveItemsToCache(g[e],g[e])}},onStoreUpdate:function(d,b,e,h){var g=this,a=g.container,f;h=(typeof h==="undefined")?e:h;if(h!==e){a.updateAtNewIndex(h,e,b);if(g.isSelected(b)){g.doItemSelect(g,b)}}else{f=g.getViewItems()[e];if(f){a.updateListItem(b,f)}}}});Ext.define("Ext.data.SortTypes",{singleton:true,stripTagsRE:/<\/?[^>]+>/gi,none:function(a){return a},asText:function(a){return String(a).replace(this.stripTagsRE,"")},asUCText:function(a){return String(a).toUpperCase().replace(this.stripTagsRE,"")},asUCString:function(a){return String(a).toUpperCase()},asDate:function(a){if(!a){return 0}if(Ext.isDate(a)){return a.getTime()}return Date.parse(String(a))},asFloat:function(a){a=parseFloat(String(a).replace(/,/g,""));return isNaN(a)?0:a},asInt:function(a){a=parseInt(String(a).replace(/,/g,""),10);return isNaN(a)?0:a}});Ext.define("Ext.data.Types",{singleton:true,stripRe:/[\$,%]/g,dashesRe:/-/g,iso8601TestRe:/\d\dT\d\d/,iso8601SplitRe:/[- :T\.Z\+]/},function(){var b=this,a=Ext.data.SortTypes;Ext.apply(b,{AUTO:{convert:function(d){return d},sortType:a.none,type:"auto"},STRING:{convert:function(d){return(d===undefined||d===null)?(this.getAllowNull()?null:""):String(d)},sortType:a.asUCString,type:"string"},INT:{convert:function(d){return(d!==undefined&&d!==null&&d!=="")?((typeof d==="number")?parseInt(d,10):parseInt(String(d).replace(b.stripRe,""),10)):(this.getAllowNull()?null:0)},sortType:a.none,type:"int"},FLOAT:{convert:function(d){return(d!==undefined&&d!==null&&d!=="")?((typeof d==="number")?d:parseFloat(String(d).replace(b.stripRe,""),10)):(this.getAllowNull()?null:0)},sortType:a.none,type:"float"},BOOL:{convert:function(d){if((d===undefined||d===null||d==="")&&this.getAllowNull()){return null}return d!=="false"&&d!=="0"&&!!d},sortType:a.none,type:"bool"},DATE:{convert:function(f){var d=this.getDateFormat(),e;if(!f){return null}if(Ext.isDate(f)){return f}if(d){if(d=="timestamp"){return new Date(f*1000)}if(d=="time"){return new Date(parseInt(f,10))}return Ext.Date.parse(f,d)}e=new Date(Date.parse(f));if(isNaN(e)){if(b.iso8601TestRe.test(f)){e=f.split(b.iso8601SplitRe);e=new Date(e[0],e[1]-1,e[2],e[3],e[4],e[5])}if(isNaN(e)){e=new Date(Date.parse(f.replace(b.dashesRe,"/")))}}return isNaN(e)?null:e},sortType:a.asDate,type:"date"}});Ext.apply(b,{BOOLEAN:this.BOOL,INTEGER:this.INT,NUMBER:this.FLOAT})});Ext.define("Ext.data.Field",{alias:"data.field",isField:true,config:{name:null,type:"auto",convert:undefined,dateFormat:null,allowNull:true,defaultValue:undefined,mapping:null,sortType:undefined,sortDir:"ASC",allowBlank:true,persist:true,encode:null,decode:null,bubbleEvents:"action"},constructor:function(a){if(Ext.isString(a)){a={name:a}}this.initConfig(a)},applyType:function(d){var b=Ext.data.Types,a=b.AUTO;if(d){if(Ext.isString(d)){return b[d.toUpperCase()]||a}else{return d}}return a},updateType:function(a,b){var d=this.getConvert();if(b&&d===b.convert){this.setConvert(a.convert)}},applySortType:function(e){var d=Ext.data.SortTypes,a=this.getType(),b=a.sortType;if(e){if(Ext.isString(e)){return d[e]||b}else{return e}}return b},applyConvert:function(b){var a=this.getType().convert;if(b&&b!==a){this._hasCustomConvert=true;return b}else{this._hasCustomConvert=false;return a}},hasCustomConvert:function(){return this._hasCustomConvert}});Ext.define("Ext.data.identifier.Simple",{alias:"data.identifier.simple",statics:{AUTO_ID:1},config:{prefix:"ext-record-"},constructor:function(a){this.initConfig(a)},generate:function(a){return this._prefix+this.self.AUTO_ID++}});Ext.define("Ext.data.ModelManager",{extend:Ext.AbstractManager,alternateClassName:["Ext.ModelMgr","Ext.ModelManager"],singleton:true,modelNamespace:null,registerType:function(d,b){var e=b.prototype,a;if(e&&e.isModel){a=b}else{b={extend:b.extend||"Ext.data.Model",config:b};a=Ext.define(d,b)}this.types[d]=a;return a},onModelDefined:Ext.emptyFn,getModel:function(b){var a=b;if(typeof a=="string"){a=this.types[a];if(!a&&this.modelNamespace){a=this.types[this.modelNamespace+"."+a]}}return a},create:function(d,b,e){var a=typeof b=="function"?b:this.types[b||d.name];return new a(d,e)}},function(){Ext.regModel=function(){return this.ModelManager.registerType.apply(this.ModelManager,arguments)}});Ext.define("Ext.data.Request",{config:{action:null,params:null,method:"GET",url:null,operation:null,proxy:null,disableCaching:false,headers:{},callbackKey:null,jsonP:null,jsonData:null,xmlData:null,withCredentials:null,username:null,password:null,callback:null,scope:null,timeout:30000,records:null,directFn:null,args:null,useDefaultXhrHeader:null},constructor:function(a){this.initConfig(a)}});Ext.define("Ext.data.proxy.Server",{extend:Ext.data.proxy.Proxy,alias:"proxy.server",alternateClassName:"Ext.data.ServerProxy",config:{url:null,pageParam:"page",startParam:"start",limitParam:"limit",groupParam:"group",sortParam:"sort",filterParam:"filter",directionParam:"dir",enablePagingParams:true,simpleSortMode:false,noCache:true,cacheString:"_dc",timeout:30000,api:{create:undefined,read:undefined,update:undefined,destroy:undefined},extraParams:{}},constructor:function(a){a=a||{};if(a.nocache!==undefined){a.noCache=a.nocache}this.callParent([a])},create:function(){return this.doRequest.apply(this,arguments)},read:function(){return this.doRequest.apply(this,arguments)},update:function(){return this.doRequest.apply(this,arguments)},destroy:function(){return this.doRequest.apply(this,arguments)},setExtraParam:function(a,b){this.getExtraParams()[a]=b},buildRequest:function(a){var d=this,e=Ext.applyIf(a.getParams()||{},d.getExtraParams()||{}),b;e=Ext.applyIf(e,d.getParams(a));b=Ext.create("Ext.data.Request",{params:e,action:a.getAction(),records:a.getRecords(),url:a.getUrl(),operation:a,proxy:d});b.setUrl(d.buildUrl(b));a.setRequest(b);return b},processResponse:function(m,b,f,d,l,n){var j=this,a=b.getAction(),g,k;if(m===true){g=j.getReader();try{k=g.process(j.getResponseResult(d))}catch(h){b.setException(h.message);j.fireEvent("exception",j,d,b);return}if(!b.getModel()){b.setModel(this.getModel())}if(b.process(a,k,f,d)===false){j.setException(b,d);j.fireEvent("exception",j,d,b)}}else{j.setException(b,d);j.fireEvent("exception",this,d,b)}if(typeof l=="function"){l.call(n||j,b)}j.afterRequest(f,m)},getResponseResult:function(a){return a},setException:function(b,a){if(Ext.isObject(a)){b.setException({status:a.status,statusText:a.statusText})}},applyEncoding:function(a){return Ext.encode(a)},encodeSorters:function(e){var b=[],d=e.length,a=0;for(;a<d;a++){b[a]={property:e[a].getProperty(),direction:e[a].getDirection()}}return this.applyEncoding(b)},encodeFilters:function(e){var b=[],d=e.length,a=0;for(;a<d;a++){b[a]={property:e[a].getProperty(),value:e[a].getValue()}}return this.applyEncoding(b)},getParams:function(k){var p=this,j={},a=k.getGrouper(),o=k.getSorters(),g=k.getFilters(),n=k.getPage(),e=k.getStart(),h=k.getLimit(),q=p.getSimpleSortMode(),s=p.getPageParam(),m=p.getStartParam(),r=p.getLimitParam(),l=p.getGroupParam(),f=p.getSortParam(),d=p.getFilterParam(),b=p.getDirectionParam();if(p.getEnablePagingParams()){if(s&&n!==null){j[s]=n}if(m&&e!==null){j[m]=e}if(r&&h!==null){j[r]=h}}if(l&&a){j[l]=p.encodeSorters([a])}if(f&&o&&o.length>0){if(q){j[f]=o[0].getProperty();j[b]=o[0].getDirection()}else{j[f]=p.encodeSorters(o)}}if(d&&g&&g.length>0){j[d]=p.encodeFilters(g)}return j},buildUrl:function(d){var b=this,a=b.getUrl(d);if(b.getNoCache()){a=Ext.urlAppend(a,Ext.String.format("{0}={1}",b.getCacheString(),Ext.Date.now()))}return a},getUrl:function(a){return a?a.getUrl()||this.getApi()[a.getAction()]||this._url:this._url},doRequest:function(){},afterRequest:Ext.emptyFn});Ext.define("Ext.data.proxy.Ajax",{extend:Ext.data.proxy.Server,alias:"proxy.ajax",alternateClassName:["Ext.data.HttpProxy","Ext.data.AjaxProxy"],config:{withCredentials:false,useDefaultXhrHeader:true,username:null,password:null,actionMethods:{create:"POST",read:"GET",update:"POST",destroy:"POST"},headers:{}},doRequest:function(a,g,b){var e=this,f=e.getWriter(),d=e.buildRequest(a);d.setConfig({headers:e.getHeaders(),timeout:e.getTimeout(),method:e.getMethod(d),callback:e.createRequestCallback(d,a,g,b),scope:e,proxy:e,useDefaultXhrHeader:e.getUseDefaultXhrHeader()});if(a.getWithCredentials()||e.getWithCredentials()){d.setWithCredentials(true);d.setUsername(e.getUsername());d.setPassword(e.getPassword())}d=f.write(d);Ext.Ajax.request(d.getCurrentConfig());return d},getMethod:function(a){return this.getActionMethods()[a.getAction()]},createRequestCallback:function(e,a,f,b){var d=this;return function(h,j,g){d.processResponse(j,a,e,g,f,b)}}});Ext.define("Ext.data.association.Association",{alternateClassName:"Ext.data.Association",config:{ownerModel:null,ownerName:undefined,associatedModel:null,associatedName:undefined,associationKey:undefined,primaryKey:"id",reader:null,type:null,name:undefined},statics:{create:function(a){if(!a.isAssociation){if(Ext.isString(a)){a={type:a}}a.type=a.type.toLowerCase();return Ext.factory(a,Ext.data.association.Association,null,"association")}return a}},constructor:function(a){this.initConfig(a)},applyName:function(a){if(!a){a=this.getAssociatedName()}return a},applyOwnerModel:function(a){var b=Ext.data.ModelManager.getModel(a);if(b===undefined){Ext.Logger.error("The configured ownerModel was not valid (you tried "+a+")")}return b},applyOwnerName:function(a){if(!a){a=this.getOwnerModel().modelName}a=a.slice(a.lastIndexOf(".")+1);return a},updateOwnerModel:function(a,b){if(b){this.setOwnerName(a.modelName)}},applyAssociatedModel:function(a){var b=Ext.data.ModelManager.types[a];if(b===undefined){Ext.Logger.error("The configured associatedModel was not valid (you tried "+a+")")}return b},applyAssociatedName:function(a){if(!a){a=this.getAssociatedModel().modelName}a=a.slice(a.lastIndexOf(".")+1);return a},updateAssociatedModel:function(b,a){if(a){this.setAssociatedName(b.modelName)}},applyReader:function(a){if(a){if(Ext.isString(a)){a={type:a}}if(!a.isReader){Ext.applyIf(a,{type:"json"})}}return Ext.factory(a,Ext.data.Reader,this.getReader(),"reader")},updateReader:function(a){a.setModel(this.getAssociatedModel())}});Ext.define("Ext.util.Inflector",{singleton:true,plurals:[[(/(quiz)$/i),"$1zes"],[(/^(ox)$/i),"$1en"],[(/([m|l])ouse$/i),"$1ice"],[(/(matr|vert|ind)ix|ex$/i),"$1ices"],[(/(x|ch|ss|sh)$/i),"$1es"],[(/([^aeiouy]|qu)y$/i),"$1ies"],[(/(hive)$/i),"$1s"],[(/(?:([^f])fe|([lr])f)$/i),"$1$2ves"],[(/sis$/i),"ses"],[(/([ti])um$/i),"$1a"],[(/(buffal|tomat|potat)o$/i),"$1oes"],[(/(bu)s$/i),"$1ses"],[(/(alias|status|sex)$/i),"$1es"],[(/(octop|vir)us$/i),"$1i"],[(/(ax|test)is$/i),"$1es"],[(/^person$/),"people"],[(/^man$/),"men"],[(/^(child)$/),"$1ren"],[(/s$/i),"s"],[(/$/),"s"]],singulars:[[(/(quiz)zes$/i),"$1"],[(/(matr)ices$/i),"$1ix"],[(/(vert|ind)ices$/i),"$1ex"],[(/^(ox)en/i),"$1"],[(/(alias|status)es$/i),"$1"],[(/(octop|vir)i$/i),"$1us"],[(/(cris|ax|test)es$/i),"$1is"],[(/(shoe)s$/i),"$1"],[(/(o)es$/i),"$1"],[(/(bus)es$/i),"$1"],[(/([m|l])ice$/i),"$1ouse"],[(/(x|ch|ss|sh)es$/i),"$1"],[(/(m)ovies$/i),"$1ovie"],[(/(s)eries$/i),"$1eries"],[(/([^aeiouy]|qu)ies$/i),"$1y"],[(/([lr])ves$/i),"$1f"],[(/(tive)s$/i),"$1"],[(/(hive)s$/i),"$1"],[(/([^f])ves$/i),"$1fe"],[(/(^analy)ses$/i),"$1sis"],[(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i),"$1$2sis"],[(/([ti])a$/i),"$1um"],[(/(n)ews$/i),"$1ews"],[(/people$/i),"person"],[(/s$/i),""]],uncountable:["sheep","fish","series","species","money","rice","information","equipment","grass","mud","offspring","deer","means"],singular:function(b,a){this.singulars.unshift([b,a])},plural:function(b,a){this.plurals.unshift([b,a])},clearSingulars:function(){this.singulars=[]},clearPlurals:function(){this.plurals=[]},isTransnumeral:function(a){return Ext.Array.indexOf(this.uncountable,a)!=-1},pluralize:function(g){if(this.isTransnumeral(g)){return g}var f=this.plurals,e=f.length,a,d,b;for(b=0;b<e;b++){a=f[b];d=a[0];if(d==g||(d.test&&d.test(g))){return g.replace(d,a[1])}}return g},singularize:function(g){if(this.isTransnumeral(g)){return g}var f=this.singulars,e=f.length,a,d,b;for(b=0;b<e;b++){a=f[b];d=a[0];if(d==g||(d.test&&d.test(g))){return g.replace(d,a[1])}}return g},classify:function(a){return Ext.String.capitalize(this.singularize(a))},ordinalize:function(e){var b=parseInt(e,10),d=b%10,a=b%100;if(11<=a&&a<=13){return e+"th"}else{switch(d){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd";default:return e+"th"}}}},function(){var b={alumnus:"alumni",cactus:"cacti",focus:"foci",nucleus:"nuclei",radius:"radii",stimulus:"stimuli",ellipsis:"ellipses",paralysis:"paralyses",oasis:"oases",appendix:"appendices",index:"indexes",beau:"beaux",bureau:"bureaux",tableau:"tableaux",woman:"women",child:"children",man:"men",corpus:"corpora",criterion:"criteria",curriculum:"curricula",genus:"genera",memorandum:"memoranda",phenomenon:"phenomena",foot:"feet",goose:"geese",tooth:"teeth",antenna:"antennae",formula:"formulae",nebula:"nebulae",vertebra:"vertebrae",vita:"vitae"},a;for(a in b){this.plural(a,b[a]);this.singular(b[a],a)}});Ext.define("Ext.data.association.HasMany",{extend:Ext.data.association.Association,alternateClassName:"Ext.data.HasManyAssociation",alias:"association.hasmany",config:{foreignKey:undefined,store:undefined,storeName:undefined,filterProperty:null,autoLoad:false,autoSync:false},constructor:function(a){a=a||{};if(a.storeConfig){a.store=a.storeConfig;delete a.storeConfig}this.callParent([a])},applyName:function(a){if(!a){a=Ext.util.Inflector.pluralize(this.getAssociatedName().toLowerCase())}return a},applyStoreName:function(a){if(!a){a=this.getName()+"Store"}return a},applyForeignKey:function(b){if(!b){var a=this.getInverseAssociation();if(a){b=a.getForeignKey()}else{b=this.getOwnerName().toLowerCase()+"_id"}}return b},applyAssociationKey:function(a){if(!a){var b=this.getAssociatedName();a=Ext.util.Inflector.pluralize(b[0].toLowerCase()+b.slice(1))}return a},updateForeignKey:function(b,e){var a=this.getAssociatedModel().getFields(),d=a.get(b);if(!d){d=new Ext.data.Field({name:b});a.add(d);a.isDirty=true}if(e){d=a.get(e);if(d){a.remove(d);a.isDirty=true}}},applyStore:function(b){var f=this,k=f.getAssociatedModel(),g=f.getStoreName(),e=f.getForeignKey(),j=f.getPrimaryKey(),h=f.getFilterProperty(),d=f.getAutoLoad(),a=f.getAutoSync();return function(){var m=this,o,q,n,l={},p={addrecords:f.onAddRecords,removerecords:f.onRemoveRecords,scope:f};if(m[g]===undefined){if(h){q={property:h,value:m.get(h),exactMatch:true}}else{q={property:e,value:m.get(j),exactMatch:true}}l[e]=m.get(j);o=Ext.apply({},b,{model:k,filters:[q],remoteFilter:true,autoSync:a,modelDefaults:l});n=m[g]=Ext.create("Ext.data.Store",o);n.boundTo=m;n.onAfter(p);if(d){m[g].load()}}return m[g]}},onAddRecords:function(d,b){var f=b.length,g=d.boundTo.getId(),e,a;for(e=0;e<f;e++){a=b[e];a.set(this.getForeignKey(),g)}this.updateInverseInstances(d.boundTo)},onRemoveRecords:function(d,b){var f=b.length,e,a;for(e=0;e<f;e++){a=b[e];a.set(this.getForeignKey(),null)}},updateStore:function(a){this.getOwnerModel().prototype[this.getName()]=a},read:function(b,a,f){var e=b[this.getName()](),d=a.read(f).getRecords();e.add(d)},updateInverseInstances:function(b){var d=b[this.getName()](),a=this.getInverseAssociation();if(a){d.each(function(e){e[a.getInstanceName()]=b})}},getInverseAssociation:function(){var a=this.getOwnerModel().modelName;return this.getAssociatedModel().associations.findBy(function(b){return b.getType().toLowerCase()==="belongsto"&&b.getAssociatedModel().modelName===a})}});Ext.define("Ext.data.association.BelongsTo",{extend:Ext.data.association.Association,alternateClassName:"Ext.data.BelongsToAssociation",alias:"association.belongsto",config:{foreignKey:undefined,getterName:undefined,setterName:undefined,instanceName:undefined},applyForeignKey:function(a){if(!a){a=this.getAssociatedName().toLowerCase()+"_id"}return a},updateForeignKey:function(b,e){var a=this.getOwnerModel().getFields(),d=a.get(b);if(!d){d=new Ext.data.Field({name:b});a.add(d);a.isDirty=true}if(e){d=a.get(e);if(d){a.isDirty=true;a.remove(d)}}},applyInstanceName:function(a){if(!a){a=this.getAssociatedName()+"BelongsToInstance"}return a},applyAssociationKey:function(a){if(!a){var b=this.getAssociatedName();a=b[0].toLowerCase()+b.slice(1)}return a},applyGetterName:function(a){if(!a){var b=this.getAssociatedName();a="get"+b[0].toUpperCase()+b.slice(1)}return a},applySetterName:function(a){if(!a){var b=this.getAssociatedName();a="set"+b[0].toUpperCase()+b.slice(1)}return a},updateGetterName:function(b,d){var a=this.getOwnerModel().prototype;if(d){delete a[d]}if(b){a[b]=this.createGetter()}},updateSetterName:function(b,d){var a=this.getOwnerModel().prototype;if(d){delete a[d]}if(b){a[b]=this.createSetter()}},createSetter:function(){var e=this,d=e.getForeignKey(),g=e.getAssociatedModel(),f,a,b;return function(m,k,l){var j=e.getInverseAssociation(),h=this;if(m&&m.isModel){m=m.getId()}if(Ext.isFunction(k)){k={callback:k,scope:l||h}}delete h[e.getInstanceName()];f=Ext.data.Model.cache[Ext.data.Model.generateCacheId(g.modelName,this.get(d))];a=Ext.data.Model.cache[Ext.data.Model.generateCacheId(g.modelName,m)];h.set(d,m);if(j){if(a){if(j.getType().toLowerCase()==="hasmany"){b=a[j.getName()]();b.add(h)}else{a[j.getInstanceName()]=h}}if(f){if(j.getType().toLowerCase()==="hasmany"){b=f[j.getName()]();b.remove(h)}else{delete m[j.getInstanceName()]}}}if(a){h[e.getInstanceName()]=a}if(Ext.isObject(k)){return h.save(k)}return h}},createGetter:function(){var d=this,e=d.getAssociatedModel(),b=d.getForeignKey(),a=d.getInstanceName();return function(j,k){j=j||{};var h=this,l=h.get(b),m,f,g;f=h[a];if(!f){f=Ext.data.Model.cache[Ext.data.Model.generateCacheId(e.modelName,l)];if(f){h[a]=f}}if(j.reload===true||f===undefined){if(typeof j=="function"){j={callback:j,scope:k||h}}m=j.success;j.success=function(n){h[a]=n;if(m){m.apply(this,arguments)}};e.load(l,j)}else{g=[f];k=k||h;Ext.callback(j,k,g);Ext.callback(j.success,k,g);Ext.callback(j.failure,k,g);Ext.callback(j.callback,k,g);return f}}},read:function(b,a,d){b[this.getInstanceName()]=a.read([d]).getRecords()[0]},getInverseAssociation:function(){var b=this.getOwnerModel().modelName,a=this.getForeignKey();return this.getAssociatedModel().associations.findBy(function(e){var d=e.getType().toLowerCase();return(d==="hasmany"||d==="hasone")&&e.getAssociatedModel().modelName===b&&e.getForeignKey()===a})}});Ext.define("Ext.data.association.HasOne",{extend:Ext.data.association.Association,alternateClassName:"Ext.data.HasOneAssociation",alias:"association.hasone",config:{foreignKey:undefined,getterName:undefined,setterName:undefined,instanceName:undefined},applyForeignKey:function(b){if(!b){var a=this.getInverseAssociation();if(a){b=a.getForeignKey()}else{b=this.getAssociatedName().toLowerCase()+"_id"}}return b},updateForeignKey:function(b,e){var a=this.getOwnerModel().getFields(),d=a.get(b);if(!d){d=new Ext.data.Field({name:b});a.add(d);a.isDirty=true}if(e){d=a.get(e);if(d){a.remove(d);a.isDirty=true}}},applyInstanceName:function(a){if(!a){a=this.getAssociatedName()+"HasOneInstance"}return a},applyAssociationKey:function(a){if(!a){var b=this.getAssociatedName();a=b[0].toLowerCase()+b.slice(1)}return a},applyGetterName:function(a){if(!a){var b=this.getAssociatedName();a="get"+b[0].toUpperCase()+b.slice(1)}return a},applySetterName:function(a){if(!a){var b=this.getAssociatedName();a="set"+b[0].toUpperCase()+b.slice(1)}return a},updateGetterName:function(b,d){var a=this.getOwnerModel().prototype;if(d){delete a[d]}if(b){a[b]=this.createGetter()}},updateSetterName:function(b,d){var a=this.getOwnerModel().prototype;if(d){delete a[d]}if(b){a[b]=this.createSetter()}},createSetter:function(){var d=this,b=d.getForeignKey(),a=d.getInstanceName(),e=d.getAssociatedModel();return function(j,g,h){var k=Ext.data.Model,f;if(j&&j.isModel){j=j.getId()}this.set(b,j);if(j||j===0){f=k.cache[k.generateCacheId(e.modelName,j)];if(f){this[a]=f}}else{delete this[a]}if(Ext.isFunction(g)){g={callback:g,scope:h||this}}if(Ext.isObject(g)){return this.save(g)}return this}},createGetter:function(){var d=this,e=d.getAssociatedModel(),b=d.getForeignKey(),a=d.getInstanceName();return function(j,k){j=j||{};var h=this,l=h.get(b),m,f,g;if(j.reload===true||h[a]===undefined){if(typeof j=="function"){j={callback:j,scope:k||h}}m=j.success;j.success=function(n){h[a]=n;if(m){m.apply(this,arguments)}};e.load(l,j)}else{f=h[a];g=[f];k=k||h;Ext.callback(j,k,g);Ext.callback(j.success,k,g);Ext.callback(j.failure,k,g);Ext.callback(j.callback,k,g);return f}}},read:function(d,a,f){var b=this.getInverseAssociation(),e=a.read([f]).getRecords()[0];d[this.getSetterName()].call(d,e);if(b){e[b.getInstanceName()]=d}},getInverseAssociation:function(){var a=this.getOwnerModel().modelName;return this.getAssociatedModel().associations.findBy(function(b){return b.getType().toLowerCase()==="belongsto"&&b.getAssociatedModel().modelName===a})}});Ext.define("Ext.data.Error",{config:{field:null,message:""},constructor:function(a){this.initConfig(a)}});Ext.define("Ext.data.Errors",{extend:Ext.util.Collection,isValid:function(){return this.length===0},getByField:function(e){var d=[],a,b;for(b=0;b<this.length;b++){a=this.items[b];if(a.getField()==e){d.push(a)}}return d},add:function(){var a=arguments.length==1?arguments[0]:arguments[1];if(!(a instanceof Ext.data.Error)){a=Ext.create("Ext.data.Error",{field:a.field||a.name,message:a.error||a.message})}return this.callParent([a])}});Ext.define("Ext.data.Validations",{alternateClassName:"Ext.data.validations",singleton:true,config:{presenceMessage:"must be present",lengthMessage:"is the wrong length",formatMessage:"is the wrong format",inclusionMessage:"is not included in the list of acceptable values",exclusionMessage:"is not an acceptable value",emailMessage:"is not a valid email address"},constructor:function(a){this.initConfig(a)},getMessage:function(a){var b=this["get"+a[0].toUpperCase()+a.slice(1)+"Message"];if(b){return b.call(this)}return""},emailRe:/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/,presence:function(a,b){if(arguments.length===1){b=a}return !!b||b===0},length:function(b,f){if(f===undefined||f===null){return false}var e=f.length,d=b.min,a=b.max;if((d&&e<d)||(a&&e>a)){return false}else{return true}},email:function(b,a){return Ext.data.validations.emailRe.test(a)},format:function(a,b){if(b===undefined||b===null){b=""}return !!(a.matcher&&a.matcher.test(b))},inclusion:function(a,b){return a.list&&Ext.Array.indexOf(a.list,b)!=-1},exclusion:function(a,b){return a.list&&Ext.Array.indexOf(a.list,b)==-1}});Ext.define("Ext.data.Model",{alternateClassName:"Ext.data.Record",mixins:{observable:Ext.mixin.Observable},isModel:true,config:{idProperty:"id",data:null,fields:undefined,validations:null,associations:null,hasMany:null,hasOne:null,belongsTo:null,proxy:null,identifier:{type:"simple"},clientIdProperty:"clientId",isErased:false,useCache:true},staticConfigs:["idProperty","fields","validations","associations","hasMany","hasOne","belongsTo","clientIdProperty","identifier","useCache","proxy"],statics:{EDIT:"edit",REJECT:"reject",COMMIT:"commit",cache:{},generateProxyMethod:function(a){return function(){var b=this.prototype;return b[a].apply(b,arguments)}},generateCacheId:function(b,d){var a;if(b&&b.isModel){a=b.modelName;if(d===undefined){d=b.getId()}}else{a=b}return a.replace(/\./g,"-").toLowerCase()+"-"+d}},inheritableStatics:{load:function(a,b,j){var g=this.getProxy(),k=this.getIdProperty(),f=null,e={},h,d;j=j||(b&&b.scope)||this;if(Ext.isFunction(b)){b={callback:b,scope:j}}e[k]=a;b=Ext.apply({},b);b=Ext.applyIf(b,{action:"read",params:e,model:this});d=Ext.create("Ext.data.Operation",b);if(!g){Ext.Logger.error("You are trying to load a model that doesn't have a Proxy specified")}h=function(l){if(l.wasSuccessful()){f=l.getRecords()[0]||null;Ext.callback(b.success,j,[f,l])}else{Ext.callback(b.failure,j,[f,l])}Ext.callback(b.callback,j,[f,l])};g.read(d,h,this)}},editing:false,dirty:false,phantom:false,constructor:function(g,j,d,h){var f=this,e=null,a=f.getUseCache(),b=f.getIdProperty();g=g||h||{};if(j||j===0){g[b]=f.internalId=j}j=g[b];if(a&&(j||j===0)){e=Ext.data.Model.cache[Ext.data.Model.generateCacheId(this,j)];if(e){e.raw=d||e.raw;return e.mergeData(h||g||{})}}f.modified={};f.raw=d||g||{};f.stores=[];if(h){f.setConvertedData(g)}else{f.setData(g)}f.id=f.getIdentifier().generate(f);j=f.data[b];if(!j&&j!==0){f.data[b]=f.internalId=f.id;f.phantom=true;if(this.associations.length){this.handleInlineAssociationData(g)}}else{this.internalId=j}if(a){Ext.data.Model.cache[Ext.data.Model.generateCacheId(f)]=f}if(this.init&&typeof this.init=="function"){this.init()}},mergeData:function(a){var h=this,f=h.getFields().items,g=f.length,l=h.modified,d=h.data,e,j,m,k,b;for(e=0;e<g;e++){j=f[e];m=j._name;k=a[m];if(k!==undefined&&!l.hasOwnProperty(m)){if(j._convert){k=j._convert(k,h)}d[m]=k}else{if(Ext.isFunction(j._convert)){k=j._convert(k,h);d[m]=k}}}if(h.associations.length){h.handleInlineAssociationData(a)}return this},setData:function(a){var l=this,h=l.fields.items,j=h.length,g=Ext.isArray(a),e=l._data=l.data={},f,m,b,n,k,d;if(!a){return l}for(f=0;f<j;f++){m=h[f];b=m._name;k=m._convert;if(g){n=a[f]}else{n=a[b];if(typeof n=="undefined"){n=m._defaultValue}}if(k){n=m._convert(n,l)}e[b]=n}d=l.getId();if(l.associations.length&&(d||d===0)){l.handleInlineAssociationData(a)}return l},handleInlineAssociationData:function(f){var e=this.associations.items,j=e.length,g,d,b,h,k,a;f=Ext.apply({},f,this.raw);for(g=0;g<j;g++){d=e[g];a=d.getAssociationKey();b=f[a];if(b){h=d.getReader();if(!h){k=d.getAssociatedModel().getProxy();if(k){h=k.getReader()}else{h=new Ext.data.JsonReader({model:d.getAssociatedModel()})}}d.read(this,h,b)}}},setId:function(b){var a=this.getId();this.set(this.getIdProperty(),b);this.internalId=b;if(this.getUseCache()){delete Ext.data.Model.cache[Ext.data.Model.generateCacheId(this,a)];Ext.data.Model.cache[Ext.data.Model.generateCacheId(this)]=this}},getId:function(){return this.get(this.getIdProperty())},setConvertedData:function(a){this._data=this.data=a;return this},get:function(a){return this.data[a]},set:function(p,l){var j=this,b=j.fields.map,o=j.modified,a=!j.editing,f=0,d=[],k,n,e,m,g,h;if(arguments.length==1){for(n in p){if(p.hasOwnProperty(n)){k=b[n];if(k&&k.hasCustomConvert()){d.push(n);continue}if(!f&&a){j.beginEdit()}++f;j.set(n,p[n])}}g=d.length;if(g){if(!f&&a){j.beginEdit()}f+=g;for(e=0;e<g;e++){k=d[e];j.set(k,p[k])}}if(a&&f){j.endEdit(false,d)}}else{if(o){k=b[p];h=k&&k.getConvert();if(h){l=h.call(k,l,j)}m=j.data[p];j.data[p]=l;if(k&&!j.isEqual(m,l)){if(o.hasOwnProperty(p)){if(j.isEqual(o[p],l)){delete o[p];j.dirty=false;for(n in o){if(o.hasOwnProperty(n)){j.dirty=true;break}}}}else{j.dirty=true;o[p]=m}}if(a){j.afterEdit([p],o)}}}},isEqual:function(e,d){if(Ext.isDate(e)&&Ext.isDate(d)){return e.getTime()===d.getTime()}return e===d},beginEdit:function(){var a=this;if(!a.editing){a.editing=true;a.dirtySave=a.dirty;a.dataSave=Ext.apply({},a.data);a.modifiedSave=Ext.apply({},a.modified)}},cancelEdit:function(){var a=this;if(a.editing){a.editing=false;a.modified=a.modifiedSave;a.data=a.dataSave;a.dirty=a.dirtySave;delete a.modifiedSave;delete a.dataSave;delete a.dirtySave}},endEdit:function(a,d){var b=this;if(b.editing){b.editing=false;if(a!==true&&(b.changedWhileEditing())){b.afterEdit(d||Ext.Object.getKeys(this.modified),this.modified)}delete b.modifiedSave;delete b.dataSave;delete b.dirtySave}},changedWhileEditing:function(){var d=this,b=d.dataSave,e=d.data,a;for(a in e){if(e.hasOwnProperty(a)){if(!d.isEqual(e[a],b[a])){return true}}}return false},getChanges:function(){var a=this.modified,b={},d;for(d in a){if(a.hasOwnProperty(d)){b[d]=this.get(d)}}return b},isModified:function(a){return this.modified.hasOwnProperty(a)},save:function(b,e){var f=this,g=f.phantom?"create":"update",d=f.getProxy(),a,h;if(!d){Ext.Logger.error("You are trying to save a model instance that doesn't have a Proxy specified")}b=b||{};e=e||f;if(Ext.isFunction(b)){b={callback:b,scope:e}}Ext.applyIf(b,{records:[f],action:g,model:f.self});a=Ext.create("Ext.data.Operation",b);h=function(j){if(j.wasSuccessful()){Ext.callback(b.success,e,[f,j])}else{Ext.callback(b.failure,e,[f,j])}Ext.callback(b.callback,e,[f,j])};d[g](a,h,f);return f},erase:function(b,e){var f=this,d=this.getProxy(),a,g;if(!d){Ext.Logger.error("You are trying to erase a model instance that doesn't have a Proxy specified")}b=b||{};e=e||f;if(Ext.isFunction(b)){b={callback:b,scope:e}}Ext.applyIf(b,{records:[f],action:"destroy",model:this.self});a=Ext.create("Ext.data.Operation",b);g=function(h){if(h.wasSuccessful()){Ext.callback(b.success,e,[f,h])}else{Ext.callback(b.failure,e,[f,h])}Ext.callback(b.callback,e,[f,h])};d.destroy(a,g,f);return f},reject:function(a){var d=this,b=d.modified,e;for(e in b){if(b.hasOwnProperty(e)){if(typeof b[e]!="function"){d.data[e]=b[e]}}}d.dirty=false;d.editing=false;d.modified={};if(a!==true){d.afterReject()}},commit:function(a){var d=this,b=this.modified;d.phantom=d.dirty=d.editing=false;d.modified={};if(a!==true){d.afterCommit(b)}},afterEdit:function(b,a){this.notifyStores("afterEdit",b,a)},afterReject:function(){this.notifyStores("afterReject")},afterCommit:function(a){this.notifyStores("afterCommit",Ext.Object.getKeys(a||{}),a)},notifyStores:function(f){var d=Ext.Array.clone(arguments),a=this.stores;if(Ext.isArray(a)){var g=a.length,e,b;d[0]=this;for(e=0;e<g;++e){b=a[e];if(b!==undefined&&typeof b[f]=="function"){b[f].apply(b,d)}}}},copy:function(d){var e=this,b=e.getIdProperty(),a=Ext.apply({},e.raw),f=Ext.apply({},e.data);delete a[b];delete f[b];return new e.self(null,d,a,f)},getData:function(a){var b=this.data;if(a===true){Ext.apply(b,this.getAssociatedData())}return b},getAssociatedData:function(){return this.prepareAssociatedData(this,[],null)},prepareAssociatedData:function(e,n,d){var s=e.associations.items,h=s.length,u={},p=[],o,w,b,a,l,f,m,r,q,g,v,k;for(r=0;r<h;r++){f=s[r];w=f.getName();g=f.getType();v=true;if(d){v=g==d}if(v&&g.toLowerCase()=="hasmany"){o=e[f.getStoreName()];u[w]=[];if(o&&o.getCount()>0){b=o.data.items;l=b.length;p.length=0;for(q=0;q<l;q++){a=b[q];m=a.id;if(Ext.Array.indexOf(n,m)==-1){n.push(m);u[w][q]=a.getData();p.push({associationName:w,j:q,associatedRecord:a,ids:n,associationType:d})}}while(p.length>0){k=p.shift();Ext.apply(u[k.associationName][k.j],this.prepareAssociatedData(k.associatedRecord,k.ids,k.associationType))}}}else{if(v&&(g.toLowerCase()=="belongsto"||g.toLowerCase()=="hasone")){a=e[f.getInstanceName()];if(a!==undefined){m=a.id;if(Ext.Array.indexOf(n,m)===-1){n.push(m);u[w]=a.getData();Ext.apply(u[w],this.prepareAssociatedData(a,n,d))}}}}}return u},join:function(a){Ext.Array.include(this.stores,a)},unjoin:function(a){Ext.Array.remove(this.stores,a)},setDirty:function(){var b=this,a;b.dirty=true;b.fields.each(function(d){if(d.getPersist()){a=d.getName();b.modified[a]=b.get(a)}})},validate:function(){var k=Ext.create("Ext.data.Errors"),d=this.getValidations().items,f=Ext.data.Validations,b,e,j,a,h,g;if(d){b=d.length;for(g=0;g<b;g++){e=d[g];j=e.field||e.name;h=e.type;a=f[h](e,this.get(j));if(!a){k.add(Ext.create("Ext.data.Error",{field:j,message:e.message||f.getMessage(h)}))}}}return k},isValid:function(){return this.validate().isValid()},toUrl:function(){var b=this.$className.split("."),a=b[b.length-1].toLowerCase();return a+"/"+this.getId()},destroy:function(){var a=this;a.notifyStores("afterErase",a);if(a.getUseCache()){delete Ext.data.Model.cache[Ext.data.Model.generateCacheId(a)]}a.raw=a.stores=a.modified=null;a.callParent(arguments)},applyProxy:function(b,a){return Ext.factory(b,Ext.data.Proxy,a,"proxy")},updateProxy:function(a){if(a){a.setModel(this.self)}},applyAssociations:function(a){if(a){this.addAssociations(a,"hasMany")}},applyBelongsTo:function(a){if(a){this.addAssociations(a,"belongsTo")}},applyHasMany:function(a){if(a){this.addAssociations(a,"hasMany")}},applyHasOne:function(a){if(a){this.addAssociations(a,"hasOne")}},addAssociations:function(f,j){var g,e,b,d=this.self.modelName,h=this.self.associations,a;f=Ext.Array.from(f);for(e=0,g=f.length;e<g;e++){b=f[e];if(!Ext.isObject(b)){b={model:b}}Ext.applyIf(b,{type:j,ownerModel:d,associatedModel:b.model});delete b.model;a=Ext.Function.bind(function(k){h.add(Ext.data.association.Association.create(this))},b);Ext.ClassManager.onCreated(a,this,(typeof b.associatedModel==="string")?b.associatedModel:Ext.getClassName(b.associatedModel))}},applyValidations:function(a){if(a){if(!Ext.isArray(a)){a=[a]}this.addValidations(a)}},addValidations:function(a){this.self.validations.addAll(a)},applyFields:function(a){var b=this.superclass.fields;if(b){a=b.items.concat(a||[])}return a||[]},updateFields:function(d){var e=d.length,f=this,j=f.self.prototype,k=this.getIdProperty(),a,g,h,b;g=f._fields=f.fields=new Ext.util.Collection(j.getFieldName);for(b=0;b<e;b++){h=d[b];if(!h.isField){h=new Ext.data.Field(d[b])}g.add(h)}a=g.get(k);if(!a){g.add(new Ext.data.Field(k))}else{a.setType("auto")}g.addSorter(j.sortConvertFields)},applyIdentifier:function(a){if(typeof a==="string"){a={type:a}}return Ext.factory(a,Ext.data.identifier.Simple,this.getIdentifier(),"data.identifier")},getFieldName:function(a){return a.getName()},sortConvertFields:function(a,e){var d=a.hasCustomConvert(),b=e.hasCustomConvert();if(d&&!b){return 1}if(!d&&b){return -1}return 0},onClassExtended:function(m,e,l){var g=l.onBeforeCreated,b=this,j=b.prototype,f=Ext.Class.configNameCache,h=j.staticConfigs.concat(e.staticConfigs||[]),d=j.config,a=e.config||{},k;e.config=a;l.onBeforeCreated=function(D,w){var y=[],A=D.prototype,z={},o=A.config,p=h.length,s=["set","get"],v=s.length,q=o.associations||[],n=Ext.getClassName(D),C,B,u,r,x;for(u=0;u<p;u++){C=h[u];for(r=0;r<v;r++){B=f[C][s[r]];if(B in A){z[B]=b.generateProxyMethod(B)}}}D.addStatics(z);D.modelName=n;A.modelName=n;if(o.belongsTo){y.push("association.belongsto")}if(o.hasMany){y.push("association.hasmany")}if(o.hasOne){y.push("association.hasone")}for(u=0,x=q.length;u<x;++u){y.push("association."+q[u].type.toLowerCase())}if(o.identifier){if(typeof o.identifier==="string"){y.push("data.identifier."+o.identifier)}else{if(typeof o.identifier.type==="string"){y.push("data.identifier."+o.identifier.type)}}}if(o.proxy){if(typeof o.proxy==="string"){y.push("proxy."+o.proxy)}else{if(typeof o.proxy.type==="string"){y.push("proxy."+o.proxy.type)}}}if(o.validations){y.push("Ext.data.Validations")}Ext.require(y,function(){Ext.Function.interceptBefore(l,"onCreated",function(){Ext.data.ModelManager.registerType(n,D);var E=D.prototype.superclass;D.prototype.associations=D.associations=D.prototype._associations=(E&&E.associations)?E.associations.clone():new Ext.util.Collection(function(F){return F.getName()});D.prototype.validations=D.validations=D.prototype._validations=(E&&E.validations)?E.validations.clone():new Ext.util.Collection(function(F){return F.field?(F.field+"-"+F.type):(F.name+"-"+F.type)});D.prototype=Ext.Object.chain(D.prototype);D.prototype.initConfig.call(D.prototype,o);delete D.prototype.initConfig});g.call(b,D,w,l)})}}});Ext.define("Ext.util.Grouper",{extend:Ext.util.Sorter,isGrouper:true,config:{groupFn:null,sortProperty:null,sorterFn:function(e,d){var f=this.getSortProperty(),h,b,g,a;h=this.getGroupFn();b=h.call(this,e);g=h.call(this,d);if(f){if(b!==g){return this.defaultSortFn.call(this,e,d)}else{return 0}}return(b>g)?1:((b<g)?-1:0)}},defaultSortFn:function(f,d){var h=this,g=h._transform,b=h._root,e,a,j=h._sortProperty;if(b!==null){f=f[b];d=d[b]}e=f[j];a=d[j];if(g){e=g(e);a=g(a)}return e>a?1:(e<a?-1:0)},updateProperty:function(a){this.setGroupFn(this.standardGroupFn)},standardGroupFn:function(b){var a=this.getRoot(),e=this.getProperty(),d=b;if(a){d=b[a]}return d[e]},getGroupString:function(a){var b=this.getGroupFn().call(this,a);return(b!==null&&typeof b!="undefined")?b.toString():""}});Ext.define("Ext.data.Store",{alias:"store.store",extend:Ext.Evented,statics:{create:function(a){if(!a.isStore){if(!a.type){a.type="store"}a=Ext.createByAlias("store."+a.type,a)}return a}},isStore:true,config:{storeId:undefined,data:null,autoLoad:null,autoSync:false,model:undefined,proxy:undefined,fields:null,remoteSort:false,remoteFilter:false,remoteGroup:false,filters:null,sorters:null,grouper:null,groupField:null,groupDir:null,getGroupString:null,pageSize:25,totalCount:null,clearOnPageLoad:true,params:{},modelDefaults:{},autoDestroy:false,syncRemovedRecords:true,destroyRemovedRecords:true,buffered:false,plugins:null},currentPage:1,constructor:function(a){a=a||{};this.data=this._data=this.createDataCollection();this.data.setSortRoot("data");this.data.setFilterRoot("data");this.removed=[];if(a.id&&!a.storeId){a.storeId=a.id;delete a.id}this.initConfig(a);this.callParent(arguments)},applyPlugins:function(a){var d,b,e;if(!a){return a}a=[].concat(a);for(b=0,d=a.length;b<d;b++){e=a[b];a[b]=Ext.factory(e,"Ext.plugin.Plugin",null,"plugin")}return a},updatePlugins:function(e,a){var d,b;if(e){for(b=0,d=e.length;b<d;b++){e[b].init(this)}}if(a){for(b=0,d=a.length;b<d;b++){Ext.destroy(a[b])}}},createDataCollection:function(){return new Ext.util.Collection(function(a){return a.getId()})},applyStoreId:function(a){if(a===undefined||a===null){a=this.getUniqueId()}return a},updateStoreId:function(a,b){if(b){Ext.data.StoreManager.unregister(this)}if(a){Ext.data.StoreManager.register(this)}},applyModel:function(b){if(typeof b=="string"){var e=Ext.data.ModelManager.getModel(b);if(!e){Ext.Logger.error('Model with name "'+b+'" does not exist.')}b=e}if(b&&!b.prototype.isModel&&Ext.isObject(b)){b=Ext.data.ModelManager.registerType(b.storeId||b.id||Ext.id(),b)}if(!b){var a=this.getFields(),d=this.config.data;if(!a&&d&&d.length){a=Ext.Object.getKeys(d[0])}if(a){b=Ext.define("Ext.data.Store.ImplicitModel-"+(this.getStoreId()||Ext.id()),{extend:"Ext.data.Model",config:{fields:a,useCache:false,proxy:this.getProxy()}});this.implicitModel=true}}if(!b&&this.getProxy()){b=this.getProxy().getModel()}return b},updateModel:function(a){var b=this.getProxy();if(b&&!b.getModel()){b.setModel(a)}},applyProxy:function(b,a){b=Ext.factory(b,Ext.data.Proxy,a,"proxy");if(!b&&this.getModel()){b=this.getModel().getProxy()}if(!b){b=new Ext.data.proxy.Memory({model:this.getModel()})}if(b.isMemoryProxy){this.setSyncRemovedRecords(false)}return b},updateProxy:function(b,a){if(b){if(!b.getModel()){b.setModel(this.getModel())}b.on("metachange","onMetaChange",this)}if(a){b.un("metachange","onMetaChange",this)}},applyData:function(d){var b=this,a;if(d){a=b.getProxy();if(a instanceof Ext.data.proxy.Memory){a.setData(d);b.load();return}else{b.removeAll(true);b.fireEvent("clear",b);b.suspendEvents();b.add(d);b.resumeEvents();b.dataLoaded=true}}else{b.removeAll(true);b.fireEvent("clear",b)}b.fireEvent("refresh",b,b.data)},clearData:function(){this.setData(null)},addData:function(e){var a=this.getProxy().getReader(),d=a.read(e),b=d.getRecords();this.add(b)},updateAutoLoad:function(a){var b=this.getProxy();if(a&&(b&&!b.isMemoryProxy)){this.load(Ext.isObject(a)?a:null)}},isAutoLoading:function(){var a=this.getProxy();return(this.getAutoLoad()||(a&&a.isMemoryProxy)||this.dataLoaded)},updateGroupField:function(a){var b=this.getGrouper();if(a){if(!b){this.setGrouper({property:a,direction:this.getGroupDir()||"ASC"})}else{b.setProperty(a)}}else{if(b){this.setGrouper(null)}}},updateGroupDir:function(a){var b=this.getGrouper();if(b){b.setDirection(a)}},applyGetGroupString:function(b){var a=this.getGrouper();if(b){if(a){a.setGroupFn(b)}else{this.setGrouper({groupFn:b})}}else{if(a){this.setGrouper(null)}}},applyGrouper:function(a){if(typeof a=="string"){a={property:a}}else{if(typeof a=="function"){a={groupFn:a}}}a=Ext.factory(a,Ext.util.Grouper);return a},updateGrouper:function(b,a){var d=this.data;if(a){d.removeSorter(a);if(!b){d.getSorters().removeSorter("isGrouper")}}if(b){d.insertSorter(0,b);if(!a){d.getSorters().addSorter({direction:"DESC",property:"isGrouper",transform:function(e){return(e===true)?1:-1}})}}if(a){this.fireEvent("refresh",this,d)}},isGrouped:function(){return !!this.getGrouper()},updateSorters:function(e){var b=this.getGrouper(),d=this.data,a=d.getAutoSort();d.setAutoSort(false);d.setSorters(e);if(b){d.insertSorter(0,b)}this.updateSortTypes();d.setAutoSort(a)},updateSortTypes:function(){var b=this.getModel(),a=b&&b.getFields(),d=this.data;if(a){d.getSorters().each(function(g){var e=g.getProperty(),f;if(!g.isGrouper&&e&&!g.getTransform()){f=a.get(e);if(f){g.setTransform(f.getSortType())}}})}},updateFilters:function(a){this.data.setFilters(a)},add:function(a){if(!Ext.isArray(a)){a=Array.prototype.slice.call(arguments)}return this.insert(this.data.length,a)},insert:function(g,b){if(!Ext.isArray(b)){b=Array.prototype.slice.call(arguments,1)}var k=this,m=false,e=this.data,h=b.length,a=this.getModel(),j=k.getModelDefaults(),l=false,d,f;b=b.slice();for(d=0;d<h;d++){f=b[d];if(!f.isModel){f=new a(f)}else{if(this.removed.indexOf(f)!=-1){Ext.Array.remove(this.removed,f)}}f.set(j);f.join(k);b[d]=f;m=m||(f.phantom===true)}if(b.length===1){l=e.insert(g,b[0]);if(l){l=[l]}}else{l=e.insertAll(g,b)}if(l){k.fireEvent("addrecords",k,l)}if(k.getAutoSync()&&m){k.sync()}return b},remove:function(b){if(b.isModel){b=[b]}var l=this,m=false,e=0,a=this.getAutoSync(),p=l.getSyncRemovedRecords(),d=this.getDestroyRemovedRecords(),k=b.length,o=[],h=[],n,j=l.data.items,f,g;for(;e<k;e++){f=b[e];if(l.data.contains(f)){n=(f.phantom===true);g=j.indexOf(f);if(g!==-1){h.push(f);o.push(g)}f.unjoin(l);l.data.remove(f);if(d&&!p&&!f.stores.length){f.destroy()}else{if(!n&&p){l.removed.push(f)}}m=m||!n}}l.fireEvent("removerecords",l,h,o);if(a&&m){l.sync()}},removeAt:function(b){var a=this.getAt(b);if(a){this.remove(a)}},removeAll:function(a){if(a!==true&&this.eventFiringSuspended!==true){this.fireAction("clear",[this],"doRemoveAll")}else{this.doRemoveAll.call(this,true)}},doRemoveAll:function(e){var h=this,a=this.getDestroyRemovedRecords(),j=this.getSyncRemovedRecords(),d=h.data.all.slice(),g=d.length,f,b;for(f=0;f<g;f++){b=d[f];b.unjoin(h);if(a&&!j&&!b.stores.length){b.destroy()}else{if(b.phantom!==true&&j){h.removed.push(b)}}}h.data.clear();if(e!==true){h.fireEvent("refresh",h,h.data)}if(h.getAutoSync()){this.sync()}},each:function(b,a){this.data.each(b,a)},getCount:function(){return this.data.items.length||0},getAllCount:function(){return this.data.all.length||0},getAt:function(a){return this.data.getAt(a)},getRange:function(b,a){return this.data.getRange(b,a)},getById:function(a){return this.data.findBy(function(b){return b.getId()==a})},indexOf:function(a){return this.data.indexOf(a)},indexOfId:function(a){return this.data.indexOfKey(a)},afterEdit:function(d,h,e){var g=this,j=g.data,a=e[d.getIdProperty()]||d.getId(),b=j.keys.indexOf(a),f;if(b===-1&&j.map[a]===undefined){return}if(g.getAutoSync()){g.sync()}if(a!==d.getId()){j.replace(a,d)}else{j.replace(d)}f=j.indexOf(d);if(b===-1&&f!==-1){g.fireEvent("addrecords",g,[d])}else{if(b!==-1&&f===-1){g.fireEvent("removerecords",g,[d],[b])}else{if(f!==-1){g.fireEvent("updaterecord",g,d,f,b,h,e)}}}},afterReject:function(a){var b=this.data.indexOf(a);this.fireEvent("updaterecord",this,a,b,b,[],{})},afterCommit:function(d,h,e){var g=this,j=g.data,a=e[d.getIdProperty()]||d.getId(),b=j.keys.indexOf(a),f;if(b===-1&&j.map[a]===undefined){return}if(a!==d.getId()){j.replace(a,d)}else{j.replace(d)}f=j.indexOf(d);if(b===-1&&f!==-1){g.fireEvent("addrecords",g,[d])}else{if(b!==-1&&f===-1){g.fireEvent("removerecords",g,[d],[b])}else{if(f!==-1){g.fireEvent("updaterecord",g,d,f,b,h,e)}}}},afterErase:function(a){var d=this,e=d.data,b=e.indexOf(a);if(b!==-1){e.remove(a);d.fireEvent("removerecords",d,[a],[b])}},applyRemoteFilter:function(b){var a=this.getProxy();return b||(a&&a.isSQLProxy===true)},applyRemoteSort:function(b){var a=this.getProxy();return b||(a&&a.isSQLProxy===true)},applyRemoteGroup:function(b){var a=this.getProxy();return b||(a&&a.isSQLProxy===true)},updateRemoteFilter:function(a){this.data.setAutoFilter(!a)},updateRemoteSort:function(a){this.data.setAutoSort(!a)},sort:function(g,e,d){var f=this.data,b=this.getGrouper(),a=f.getAutoSort();if(g){f.setAutoSort(false);if(typeof d==="string"){if(d=="prepend"){f.insertSorters(b?1:0,g,e)}else{f.addSorters(g,e)}}else{f.setSorters(null);if(b){f.addSorters(b)}f.addSorters(g,e)}this.updateSortTypes();f.setAutoSort(a)}if(!this.getRemoteSort()){if(!g){this.data.sort()}this.fireEvent("sort",this,this.data,this.data.getSorters());if(f.length){this.fireEvent("refresh",this,this.data)}}},filter:function(f,e,g,a){var d=this.data,b=null;if(f){if(Ext.isFunction(f)){b={filterFn:f}}else{if(Ext.isArray(f)||f.isFilter){b=f}else{b={property:f,value:e,anyMatch:g,caseSensitive:a,id:f}}}}if(this.getRemoteFilter()){d.addFilters(b)}else{d.filter(b);this.fireEvent("filter",this,d,d.getFilters());this.fireEvent("refresh",this,d)}},filterBy:function(b,a){var e=this,f=e.data,d=f.length;f.filter({filterFn:function(g){return b.call(a||e,g,g.getId())}});this.fireEvent("filter",this,f,f.getFilters());if(f.length!==d){this.fireEvent("refresh",this,f)}},queryBy:function(b,a){return this.data.filterBy(b,a||this)},clearFilter:function(a){var b=this.data.length;if(a){this.suspendEvents()}this.data.setFilters(null);if(a){this.resumeEvents(true)}else{if(b!==this.data.length){this.fireEvent("refresh",this,this.data)}}},isFiltered:function(){return this.data.filtered},isSorted:function(){return this.data.sorted},getSorters:function(){var a=this.data.getSorters();return(a)?a.items:[]},getFilters:function(){var a=this.data.getFilters();return(a)?a.items:[]},getGroups:function(d){var f=this.data.items,b=f.length,a=this.getGrouper(),e=[],l={},h,j,k,g;for(g=0;g<b;g++){h=f[g];j=a.getGroupString(h);k=l[j];if(k===undefined){k={name:j,children:[]};e.push(k);l[j]=k}k.children.push(h)}return d?l[d]:e},getGroupString:function(a){var b=this.getGrouper();if(b){return b.getGroupString(a)}return null},find:function(h,e,f,g,a,d){var b=Ext.create("Ext.util.Filter",{property:h,value:e,anyMatch:g,caseSensitive:a,exactMatch:d,root:"data"});return this.data.findIndexBy(b.getFilterFn(),null,f)},findRecord:function(){var b=this,a=b.find.apply(b,arguments);return a!==-1?b.getAt(a):null},findExact:function(d,a,b){return this.data.findIndexBy(function(e){return e.get(d)===a},this,b)},findBy:function(b,a,d){return this.data.findIndexBy(b,a,d)},load:function(d,f){var g=this,b,e=g.currentPage,a=g.getPageSize();d=d||{};if(Ext.isFunction(d)){d={callback:d,scope:f||this}}if(g.getRemoteSort()){d.sorters=d.sorters||this.getSorters()}if(g.getRemoteFilter()){d.filters=d.filters||this.getFilters()}if(g.getRemoteGroup()){d.grouper=d.grouper||this.getGrouper()}Ext.applyIf(d,{page:e,start:(e-1)*a,limit:a,addRecords:false,action:"read",params:this.getParams(),model:this.getModel()});b=Ext.create("Ext.data.Operation",d);if(g.fireEvent("beforeload",g,b)!==false){g.loading=true;g.getProxy().read(b,g.onProxyLoad,g)}return g},isLoading:function(){return Boolean(this.loading)},isLoaded:function(){return Boolean(this.loaded)},sync:function(d){var f=this,b={},g=f.getNewRecords(),e=f.getUpdatedRecords(),a=f.getRemovedRecords(),h=false;if(g.length>0){b.create=g;h=true}if(e.length>0){b.update=e;h=true}if(a.length>0){b.destroy=a;h=true}if(h&&f.fireEvent("beforesync",this,b)!==false){f.getProxy().batch(Ext.merge({operations:b,listeners:f.getBatchListeners()},d||{}))}return{added:g,updated:e,removed:a}},first:function(){return this.data.first()},last:function(){return this.data.last()},sum:function(f){var e=0,d=0,b=this.data.items,a=b.length;for(;d<a;++d){e+=b[d].get(f)}return e},min:function(g){var e=1,b=this.data.items,a=b.length,f,d;if(a>0){d=b[0].get(g)}for(;e<a;++e){f=b[e].get(g);if(f<d){d=f}}return d},max:function(g){var e=1,d=this.data.items,b=d.length,f,a;if(b>0){a=d[0].get(g)}for(;e<b;++e){f=d[e].get(g);if(f>a){a=f}}return a},average:function(f){var d=0,b=this.data.items,a=b.length,e=0;if(b.length>0){for(;d<a;++d){e+=b[d].get(f)}return e/a}return 0},getBatchListeners:function(){return{scope:this,exception:this.onBatchException,complete:this.onBatchComplete}},onBatchComplete:function(b){var f=this,a=b.operations,e=a.length,d;for(d=0;d<e;d++){f.onProxyWrite(a[d])}},onBatchException:function(b,a){},onProxyLoad:function(b){var e=this,a=b.getRecords(),d=b.getResultSet(),f=b.wasSuccessful();if(d){e.setTotalCount(d.getTotal())}if(f){this.fireAction("datarefresh",[this,this.data,b],"doDataRefresh")}e.loaded=true;e.loading=false;e.fireEvent("load",this,a,f,b);Ext.callback(b.getCallback(),b.getScope()||e,[a,b,f])},doDataRefresh:function(n,j,e){var d=e.getRecords(),m=this,g=m.getDestroyRemovedRecords(),f=j.all.slice(),l=f.length,b=d.length,a={},h,k;if(e.getAddRecords()!==true){for(h=0;h<b;h++){a[d[h].id]=true}for(h=0;h<l;h++){k=f[h];k.unjoin(m);if(a[k.id]!==true&&g&&!k.stores.length){k.destroy()}}j.clear();m.fireEvent("clear",m)}if(d&&d.length){m.suspendEvents();m.add(d);m.resumeEvents(true)}m.fireEvent("refresh",m,j)},onProxyWrite:function(b){var d=this,e=b.wasSuccessful(),a=b.getRecords();switch(b.getAction()){case"create":d.onCreateRecords(a,b,e);break;case"update":d.onUpdateRecords(a,b,e);break;case"destroy":d.onDestroyRecords(a,b,e);break}if(e){d.fireEvent("write",d,b)}Ext.callback(b.getCallback(),b.getScope()||d,[a,b,e])},onCreateRecords:function(b,a,d){},onUpdateRecords:function(b,a,d){},onDestroyRecords:function(b,a,d){this.removed=[]},onMetaChange:function(b){var a=this.getProxy().getModel();if(!this.getModel()&&a){this.setModel(a)}this.fireEvent("metachange",this,b)},getNewRecords:function(){return this.data.filterBy(function(a){return a.phantom===true&&a.isValid()}).items},getUpdatedRecords:function(){return this.data.filterBy(function(a){return a.dirty===true&&a.phantom!==true&&a.isValid()}).items},getRemovedRecords:function(){return this.removed},loadPage:function(g,d,e){if(typeof d==="function"){d={callback:d,scope:e||this}}var f=this,b=f.getPageSize(),a=f.getClearOnPageLoad();d=Ext.apply({},d);f.currentPage=g;f.load(Ext.applyIf(d,{page:g,start:(g-1)*b,limit:b,addRecords:!a}))},nextPage:function(a){this.loadPage(this.currentPage+1,a)},previousPage:function(a){this.loadPage(this.currentPage-1,a)},destroy:function(){this.clearData();var a=this.getProxy();if(a){a.onDestroy()}Ext.data.StoreManager.unregister(this);Ext.destroy(this.getPlugins());if(this.implicitModel&&this.getModel()){delete Ext.data.ModelManager.types[this.getModel().getName()]}Ext.destroy(this.data);this.callParent(arguments)}});Ext.define("Ext.event.publisher.Publisher",{targetType:"",idSelectorRegex:/^#([\w\-]+)$/i,constructor:function(){var b=this.handledEvents,a,d,f,e;a=this.handledEventsMap={};for(d=0,f=b.length;d<f;d++){e=b[d];a[e]=true}this.subscribers={};return this},handles:function(a){var b=this.handledEventsMap;return !!b[a]||!!b["*"]||a==="*"},getHandledEvents:function(){return this.handledEvents},setDispatcher:function(a){this.dispatcher=a},subscribe:function(){return false},unsubscribe:function(){return false},unsubscribeAll:function(){delete this.subscribers;this.subscribers={};return this},notify:function(){return false},getTargetType:function(){return this.targetType},dispatch:function(d,a,b){this.dispatcher.doDispatchEvent(this.targetType,d,a,b)}});Ext.define("Ext.chart.series.ItemPublisher",{extend:Ext.event.publisher.Publisher,targetType:"series",handledEvents:["itemmousemove","itemmouseup","itemmousedown","itemmouseover","itemmouseout","itemclick","itemdoubleclick","itemtap","itemtapstart","itemtapend","itemtapcancel","itemtaphold","itemdoubletap","itemsingletap","itemtouchstart","itemtouchmove","itemtouchend","itemdragstart","itemdrag","itemdragend","itempinchstart","itempinch","itempinchend","itemswipe"],delegationRegex:/^item([a-z]+)$/i,getSubscribers:function(b){var a=this.subscribers;if(!a.hasOwnProperty(b)){a[b]={}}return a[b]},subscribe:function(g,a){var b=g.match(this.idSelectorRegex),e=this.dispatcher,f=this.targetType,d,h;if(!b){return false}h=b[1];d=Ext.ComponentManager.get(h);if(!d){return false}if(!d.getChart()){e.addListener(f,g,"chartattached","attachChart",this,[d,a],"before")}else{this.attachChart(d.getChart(),[d,a])}return true},attachChart:function(g,h){var k=this.dispatcher,b=this.targetType,d=h[0],f=h[1],a=this.getSubscribers(g.getId()),e=f.match(this.delegationRegex);if(e){var j=e[1];if(!a.hasOwnProperty(f)){a[f]=[];k.addListener(b,"#"+d.getId(),"chartdetached","detachChart",this,[d,f,a],"after");g.element.on(j,"relayMethod",this,[g,f])}a[f].push(d);return true}else{return false}},unsubscribe:function(g,a){var b=g.match(this.idSelectorRegex),e=this.dispatcher,f=this.targetType,d,h;if(!b){return false}h=b[1];d=Ext.ComponentManager.get(h);if(!d){return false}e.removeListener(f,g,"chartattached","attachChart",this,"before");if(d.getChart()){this.detachChart(d.getChart(),[d,a])}return true},detachChart:function(j,k){var m=this.dispatcher,b=this.targetType,e=k[0],g=k[1],a=this.getSubscribers(j.getId()),f=g.match(this.delegationRegex),h,d;if(f){var l=f[1];if(a.hasOwnProperty(g)){d=a[g];h=d.indexOf(e);if(h>-1){d.splice(h,1)}if(d.length===0){j.element.un(l,"relayMethod",this,[j,g]);m.removeListener(b,"#"+e.getId(),"chartdetached","detachChart",this,"after");delete a[g]}}}},relayMethod:function(j,g,m){var l=m[0],h=m[1],r=this.dispatcher,a=this.targetType,b=l.getEventXY(j),o=b[0],n=b[1],q=this.getSubscribers(l.getId())[h],f,k;if(q){for(f=0,k=q.length;f<k;f++){var d=q[f],p=d.getItemForPoint(o,n);if(p){r.doDispatchEvent(a,"#"+d.getId(),h,[d,p,j]);return}}}}},function(){});Ext.define("Ext.data.ArrayStore",{extend:Ext.data.Store,alias:"store.array",config:{proxy:{type:"memory",reader:"array"}},loadData:function(b,a){this.callParent([b,a])}},function(){Ext.data.SimpleStore=Ext.data.ArrayStore});Ext.define("Ext.data.Cross",{extend:Ext.data.Connection,alternateClassName:["Ext.Cross"],singleton:true,config:{autoAbort:false,useDefaultXhrHeader:false}});Ext.define("Ext.direct.Manager",{singleton:true,mixins:{observable:Ext.mixin.Observable},alternateClassName:"Ext.Direct",exceptions:{TRANSPORT:"xhr",PARSE:"parse",LOGIN:"login",SERVER:"exception"},constructor:function(){var a=this;a.transactions=Ext.create("Ext.util.Collection",this.getKey);a.providers=Ext.create("Ext.util.Collection",this.getKey)},getKey:function(a){return a.getId()},addProvider:function(f){var e=this,a=Ext.toArray(arguments),b=0,d;if(a.length>1){for(d=a.length;b<d;++b){e.addProvider(a[b])}return}if(!f.isProvider){f=Ext.create("direct."+f.type+"provider",f)}e.providers.add(f);f.on("data",e.onProviderData,e);if(!f.isConnected()){f.connect()}return f},getProvider:function(a){return a.isProvider?a:this.providers.get(a)},removeProvider:function(d){var b=this,a=b.providers;d=d.isProvider?d:a.get(d);if(d){d.un("data",b.onProviderData,b);a.remove(d);return d}return null},addTransaction:function(a){this.transactions.add(a);return a},removeTransaction:function(a){a=this.getTransaction(a);this.transactions.remove(a);return a},getTransaction:function(a){return Ext.isObject(a)?a:this.transactions.get(a)},onProviderData:function(g,f){var e=this,b=0,d,a;if(Ext.isArray(f)){for(d=f.length;b<d;++b){e.onProviderData(g,f[b])}return}a=f.getName();if(a&&a!="event"&&a!="exception"){e.fireEvent(a,f)}else{if(f.getStatus()===false){e.fireEvent("exception",f)}}e.fireEvent("event",f,g)},parseMethod:function(b){if(Ext.isString(b)){var f=b.split("."),a=0,d=f.length,e=window;while(e&&a<d){e=e[f[a]];++a}b=Ext.isFunction(e)?e:null}return b||null}});Ext.define("Ext.data.JsonP",{alternateClassName:"Ext.util.JSONP",singleton:true,requestCount:0,requests:{},timeout:30000,disableCaching:true,disableCachingParam:"_dc",callbackKey:"callback",request:function(o){o=Ext.apply({},o);var k=this,e=Ext.isDefined(o.disableCaching)?o.disableCaching:k.disableCaching,h=o.disableCachingParam||k.disableCachingParam,d=++k.requestCount,m=o.callbackName||"callback"+d,j=o.callbackKey||k.callbackKey,n=Ext.isDefined(o.timeout)?o.timeout:k.timeout,f=Ext.apply({},o.params),b=o.url,a=Ext.isSandboxed?Ext.getUniqueGlobalNamespace():"Ext",g,l;f[j]=a+".data.JsonP."+m;if(e){f[h]=new Date().getTime()}l=k.createScript(b,f,o);k.requests[d]=g={url:b,params:f,script:l,id:d,scope:o.scope,success:o.success,failure:o.failure,callback:o.callback,callbackKey:j,callbackName:m};if(n>0){g.timeout=setTimeout(Ext.bind(k.handleTimeout,k,[g]),n)}k.setupErrorHandling(g);k[m]=Ext.bind(k.handleResponse,k,[g],true);k.loadScript(g);return g},abort:function(b){var d=this.requests,a;if(b){if(!b.id){b=d[b]}this.handleAbort(b)}else{for(a in d){if(d.hasOwnProperty(a)){this.abort(d[a])}}}},setupErrorHandling:function(a){a.script.onerror=Ext.bind(this.handleError,this,[a])},handleAbort:function(a){a.errorType="abort";this.handleResponse(null,a)},handleError:function(a){a.errorType="error";this.handleResponse(null,a)},cleanupErrorHandling:function(a){a.script.onerror=null},handleTimeout:function(a){a.errorType="timeout";this.handleResponse(null,a)},handleResponse:function(a,b){var d=true;if(b.timeout){clearTimeout(b.timeout)}delete this[b.callbackName];delete this.requests[b.id];this.cleanupErrorHandling(b);Ext.fly(b.script).destroy();if(b.errorType){d=false;Ext.callback(b.failure,b.scope,[b.errorType,b])}else{Ext.callback(b.success,b.scope,[a,b])}Ext.callback(b.callback,b.scope,[d,a,b.errorType,b])},createScript:function(d,e,b){var a=document.createElement("script");a.setAttribute("src",Ext.urlAppend(d,Ext.Object.toQueryString(e)));a.setAttribute("async",true);a.setAttribute("type","text/javascript");return a},loadScript:function(a){Ext.getHead().appendChild(a.script)}});Ext.define("Ext.data.JsonStore",{extend:Ext.data.Store,alias:"store.json",config:{proxy:{type:"ajax",reader:"json",writer:"json"}}});Ext.define("Ext.data.NodeInterface",{alternateClassName:"Ext.data.Node",statics:{decorate:function(e){if(!e.isNode){var h=Ext.data.ModelManager,d=e.modelName,f=h.getModel(d),b=[],g,j,a;f.override(this.getPrototypeBody());b=this.applyFields(f,[{name:"parentId",type:"string",defaultValue:null},{name:"index",type:"int",defaultValue:0},{name:"depth",type:"int",defaultValue:0,persist:false},{name:"expanded",type:"bool",defaultValue:false,persist:false},{name:"expandable",type:"bool",defaultValue:true,persist:false},{name:"checked",type:"auto",defaultValue:null},{name:"leaf",type:"bool",defaultValue:false,persist:false},{name:"cls",type:"string",defaultValue:null,persist:false},{name:"iconCls",type:"string",defaultValue:null,persist:false},{name:"root",type:"boolean",defaultValue:false,persist:false},{name:"isLast",type:"boolean",defaultValue:false,persist:false},{name:"isFirst",type:"boolean",defaultValue:false,persist:false},{name:"allowDrop",type:"boolean",defaultValue:true,persist:false},{name:"allowDrag",type:"boolean",defaultValue:true,persist:false},{name:"loaded",type:"boolean",defaultValue:false,persist:false},{name:"loading",type:"boolean",defaultValue:false,persist:false},{name:"href",type:"string",defaultValue:null,persist:false},{name:"hrefTarget",type:"string",defaultValue:null,persist:false},{name:"qtip",type:"string",defaultValue:null,persist:false},{name:"qtitle",type:"string",defaultValue:null,persist:false}]);a=b.length;f.getFields().isDirty=true;for(g=0;g<a;++g){j=b[g];if(e.get(j.getName())===undefined){e.data[j.getName()]=j.getDefaultValue()}}}if(!e.isDecorated){e.isDecorated=true;Ext.applyIf(e,{firstChild:null,lastChild:null,parentNode:null,previousSibling:null,nextSibling:null,childNodes:[]});e.enableBubble(["append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert","expand","collapse","beforeexpand","beforecollapse","sort","load"])}return e},applyFields:function(h,j){var b=h.prototype,e=b.fields,k=e.keys,g=j.length,a,d,f=[];for(d=0;d<g;d++){a=j[d];if(!Ext.Array.contains(k,a.name)){a=Ext.create("Ext.data.Field",a);f.push(a);e.add(a)}}return f},getPrototypeBody:function(){return{isNode:true,createNode:function(a){if(Ext.isObject(a)&&!a.isModel){a=Ext.data.ModelManager.create(a,this.modelName)}return Ext.data.NodeInterface.decorate(a)},isLeaf:function(){return this.get("leaf")===true},setFirstChild:function(a){this.firstChild=a},setLastChild:function(a){this.lastChild=a},updateInfo:function(h){var k=this,g=k.parentNode,b=(!g?true:g.firstChild==k),f=(!g?true:g.lastChild==k),e=0,l=k,a=k.childNodes,j=a.length,d;while(l.parentNode){++e;l=l.parentNode}k.beginEdit();k.set({isFirst:b,isLast:f,depth:e,index:g?g.indexOf(k):0,parentId:g?g.getId():null});k.endEdit(h);if(h){k.commit(h)}for(d=0;d<j;d++){a[d].updateInfo(h)}},isLast:function(){return this.get("isLast")},isFirst:function(){return this.get("isFirst")},hasChildNodes:function(){return !this.isLeaf()&&this.childNodes.length>0},isExpandable:function(){var a=this;if(a.get("expandable")){return !(a.isLeaf()||(a.isLoaded()&&!a.hasChildNodes()))}return false},appendChild:function(b,k,j){var g=this,d,f,e,h,a;if(Ext.isArray(b)){for(d=0,f=b.length;d<f;d++){g.appendChild(b[d],k,j)}}else{b=g.createNode(b);if(k!==true&&g.fireEvent("beforeappend",g,b)===false){return false}e=g.childNodes.length;h=b.parentNode;if(h){if(k!==true&&b.fireEvent("beforemove",b,h,g,e)===false){return false}h.removeChild(b,null,false,true)}e=g.childNodes.length;if(e===0){g.setFirstChild(b)}g.childNodes.push(b);b.parentNode=g;b.nextSibling=null;g.setLastChild(b);a=g.childNodes[e-1];if(a){b.previousSibling=a;a.nextSibling=b;a.updateInfo(j)}else{b.previousSibling=null}b.updateInfo(j);if(!g.isLoaded()){g.set("loaded",true)}else{if(g.childNodes.length===1){g.set("loaded",g.isLoaded())}}if(k!==true){g.fireEvent("append",g,b,e);if(h){b.fireEvent("move",b,h,g,e)}}return b}},getBubbleTarget:function(){return this.parentNode},removeChild:function(f,b,d,g){var e=this,a=e.indexOf(f);if(a==-1||(d!==true&&e.fireEvent("beforeremove",e,f)===false)){return false}Ext.Array.erase(e.childNodes,a,1);if(e.firstChild==f){e.setFirstChild(f.nextSibling)}if(e.lastChild==f){e.setLastChild(f.previousSibling)}if(d!==true){e.fireEvent("remove",e,f)}if(f.previousSibling){f.previousSibling.nextSibling=f.nextSibling;f.previousSibling.updateInfo(g)}if(f.nextSibling){f.nextSibling.previousSibling=f.previousSibling;f.nextSibling.updateInfo(g)}if(!e.childNodes.length){e.set("loaded",e.isLoaded())}if(b){f.destroy(true)}else{f.clear()}return f},copy:function(e,d){var g=this,b=g.callOverridden(arguments),a=g.childNodes?g.childNodes.length:0,f;if(d){for(f=0;f<a;f++){b.appendChild(g.childNodes[f].copy(true))}}return b},clear:function(a){var b=this;b.parentNode=b.previousSibling=b.nextSibling=null;if(a){b.firstChild=b.lastChild=null}},destroy:function(a){var d=this,b=d.destroyOptions;if(a===true){d.clear(true);Ext.each(d.childNodes,function(e){e.destroy(true)});d.childNodes=null;delete d.destroyOptions;d.callOverridden([b])}else{d.destroyOptions=a;d.remove(true)}},insertBefore:function(g,a,e){var f=this,b=f.indexOf(a),d=g.parentNode,h=b,j;if(!a){return f.appendChild(g)}if(g==a){return false}g=f.createNode(g);if(e!==true&&f.fireEvent("beforeinsert",f,g,a)===false){return false}if(d==f&&f.indexOf(g)<b){h--}if(d){if(e!==true&&g.fireEvent("beforemove",g,d,f,b,a)===false){return false}d.removeChild(g)}if(h===0){f.setFirstChild(g)}Ext.Array.splice(f.childNodes,h,0,g);g.parentNode=f;g.nextSibling=a;a.previousSibling=g;j=f.childNodes[h-1];if(j){g.previousSibling=j;j.nextSibling=g;j.updateInfo()}else{g.previousSibling=null}g.updateInfo();if(!f.isLoaded()){f.set("loaded",true)}else{if(f.childNodes.length===1){f.set("loaded",f.isLoaded())}}if(e!==true){f.fireEvent("insert",f,g,a);if(d){g.fireEvent("move",g,d,f,h,a)}}return g},insertChild:function(a,d){var b=this.childNodes[a];if(b){return this.insertBefore(d,b)}else{return this.appendChild(d)}},remove:function(b,d){var a=this.parentNode;if(a){a.removeChild(this,b,d,true)}return this},removeAll:function(a,b){var e=this.childNodes,d;while((d=e[0])){this.removeChild(d,a,b)}return this},getChildAt:function(a){return this.childNodes[a]},replaceChild:function(a,e,d){var b=e?e.nextSibling:null;this.removeChild(e,d);this.insertBefore(a,b,d);return e},indexOf:function(a){return Ext.Array.indexOf(this.childNodes,a)},getPath:function(e,d){e=e||this.idProperty;d=d||"/";var b=[this.get(e)],a=this.parentNode;while(a){b.unshift(a.get(e));a=a.parentNode}return d+b.join(d)},getDepth:function(){return this.get("depth")},bubble:function(d,b,a){var e=this;while(e){if(d.apply(b||e,a||[e])===false){break}e=e.parentNode}},cascadeBy:function(e,d,a){if(e.apply(d||this,a||[this])!==false){var g=this.childNodes,f=g.length,b;for(b=0;b<f;b++){g[b].cascadeBy(e,d,a)}}},eachChild:function(e,d,a){var g=this.childNodes,f=g.length,b;for(b=0;b<f;b++){if(e.apply(d||this,a||[g[b]])===false){break}}},findChild:function(b,d,a){return this.findChildBy(function(){return this.get(b)==d},null,a)},findChildBy:function(h,g,b){var f=this.childNodes,a=f.length,e=0,j,d;for(;e<a;e++){j=f[e];if(h.call(g||j,j)===true){return j}else{if(b){d=j.findChildBy(h,g,b);if(d!==null){return d}}}}return null},contains:function(a){return a.isAncestor(this)},isAncestor:function(a){var b=this.parentNode;while(b){if(b==a){return true}b=b.parentNode}return false},sort:function(g,b,a){var e=this.childNodes,f=e.length,d,h;if(f>0){Ext.Array.sort(e,g);for(d=0;d<f;d++){h=e[d];h.previousSibling=e[d-1];h.nextSibling=e[d+1];if(d===0){this.setFirstChild(h)}if(d==f-1){this.setLastChild(h)}h.updateInfo(a);if(b&&!h.isLeaf()){h.sort(g,true,true)}}this.notifyStores("afterEdit",["sorted"],{sorted:"sorted"});if(a!==true){this.fireEvent("sort",this,e)}}},isExpanded:function(){return this.get("expanded")},isLoaded:function(){return this.get("loaded")},isLoading:function(){return this.get("loading")},isRoot:function(){return !this.parentNode},isVisible:function(){var a=this.parentNode;while(a){if(!a.isExpanded()){return false}a=a.parentNode}return true},expand:function(a,e,b){var d=this;if(!d.isLeaf()){if(d.isLoading()){d.on("expand",function(){d.expand(a,e,b)},d,{single:true})}else{if(!d.isExpanded()){d.fireAction("expand",[this],function(){d.set("expanded",true);Ext.callback(e,b||d,[d.childNodes])})}else{Ext.callback(e,b||d,[d.childNodes])}}}else{Ext.callback(e,b||d)}},collapse:function(a,e,b){var d=this;if(!d.isLeaf()&&d.isExpanded()){this.fireAction("collapse",[d],function(){d.set("expanded",false);Ext.callback(e,b||d,[d.childNodes])})}else{Ext.callback(e,b||d,[d.childNodes])}}}}}});Ext.define("Ext.data.NodeStore",{extend:Ext.data.Store,alias:"store.node",config:{node:null,recursive:false,rootVisible:false,sorters:undefined,filters:undefined,folderSort:false},afterEdit:function(a,b){if(b){if(b.indexOf("loaded")!==-1){return this.add(this.retrieveChildNodes(a))}if(b.indexOf("expanded")!==-1){return this.filter()}if(b.indexOf("sorted")!==-1){return this.sort()}}this.callParent(arguments)},onNodeAppend:function(a,b){this.add([b].concat(this.retrieveChildNodes(b)))},onNodeInsert:function(a,b){this.add([b].concat(this.retrieveChildNodes(b)))},onNodeRemove:function(a,b){this.remove([b].concat(this.retrieveChildNodes(b)))},onNodeSort:function(){this.sort()},updateFolderSort:function(a){if(a){this.setGrouper(function(b){if(b.isLeaf()){return 1}return 0})}else{this.setGrouper(null)}},createDataCollection:function(){var a=this.callParent();a.handleSort=Ext.Function.bind(this.handleTreeSort,this,[a],true);a.findInsertionIndex=Ext.Function.bind(this.handleTreeInsertionIndex,this,[a,a.findInsertionIndex],true);return a},handleTreeInsertionIndex:function(a,b,e,d){return d.call(e,a,b,this.treeSortFn)},handleTreeSort:function(a){Ext.Array.sort(a,this.treeSortFn);return a},treeSortFn:function(d,a){if(d.parentNode===a.parentNode){return(d.data.index<a.data.index)?-1:1}var g=0,f=0,e=d,b=a;while(e){g+=(Math.pow(10,(e.data.depth+1)*-4)*(e.data.index+1));e=e.parentNode}while(b){f+=(Math.pow(10,(b.data.depth+1)*-4)*(b.data.index+1));b=b.parentNode}if(g>f){return 1}else{if(g<f){return -1}}return(d.data.index>a.data.index)?1:-1},applyFilters:function(b){var a=this;return function(d){return a.isVisible(d)}},applyProxy:function(a){},applyNode:function(a){if(a){a=Ext.data.NodeInterface.decorate(a)}return a},updateNode:function(a,d){if(d&&!d.isDestroyed){d.un({append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove",load:"onNodeLoad",scope:this});d.unjoin(this)}if(a){a.on({scope:this,append:"onNodeAppend",insert:"onNodeInsert",remove:"onNodeRemove",load:"onNodeLoad"});a.join(this);var b=[];if(a.childNodes.length){b=b.concat(this.retrieveChildNodes(a))}if(this.getRootVisible()){b.push(a)}else{if(a.isLoaded()||a.isLoading()){a.set("expanded",true)}}this.data.clear();this.fireEvent("clear",this);this.suspendEvents();this.add(b);this.resumeEvents();if(b.length===0){this.loaded=a.loaded=true}this.fireEvent("refresh",this,this.data)}},retrieveChildNodes:function(a){var e=this.getNode(),b=this.getRecursive(),d=[],f=a;if(!a.childNodes.length||(!b&&a!==e)){return d}if(!b){return a.childNodes}while(f){if(f._added){delete f._added;if(f===a){break}else{f=f.nextSibling||f.parentNode}}else{if(f!==a){d.push(f)}if(f.firstChild){f._added=true;f=f.firstChild}else{f=f.nextSibling||f.parentNode}}}return d},isVisible:function(b){var a=b.parentNode;if(!this.getRecursive()&&a!==this.getNode()){return false}while(a){if(!a.isExpanded()){return false}if(a===this.getNode()){break}a=a.parentNode}return true}});Ext.define("Ext.data.TreeStore",{extend:Ext.data.NodeStore,alias:"store.tree",config:{root:undefined,clearOnLoad:true,nodeParam:"node",defaultRootId:"root",defaultRootProperty:"children",recursive:true},applyProxy:function(){return Ext.data.Store.prototype.applyProxy.apply(this,arguments)},applyRoot:function(a){var b=this;a=a||{};a=Ext.apply({},a);if(!a.isModel){Ext.applyIf(a,{id:b.getStoreId()+"-"+b.getDefaultRootId(),text:"Root",allowDrag:false});a=Ext.data.ModelManager.create(a,b.getModel())}Ext.data.NodeInterface.decorate(a);a.set(a.raw);return a},handleTreeInsertionIndex:function(a,b,e,d){if(b.parentNode){b.parentNode.sort(e.getSortFn(),true,true)}return this.callParent(arguments)},handleTreeSort:function(a,b){if(this._sorting){return a}this._sorting=true;this.getNode().sort(b.getSortFn(),true,true);delete this._sorting;return this.callParent(arguments)},updateRoot:function(a,b){if(b){b.unBefore({expand:"onNodeBeforeExpand",scope:this});b.unjoin(this)}a.onBefore({expand:"onNodeBeforeExpand",scope:this});this.onNodeAppend(null,a);this.setNode(a);if(!a.isLoaded()&&!a.isLoading()&&a.isExpanded()){this.load({node:a})}this.fireEvent("rootchange",this,a,b)},getNodeById:function(a){return this.data.getByKey(a)},getById:function(a){return this.data.getByKey(a)},onNodeBeforeExpand:function(b,a,d){if(b.isLoading()){d.pause();this.on("load",function(){d.resume()},this,{single:true})}else{if(!b.isLoaded()){d.pause();this.load({node:b,callback:function(){d.resume()}})}}},onNodeAppend:function(o,d){var m=this.getProxy(),k=m.getReader(),b=this.getModel(),h=d.raw,e=[],a=k.getRootProperty(),n,j,g,l,f;if(!d.isLeaf()){n=k.getRoot(h);if(n){j=k.extractData(n);for(g=0,l=j.length;g<l;g++){f=j[g];e.push(new b(f.data,f.id,f.node))}if(e.length){this.fillNode(d,e)}else{d.set("loaded",true)}delete h[a]}}},updateAutoLoad:function(b){if(b){var a=this.getRoot();if(!a.isLoaded()&&!a.isLoading()){this.load({node:a})}}},load:function(a){a=a||{};a.params=a.params||{};var d=this,b=a.node=a.node||d.getRoot();a.params[d.getNodeParam()]=b.getId();if(d.getClearOnLoad()){b.removeAll(true)}b.set("loading",true);return d.callParent([a])},updateProxy:function(b){this.callParent(arguments);var a=b.getReader();if(!a.getRootProperty()){a.setRootProperty(this.getDefaultRootProperty());a.buildExtractors()}},removeAll:function(){this.getRoot().removeAll(true);this.callParent(arguments)},onProxyLoad:function(b){var e=this,a=b.getRecords(),f=b.wasSuccessful(),d=b.getNode();d.beginEdit();d.set("loading",false);if(f){a=e.fillNode(d,a)}d.endEdit();e.loading=false;e.loaded=true;d.fireEvent("load",d,a,f);e.fireEvent("load",this,a,f,b);Ext.callback(b.getCallback(),b.getScope()||e,[a,b,f])},fillNode:function(e,a){var d=a?a.length:0,b,f;for(b=0;b<d;b++){f=e.appendChild(a[b],true,true);this.onNodeAppend(e,f)}e.set("loaded",true);return a}});Ext.define("Ext.data.identifier.Uuid",{extend:Ext.data.identifier.Simple,alias:"data.identifier.uuid",isUnique:true,config:{id:undefined,salt:null,timestamp:null,version:4},applyId:function(a){if(a===undefined){return Ext.data.identifier.Uuid.Global}return a},constructor:function(){var a=this;a.callParent(arguments);a.parts=[];a.init()},reconfigure:function(a){this.setConfig(a);this.init()},generate:function(){var d=this,f=d.parts,a=d.getVersion(),b=d.getSalt(),e=d.getTimestamp();f[0]=d.toHex(e.lo,8);f[1]=d.toHex(e.hi&65535,4);f[2]=d.toHex(((e.hi>>>16)&4095)|(a<<12),4);f[3]=d.toHex(128|((d.clockSeq>>>8)&63),2)+d.toHex(d.clockSeq&255,2);f[4]=d.toHex(b.hi,4)+d.toHex(b.lo,8);if(a==4){d.init()}else{++e.lo;if(e.lo>=d.twoPow32){e.lo=0;++e.hi}}return f.join("-").toLowerCase()},init:function(){var b=this,a=b.getSalt(),d=b.getTimestamp();if(b.getVersion()==4){b.clockSeq=b.rand(0,b.twoPow14-1);if(!a){a={};b.setSalt(a)}if(!d){d={};b.setTimestamp(d)}a.lo=b.rand(0,b.twoPow32-1);a.hi=b.rand(0,b.twoPow16-1);d.lo=b.rand(0,b.twoPow32-1);d.hi=b.rand(0,b.twoPow28-1)}else{b.setSalt(b.split(b.getSalt()));b.setTimestamp(b.split(b.getTimestamp()));b.getSalt().hi|=256}},twoPow14:Math.pow(2,14),twoPow16:Math.pow(2,16),twoPow28:Math.pow(2,28),twoPow32:Math.pow(2,32),toHex:function(d,b){var a=d.toString(16);if(a.length>b){a=a.substring(a.length-b)}else{if(a.length<b){a=Ext.String.leftPad(a,b,"0")}}return a},rand:function(a,d){var b=Math.random()*(d-a+1);return Math.floor(b)+a},split:function(b){if(typeof(b)=="number"){var a=Math.floor(b/this.twoPow32);return{lo:Math.floor(b-a*this.twoPow32),hi:a}}return b}},function(){this.Global=new this({id:"uuid"})});Ext.define("Ext.data.proxy.JsonP",{extend:Ext.data.proxy.Server,alternateClassName:"Ext.data.ScriptTagProxy",alias:["proxy.jsonp","proxy.scripttag"],config:{defaultWriterType:"base",callbackKey:"callback",recordParam:"records",autoAppendParams:true},doRequest:function(a,g,b){var e=this,d=e.buildRequest(a),f=d.getParams();d.setConfig({callbackKey:e.getCallbackKey(),timeout:e.getTimeout(),scope:e,callback:e.createRequestCallback(d,a,g,b)});if(e.getAutoAppendParams()){d.setParams({})}d.setJsonP(Ext.data.JsonP.request(d.getCurrentConfig()));d.setParams(f);a.setStarted();e.lastRequest=d;return d},createRequestCallback:function(e,a,f,b){var d=this;return function(j,g,h){delete d.lastRequest;d.processResponse(j,a,e,g,f,b)}},setException:function(b,a){b.setException(b.getRequest().getJsonP().errorType)},buildUrl:function(g){var f=this,a=f.callParent(arguments),j=Ext.apply({},g.getParams()),e=j.filters,d,b,h;delete j.filters;if(f.getAutoAppendParams()){a=Ext.urlAppend(a,Ext.Object.toQueryString(j))}if(e&&e.length){for(b=0;b<e.length;b++){d=e[b];h=d.getValue();if(h){a=Ext.urlAppend(a,d.getProperty()+"="+h)}}}return a},destroy:function(){this.abort();this.callParent(arguments)},abort:function(){var a=this.lastRequest;if(a){Ext.data.JsonP.abort(a.getJsonP())}}});Ext.define("Ext.data.proxy.WebStorage",{extend:Ext.data.proxy.Client,alternateClassName:"Ext.data.WebStorageProxy",config:{id:undefined,reader:null,writer:null,enablePagingParams:false,defaultDateFormat:"Y-m-d H:i:s.u"},constructor:function(a){this.callParent(arguments);this.cache={}},updateModel:function(a){if(!this.getId()){this.setId(a.modelName)}this.callParent(arguments)},create:function(f,j,k){var e=f.getRecords(),d=e.length,a=this.getIds(),b,h,g;f.setStarted();for(g=0;g<d;g++){h=e[g];b=h.getId();this.setRecord(h);a.push(b)}this.setIds(a);f.setCompleted();f.setSuccessful();if(typeof j=="function"){j.call(k||this,f)}},read:function(j,p,q){var f=[],a=this.getIds(),m=this.getModel(),r=m.getIdProperty(),h=j.getParams()||{},o=j.getSorters(),e=j.getFilters(),b=j.getStart(),g=j.getLimit(),d=a.length,k,l,n;if(h[r]!==undefined){l=this.getRecord(h[r]);if(l){f.push(l);j.setSuccessful()}}else{for(k=0;k<d;k++){l=this.getRecord(a[k]);if(l){f.push(l)}}n=Ext.create("Ext.util.Collection");if(e&&e.length){n.setFilters(e)}if(o&&o.length){n.setSorters(o)}n.addAll(f);if(this.getEnablePagingParams()&&b!==undefined&&g!==undefined){f=n.items.slice(b,b+g)}else{f=n.items.slice()}j.setSuccessful()}j.setCompleted();j.setResultSet(Ext.create("Ext.data.ResultSet",{records:f,total:f.length,loaded:true}));j.setRecords(f);if(typeof p=="function"){p.call(q||this,j)}},update:function(f,j,k){var e=f.getRecords(),d=e.length,a=this.getIds(),h,b,g;f.setStarted();for(g=0;g<d;g++){h=e[g];this.setRecord(h);b=h.getId();if(b!==undefined&&Ext.Array.indexOf(a,b)==-1){a.push(b)}}this.setIds(a);f.setCompleted();f.setSuccessful();if(typeof j=="function"){j.call(k||this,f)}},destroy:function(b,j,f){var a=b.getRecords(),g=a.length,e=this.getIds(),h=[].concat(e),d;b.setStarted();for(d=0;d<g;d++){Ext.Array.remove(h,a[d].getId());this.removeRecord(a[d],false)}this.setIds(h);b.setCompleted();b.setSuccessful();if(typeof j=="function"){j.call(f||this,b)}},getRecord:function(d){if(this.cache[d]===undefined){var n=this.getRecordKey(d),o=this.getStorageObject().getItem(n),h={},f=this.getModel(),l=f.getFields().items,e=l.length,j,m,b,k,a,g;if(!o){return undefined}a=Ext.decode(o);for(j=0;j<e;j++){m=l[j];b=m.getName();g=a[b];if(typeof m.getDecode()=="function"){h[b]=m.getDecode()(g)}else{if(m.getType().type=="date"){h[b]=this.readDate(m,g)}else{h[b]=g}}}k=new f(h,d);this.cache[d]=k}return this.cache[d]},setRecord:function(m,d){if(d){m.setId(d)}else{d=m.getId()}var p=this,a=m.getData(),l={},g=p.getModel(),n=g.getFields().items,f=n.length,k=0,h,q,b,j,r;for(;k<f;k++){q=n[k];b=q.getName();h=a[b];if(q.getPersist()===false){continue}if(typeof q.getEncode()=="function"){l[b]=q.getEncode()(h,m)}else{if(q.getType().type=="date"&&Ext.isDate(h)){l[b]=this.writeDate(q,h)}else{l[b]=h}}}j=p.getStorageObject();r=p.getRecordKey(d);p.cache[d]=m;j.removeItem(r);try{j.setItem(r,Ext.encode(l))}catch(o){this.fireEvent("exception",this,o)}m.commit()},removeRecord:function(e,d){var b=this,a;if(e.isModel){e=e.getId()}if(d!==false){a=b.getIds();Ext.Array.remove(a,e);b.setIds(a)}delete this.cache[e];b.getStorageObject().removeItem(b.getRecordKey(e))},getRecordKey:function(a){if(a.isModel){a=a.getId()}return Ext.String.format("{0}-{1}",this.getId(),a)},getIds:function(){var b=(this.getStorageObject().getItem(this.getId())||"").split(","),d=b.length,a;if(d==1&&b[0]===""){b=[]}return b},setIds:function(a){var d=this.getStorageObject(),f=a.join(","),g=this.getId();d.removeItem(g);if(!Ext.isEmpty(f)){try{d.setItem(g,f)}catch(b){this.fireEvent("exception",this,b)}}},writeDate:function(d,b){if(Ext.isEmpty(b)){return null}var a=d.getDateFormat()||this.getDefaultDateFormat();switch(a){case"timestamp":return b.getTime()/1000;case"time":return b.getTime();default:return Ext.Date.format(b,a)}},readDate:function(d,b){if(Ext.isEmpty(b)){return null}var a=d.getDateFormat()||this.getDefaultDateFormat();switch(a){case"timestamp":return new Date(b*1000);case"time":return new Date(b);default:return Ext.isDate(b)?b:Ext.Date.parse(b,a)}},initialize:function(){this.callParent(arguments);var a=this.getStorageObject();try{a.setItem(this.getId(),a.getItem(this.getId())||"")}catch(b){this.fireEvent("exception",this,b)}},clear:function(){var e=this.getStorageObject(),d=this.getIds(),a=d.length,b;for(b=0;b<a;b++){this.removeRecord(d[b],false)}e.removeItem(this.getId())},getStorageObject:function(){}});Ext.define("Ext.data.proxy.LocalStorage",{extend:Ext.data.proxy.WebStorage,alias:"proxy.localstorage",alternateClassName:"Ext.data.LocalStorageProxy",getStorageObject:function(){return window.localStorage}});Ext.define("Ext.data.reader.JsonHtmlDecode",{extend:Ext.data.reader.Reader,alternateClassName:"Ext.data.JsonHtmlDecodeReader",alias:"reader.jsonHtmlDecode",config:{record:null,useSimpleAccessors:false},objectRe:/[\[\.]/,getResponseData:function(a){var e=a;if(a&&a.responseText){e=a.responseText}if(typeof e!=="string"){return e}var d;try{e=Ext.util.Format.htmlDecode(e);d=Ext.decode(e)}catch(b){this.fireEvent("exception",this,a,"Unable to parse the JSON returned by the server: "+b.toString());Ext.Logger.warn("Unable to parse the JSON returned by the server: "+b.toString())}return d},buildExtractors:function(){var b=this,a=b.getRootProperty();b.callParent(arguments);if(a){b.rootAccessor=b.createAccessor(a)}else{delete b.rootAccessor}},getRoot:function(b){var a=this.getModel().getFields();if(a.isDirty){this.buildExtractors(true);delete a.isDirty}if(this.rootAccessor){return this.rootAccessor.call(this,b)}else{return b}},extractData:function(a){var f=this.getRecord(),e=[],d,b;if(f){d=a.length;if(!d&&Ext.isObject(a)){d=1;a=[a]}for(b=0;b<d;b++){e[b]=a[b][f]}}else{e=a}return this.callParent([e])},createAccessor:function(){var a=/[\[\.]/;return function(d){if(Ext.isEmpty(d)){return Ext.emptyFn}if(Ext.isFunction(d)){return d}if(this.getUseSimpleAccessors()!==true){var b=String(d).search(a);if(b>=0){return Ext.functionFactory("obj","var value; try {value = obj"+(b>0?".":"")+d+"} catch(e) {}; return value;")}}return function(e){return e[d]}}}(),createFieldAccessExpression:function(h,b,d){var g=this,j=g.objectRe,f=(h.getMapping()!==null),a=f?h.getMapping():h.getName(),k,e;if(typeof a==="function"){k=b+".getMapping()("+d+", this)"}else{if(g.getUseSimpleAccessors()===true||((e=String(a).search(j))<0)){if(!f||isNaN(a)){a='"'+a+'"'}k=d+"["+a+"]"}else{k=d+(e>0?".":"")+a}}return k}});Ext.define("Ext.dataview.IndexBar",{extend:Ext.Component,alternateClassName:"Ext.IndexBar",config:{baseCls:Ext.baseCSSPrefix+"indexbar",direction:"vertical",letters:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],ui:"alphabet",listPrefix:null},itemCls:Ext.baseCSSPrefix+"",updateDirection:function(a,d){var b=this.getBaseCls();this.element.replaceCls(b+"-"+d,b+"-"+a)},getElementConfig:function(){return{reference:"wrapper",classList:["x-centered","x-indexbar-wrapper"],children:[this.callParent()]}},updateLetters:function(d){this.innerElement.setHtml("");if(d){var b=d.length,a;for(a=0;a<b;a++){this.innerElement.createChild({html:d[a]})}}},updateListPrefix:function(a){if(a&&a.length){this.innerElement.createChild({html:a},0)}},initialize:function(){this.callParent();this.innerElement.on({touchstart:this.onTouchStart,dragend:this.onDragEnd,drag:this.onDrag,scope:this})},onTouchStart:function(a){a.stopPropagation();this.innerElement.addCls(this.getBaseCls()+"-pressed");this.pageBox=this.innerElement.getPageBox();this.onDrag(a)},onDragEnd:function(){this.innerElement.removeCls(this.getBaseCls()+"-pressed")},onDrag:function(d){var a=Ext.util.Point.fromEvent(d),b,f=this.pageBox;if(!f){f=this.pageBox=this.el.getPageBox()}if(this.getDirection()==="vertical"){if(a.y>f.bottom||a.y<f.top){return}b=Ext.Element.fromPoint(f.left+(f.width/2),a.y)}else{if(a.x>f.right||a.x<f.left){return}b=Ext.Element.fromPoint(a.x,f.top+(f.height/2))}if(b){this.fireEvent("index",this,b.dom.innerHTML,b)}},destroy:function(){var d=this,e=Array.prototype.slice.call(d.innerElement.dom.childNodes),b=e.length,a=0;for(;a<b;a++){Ext.removeNode(e[a])}this.callParent()}},function(){});Ext.define("Ext.dataview.ListItemHeader",{extend:Ext.Component,xtype:"listitemheader",config:{baseCls:Ext.baseCSSPrefix+"list-header"}});Ext.define("Ext.dataview.component.ListItem",{extend:Ext.dataview.component.DataItem,xtype:"listitem",config:{baseCls:Ext.baseCSSPrefix+"list-item",dataMap:null,body:{xtype:"component",cls:"x-list-item-body"},disclosure:{xtype:"component",cls:"x-list-disclosure",hidden:true,docked:"right"},header:{xtype:"component",cls:"x-list-header",html:" "},tpl:null,items:null},applyBody:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getBody())}return a},updateBody:function(a,b){if(a){this.add(a)}else{if(b){b.destroy()}}},applyHeader:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getHeader())}return a},updateHeader:function(b,a){if(a){a.destroy()}},applyDisclosure:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getDisclosure())}return a},updateDisclosure:function(b,a){if(b){this.add(b)}else{if(a){a.destroy()}}},updateTpl:function(a){this.getBody().setTpl(a)},updateRecord:function(e){var g=this,d=g.dataview||this.getDataview(),h=e&&d.prepareData(e.getData(true),d.getStore().indexOf(e),e),f=g.getDataMap(),b=this.getBody(),j=this.getDisclosure();g._record=e;if(f){g.doMapData(f,h,b)}else{if(b){b.updateData(h||null)}}if(j&&e&&d.getOnItemDisclosure()){var a=d.getDisclosureProperty();j[(h.hasOwnProperty(a)&&h[a]===false)?"hide":"show"]()}g.fireEvent("updatedata",g,h)},destroy:function(){Ext.destroy(this.getHeader());this.callParent(arguments)}});Ext.define("Ext.dataview.component.SimpleListItem",{extend:Ext.Component,xtype:"simplelistitem",config:{baseCls:Ext.baseCSSPrefix+"list-item",disclosure:{xtype:"component",cls:"x-list-disclosure",hidden:true},header:{xtype:"component",cls:"x-list-header",html:" "},dataview:null,record:null},initialize:function(){this.element.addCls(this.getBaseCls()+"-tpl")},applyHeader:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getHeader())}return a},updateHeader:function(b,a){if(a){a.destroy()}},applyDisclosure:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Component,this.getDisclosure())}return a},updateDisclosure:function(b,a){if(b){this.element.appendChild(b.renderElement)}else{if(a){a.destroy()}}},updateRecord:function(d){var e=this,b=e.dataview||this.getDataview(),f=d&&b.prepareData(d.getData(true),b.getStore().indexOf(d),d),g=this.getDisclosure();e.updateData(f||null);if(g&&d&&b.getOnItemDisclosure()){var a=b.getDisclosureProperty();g[(f.hasOwnProperty(a)&&f[a]===false)?"hide":"show"]()}},destroy:function(){Ext.destroy(this.getHeader(),this.getDisclosure());this.callParent(arguments)}});Ext.define("Ext.util.PositionMap",{config:{minimumHeight:50},constructor:function(a){this.map=[];this.adjustments={};this.offset=0;this.initConfig(a)},populate:function(e,h){var g=this.map=this.map||[],a=this.getMinimumHeight(),b,f,d;h=h||0;e++;g.length=e;g[0]=0;for(b=h+1,d=e-1;b<=d;b++){f=b-1;g[b]=g[f]+a}this.adjustments={indices:[],heights:{}};this.offset=0;for(b=1,d=e-1;b<=d;b++){f=b-1;this.offset+=g[b]-g[f]-a}},setItemHeight:function(b,a){a=Math.max(a,this.getMinimumHeight());if(a!==this.getItemHeight(b)){var d=this.adjustments;d.indices.push(parseInt(b,10));d.heights[b]=a}},update:function(){var e=this.adjustments,o=e.indices,m=e.heights,a=this.map,l=o.length,p=this.getMinimumHeight(),d=0,g,f,n,k,h,b;if(!e.indices.length){return false}Ext.Array.sort(o,function(q,j){return q-j});for(g=0;g<l;g++){k=o[g];h=o[g+1]||a.length-1;b=(a[k+1]!==undefined)?(a[k+1]-a[k]+d):p;n=m[k];d+=n-b;for(f=k+1;f<=h;f++){a[f]+=d}}this.offset+=d;this.adjustments={indices:[],heights:{}};return true},getItemHeight:function(a){return this.map[a+1]-this.map[a]},getTotalHeight:function(){return((this.map.length-1)*this.getMinimumHeight())+this.offset},findIndex:function(a){return this.map.length?this.binarySearch(this.map,a):0},binarySearch:function(b,e){var g=0,a=b.length;if(e<b[0]){return 0}if(e>b[a-1]){return a-1}while(g+1<a){var d=(g+a)>>1,f=b[d];if(f==e){return d}else{if(f<e){g=d}else{a=d}}}return g}});Ext.define("Ext.dataview.List",{alternateClassName:"Ext.List",extend:Ext.dataview.DataView,xtype:"list",mixins:[Ext.mixin.Bindable],config:{layout:"fit",indexBar:false,icon:null,preventSelectionOnDisclose:true,baseCls:Ext.baseCSSPrefix+"list",pinHeaders:true,grouped:null,onItemDisclosure:null,disclosureProperty:"disclosure",ui:"normal",defaultType:undefined,itemMap:{},itemHeight:42,variableHeights:false,refreshHeightOnUpdate:true,infinite:false,useSimpleItems:true,scrollable:null,bufferSize:20,minimumBufferDistance:5,useHeaders:true,striped:false},platformConfig:[{theme:["Windows"],itemHeight:44},{theme:["Cupertino"],itemHeight:43}],topRenderedIndex:0,topVisibleIndex:0,visibleCount:0,constructor:function(){var b=this,a;b.callParent(arguments)},beforeInitialize:function(){var e=this,b=e.container,f,d,a;Ext.apply(e,{listItems:[],headerItems:[],updatedItems:[],headerMap:[],scrollDockItems:{top:[],bottom:[]}});this.translationMethod=Ext.browser.is.AndroidStock2?"cssposition":"csstransform";if(!b){b=e.container=Ext.factory({xtype:"container",scrollable:{scroller:{autoRefresh:!e.getInfinite(),direction:"vertical"}}})}e.add(b);f=b.getScrollable();d=e.scrollViewElement=f.getElement();e.scrollElement=f.getScroller().getElement();e.setScrollable(f);e.scrollableBehavior=b.getScrollableBehavior();a=e.pinnedHeader=Ext.factory({xtype:"listitemheader",html:"&nbsp;",translatable:{translationMethod:this.translationMethod},cls:["x-list-header","x-list-header-swap"]});a.translate(0,-10000);a.$position=-10000;d.insertFirst(a.renderElement);e.bind(f.getScroller().getTranslatable(),"doTranslate","onTranslate")},initialize:function(){var e=this,a=e.container,d=e.scrollViewElement,b=e.getIndexBar(),g=e.getTriggerEvent(),f=e.getTriggerCtEvent();if(b){d.appendChild(b.renderElement)}if(g){e.on(g,e.onItemTrigger,e)}if(f){e.on(f,e.onContainerTrigger,e)}a.element.on({delegate:"."+e.getBaseCls()+"-disclosure",tap:"handleItemDisclosure",scope:e});a.element.on({resize:"onContainerResize",scope:e});a.innerElement.on({touchstart:"onItemTouchStart",touchend:"onItemTouchEnd",tap:"onItemTap",taphold:"onItemTapHold",singletap:"onItemSingleTap",doubletap:"onItemDoubleTap",swipe:"onItemSwipe",delegate:"."+Ext.baseCSSPrefix+"list-item",scope:e});if(e.getStore()){e.refresh()}},onTranslate:function(b,j){var g=this,a=g.pinnedHeader,d=g.getStore(),h=d&&d.getCount(),e=g.getGrouped(),f=g.getInfinite();if(!h){g.showEmptyText();g.showEmptyScrollDock();a.$position=-10000;a.translate(0,-10000)}else{if(f&&g.itemsCount){g.handleItemUpdates(j);g.handleItemHeights();g.handleItemTransforms();if(!g.onIdleBound){Ext.AnimationQueue.onIdle(g.onAnimationIdle,g);g.onIdleBound=true}}}if(e&&g.groups&&g.groups.length&&g.getPinHeaders()){g.handlePinnedHeader(j)}this.onScrollBinder(b,j)},onScrollBinder:function(){},handleItemUpdates:function(p){var o=this,e=o.listItems,s=e.length,d=o.getListItemInfo(),f=o.getItemMap(),b=o.getBufferSize(),l=o.getStore().getCount()-1,q=o.getMinimumBufferDistance(),g=o.topVisibleIndex,k=o.topRenderedIndex,j,h,r,n,m,a;o.topVisibleIndex=n=Math.max(0,f.findIndex(-p)||0);if(g!==n){if(g>n){m=n-k;if(m<q){j=Math.min(s,q-m);if(j==s){o.topRenderedIndex=k=Math.max(0,n-(b-q));for(h=0;h<j;h++){a=k+h;r=e[h];o.updateListItem(r,a,d)}}else{for(h=0;h<j;h++){a=k-h-1;if(a<0){break}r=e.pop();e.unshift(r);o.updateListItem(r,a,d);o.topRenderedIndex--}}}}else{m=b-(n-k);if(m<q){j=Math.min(s,q-m);if(j==s){o.topRenderedIndex=k=Math.min(l-s,n-q);for(h=0;h<j;h++){a=k+h;r=e[h];o.updateListItem(r,a,d)}}else{for(h=0;h<j;h++){a=k+s+h;if(a>l){break}r=e.shift();e.push(r);o.updateListItem(r,a,d);o.topRenderedIndex++}}}}}},onAnimationIdle:function(){var n=this,e=n.getListItemInfo(),d=n.getBufferSize(),l=n.topVisibleIndex,j=n.topRenderedIndex,k=n.getStore().getCount()-1,g=n.listItems,p=g.length,b,f,h,m,o,a;b=l-j;f=j+d-l;if(b<f){if(l>0){m=f-b;for(h=0;h<m;h++){a=j-h-1;if(a<0){break}o=g.pop();g.unshift(o);n.updateListItem(o,a,e);n.topRenderedIndex--}}}else{m=b-f;for(h=0;h<m;h++){a=j+p+h;if(a>k){break}o=g.shift();g.push(o);n.updateListItem(o,a,e);n.topRenderedIndex++}}n.handleItemHeights();n.handleItemTransforms();n.onIdleBound=false},handleItemHeights:function(){var o=this,f=o.updatedItems,l=f.length,g=o.getItemMap(),b=o.getUseSimpleItems(),s=g.getMinimumHeight(),r=o.headerIndices,m=o.headerMap,d=o.getVariableHeights(),a,k,h,n,q,p,e;for(k=0;k<l;k++){q=f[k];a=q.$dataIndex;if(a!==null){if(d){p=b?q.element.getHeight():q.element.getFirstChild().getHeight();p=Math.max(p,s)}else{p=s}q.$ownItemHeight=p;n=o.scrollDockItems.top.length;if(q.isFirst){o.totalScrollDockTopHeight=0;for(h=0;h<n;h++){e=o.scrollDockItems.top[h].$scrollDockHeight;p+=e;o.totalScrollDockTopHeight+=e}}n=o.scrollDockItems.bottom.length;if(q.isLast){for(h=0;h<n;h++){e=o.scrollDockItems.bottom[h].$scrollDockHeight;p+=e}}if(r&&r[a]){p+=o.headerHeight}g.setItemHeight(a,p);q.$height=p}}g.update();p=g.getTotalHeight();m.length=0;for(k in r){if(r.hasOwnProperty(k)){m.push(g.map[k])}}o.setScrollerHeight(p);o.updatedItems.length=0},setScrollerHeight:function(d){var e=this,b=e.container.getScrollable().getScroller(),a=b.getTranslatable();if(d!=b.givenSize){b.setSize(d);b.refreshMaxPosition();b.fireEvent("refresh",b);if(a.isAnimating&&a.activeEasingY&&a.activeEasingY.setMinMomentumValue){a.activeEasingY.setMinMomentumValue(-b.getMaxPosition().y)}}},handleItemTransforms:function(){var k=this,a=k.listItems,n=a.length,b=k.getItemMap(),l=k.scrollDockItems,g=k.getGrouped(),m,e,f,h,d;for(f=0;f<n;f++){m=a[f];e=b.map[m.$dataIndex];if(!m.$hidden&&m.$position!==e){m.$position=e;h=l.top.length;if(m.isFirst&&h){for(d=0;d<h;d++){l.top[d].translate(0,e);e+=l.top[d].$scrollDockHeight}}if(g&&k.getUseHeaders()&&k.headerIndices&&k.headerIndices[m.$dataIndex]){m.getHeader().translate(0,e);e+=k.headerHeight}m.translate(0,e);e+=m.$ownItemHeight;h=l.bottom.length;if(m.isLast&&h){for(d=0;d<h;d++){l.bottom[d].translate(0,e);e+=l.bottom[d].$scrollDockHeight}}}}},handlePinnedHeader:function(o){var n=this,d=n.pinnedHeader,g=n.getItemMap(),f=n.groups,m=n.headerMap,j=n.headerHeight,p=n.getStore(),e=n.totalScrollDockTopHeight,k,b,l,h,a;b=g.binarySearch(m,-o);k=f[b].children[0];if(k){l=o+m[b+1]-j;if(o>=0||(b===0&&e+o>=0)||(b===0&&-o<=m[b])){h=-10000}else{if(l<0){h=l}else{h=Math.max(0,o)}}a=p.getGroupString(k);if(d.$currentHeader!=a){d.setHtml(a);d.$currentHeader=a}if(d.$position!=h){d.translate(0,h);d.$position=h}}},createItem:function(d){var k=this,a=k.container,e=k.listItems,h=k.getInfinite(),j=k.scrollElement,g=k.getUseHeaders(),l,f,b;l=Ext.factory(d);l.dataview=k;l.$height=d.minHeight;if(!h){b=k.getBaseCls()+"-item-relative";l.addCls(b)}if(g){f=l.getHeader();if(!h){f.addCls(b)}else{f.setTranslatable({translationMethod:this.translationMethod});f.translate(0,-10000);j.insertFirst(f.renderElement)}}a.doAdd(l);e.push(l);return l},setItemsCount:function(a){var e=this,f=e.listItems,b=e.getListItemConfig(),g=a-f.length,d;for(d=0;d<g;d++){e.createItem(b)}for(d=g;d<0;d++){f.pop().destroy()}e.itemsCount=a;e.updateAllListItems();if(Ext.browser.is.AndroidStock&&e.container.element&&a===0&&g!==0){e.container.element.redraw()}return e.listItems},updateUi:function(a,b){if(a&&a!=b&&a=="round"){this.setPinHeaders(false)}this.callParent(arguments)},updateListItem:function(v,f,u){var y=this,a=u.store.getAt(f),q=y.headerIndices,b=y.footerIndices,e=y.getUseHeaders(),p=e&&v.getHeader(),r=y.scrollDockItems,k=y.updatedItems,j=v.renderElement.classList.slice(),m=e&&p.renderElement.classList.slice(),g=y.getInfinite(),s=u.store.getCount(),x=[],l=[],o=[u.headerCls,u.footerCls,u.firstCls,u.lastCls,u.selectedCls,u.stripeCls],z=[u.headerCls,u.footerCls,u.firstCls,u.lastCls],h,n,d,w;if(g){v.$position=-10000}if(!a){v.setRecord(null);if(g){v.translate(0,-10000)}else{v.hide()}if(e){if(g){p.translate(0,-10000)}else{p.hide()}}v.$hidden=true;return}else{if(v.$hidden){if(!g){v.show()}v.$hidden=false}}if(g){k.push(v)}if(v.isFirst&&f!==0&&r.top.length){for(n=0,h=r.top.length;n<h;n++){d=r.top[n];if(g){d.translate(0,-10000)}}v.isFirst=false}if(v.isLast&&f!==s-1&&r.bottom.length){for(n=0,h=r.bottom.length;n<h;n++){d=r.bottom[n];if(g){d.translate(0,-10000)}}v.isLast=false}if(v.$dataIndex!==f){v.$dataIndex=f;y.fireEvent("itemindexchange",y,a,f,v)}if(v.getRecord()===a){v.updateRecord(a)}else{v.setRecord(a)}if(y.isSelected(a)){x.push(u.selectedCls)}if(u.grouped&&e){if(q[f]){x.push(u.headerCls);l.push(u.headerCls);p.setHtml(u.store.getGroupString(a));if(!g){p.renderElement.insertBefore(v.renderElement)}p.show()}else{if(g){p.translate(0,-10000)}else{p.hide()}}if(b[f]){x.push(u.footerCls);l.push(u.footerCls)}}if(!u.grouped&&e){p.hide()}if(f===0){v.isFirst=true;x.push(u.firstCls);l.push(u.firstCls);if(!u.grouped){x.push(u.headerCls);l.push(u.headerCls)}if(!g){for(n=0,h=r.top.length;n<h;n++){d=r.top[n];if(u.grouped){d.renderElement.insertBefore(p.renderElement)}else{d.renderElement.insertBefore(v.renderElement)}}}}if(f===s-1){v.isLast=true;x.push(u.lastCls);l.push(u.lastCls);if(!u.grouped){x.push(u.footerCls);l.push(u.footerCls)}if(!g){for(n=0,h=r.bottom.length;n<h;n++){d=r.bottom[n];d.renderElement.insertAfter(v.renderElement)}}}if(u.striped&&f%2==1){x.push(u.stripeCls)}if(j){for(n=0;n<o.length;n++){Ext.Array.remove(j,o[n])}x=Ext.Array.merge(x,j)}if(e&&m){for(n=0;n<z.length;n++){Ext.Array.remove(m,z[n])}l=Ext.Array.merge(l,m)}w=x.join(" ");if(v.classCache!==w){v.renderElement.setCls(x);v.classCache=w}if(e){p.renderElement.setCls(l)}},updateAllListItems:function(){var f=this,b=f.getStore(),a=f.listItems,h=f.getListItemInfo(),g=f.topRenderedIndex,d,e;if(b){for(d=0,e=a.length;d<e;d++){f.updateListItem(a[d],g+d,h)}}if(f.isPainted()){if(f.getInfinite()&&b&&b.getCount()){f.handleItemHeights()}f.refreshScroller()}},doRefresh:function(){var d=this,b=d.getInfinite(),a=d.container.getScrollable().getScroller(),e=d.getStore().getCount();if(b){d.getItemMap().populate(e,this.topRenderedIndex)}if(d.getGrouped()){d.refreshHeaderIndices()}if(e){d.hideScrollDockItems();d.hideEmptyText();if(!b){d.setItemsCount(e);if(d.getScrollToTopOnRefresh()){a.scrollTo(0,0)}}else{if(d.getScrollToTopOnRefresh()){d.topRenderedIndex=0;d.topVisibleIndex=0;a.position.y=0}d.updateAllListItems()}}else{d.onStoreClear()}},onContainerResize:function(a,b){var d=this,e=d.visibleCount;if(!d.headerHeight){d.headerHeight=parseInt(d.pinnedHeader.renderElement.getHeight(),10)}if(d.getInfinite()){d.visibleCount=Math.ceil(b.height/d.getItemMap().getMinimumHeight());if(d.visibleCount!=e){d.setItemsCount(d.visibleCount+d.getBufferSize());d.fireEvent("updatevisiblecount",this,d.visibleCount,e)}}else{if(d.listItems.length&&d.getUseHeaders()&&d.getGrouped()&&d.getPinHeaders()){d.updateHeaderMap()}}},refreshScroller:function(){var a=this;if(a.isPainted()){if(!a.getInfinite()&&a.getGrouped()&&a.getPinHeaders()){a.updateHeaderMap()}a.container.getScrollable().getScroller().refresh()}},updateHeaderMap:function(){var d=this,b=d.headerMap,e=d.headerIndices,f,a;b.length=0;for(a in e){if(e.hasOwnProperty(a)){f=d.getItemAt(a).getHeader();b.push(f.renderElement.dom.offsetTop)}}},applyVariableHeights:function(a){if(!this.getInfinite()){return true}return a},applyDefaultType:function(a){if(!a){a=this.getUseSimpleItems()?"simplelistitem":"listitem"}return a},applyItemMap:function(a){return Ext.factory(a,Ext.util.PositionMap,this.getItemMap())},updateItemHeight:function(a){this.getItemMap().setMinimumHeight(a)},applyIndexBar:function(a){return Ext.factory(a,Ext.dataview.IndexBar,this.getIndexBar())},updatePinHeaders:function(a){if(this.isPainted()){this.pinnedHeader.translate(0,a?this.pinnedHeader.$position:-10000)}},updateItemTpl:function(g){var e=this,f=e.listItems,d=f.length||0,a,b;for(a=0;a<d;a++){b=f[a];b.setTpl(g)}e.updateAllListItems()},updateItemCls:function(g,d){var a=this.listItems,f=a.length,b,e;for(b=0;b<f;b++){e=a[b];e.removeCls(d);e.addCls(g)}},updateIndexBar:function(a,e){var d=this,b=d.scrollViewElement;if(e){e.un({index:"onIndex",scope:d});if(!a){d.element.removeCls(d.getBaseCls()+"-indexed")}if(b){b.removeChild(e.renderElement)}}if(a){a.on({index:"onIndex",scope:d});if(!e){d.element.addCls(d.getBaseCls()+"-indexed")}if(b){b.appendChild(a.renderElement)}}},updateGrouped:function(e){var g=this,d=this.getBaseCls(),a=g.pinnedHeader,b=d+"-grouped",f=d+"-ungrouped";if(a){a.translate(0,-10000)}if(e){g.addCls(b);g.removeCls(f)}else{g.addCls(f);g.removeCls(b)}if(g.getInfinite()){g.refreshHeaderIndices();g.handleItemHeights()}g.updateAllListItems()},onStoreAdd:function(){this.doRefresh()},onStoreRemove:function(){this.doRefresh()},onStoreUpdate:function(b,a,d,g){var f=this,e;g=(typeof g==="undefined")?d:g;if(f.getInfinite()||(g!==d)){f.doRefresh()}else{e=f.listItems[d];if(e){f.updateListItem(e,d,f.getListItemInfo())}}},onStoreClear:function(){var d=this,a=d.container.getScrollable().getScroller(),b=d.getInfinite();if(d.pinnedHeader){d.pinnedHeader.translate(0,-10000)}if(!b){d.setItemsCount(0);a.scrollTo(0,0)}else{d.topRenderedIndex=0;d.topVisibleIndex=0;a.position.y=0;d.updateAllListItems()}},showEmptyScrollDock:function(){var f=this,e=f.getInfinite(),g=f.scrollDockItems,h=0,a,d,b;for(a=0,d=g.top.length;a<d;a++){b=g.top[a];if(e){b.translate(0,h);h+=b.$scrollDockHeight}else{this.scrollElement.appendChild(b.renderElement)}}for(a=0,d=g.bottom.length;a<d;a++){b=g.bottom[a];if(e){b.translate(0,h);h+=b.$scrollDockHeight}else{this.scrollElement.appendChild(b.renderElement)}}},hideScrollDockItems:function(){var f=this,e=f.getInfinite(),g=f.scrollDockItems,a,d,b;if(!e){return}for(a=0,d=g.top.length;a<d;a++){b=g.top[a];b.translate(0,-10000)}for(a=0,d=g.bottom.length;a<d;a++){b=g.bottom[a];b.translate(0,-10000)}},getItemAt:function(a){var f=this.listItems,e=f.length,b,d;for(b=0;b<e;b++){d=f[b];if(d.$dataIndex==a){return d}}},getItemIndex:function(a){return a.$dataIndex},getViewItems:function(){return this.listItems},getListItemInfo:function(){var b=this,a=b.getBaseCls();return{store:b.getStore(),grouped:b.getGrouped(),baseCls:a,selectedCls:b.getSelectedCls(),headerCls:a+"-header-wrap",footerCls:a+"-footer-wrap",firstCls:a+"-item-first",lastCls:a+"-item-last",stripeCls:a+"-item-odd",striped:b.getStriped(),itemMap:b.getItemMap(),defaultItemHeight:b.getItemHeight()}},getListItemConfig:function(){var d=this,a=d.getItemMap().getMinimumHeight(),b={xtype:d.getDefaultType(),itemConfig:d.getItemConfig(),tpl:d.getItemTpl(),minHeight:a,cls:d.getItemCls()};if(d.getInfinite()){b.translatable={translationMethod:this.translationMethod}}if(!d.getVariableHeights()){b.height=a}return b},refreshHeaderIndices:function(){var j=this,k=j.getStore(),f=k&&k.getCount(),d=k.getGroups(),g=j.getGrouped(),m=d.length,n=j.headerIndices={},l=j.footerIndices={},e,b,a,h;if(!g){return l}j.groups=d;for(e=0;e<m;e++){a=d[e].children[0];h=k.indexOf(a);n[h]=true;b=h-1;if(b>=0){l[b]=true}}l[f-1]=true;return n},onIndex:function(d,g){var j=this,m=g.toLowerCase(),k=j.getStore(),e=k.getGroups(),h=e.length,l,f,b,a;for(f=0;f<h;f++){l=e[f];a=l.name.toLowerCase();if(a>=m){b=l;break}else{b=l}}if(b){this.scrollToRecord(b.children[0])}},scrollToRecord:function(g,b,d){var k=this,h=k.container.getScrollable().getScroller(),l=k.getStore(),j=l.indexOf(g);h.stopAnimation();var a=h.getContainerSize().y,n=h.getSize().y,e=n-a,f,m;if(k.getInfinite()){f=k.getItemMap().map[j]}else{m=k.listItems[j];if(k.getUseHeaders()&&m.getHeader().isPainted()){f=m.getHeader().renderElement.dom.offsetTop}else{f=m.renderElement.dom.offsetTop}}if(!d){f=Math.min(f,e)}h.scrollTo(0,f,!!b)},onItemAdd:function(d){var b=this,a=d.config;if(a.scrollDock){if(a.scrollDock=="bottom"){b.scrollDockItems.bottom.push(d)}else{b.scrollDockItems.top.push(d)}if(b.getInfinite()){d.on({resize:"onScrollDockItemResize",scope:this});d.addCls(b.getBaseCls()+"-scrolldockitem");d.setTranslatable({translationMethod:this.translationMethod});d.translate(0,-10000);d.$scrollDockHeight=0}b.container.doAdd(d)}else{b.callParent(arguments)}},getScrollDockedItems:function(){return this.scrollDockItems.bottom.slice().concat(this.scrollDockItems.top.slice())},onScrollDockItemResize:function(h,d){var g=this,a=g.listItems,f=a.length,b,e;Ext.getCmp(h.id).$scrollDockHeight=d.height;for(b=0;b<f;b++){e=a[b];if(e.isLast){this.updatedItems.push(e);this.refreshScroller();break}}},onItemTouchStart:function(a){this.container.innerElement.on({touchmove:"onItemTouchMove",delegate:"."+Ext.baseCSSPrefix+"list-item",single:true,scope:this});this.callParent(this.parseEvent(a))},onItemTouchMove:function(a){this.callParent(this.parseEvent(a))},onItemTouchEnd:function(a){this.container.innerElement.un({touchmove:"onItemTouchMove",delegate:"."+Ext.baseCSSPrefix+"list-item",scope:this});this.callParent(this.parseEvent(a))},onItemTap:function(a){this.callParent(this.parseEvent(a))},onItemTapHold:function(a){this.callParent(this.parseEvent(a))},onItemSingleTap:function(a){this.callParent(this.parseEvent(a))},onItemDoubleTap:function(a){this.callParent(this.parseEvent(a))},onItemSwipe:function(a){this.callParent(this.parseEvent(a))},parseEvent:function(f){var b=this,d=Ext.fly(f.getTarget()).findParent("."+Ext.baseCSSPrefix+"list-item",8),a=Ext.getCmp(d.id);return[b,a,a.$dataIndex,f]},doItemSelect:function(d,a){this.callParent(arguments);var b=d.getItemAt(d.getStore().indexOf(a));if(d.container&&!d.isDestroyed&&b&&b.isComponent){b.classCache=b.renderElement.classList.slice()}},doItemDeselect:function(d,a){this.callParent(arguments);var b=d.getItemAt(d.getStore().indexOf(a));if(b&&b.isComponent){b.classCache=b.renderElement.classList.slice()}},applyOnItemDisclosure:function(a){if(Ext.isFunction(a)){return{scope:this,handler:a}}return a},handleItemDisclosure:function(g){var f=this,d=Ext.getCmp(Ext.get(g.getTarget()).up(".x-list-item").id),b=d.$dataIndex,a=f.getStore().getAt(b);f.fireAction("disclose",[f,a,d,b,g],"doDisclose")},doDisclose:function(g,a,f,d,h){var b=g.getOnItemDisclosure();if(b&&b.handler){b.handler.call(b.scope||g,a,f,d,h)}},onItemTrigger:function(d,b,g,a,f){if(!(this.getPreventSelectionOnDisclose()&&Ext.fly(f.target).hasCls(this.getBaseCls()+"-disclosure"))){this.callParent(arguments)}},destroy:function(){var e=this,a=e.listItems,d=a.length,b;e.callParent(arguments);if(e.onIdleBound){Ext.AnimationQueue.unIdle(e.onAnimationIdle,e)}for(b=0;b<d;b++){a[b].destroy()}e.listItems=null}});Ext.define("Ext.dataview.NestedList",{alternateClassName:"Ext.NestedList",extend:Ext.Container,xtype:"nestedlist",config:{baseCls:Ext.baseCSSPrefix+"nested-list",backText:"Back",useTitleAsBackText:true,updateTitleText:true,displayField:"text",loadingText:"Loading...",emptyText:"No items available.",onItemDisclosure:false,allowDeselect:false,useToolbar:null,toolbar:{docked:"top",xtype:"titlebar",ui:"light",inline:true},title:"",layout:{type:"card",animation:{type:"slide",duration:250,direction:"left"}},store:null,detailContainer:undefined,detailCard:null,backButton:{ui:"back",hidden:true},listConfig:null,useSimpleItems:true,itemHeight:47,variableHeights:false,lastNode:null,lastActiveList:null,ui:null,clearSelectionOnListChange:true},platformConfig:[{theme:["Windows"],itemHeight:42},{theme:["Cupertino"],itemHeight:43,useTitleAsBackText:true,updateTitleText:false},{theme:["Blackberry"],toolbar:{splitNavigation:true}},{theme:["Tizen"],backText:""}],constructor:function(a){if(Ext.isObject(a)){if(a.getTitleTextTpl){this.getTitleTextTpl=a.getTitleTextTpl}if(a.getItemTextTpl){this.getItemTextTpl=a.getItemTextTpl}}this.callParent(arguments)},onItemInteraction:function(){if(this.isGoingTo){return false}},applyDetailContainer:function(a){if(!a){a=this}return a},updateDetailContainer:function(a,b){if(a){a.onBefore("activeitemchange","onBeforeDetailContainerChange",this);a.onAfter("activeitemchange","onDetailContainerChange",this)}},onBeforeDetailContainerChange:function(){this.isGoingTo=true},onDetailContainerChange:function(){this.isGoingTo=false},onItemTap:function(h,d,k,a,j){var g=this,b=h.getStore(),f=b.getAt(d);g.fireEvent("itemtap",this,h,d,k,a,j);if(f.isLeaf()){g.fireEvent("leafitemtap",this,h,d,k,a,j);g.goToLeaf(f)}else{this.goToNode(f)}},onBeforeSelect:function(){this.fireEvent.apply(this,[].concat("beforeselect",this,Array.prototype.slice.call(arguments)))},onContainerTap:function(){this.fireEvent.apply(this,[].concat("containertap",this,Array.prototype.slice.call(arguments)))},onSelectionChange:function(){this.fireEvent.apply(this,[].concat("selectionchange",this,Array.prototype.slice.call(arguments)))},onItemDoubleTap:function(){this.fireEvent.apply(this,[].concat("itemdoubletap",this,Array.prototype.slice.call(arguments)))},onStoreBeforeLoad:function(){var a=this.getLoadingText(),b=this.getScrollable();if(a){this.setMasked({xtype:"loadmask",message:a});if(b){b.getScroller().setDisabled(true)}}this.fireEvent.apply(this,[].concat("beforeload",this,Array.prototype.slice.call(arguments)))},onStoreLoad:function(d,b,e,a){this.setMasked(false);this.fireEvent.apply(this,[].concat("load",this,Array.prototype.slice.call(arguments)));if(d.indexOf(this.getLastNode())===-1){this.goToNode(d.getRoot())}},onBackTap:function(){var e=this,d=e.getLastNode(),f=e.getDetailCard(),a=f&&e.getActiveItem()==f,b=e.getLastActiveList();this.fireAction("back",[this,d,b,a],"doBack")},doBack:function(f,e,d,a){var b=f.getLayout(),g=(b)?b.getAnimation():null;if(a&&d){if(g){g.setReverse(true)}f.setActiveItem(d);f.setLastNode(e.parentNode);f.syncToolbar()}else{this.goToNode(e.parentNode)}},updateData:function(a){if(!this.getStore()){this.setStore(new Ext.data.TreeStore({root:a}))}},applyStore:function(a){if(a){if(Ext.isString(a)){a=Ext.data.StoreManager.get(a)}else{if(!(a instanceof Ext.data.TreeStore)){a=Ext.factory(a,Ext.data.TreeStore,null)}}}return a},storeListeners:{rootchange:"onStoreRootChange",load:"onStoreLoad",beforeload:"onStoreBeforeLoad"},updateStore:function(a,e){var d=this,b=this.storeListeners;b.scope=d;if(e&&Ext.isObject(e)&&e.isStore){if(e.autoDestroy){e.destroy()}e.un(b)}if(a){a.on(b);d.goToNode(a.getRoot())}},onStoreRootChange:function(a,b){this.goToNode(b)},applyBackButton:function(a){return Ext.factory(a,Ext.Button,this.getBackButton())},applyDetailCard:function(a,b){if(a===null){return Ext.factory(a,Ext.Component,b)}else{return Ext.factory(a,Ext.Component)}},updateBackButton:function(b,a){if(b){var e=this;b.on("tap",e.onBackTap,e);b.setText(e.getBackText());var d=e.getToolbar();if(this.$backButtonContainer){this.$backButtonContainer.insert(0,b)}else{d.insert(0,b)}}else{if(a){a.destroy()}}},applyToolbar:function(a){if(a&&a.splitNavigation){Ext.apply(a,{docked:"top",xtype:"titlebar",ui:"light"});var b=(a.splitNavigation===true)?{}:a.splitNavigation;this.$backButtonContainer=this.add(Ext.apply({xtype:"toolbar",docked:"bottom",hidden:true,ui:"dark"},b))}return Ext.factory(a,Ext.TitleBar,this.getToolbar())},updateToolbar:function(a,b){var d=this;if(a){a.setTitle(d.getTitle());if(!a.getParent()){d.add(a)}}else{if(b){b.destroy()}}},updateUseToolbar:function(a,b){if(!a){this.setToolbar(false)}},updateTitle:function(d){var b=this,a=b.getToolbar();if(a){if(b.getUpdateTitleText()){a.setTitle(d)}}},getItemTextTpl:function(a){return"{"+this.getDisplayField()+"}"},getTitleTextTpl:function(a){return"{"+this.getDisplayField()+"}"},renderTitleText:function(b,d){if(!b.titleTpl){b.titleTpl=Ext.create("Ext.XTemplate",this.getTitleTextTpl(b))}if(b.isRoot()){var a=this.getInitialConfig("title");return(d&&a==="")?this.getInitialConfig("backText"):a}return b.titleTpl.applyTemplate(b.data)},goToNode:function(a){if(!a){return}var k=this,e=k.getActiveItem(),m=k.getDetailCard(),l=m&&k.getActiveItem()==m,j=k.goToNodeReverseAnimation(a),d=k.firstList,f=k.secondList,g=k.getLayout(),b=(g)?g.getAnimation():null,h;if(a.isLeaf()){throw new Error("goToNode: passed a node which is a leaf.")}if(a==k.getLastNode()&&!l){return}if(l){if(b){b.setReverse(true)}h=k.getLastActiveList();h.getStore().setNode(a);a.expand();k.setActiveItem(h)}else{if(b){b.setReverse(j)}if(d&&f){e=k.getActiveItem();k.setLastActiveList(e);h=(e==d)?f:d;h.getStore().setNode(a);a.expand();k.setActiveItem(h);if(this.getClearSelectionOnListChange()){h.deselectAll()}}else{if(d){k.setLastActiveList(k.getActiveItem());k.setActiveItem(k.getList(a));k.secondList=k.getActiveItem()}else{k.setActiveItem(k.getList(a));k.firstList=k.getActiveItem()}}}k.fireEvent("listchange",this,k.getActiveItem());k.setLastNode(a);k.syncToolbar()},goToLeaf:function(g){if(!g.isLeaf()){throw new Error("goToLeaf: passed a node which is not a leaf.")}var f=this,d=f.getDetailCard(g),b=f.getDetailContainer(),a=b==this,e=f.getLayout(),h=(e)?e.getAnimation():false;if(d){if(b.getItems().indexOf(d)===-1){b.add(d)}if(a){if(f.getActiveItem() instanceof Ext.dataview.List){f.setLastActiveList(f.getActiveItem())}f.setLastNode(g)}if(h){h.setReverse(false)}b.setActiveItem(d);f.syncToolbar()}},syncToolbar:function(h){var e=this,j=e.getDetailCard(),a=e.getLastNode(),f=h||(j&&(e.getActiveItem()==j)),d=(f)?a:a.parentNode,k=e.getBackButton();if(k){var g=this.getToolbar(),b=g.getInitialConfig("splitNavigation");if(b){this.$backButtonContainer[d?"show":"hide"]()}k[d?"show":"hide"]();if(d&&e.getUseTitleAsBackText()){k.setText(e.renderTitleText(a.parentNode,true))}}if(a){e.setTitle(e.renderTitleText(a))}},updateBackText:function(a){this.getBackButton().setText(a)},goToNodeReverseAnimation:function(d){var b=this,a=b.getLastNode();if(!a){return false}return(!a.contains(d)&&a.isAncestor(d))?true:false},getList:function(b){var a=this,d=Ext.create("Ext.data.NodeStore",{recursive:false,node:b,rootVisible:false,model:a.getStore().getModel()});b.expand();return Ext.Object.merge({xtype:"list",useSimpleItems:a.getUseSimpleItems(),pressedDelay:250,autoDestroy:true,store:d,onItemDisclosure:a.getOnItemDisclosure(),allowDeselect:a.getAllowDeselect(),itemHeight:a.getItemHeight(),variableHeights:a.getVariableHeights(),emptyText:a.getEmptyText(),listeners:[{event:"itemdoubletap",fn:"onItemDoubleTap",scope:a},{event:"itemtap",fn:"onItemInteraction",scope:a,order:"before"},{event:"itemtouchstart",fn:"onItemInteraction",scope:a,order:"before"},{event:"itemtap",fn:"onItemTap",scope:a},{event:"beforeselectionchange",fn:"onBeforeSelect",scope:a},{event:"containertap",fn:"onContainerTap",scope:a},{event:"selectionchange",fn:"onSelectionChange",order:"before",scope:a}],itemTpl:'<span<tpl if="leaf == true"> class="x-list-item-leaf"</tpl>>'+a.getItemTextTpl(b)+"</span>"},this.getListConfig())}},function(){});Ext.define("Ext.event.Event",{alternateClassName:"Ext.EventObject",isStopped:false,set:function(a,b){if(arguments.length===1&&typeof a!="string"){var d=a;for(a in d){if(d.hasOwnProperty(a)){this[a]=d[a]}}}else{this[a]=d[a]}},stopEvent:function(){return this.stopPropagation()},stopPropagation:function(){this.isStopped=true;return this}});Ext.define("Ext.event.Dom",{extend:Ext.event.Event,constructor:function(a){var d=a.target,b;if(d&&d.nodeType!==1){d=d.parentNode}b=a.changedTouches;if(b){b=b[0];this.pageX=b.pageX;this.pageY=b.pageY}else{this.pageX=a.pageX;this.pageY=a.pageY}this.browserEvent=this.event=a;this.target=this.delegatedTarget=d;this.type=a.type;this.timeStamp=this.time=+a.timeStamp;return this},stopEvent:function(){this.preventDefault();return this.callParent()},preventDefault:function(){this.browserEvent.preventDefault()},getPageX:function(){return this.pageX||this.browserEvent.pageX},getPageY:function(){return this.pageY||this.browserEvent.pageY},getXY:function(){if(!this.xy){this.xy=[this.getPageX(),this.getPageY()]}return this.xy},getTarget:function(b,d,a){if(arguments.length===0){return this.delegatedTarget}return b?Ext.fly(this.target).findParent(b,d,a):(a?Ext.get(this.target):this.target)},getTime:function(){return this.time},setDelegatedTarget:function(a){this.delegatedTarget=a},makeUnpreventable:function(){this.browserEvent.preventDefault=Ext.emptyFn}});Ext.define("Ext.event.Touch",{extend:Ext.event.Dom,constructor:function(b,d,a,j){var g=[],e,f,k,h;if(d){this.set(d)}this.changedTouches=this.cloneTouches(b.changedTouches,a);for(f=0,k=j.length;f<k;f++){h=j[f];g.push(a[h])}this.touches=g;this.targetTouches=g.slice();e=this.changedTouches[0];this.callSuper([b]);this.target=this.delegatedTarget=e.target;this.pageX=e.pageX;this.pageY=e.pageY},cloneTouches:function(g,f){var e=[],b,d,h,a;for(b=0,d=g.length;b<d;b++){h=g[b];a=h.identifier;e[b]=f[a]}return e}});Ext.define("Ext.event.publisher.ComponentDelegation",{extend:Ext.event.publisher.Publisher,targetType:"component",optimizedSelectorRegex:/^#([\w\-]+)((?:[\s]*)>(?:[\s]*)|(?:\s*))([\w\-]+)$/i,handledEvents:["*"],getSubscribers:function(b,a){var e=this.subscribers,d=e[b];if(!d&&a){d=e[b]={type:{$length:0},selector:[],$length:0}}return d},subscribe:function(h,g){if(this.idSelectorRegex.test(h)){return false}var f=h.match(this.optimizedSelectorRegex),a=this.getSubscribers(g,true),m=a.type,d=a.selector,e,k,l,b,j;if(f!==null){e=f[1];k=f[2].indexOf(">")===-1;l=f[3];b=m[l];if(!b){m[l]=b={descendents:{$length:0},children:{$length:0},$length:0}}j=k?b.descendents:b.children;if(j.hasOwnProperty(e)){j[e]++;return true}j[e]=1;j.$length++;b.$length++;m.$length++}else{if(d.hasOwnProperty(h)){d[h]++;return true}d[h]=1;d.push(h)}a.$length++;return true},unsubscribe:function(h,g,m){var a=this.getSubscribers(g);if(!a){return false}var f=h.match(this.optimizedSelectorRegex),n=a.type,d=a.selector,e,k,l,b,j;m=Boolean(m);if(f!==null){e=f[1];k=f[2].indexOf(">")===-1;l=f[3];b=n[l];if(!b){return true}j=k?b.descendents:b.children;if(!j.hasOwnProperty(e)||(!m&&--j[e]>0)){return true}delete j[e];j.$length--;b.$length--;n.$length--}else{if(!d.hasOwnProperty(h)||(!m&&--d[h]>0)){return true}delete d[h];Ext.Array.remove(d,h)}if(--a.$length===0){delete this.subscribers[g]}return true},notify:function(e,a){var d=this.getSubscribers(a),f,b;if(!d||d.$length===0){return false}f=e.substr(1);b=Ext.ComponentManager.get(f);if(b){this.dispatcher.doAddListener(this.targetType,e,a,"publish",this,{args:[a,b]},"before")}},matchesSelector:function(b,a){return Ext.ComponentQuery.is(b,a)},dispatch:function(e,b,d,a){this.dispatcher.doDispatchEvent(this.targetType,e,b,d,null,a)},publish:function(h,l){var f=this.getSubscribers(h);if(!f){return}var q=arguments[arguments.length-1],p=f.type,b=f.selector,e=Array.prototype.slice.call(arguments,2,-2),m=l.xtypesChain,u,o,v,a,n,x,s,w,k,g,r,d;for(w=0,k=m.length;w<k;w++){g=m[w];f=p[g];if(f&&f.$length>0){u=f.descendents;if(u.$length>0){if(!a){a=l.getAncestorIds()}for(r=0,d=a.length;r<d;r++){n=a[r];if(u.hasOwnProperty(n)){this.dispatch("#"+n+" "+g,h,e,q)}}}o=f.children;if(o.$length>0){if(!v){if(a){v=a[0]}else{x=l.getParent();if(x){v=x.getId()}}}if(v){if(o.hasOwnProperty(v)){this.dispatch("#"+v+" > "+g,h,e,q)}}}}}k=b.length;if(k>0){for(w=0;w<k;w++){s=b[w];if(this.matchesSelector(l,s)){this.dispatch(s,h,e,q)}}}}});Ext.define("Ext.event.publisher.ComponentPaint",{extend:Ext.event.publisher.Publisher,targetType:"component",handledEvents:["erased"],eventNames:{painted:"painted",erased:"erased"},constructor:function(){this.callParent(arguments);this.hiddenQueue={};this.renderedQueue={}},getSubscribers:function(b,a){var d=this.subscribers;if(!d.hasOwnProperty(b)){if(!a){return null}d[b]={$length:0}}return d[b]},setDispatcher:function(a){var b=this.targetType;a.doAddListener(b,"*","renderedchange","onBeforeComponentRenderedChange",this,null,"before");a.doAddListener(b,"*","hiddenchange","onBeforeComponentHiddenChange",this,null,"before");a.doAddListener(b,"*","renderedchange","onComponentRenderedChange",this,null,"after");a.doAddListener(b,"*","hiddenchange","onComponentHiddenChange",this,null,"after");return this.callParent(arguments)},subscribe:function(e,a){var b=e.match(this.idSelectorRegex),d,f;if(!b){return false}f=b[1];d=this.getSubscribers(a,true);if(d.hasOwnProperty(f)){d[f]++;return true}d[f]=1;d.$length++;return true},unsubscribe:function(f,a,d){var b=f.match(this.idSelectorRegex),e,g;if(!b||!(e=this.getSubscribers(a))){return false}g=b[1];if(!e.hasOwnProperty(g)||(!d&&--e[g]>0)){return true}delete e[g];if(--e.$length===0){delete this.subscribers[a]}return true},onBeforeComponentRenderedChange:function(b,e,h){var g=this.eventNames,d=h?g.painted:g.erased,f=this.getSubscribers(d),a;if(f&&f.$length>0){this.renderedQueue[e.getId()]=a=[];this.publish(f,e,d,a)}},onBeforeComponentHiddenChange:function(d,e){var g=this.eventNames,b=e?g.erased:g.painted,f=this.getSubscribers(b),a;if(f&&f.$length>0){this.hiddenQueue[d.getId()]=a=[];this.publish(f,d,b,a)}},onComponentRenderedChange:function(b,d){var e=this.renderedQueue,f=d.getId(),a;if(!e.hasOwnProperty(f)){return}a=e[f];delete e[f];if(a.length>0){this.dispatchQueue(a)}},onComponentHiddenChange:function(d){var b=this.hiddenQueue,e=d.getId(),a;if(!b.hasOwnProperty(e)){return}a=b[e];delete b[e];if(a.length>0){this.dispatchQueue(a)}},dispatchQueue:function(h){var m=this.dispatcher,a=this.targetType,b=this.eventNames,f=h.slice(),g=f.length,d,l,j,e,k;h.length=0;if(g>0){for(d=0;d<g;d++){l=f[d];j=l.component;e=l.eventName;k=j.isPainted();if((e===b.painted&&k)||e===b.erased&&!k){m.doDispatchEvent(a,"#"+l.id,e,[j])}}f.length=0}},publish:function(a,l,g,k){var d=l.getId(),b=false,e,j,f,h,m;if(a[d]){e=this.eventNames;m=l.isPainted();if((g===e.painted&&!m)||g===e.erased&&m){b=true}else{return this}}if(l.isContainer){j=l.getItems().items;for(f=0,h=j.length;f<h;f++){this.publish(a,j[f],g,k)}}else{if(l.isDecorator){this.publish(a,l.getComponent(),g,k)}}if(b){k.push({id:d,eventName:g,component:l})}}});Ext.define("Ext.event.publisher.Dom",{extend:Ext.event.publisher.Publisher,targetType:"element",idOrClassSelectorRegex:/^([#|\.])([\w\-]+)$/,handledEvents:["focus","blur","paste","input","change","keyup","keydown","keypress","submit","transitionend","animationstart","animationend"],classNameSplitRegex:/\s+/,SELECTOR_ALL:"*",constructor:function(){var g=this.getHandledEvents(),f={},b,d,a,e;this.doBubbleEventsMap={click:true,submit:true,mousedown:true,mousemove:true,mouseup:true,mouseover:true,mouseout:true,transitionend:true};this.onEvent=Ext.Function.bind(this.onEvent,this);for(b=0,d=g.length;b<d;b++){a=g[b];e=this.getVendorEventName(a);f[e]=a;this.attachListener(e)}this.eventNameMap=f;return this.callParent()},getSubscribers:function(a){var d=this.subscribers,b=d[a];if(!b){b=d[a]={id:{$length:0},className:{$length:0},selector:[],all:0,$length:0}}return b},getVendorEventName:function(a){if(Ext.browser.is.WebKit){if(a==="transitionend"){a=Ext.browser.getVendorProperyName("transitionEnd")}else{if(a==="animationstart"){a=Ext.browser.getVendorProperyName("animationStart")}else{if(a==="animationend"){a=Ext.browser.getVendorProperyName("animationEnd")}}}}return a},bindListeners:function(e,f){var a=this.getHandledEvents(),d=a.length,b;for(b=0;b<d;b++){this.bindListener(e,this.getVendorEventName(a[b]),f)}},bindListener:function(b,a,d){if(d){this.attachListener(a,b)}else{this.removeListener(a,b)}return this},attachListener:function(a,d){if(!d){d=document}var b=d.defaultView;if(Ext.os.is.iOS&&Ext.os.version.getMajor()<5){document.addEventListener(a,this.onEvent,!this.doesEventBubble(a))}else{if(b&&b.addEventListener){d.defaultView.addEventListener(a,this.onEvent,!this.doesEventBubble(a))}else{d.addEventListener(a,this.onEvent,!this.doesEventBubble(a))}}return this},removeListener:function(a,d){if(!d){d=document}var b=d.defaultView;if(Ext.os.is.iOS&&Ext.os.version.getMajor()<5){document.removeEventListener(a,this.onEvent,!this.doesEventBubble(a))}else{if(b&&b.addEventListener){d.defaultView.removeEventListener(a,this.onEvent,!this.doesEventBubble(a))}else{d.removeEventListener(a,this.onEvent,!this.doesEventBubble(a))}}return this},doesEventBubble:function(a){return !!this.doBubbleEventsMap[a]},subscribe:function(h,g){if(!this.handles(g)){return false}var f=h.match(this.idOrClassSelectorRegex),a=this.getSubscribers(g),d=a.id,e=a.className,b=a.selector,j,k;if(f!==null){j=f[1];k=f[2];if(j==="#"){if(d.hasOwnProperty(k)){d[k]++;return true}d[k]=1;d.$length++}else{if(e.hasOwnProperty(k)){e[k]++;return true}e[k]=1;e.$length++}}else{if(h===this.SELECTOR_ALL){a.all++}else{if(b.hasOwnProperty(h)){b[h]++;return true}b[h]=1;b.push(h)}}a.$length++;return true},unsubscribe:function(h,g,l){if(!this.handles(g)){return false}var f=h.match(this.idOrClassSelectorRegex),a=this.getSubscribers(g),d=a.id,e=a.className,b=a.selector,j,k;l=Boolean(l);if(f!==null){j=f[1];k=f[2];if(j==="#"){if(!d.hasOwnProperty(k)||(!l&&--d[k]>0)){return true}delete d[k];d.$length--}else{if(!e.hasOwnProperty(k)||(!l&&--e[k]>0)){return true}delete e[k];e.$length--}}else{if(h===this.SELECTOR_ALL){if(l){a.all=0}else{a.all--}}else{if(!b.hasOwnProperty(h)||(!l&&--b[h]>0)){return true}delete b[h];Ext.Array.remove(b,h)}}a.$length--;return true},getElementTarget:function(a){if(a.nodeType!==1){a=a.parentNode;if(!a||a.nodeType!==1){return null}}return a},getBubblingTargets:function(b){var a=[];if(!b){return a}do{a[a.length]=b;b=b.parentNode}while(b&&b.nodeType===1);return a},dispatch:function(d,a,b){b.push(b[0].target);this.callParent(arguments)},publish:function(b,a,d){var e=this.getSubscribers(b),f;if(e.$length===0||!this.doPublish(e,b,a,d)){f=this.getSubscribers("*");if(f.$length>0){this.doPublish(f,b,a,d)}}return this},doPublish:function(g,k,z,w){var s=g.id,h=g.className,b=g.selector,q=s.$length>0,a=h.$length>0,m=b.length>0,p=g.all>0,A={},f=[w],r=false,n=this.classNameSplitRegex,x,l,v,e,B,o,d,y,u;for(x=0,l=z.length;x<l;x++){B=z[x];w.setDelegatedTarget(B);if(q){o=B.getAttribute("id");if(o){if(s.hasOwnProperty(o)){r=true;this.dispatch("#"+o,k,f)}}}if(a){d=B.className;if(d){y=d.split(n);for(v=0,e=y.length;v<e;v++){d=y[v];if(!A[d]){A[d]=true;if(h.hasOwnProperty(d)){r=true;this.dispatch("."+d,k,f)}}}}}if(w.isStopped){return r}}if(p&&!r){w.setDelegatedTarget(w.browserEvent.target);r=true;this.dispatch(this.SELECTOR_ALL,k,f);if(w.isStopped){return r}}if(m){for(v=0,e=z.length;v<e;v++){B=z[v];for(x=0,l=b.length;x<l;x++){u=b[x];if(this.matchesSelector(B,u)){w.setDelegatedTarget(B);r=true;this.dispatch(u,k,f)}if(w.isStopped){return r}}}}return r},matchesSelector:function(){var b=Element.prototype,a=("webkitMatchesSelector" in b)?"webkitMatchesSelector":(("msMatchesSelector" in b)?"msMatchesSelector":("mozMatchesSelector" in b?"mozMatchesSelector":null));if(a){return function(e,d){return e[a](d)}}return function(e,d){Ext.DomQuery.is(e,d)}}(),onEvent:function(f){var b=this.eventNameMap[f.type];Ext.frameStartTime=f.timeStamp;if(!b||this.getSubscribersCount(b)===0){return}var d=this.getElementTarget(f.target),a;if(!d){return}if(this.doesEventBubble(b)){a=this.getBubblingTargets(d)}else{a=[d]}this.publish(b,a,new Ext.event.Dom(f))},getSubscribersCount:function(a){if(!this.handles(a)){return 0}return this.getSubscribers(a).$length+this.getSubscribers("*").$length}});Ext.define("Ext.util.paintmonitor.Abstract",{config:{element:null,callback:Ext.emptyFn,scope:null,args:[]},eventName:"",monitorClass:"",constructor:function(a){this.onElementPainted=Ext.Function.bind(this.onElementPainted,this);this.initConfig(a)},bindListeners:function(a){this.monitorElement[a?"addEventListener":"removeEventListener"](this.eventName,this.onElementPainted,true)},applyElement:function(a){if(a){return Ext.get(a)}},updateElement:function(a){this.monitorElement=Ext.Element.create({classList:["x-paint-monitor",this.monitorClass]},true);a.appendChild(this.monitorElement);a.addCls("x-paint-monitored");this.bindListeners(true)},onElementPainted:function(){},destroy:function(){var b=this.monitorElement,a=b.parentNode,d=this.getElement();this.bindListeners(false);delete this.monitorElement;if(d&&!d.isDestroyed){d.removeCls("x-paint-monitored");delete this._element}if(a){a.removeChild(b)}this.callSuper()}});Ext.define("Ext.util.paintmonitor.CssAnimation",{extend:Ext.util.paintmonitor.Abstract,eventName:Ext.browser.is.WebKit?"webkitAnimationEnd":"animationend",monitorClass:"cssanimation",onElementPainted:function(a){if(a.animationName==="x-paint-monitor-helper"){this.getCallback().apply(this.getScope(),this.getArgs())}}});Ext.define("Ext.util.paintmonitor.OverflowChange",{extend:Ext.util.paintmonitor.Abstract,eventName:Ext.browser.is.Firefox?"overflow":"overflowchanged",monitorClass:"overflowchange",onElementPainted:function(a){this.getCallback().apply(this.getScope(),this.getArgs())}});Ext.define("Ext.util.PaintMonitor",{constructor:function(a){if(Ext.browser.is.Firefox||(Ext.browser.is.WebKit&&Ext.browser.engineVersion.gtEq("536")&&!Ext.os.is.Blackberry)){return new Ext.util.paintmonitor.OverflowChange(a)}else{return new Ext.util.paintmonitor.CssAnimation(a)}}});Ext.define("Ext.event.publisher.ElementPaint",{extend:Ext.event.publisher.Publisher,targetType:"element",handledEvents:["painted"],constructor:function(){this.monitors={};this.callSuper(arguments)},subscribe:function(e){var a=e.match(this.idSelectorRegex),d=this.subscribers,f,b;if(!a){return false}f=a[1];if(d.hasOwnProperty(f)){d[f]++;return true}d[f]=1;b=Ext.get(f);this.monitors[f]=new Ext.util.PaintMonitor({element:b,callback:this.onElementPainted,scope:this,args:[e,b]});return true},unsubscribe:function(f,a,d){var b=f.match(this.idSelectorRegex),e=this.subscribers,g;if(!b){return false}g=b[1];if(!e.hasOwnProperty(g)||(!d&&--e[g]>0)){return true}delete e[g];this.monitors[g].destroy();delete this.monitors[g];return true},onElementPainted:function(b,a){Ext.TaskQueue.requestRead("dispatch",this,[b,"painted",[a]])}});Ext.define("Ext.ux.PaintMonitor",{override:"Ext.util.PaintMonitor",constructor:function(a){if(Ext.browser.is.Firefox||(Ext.browser.is.WebKit&&Ext.browser.engineVersion.gtEq("536")&&!Ext.browser.engineVersion.ltEq("537.36")&&!Ext.os.is.Blackberry)){return new Ext.util.paintmonitor.OverflowChange(a)}else{return new Ext.util.paintmonitor.CssAnimation(a)}}},function(){console.info("Ext.util.PaintMonitor temp. fix is active")});Ext.define("Ext.mixin.Templatable",{extend:Ext.mixin.Mixin,mixinConfig:{id:"templatable"},referenceAttributeName:"reference",referenceSelector:"[reference]",getElementConfig:function(){return{reference:"element"}},getElementTemplate:function(){var a=document.createDocumentFragment();a.appendChild(Ext.Element.create(this.getElementConfig(),true));return a},initElement:function(){var a=this.self.prototype;a.elementTemplate=this.getElementTemplate();a.initElement=a.doInitElement;this.initElement.apply(this,arguments)},linkElement:function(a,b){this.link(a,b)},doInitElement:function(){var h=this.referenceAttributeName,d,e,f,g,b,a;d=this.elementTemplate.cloneNode(true);e=d.querySelectorAll(this.referenceSelector);for(f=0,g=e.length;f<g;f++){b=e[f];a=b.getAttribute(h);b.removeAttribute(h);this.linkElement(a,b)}}});Ext.define("Ext.util.sizemonitor.Abstract",{mixins:[Ext.mixin.Templatable],config:{element:null,callback:Ext.emptyFn,scope:null,args:[]},width:0,height:0,contentWidth:0,contentHeight:0,constructor:function(a){this.refresh=Ext.Function.bind(this.refresh,this);this.info={width:0,height:0,contentWidth:0,contentHeight:0,flag:0};this.initElement();this.initConfig(a);this.bindListeners(true)},bindListeners:Ext.emptyFn,applyElement:function(a){if(a){return Ext.get(a)}},updateElement:function(a){a.append(this.detectorsContainer);a.addCls("x-size-monitored")},applyArgs:function(a){return a.concat([this.info])},refreshMonitors:Ext.emptyFn,forceRefresh:function(){Ext.TaskQueue.requestRead("refresh",this)},getContentBounds:function(){return this.detectorsContainer.getBoundingClientRect()},getContentWidth:function(){return this.detectorsContainer.offsetWidth},getContentHeight:function(){return this.detectorsContainer.offsetHeight},refreshSize:function(){var e=this.getElement();if(!e||e.isDestroyed){return false}var b=e.getWidth(),l=e.getHeight(),a=this.getContentWidth(),k=this.getContentHeight(),j=this.contentWidth,g=this.contentHeight,d=this.info,f=false,h;this.width=b;this.height=l;this.contentWidth=a;this.contentHeight=k;h=((j!==a?1:0)+(g!==k?2:0));if(h>0){d.width=b;d.height=l;d.contentWidth=a;d.contentHeight=k;d.flag=h;f=true;this.getCallback().apply(this.getScope(),this.getArgs())}return f},refresh:function(a){if(this.refreshSize()||a){Ext.TaskQueue.requestWrite("refreshMonitors",this)}},destroy:function(){var a=this.getElement();this.bindListeners(false);if(a&&!a.isDestroyed){a.removeCls("x-size-monitored")}delete this._element;this.callSuper()}});Ext.define("Ext.util.sizemonitor.Default",{extend:Ext.util.sizemonitor.Abstract,updateElement:function(a){},bindListeners:function(b){var a=this.getElement().dom;if(!a){return}if(b){a.onresize=this.refresh}else{delete a.onresize}},getContentBounds:function(){return this.getElement().dom.getBoundingClientRect()},getContentWidth:function(){return this.getElement().getWidth()},getContentHeight:function(){return this.getElement().getHeight()}});Ext.define("Ext.util.sizemonitor.Scroll",{extend:Ext.util.sizemonitor.Abstract,getElementConfig:function(){return{reference:"detectorsContainer",classList:["x-size-monitors","scroll"],children:[{reference:"expandMonitor",className:"expand"},{reference:"shrinkMonitor",className:"shrink"}]}},constructor:function(a){this.onScroll=Ext.Function.bind(this.onScroll,this);this.callSuper(arguments)},bindListeners:function(b){var a=b?"addEventListener":"removeEventListener";this.expandMonitor[a]("scroll",this.onScroll,true);this.shrinkMonitor[a]("scroll",this.onScroll,true)},forceRefresh:function(){Ext.TaskQueue.requestRead("refresh",this,[true])},onScroll:function(){Ext.TaskQueue.requestRead("refresh",this)},refreshMonitors:function(){var b=this.expandMonitor,d=this.shrinkMonitor,a=1000000;if(b&&!b.isDestroyed){b.scrollLeft=a;b.scrollTop=a}if(d&&!d.isDestroyed){d.scrollLeft=a;d.scrollTop=a}}});Ext.define("Ext.util.sizemonitor.OverflowChange",{extend:Ext.util.sizemonitor.Abstract,constructor:function(a){this.onExpand=Ext.Function.bind(this.onExpand,this);this.onShrink=Ext.Function.bind(this.onShrink,this);this.callSuper(arguments)},getElementConfig:function(){return{reference:"detectorsContainer",classList:["x-size-monitors","overflowchanged"],children:[{reference:"expandMonitor",className:"expand",children:[{reference:"expandHelper"}]},{reference:"shrinkMonitor",className:"shrink",children:[{reference:"shrinkHelper"}]}]}},bindListeners:function(b){var a=b?"addEventListener":"removeEventListener";this.expandMonitor[a](Ext.browser.is.Firefox?"underflow":"overflowchanged",this.onExpand,true);this.shrinkMonitor[a](Ext.browser.is.Firefox?"overflow":"overflowchanged",this.onShrink,true)},onExpand:function(a){if(Ext.browser.is.Webkit&&a.horizontalOverflow&&a.verticalOverflow){return}Ext.TaskQueue.requestRead("refresh",this)},onShrink:function(a){if(Ext.browser.is.Webkit&&!a.horizontalOverflow&&!a.verticalOverflow){return}Ext.TaskQueue.requestRead("refresh",this)},refreshMonitors:function(){if(this.isDestroyed){return}var g=this.expandHelper,f=this.shrinkHelper,b=this.getContentBounds(),e=b.width,a=b.height,d;if(g&&!g.isDestroyed){d=g.style;d.width=(e+1)+"px";d.height=(a+1)+"px"}if(f&&!f.isDestroyed){d=f.style;d.width=e+"px";d.height=a+"px"}Ext.TaskQueue.requestRead("refresh",this)}});Ext.define("Ext.util.SizeMonitor",{constructor:function(a){var b=Ext.util.sizemonitor;if(Ext.browser.is.Firefox){return new b.OverflowChange(a)}else{if(Ext.browser.is.WebKit){if(!Ext.browser.is.Silk&&Ext.browser.engineVersion.gtEq("535")){return new b.OverflowChange(a)}else{return new b.Scroll(a)}}else{if(Ext.browser.is.IE11){return new b.Scroll(a)}else{return new b.Default(a)}}}}});Ext.define("Ext.event.publisher.ElementSize",{extend:Ext.event.publisher.Publisher,targetType:"element",handledEvents:["resize"],constructor:function(){this.monitors={};this.callSuper(arguments)},subscribe:function(f){var b=f.match(this.idSelectorRegex),e=this.subscribers,g,d,a;if(!b){return false}g=b[1];if(e.hasOwnProperty(g)){e[g]++;return true}e[g]=1;d=Ext.get(g);this.monitors[g]=a=new Ext.util.SizeMonitor({element:d,callback:this.onElementResize,scope:this,args:[f,d]});this.dispatcher.addListener("element",f,"painted","forceRefresh",a);return true},unsubscribe:function(h,a,f){var d=h.match(this.idSelectorRegex),g=this.subscribers,e=this.monitors,j,b;if(!d){return false}j=d[1];if(!g.hasOwnProperty(j)||(!f&&--g[j]>0)){return true}delete g[j];b=e[j];this.dispatcher.removeListener("element",h,"painted","forceRefresh",b);b.destroy();delete e[j];return true},onElementResize:function(d,a,b){Ext.TaskQueue.requestRead("dispatch",this,[d,"resize",[a,b]])}});Ext.define("Ext.ux.SizeMonitor",{override:"Ext.util.SizeMonitor",constructor:function(a){var b=Ext.util.sizemonitor;if(Ext.browser.is.Firefox){return new b.OverflowChange(a)}else{if(Ext.browser.is.WebKit){if(!Ext.browser.is.Silk&&Ext.browser.engineVersion.gtEq("535")&&!Ext.browser.engineVersion.ltEq("537.36")){return new b.OverflowChange(a)}else{return new b.Scroll(a)}}else{if(Ext.browser.is.IE11){return new b.Scroll(a)}else{return new b.Scroll(a)}}}}},function(){console.info("Ext.util.SizeMonitor temp. fix is active")});Ext.define("Ext.event.publisher.TouchGesture",{extend:Ext.event.publisher.Dom,isNotPreventable:/^(select|a)$/i,handledEvents:["touchstart","touchmove","touchend","touchcancel"],mouseToTouchMap:{mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},lastEventType:null,config:{moveThrottle:0,recognizers:{}},constructor:function(a){this.eventProcessors={touchstart:this.onTouchStart,touchmove:this.onTouchMove,touchend:this.onTouchEnd,touchcancel:this.onTouchEnd};this.eventToRecognizerMap={};this.activeRecognizers=[];this.touchesMap={};this.currentIdentifiers=[];if(Ext.browser.is.Chrome&&Ext.os.is.Android){this.screenPositionRatio=Ext.browser.version.gt("18")?1:1/window.devicePixelRatio}else{if(Ext.browser.is.AndroidStock4){this.screenPositionRatio=1}else{if(Ext.os.is.BlackBerry){this.screenPositionRatio=1/window.devicePixelRatio}else{if(Ext.browser.engineName=="WebKit"&&Ext.os.is.Desktop){this.screenPositionRatio=1}else{this.screenPositionRatio=window.innerWidth/window.screen.width}}}}this.initConfig(a);return this.callSuper()},applyRecognizers:function(b){var d,a;for(d in b){if(b.hasOwnProperty(d)){a=b[d];if(a){this.registerRecognizer(a)}}}return b},handles:function(a){return this.callSuper(arguments)||this.eventToRecognizerMap.hasOwnProperty(a)},doesEventBubble:function(){return true},onEvent:function(g){var f=g.type,b=this.lastEventType,d=[g];if(this.eventProcessors[f]){this.eventProcessors[f].call(this,g);return}if("button" in g&&g.button>0){return}else{if(f==="mousedown"&&b&&b!=="mouseup"){var a=document.createEvent("MouseEvent");a.initMouseEvent("mouseup",g.bubbles,g.cancelable,document.defaultView,g.detail,g.screenX,g.screenY,g.clientX,g.clientY,g.ctrlKey,g.altKey,g.shiftKey,g.metaKey,g.metaKey,g.button,g.relatedTarget);this.onEvent(a)}if(f!=="mousemove"){this.lastEventType=f}g.identifier=1;g.touches=(f!=="mouseup")?d:[];g.targetTouches=(f!=="mouseup")?d:[];g.changedTouches=d;this.eventProcessors[this.mouseToTouchMap[f]].call(this,g)}},registerRecognizer:function(a){var h=this.eventToRecognizerMap,f=this.activeRecognizers,d=a.getHandledEvents(),e,g,b;a.setOnRecognized(this.onRecognized);a.setCallbackScope(this);for(e=0,g=d.length;e<g;e++){b=d[e];h[b]=a}f.push(a);return this},onRecognized:function(g,j,f,a){var l=[],k=f.length,h,d,b;if(k===1){return this.publish(g,f[0].targets,j,a)}for(d=0;d<k;d++){b=f[d];l.push(b.targets)}h=this.getCommonTargets(l);this.publish(g,h,j,a)},publish:function(b,a,d,e){d.set(e);return this.callSuper([b,a,d])},getCommonTargets:function(a){var k=a[0],g=a.length;if(g===1){return k}var e=[],f=1,h,b,d;while(true){h=k[k.length-f];if(!h){return e}for(d=1;d<g;d++){b=a[d];if(b[b.length-f]!==h){return e}}e.unshift(h);f++}return e},invokeRecognizers:function(d,h){var b=this.activeRecognizers,g=b.length,f,a;if(d==="onStart"){for(f=0;f<g;f++){b[f].isActive=true}}for(f=0;f<g;f++){a=b[f];if(a.isActive&&a[d].call(a,h)===false){a.isActive=false}}},getActiveRecognizers:function(){return this.activeRecognizers},updateTouch:function(g){var b=g.identifier,e=this.touchesMap[b],d,a,f;if(!e){d=this.getElementTarget(g.target);this.touchesMap[b]=e={identifier:b,target:d,targets:this.getBubblingTargets(d)};this.currentIdentifiers.push(b)}a=g.pageX;f=g.pageY;if(a===e.pageX&&f===e.pageY){return false}e.pageX=a;e.pageY=f;e.timeStamp=g.timeStamp;e.point=new Ext.util.Point(a,f);return e},updateTouches:function(e){var a,d,f,b=[];for(a=0,d=e.length;a<d;a++){f=this.updateTouch(e[a]);if(f){b.push(f)}}return b},factoryEvent:function(a){return new Ext.event.Touch(a,null,this.touchesMap,this.currentIdentifiers)},onTouchStart:function(j){var f=j.changedTouches,h=j.target,g=f.length,a=this.isNotPreventable,b,k,d;this.updateTouches(f);j=this.factoryEvent(j);f=j.changedTouches;for(b=0;b<g;b++){k=f[b];this.publish("touchstart",k.targets,j,{touch:k})}if(!this.isStarted){this.isStarted=true;this.invokeRecognizers("onStart",j)}this.invokeRecognizers("onTouchStart",j);d=h.parentNode||{}},onTouchMove:function(a){if(!this.isStarted){return}if(!this.animationQueued){this.animationQueued=true;Ext.AnimationQueue.start("onAnimationFrame",this)}this.lastMoveEvent=a},onAnimationFrame:function(){var a=this.lastMoveEvent;if(a){this.lastMoveEvent=null;this.doTouchMove(a)}},doTouchMove:function(f){var b,a,d,g;b=this.updateTouches(f.changedTouches);d=b.length;f=this.factoryEvent(f);for(a=0;a<d;a++){g=b[a];this.publish("touchmove",g.targets,f,{touch:g})}if(d>0){this.invokeRecognizers("onTouchMove",f)}},onTouchEnd:function(j){if(!this.isStarted){return}if(this.lastMoveEvent){this.onAnimationFrame()}var a=this.touchesMap,f=this.currentIdentifiers,g=j.changedTouches,h=g.length,b,d,k;this.updateTouches(g);g=j.changedTouches;for(d=0;d<h;d++){Ext.Array.remove(f,g[d].identifier)}j=this.factoryEvent(j);for(d=0;d<h;d++){b=g[d].identifier;k=a[b];delete a[b];this.publish("touchend",k.targets,j,{touch:k})}this.invokeRecognizers("onTouchEnd",j);if(j.touches.length===1&&f.length){f.length=0;this.touchesMap={}}if(f.length===0){this.isStarted=false;this.invokeRecognizers("onEnd",j);if(this.animationQueued){this.animationQueued=false;Ext.AnimationQueue.stop("onAnimationFrame",this)}}}},function(){if(Ext.feature.has.Pointer){this.override({pointerToTouchMap:{MSPointerDown:"touchstart",MSPointerMove:"touchmove",MSPointerUp:"touchend",MSPointerCancel:"touchcancel",pointerdown:"touchstart",pointermove:"touchmove",pointerup:"touchend",pointercancel:"touchcancel"},touchToPointerMap:{touchstart:"MSPointerDown",touchmove:"MSPointerMove",touchend:"MSPointerUp",touchcancel:"MSPointerCancel"},attachListener:function(a,b){a=this.touchToPointerMap[a];if(!a){return}return this.callOverridden([a,b])},onEvent:function(b){if("button" in b&&b.button>0){return}var a=this.pointerToTouchMap[b.type];b.identifier=b.pointerId;b.changedTouches=[b];this.eventProcessors[a].call(this,b)}})}else{if(!Ext.browser.is.Ripple&&(Ext.os.is.ChromeOS||!Ext.feature.has.Touch)){this.override({handledEvents:["touchstart","touchmove","touchend","touchcancel","mousedown","mousemove","mouseup"]})}}});Ext.define("Ext.event.recognizer.Recognizer",{mixins:[Ext.mixin.Identifiable],handledEvents:[],config:{onRecognized:Ext.emptyFn,onFailed:Ext.emptyFn,callbackScope:null},constructor:function(a){this.initConfig(a);return this},getHandledEvents:function(){return this.handledEvents},onStart:Ext.emptyFn,onEnd:Ext.emptyFn,fail:function(){this.getOnFailed().apply(this.getCallbackScope(),arguments);return false},fire:function(){this.getOnRecognized().apply(this.getCallbackScope(),arguments)}});Ext.define("Ext.event.recognizer.Touch",{extend:Ext.event.recognizer.Recognizer,onTouchStart:Ext.emptyFn,onTouchMove:Ext.emptyFn,onTouchEnd:Ext.emptyFn});Ext.define("Ext.event.recognizer.SingleTouch",{extend:Ext.event.recognizer.Touch,inheritableStatics:{NOT_SINGLE_TOUCH:1,TOUCH_MOVED:2},onTouchStart:function(a){if(a.touches.length>1){return this.fail(this.self.NOT_SINGLE_TOUCH)}}});Ext.define("Ext.event.recognizer.DoubleTap",{extend:Ext.event.recognizer.SingleTouch,inheritableStatics:{DIFFERENT_TARGET:3},config:{maxDuration:300},handledEvents:["singletap","doubletap"],singleTapTimer:null,startTime:0,lastTapTime:0,onTouchStart:function(a){if(this.callParent(arguments)===false){return false}this.startTime=a.time;clearTimeout(this.singleTapTimer)},onTouchMove:function(){return this.fail(this.self.TOUCH_MOVED)},onEnd:function(h){var k=this,f=this.getMaxDuration(),g=h.changedTouches[0],a=h.time,j=h.target,l=this.lastTapTime,b=this.lastTarget,d;this.lastTapTime=a;this.lastTarget=j;if(l){d=a-l;if(d<=f){if(j!==b){return this.fail(this.self.DIFFERENT_TARGET)}this.lastTarget=null;this.lastTapTime=0;this.fire("doubletap",h,[g],{touch:g,duration:d});return}}if(a-this.startTime>f){this.fireSingleTap(h,g)}else{this.singleTapTimer=setTimeout(function(){k.fireSingleTap(h,g)},f)}},fireSingleTap:function(a,b){this.fire("singletap",a,[b],{touch:b})}});Ext.define("Ext.event.recognizer.Drag",{extend:Ext.event.recognizer.SingleTouch,isStarted:false,startPoint:null,previousPoint:null,lastPoint:null,handledEvents:["dragstart","drag","dragend"],config:{minDistance:8},constructor:function(){this.callSuper(arguments);this.info={touch:null,previous:{x:0,y:0},x:0,y:0,delta:{x:0,y:0},absDelta:{x:0,y:0},flick:{velocity:{x:0,y:0}},direction:{x:0,y:0},time:0,previousTime:{x:0,y:0}}},onTouchStart:function(a){if(this.callSuper(arguments)===false){if(this.isStarted&&this.lastMoveEvent!==null){this.lastMoveEvent.isStopped=false;this.onTouchEnd(this.lastMoveEvent)}return false}this.startTime=a.time;this.startPoint=a.changedTouches[0].point},tryDragStart:function(g){var b=this.startPoint,f=g.changedTouches,j=f[0],a=j.point,h=this.getMinDistance(),d=this.info;if(Math.abs(a.getDistanceTo(b))>=h){this.isStarted=true;this.previousPoint=this.lastPoint=a;this.resetInfo("x",g,j);this.resetInfo("y",g,j);d.time=g.time;this.fire("dragstart",g,f,d)}},onTouchMove:function(d){if(!this.isStarted){this.tryDragStart(d)}if(!this.isStarted){return}var b=d.changedTouches,f=b[0],a=f.point;if(this.lastPoint){this.previousPoint=this.lastPoint}this.lastPoint=a;this.lastMoveEvent=d;this.updateInfo("x",d,f,true);this.updateInfo("y",d,f,true);this.info.time=d.time;this.fire("drag",d,b,this.info)},onAxisDragEnd:function(a,d){var b=d.time-d.previousTime[a];if(b>0){d.flick.velocity[a]=(d[a]-d.previous[a])/b}},resetInfo:function(d,h,k){var f=this.lastPoint[d],b=this.startPoint[d],j=f-b,a=d.toUpperCase(),g=this.info;g.touch=k;g.delta[d]=j;g.absDelta[d]=Math.abs(j);g.previousTime[d]=this.startTime;g.previous[d]=b;g[d]=f;g.direction[d]=0;g["start"+a]=this.startPoint[d];g["previous"+a]=g.previous[d];g["page"+a]=g[d];g["delta"+a]=g.delta[d];g["absDelta"+a]=g.absDelta[d];g["previousDelta"+a]=0;g.startTime=this.startTime},updateInfo:function(g,m,l,n){var f=m.time,p=this.lastPoint[g],h=this.previousPoint[g],a=this.startPoint[g],q=p-a,d=this.info,o=d.direction,k=g.toUpperCase(),b=d.previous[g],j;d.touch=l;j=d.delta[g];d.delta[g]=q;d.absDelta[g]=Math.abs(q);if(n&&p!==b&&p!==d[g]&&f-d.previousTime[g]>=50){d.previous[g]=d[g];d.previousTime[g]=d.time}d[g]=p;if(p>h){o[g]=1}else{if(p<h){o[g]=-1}}d["start"+k]=this.startPoint[g];d["previous"+k]=d.previous[g];d["page"+k]=d[g];d["delta"+k]=d.delta[g];d["absDelta"+k]=d.absDelta[g];d["previousDelta"+k]=j;d.startTime=this.startTime},onTouchEnd:function(f){if(!this.isStarted){this.tryDragStart(f)}if(this.isStarted){var d=f.changedTouches,g=d[0],a=g.point,b=this.info;this.isStarted=false;this.lastPoint=a;this.updateInfo("x",f,g);this.updateInfo("y",f,g);b.time=f.time;this.onAxisDragEnd("x",b);this.onAxisDragEnd("y",b);this.fire("dragend",f,d,b);this.startPoint=null;this.previousPoint=null;this.lastPoint=null;this.lastMoveEvent=null}}});Ext.define("Ext.event.recognizer.Swipe",{extend:Ext.event.recognizer.SingleTouch,handledEvents:["swipestart","swipe"],inheritableStatics:{MAX_OFFSET_EXCEEDED:16,MAX_DURATION_EXCEEDED:17,DISTANCE_NOT_ENOUGH:18},config:{minDistance:80,maxOffset:35,maxDuration:1000},onTouchStart:function(a){if(this.callParent(arguments)===false){return false}var b=a.changedTouches[0];this.startTime=a.time;this.isHorizontal=true;this.isVertical=true;this.startX=b.pageX;this.startY=b.pageY},onTouchMove:function(l){var k=l.changedTouches[0],o=k.pageX,m=k.pageY,j=o-this.startX,h=m-this.startY,f=Math.abs(o-this.startX),d=Math.abs(m-this.startY),g=l.time-this.startTime,p=this.getMinDistance(),b=l.time,n,a;if(b-this.startTime>this.getMaxDuration()){return this.fail(this.self.MAX_DURATION_EXCEEDED)}if(this.isHorizontal&&d>this.getMaxOffset()){this.isHorizontal=false}if(this.isVertical&&f>this.getMaxOffset()){this.isVertical=false}if(!this.isVertical||!this.isHorizontal){if(this.isHorizontal&&f<p){n=(j<0)?"left":"right";a=f}else{if(this.isVertical&&d<p){n=(h<0)?"up":"down";a=d}}}if(n&&!this.started){this.started=true;this.fire("swipestart",l,[k],{touch:k,direction:n,distance:a,duration:g})}if(!this.isHorizontal&&!this.isVertical){return this.fail(this.self.MAX_OFFSET_EXCEEDED)}},onTouchEnd:function(k){if(this.onTouchMove(k)===false){return false}var j=k.changedTouches[0],n=j.pageX,l=j.pageY,h=n-this.startX,g=l-this.startY,d=Math.abs(h),b=Math.abs(g),o=this.getMinDistance(),f=k.time-this.startTime,m,a;if(this.isVertical&&b<o){this.isVertical=false}if(this.isHorizontal&&d<o){this.isHorizontal=false}if(this.isHorizontal){m=(h<0)?"left":"right";a=d}else{if(this.isVertical){m=(g<0)?"up":"down";a=b}else{return this.fail(this.self.DISTANCE_NOT_ENOUGH)}}this.started=false;this.fire("swipe",k,[j],{touch:j,direction:m,distance:a,duration:f})}});Ext.define("Ext.event.recognizer.EdgeSwipe",{extend:Ext.event.recognizer.Swipe,handledEvents:["edgeswipe","edgeswipestart","edgeswipeend"],inheritableStatics:{NOT_NEAR_EDGE:19},config:{minDistance:60},onTouchStart:function(a){if(this.callParent(arguments)===false){return false}var b=a.changedTouches[0];this.started=false;this.direction=null;this.isHorizontal=true;this.isVertical=true;this.startX=b.pageX;this.startY=b.pageY},onTouchMove:function(m){var k=m.changedTouches[0],q=k.pageX,n=k.pageY,j=q-this.startX,h=n-this.startY,b=Math.abs(n-this.startY),d=Math.abs(q-this.startX),r=this.getMinDistance(),g=this.getMaxOffset(),f=m.time-this.startTime,p=Ext.Viewport&&Ext.Viewport.element.getWidth(),l=Ext.Viewport&&Ext.Viewport.element.getHeight(),o,a;if(this.isVertical&&d>g){this.isVertical=false}if(this.isHorizontal&&b>g){this.isHorizontal=false}if(this.isVertical&&this.isHorizontal){if(b>d){this.isHorizontal=false}else{this.isVertical=false}}if(this.isHorizontal){o=(j<0)?"left":"right";a=j}else{if(this.isVertical){o=(h<0)?"up":"down";a=h}}this.direction=this.direction||o;if(this.direction=="up"){a=h*-1}else{if(this.direction=="left"){a=j*-1}}this.distance=a;if(a==0){return this.fail(this.self.DISTANCE_NOT_ENOUGH)}if(!this.started){if(this.direction=="right"&&this.startX>r){return this.fail(this.self.NOT_NEAR_EDGE)}else{if(this.direction=="down"&&this.startY>r){return this.fail(this.self.NOT_NEAR_EDGE)}else{if(this.direction=="left"&&(p-this.startX)>r){return this.fail(this.self.NOT_NEAR_EDGE)}else{if(this.direction=="up"&&(l-this.startY)>r){return this.fail(this.self.NOT_NEAR_EDGE)}}}}this.started=true;this.startTime=m.time;this.fire("edgeswipestart",m,[k],{touch:k,direction:this.direction,distance:this.distance,duration:f})}else{this.fire("edgeswipe",m,[k],{touch:k,direction:this.direction,distance:this.distance,duration:f})}},onTouchEnd:function(b){if(this.onTouchMove(b)!==false){var d=b.changedTouches[0],a=b.time-this.startTime;this.fire("edgeswipeend",b,[d],{touch:d,direction:this.direction,distance:this.distance,duration:a})}}});Ext.define("Ext.event.recognizer.LongPress",{extend:Ext.event.recognizer.SingleTouch,inheritableStatics:{DURATION_NOT_ENOUGH:32},config:{minDuration:1000},handledEvents:["longpress"],fireLongPress:function(a){var b=a.changedTouches[0];this.fire("longpress",a,[b],{touch:b,duration:this.getMinDuration()});this.isLongPress=true},onTouchStart:function(b){var a=this;if(this.callParent(arguments)===false){return false}this.isLongPress=false;this.timer=setTimeout(function(){a.fireLongPress(b)},this.getMinDuration())},onTouchMove:function(){return this.fail(this.self.TOUCH_MOVED)},onTouchEnd:function(){if(!this.isLongPress){return this.fail(this.self.DURATION_NOT_ENOUGH)}},fail:function(){clearTimeout(this.timer);return this.callParent(arguments)}},function(){this.override({handledEvents:["longpress","taphold"],fire:function(a){if(a==="longpress"){var b=Array.prototype.slice.call(arguments);b[0]="taphold";this.fire.apply(this,b)}return this.callOverridden(arguments)}})});Ext.define("Ext.event.recognizer.MultiTouch",{extend:Ext.event.recognizer.Touch,requiredTouchesCount:2,isTracking:false,isStarted:false,onTouchStart:function(f){var a=this.requiredTouchesCount,d=f.touches,b=d.length;if(b===a){this.start(f)}else{if(b>a){this.end(f)}}},onTouchEnd:function(a){this.end(a)},start:function(){if(!this.isTracking){this.isTracking=true;this.isStarted=false}},end:function(a){if(this.isTracking){this.isTracking=false;if(this.isStarted){this.isStarted=false;this.fireEnd(a)}}}});Ext.define("Ext.event.recognizer.Pinch",{extend:Ext.event.recognizer.MultiTouch,requiredTouchesCount:2,handledEvents:["pinchstart","pinch","pinchend"],startDistance:0,lastTouches:null,onTouchMove:function(d){if(!this.isTracking){return}var b=Array.prototype.slice.call(d.touches),f,a,g;f=b[0].point;a=b[1].point;g=f.getDistanceTo(a);if(g===0){return}if(!this.isStarted){this.isStarted=true;this.startDistance=g;this.fire("pinchstart",d,b,{touches:b,distance:g,scale:1})}else{this.fire("pinch",d,b,{touches:b,distance:g,scale:g/this.startDistance})}this.lastTouches=b},fireEnd:function(a){this.fire("pinchend",a,this.lastTouches)},fail:function(){return this.callParent(arguments)}});Ext.define("Ext.event.recognizer.Rotate",{extend:Ext.event.recognizer.MultiTouch,requiredTouchesCount:2,handledEvents:["rotatestart","rotate","rotateend"],startAngle:0,lastTouches:null,lastAngle:null,onTouchMove:function(j){if(!this.isTracking){return}var h=Array.prototype.slice.call(j.touches),b=this.lastAngle,f,g,d,a,k,l;f=h[0].point;g=h[1].point;d=f.getAngleTo(g);if(b!==null){l=Math.abs(b-d);a=d+360;k=d-360;if(Math.abs(a-b)<l){d=a}else{if(Math.abs(k-b)<l){d=k}}}this.lastAngle=d;if(!this.isStarted){this.isStarted=true;this.startAngle=d;this.fire("rotatestart",j,h,{touches:h,angle:d,rotation:0})}else{this.fire("rotate",j,h,{touches:h,angle:d,rotation:d-this.startAngle})}this.lastTouches=h},fireEnd:function(a){this.lastAngle=null;this.fire("rotateend",a,this.lastTouches)}});Ext.define("Ext.event.recognizer.Tap",{extend:Ext.event.recognizer.SingleTouch,handledEvents:["tap","tapcancel"],config:{moveDistance:8},onTouchStart:function(a){if(this.callSuper(arguments)===false){return false}this.startPoint=a.changedTouches[0].point},onTouchMove:function(b){var d=b.changedTouches[0],a=d.point;if(Math.abs(a.getDistanceTo(this.startPoint))>=this.getMoveDistance()){this.fire("tapcancel",b,[d],{touch:d});return this.fail(this.self.TOUCH_MOVED)}},onTouchEnd:function(a){var b=a.changedTouches[0];this.fire("tap",a,[b],{touch:b})}});Ext.define("Ext.field.Checkbox",{extend:Ext.field.Field,alternateClassName:"Ext.form.Checkbox",xtype:"checkboxfield",qsaLeftRe:/[\[]/g,qsaRightRe:/[\]]/g,isCheckbox:true,config:{ui:"checkbox",value:"",checked:false,tabIndex:-1,component:{xtype:"input",type:"checkbox",useMask:true,cls:Ext.baseCSSPrefix+"input-checkbox"}},platformConfig:[{theme:["Windows","Blackberry","Tizen"],labelAlign:"left"}],initialize:function(){var b=this,a=b.getComponent();b.callParent();a.on({scope:b,order:"before",masktap:"onMaskTap"});a.doMaskTap=Ext.emptyFn;b.label.on({scope:b,tap:"onMaskTap"})},doInitValue:function(){var a=this,b=a.getInitialConfig();if(b.hasOwnProperty("value")){a.originalState=b.value}if(b.hasOwnProperty("checked")){a.originalState=b.checked}a.callParent(arguments)},updateInputType:function(a){var b=this.getComponent();if(b){b.setType(a)}},updateName:function(a){var b=this.getComponent();if(b){b.setName(a)}},getChecked:function(){this._checked=this.getComponent().getChecked();return this._checked},getSubmitValue:function(){return(this.getChecked())?Ext.isEmpty(this._value)?true:this._value:null},setChecked:function(a){this.updateChecked(a);this._checked=a},updateChecked:function(a){this.getComponent().setChecked(a);if(this.initialized){this.onChange()}},onMaskTap:function(a,d){var b=this,f=b.getComponent().input.dom;if(b.getDisabled()){return false}f.checked=!f.checked;b.onChange(d);return false},onChange:function(f){var d=this,b=d._checked,a=d.getChecked();if(b!=a){if(a){d.fireEvent("check",d,f)}else{d.fireEvent("uncheck",d,f)}d.fireEvent("change",d,a,b)}},doChecked:Ext.emptyFn,doUnChecked:Ext.emptyFn,isChecked:function(){return this.getChecked()},check:function(){return this.setChecked(true)},uncheck:function(){return this.setChecked(false)},getSameGroupFields:function(){var l=this,m=l.up("formpanel")||l.up("fieldset"),b=l.getName(),j=l.qsaLeftRe,d=l.qsaRightRe,g=l.getBaseCls().split(" ").join("."),h=[],a,f,e,k;if(!m){m=Ext.Viewport}b=b.replace(j,"\\[");b=b.replace(d,"\\]");a=Ext.query("[name="+b+"]",m.element.dom);k=a.length;for(e=0;e<k;e++){f=a[e];f=Ext.fly(f).up("."+g);if(f&&f.id){h.push(Ext.getCmp(f.id))}}return h},getGroupValues:function(){var a=[];this.getSameGroupFields().forEach(function(b){if(b.getChecked()){a.push(b.getValue())}});return a},setGroupValues:function(a){this.getSameGroupFields().forEach(function(b){b.setChecked((a.indexOf(b.getValue())!==-1))});return this},resetGroupValues:function(){this.getSameGroupFields().forEach(function(a){a.setChecked(a.originalState)});return this},reset:function(){this.setChecked(this.originalState);return this}});Ext.define("Ext.picker.Slot",{extend:Ext.dataview.DataView,xtype:"pickerslot",alternateClassName:"Ext.Picker.Slot",isSlot:true,config:{title:null,showTitle:true,cls:Ext.baseCSSPrefix+"picker-slot",name:null,value:null,flex:1,align:"left",displayField:"text",valueField:"value",itemTpl:null,scrollable:{direction:"vertical",indicators:false,momentumEasing:{minVelocity:2},slotSnapEasing:{duration:100}},verticallyCenterItems:true},platformConfig:[{theme:["Windows"],title:"choose an item"}],constructor:function(){this.selectedIndex=0;this.callParent(arguments)},applyTitle:function(a){if(a){a=Ext.create("Ext.Component",{cls:Ext.baseCSSPrefix+"picker-slot-title",docked:"top",html:a})}return a},updateTitle:function(b,a){if(b){this.add(b);this.setupBar()}if(a){this.remove(a)}},updateShowTitle:function(a){var d=this.getTitle(),b=a?"show":"hide";if(d){d.on(b,this.setupBar,this,{single:true,delay:50});d[a?"show":"hide"]()}},updateDisplayField:function(a){if(!this.config.itemTpl){this.setItemTpl('<div class="'+Ext.baseCSSPrefix+'picker-item {cls} <tpl if="extra">'+Ext.baseCSSPrefix+'picker-invalid</tpl>">{'+a+"}</div>")}},updateAlign:function(a,d){var b=this.element;b.addCls(Ext.baseCSSPrefix+"picker-"+a);b.removeCls(Ext.baseCSSPrefix+"picker-"+d)},applyData:function(e){var g=[],d=e&&e.length,a,b,f;if(e&&Ext.isArray(e)&&d){for(a=0;a<d;a++){b=e[a];f={};if(Ext.isArray(b)){f[this.valueField]=b[0];f[this.displayField]=b[1]}else{if(Ext.isString(b)){f[this.valueField]=b;f[this.displayField]=b}else{if(Ext.isObject(b)){f=b}}}g.push(f)}}return e},initialize:function(){this.callParent();var a=this.getScrollable().getScroller();this.on({scope:this,painted:"onPainted",itemtap:"doItemTap"});this.element.on({scope:this,touchstart:"onTouchStart",touchend:"onTouchEnd"});a.on({scope:this,scrollend:"onScrollEnd"})},onPainted:function(){this.setupBar()},getPicker:function(){if(!this.picker){this.picker=this.getParent()}return this.picker},setupBar:function(){if(!this.rendered){return}var a=this.element,f=this.innerElement,g=this.getPicker(),h=g.bar,m=this.getValue(),b=this.getShowTitle(),l=this.getTitle(),j=this.getScrollable(),e=j.getScroller(),d=0,n,k;n=h.dom.getBoundingClientRect().height;if(b&&l){d=l.element.getHeight()}k=Math.ceil((a.getHeight()-d-n)/2);if(this.getVerticallyCenterItems()){f.setStyle({padding:k+"px 0 "+k+"px"})}e.refresh();e.setSlotSnapSize(n);this.setValue(m)},doItemTap:function(f,a,d,g){var b=this;b.selectedIndex=a;b.selectedNode=d;b.scrollToItem(d,true)},scrollToItem:function(f,e){var j=f.getY(),d=f.parent(),g=d.getY(),b=this.getScrollable(),a=b.getScroller(),h;h=j-g;a.scrollTo(0,h,e)},onTouchStart:function(){this.element.addCls(Ext.baseCSSPrefix+"scrolling")},onTouchEnd:function(){this.element.removeCls(Ext.baseCSSPrefix+"scrolling")},onScrollEnd:function(b,a,h){var g=this,e=Math.round(h/g.picker.bar.dom.getBoundingClientRect().height),d=g.getViewItems(),f=d[e];if(f){g.selectedIndex=e;g.selectedNode=f;g.fireEvent("slotpick",g,g.getValue(),g.selectedNode)}},getValue:function(d){var b=this.getStore(),a,e;if(!b){return}if(!this.rendered||!d){return this._value}if(this._value===false){return null}a=b.getAt(this.selectedIndex);e=a?a.get(this.getValueField()):null;return e},setValue:function(a){return this.doSetValue(a)},setValueAnimated:function(a){return this.doSetValue(a,true)},doSetValue:function(h,g){if(!this.rendered){this._value=h;return}var b=this.getStore(),a=this.getViewItems(),e=this.getValueField(),d,f;d=b.findExact(e,h);if(d==-1){d=0}f=Ext.get(a[d]);this.selectedIndex=d;if(f){this.scrollToItem(f,(g)?{duration:100}:false);this.select(this.selectedIndex)}this._value=h}});Ext.define("Ext.picker.Picker",{extend:Ext.Sheet,alias:"widget.picker",alternateClassName:"Ext.Picker",isPicker:true,config:{baseCls:Ext.baseCSSPrefix+"picker",doneButton:true,cancelButton:true,todayButton:true,useTitles:false,slots:null,value:null,height:220,layout:{type:"hbox",align:"stretch"},centered:false,left:0,right:0,bottom:0,defaultType:"pickerslot",toolbarPosition:"top",toolbar:{xtype:"titlebar"}},platformConfig:[{theme:["Windows"],height:"100%",toolbarPosition:"bottom",toolbar:{xtype:"toolbar",layout:{type:"hbox",pack:"center"}},doneButton:{iconCls:"check2",ui:"round",text:""},cancelButton:{iconCls:"delete",ui:"round",text:""},todayButton:{iconCls:"check2",ui:"decline",text:""}},{theme:["CupertinoClassic"],toolbar:{ui:"black"}},{theme:["MountainView"],toolbarPosition:"bottom",toolbar:{defaults:{flex:1}}}],initialize:function(){var b=this,a=Ext.baseCSSPrefix,d=this.innerElement;this.mask=d.createChild({cls:a+"picker-mask"});this.bar=this.mask.createChild({cls:a+"picker-bar"});b.on({scope:this,delegate:"pickerslot",slotpick:"onSlotPick"})},applyToolbar:function(a){if(a===true){a={}}Ext.applyIf(a,{docked:this.getToolbarPosition()});return Ext.factory(a,"Ext.TitleBar",this.getToolbar())},updateToolbar:function(a,b){if(a){this.add(a)}if(b){this.remove(b)}},applyDoneButton:function(a){if(a){if(Ext.isBoolean(a)){a={}}if(typeof a=="string"){a={text:a}}Ext.applyIf(a,{ui:"action",align:"right",text:"Done"})}return Ext.factory(a,"Ext.Button",this.getDoneButton())},updateDoneButton:function(d,a){var b=this.getToolbar();if(d){b.add(d);d.on("tap",this.onDoneButtonTap,this)}else{if(a){b.remove(a)}}},applyCancelButton:function(a){if(a){if(Ext.isBoolean(a)){a={}}if(typeof a=="string"){a={text:a}}Ext.applyIf(a,{align:"left",text:"Cancel"})}return Ext.factory(a,"Ext.Button",this.getCancelButton())},updateCancelButton:function(b,a){var d=this.getToolbar();if(b){d.add(b);b.on("tap",this.onCancelButtonTap,this)}else{if(a){d.remove(a)}}},applyTodayButton:function(a){if(a){if(Ext.isBoolean(a)){a={}}if(typeof a=="string"){a={text:a}}Ext.applyIf(a,{ui:"decline",align:"left",text:"Today"})}return Ext.factory(a,"Ext.Button",this.getTodayButton())},updateTodayButton:function(a,b){var d=this.getToolbar();if(a){d.add(a);a.on("tap",this.onTodayButtonTap,this)}else{if(b){d.remove(b)}}},updateUseTitles:function(e){var g=this.getInnerItems(),f=g.length,a=Ext.baseCSSPrefix+"use-titles",d,b;if(e){this.addCls(a)}else{this.removeCls(a)}for(d=0;d<f;d++){b=g[d];if(b.isSlot){b.setShowTitle(e)}}},applySlots:function(b){if(b){var d=b.length,a;for(a=0;a<d;a++){b[a].picker=this}}return b},updateSlots:function(a){var b=Ext.baseCSSPrefix,d;this.removeAll();if(a){this.add(a)}d=this.getInnerItems();if(d.length>0){d[0].addCls(b+"first");d[d.length-1].addCls(b+"last")}this.updateUseTitles(this.getUseTitles())},onDoneButtonTap:function(){var a=this._value,b=this.getValue(true);if(b!=a){this.fireEvent("change",this,b)}this.hide();Ext.util.InputBlocker.unblockInputs()},onCancelButtonTap:function(){this.fireEvent("cancel",this);this.hide();Ext.util.InputBlocker.unblockInputs()},onTodayButtonTap:function(){var a=new Date();var b=new Object;b.day=a.getDate();b.month=a.getMonth()+1;b.year=a.getFullYear();this.setValue(b);Ext.util.InputBlocker.unblockInputs()},onSlotPick:function(a){this.fireEvent("pick",this,this.getValue(true),a)},show:function(){if(this.getParent()===undefined){Ext.Viewport.add(this)}this.callParent(arguments);if(!this.isHidden()){this.setValue(this._value)}Ext.util.InputBlocker.blockInputs()},setValue:function(l,a){var g=this,e=g.getInnerItems(),f=e.length,k,j,d,b,h;if(!l){l={};for(b=0;b<f;b++){l[e[b].config.name]=null}}for(k in l){j=null;h=l[k];for(b=0;b<e.length;b++){d=e[b];if(d.config.name==k){j=d;break}}if(j){if(a){j.setValueAnimated(h)}else{j.setValue(h)}}}g._values=g._value=l;return g},setValueAnimated:function(a){this.setValue(a,true)},getValue:function(d){var b={},a=this.getItems().items,g=a.length,f,e;if(d){for(e=0;e<g;e++){f=a[e];if(f&&f.isSlot){b[f.getName()]=f.getValue(d)}}this._values=b}return this._values},getValues:function(){return this.getValue()},destroy:function(){this.callParent();Ext.destroy(this.mask,this.bar)}},function(){});Ext.define("Ext.field.Select",{extend:Ext.field.Text,xtype:"selectfield",alternateClassName:"Ext.form.Select",config:{ui:"select",valueField:"value",displayField:"text",store:null,options:null,hiddenName:null,component:{useMask:true},clearIcon:false,usePicker:"auto",autoSelect:true,defaultPhonePickerConfig:null,defaultTabletPickerConfig:null,name:"picker",pickerSlotAlign:"center"},platformConfig:[{theme:["Windows"],pickerSlotAlign:"left"},{theme:["Tizen"],usePicker:false}],initialize:function(){var b=this,a=b.getComponent();b.callParent();a.on({scope:b,masktap:"onMaskTap"});a.doMaskTap=Ext.emptyFn;if(Ext.browser.is.AndroidStock2){a.input.dom.disabled=true}if(Ext.theme.is.Blackberry){this.label.on({scope:b,tap:"onFocus"})}},getElementConfig:function(){if(Ext.theme.is.Blackberry){var a=Ext.baseCSSPrefix;return{reference:"element",className:"x-container",children:[{reference:"innerElement",cls:a+"component-outer",children:[{reference:"label",cls:a+"form-label",children:[{reference:"labelspan",tag:"span"}]}]}]}}else{return this.callParent(arguments)}},updateDefaultPhonePickerConfig:function(b){var a=this.picker;if(a){a.setConfig(b)}},updateDefaultTabletPickerConfig:function(a){var b=this.listPanel;if(b){b.setConfig(a)}},applyUsePicker:function(a){if(a=="auto"){a=(Ext.os.deviceType=="Phone")}return Boolean(a)},syncEmptyCls:Ext.emptyFn,applyValue:function(e){var a=e,d,b;this.getOptions();b=this.getStore();if((e!=undefined&&!e.isModel)&&b){d=b.find(this.getValueField(),e,null,null,null,true);if(d==-1){d=b.find(this.getDisplayField(),e,null,null,null,true)}a=b.getAt(d)}return a},updateValue:function(b,a){this.record=b;this.callParent([(b&&b.isModel)?b.get(this.getDisplayField()):""])},getValue:function(){var a=this.record;return(a&&a.isModel)?a.get(this.getValueField()):null},getRecord:function(){return this.record},getPhonePicker:function(){var a=this.getDefaultPhonePickerConfig();if(!this.picker){this.picker=Ext.create("Ext.picker.Picker",Ext.apply({slots:[{align:this.getPickerSlotAlign(),name:this.getName(),valueField:this.getValueField(),displayField:this.getDisplayField(),value:this.getValue(),store:this.getStore()}],listeners:{change:this.onPickerChange,scope:this}},a))}return this.picker},getTabletPicker:function(){var a=this.getDefaultTabletPickerConfig();if(!this.listPanel){this.listPanel=Ext.create("Ext.Panel",Ext.apply({left:0,top:0,modal:true,cls:Ext.baseCSSPrefix+"select-overlay",layout:"fit",hideOnMaskTap:true,width:Ext.os.is.Phone?"14em":"18em",height:(Ext.os.is.BlackBerry&&Ext.os.version.getMajor()===10)?"12em":(Ext.os.is.Phone?"12.5em":"22em"),items:{xtype:"list",store:this.getStore(),itemTpl:'<span class="x-list-label">{'+this.getDisplayField()+":htmlEncode}</span>",listeners:{select:this.onListSelect,itemtap:this.onListTap,scope:this}}},a))}return this.listPanel},onMaskTap:function(){this.onFocus();return false},showPicker:function(){var g=this,l=g.getStore(),k=g.getValue();if(!l||l.getCount()===0){return}if(g.getReadOnly()){return}g.isFocused=true;if(g.getUsePicker()){var e=g.getPhonePicker(),a=g.getName(),j={};j[a]=k;e.setValue(j);if(!e.getParent()){Ext.Viewport.add(e)}e.show()}else{var h=g.getTabletPicker(),f=h.down("list"),d,b;if(!h.getParent()){Ext.Viewport.add(h)}h.showBy(g.getComponent(),null);if(k||g.getAutoSelect()){l=f.getStore();d=l.find(g.getValueField(),k,null,null,null,true);b=l.getAt(d);if(b){f.select(b,null,true)}}}},onListSelect:function(d,a){var b=this;if(a){b.setValue(a)}},onListTap:function(){this.listPanel.hide({type:"fade",out:true,scope:this})},onPickerChange:function(e,g){var f=this,h=g[f.getName()],b=f.getStore(),d=b.find(f.getValueField(),h,null,null,null,true),a=b.getAt(d);f.setValue(a)},onChange:function(g,j,f){var h=this,b=h.getStore(),e=(b)?b.find(h.getDisplayField(),f,null,null,null,true):-1,d=h.getValueField(),a=(b)?b.getAt(e):null;f=(a)?a.get(d):null;h.fireEvent("change",h,h.getValue(),f)},updateOptions:function(b){var a=this.getStore();if(!a){this.setStore(true);a=this._store}if(!b){a.clearData()}else{a.setData(b);this.onStoreDataChanged(a)}return this},applyStore:function(a){if(a===true){a=Ext.create("Ext.data.Store",{fields:[this.getValueField(),this.getDisplayField()],autoDestroy:true})}if(a){a=Ext.data.StoreManager.lookup(a);a.on({scope:this,addrecords:"onStoreDataChanged",removerecords:"onStoreDataChanged",updaterecord:"onStoreDataChanged",refresh:"onStoreDataChanged"})}return a},updateStore:function(a){if(a){this.onStoreDataChanged(a)}if(this.getUsePicker()&&this.picker){this.picker.down("pickerslot").setStore(a)}else{if(this.listPanel){this.listPanel.down("dataview").setStore(a)}}},onStoreDataChanged:function(a){var d=this.getInitialConfig(),b=this.getValue();if(b||b==0){this.updateValue(this.applyValue(b))}if(this.getValue()===null){if(d.hasOwnProperty("value")){this.setValue(d.value)}if(this.getValue()===null&&this.getAutoSelect()){if(a.getCount()>0){this.setValue(a.getAt(0))}}}},doSetDisabled:function(b){var a=this.getComponent();if(a){a.setDisabled(b)}Ext.Component.prototype.doSetDisabled.apply(this,arguments)},setDisabled:function(){Ext.Component.prototype.setDisabled.apply(this,arguments)},updateLabelWidth:function(){if(Ext.theme.is.Blackberry){return}else{this.callParent(arguments)}},updateLabelAlign:function(){if(Ext.theme.is.Blackberry){return}else{this.callParent(arguments)}},reset:function(){var b=this.getStore(),a=(this.originalValue)?this.originalValue:b.getAt(0);if(b&&a){this.setValue(a)}return this},onFocus:function(b){if(this.getDisabled()){return false}var a=this.getComponent();this.fireEvent("focus",this,b);if(Ext.os.is.Android4){a.input.dom.focus()}a.input.dom.blur();this.isFocused=true;this.showPicker()},destroy:function(){this.callParent(arguments);var a=this.getStore();if(a&&a.getAutoDestroy()){Ext.destroy(a)}Ext.destroy(this.listPanel,this.picker)}});Ext.define("Ext.picker.Date",{extend:Ext.picker.Picker,xtype:"datepicker",alternateClassName:"Ext.DatePicker",config:{yearFrom:1980,yearTo:new Date().getFullYear(),monthText:"Month",dayText:"Day",yearText:"Year",slotOrder:["month","day","year"],doneButton:true},platformConfig:[{theme:["Windows"],doneButton:{iconCls:"check2",ui:"round",text:""}}],initialize:function(){this.callParent();this.on({scope:this,delegate:"> slot",slotpick:this.onSlotPick});this.on({scope:this,show:this.onSlotPick})},setValue:function(b,a){if(Ext.isDate(b)){b={day:b.getDate(),month:b.getMonth()+1,year:b.getFullYear()}}this.callParent([b,a]);this.onSlotPick()},getValue:function(l){var j={},f=this.getItems().items,e=f.length,a,h,d,g,k,b;for(b=0;b<e;b++){k=f[b];if(k instanceof Ext.picker.Slot){j[k.getName()]=k.getValue(l)}}if(j.year===null&&j.month===null&&j.day===null){return null}g=Ext.isNumber(j.year)?j.year:1;d=Ext.isNumber(j.month)?j.month:1;h=Ext.isNumber(j.day)?j.day:1;if(d&&g&&d&&h){a=this.getDaysInMonth(d,g)}h=(a)?Math.min(h,a):h;return new Date(g,d-1,h)},updateYearFrom:function(){if(this.initialized){this.createSlots()}},updateYearTo:function(){if(this.initialized){this.createSlots()}},updateMonthText:function(a,b){var g=this.getInnerItems,f=g.length,e,d;if(this.initialized){for(d=0;d<f;d++){e=g[d];if((typeof e.title=="string"&&e.title==b)||(e.title.html==b)){e.setTitle(a)}}}},updateDayText:function(a,d){var g=this.getInnerItems,f=g.length,e,b;if(this.initialized){for(b=0;b<f;b++){e=g[b];if((typeof e.title=="string"&&e.title==d)||(e.title.html==d)){e.setTitle(a)}}}},updateYearText:function(f){var e=this.getInnerItems,d=e.length,b,a;if(this.initialized){for(a=0;a<d;a++){b=e[a];if(b.title==this.yearText){b.setTitle(f)}}}},constructor:function(){this.callParent(arguments);this.createSlots()},createSlots:function(){var l=this,d=l.getSlotOrder(),n=l.getYearFrom(),f=l.getYearTo(),g=[],m=[],b=[],j=n>f,k,e,a;while(n){g.push({text:n,value:n});if(n===f){break}if(j){n--}else{n++}}a=l.getDaysInMonth(1,new Date().getFullYear());for(e=0;e<a;e++){m.push({text:e+1,value:e+1})}for(e=0,k=Ext.Date.monthNames.length;e<k;e++){b.push({text:Ext.Date.monthNames[e],value:e+1})}var h=[];d.forEach(function(o){h.push(l.createSlot(o,m,b,g))});l.setSlots(h)},createSlot:function(b,e,a,d){switch(b){case"year":return{name:"year",align:"center",data:d,title:this.getYearText(),flex:3};case"month":return{name:b,align:"right",data:a,title:this.getMonthText(),flex:4};case"day":return{name:"day",align:"center",data:e,title:this.getDayText(),flex:2}}},onSlotPick:function(){var h=this.getValue(true),g=this.getDaySlot(),f=h.getFullYear(),e=h.getMonth(),k=[],a,b;if(!h||!Ext.isDate(h)||!g){return}this.callParent(arguments);a=this.getDaysInMonth(e+1,f);for(b=0;b<a;b++){k.push({text:b+1,value:b+1})}if(g.getStore().getCount()==k.length){return}g.getStore().setData(k);var j=g.getStore(),n=g.getViewItems(),m=g.getValueField(),d,l;d=j.find(m,h.getDate());if(d==-1){return}l=Ext.get(n[d]);g.selectedIndex=d;g.scrollToItem(l);g.setValue(g.getValue(true))},getDaySlot:function(){var d=this.getInnerItems(),b=d.length,a,e;if(this.daySlot){return this.daySlot}for(a=0;a<b;a++){e=d[a];if(e.isSlot&&e.getName()=="day"){this.daySlot=e;return e}}return null},getDaysInMonth:function(d,b){var a=[31,28,31,30,31,30,31,31,30,31,30,31];return d==2&&this.isLeapYear(b)?29:a[d-1]},isLeapYear:function(a){return !!((a&3)===0&&(a%100||(a%400===0&&a)))},onDoneButtonTap:function(){var a=this._value,d=this.getValue(true),b=d;if(Ext.isDate(d)){b=d.toDateString()}if(Ext.isDate(a)){a=a.toDateString()}if(b!=a){this.fireEvent("change",this,d)}this.hide();Ext.util.InputBlocker.unblockInputs()}});Ext.define("Ext.field.DatePicker",{extend:Ext.field.Select,alternateClassName:"Ext.form.DatePicker",xtype:"datepickerfield",config:{ui:"select",picker:true,clearIcon:false,destroyPickerOnHide:false,dateFormat:null,component:{useMask:true}},initialize:function(){var b=this,a=b.getComponent();b.callParent();a.on({scope:b,masktap:"onMaskTap"});a.doMaskTap=Ext.emptyFn;if(Ext.browser.is.AndroidStock2){a.input.dom.disabled=true}},syncEmptyCls:Ext.emptyFn,applyValue:function(a){if(!Ext.isDate(a)&&!Ext.isObject(a)){return null}if(Ext.isObject(a)){return new Date(a.year,a.month-1,a.day)}return a},updateValue:function(e,b){var d=this,a=d._picker;if(a&&a.isPicker){a.setValue(e)}if(e!==null){d.getComponent().setValue(Ext.Date.format(e,d.getDateFormat()||Ext.util.Format.defaultDateFormat))}else{d.getComponent().setValue("")}if(e!==b){d.fireEvent("change",d,e,b)}},updateDateFormat:function(d,a){var b=this.getValue();if(d!=a&&Ext.isDate(b)){this.getComponent().setValue(Ext.Date.format(b,d||Ext.util.Format.defaultDateFormat))}},getValue:function(){if(this._picker&&this._picker instanceof Ext.picker.Date){return this._picker.getValue()}return this._value},getFormattedValue:function(b){var a=this.getValue();return(Ext.isDate(a))?Ext.Date.format(a,b||this.getDateFormat()||Ext.util.Format.defaultDateFormat):a},applyPicker:function(b,a){if(a&&a.isPicker){b=a.setConfig(b)}return b},getPicker:function(){var a=this._picker,b=this.getValue();if(a&&!a.isPicker){a=Ext.factory(a,Ext.picker.Date);if(b!=null){a.setValue(b)}}a.on({scope:this,change:"onPickerChange",hide:"onPickerHide"});this._picker=a;return a},onMaskTap:function(){if(this.getDisabled()){return false}this.onFocus();return false},onPickerChange:function(b,e){var d=this,a=d.getValue();d.setValue(e);d.fireEvent("select",d,e);d.onChange(d,e,a)},onChange:Ext.emptyFn,onPickerHide:function(){var b=this,a=b.getPicker();if(b.getDestroyPickerOnHide()&&a){a.destroy();b._picker=b.getInitialConfig().picker||true}},reset:function(){this.setValue(this.originalValue)},onFocus:function(b){var a=this.getComponent();this.fireEvent("focus",this,b);if(Ext.os.is.Android4){a.input.dom.focus()}a.input.dom.blur();if(this.getReadOnly()){return false}this.isFocused=true;this.getPicker().show()},destroy:function(){var a=this._picker;if(a&&a.isPicker){a.destroy()}this.callParent(arguments)}});Ext.define("Ext.field.FileInput",{extend:Ext.field.Input,xtype:"fileinput",config:{type:"file",accept:null,capture:null,name:null,multiple:false},captureLookup:{video:"camcorder",image:"camera",audio:"microphone"},initialize:function(){var a=this;a.callParent();a.input.on({scope:a,change:"onInputChange"})},getValue:function(){var a=this.input;if(a){this._value=a.dom.value}return this._value},setValue:function(b){var a=this._value;this._value=b;if(String(this._value)!=String(a)&&this.initialized){this.onChange(this,this._value,a)}return this},getFiles:function(){var a=this.input;if(a){this.$files=a.dom.files}return this.$files},onInputChange:function(a){this.setValue(a.target.value)},onChange:function(b,d,a){this.fireEvent("change",b,d,a)},applyName:function(a){if(this.getMultiple()&&a.substr(-2,2)!=="[]"){a+="[]"}else{if((!this.getMultiple())&&a.substr(-2,2)==="[]"){a=a.substr(0,a.length-2)}}return a},applyMultiple:function(a){this.updateFieldAttribute("multiple",a?"":null);return a},updateMultiple:function(){var a=this.getName();if(!Ext.isEmpty(a)){this.setName(a)}},applyAccept:function(a){switch(a){case"video":case"audio":case"image":a=a+"/*";break}this.updateFieldAttribute("accept",a)},applyCapture:function(a){this.updateFieldAttribute("capture",a);return a}});Ext.define("Ext.field.File",{extend:Ext.field.Field,xtype:"filefield",config:{component:{xtype:"fileinput",fastFocus:false}},proxyConfig:{name:null,value:null,files:null,multiple:false,accept:null,capture:null},isFile:true,initialize:function(){var a=this;a.callParent();a.getComponent().on({scope:this,change:"onChange"})},onChange:function(b,d,a){b.fireEvent("change",this,d,a)}});Ext.define("Ext.field.Hidden",{extend:Ext.field.Text,alternateClassName:"Ext.form.Hidden",xtype:"hiddenfield",config:{component:{xtype:"input",type:"hidden"},ui:"hidden",hidden:true,tabIndex:-1}});Ext.define("Ext.field.Number",{extend:Ext.field.Text,xtype:"numberfield",alternateClassName:"Ext.form.Number",config:{component:{type:"number"},ui:"number"},proxyConfig:{minValue:null,maxValue:null,stepValue:null},applyPlaceHolder:function(a){this._enableNumericPlaceHolderHack=((!Ext.feature.has.NumericInputPlaceHolder)&&(!Ext.isEmpty(a)));return a},onFocus:function(a){if(this._enableNumericPlaceHolderHack){this.getComponent().input.dom.setAttribute("type","number")}this.callParent(arguments)},onBlur:function(a){if(this._enableNumericPlaceHolderHack){this.getComponent().input.dom.setAttribute("type","text")}this.callParent(arguments)},doInitValue:function(){var a=this.getInitialConfig().value;if(a){a=this.applyValue(a)}this.originalValue=a},applyValue:function(b){var a=this.getMinValue(),d=this.getMaxValue();if(Ext.isNumber(a)&&Ext.isNumber(b)){b=Math.max(b,a)}if(Ext.isNumber(d)&&Ext.isNumber(b)){b=Math.min(b,d)}b=parseFloat(b);return(isNaN(b))?"":b},getValue:function(){var a=parseFloat(this.callParent(),10);return(isNaN(a))?null:a},doClearIconTap:function(a,b){a.getComponent().setValue("");a.getValue();a.hideClearIcon()}});Ext.define("Ext.field.Password",{extend:Ext.field.Text,xtype:"passwordfield",alternateClassName:"Ext.form.Password",config:{autoCapitalize:false,component:{type:"password"}}});Ext.define("Ext.field.Radio",{extend:Ext.field.Checkbox,xtype:"radiofield",alternateClassName:"Ext.form.Radio",isRadio:true,config:{ui:"radio",component:{type:"radio",cls:Ext.baseCSSPrefix+"input-radio"}},getValue:function(){return(typeof this._value==="undefined")?null:this._value},setValue:function(a){this._value=a;return this},getSubmitValue:function(){var a=this._value;if(typeof a=="undefined"||a==null){a=true}return(this.getChecked())?a:null},updateChecked:function(a){this.getComponent().setChecked(a);if(this.initialized){this.refreshGroupValues()}},onMaskTap:function(a,d){var b=this,f=b.getComponent().input.dom;if(b.getDisabled()){return false}if(!b.getChecked()){f.checked=true}b.refreshGroupValues();return false},getGroupValue:function(){var a=this.getSameGroupFields(),d=a.length,b=0,e;for(;b<d;b++){e=a[b];if(e.getChecked()){return e.getValue()}}return null},setGroupValue:function(e){var a=this.getSameGroupFields(),d=a.length,b=0,f;for(;b<d;b++){f=a[b];if(f.getValue()===e){f.setChecked(true);return f}}},refreshGroupValues:function(){var a=this.getSameGroupFields(),d=a.length,b=0,e;for(;b<d;b++){e=a[b];e.onChange()}}});Ext.define("Ext.field.Search",{extend:Ext.field.Text,xtype:"searchfield",alternateClassName:"Ext.form.Search",config:{component:{type:"search"},ui:"search"},platformConfig:[{platform:"blackberry",component:{type:"text"}}]});Ext.define("Ext.slider.Thumb",{extend:Ext.Component,xtype:"thumb",config:{baseCls:Ext.baseCSSPrefix+"thumb",draggable:{direction:"horizontal"}},platformConfig:[{platform:["ie10"],draggable:{translatable:{translationMethod:"csstransform"}}}],elementWidth:0,initialize:function(){this.callParent();this.getDraggable().onBefore({dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",scope:this});this.element.on("resize","onElementResize",this)},onDragStart:function(){if(this.isDisabled()){return false}this.relayEvent(arguments)},onDrag:function(){if(this.isDisabled()){return false}this.relayEvent(arguments)},onDragEnd:function(){if(this.isDisabled()){return false}this.relayEvent(arguments)},onElementResize:function(a,b){this.elementWidth=b.width},getElementWidth:function(){return this.elementWidth}});Ext.define("Ext.slider.Slider",{extend:Ext.Container,xtype:"slider",config:{baseCls:"x-slider",thumbConfig:{draggable:{translatable:{easingX:{duration:300,type:"ease-out"}}}},increment:1,value:0,minValue:0,maxValue:100,allowThumbsOverlapping:false,animation:true,readOnly:false},elementWidth:0,offsetValueRatio:0,activeThumb:null,constructor:function(a){a=a||{};if(a.hasOwnProperty("values")){a.value=a.values}this.callParent([a])},initialize:function(){var b=this.element;this.callParent();b.on({scope:this,tap:"onTap",resize:"onResize"});this.on({scope:this,delegate:"> thumb",tap:"onTap",dragstart:"onThumbDragStart",drag:"onThumbDrag",dragend:"onThumbDragEnd"});var a=this.getThumb(0);if(a){a.on("resize","onThumbResize",this)}},factoryThumb:function(){return Ext.factory(this.getThumbConfig(),Ext.slider.Thumb)},getThumbs:function(){return this.innerItems},getThumb:function(a){if(typeof a!="number"){a=0}return this.innerItems[a]},refreshOffsetValueRatio:function(){var b=this.getMaxValue()-this.getMinValue(),a=this.elementWidth-this.thumbWidth;this.offsetValueRatio=a/b},onThumbResize:function(){var a=this.getThumb(0);if(a){this.thumbWidth=a.getElementWidth()}this.refresh()},onResize:function(a,b){this.elementWidth=b.width;this.refresh()},refresh:function(){this.refreshValue()},setActiveThumb:function(b){var a=this.activeThumb;if(a&&a!==b){a.setZIndex(null)}this.activeThumb=b;b.setZIndex(2);return this},onThumbDragStart:function(a,b){if(b.absDeltaX<=b.absDeltaY||this.getReadOnly()){return false}else{b.stopPropagation()}if(this.getAllowThumbsOverlapping()){this.setActiveThumb(a)}this.dragStartValue=this.getValue()[this.getThumbIndex(a)];this.fireEvent("dragstart",this,a,this.dragStartValue,b)},onThumbDrag:function(d,h,a){var f=this.getThumbIndex(d),g=this.offsetValueRatio,b=this.constrainValue(this.getMinValue()+a/g);h.stopPropagation();this.setIndexValue(f,b);this.fireEvent("drag",this,d,this.getValue(),h);return false},setIndexValue:function(e,g,b){var a=this.getThumb(e),j=this.getValue(),f=this.getMinValue(),d=this.offsetValueRatio,h=this.getIncrement(),k=a.getDraggable();k.setOffset((g-f)*d,null,b);j[e]=f+Math.round((k.offset.x/d)/h)*h},onThumbDragEnd:function(a,g){this.refreshThumbConstraints(a);var d=this.getThumbIndex(a),f=this.getValue()[d],b=this.dragStartValue;this.fireEvent("dragend",this,a,this.getValue(),g);if(b!==f){this.fireEvent("change",this,a,f,b)}},getThumbIndex:function(a){return this.getThumbs().indexOf(a)},refreshThumbConstraints:function(e){var b=this.getAllowThumbsOverlapping(),a=e.getDraggable().getOffset().x,d=this.getThumbs(),f=this.getThumbIndex(e),h=d[f-1],j=d[f+1],g=this.thumbWidth;if(h){h.getDraggable().addExtraConstraint({max:{x:a-((b)?0:g)}})}if(j){j.getDraggable().addExtraConstraint({min:{x:a+((b)?0:g)}})}},onTap:function(k){if(this.isDisabled()){return}var l=Ext.get(k.target);if(!l||(Ext.browser.engineName=="WebKit"&&l.hasCls("x-thumb"))){return}var o=k.touch.point.x,j=this.element,d=j.getX(),f=o-d-(this.thumbWidth/2),p=this.constrainValue(this.getMinValue()+f/this.offsetValueRatio),s=this.getValue(),r=Infinity,n=s.length,h,g,m,q,b,a;if(n===1){q=0}else{for(h=0;h<n;h++){m=s[h];g=Math.abs(m-p);if(g<r){r=g;q=h}}}b=s[q];a=this.getThumb(q);this.setIndexValue(q,p,this.getAnimation());this.refreshThumbConstraints(a);if(b!==p){this.fireEvent("change",this,a,p,b)}},updateThumbs:function(a){this.add(a)},applyValue:function(h){var e=Ext.Array.from(h||0),b=[],d=this.getMinValue(),a,f,g;for(f=0,g=e.length;f<g;f++){a=this.constrainValue(e[f]);if(a<d){a=d}b.push(a);d=a}return b},updateValue:function(g,b){var a=this.getThumbs(),e=g.length,f=this.getMinValue(),h=this.offsetValueRatio,d;this.setThumbsCount(e);for(d=0;d<e;d++){a[d].getDraggable().setExtraConstraint(null).setOffset((g[d]-f)*h)}for(d=0;d<e;d++){this.refreshThumbConstraints(a[d])}},refreshValue:function(){this.refreshOffsetValueRatio();this.setValue(this.getValue())},constrainValue:function(f){var b=this,e=b.getMinValue(),g=b.getMaxValue(),a=b.getIncrement(),d;f=parseFloat(f);if(isNaN(f)){f=e}d=(f-e)%a;f-=d;if(Math.abs(d)>=(a/2)){f+=(d>0)?a:-a}f=Math.max(e,f);f=Math.min(g,f);return f},setThumbsCount:function(f){var a=this.getThumbs(),g=a.length,d,e,b;if(g>f){for(d=0,e=g-f;d<e;d++){b=a[a.length-1];b.destroy()}}else{if(g<f){for(d=0,e=f-g;d<e;d++){this.add(this.factoryThumb())}}}return this},setValues:function(a){this.setValue(a)},getValues:function(){return this.getValue()},applyIncrement:function(a){if(a===0){a=1}return Math.abs(a)},updateAllowThumbsOverlapping:function(b,a){if(typeof a!="undefined"){this.refreshValue()}},updateMinValue:function(b,a){if(typeof a!="undefined"){this.refreshValue()}},updateMaxValue:function(b,a){if(typeof a!="undefined"){this.refreshValue()}},updateIncrement:function(b,a){if(typeof a!="undefined"){this.refreshValue()}},doSetDisabled:function(d){this.callParent(arguments);var a=this.getItems().items,e=a.length,b;for(b=0;b<e;b++){a[b].setDisabled(d)}}},function(){});Ext.define("Ext.field.Slider",{extend:Ext.field.Field,xtype:"sliderfield",alternateClassName:"Ext.form.Slider",config:{cls:Ext.baseCSSPrefix+"slider-field",tabIndex:-1,readOnly:false},proxyConfig:{increment:1,value:0,minValue:0,maxValue:100},constructor:function(a){a=a||{};if(a.hasOwnProperty("values")){a.value=a.values}this.callParent([a]);this.updateMultipleState()},initialize:function(){this.callParent();this.getComponent().on({scope:this,change:"onSliderChange",dragstart:"onSliderDragStart",drag:"onSliderDrag",dragend:"onSliderDragEnd"})},applyComponent:function(a){return Ext.factory(a,Ext.slider.Slider)},updateComponent:function(a){this.callSuper(arguments);a.setMinValue(this.getMinValue());a.setMaxValue(this.getMaxValue())},onSliderChange:function(){this.fireEvent.apply(this,[].concat("change",this,Array.prototype.slice.call(arguments)))},onSliderDragStart:function(){this.fireEvent.apply(this,[].concat("dragstart",this,Array.prototype.slice.call(arguments)))},onSliderDrag:function(){this.fireEvent.apply(this,[].concat("drag",this,Array.prototype.slice.call(arguments)))},onSliderDragEnd:function(){this.fireEvent.apply(this,[].concat("dragend",this,Array.prototype.slice.call(arguments)))},setValues:function(a){this.setValue(a);this.updateMultipleState()},getValues:function(){return this.getValue()},reset:function(){var b=this.config,a=(this.config.hasOwnProperty("values"))?b.values:b.value;this.setValue(a)},doSetDisabled:function(a){this.callParent(arguments);this.getComponent().setDisabled(a)},updateReadOnly:function(a){this.getComponent().setReadOnly(a)},isDirty:function(){if(this.getDisabled()){return false}return this.getValue()!==this.originalValue},updateMultipleState:function(){var a=this.getValue();if(a&&a.length>1){this.addCls(Ext.baseCSSPrefix+"slider-multiple")}}});Ext.define("Ext.slider.Toggle",{extend:Ext.slider.Slider,config:{baseCls:"x-toggle",minValueCls:"x-toggle-off",maxValueCls:"x-toggle-on"},initialize:function(){this.callParent();this.on({change:"onChange"})},applyMinValue:function(){return 0},applyMaxValue:function(){return 1},applyIncrement:function(){return 1},updateMinValueCls:function(d,b){var a=this.element;if(b&&a.hasCls(b)){a.replaceCls(b,d)}},updateMaxValueCls:function(d,b){var a=this.element;if(b&&a.hasCls(b)){a.replaceCls(b,d)}},setValue:function(b,a){this.callParent(arguments);this.onChange(this,this.getThumbs()[0],b,a)},setIndexValue:function(d,f,e){var b=this.getValue()[d];this.callParent(arguments);var a=this.getThumb(d),g=this.getValue()[d];if(b!==g){this.fireEvent("change",this,a,g,b)}},onChange:function(f,a,h,d){var j=h>0,b=f.getMaxValueCls(),g=f.getMinValueCls(),e=this.element;e.addCls(j?b:g);e.removeCls(j?g:b)},toggle:function(){var a=this.getValue();this.setValue((a==1)?0:1);return this},onTap:function(){if(this.isDisabled()||this.getReadOnly()){return}var b=this.getValue(),d=(b==1)?0:1,a=this.getThumb(0);this.setIndexValue(0,d,this.getAnimation());this.refreshThumbConstraints(a)}});Ext.define("Ext.field.Toggle",{extend:Ext.field.Slider,xtype:"togglefield",alternateClassName:"Ext.form.Toggle",config:{cls:"x-toggle-field",labelAlign:"left",activeLabel:null,inactiveLabel:null},platformConfig:[{theme:["Windows"],labelAlign:"left"},{theme:["Blackberry","MountainView"],activeLabel:"On",inactiveLabel:"Off"}],proxyConfig:{minValueCls:"x-toggle-off",maxValueCls:"x-toggle-on"},applyComponent:function(a){return Ext.factory(a,Ext.slider.Toggle)},updateActiveLabel:function(b,a){if(b!=a){this.getComponent().element.dom.setAttribute("data-activelabel",b)}},updateInactiveLabel:function(b,a){if(b!=a){this.getComponent().element.dom.setAttribute("data-inactivelabel",b)}},setValue:function(b){if(b===true){b=1}var a=this.getValue();if(a!=b){this.getComponent().setValue(b);this.fireEvent("change",this,b,a)}return this},getValue:function(){return(this.getComponent().getValue()==1)?1:0},onSliderChange:function(d,a,e,b){this.fireEvent.call(this,"change",this,e,b)},toggle:function(){var a=this.getValue();this.setValue((a==1)?0:1);return this},onChange:function(){this.setLabel((this.getValue()==1)?this.toggleOnLabel:this.toggleOffLabel)}});Ext.define("Ext.form.FieldSet",{extend:Ext.Container,alias:"widget.fieldset",config:{baseCls:Ext.baseCSSPrefix+"form-fieldset",title:null,instructions:null},applyTitle:function(a){if(typeof a=="string"){a={title:a}}Ext.applyIf(a,{docked:"top",baseCls:this.getBaseCls()+"-title"});return Ext.factory(a,Ext.Title,this._title)},updateTitle:function(b,a){if(b){this.add(b)}if(a){this.remove(a)}},getTitle:function(){var a=this._title;if(a&&a instanceof Ext.Title){return a.getTitle()}return a},applyInstructions:function(a){if(typeof a=="string"){a={title:a}}Ext.applyIf(a,{docked:"bottom",baseCls:this.getBaseCls()+"-instructions"});return Ext.factory(a,Ext.Title,this._instructions)},updateInstructions:function(b,a){if(b){this.add(b)}if(a){this.remove(a)}},getInstructions:function(){var a=this._instructions;if(a&&a instanceof Ext.Title){return a.getTitle()}return a},doSetDisabled:function(a){this.getFieldsAsArray().forEach(function(b){b.setDisabled(a)});return this},getFieldsAsArray:function(){var a=[],b=function(d){if(d.isField){a.push(d)}if(d.isContainer){d.getItems().each(b)}};this.getItems().each(b);return a}});Ext.define("Ext.form.Panel",{alternateClassName:"Ext.form.FormPanel",extend:Ext.Panel,xtype:"formpanel",config:{baseCls:Ext.baseCSSPrefix+"form",standardSubmit:false,url:null,enctype:null,baseParams:null,submitOnAction:false,record:null,method:"post",scrollable:{translatable:{translationMethod:"scrollposition"}},trackResetOnLoad:false,api:null,paramOrder:null,paramsAsHash:null,timeout:30,multipartDetection:true,enableSubmissionForm:true},getElementConfig:function(){var a=this.callParent();a.tag="form";a.children.push({tag:"input",type:"submit",style:"visibility: hidden; width: 0; height: 0; position: absolute; right: 0; bottom: 0;"});return a},initialize:function(){var a=this;a.callParent();a.element.on({submit:"onSubmit",scope:a})},applyEnctype:function(b){var a=this.element.dom||null;if(a){if(b){a.setAttribute("enctype",b)}else{a.setAttribute("enctype")}}},updateRecord:function(d){var a,b,e;if(d&&(a=d.fields)){b=this.getValues();for(e in b){if(b.hasOwnProperty(e)&&a.containsKey(e)){d.set(e,b[e])}}}return this},setRecord:function(a){var b=this;if(a&&a.data){b.setValues(a.data)}b._record=a;return this},onSubmit:function(b){var a=this;if(b&&!a.getStandardSubmit()){b.stopEvent()}else{this.submit(null,b)}},updateSubmitOnAction:function(a){if(a){this.on({action:"onFieldAction",scope:this})}else{this.un({action:"onFieldAction",scope:this})}},onFieldAction:function(a){if(this.getSubmitOnAction()){a.blur();this.submit()}},submit:function(a,g){var d=this,f=d.getValues(d.getStandardSubmit()||!a.submitDisabled),b=d.element.dom||{};if(this.getEnableSubmissionForm()){b=this.createSubmissionForm(b,f)}a=Ext.apply({url:d.getUrl()||b.action,submit:false,form:b,method:d.getMethod()||b.method||"post",autoAbort:false,params:null,waitMsg:null,headers:null,success:null,failure:null},a||{});return d.fireAction("beforesubmit",[d,f,a,g],"doBeforeSubmit")},createSubmissionForm:function(f,d){var a=this.getFields(),e,b,g,h,j;if(f.nodeType===1){f=f.cloneNode(false);for(e in d){b=document.createElement("input");b.setAttribute("type","text");b.setAttribute("name",e);b.setAttribute("value",d[e]);f.appendChild(b)}}for(e in a){if(a.hasOwnProperty(e)){g=a[e];if(g.isFile){if(!f.$fileswap){f.$fileswap=[]}j=g.getComponent().input;h=j.dom;b=h.cloneNode(true);h.parentNode.insertBefore(b,h.nextSibling);f.appendChild(h);f.$fileswap.push({original:h,placeholder:b})}}}return f},doBeforeSubmit:function(s,o,e){var d=e.form||{},h=false;if(this.getMultipartDetection()===true){this.getFieldsAsArray().forEach(function(v){if(v.isFile===true){h=true;return false}});if(h){d.setAttribute("enctype","multipart/form-data")}}if(e.enctype){d.setAttribute("enctype",e.enctype)}if(s.getStandardSubmit()){if(e.url&&Ext.isEmpty(d.action)){d.action=e.url}var p=this.query("spinnerfield"),k=p.length,r,b;for(r=0;r<k;r++){b=p[r];if(!b.getDisabled()){b.getComponent().setDisabled(false)}}d.method=(e.method||d.method).toLowerCase();d.submit()}else{var n=s.getApi(),g=e.url||s.getUrl(),a=e.scope||s,j=e.waitMsg,u=function(v,w){if(Ext.isFunction(e.failure)){e.failure.call(a,s,v,w)}s.fireEvent("exception",s,v)},l=function(v,w){if(Ext.isFunction(e.success)){e.success.call(e.scope||s,s,v,w)}s.fireEvent("submit",s,v)},m;if(e.waitMsg){if(typeof j==="string"){j={xtype:"loadmask",message:j}}s.setMasked(j)}if(n){m=n.submit;if(typeof m==="string"){m=Ext.direct.Manager.parseMethod(m);if(m){n.submit=m}}if(m){return m(this.element,function(w,v,x){s.setMasked(false);if(x){if(w.success){l(v,w)}else{u(v,w)}}else{u(v,w)}},this)}}else{var f=Ext.merge({},{url:g,timeout:this.getTimeout()*1000,form:d,scope:s},e);delete f.success;delete f.failure;f.params=Ext.merge(s.getBaseParams()||{},e.params);f.header=Ext.apply({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},e.headers||{});f.callback=function(w,C,x){var z=x.responseText,B=x.responseXML,D=Ext.Ajax.parseStatus(x.status,x);if(d.$fileswap){var v,A;Ext.each(d.$fileswap,function(E){v=E.original;A=E.placeholder;A.parentNode.insertBefore(v,A.nextSibling);A.parentNode.removeChild(A)});d.$fileswap=null;delete d.$fileswap}s.setMasked(false);if(x.success===false){C=false}if(C){if(D&&z&&z.length==0){C=true}else{if(!Ext.isEmpty(x.responseBytes)){C=D.success}else{if(Ext.isString(z)&&x.request.options.responseType==="text"){x.success=true}else{if(Ext.isString(z)){try{x=Ext.decode(z)}catch(y){x.success=false;x.error=y;x.message=y.message}}else{if(Ext.isSimpleObject(z)){x=z;Ext.applyIf(x,{success:true})}}}if(!Ext.isEmpty(B)){x.success=true}C=!!x.success}}if(C){l(x,z)}else{u(x,z)}}else{u(x,z)}};if(Ext.feature.has.XHR2&&f.xhr2){delete f.form;var q=new FormData(d);if(f.params){Ext.iterate(f.params,function(v,w){if(Ext.isArray(w)){Ext.each(w,function(x){q.append(v,x)})}else{q.append(v,w)}});delete f.params}f.data=q}return Ext.Ajax.request(f)}}},load:function(l){l=l||{};var h=this,e=h.getApi(),b=h.getUrl()||l.url,d=l.waitMsg,k=function(n,m){h.setValues(n.data);if(Ext.isFunction(l.success)){l.success.call(l.scope||h,h,m,n)}h.fireEvent("load",h,m)},g=function(n,m){if(Ext.isFunction(l.failure)){l.failure.call(scope,h,m,n)}h.fireEvent("exception",h,m)},j,a,f;if(l.waitMsg){if(typeof d==="string"){d={xtype:"loadmask",message:d}}h.setMasked(d)}if(e){j=e.load;if(typeof j==="string"){j=Ext.direct.Manager.parseMethod(j);if(j){e.load=j}}if(j){a=j.directCfg.method;f=a.getArgs(h.getParams(l.params),h.getParamOrder(),h.getParamsAsHash());f.push(function(n,m,o){h.setMasked(false);if(o){k(m,n)}else{g(m,n)}},h);return j.apply(window,f)}}else{if(b){return Ext.Ajax.request({url:b,scope:h,timeout:(l.timeout||this.getTimeout())*1000,method:l.method||"GET",autoAbort:l.autoAbort,headers:Ext.apply({"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},l.headers||{}),callback:function(m,r,n){var p=this,q=n.responseText,o=Ext.Ajax.parseStatus(n.status,n);p.setMasked(false);if(r){if(o&&q.length==0){r=true}else{n=Ext.decode(q);r=!!n.success}if(r){k(n,q)}else{g(n,q)}}else{g(n,q)}}})}}},getParams:function(a){return Ext.apply({},a,this.getBaseParams())},setValues:function(l){var d=this.getFields(),h=this,a,j,k,g,b,e;l=l||{};for(a in l){if(l.hasOwnProperty(a)){j=d[a];k=l[a];if(j){if(Ext.isArray(j)){g=j.length;for(b=0;b<g;b++){e=j[b];if(e.isRadio){e.setGroupValue(k);break}else{if(e.isCheckbox){if(Ext.isArray(k)){e.setChecked((k.indexOf(e._value)!=-1))}else{e.setChecked((k==e._value))}}else{if(Ext.isArray(k)){e.setValue(k[b])}}}}}else{if(j.isRadio||j.isCheckbox){j.setChecked(k)}else{j.setValue(k)}}if(h.getTrackResetOnLoad()){j.resetOriginalValue()}}}}return this},getValues:function(h,m){var g=this.getFields(),n={},f=Ext.isArray,k,l,b,d,a,j,e;b=function(p,o){if(!m&&(!o||o==="null")||p.isFile){return}if(p.isCheckbox){l=p.getSubmitValue()}else{l=p.getValue()}if(!(h&&p.getDisabled())){if(p.isRadio){if(p.isChecked()){n[o]=l}}else{d=n[o];if(!Ext.isEmpty(d)){if(!f(d)){d=n[o]=[d]}if(f(l)){d=n[o]=d.concat(l)}else{d.push(l)}}else{n[o]=l}}}};for(a in g){if(g.hasOwnProperty(a)){k=g[a];if(f(k)){j=k.length;for(e=0;e<j;e++){b(k[e],a)}}else{b(k,a)}}}return n},reset:function(){this.getFieldsAsArray().forEach(function(a){a.reset()});return this},doSetDisabled:function(a){this.getFieldsAsArray().forEach(function(b){b.setDisabled(a)});return this},getFieldsAsArray:function(){var a=[],b=function(d){if(d.isField){a.push(d)}if(d.isContainer){d.getItems().each(b)}};this.getItems().each(b);return a},getFields:function(b){var a={},e;var d=function(f){if(f.isField){e=f.getName();if((b&&e==b)||typeof b=="undefined"){if(a.hasOwnProperty(e)){if(!Ext.isArray(a[e])){a[e]=[a[e]]}a[e].push(f)}else{a[e]=f}}}if(f.isContainer){f.items.each(d)}};this.getItems().each(d);return(b)?(a[b]||[]):a},getFieldsArray:function(){var a=[];var b=function(d){if(d.isField){a.push(d)}if(d.isContainer){d.items.each(b)}};this.items.each(b);return a},getFieldsFromItem:Ext.emptyFn,showMask:function(a,b){a=Ext.isObject(a)?a.message:a;if(a){this.setMasked({xtype:"loadmask",message:a})}else{this.setMasked(true)}return this},hideMask:function(){this.setMasked(false);return this},getFocusedField:function(){var a=this.getFieldsArray(),d=a.length,e,b;for(b=0;b<d;b++){e=a[b];if(e.isFocused){return e}}return null},getNextField:function(){var a=this.getFieldsArray(),d=this.getFocusedField(),b;if(d){b=a.indexOf(d);if(b!==a.length-1){b++;return a[b]}}return false},focusNextField:function(){var a=this.getNextField();if(a){a.focus();return a}return false},getPreviousField:function(){var a=this.getFieldsArray(),d=this.getFocusedField(),b;if(d){b=a.indexOf(d);if(b!==0){b--;return a[b]}}return false},focusPreviousField:function(){var a=this.getPreviousField();if(a){a.focus();return a}return false}},function(){});Ext.define("Ext.fx.runner.Css",{extend:Ext.Evented,prefixedProperties:{transform:true,"transform-origin":true,perspective:true,"transform-style":true,transition:true,"transition-property":true,"transition-duration":true,"transition-timing-function":true,"transition-delay":true,animation:true,"animation-name":true,"animation-duration":true,"animation-iteration-count":true,"animation-direction":true,"animation-timing-function":true,"animation-delay":true},lengthProperties:{top:true,right:true,bottom:true,left:true,width:true,height:true,"max-height":true,"max-width":true,"min-height":true,"min-width":true,"margin-bottom":true,"margin-left":true,"margin-right":true,"margin-top":true,"padding-bottom":true,"padding-left":true,"padding-right":true,"padding-top":true,"border-bottom-width":true,"border-left-width":true,"border-right-width":true,"border-spacing":true,"border-top-width":true,"border-width":true,"outline-width":true,"letter-spacing":true,"line-height":true,"text-indent":true,"word-spacing":true,"font-size":true,translate:true,translateX:true,translateY:true,translateZ:true,translate3d:true},durationProperties:{"transition-duration":true,"transition-delay":true,"animation-duration":true,"animation-delay":true},angleProperties:{rotate:true,rotateX:true,rotateY:true,rotateZ:true,skew:true,skewX:true,skewY:true},lengthUnitRegex:/([a-z%]*)$/,DEFAULT_UNIT_LENGTH:"px",DEFAULT_UNIT_ANGLE:"deg",DEFAULT_UNIT_DURATION:"ms",formattedNameCache:{},constructor:function(){var a=Ext.feature.has.Css3dTransforms;if(a){this.transformMethods=["translateX","translateY","translateZ","rotate","rotateX","rotateY","rotateZ","skewX","skewY","scaleX","scaleY","scaleZ"]}else{this.transformMethods=["translateX","translateY","rotate","skewX","skewY","scaleX","scaleY"]}this.vendorPrefix=Ext.browser.getStyleDashPrefix();this.ruleStylesCache={};return this},getStyleSheet:function(){var d=this.styleSheet,a,b;if(!d){a=document.createElement("style");a.type="text/css";(document.head||document.getElementsByTagName("head")[0]).appendChild(a);b=document.styleSheets;this.styleSheet=d=b[b.length-1]}return d},applyRules:function(k){var h=this.getStyleSheet(),m=this.ruleStylesCache,l=h.cssRules,d,f,j,b,e,a,g;for(d in k){f=k[d];j=m[d];if(j===undefined){e=l.length;h.insertRule(d+"{}",e);j=m[d]=l.item(e).style}b=j.$cache;if(!b){b=j.$cache={}}for(a in f){g=this.formatValue(f[a],a);a=this.formatName(a);if(b[a]!==g){b[a]=g;if(g===null){j.removeProperty(a)}else{j.setProperty(a,g,"important")}}}}return this},applyStyles:function(e){var h,d,g,b,a,f;for(h in e){if(e.hasOwnProperty(h)){d=document.getElementById(h);if(!d){return this}g=d.style;b=e[h];for(a in b){if(b.hasOwnProperty(a)){f=this.formatValue(b[a],a);a=this.formatName(a);if(f===null){g.removeProperty(a)}else{g.setProperty(a,f,"important")}}}}}return this},formatName:function(b){var a=this.formattedNameCache,d=a[b];if(!d){if((Ext.os.is.Tizen||!Ext.feature.has.CssTransformNoPrefix)&&this.prefixedProperties[b]){d=this.vendorPrefix+b}else{d=b}a[b]=d}return d},formatValue:function(k,b){var h=typeof k,m=this.DEFAULT_UNIT_LENGTH,f,a,e,g,d,l,j;if(k===null){return""}if(h=="string"){if(this.lengthProperties[b]){j=k.match(this.lengthUnitRegex)[1];if(j.length>0){}else{return k+m}}return k}else{if(h=="number"){if(k==0){return"0"}if(this.lengthProperties[b]){return k+m}if(this.angleProperties[b]){return k+this.DEFAULT_UNIT_ANGLE}if(this.durationProperties[b]){return k+this.DEFAULT_UNIT_DURATION}}else{if(b==="transform"){f=this.transformMethods;d=[];for(e=0,g=f.length;e<g;e++){a=f[e];d.push(a+"("+this.formatValue(k[a],a)+")")}return d.join(" ")}else{if(Ext.isArray(k)){l=[];for(e=0,g=k.length;e<g;e++){l.push(this.formatValue(k[e],b))}return(l.length>0)?l.join(", "):"none"}}}}return k}});Ext.define("Ext.fx.runner.CssTransition",{extend:Ext.fx.runner.Css,listenersAttached:false,constructor:function(){this.runningAnimationsData={};return this.callParent(arguments)},attachListeners:function(){this.listenersAttached=true;this.getEventDispatcher().addListener("element","*","transitionend","onTransitionEnd",this)},onTransitionEnd:function(b){var a=b.target,d=a.id;if(d&&this.runningAnimationsData.hasOwnProperty(d)){this.refreshRunningAnimationsData(Ext.get(a),[b.browserEvent.propertyName])}},onAnimationEnd:function(h,g,e,k,o){var d=h.getId(),l=this.runningAnimationsData[d],p={},n={},b,j,f,m,a;e.un("stop","onAnimationStop",this);if(l){b=l.nameMap}p[d]=n;if(g.onBeforeEnd){g.onBeforeEnd.call(g.scope||this,h,k)}e.fireEvent("animationbeforeend",e,h,k);this.fireEvent("animationbeforeend",this,e,h,k);if(o||(!k&&!g.preserveEndState)){j=g.toPropertyNames;for(f=0,m=j.length;f<m;f++){a=j[f];if(b&&!b.hasOwnProperty(a)){n[a]=null}}}if(g.after){Ext.merge(n,g.after)}this.applyStyles(p);if(g.onEnd){g.onEnd.call(g.scope||this,h,k)}e.fireEvent("animationend",e,h,k);this.fireEvent("animationend",this,e,h,k);Ext.AnimationQueue.stop(Ext.emptyFn,e)},onAllAnimationsEnd:function(b){var d=b.getId(),a={};delete this.runningAnimationsData[d];a[d]={"transition-property":null,"transition-duration":null,"transition-timing-function":null,"transition-delay":null};this.applyStyles(a);this.fireEvent("animationallend",this,b)},hasRunningAnimations:function(a){var d=a.getId(),b=this.runningAnimationsData;return b.hasOwnProperty(d)&&b[d].sessions.length>0},refreshRunningAnimationsData:function(e,l,v,q){var h=e.getId(),r=this.runningAnimationsData,a=r[h];if(!a){return}var n=a.nameMap,u=a.nameList,b=a.sessions,g,k,f,w,m,d,s,p,o=false;v=Boolean(v);q=Boolean(q);if(!b){return this}g=b.length;if(g===0){return this}if(q){a.nameMap={};u.length=0;for(m=0;m<g;m++){d=b[m];this.onAnimationEnd(e,d.data,d.animation,v,q)}b.length=0}else{for(m=0;m<g;m++){d=b[m];s=d.map;p=d.list;for(k=0,f=l.length;k<f;k++){w=l[k];if(s[w]){delete s[w];Ext.Array.remove(p,w);d.length--;if(--n[w]==0){delete n[w];Ext.Array.remove(u,w)}}}if(d.length==0){b.splice(m,1);m--;g--;o=true;this.onAnimationEnd(e,d.data,d.animation,v)}}}if(!q&&!v&&b.length==0&&o){this.onAllAnimationsEnd(e)}},getRunningData:function(b){var a=this.runningAnimationsData;if(!a.hasOwnProperty(b)){a[b]={nameMap:{},nameList:[],sessions:[]}}return a[b]},getTestElement:function(){var d=this.testElement,b,e,a;if(!d){b=document.createElement("iframe");a=b.style;a.setProperty("visibility","hidden","important");a.setProperty("width","0px","important");a.setProperty("height","0px","important");a.setProperty("position","absolute","important");a.setProperty("border","0px","important");a.setProperty("zIndex","-1000","important");document.body.appendChild(b);e=b.contentDocument;e.open();e.writeln("</body>");e.close();this.testElement=d=e.createElement("div");d.style.setProperty("position","absolute","important");e.body.appendChild(d);this.testElementComputedStyle=window.getComputedStyle(d)}return d},getCssStyleValue:function(b,f){var e=this.getTestElement(),a=this.testElementComputedStyle,d=e.style;d.setProperty(b,f);if(Ext.browser.is.Firefox){e.offsetHeight}f=a.getPropertyValue(b);d.removeProperty(b);return f},run:function(r){var I=this,k=this.lengthProperties,A={},H={},J={},e,v,B,f,x,L,y,s,u,a,o,D,C,q,E,m,w,h,F,K,l,g,z,p,d,G,b,n;if(!this.listenersAttached){this.attachListeners()}r=Ext.Array.from(r);for(D=0,q=r.length;D<q;D++){E=r[D];E=Ext.factory(E,Ext.fx.Animation);e=E.getElement();Ext.AnimationQueue.start(Ext.emptyFn,E);h=window.getComputedStyle(e.dom);v=e.getId();J=Ext.merge({},E.getData());if(E.onBeforeStart){E.onBeforeStart.call(E.scope||this,e)}E.fireEvent("animationstart",E);this.fireEvent("animationstart",this,E);J[v]=J;x=J.before;B=J.from;f=J.to;J.fromPropertyNames=L=[];J.toPropertyNames=y=[];for(K in f){if(f.hasOwnProperty(K)){f[K]=l=this.formatValue(f[K],K);F=this.formatName(K);p=k.hasOwnProperty(K);if(!p){l=this.getCssStyleValue(F,l)}if(B.hasOwnProperty(K)){B[K]=z=this.formatValue(B[K],K);if(!p){z=this.getCssStyleValue(F,z)}if(l!==z){L.push(F);y.push(F)}}else{g=h.getPropertyValue(F);if(l!==g){y.push(F)}}}}m=y.length;if(m===0){this.onAnimationEnd(e,J,E);continue}a=this.getRunningData(v);b=a.sessions;if(b.length>0){this.refreshRunningAnimationsData(e,Ext.Array.merge(L,y),true,J.replacePrevious)}d=a.nameMap;G=a.nameList;w={};for(C=0;C<m;C++){K=y[C];w[K]=true;if(!d.hasOwnProperty(K)){d[K]=1;G.push(K)}else{d[K]++}}n={element:e,map:w,list:y.slice(),length:m,data:J,animation:E};b.push(n);E.on("stop","onAnimationStop",this);o=Ext.apply({},x);Ext.apply(o,B);if(G.length>0){L=Ext.Array.difference(G,L);y=Ext.Array.merge(L,y);o["transition-property"]=L}A[v]=o;H[v]=Ext.apply({},f);H[v]["transition-property"]=y;H[v]["transition-duration"]=J.duration;H[v]["transition-timing-function"]=J.easing;H[v]["transition-delay"]=J.delay;E.startTime=Date.now()}u=this.$className;this.applyStyles(A);s=function(j){if(j.data===u&&j.source===window){window.removeEventListener("message",s,false);I.applyStyles(H)}};if(Ext.browser.is.IE){window.requestAnimationFrame(function(){window.addEventListener("message",s,false);window.postMessage(u,"*")})}else{window.addEventListener("message",s,false);window.postMessage(u,"*")}},onAnimationStop:function(e){var g=this.runningAnimationsData,j,a,h,b,d,f;for(j in g){if(g.hasOwnProperty(j)){a=g[j];h=a.sessions;for(b=0,d=h.length;b<d;b++){f=h[b];if(f.animation===e){this.refreshRunningAnimationsData(f.element,f.list.slice(),false)}}}}}});Ext.define("Ext.fx.Runner",{constructor:function(){return new Ext.fx.runner.CssTransition()}});Ext.define("Ext.grid.infinite.Row",{extend:Ext.Component,xtype:"gridrow",config:{baseCls:Ext.baseCSSPrefix+"grid-row",index:0,columns:null,renderedCellCount:null,columnPositionMap:null,minimumBufferDistance:3,bufferSize:12},leftRenderedIndex:0,leftVisibleIndex:0,constructor:function(){this.cells=[];this.updatedCells=[];this.offsets={};this.widths={};this.callParent(arguments)},createCell:function(){var b=this.self.prototype,a,g,e,d,f;if(!b.hasOwnProperty("cellRenderTemplate")){b.cellRenderTemplate=a=document.createDocumentFragment();a.appendChild(Ext.Element.create(this.getCellElementConfig(),true));g=a.querySelectorAll("[id]");for(d=0,f=g.length;d<f;d++){e=g[d];e.removeAttribute("id")}}return b.cellRenderTemplate.cloneNode(true).firstChild},getCellElementConfig:function(){var a={tag:"div",cls:Ext.baseCSSPrefix+"grid-cell"};return a},onTranslate:function(a){var b=this;if(b.cells.length){b.handleCellUpdates(a);b.handleCellDimensions()}},handleCellUpdates:function(p){var v=this,e=v.getColumnPositionMap(),h=v.cells,n=h.length,d=v.getColumns(),u=d.length-1,l=v.getBufferSize(),g=v.getRecord(),q=v.getIndex(),k=v.getMinimumBufferDistance(),w=v.leftVisibleIndex,m=v.leftRenderedIndex,r,a,j,o,b,s,f;v.leftVisibleIndex=r=Math.max(0,e.findIndex(-p)||0);if(w!==r){if(w>r){a=r-m;if(a<k){j=Math.min(n,k-a);for(s=0;s<j;s++){o=m-s-1;if(o<0){break}b=h.pop();h.unshift(b);f=d[o];v.updateCell(b,f,g,q);v.updatedCells.push(b);v.leftRenderedIndex--}}}else{a=m+l-r;if(a<k){j=Math.min(n,k-a);for(s=0;s<j;s++){o=m+n+s;if(o>u){break}b=h.shift();h.push(b);f=d[o];v.updateCell(b,f,g,q);v.updatedCells.push(b);v.leftRenderedIndex++}}}}},handleCellDimensions:function(){var k=this,m=k.cells,e=k.widths,f=k.offsets,h=k.updatedCells,n=k.getColumnPositionMap(),a=k.leftRenderedIndex,b,g,l,d,j;while(l=h.shift()){j=m.indexOf(l);d=Ext.get(l);b=n.getItemHeight(j+a);g=n.map[j+a];if(b!==e[l.id]){d.setWidth(b);e[l.id]=b}if(g!==f[l.id]){d.translate(g);f[l.id]=g}}},updateRenderedCellCount:function(h){var g=this,f=g.element,l=g.cells,k=l.length,a=g.getBufferSize(),d=h+a,b=d-k,e,j;for(e=0;e<b;e++){j=g.createCell(k+e);f.appendChild(j);l.push(j);g.updatedCells.push(j)}for(e=b;e<0;e++){f.removeChild(l.pop())}},updateRecord:function(f){var j=this,g=j.getIndex(),d=j.getColumns(),l=j.cells,a=j.leftRenderedIndex,e,h,k,b;for(e=0,h=l.length;e<h;e++){k=l[e];b=d[e+a];j.updateCell(k,b,f,g)}},updateCell:function(a,e,b,d){var f=this;b=b||f.getRecord();d=d||f.getIndex();a.innerHTML=b&&e?e.getCellContent(b,f,d):""}});Ext.define("Ext.grid.Row",{extend:Ext.Component,xtype:"gridrow",config:{baseCls:Ext.baseCSSPrefix+"grid-row",grid:null},constructor:function(){this.cells=[];this.columnMap={};this.callParent(arguments)},updateGrid:function(d){var f=this,b,a,e;f.element.innerHTML="";f.cells=[];if(d){a=d.getColumns();for(b=0,e=a.length;b<e;b++){f.addColumn(a[b])}}},addColumn:function(a){this.insertColumn(this.cells.length,a)},insertColumn:function(j,d){if(this.getCellByColumn(d)){return}var k=this,f=k.element,n=k.cells,h=k.columnMap,l=k.createCell(j),e=k.cells[j],a=d.getCellCls(),b=Ext.get(l),g=this.getRecord(),m=[];l.$column=d;l.style.width=d.getWidth()+"px";if(d.isHidden()){l.style.display="none"}m.push(Ext.baseCSSPrefix+"grid-cell-align-"+d.getAlign());if(a){m.push(a)}b.addCls(m);if(g){d.updateCell(l,g)}if(e){f.dom.insertBefore(l,e);n.splice(j,0,l)}else{f.dom.appendChild(l);n.push(l)}h[d.getId()]=l},removeColumn:function(e){var f=this,b=f.columnMap,d=f.element,g=e.getId(),a=b[g];delete a.$column;if(a){d.removeChild(a)}Ext.Array.remove(f.cells,a);delete b[g]},updateRecord:function(b){var h=this,d=h.cells,e,g,a,f;for(e=0,g=d.length;e<g;e++){a=d[e];f=h.getColumnByCell(a);f.updateCell(a,b)}},setColumnWidth:function(d,b){var a=this.getCellByColumn(d);if(a){a.style.width=b+"px"}},showColumn:function(b){var a=this.getCellByColumn(b);if(a){a.style.display=""}},hideColumn:function(b){var a=this.getCellByColumn(b);if(a){a.style.display="none"}},getCellByColumn:function(a){return this.columnMap[a.getId()]},getColumnByCell:function(a){return a.$column},createCell:function(){var b=this.self.prototype,a,g,e,d,f;if(!b.hasOwnProperty("cellRenderTemplate")){b.cellRenderTemplate=a=document.createDocumentFragment();a.appendChild(Ext.Element.create(this.getCellElementConfig(),true));g=a.querySelectorAll("[id]");for(d=0,f=g.length;d<f;d++){e=g[d];e.removeAttribute("id")}}return b.cellRenderTemplate.cloneNode(true).firstChild},getCellElementConfig:function(){var a={tag:"div",cls:Ext.baseCSSPrefix+"grid-cell",html:"&nbsp;"};return a}});Ext.define("Ext.grid.column.Column",{extend:Ext.Component,xtype:"column",config:{dataIndex:null,text:"&nbsp;",sortable:true,resizable:true,hideable:true,renderer:false,scope:null,align:"left",editable:false,editor:null,defaultEditor:{xtype:"textfield",required:true},ignore:false,summaryType:null,summaryRenderer:null,minWidth:20,baseCls:Ext.baseCSSPrefix+"grid-column",cellCls:null,sortedCls:Ext.baseCSSPrefix+"column-sorted",sortDirection:null},updateAlign:function(b,a){if(a){this.removeCls(Ext.baseCSSPrefix+"grid-column-align-"+b)}if(b){this.addCls(Ext.baseCSSPrefix+"grid-column-align-"+b)}},initialize:function(){this.callParent();this.element.on({tap:"onColumnTap",longpress:"onColumnLongPress",scope:this})},onColumnTap:function(a){this.fireEvent("tap",this,a)},onColumnLongPress:function(a){this.fireEvent("longpress",this,a)},updateText:function(a){this.setHtml(a)},doSetWidth:function(a){this.callParent(arguments);this.fireEvent("columnresize",this,a)},updateDataIndex:function(a){var b=this.getEditor();if(b){b.name=a}else{this.getDefaultEditor().name=a}},updateSortDirection:function(d,a){if(!this.getSortable()){return}var b=this.getSortedCls();if(a){this.element.removeCls(b+"-"+a.toLowerCase())}if(d){this.element.addCls(b+"-"+d.toLowerCase())}this.fireEvent("sort",this,d,a)},getCellContent:function(a){var e=this,b=e.getDataIndex(),g=e.getRenderer(),d=e.getScope(),f=b&&a.get(b);return g?g.call(d||e,f,a,b):e.defaultRenderer(f,a)},defaultRenderer:function(a){return a},updateCell:function(a,b,d){if(a&&(b||d)){a.firstChild.nodeValue=d||this.getCellContent(b)}}});Ext.define("Ext.grid.column.Date",{extend:Ext.grid.column.Column,xtype:"datecolumn",config:{format:undefined},applyFormat:function(a){if(!a){a=Ext.Date.defaultFormat}return a},updateFormat:function(a){this.getDefaultEditor().dateFormat=a},defaultRenderer:function(a){return Ext.util.Format.date(a,this.getFormat())}});Ext.define("Ext.grid.column.Template",{extend:Ext.grid.column.Column,xtype:"templatecolumn",config:{tpl:null},applyTpl:function(a){if(Ext.isPrimitive(a)||!a.compile){a=new Ext.XTemplate(a)}return a},defaultRenderer:function(b,a){return this.getTpl().apply(a.getData(true))},updateCell:function(a,b,d){if(a&&(b||d)){a.innerHTML=d||this.getCellContent(b)}}});Ext.define("Ext.grid.HeaderContainer",{extend:Ext.Container,xtype:"headercontainer",config:{baseCls:Ext.baseCSSPrefix+"grid-header-container",height:65,docked:"top",translationMethod:"auto",defaultType:"column"},initialize:function(){var a=this;a.columns=[];a.callParent();a.on({tap:"onHeaderTap",columnresize:"onColumnResize",show:"onColumnShow",hide:"onColumnHide",sort:"onColumnSort",scope:a,delegate:"column"});a.on({show:"onGroupShow",hide:"onGroupHide",add:"onColumnAdd",remove:"onColumnRemove",scope:a,delegate:"gridheadergroup"});a.on({add:"onColumnAdd",remove:"onColumnRemove",scope:a});if(Ext.browser.getPreferredTranslationMethod({translationMethod:this.getTranslationMethod()})=="scrollposition"){a.innerElement.setLeft(500000)}},getColumns:function(){return this.columns},getAbsoluteColumnIndex:function(e){var a=this.getInnerItems(),g=a.length,b=0,h,d,f;for(d=0;d<g;d++){f=a[d];if(f===e){return b}else{if(f.isHeaderGroup){h=f.innerIndexOf(e);if(h!==-1){b+=h;return b}else{b+=f.getInnerItems().length}}else{b+=1}}}},onColumnAdd:function(g,f){var j=this,d=j.columns,e=j.getAbsoluteColumnIndex(f),a,h,b;if(f.isHeaderGroup){a=f.getItems().items;for(b=0,h=a.length;b<h;b++){d.splice(e+b,0,a[b]);j.fireEvent("columnadd",j,a[b],f)}}else{d.splice(e,0,f);j.fireEvent("columnadd",j,f,null)}},onColumnRemove:function(e,d){if(d.isHeaderGroup){var b=d.getItems().items,f=b.length,a;for(a=0;a<f;a++){Ext.Array.remove(this.columns,b[a]);this.fireEvent("columnremove",this,b[a])}}else{Ext.Array.remove(this.columns,d);this.fireEvent("columnremove",this,d)}},onHeaderTap:function(b){if(!b.getIgnore()&&b.getSortable()){var d=b.getSortDirection()||"DESC",a=(d==="DESC")?"ASC":"DESC";b.setSortDirection(a)}this.fireEvent("columntap",this,b)},onColumnShow:function(a){this.fireEvent("columnshow",this,a)},onColumnHide:function(a){this.fireEvent("columnhide",this,a)},onGroupShow:function(f){var b=f.getInnerItems(),e=b.length,a,d;for(a=0;a<e;a++){d=b[a];if(!d.isHidden()){this.fireEvent("columnshow",this,d)}}},onGroupHide:function(f){var b=f.getInnerItems(),e=b.length,a,d;for(a=0;a<e;a++){d=b[a];this.fireEvent("columnhide",this,d)}},onColumnResize:function(b,a){this.fireEvent("columnresize",this,b,a)},onColumnSort:function(b,d,a){if(d!==null){this.fireEvent("columnsort",this,b,d,a)}},scrollTo:function(a){switch(Ext.browser.getPreferredTranslationMethod({translationMethod:this.getTranslationMethod()})){case"scrollposition":this.renderElement.dom.scrollLeft=500000-a;break;case"csstransform":this.innerElement.translate(a,0);break}}});Ext.define("Ext.grid.HeaderGroup",{extend:Ext.Container,alias:"widget.gridheadergroup",isHeaderGroup:true,config:{text:"&nbsp;",defaultType:"column",baseCls:Ext.baseCSSPrefix+"grid-headergroup",hidden:true},updateText:function(a){this.setHtml(a)},initialize:function(){this.on({add:"doVisibilityCheck",remove:"doVisibilityCheck"});this.on({show:"doVisibilityCheck",hide:"doVisibilityCheck",delegate:"> column"});this.callParent(arguments);this.doVisibilityCheck()},doVisibilityCheck:function(){var b=this.getInnerItems(),e=b.length,a,d;for(a=0;a<e;a++){d=b[a];if(!d.isHidden()){if(this.isHidden()){if(this.initialized){this.show()}else{this.setHidden(false)}}return}}this.hide()}});Ext.define("Ext.grid.infinite.Grid",{extend:Ext.Container,alias:"widget.grid",mixins:[Ext.mixin.Selectable,Ext.mixin.Bindable],xtype:"grid",config:{columns:null,store:null,data:null,baseCls:Ext.baseCSSPrefix+"grid",emptyText:null,deferEmptyText:true,loadingText:"Loading...",variableHeights:false,layout:"fit",defaultType:"gridrow",rowCls:null,selectedCls:Ext.baseCSSPrefix+"row-selected",minimumRowHeight:30,bufferSize:10,minimumBufferDistance:3},storeEventHooks:{beforeload:"onBeforeLoad",load:"onLoad",refresh:"refresh",addrecords:"onStoreAdd",removerecords:"onStoreRemove",updaterecord:"onStoreUpdate"},hasLoadedStore:false,constructor:function(){var a=this;a.mixins.selectable.constructor.apply(a,arguments);a.callParent(arguments)},beforeInitialize:function(){var d=this,a,e,b;Ext.apply(d,{rows:[],offsets:{},updatedRows:[],topRenderedIndex:0,topVisibleIndex:0,currentX:null,currentY:null,rowPositionMap:Ext.create("Ext.util.PositionMap",{minimumHeight:d.getMinimumRowHeight()}),columnPositionMap:Ext.create("Ext.util.PositionMap",{minimumHeight:20})});this.translationMethod=Ext.browser.is.AndroidStock2?"cssposition":"csstransform";a=d.container=Ext.factory({xtype:"container",scrollable:{scroller:{autoRefresh:false,direction:"both"}}});d.add(a);a.element.on({resize:"onContainerResize",scope:d});e=a.getScrollable();b=d.scrollViewElement=e.getElement();d.scrollElement=e.getScroller().getElement();d.setScrollable(e);d.scrollableBehavior=a.getScrollableBehavior();d.bind(e.getScroller().getTranslatable(),"doTranslate","onTranslate")},onContainerResize:function(a,b){var d=this;d.visibleRowCount=Math.ceil(b.height/d.getMinimumRowHeight());d.visibleColumnCount=this.determineMaxVisibleColumnCount(b.width);d.containerHeight=b.height;d.setRenderedRowCount(d.visibleRowCount+1)},onTranslate:function(a,j){var f=this,b=f.getStore(),h=b&&b.getCount(),g=f.rows,d,e;if(!h){f.showEmptyText()}else{if(f.rowCount){if(j!==f.currentY){f.handleRowUpdates(j)}if(a!==f.currentX){for(d=0,e=g.length;d<e;d++){g[d].onTranslate(a)}f.currentX=a}if(j!==f.currentY){f.handleRowTransforms();f.currentY=j}}}},handleRowUpdates:function(m){var k=this,r=k.rowPositionMap,s=k.rows,n=s.length,p=k.getStore(),g=p.getCount()-1,a=k.getBufferSize(),o=k.getMinimumBufferDistance(),b=k.topVisibleIndex,f=k.topRenderedIndex,j,h,e,l,q,d;k.topVisibleIndex=j=Math.max(0,r.findIndex(-m)||0);if(b!==j){if(b>j){h=j-f;if(h<o){e=Math.min(n,o-h);for(d=0;d<e;d++){l=f-d-1;if(l<0){break}q=s.pop();s.unshift(q);k.updateRow(q,l);k.topRenderedIndex--}}}else{h=f+a-j;if(h<o){e=Math.min(n,o-h);for(d=0;d<e;d++){l=f+n+d;if(l>g){break}q=s.shift();s.push(q);k.updateRow(q,l);k.topRenderedIndex++}}}}},handleRowTransforms:function(){var b=this,a=b.offsets,g=b.updatedRows,d=b.rowPositionMap,f,e;while(e=g.shift()){f=d.map[e.getIndex()];if(f!==a[e.id]){e.translate(0,f);a[e.id]=f}}},applyColumns:function(b){var a,e,d;if(b){if(!Ext.isArray(b)){b=[b]}for(a=0,e=b.length;a<e;a++){d=b[a];if(!d.isComponent){d=Ext.factory(d,Ext.grid.column.Column);b[a]=d}}}return b},updateColumns:function(b){if(b&&b.length){var f=this,e=b.length,a,d;f.columnPositionMap.populate(e);for(a=0;a<e;a++){d=b[a];f.columnPositionMap.setItemHeight(a,d.getWidth())}f.columnPositionMap.update();f.scrollElement.setWidth(f.columnPositionMap.getTotalHeight())}},determineMaxVisibleColumnCount:function(a){var k=this,l=k.columnPositionMap,d=0,g,b,f,e,h;for(f=0,h=l.map.length;f<h;f++){g=b=0;e=f;while(b<a&&e<h){b+=l.getItemHeight(e);g++;e++}if(g>d){d=g}}return d},setRenderedRowCount:function(a){var e=this,f=e.rows,b=e.getRowConfig(),g=a+e.getBufferSize()-f.length,d;for(d=0;d<g;d++){e.createRow(b)}for(d=g;d<0;d++){f.pop().destroy()}e.rowCount=a;e.updateAllRows();return e.rows},getRowConfig:function(){var a=this;return{xtype:a.getDefaultType(),minHeight:a.rowPositionMap.getMinimumHeight(),columns:a.getColumns(),cls:a.getRowCls(),columnPositionMap:a.columnPositionMap,translatable:{translationMethod:this.translationMethod}}},createRow:function(b){var d=this,a=d.container,e=d.rows,f;f=Ext.factory(b);f.grid=d;f.$height=b.minHeight;a.doAdd(f);e.push(f);return f},updateAllRows:function(){var e=this,f=e.rows,a=e.getStore(),g=e.topRenderedIndex,b,d;if(e.hasLoadedStore){for(b=0,d=f.length;b<d;b++){e.updateRow(f[b],g+b)}if(a.getCount()){e.scrollElement.setHeight(e.rowPositionMap.getTotalHeight())}else{e.scrollElement.setHeight(e.containerHeight)}}e.refreshScroller()},updateRow:function(n,f){var j=this,m=j.getStore(),d=m.getAt(f),k=j.updatedRows,e=j.getSelectedCls(),a=[],h=[e],l=n.renderElement.classList,b,g;n.$position=-10000;if(!d){n.setRecord(null);n.translate(0,-10000);n.$hidden=true;return}else{if(n.$hidden){n.$hidden=false}}k.push(n);n.setIndex(f);n.setRenderedCellCount(j.visibleColumnCount);if(n.getRecord()===d){n.updateRecord(d)}else{n.setRecord(d)}if(j.isSelected(d)){a.push(e)}if(l){for(b=0,g=h.length;b<g;b++){Ext.Array.remove(l,h[b])}a=Ext.Array.merge(a,l)}n.renderElement.setCls(a)},refreshScroller:function(){var a=this;if(a.isPainted()){a.container.getScrollable().getScroller().refresh()}},refresh:function(){var b=this,a=b.container;if(!b.getStore()){if(!b.hasLoadedStore&&!b.getDeferEmptyText()){b.showEmptyText()}return}if(a){b.fireAction("refresh",[b],"doRefresh")}},doRefresh:function(){var b=this,d=b.rows,a=b.getStore(),e=a.getCount();b.rowPositionMap.populate(e,this.topRenderedIndex);if(d.length){if(e){b.hideEmptyText()}b.updateAllRows()}},onBeforeLoad:function(){var a=this.getLoadingText();if(a&&this.isPainted()){this.setMasked({xtype:"loadmask",message:a})}this.hideEmptyText()},updateData:function(b){var a=this.getStore();if(!a){this.setStore(Ext.create("Ext.data.Store",{data:b,autoDestroy:true}))}else{a.add(b)}},applyStore:function(b){var e=this,f=Ext.apply({},e.storeEventHooks,{scope:e}),d,a;if(b){b=Ext.data.StoreManager.lookup(b);if(b&&Ext.isObject(b)&&b.isStore){b.on(f);d=b.getProxy();if(d){a=d.getReader();if(a){a.on("exception","handleException",this)}}}}return b},handleException:function(){this.setMasked(false)},updateStore:function(b,f){var e=this,g=Ext.apply({},e.storeEventHooks,{scope:e}),d,a;if(f&&Ext.isObject(f)&&f.isStore){f.un(g);if(!e.isDestroyed){e.onStoreClear()}if(f.getAutoDestroy()){f.destroy()}else{d=f.getProxy();if(d){a=d.getReader();if(a){a.un("exception","handleException",this)}}}}if(b){if(b.isLoaded()){this.hasLoadedStore=true;e.refresh()}if(b.isLoading()){e.onBeforeLoad()}}},updateEmptyText:function(d,e){var b=this,a;if(e&&b.emptyTextCmp){b.remove(b.emptyTextCmp,true);delete b.emptyTextCmp}if(d){b.emptyTextCmp=b.add({xtype:"component",cls:b.getBaseCls()+"-emptytext",html:d,hidden:true});a=b.getStore();if(a&&b.hasLoadedStore&&!a.getCount()){this.showEmptyText()}}},onLoad:function(a){this.hasLoadedStore=true;this.setMasked(false);if(!a.getCount()){this.showEmptyText()}},onStoreAdd:function(){this.doRefresh()},onStoreRemove:function(){this.doRefresh()},onStoreUpdate:function(){this.doRefresh()},onStoreClear:function(){this.doRefresh()},showEmptyText:function(){if(this.getEmptyText()&&(this.hasLoadedStore||!this.getDeferEmptyText())){this.emptyTextCmp.show()}},hideEmptyText:function(){if(this.getEmptyText()){this.emptyTextCmp.hide()}}});Ext.define("Ext.grid.Grid",{extend:Ext.List,xtype:"grid",config:{defaultType:"gridrow",infinite:true,columns:null,baseCls:Ext.baseCSSPrefix+"grid",useHeaders:false,itemHeight:60,variableHeights:false,headerContainer:{xtype:"headercontainer"},striped:true,itemCls:Ext.baseCSSPrefix+"list-item",scrollToTopOnRefresh:false,titleBar:{xtype:"titlebar",docked:"top"},title:""},platformConfig:[{theme:["Windows"],itemHeight:60}],beforeInitialize:function(){this.container=Ext.factory({xtype:"container",scrollable:{scroller:{autoRefresh:false,direction:"auto",directionLock:true}}});this.callParent()},initialize:function(){var d=this,a=d.getTitleBar(),b=d.getHeaderContainer();d.callParent();if(a){d.container.add(d.getTitleBar())}d.container.doAdd(b);d.scrollElement.addCls(Ext.baseCSSPrefix+"grid-scrollelement")},onTranslate:function(a){this.callParent(arguments);this.getHeaderContainer().scrollTo(a)},applyTitleBar:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.TitleBar)}return a},updateTitle:function(a){this.getTitleBar().setTitle(a)},applyHeaderContainer:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.grid.HeaderContainer)}return a},updateHeaderContainer:function(d,a){var b=this;if(a){a.un({columnsort:"onColumnSort",columnresize:"onColumnResize",columnshow:"onColumnShow",columnhide:"onColumnHide",columnadd:"onColumnAdd",columnremove:"onColumnRemove",scope:b})}if(d){d.on({columnsort:"onColumnSort",columnresize:"onColumnResize",columnshow:"onColumnShow",columnhide:"onColumnHide",columnadd:"onColumnAdd",columnremove:"onColumnRemove",scope:b})}},addColumn:function(a){this.getHeaderContainer().add(a)},removeColumn:function(a){this.getHeaderContainer().remove(a)},insertColumn:function(a,b){this.getHeaderContainer().insert(a,b)},onColumnAdd:function(a,f){if(this.isPainted()){var b=this.listItems,g=b.length,e=a.getColumns().indexOf(f),d,h;for(d=0;d<g;d++){h=b[d];h.insertColumn(e,f)}this.updateTotalColumnWidth();this.fireEvent("columnadd",this,f,e)}},onColumnRemove:function(a,e){if(this.isPainted()){var b=this.listItems,f=b.length,d,g;for(d=0;d<f;d++){g=b[d];g.removeColumn(e)}this.updateTotalColumnWidth();this.fireEvent("columnremove",this,e)}},updateColumns:function(b){if(b&&b.length){var d=b.length,a;for(a=0;a<d;a++){this.addColumn(b[a])}this.updateTotalColumnWidth()}},getColumns:function(){return this.getHeaderContainer().getColumns()},onColumnResize:function(a,f,e){var b=this.listItems,g=b.length,d,h;for(d=0;d<g;d++){h=b[d];h.setColumnWidth(f,e)}this.updateTotalColumnWidth();this.fireEvent("columnresize",f,e)},onColumnShow:function(a,e){var b=this.listItems,f=b.length,d,g;this.updateTotalColumnWidth();for(d=0;d<f;d++){g=b[d];g.showColumn(e)}this.fireEvent("columnshow",this,e)},onColumnHide:function(a,e){var b=this.listItems,f=b.length,d,g;for(d=0;d<f;d++){g=b[d];g.hideColumn(e)}this.updateTotalColumnWidth();this.fireEvent("columnhide",this,e)},onColumnSort:function(a,b,d){if(this.sortedColumn&&this.sortedColumn!==b){this.sortedColumn.setSortDirection(null)}this.sortedColumn=b;this.getStore().sort(b.getDataIndex(),d);this.fireEvent("columnsort",this,b,d)},getTotalColumnWidth:function(){var g=this,d=g.getColumns(),f=d.length,a=0,b,e;for(b=0;b<f;b++){e=d[b];if(!e.isHidden()){a+=e.getWidth()}}return a},updateTotalColumnWidth:function(){var d=this,b=d.getScrollable().getScroller(),a=this.getTotalColumnWidth();d.scrollElement.setWidth(a);b.setSize({x:a,y:b.getSize().y});b.refresh()},setScrollerHeight:function(b){var d=this,a=d.container.getScrollable().getScroller();if(b!=a.givenSize.y){a.setSize({x:a.givenSize.x,y:b});a.refresh()}},createItem:function(b){var e=this,a=e.container,f=e.listItems,d;b.grid=e;d=Ext.factory(b);d.dataview=e;d.$height=b.minHeight;a.doAdd(d);f.push(d);return d}});Ext.define("Ext.grid.plugin.ColumnResizing",{extend:Ext.Component,alias:"plugin.gridcolumnresizing",config:{grid:null},init:function(a){this.setGrid(a)},updateGrid:function(a,b){if(b){b.getHeaderContainer().renderElement.un({pinchstart:"onContainerPinchStart",pinch:"onContainerPinch",pinchend:"onContainerPinchEnd",scope:this})}if(a){a.getHeaderContainer().renderElement.on({pinchstart:"onContainerPinchStart",pinch:"onContainerPinch",pinchend:"onContainerPinchEnd",scope:this})}},onContainerPinchStart:function(d){var b=d.getTarget("."+Ext.baseCSSPrefix+"grid-column"),a;if(b){a=Ext.getCmp(b.id);if(a&&a.getResizable()){this.startColumnWidth=a.getWidth();this.resizeColumn=a;this.startDistance=d.distance;a.renderElement.addCls(Ext.baseCSSPrefix+"grid-column-resizing")}else{d.preventDefault()}}},onContainerPinch:function(d){var b=this.resizeColumn,a=d.distance-this.startDistance;if(b){this.currentColumnWidth=Math.ceil(this.startColumnWidth+a);b.renderElement.setWidth(this.currentColumnWidth)}},onContainerPinchEnd:function(){var a=this.resizeColumn;if(a){a.setWidth(this.currentColumnWidth+1);a.renderElement.removeCls(Ext.baseCSSPrefix+"grid-column-resizing");delete this.resizeColumn}}});Ext.define("Ext.grid.plugin.PagingToolbar",{extend:Ext.Component,alias:"plugin.gridpagingtoolbar",mixins:[Ext.mixin.Bindable],config:{grid:null,currentPage:1,totalPages:0,pageSize:0,totalCount:0,toolbar:{xtype:"toolbar",docked:"bottom",ui:"gray",cls:Ext.baseCSSPrefix+"grid-pagingtoolbar",items:[{xtype:"button",ui:"plain",iconCls:"arrow_left",action:"previouspage",left:0,top:5},{xtype:"component",role:"currentpage",width:20,cls:Ext.baseCSSPrefix+"grid-pagingtoolbar-currentpage"},{xtype:"component",role:"totalpages",width:50,tpl:"&nbsp;/ {totalPages}"},{xtype:"sliderfield",value:1,flex:1,minValue:1,role:"pageslider"},{xtype:"button",ui:"plain",iconCls:"arrow_right",action:"nextpage",right:0,top:5}]}},init:function(a){this.setGrid(a);a.container.add(this.getToolbar());if(a.getStore().getCount()){this.updateCurrentPage(this.getCurrentPage())}},updateGrid:function(a,b){if(b){b.un({updatevisiblecount:"onUpdateVisibleCount",scope:this});b.getStore().un({addrecords:"onTotalCountChange",removerecords:"onTotalCountChange",refresh:"onTotalCountChange",scope:this})}if(a){a.on({updatevisiblecount:"onUpdateVisibleCount",scope:this});a.getStore().on({addrecords:"onTotalCountChange",removerecords:"onTotalCountChange",refresh:"onTotalCountChange",scope:this});this.bind(a,"onScrollBinder","checkPageChange")}},checkPageChange:function(){var d=this.getGrid(),b=this.getPageSize(),f=this.getCurrentPage(),a=this.getTotalCount(),g=d.topVisibleIndex,e=Math.floor(d.topVisibleIndex/b)+1;if(g+b>=a){e++}if(g&&e!==f){this.preventGridScroll=true;this.setCurrentPage(e);this.preventGridScroll=false}},applyToolbar:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Toolbar)}return a},updateToolbar:function(a){if(a){this.currentPage=a.down("component[role=currentpage]");this.totalPages=a.down("component[role=totalpages]");this.pageSlider=a.down("sliderfield[role=pageslider]");this.nextPageButton=a.down("button[action=nextpage]");this.previousPageButton=a.down("button[action=previouspage]");this.pageSlider.on({change:"onPageChange",drag:"onPageSliderDrag",scope:this});this.nextPageButton.on({tap:"onNextPageTap",scope:this});this.previousPageButton.on({tap:"onPreviousPageTap",scope:this});this.currentPage.element.createChild({tag:"span"})}},onPageChange:function(e,b,a,d){if(d!==this.getCurrentPage()){this.setCurrentPage(d)}},onPageSliderDrag:function(e,b,a,d){if(d[0]!==this.getCurrentPage()){this.setCurrentPage(d[0])}},onNextPageTap:function(){var a=this.getCurrentPage()+1;if(a<=this.getTotalPages()){this.setCurrentPage(a)}},onPreviousPageTap:function(){var a=this.getCurrentPage()-1;if(a>0){this.setCurrentPage(a)}},onTotalCountChange:function(a){this.setTotalCount(a.getCount())},onUpdateVisibleCount:function(e,d){d-=1;var b=e.getStore(),a=b.getCount(),f=Math.ceil(a/d);this.setTotalPages(f);this.setPageSize(d)},updateTotalPages:function(a){this.getToolbar();this.totalPages.setData({totalPages:a});this.pageSlider.setMaxValue(a||1);this.updateCurrentPage(this.getCurrentPage())},updateCurrentPage:function(d){var b=this.getGrid(),a;this.getToolbar();this.currentPage.element.dom.firstChild.innerHTML=d;if(this.pageSlider.getValue()!==d){this.pageSlider.setValue(d)}a=this.getPageTopRecord(d);if(b&&!this.preventGridScroll&&a){b.scrollToRecord(a)}this.updatePageButtons()},updateTotalCount:function(a){var b;if(a!==null&&a!==undefined){if(a===0){b=1}else{b=Math.ceil(a/this.getPageSize())}this.setTotalPages(b)}},updatePageButtons:function(){var a=this.getCurrentPage();this.previousPageButton.enable();this.nextPageButton.enable();if(a==this.getTotalPages()){this.nextPageButton.disable()}if(a==1){this.previousPageButton.disable()}},getPageTopRecord:function(g){var e=this.getGrid(),d=e&&e.getStore(),b=this.getPageSize(),f=(g-1)*b,a=d&&d.getAt(f);return a}});Ext.define("Ext.grid.plugin.SummaryRow",{extend:Ext.grid.Row,alias:"plugin.gridsummaryrow",mixins:[Ext.mixin.Bindable],config:{grid:null,cls:Ext.baseCSSPrefix+"grid-summaryrow",emptyText:"",emptyCls:Ext.baseCSSPrefix+"grid-summaryrow-empty",docked:"top",height:32,translatable:{translationMethod:"csstransform"}},init:function(a){this.setGrid(a)},updateGrid:function(d){if(d){var b=d.getColumns(),f=b.length,e=d.getHeaderContainer(),a;d.getStore().onAfter({addrecords:"doUpdateSummary",removerecords:"doUpdateSummary",updaterecord:"doUpdateSummary",refresh:"doUpdateSummary",scope:this});d.getHeaderContainer().on({columnadd:"onColumnAdd",columnremove:"onColumnRemove",columnshow:"onColumnShow",columnhide:"onColumnHide",columnresize:"onColumnResize",scope:this});if(d.initialized){d.container.insertAfter(this,d.getHeaderContainer())}else{d.on("initialize",function(){d.container.insertAfter(this,d.getHeaderContainer())},this,{single:true})}d.addCls(Ext.baseCSSPrefix+"grid-hassummaryrow");for(a=0;a<f;a++){this.onColumnAdd(e,b[a])}this.bind(d,"onScrollBinder","onGridScroll")}},onGridScroll:function(a){if(this.currentX!==a){this.translate(a);this.currentX=a}},onColumnAdd:function(a,b){this.insertColumn(a.getColumns().indexOf(b),b);this.updateRowWidth()},onColumnRemove:function(a,b){this.removeColumn(b);this.updateRowWidth()},onColumnShow:function(a,b){this.showColumn(b);this.updateRowWidth()},onColumnHide:function(a,b){this.hideColumn(b);this.updateRowWidth()},onColumnResize:function(a,d,b){this.setColumnWidth(d,b);this.updateRowWidth()},updateRowWidth:function(){this.setWidth(this.getGrid().getTotalColumnWidth())},doUpdateSummary:function(){var a=this.getGrid(),o=a.getStore(),f=a.getColumns(),j=f.length,d=this.getEmptyText(),l=this.getEmptyCls(),g,e,k,h,p,n,m,b;for(g=0;g<j;g++){e=f[g];k=e.getSummaryType();p=this.getCellByColumn(e);b=Ext.get(p);if(!e.getIgnore()&&k!==null){m=e.getDataIndex();h=e.getSummaryRenderer();if(Ext.isFunction(k)){n=k.call(o,o.data.items.slice(),m)}else{switch(k){case"sum":case"average":case"min":case"max":n=o[k](e.getDataIndex());break;case"count":n=o.getCount();break}}if(h!==null){n=h.call(o,n)}b.removeCls(l);e.updateCell(p,null,n)}else{b.addCls(l);e.updateCell(p,null,d)}}}});Ext.define("Ext.plugin.SortableList",{extend:Ext.Component,alias:"plugin.sortablelist",mixins:[Ext.mixin.Bindable],config:{list:null,handleSelector:"."+Ext.baseCSSPrefix+"list-sortablehandle"},init:function(a){this.setList(a)},updateList:function(a){if(a){if(a.initialized){this.attachListeners()}else{a.on({initialize:"attachListeners",scope:this,single:true})}}},attachListeners:function(){var b=this.getList(),a=b.getScrollable().getScroller().getContainer();this.scrollerElement=a;a.onBefore({dragstart:"onScrollerDragStart",scope:this})},onScrollerDragStart:function(b,a){if(Ext.DomQuery.is(a,this.getHandleSelector())){if(!this.animating){this.onDragStart(b,a)}return false}},onDragStart:function(d){var f=Ext.getCmp(d.getTarget("."+Ext.baseCSSPrefix+"list-item").id),b=this.getList(),a=b.getStore();this.scrollerElement.on({drag:"onDrag",dragend:"onDragEnd",scope:this});this.positionMap=b.getItemMap();this.listStore=a;this.previousIndexDistance=0;this.dragRow=f;this.dragRecord=f.getRecord();this.dragRowIndex=this.currentDragRowIndex=f.$dataIndex;this.dragRowHeight=this.positionMap.getItemHeight(this.dragRowIndex);if(b.getInfinite()){this.startTranslate=this.positionMap.map[this.dragRowIndex]}else{f.translate(0,0);this.startTranslate=0}f.addCls(Ext.baseCSSPrefix+"list-item-dragging")},onDrag:function(s){var r=this.getList(),m=r.listItems,n=r.getStore().data,v=this.dragRow,h=n.getKey(v.getRecord()),o=r.getListItemInfo(),d=this.positionMap,g=0,p,u,l,k,x,w,q,b,f,a,j;this.dragRowPosition=this.startTranslate+s.deltaY;v.translate(0,this.dragRowPosition);x=d.findIndex(this.dragRowPosition+(this.dragRowHeight/2));k=r.getItemAt(x);if(k){g=x-this.currentDragRowIndex;if(g!==0){j=(g<0);for(p=0,l=Math.abs(g);p<l;p++){if(j){q=this.currentDragRowIndex-p;u=r.getItemAt(q-1)}else{q=this.currentDragRowIndex+p;u=r.getItemAt(q+1)}b=d.map[q];u.translate(0,b);f=u.getRecord();a=n.getKey(f);Ext.Array.remove(n.items,f);Ext.Array.remove(n.all,f);n.items.splice(q,0,f);n.all.splice(q,0,f);n.indices[h]=n.indices[a];n.indices[a]=q;r.updateListItem(u,q,o);u.$position=b}w=m.indexOf(v);Ext.Array.remove(m,v);m.splice(w+g,0,v);v.$dataIndex=x;v.$position=d.map[x];this.currentDragRowIndex=x}}},onDragEnd:function(){var b=this,f=this.dragRow,d=this.getList(),e=d.getListItemInfo(),a=f.$position;this.scrollerElement.un({drag:"onDrag",dragend:"onDragEnd",scope:this});this.animating=true;f.getTranslatable().on("animationend",function(){f.removeCls(Ext.baseCSSPrefix+"list-item-dragging");d.updateListItem(f,f.$dataIndex,e);f.$position=a;d.fireEvent("dragsort",d,f,this.currentDragRowIndex,this.dragRowIndex);this.animating=false},b,{single:true});f.translate(0,a,{duration:100})}});Ext.define("Ext.grid.plugin.ViewOptions",{extend:Ext.Component,alias:"plugin.gridviewoptions",config:{grid:null,sheetWidth:320,sheet:{baseCls:Ext.baseCSSPrefix+"grid-viewoptions",xtype:"sheet",items:[{docked:"top",xtype:"titlebar",title:"Customize",items:{xtype:"button",text:"Done",ui:"action",align:"right",role:"donebutton"}}],hideOnMaskTap:false,enter:"right",exit:"right",modal:false,translatable:{translationMethod:"csstransform"},right:0,layout:"fit",stretchY:true},columnList:{xtype:"nestedlist",title:"Column",listConfig:{plugins:[{type:"sortablelist",handleSelector:".x-column-options-sortablehandle"}],mode:"MULTI",infinite:true,itemTpl:['<div class="x-column-options-sortablehandle"></div>','<tpl if="header">','<div class="x-column-options-folder"></div>',"<tpl else>",'<div class="x-column-options-leaf"></div>',"</tpl>",'<div class="x-column-options-text">{text}</div>','<div class="x-column-options-visibleindicator"></div>'],triggerEvent:null,bufferSize:6,minimumBufferSize:6},store:{type:"tree",fields:["id","text","header"],root:{text:"Columns"}},clearSelectionOnListChange:false},visibleIndicatorSelector:".x-column-options-visibleindicator"},sheetVisible:false,init:function(a){this.setGrid(a);a.add(this.getSheet());this.getSheet().translate(this.getSheetWidth());this.getSheet().down("button[role=donebutton]").on({tap:"onDoneButtonTap",scope:this})},updateGrid:function(a,b){if(b){b.getHeaderContainer().renderElement.un({dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",scope:this});b.getHeaderContainer().un({columnadd:"onColumnAdd",columnremove:"onColumnRemove",scope:this})}if(a){a.getHeaderContainer().renderElement.on({dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",scope:this});a.getHeaderContainer().on({columnadd:"onColumnAdd",columnremove:"onColumnRemove",columnhide:"onColumnHide",columnshow:"onColumnShow",scope:this})}},applySheet:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Sheet)}return a},applyColumnList:function(a){if(a&&!a.isComponent){a=Ext.factory(a,Ext.Container)}return a},updateColumnList:function(a){if(a){a.on({listchange:"onListChange",scope:this});a.on({selectionchange:"onColumnToggle",dragsort:"onColumnReorder",delegate:"> list",scope:this});this.attachTapListeners()}},updateSheet:function(b){var a=this.getSheetWidth();b.setWidth(a);b.translate(a);b.add(this.getColumnList())},onDoneButtonTap:function(){this.hideViewOptions()},onColumnReorder:function(d,k,j){var a=Ext.getCmp(k.getRecord().get("id")),g=a.getParent(),f=g.getInnerItems(),b,e,h;for(b=0,e=j;b<e;b++){h=f[b];if(!h.isHeaderGroup&&h.getIgnore()){j+=1}}this.isMoving=true;g.remove(a,false);g.insert(j,a);this.isMoving=false},attachTapListeners:function(){var a=this.getColumnList().getActiveItem();if(!a.hasAttachedTapListeners){a.onBefore({itemtap:"onListItemTap",scope:this});a.hasAttachedTapListeners=true}},onListChange:function(d,g){var k=g.getStore(),j=k.getNode(),a=j.childNodes,h=a.length,e,b,f;for(e=0;e<h;e++){f=a[e];b=Ext.getCmp(f.getId());if(b.isHidden()&&g.isSelected(f)){g.deselect(f,true,true)}else{if(!b.isHidden()&&!g.isSelected(f)){g.select(f,true,true)}}}this.attachTapListeners()},onListItemTap:function(d,b,g,a,f){if(Ext.DomQuery.is(f.target,this.getVisibleIndicatorSelector())){this.onVisibleIndicatorTap(g,a,b);return false}},onVisibleIndicatorTap:function(b,a){var d=this.getColumnList().getActiveItem();if(d.isSelected(a)){d.deselect(a)}else{d.select(a,true)}},onColumnToggle:function(d,e){var b=e[0],a=Ext.getCmp(b.get("id"));if(d.isSelected(b)){a.show()}else{a.hide()}},onColumnHide:function(e,d){var f=this.getColumnList(),g=f.getActiveItem(),b=g.getStore(),a=b.getById(d.getId());if(a&&g.isSelected(a)){g.deselect(a,true,true)}},onColumnShow:function(e,d){var f=this.getColumnList(),g=f.getActiveItem(),b=g.getStore(),a=b.getById(d.getId());if(a&&!g.isSelected(a)){g.select(a,true,true)}},onColumnAdd:function(b,d,h){if(d.getIgnore()||this.isMoving){return}var e=this.getColumnList(),a=e.getActiveItem(),k=e.getStore(),j=k.getRoot(),f={id:d.getId(),text:d.getText(),leaf:true},g;if(h){if(h.innerIndexOf(d)===0){j=j.appendChild({header:true,id:h.getId(),text:h.getText()});if(!h.isHidden()){a.select(j,true,true)}}else{j=j.findChild("id",h.getId())}j.appendChild(f)}else{g=j.appendChild(f);if(!d.isHidden()){a.select(g,true,true)}}},onColumnRemove:function(e,d){if(d.getIgnore()||this.isMoving){return}var b=this.getColumnList().getStore().getRoot(),a=b.findChild("id",d.getId(),true);if(a){a.parentNode.removeChild(a,true)}},onDragStart:function(){var a=this.getSheetWidth(),b=this.getSheet();if(!this.sheetVisible){b.translate(a);this.startTranslate=a}else{b.translate(0);this.startTranslate=0}},onDrag:function(a){this.getSheet().translate(Math.max(this.startTranslate+a.deltaX,0))},onDragEnd:function(b){var a=this;if(b.flick.velocity.x>0.1){a.hideViewOptions()}else{a.showViewOptions()}},hideViewOptions:function(){var a=this.getSheet();a.translate(this.getSheetWidth(),0,{duration:100});a.getTranslatable().on("animationend",function(){if(a.getModal()){a.getModal().destroy();a.setModal(null)}},this,{single:true});this.sheetVisible=false},showViewOptions:function(){if(!this.sheetVisible){var a=this.getSheet(),b=null;a.translate(0,0,{duration:100});a.getTranslatable().on("animationend",function(){a.setModal(true);b=a.getModal();b.element.onBefore({tap:"hideViewOptions",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",scope:this})},this,{single:true});this.sheetVisible=true}}});Ext.define("Ext.plugin.ListPaging",{extend:Ext.Component,alias:"plugin.listpaging",config:{autoPaging:false,loadMoreText:"Load More...",noMoreRecordsText:"No More Records",loadTpl:['<div class="{cssPrefix}loading-spinner" style="font-size: 180%; margin: 10px auto;">','<span class="{cssPrefix}loading-top"></span>','<span class="{cssPrefix}loading-right"></span>','<span class="{cssPrefix}loading-bottom"></span>','<span class="{cssPrefix}loading-left"></span>',"</div>",'<div class="{cssPrefix}list-paging-msg">{message}</div>'].join(""),loadMoreCmp:{xtype:"component",baseCls:Ext.baseCSSPrefix+"list-paging",scrollDock:"bottom",hidden:true},loadMoreCmpAdded:false,loadingCls:Ext.baseCSSPrefix+"loading",list:null,scroller:null,loading:false},init:function(d){var a=d.getScrollable().getScroller(),b=d.getStore();this.setList(d);this.setScroller(a);this.bindStore(d.getStore());this.addLoadMoreCmp();d.updateStore=Ext.Function.createInterceptor(d.updateStore,this.bindStore,this);if(this.getAutoPaging()){a.on({scrollend:this.onScrollEnd,scope:this})}},bindStore:function(a,b){if(b){b.un({beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad,filter:this.onFilter,scope:this})}if(a){a.on({beforeload:this.onStoreBeforeLoad,load:this.onStoreLoad,filter:this.onFilter,scope:this})}},disableDataViewMask:function(){var a=this.getList();this._listMask=a.getLoadingText();a.setLoadingText(null)},enableDataViewMask:function(){if(this._listMask){var a=this.getList();a.setLoadingText(this._listMask);delete this._listMask}},applyLoadTpl:function(a){return(Ext.isObject(a)&&a.isTemplate)?a:new Ext.XTemplate(a)},applyLoadMoreCmp:function(a){a=Ext.merge(a,{html:this.getLoadTpl().apply({cssPrefix:Ext.baseCSSPrefix,message:this.getLoadMoreText()}),scrollDock:"bottom",listeners:{tap:{fn:this.loadNextPage,scope:this,element:"element"}}});return Ext.factory(a,Ext.Component,this.getLoadMoreCmp())},onScrollEnd:function(b,a,e){var d=this.getList();if(!this.getLoading()&&e>=b.maxPosition.y){this.currentScrollToTopOnRefresh=d.getScrollToTopOnRefresh();d.setScrollToTopOnRefresh(false);this.loadNextPage()}},updateLoading:function(a){var b=this.getLoadMoreCmp(),d=this.getLoadingCls();if(a){b.addCls(d)}else{b.removeCls(d)}},onStoreBeforeLoad:function(a){if(a.getCount()===0){this.getLoadMoreCmp().hide()}},onStoreLoad:function(a){var e=this.getLoadMoreCmp(),b=this.getLoadTpl(),d=this.storeFullyLoaded()?this.getNoMoreRecordsText():this.getLoadMoreText();if(a.getCount()){e.show()}this.setLoading(false);e.setHtml(b.apply({cssPrefix:Ext.baseCSSPrefix,message:d}));if(this.currentScrollToTopOnRefresh!==undefined){this.getList().setScrollToTopOnRefresh(this.currentScrollToTopOnRefresh);delete this.currentScrollToTopOnRefresh}this.enableDataViewMask()},onFilter:function(a){if(a.getCount()===0){this.getLoadMoreCmp().hide()}else{this.getLoadMoreCmp().show()}},addLoadMoreCmp:function(){var b=this.getList(),a=this.getLoadMoreCmp();if(!this.getLoadMoreCmpAdded()){b.add(a);b.fireEvent("loadmorecmpadded",this,b);this.setLoadMoreCmpAdded(true)}return a},storeFullyLoaded:function(){var a=this.getList().getStore(),b=a.getTotalCount();return b!==null?a.getTotalCount()<=(a.currentPage*a.getPageSize()):false},loadNextPage:function(){var a=this;if(!a.storeFullyLoaded()){a.disableDataViewMask();a.setLoading(true);a.getList().getStore().nextPage({addRecords:true})}}});Ext.define("Ext.plugin.PullRefresh",{extend:Ext.Component,alias:"plugin.pullrefresh",config:{list:null,pullText:"Pull down to refresh...",releaseText:"Release to refresh...",loadingText:"Loading...",loadedText:"Loaded.",lastUpdatedText:"Last Updated:&nbsp;",scrollerAutoRefresh:false,autoSnapBack:true,snappingAnimationDuration:300,lastUpdatedDateFormat:"m/d/Y h:iA",overpullSnapBackDuration:300,pullTpl:['<div class="x-list-pullrefresh-arrow"></div>','<div class="x-loading-spinner">','<span class="x-loading-top"></span>','<span class="x-loading-right"></span>','<span class="x-loading-bottom"></span>','<span class="x-loading-left"></span>',"</div>",'<div class="x-list-pullrefresh-wrap">','<h3 class="x-list-pullrefresh-message">{message}</h3>','<div class="x-list-pullrefresh-updated">{updated}</div>',"</div>"].join(""),translatable:true},$state:"pull",getState:function(){return this.$state},setState:function(a){this.$state=a;this.updateView()},$isSnappingBack:false,getIsSnappingBack:function(){return this.$isSnappingBack},setIsSnappingBack:function(a){this.$isSnappingBack=a},init:function(b){var a=this;a.setList(b);a.initScrollable()},getElementConfig:function(){return{reference:"element",classList:["x-unsized"],children:[{reference:"innerElement",className:Ext.baseCSSPrefix+"list-pullrefresh"}]}},initScrollable:function(){var b=this,e=b.getList(),d=e.getScrollable(),a;if(!d){return}a=d.getScroller();a.setAutoRefresh(this.getScrollerAutoRefresh());b.lastUpdated=new Date();e.insert(0,b);a.on({scroll:b.onScrollChange,scope:b});this.updateView()},applyPullTpl:function(a){if(a instanceof Ext.XTemplate){return a}else{return new Ext.XTemplate(a)}},updateList:function(a,d){var b=this;if(a&&a!=d){a.on({order:"after",scrollablechange:b.initScrollable,scope:b})}else{if(d){d.un({order:"after",scrollablechange:b.initScrollable,scope:b})}}},getPullHeight:function(){return this.innerElement.getHeight()},fetchLatest:function(){var b=this.getList().getStore(),d=b.getProxy(),a;a=Ext.create("Ext.data.Operation",{page:1,start:0,model:b.getModel(),limit:b.getPageSize(),action:"read",sorters:b.getSorters(),filters:b.getRemoteFilter()?b.getFilters():[]});d.read(a,this.onLatestFetched,this)},onLatestFetched:function(e){var k=this.getList().getStore(),b=k.getData(),d=e.getRecords(),a=d.length,h=[],j,g,f;for(f=0;f<a;f++){j=d[f];g=b.getByKey(j.getId());if(g){g.set(j.getData())}else{h.push(j)}g=undefined}k.insert(0,h);this.setState("loaded");this.fireEvent("latestfetched",this,h);if(this.getAutoSnapBack()){this.snapBack()}},snapBack:function(d){if(this.getState()!=="loaded"&&d!==true){return}var b=this.getList(),a=b.getScrollable().getScroller();a.refresh();a.minPosition.y=0;a.on({scrollend:this.onSnapBackEnd,single:true,scope:this});this.setIsSnappingBack(true);a.scrollTo(null,0,{duration:this.getSnappingAnimationDuration()})},onSnapBackEnd:function(){this.setState("pull");this.setIsSnappingBack(false)},onScrollChange:function(b,a,f){if(f<=0){var e=this.getPullHeight(),d=this.getIsSnappingBack();if(this.getState()==="loaded"&&!d){this.snapBack()}if(this.getState()!=="loading"&&this.getState()!=="loaded"){if(-f>=e+10){this.setState("release");b.getContainer().onBefore({dragend:"onScrollerDragEnd",single:true,scope:this})}else{if((this.getState()==="release")&&(-f<e+10)){this.setState("pull");b.getContainer().unBefore({dragend:"onScrollerDragEnd",single:true,scope:this})}}}this.getTranslatable().translate(0,-f)}},onScrollerDragEnd:function(){if(this.getState()!=="loading"){var d=this.getList(),a=d.getScrollable().getScroller(),b=a.getTranslatable();this.setState("loading");b.setEasingY({duration:this.getOverpullSnapBackDuration()});a.minPosition.y=-this.getPullHeight();a.on({scrollend:"fetchLatest",single:true,scope:this})}},updateView:function(){var f=this.getState(),e=this.getLastUpdatedText()+Ext.util.Format.date(this.lastUpdated,this.getLastUpdatedDateFormat()),d={state:f,updated:e},b=f.charAt(0).toUpperCase()+f.slice(1).toLowerCase(),a="get"+b+"Text";if(this[a]&&Ext.isFunction(this[a])){d.message=this[a].call(this)}this.innerElement.removeCls(["loaded","loading","release","pull"],Ext.baseCSSPrefix+"list-pullrefresh");this.innerElement.addCls(this.getState(),Ext.baseCSSPrefix+"list-pullrefresh");this.getPullTpl().overwrite(this.innerElement,d)}},function(){Ext.deprecateClassMethod(this,"setPullRefreshText","setPullText");Ext.deprecateClassMethod(this,"setReleaseRefreshText","setReleaseText");this.override({constructor:function(a){if(a){if(a.hasOwnProperty("pullReleaseText")){a.releaseText=a.pullReleaseText;delete a.pullReleaseText}if(a.hasOwnProperty("pullRefreshText")){a.pullText=a.pullRefreshText;delete a.pullRefreshText}}this.callParent([a])}})});Ext.define("Ext.tab.Tab",{extend:Ext.Button,xtype:"tab",alternateClassName:"Ext.Tab",isTab:true,config:{baseCls:Ext.baseCSSPrefix+"tab",pressedCls:Ext.baseCSSPrefix+"tab-pressed",activeCls:Ext.baseCSSPrefix+"tab-active",active:false,title:"&nbsp;"},updateIconCls:function(b,a){this.callParent([b,a]);if(a){this.removeCls("x-tab-icon")}if(b){this.addCls("x-tab-icon")}},updateTitle:function(a){this.setText(a)},updateActive:function(d,b){var a=this.getActiveCls();if(d&&!b){this.element.addCls(a);this.fireEvent("activate",this)}else{if(b){this.element.removeCls(a);this.fireEvent("deactivate",this)}}}},function(){this.override({activate:function(){this.setActive(true)},deactivate:function(){this.setActive(false)}})});Ext.define("Ext.tab.Bar",{extend:Ext.Toolbar,alternateClassName:"Ext.TabBar",xtype:"tabbar",config:{baseCls:Ext.baseCSSPrefix+"tabbar",defaultType:"tab",layout:{type:"hbox",align:"middle"}},eventedConfig:{activeTab:null},platformConfig:[{theme:["Blackberry","CupertinoClassic","MountainView"],defaults:{flex:1}}],initialize:function(){var a=this;a.callParent();a.on({tap:"onTabTap",delegate:"> tab",scope:a})},onTabTap:function(a){this.setActiveTab(a)},applyActiveTab:function(b,d){if(!b&&b!==0){return}var a=this.parseActiveTab(b);if(!a){return}return a},doSetDocked:function(a){var d=this.getLayout(),e=this.getInitialConfig(),b;if(!e.layout||!e.layout.pack){b=(a=="bottom")?"center":"left";if(d.isLayout){d.setPack(b)}else{d.pack=(d&&d.pack)?d.pack:b}}this.callParent(arguments)},doSetActiveTab:function(b,a){if(b){b.setActive(true)}if(a&&a.parent){a.setActive(false)}},parseActiveTab:function(a){if(typeof a=="number"){return this.getItems().items[a]}else{if(typeof a=="string"){a=Ext.getCmp(a)}}return a}});Ext.define("Ext.tab.Panel",{extend:Ext.Container,xtype:"tabpanel",alternateClassName:"Ext.TabPanel",config:{ui:"dark",tabBar:true,tabBarPosition:"top",layout:{type:"card",animation:{type:"slide",direction:"left"}},cls:Ext.baseCSSPrefix+"tabpanel"},initialize:function(){this.callParent();this.on({order:"before",activetabchange:"doTabChange",delegate:"> tabbar",scope:this});this.on({disabledchange:"onItemDisabledChange",delegate:"> component",scope:this})},platformConfig:[{theme:["Blackberry"],tabBarPosition:"bottom"}],applyScrollable:function(){return false},updateUi:function(a,b){this.callParent(arguments);if(this.initialized){this.getTabBar().setUi(a)}},doSetActiveItem:function(e,l){if(e){var g=this.getInnerItems(),h=g.indexOf(l),k=g.indexOf(e),f=h>k,d=this.getLayout().getAnimation(),b=this.getTabBar(),j=b.parseActiveTab(h),a=b.parseActiveTab(k);if(d&&d.setReverse){d.setReverse(f)}this.callParent(arguments);if(k!=-1){this.forcedChange=true;b.setActiveTab(k);this.forcedChange=false;if(j){j.setActive(false)}if(a){a.setActive(true)}}}},doTabChange:function(a,e){var b=this.getActiveItem(),d;this.setActiveItem(a.indexOf(e));d=this.getActiveItem();return this.forcedChange||b!==d},applyTabBar:function(a){if(a===true){a={}}if(a){Ext.applyIf(a,{ui:this.getUi(),docked:this.getTabBarPosition()})}return Ext.factory(a,Ext.tab.Bar,this.getTabBar())},updateTabBar:function(a){if(a){this.add(a);this.setTabBarPosition(a.getDocked())}},updateTabBarPosition:function(b){var a=this.getTabBar();if(a){a.setDocked(b)}},onItemAdd:function(f){var m=this;if(!f.isInnerItem()){return m.callParent(arguments)}var d=m.getTabBar(),q=f.getInitialConfig(),e=q.tab||{},h=(f.getTitle)?f.getTitle():q.title,k=(f.getIconCls)?f.getIconCls():q.iconCls,l=(f.getHidden)?f.getHidden():q.hidden,p=(f.getDisabled)?f.getDisabled():q.disabled,r=(f.getBadgeText)?f.getBadgeText():q.badgeText,b=m.getInnerItems(),j=b.indexOf(f),n=d.getItems(),a=d.getActiveTab(),o=(n.length>=b.length)&&n.getAt(j),g;if(h&&!e.title){e.title=h}if(k&&!e.iconCls){e.iconCls=k}if(l&&!e.hidden){e.hidden=l}if(p&&!e.disabled){e.disabled=p}if(r&&!e.badgeText){e.badgeText=r}g=Ext.factory(e,Ext.tab.Tab,o);if(!o){d.insert(j,g)}f.tab=g;m.callParent(arguments);if(!a&&a!==0){d.setActiveTab(d.getActiveItem())}},onItemDisabledChange:function(a,b){if(a&&a.tab){a.tab.setDisabled(b)}},onItemRemove:function(b,a){this.getTabBar().remove(b.tab,this.getAutoDestroy());this.callParent(arguments)}},function(){});Ext.define("Ext.ux.picker.DateTime",{extend:Ext.picker.Picker,xtype:"datetimepicker",alternateClassName:"Ext.ux.DateTimePicker",config:{yearFrom:1980,yearTo:new Date().getFullYear(),monthText:(Ext.os.deviceType.toLowerCase()=="phone")?"M":"Month",dayText:(Ext.os.deviceType.toLowerCase()=="phone")?"j":"Day",yearText:(Ext.os.deviceType.toLowerCase()=="phone")?"Y":"Year",hourText:(Ext.os.deviceType.toLowerCase()=="phone")?"H":"Hour",minuteText:(Ext.os.deviceType.toLowerCase()=="phone")?"i":"Minute",ampmText:(Ext.os.deviceType.toLowerCase()=="phone")?"A":"AM/PM",slotOrder:["month","day","year","hour","minute","ampm"],minuteInterval:15,ampm:false,},initialize:function(){this.callParent();this.on({scope:this,delegate:"> slot",slotpick:this.onSlotPick})},setValue:function(b,a){if(Ext.isDate(b)){ampm="AM";currentHours=hour=b.getHours();if(this.getAmpm()){if(currentHours>12){ampm="PM";hour-=12}else{if(currentHours==12){ampm="PM"}else{if(currentHours==0){hour=12}}}}b={day:b.getDate(),month:b.getMonth()+1,year:b.getFullYear(),hour:hour,minute:b.getMinutes(),ampm:ampm}}this.callParent([b,a])},getValue:function(){var n={},a,l,e,d,j=this.getItems().items,h=j.length,p,f;for(f=0;f<h;f++){p=j[f];if(p instanceof Ext.picker.Slot){n[p.getName()]=p.getValue()}}a=this.getDaysInMonth(n.month,n.year);l=Math.min(n.day,a),e=n.hour,d=n.minute;var k=(isNaN(n.year))?new Date().getFullYear():n.year,b=(isNaN(n.month))?(new Date().getMonth()):(n.month-1),o=(isNaN(l))?(new Date().getDate()):l,m=(isNaN(e))?new Date().getHours():e,g=(isNaN(d))?new Date().getMinutes():d;if(n.ampm&&n.ampm=="PM"&&m<12){m=m+12}if(n.ampm&&n.ampm=="AM"&&m==12){m=0}return new Date(k,b,o,m,g)},updateYearFrom:function(){if(this.initialized){this.createSlots()}},updateYearTo:function(){if(this.initialized){this.createSlots()}},updateMonthText:function(a,b){var g=this.getInnerItems,f=g.length,e,d;if(this.initialized){for(d=0;d<f;d++){e=g[d];if((typeof e.title=="string"&&e.title==b)||(e.title.html==b)){e.setTitle(a)}}}},updateDayText:function(a,d){var g=this.getInnerItems,f=g.length,e,b;if(this.initialized){for(b=0;b<f;b++){e=g[b];if((typeof e.title=="string"&&e.title==d)||(e.title.html==d)){e.setTitle(a)}}}},updateYearText:function(f){var e=this.getInnerItems,d=e.length,b,a;if(this.initialized){for(a=0;a<d;a++){b=e[a];if(b.title==this.yearText){b.setTitle(f)}}}},constructor:function(){this.callParent(arguments);this.createSlots()},createSlots:function(){var s=this,g=this.getSlotOrder(),d=s.getYearFrom(),b=s.getYearTo(),n=[],e=[],h=[],q=[],o=[],m=[],k,r,p,a;if(!this.getAmpm()){var f=g.indexOf("ampm");if(f>=0){g.splice(f)}}if(d>b){r=d;d=b;b=r}for(p=d;p<=b;p++){n.push({text:p,value:p})}a=this.getDaysInMonth(1,new Date().getFullYear());for(p=0;p<a;p++){e.push({text:p+1,value:p+1})}for(p=0,k=Ext.Date.monthNames.length;p<k;p++){h.push({text:(Ext.os.deviceType.toLowerCase()=="phone")?Ext.Date.monthNames[p].substring(0,3):Ext.Date.monthNames[p],value:p+1})}var u=(this.getAmpm())?12:23;var j=(this.getAmpm())?1:0;for(p=j;p<=u;p++){q.push({text:this.pad2(p),value:p})}for(p=0;p<60;p+=this.getMinuteInterval()){o.push({text:this.pad2(p),value:p})}m.push({text:"AM",value:"AM"},{text:"PM",value:"PM"});var l=[];g.forEach(function(v){l.push(this.createSlot(v,e,h,n,q,o,m))},this);s.setSlots(l)},createSlot:function(e,h,a,g,b,f,d){switch(e){case"year":return{name:"year",align:(Ext.os.deviceType.toLowerCase()=="phone")?"left":"center",data:g,title:this.getYearText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1.3:3};case"month":return{name:e,align:(Ext.os.deviceType.toLowerCase()=="phone")?"left":"right",data:a,title:this.getMonthText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1.2:4};case"day":return{name:"day",align:(Ext.os.deviceType.toLowerCase()=="phone")?"left":"center",data:h,title:this.getDayText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?0.9:2};case"hour":return{name:"hour",align:(Ext.os.deviceType.toLowerCase()=="phone")?"left":"center",data:b,title:this.getHourText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?0.9:2};case"minute":return{name:"minute",align:(Ext.os.deviceType.toLowerCase()=="phone")?"left":"center",data:f,title:this.getMinuteText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?0.9:2};case"ampm":return{name:"ampm",align:(Ext.os.deviceType.toLowerCase()=="phone")?"left":"center",data:d,title:this.getAmpmText(),flex:(Ext.os.deviceType.toLowerCase()=="phone")?1.1:2}}},onSlotPick:function(b,d,f,e){var a=b.getStore().getAt(b.selectedIndex).get(b.getValueField());b.setValue(a);if(b.getName()==="month"||b.getName()==="year"){this.repopulateDaySlot()}},repopulateDaySlot:function(){var f=this.getDaySlot(),e=[],d=this.getSlotByName("month").getValue(),b=this.getSlotByName("year").getValue(),a;a=this.getDaysInMonth(d,b);for(i=0;i<a;i++){e.push({text:i+1,value:i+1})}if(f.getData().length==e.length){return}f.setData(e)},getSlotByName:function(a){return this.down("pickerslot[name="+a+"]")},getDaySlot:function(){return this.getSlotByName("day")},getDaysInMonth:function(d,b){var a=[31,28,31,30,31,30,31,31,30,31,30,31];return d==2&&this.isLeapYear(b)?29:a[d-1]},isLeapYear:function(a){return !!((a&3)===0&&(a%100||(a%400===0&&a)))},pad2:function(a){return(a<10?"0":"")+a}});Ext.define("Ext.ux.field.DateTimePicker",{extend:Ext.field.DatePicker,alternateClassName:"Ext.form.DateTimePicker",xtype:"datetimepickerfield",config:{ui:"select",picker:true,clearIcon:false,destroyPickerOnHide:false,dateTimeFormat:"m/d/Y h:i:A",component:{useMask:true}},initialize:function(){var b=this,a=b.getComponent();b.callParent();a.on({scope:b,masktap:"onMaskTap"});a.doMaskTap=Ext.emptyFn;if(Ext.browser.is.AndroidStock2){a.input.dom.disabled=true}},syncEmptyCls:Ext.emptyFn,applyValue:function(a){if(!Ext.isDate(a)&&!Ext.isObject(a)){a=null}if(Ext.isObject(a)){a=new Date(a.year,a.month-1,a.day,a.hour,a.minute)}return a},updateValue:function(b){var a=this._picker;if(a&&a.isPicker){a.setValue(b)}if(b!==null){this.getComponent().setValue(Ext.Date.format(b,this.getDateTimeFormat()||Ext.util.Format.defaultDateFormat))}else{this.getComponent().setValue("")}if(this._picker&&this._picker instanceof Ext.ux.picker.DateTime){this._picker.setValue(b)}},updateDateFormat:function(d,a){var b=this.getValue();if(d!=a&&Ext.isDate(b)&&this._picker&&this._picker instanceof Ext.ux.picker.DateTime){this.getComponent().setValue(Ext.Date.format(b,d||Ext.util.Format.defaultDateFormat))}},getValue:function(){if(this._picker&&this._picker instanceof Ext.ux.picker.DateTime){return this._picker.getValue()}return this._value},getFormattedValue:function(b){var a=this.getValue();console.log(this.getDateTimeFormat(),"format");return(Ext.isDate(a))?Ext.Date.format(a,b||this.getDateTimeFormat()||Ext.util.Format.defaultDateFormat):a},applyPicker:function(b,a){if(a&&a.isPicker){b=a.setConfig(b)}return b},getPicker:function(){var b=this._picker,d=this.getValue();if(b&&!b.isPicker){var a=b;b=Ext.factory(a,Ext.ux.picker.DateTime);b.on({scope:this,cancel:"onPickerCancel",change:"onPickerChange",hide:"onPickerHide"});if(d!==null){b.setValue(d)}Ext.Viewport.add(b);this._picker=b;this._picker.config=a}return b},onMaskTap:function(){if(this.getDisabled()){return false}if(this.getReadOnly()){return false}this.getPicker().show();return false},onPickerCancel:function(b,a){this._picker=this._picker.config;b.destroy();return true},onPickerChange:function(a,d){var b=this;b.setValue(d);b.fireEvent("change",b,b.getValue())},onPickerHide:function(){var a=this.getPicker();if(this.getDestroyPickerOnHide()&&a){a.destroy();this._picker=true}},reset:function(){this.setValue(this.originalValue)},destroy:function(){var a=this.getPicker();if(a&&a.isPicker){a.destroy()}this.callParent(arguments)}});Ext.define("Ext.ux.field.Multiselect",{extend:Ext.field.Select,alias:"widget.multiselectfield",config:{delimiter:",",mode:"MULTI",doneButton:true,clearButton:false},applyDoneButton:function(a){if(a){if(Ext.isBoolean(a)){a={}}if(typeof a=="string"){a={text:a}}Ext.applyIf(a,{text:"Done",ui:"action",height:"20px",width:"40%",listeners:{tap:this.onDoneButtonTap,scope:this}})}return Ext.factory(a,"Ext.Button",this.getDoneButton())},applyClearButton:function(a){if(a){if(Ext.isBoolean(a)){a={}}if(typeof a=="string"){a={text:a}}Ext.applyIf(a,{text:"Clear",ui:"action",height:"20px",width:"40%",listeners:{tap:this.onClearButtonTap,scope:this}})}return Ext.factory(a,"Ext.Button",this.getClearButton())},getTabletPicker:function(){var d=this,a=d.getDefaultTabletPickerConfig(),e=d.getMode(),b;if(!d.listPanel){d.listPanel=Ext.create("Ext.Panel",Ext.apply({left:0,top:0,modal:true,cls:Ext.baseCSSPrefix+"select-overlay",layout:"fit",hideOnMaskTap:true,width:Ext.os.is.Phone?"14em":"18em",height:(Ext.os.is.BlackBerry&&Ext.os.version.getMajor()===10)?"12em":(Ext.os.is.Phone?"12.5em":"22em"),items:[{xtype:"list",mode:e,store:d.getStore(),itemTpl:'<span class="x-list-label">{'+d.getDisplayField()+":htmlEncode}</span>"},{xtype:"toolbar",docked:"bottom",layout:{pack:"center",type:"hbox"}}]},a));if(e==="SINGLE"){d.listPanel.down("list").on("itemtap",d.onListTap,d)}else{b=d.listPanel.down("toolbar");a=this.getClearButton();if(a){b.add(a)}b.add(this.getDoneButton())}}return d.listPanel},onListTap:function(d,b,e,a){this.setValue(a);this.callParent()},onDoneButtonTap:function(){var a=this.listPanel.down("list").getSelection();this.setValue(a);this.superclass.onListTap.call(this)},onClearButtonTap:function(){this.listPanel.down("list").deselectAll();this.setValue(null);this.superclass.onListTap.call(this)},applyValue:function(a){this.getOptions();return this.getValueFromRecords(a,this.getValueField())},updateValue:function(e,a){var b=this,d=b.convertValue(e,b.getValueField(),b.getDisplayField());d=d.join(b.getDelimiter());b.superclass.superclass.updateValue.call(b,[d])},convertValue:function(h,b,f){var a=this.getDelimiter(),j=this.getStore(),e=0,d=[],g,k;if(h){if(a&&Ext.isString(h)){h=h.split(a)}else{if(!Ext.isArray(h)){h=[h]}}for(g=h.length;e<g;++e){k=j.findRecord(b,h[e]);if(k){d.push(k.get(f))}}}return d},getValueFromRecords:function(h){var b=this.getDelimiter(),e=this.getValueField(),f=0,d=[],a,g;if(h){if(b&&Ext.isString(h)){h=h.split(b)}else{if(!Ext.isArray(h)){h=[h]}}for(a=h.length;f<a;++f){g=h[f];if(g&&g.isModel){d.push(g.get(e))}}d=Ext.Array.unique(d)}return d.length>0?d:h},getRecordsFromValue:function(g){var a=[],h=this.getStore().getRange(),l=this.getValueField(),e=0,k=h.length,b,d,f;if(g){for(f=g.length;e<f;++e){for(d=0;d<k;++d){b=h[d];if(b.get(l)==g[e]){a.push(b);break}}}}return a},getSelection:function(){return this.listPanel.down("list").getSelection()},getValue:function(){return this._value},onChange:function(d,f,b){var e=this,a=e.convertValue(b,e.getDisplayField(),e.getValueField());e.fireEvent("change",e,e.getValue(),a)},showPicker:function(){var f=this,b=this.getStore();if(!b||b.getCount()===0){return}if(f.getReadOnly()){return}f.isFocused=true;var e=f.getTabletPicker(),h=e.down("list"),d,a,g=f.getValue();if(!e.getParent()){Ext.Viewport.add(e)}if(g){a=f.getRecordsFromValue(g);h.select(a,null,true)}else{h.deselectAll()}e.showBy(f.getComponent(),(Ext.os.is.BlackBerry&&Ext.os.version.getMajor()===10)?"t-b":null)},onStoreDataChanged:function(a){var b=this,e=b.getInitialConfig(),d=b.getValue();if(d||d===0){b.updateValue(b.applyValue(d))}if(b.getValue()===null){if(e.hasOwnProperty("value")){b.setValue(e.value)}if(b.getValue()===null&&b.getAutoSelect()){if(a.getCount()>0){b.setValue(a.getAt(0))}}}}});Ext.define("Ext.ux.picker.Time",{extend:Ext.picker.Picker,xtype:"timepicker",alternateClassName:"Ext.TimePicker",config:{hourText:"Hour",minuteText:"Minute",secondText:"Seconds",millisecondText:"Milliseconds",meridiemText:"AM/PM",AMText:"AM",PMText:"PM",startHour:1,endHour:12,startMinute:0,endMinute:59,startSecond:0,endSecond:59,startMillisecond:0,endMillisecond:999,hourList:null,minuteList:null,secondList:null,millisecondList:null,hourIncrement:1,minuteIncrement:1,secondIncrement:5,millisecondIncrement:100,slotOrder:["hour","minute","meridiem"]},initialize:function(){this.callParent()},constructor:function(){this.callParent(arguments);this.createSlots()},setValue:function(d,b){if(Ext.isDate(d)){var a=Ext.Array.contains(this.getSlotOrder(),"meridiem");d={hour:a&&d.getHours()==0?12:d.getHours(),minute:d.getMinutes(),second:d.getSeconds(),millisecond:d.getMilliseconds(),meridiem:d.getHours()>=12?this.getPMText():this.getAMText()}}this.callParent([d,b])},getValue:function(n){var l={},j=this.getItems().items,h=j.length,d=new Date(),a=Ext.Array.contains(this.getSlotOrder(),"meridiem"),f,e,b,o,k,m,g;for(g=0;g<h;g++){m=j[g];if(m instanceof Ext.picker.Slot){l[m.getName()]=m.getValue(n)}}if(l.hour===null){return null}if(Ext.isNumber(l.hour)){if(a){if(l.meridiem==this.getPMText()){f=l.hour<12?l.hour+12:l.hour}if(l.meridiem==this.getAMText()){f=l.hour==12?0:l.hour}}else{f=Ext.isNumber(l.hour)?l.hour:0}}e=Ext.isNumber(l.minute)?l.minute:0;b=Ext.isNumber(l.second)?l.second:0;o=Ext.isNumber(l.millisecond)?l.millisecond:0;return new Date(d.getFullYear(),d.getMonth(),d.getDate(),f,e,b,o)},createSlots:function(){var e=this,f=e.getSlotOrder(),d,a,b=[];e.cleanupConfig();f.forEach(function(g){var h=e.createSlot(g);if(h){b.push(h)}});e.setSlots(b)},createSlot:function(a){var b=this;switch(a){case"hour":return{name:"hour",align:"center",data:b.getHourCollection(),title:b.getHourText(),flex:1};case"minute":if(Ext.Array.contains(b.getSlotOrder(),"minute")){return{name:"minute",align:"center",data:b.getMinuteCollection(),title:b.getMinuteText(),flex:1}}break;case"second":if(Ext.Array.contains(b.getSlotOrder(),"minute")&&Ext.Array.contains(b.getSlotOrder(),"second")){return{name:"second",align:"center",data:b.getSecondCollection(),title:b.getSecondText(),flex:1}}break;case"millisecond":if(Ext.Array.contains(b.getSlotOrder(),"minute")&&Ext.Array.contains(b.getSlotOrder(),"second")&&Ext.Array.contains(b.getSlotOrder(),"millisecond")){return{name:"millisecond",align:"center",data:b.getMillisecondCollection(),title:b.getMillisecondText(),flex:1}}break;case"meridiem":if(Ext.Array.contains(b.getSlotOrder(),"meridiem")&&b.getEndHour()<=12){return{name:"meridiem",align:"center",data:[{text:b.getAMText(),value:b.getAMText()},{text:b.getPMText(),value:b.getPMText()}],title:b.getMeridiemText(),flex:1}}break}},cleanupConfig:function(){var j=this,e=j.getStartHour(),g=j.getEndHour(),l=j.getStartMinute(),d=j.getEndMinute(),h=j.getStartSecond(),b=j.getEndSecond(),k=j.getStartMillisecond(),f=j.getEndMillisecond(),a=Ext.Array.contains(j.getSlotOrder(),"meridiem");e=e<1||!Ext.isNumber(e)?a?1:0:e;g=g>23||!Ext.isNumber(g)?Ext.Array.contains(j.getSlotOrder(),"meridiem")?12:23:g;l=l<0||!Ext.isNumber(l)?0:l;d=d>59||!Ext.isNumber(d)?59:d;h=h<1||!Ext.isNumber(h)?0:h;b=d>59||!Ext.isNumber(b)?59:b;k=k<1||!Ext.isNumber(k)?0:k;f=f>59||!Ext.isNumber(f)?999:f;j.setStartHour(e);j.setEndHour(g);j.setStartMinute(l);j.setEndMinute(d);j.setStartSecond(h);j.setEndSecond(b);j.setStartMillisecond(k);j.setEndMillisecond(f)},getHourCollection:function(){var b=this,a=[];if(!!b.getHourList()){var d=b.getHourList();for(i=0;i<d.length;i++){if(i<24){a.push({text:d[i],value:d[i]})}}}else{for(i=b.getStartHour();i<=b.getEndHour();i+=b.getHourIncrement()){a.push({text:i,value:i})}}return a},getMinuteCollection:function(){var b=this,a=[];if(!!b.getMinuteList()){var d=b.getMinuteList();for(i=0;i<d.length;i++){a.push({text:d[i]<10?"0"+d[i]:d[i],value:d[i]})}}else{for(i=b.getStartMinute();i<=b.getEndMinute();i+=b.getMinuteIncrement()){a.push({text:i<10?"0"+i:i,value:i})}}return a},getSecondCollection:function(){var a=this,d=[];if(!!a.getSecondList()){var b=a.getSecondList();for(i=0;i<b.length;i++){if(i<60){d.push({text:b[i]<10?"0"+b[i]:b[i],value:b[i]})}}}else{for(i=a.getStartSecond();i<=a.getEndSecond();i+=a.getSecondIncrement()){d.push({text:i<10?"0"+i:i,value:i})}}return d},getMillisecondCollection:function(){var b=this,a=[];if(!!b.getMillisecondList()){var d=b.getMillisecondList();for(i=0;i<d.length;i++){if(i<1000){a.push({text:d[i]<10?"0"+d[i]:d[i],value:d[i]})}}}else{for(i=b.getStartMillisecond();i<=b.getEndMillisecond();i+=b.getMillisecondIncrement()){a.push({text:i<10?"0"+i:i,value:i})}}return a}});Ext.define("Ext.ux.field.TimePicker",{extend:Ext.field.DatePicker,alternateClassName:"Ext.form.TimePicker",xtype:"timepickerfield",config:{ui:"select",picker:true,clearIcon:false,destroyPickerOnHide:false,dateFormat:"H:i",defaultTime:"8:00",component:{useMask:true}},initialize:function(){var b=this,a=b.getComponent();b.callParent();a.on({scope:b,masktap:"onMaskTap"});a.doMaskTap=Ext.emptyFn;if(Ext.browser.is.AndroidStock2){a.input.dom.disabled=true}},syncEmptyCls:Ext.emptyFn,applyValue:function(b){if(!Ext.isDate(b)&&!Ext.isObject(b)){var a=this.getDefaultTime().split(":");return new Date(date.getYear(),date.getMonth(),date.getDate(),a[0],a[1])}if(Ext.isObject(b)){return new Date(date.getYear(),date.getMonth(),date.getDate(),b.hour,b.minute)}return b},updateValue:function(e,b){var d=this,a=d._picker;if(a&&a.isPicker){a.setValue(e)}if(e!==null){d.getComponent().setValue(Ext.Date.format(e,d.getDateFormat()||Ext.util.Format.defaultDateFormat))}else{d.getComponent().setValue("")}if(e!==b){d.fireEvent("change",d,e,b)}},updateDateFormat:function(d,a){var b=this.getValue();if(d!=a&&Ext.isDate(b)){this.getComponent().setValue(Ext.Date.format(b,d||Ext.util.Format.defaultDateFormat))}},getValue:function(){if(this._picker&&this._picker instanceof Ext.ux.picker.Time){return this._picker.getValue()}return this._value},setValue:function(d){var b=this,a=b._picker;if(a&&a.isPicker){a.setValue(d)}if(d!==null){b.getComponent().setValue(Ext.Date.format(d,b.getDateFormat()||Ext.util.Format.defaultDateFormat))}else{b.getComponent().setValue("")}},getFormattedValue:function(b){var a=this.getValue();return(Ext.isDate(a))?Ext.Date.format(a,b||this.getDateFormat()||Ext.util.Format.defaultDateFormat):a},applyPicker:function(b,a){b=Ext.factory(b,"Ext.ux.picker.Time");if(a&&a.isPicker){b=a.setConfig(b)}return b},getPicker:function(){var a=this._picker,b=this.getValue();if(a&&!a.isPicker){a=Ext.factory(a,Ext.ux.picker.Time);if(b!=null){a.setValue(b)}}a.on({scope:this,change:"onPickerChange",hide:"onPickerHide"});this._picker=a;return a},onMaskTap:function(){if(this.getDisabled()){return false}this.onFocus();return false},onPickerChange:function(b,e){var d=this,a=d.getValue();d.setValue(e);d.fireEvent("select",d,e);d.onChange(d,e,a)},onChange:Ext.emptyFn,onPickerHide:function(){var b=this,a=b.getPicker();if(b.getDestroyPickerOnHide()&&a){a.destroy();b._picker=b.getInitialConfig().picker||true}},reset:function(){this.setValue(this.originalValue)},onFocus:function(b){var a=this.getComponent();this.fireEvent("focus",this,b);if(Ext.os.is.Android4){a.input.dom.focus()}a.input.dom.blur();if(this.getReadOnly()){return false}this.isFocused=true;this.getPicker().show()},destroy:function(){var a=this._picker;if(a&&a.isPicker){a.destroy()}this.callParent(arguments)}});Ext.define("Ext.ux.slidenavigation.View",{extend:Ext.Container,xtype:"slidenavigationview",config:{list:{width:250,maxDrag:null,itemTpl:"{title}",grouped:true,items:[{xtype:"toolbar",docked:"top",ui:"light"}]},container:{},itemMask:false,items:[],tempItems:[],groups:{},defaults:{layout:"card"},listPosition:"left",slideSelector:"",containerSlideDelay:-1,slideDuration:Ext.os.is("Android")?0:200,selectSlideDuration:Ext.os.is("Android")?0:300,closeOnSelect:true,dragFlag:true,shadowStyle:"0 0 4px 1px #999",slideButtonDefaults:{}},initConfig:function(){var a=this;a.addListener("destroy",function(d,b){console.log("onDestroy","container id:",this.id);if(!Ext.isEmpty(this.store)){this.store.each(function(g,e,f){g.destroy()});this.store.removeAll();this.store=null}if(!Ext.isEmpty(this.container)){this.container.removeAll(true,true)}if(!Ext.isEmpty(this.list)){this.list.removeAll(true,true)}},a);if(a.config.items.length==0&&a.config.tempItems.length>=1){a.config.items=a.config.tempItems}a._indexCount=0;a.store=Ext.create("Ext.data.Store",{model:a.getModel(),sorters:"order",grouper:{property:"group",sortProperty:"groupOrder"}});a.addItems(a.config.items||[]);delete a.config.tempItems;a.config.tempItems=a.config.items;delete a.config.items;a.callParent(arguments);a._cache={};a._slideButtonConfig={xtype:"button",iconMask:true,iconCls:"more",align:this.getListPosition(),name:"slidebutton",listeners:{release:a.toggleContainer,tap:function(b,d){d.preventDefault()},scope:a}};a.itemMaskDefaults={xtype:"mask",transparent:true}},initialize:function(){console.log("onInitial","container id:",this.id);this.__init=false;this.callParent();this.addCls("x-slidenavigation");this.list=this.createNavigationList();this.container=this.createContainer();this.add([this.list,this.container]);this.createContainerCSS();var a=-1;if(this.list.getStore().getCount()>0){Ext.each(this.list.getStore().getRange(),function(d,b){if(d.get("selected")===true){a=b}});if(a!=-1){this.list.select(a)}}this.__init=true},addItems:function(b){var d=this,b=Ext.isArray(b)?b:[b],a=d.config.groups;Ext.each(b,function(f,e){if(!Ext.isDefined(f.index)){f.index=d._indexCount;d._indexCount++}d.store.add(f)})},createContainerCSS:function(){var a=this.getShadowStyle(),b=this.getId();if(a){if(!document.getElementById(b)){style=document.createElement("style");style.type="text/css";style.innerHTML=".x-slidenavigation-container.x-dragging, .x-slidenavigation-container.open { box-shadow: "+a+";-webkit-box-shadow:"+a+";";document.getElementsByTagName("head")[0].appendChild(style)}}},createSlideButton:function(d,a){var f=this,a=Ext.merge(f.getSlideButtonDefaults(),Ext.isObject(a)?a:{}),b=d.down(a.selector),e=this.getListPosition();if(b){layout=b.getLayout();if(layout&&Ext.isFunction(layout.setPack)){layout.setPack(e)}return b.add(Ext.merge(f._slideButtonConfig,a))}return false},getMask:function(){var a=this.getItemMask();if(a!=false){if(Ext.isBoolean(a)){a=this.itemMaskDefaults}}return a},doMaskItem:function(b,a){var d=this.getMask(),a=Ext.isDefined(a)?a:true;Ext.each(b.query("component[maskOnOpen=true]"),function(e){if(a){e.setMasked(d);e.getMasked().onEvent=Ext.emptyFn}else{e.setMasked(false)}})},onItemTap:function(f,a,h,d,g,b){if(f.isSelected(d)&&this.config.closeOnSelect){this.closeContainer()}},onSelect:function(j,h,e){var g=this,b=j.getStore(),d=h.raw.index,a=g.container,f=Ext.emptyFn;if(g._cache[d]==undefined){if(Ext.isFunction(h.raw.handler)){g._cache[d]=h.raw.handler}else{g._cache[d]=a.add(Ext.merge({},g.config.defaults,h.raw));g.doMaskItem(g._cache[d],true);if(g.config.closeOnSelect){g._cache[d].addListener("painted",function(){Ext.defer(g.closeContainer,200,g,[g.config.selectSlideDuration])})}if((h.raw.slideButton||false)){g.createSlideButton(g._cache[d],h.raw.slideButton)}}}if(Ext.isFunction(g._cache[d])){f=g._cache[d]}else{f=g.setContainerItem}if(g.__init){g.fireAction("select",[g,g._cache[d],d],f,g)}},setContainerItem:function(d,b){var a=d.container;a.setActiveItem(b)},onContainerDragstart:function(a,f,h,b){var g=this.getSlideSelector(),d=this.config.containerSlideDelay;if(g==false&&d<0){return false}if(this.config.dragFlag==false){return false}if(this.container.dragAllowed){return true}if(g){node=f.target;while(node=node.parentNode){if(node.classList&&node.classList.contains(g)){this.fireEvent("dragstart",this);return true}}return false}return false},onContainerDragend:function(a,g,b){var f=typeof(g.deltaTime)!="undefined"?Math.abs(g.deltaX/g.deltaTime):g.absDeltaX/(g.time-g.startTime),d=this.getListPosition();direction=(g.deltaX>0)?"right":"left",offset=Ext.clone(a.offset),threshold=parseInt(this.config.list.minWidth*0.7);if(d=="right"){if(direction=="right"){direction="left"}else{direction="right"}}switch(direction){case"right":offset.x=(f>0.75||offset.x>threshold)?this.config.list.minWidth:0;break;case"left":offset.x=(f>0.75||offset.x<threshold)?0:this.config.list.minWidth;break}this.fireEvent("dragend",this);this.moveContainer(this,offset.x)},getModel:function(){var b="SlideNavigationPanelItem",a=this.config.groups;if(!Ext.ModelManager.get(b)){Ext.define(b,{extend:"Ext.data.Model",config:{idProperty:"index",fields:["index","title","group","selected",{name:"order",defaultValue:1},{name:"groupOrder",convert:function(e,d){group=d.get("group");return a[group]||group}}]}})}return b},closeContainer:function(b){var a=this,b=b||this.config.slideDuration;if(a.__init){a.fireAction("close",[a,0,b],"moveContainer",a)}},openContainer:function(d){var b=this,d=d||this.config.slideDuration,a=this.config.list.minWidth;if(b.__init){b.fireAction("open",[b,a,d],"moveContainer",b)}},toggleContainer:function(a){var a=Ext.isNumber(a)?a:this.config.slideDuration;if(this.isClosed()){this.openContainer(a)}else{this.closeContainer(a)}},moveContainer:function(e,b,d){var d=d||this.config.slideDuration,a=this.container.draggableBehavior.draggable;listPosition=this.getListPosition();if(listPosition=="right"){b=-b}this.container.addCls("open");a.setOffset(b,0,{duration:d})},isClosed:function(){return(this.container.draggableBehavior.draggable.offset.x==0)},isOpened:function(){var a=this.getListPosition();offset=(a=="left")?this.config.list.minWidth:-this.config.list.minWidth;return(this.container.draggableBehavior.draggable.offset.x==offset)},setClosed:function(a){if(a){this.container.removeCls("open")}else{this.container.addCls("open")}},createNavigationList:function(a){var b=this.getList(),d=this.getListPosition();if(b.width){b.minWidth=b.width;if(d=="left"){b.width=b.maxDrag||b.width}}return Ext.create("Ext.dataview.List",Ext.merge({},b,{store:this.store,docked:d,cls:"x-slidenavigation-list",style:"position: absolute; top: 0; "+d+": 0; height: 100%;z-index: 2",listeners:{select:this.onSelect,itemtap:this.onItemTap,scope:this}}))},createContainer:function(){var e=this,d=this.getListPosition(),b=this.getContainerSlideDelay(),f;if(d=="left"){f={min:{x:0,y:0},max:{x:e.config.list.maxDrag||Math.max(screen.width,screen.height),y:0}}}else{f={min:{x:-e.config.list.width,y:0},max:{x:0,y:0}}}var a=Ext.create("Ext.Container",Ext.merge({},e.config.container,{cls:"x-slidenavigation-container",style:"width: 100%; height: 100%; position: absolute; opacity: 1; z-index: 3",layout:"card",dragAllowed:false,dragAllowedForced:false,draggable:{direction:"horizontal",constraint:f,listeners:{dragstart:{fn:e.onContainerDragstart,order:"before",scope:e},dragend:e.onContainerDragend,scope:e},translatable:{listeners:{animationstart:function(){e.fireEvent("slidestart",e)},animationend:function(h,g,j){if(e.__init){e.fireEvent("slideend",e)}if(e.isOpened()){e.fireEvent("opened",e);e.doMaskItem(e.container.getActiveItem(),true)}else{if(e.isClosed()){e.fireEvent("closed",e);e.doMaskItem(e.container.getActiveItem(),false)}}e.setClosed(e.isClosed())},scope:e}}}}));if(b>-1){a.element.on({drag:function(k,j,h,g){deltaX=k.absDeltaX;deltaY=k.absDeltaY;if(deltaY>(e.config.dragFlag?10:-10)&&!a.dragAllowed){a.dragAllowedForced=true;return false}if(deltaX>b&&!a.dragAllowed&&!a.dragAllowedForced){if(!a.dragAllowed){scrollParent=e.container.getActiveItem().down("component[scrollable]");if(scrollParent){scrollable=scrollParent.getScrollable();scroller=scrollable.getScroller();scroller._scrollState=scroller.getDisabled();if(scroller._scrollState!=false){scroller.setDisabled(true);scrollable.hideIndicators()}}}a.dragAllowed=true;a.element.fireEvent("dragstart")}},dragend:function(){if(a.dragAllowed){scrollParent=e.container.getActiveItem().down("component[scrollable]");if(scrollParent){scrollable=scrollParent.getScrollable();scroller=scrollable.getScroller();scroller._scrollState=scroller.getDisabled();if(scroller._scrollState!=false){scroller.setDisabled(null);scrollable.hideIndicators()}}}a.dragAllowedForced=false;a.dragAllowed=false}})}return a},getActiveItem:function(){var a=this.list.getSelection();if(a){return a[0]}}});Ext.define("Ext.viewport.Default",{extend:Ext.Container,xtype:"viewport",PORTRAIT:"portrait",LANDSCAPE:"landscape",config:{autoMaximize:false,autoBlurInput:true,preventPanning:true,preventZooming:false,autoRender:true,layout:"card",width:"100%",height:"100%",useBodyElement:true,menus:{}},isReady:false,isViewport:true,isMaximizing:false,id:"ext-viewport",isInputRegex:/^(input|textarea|select|a)$/i,focusedElement:null,fullscreenItemCls:Ext.baseCSSPrefix+"fullscreen",constructor:function(a){var b=Ext.Function.bind;this.doPreventPanning=b(this.doPreventPanning,this);this.doPreventZooming=b(this.doPreventZooming,this);this.doBlurInput=b(this.doBlurInput,this);this.maximizeOnEvents=["ready","orientationchange"];window.devicePixelRatio=window.devicePixelRatio||1;this.callSuper([a]);this.orientation=this.determineOrientation();this.windowWidth=this.getWindowWidth();this.windowHeight=this.getWindowHeight();this.windowOuterHeight=this.getWindowOuterHeight();if(!this.stretchHeights){this.stretchHeights={}}if(!Ext.os.is.Android||Ext.browser.is.ChromeMobile){if(this.supportsOrientation()){this.addWindowListener("orientationchange",b(this.onOrientationChange,this))}else{this.addWindowListener("resize",b(this.onResize,this))}}document.addEventListener("focus",b(this.onElementFocus,this),true);document.addEventListener("blur",b(this.onElementBlur,this),true);Ext.onDocumentReady(this.onDomReady,this);this.on("ready",this.onReady,this,{single:true});this.getEventDispatcher().addListener("component","*","fullscreen","onItemFullscreenChange",this);return this},onDomReady:function(){this.isReady=true;this.updateSize();this.fireEvent("ready",this)},onReady:function(){if(this.getAutoRender()){this.render()}if(Ext.browser.name=="ChromeiOS"){this.setHeight("-webkit-calc(100% - "+((window.outerHeight-window.innerHeight)/2)+"px)")}},onElementFocus:function(a){this.focusedElement=a.target},onElementBlur:function(){this.focusedElement=null},render:function(){if(!this.rendered){var a=Ext.getBody(),b=Ext.baseCSSPrefix,j=[],e=Ext.os,h=e.name.toLowerCase(),g=Ext.browser.name.toLowerCase(),f=e.version.getMajor(),d=this.getOrientation();this.renderTo(a);j.push(b+e.deviceType.toLowerCase());if(e.is.iPad){j.push(b+"ipad")}j.push(b+h);j.push(b+g);if(f){j.push(b+h+"-"+f)}if(e.is.BlackBerry){j.push(b+"bb")}if(Ext.browser.is.WebKit){j.push(b+"webkit")}if(Ext.browser.is.Standalone){j.push(b+"standalone")}if(Ext.browser.is.AndroidStock){j.push(b+"android-stock")}j.push(b+d);a.addCls(j)}},applyAutoBlurInput:function(a){var b=(Ext.feature.has.Touch)?"touchstart":"mousedown";if(a){this.addWindowListener(b,this.doBlurInput,false)}else{this.removeWindowListener(b,this.doBlurInput,false)}return a},applyAutoMaximize:function(a){if(Ext.browser.is.WebView){a=false}if(a){this.on("ready","doAutoMaximizeOnReady",this,{single:true});this.on("orientationchange","doAutoMaximizeOnOrientationChange",this)}else{this.un("ready","doAutoMaximizeOnReady",this);this.un("orientationchange","doAutoMaximizeOnOrientationChange",this)}return a},applyPreventPanning:function(a){if(a){this.addWindowListener("touchmove",this.doPreventPanning,false)}else{this.removeWindowListener("touchmove",this.doPreventPanning,false)}return a},applyPreventZooming:function(a){var b=(Ext.feature.has.Touch)?"touchstart":"mousedown";if(a){this.addWindowListener(b,this.doPreventZooming,false)}else{this.removeWindowListener(b,this.doPreventZooming,false)}return a},doAutoMaximizeOnReady:function(){var a=arguments[arguments.length-1];a.pause();this.isMaximizing=true;this.on("maximize",function(){this.isMaximizing=false;this.updateSize();a.resume();this.fireEvent("ready",this)},this,{single:true});this.maximize()},doAutoMaximizeOnOrientationChange:function(){var a=arguments[arguments.length-1],b=a.firingArguments;a.pause();this.isMaximizing=true;this.on("maximize",function(){this.isMaximizing=false;this.updateSize();b[2]=this.windowWidth;b[3]=this.windowHeight;a.resume()},this,{single:true});this.maximize()},doBlurInput:function(b){var a=b.target,d=this.focusedElement;if(d&&d.nodeName.toUpperCase()!="BODY"&&!this.isInputRegex.test(a.tagName)){delete this.focusedElement;d.blur()}},doPreventPanning:function(a){a.preventDefault()},doPreventZooming:function(b){if("button" in b&&b.button!==0){return}var a=b.target;if(a&&a.nodeType===1&&!this.isInputRegex.test(a.tagName)){b.preventDefault()}},addWindowListener:function(b,d,a){window.addEventListener(b,d,Boolean(a))},removeWindowListener:function(b,d,a){window.removeEventListener(b,d,Boolean(a))},doAddListener:function(a,e,d,b){if(a==="ready"&&this.isReady&&!this.isMaximizing){e.call(d);return this}return this.callSuper(arguments)},supportsOrientation:function(){return Ext.feature.has.Orientation},onResize:function(){var d=this.windowWidth,g=this.windowHeight,f=this.getWindowWidth(),a=this.getWindowHeight(),e=this.getOrientation(),b=this.determineOrientation();if((d!==f&&g!==a)&&e!==b){this.fireOrientationChangeEvent(b,e)}},onOrientationChange:function(){var b=this.getOrientation(),a=this.determineOrientation();if(a!==b){this.fireOrientationChangeEvent(a,b)}},fireOrientationChangeEvent:function(b,d){var a=Ext.baseCSSPrefix;Ext.getBody().replaceCls(a+d,a+b);this.orientation=b;this.updateSize();this.fireEvent("orientationchange",this,b,this.windowWidth,this.windowHeight)},updateSize:function(b,a){this.windowWidth=b!==undefined?b:this.getWindowWidth();this.windowHeight=a!==undefined?a:this.getWindowHeight();return this},waitUntil:function(j,f,h,a,g){if(!a){a=50}if(!g){g=2000}var d=this,b=0;setTimeout(function e(){b+=a;if(j.call(d)===true){if(f){f.call(d)}}else{if(b>=g){if(h){h.call(d)}}else{setTimeout(e,a)}}},a)},maximize:function(){this.fireMaximizeEvent()},fireMaximizeEvent:function(){this.updateSize();this.fireEvent("maximize",this)},doSetHeight:function(a){Ext.getBody().setHeight(a);this.callParent(arguments)},doSetWidth:function(a){Ext.getBody().setWidth(a);this.callParent(arguments)},scrollToTop:function(){window.scrollTo(0,-1)},getWindowWidth:function(){return window.innerWidth},getWindowHeight:function(){return window.innerHeight},getWindowOuterHeight:function(){return window.outerHeight},getWindowOrientation:function(){return window.orientation},getOrientation:function(){return this.orientation},getSize:function(){return{width:this.windowWidth,height:this.windowHeight}},determineOrientation:function(){var b=this.PORTRAIT,a=this.LANDSCAPE;if(!Ext.os.is.Android&&this.supportsOrientation()){if(this.getWindowOrientation()%180===0){return b}return a}else{if(this.getWindowHeight()>=this.getWindowWidth()){return b}return a}},onItemFullscreenChange:function(a){a.addCls(this.fullscreenItemCls);this.add(a)},setMenu:function(f,a){var b=this;a=a||{};if(Ext.os.is.iOS&&!this.hasiOSOrientationFix){this.hasiOSOrientationFix=true;this.on("orientationchange",function(){window.scrollTo(0,0)},this)}if(!f){return}if(!a.side){return}if(["left","right","top","bottom"].indexOf(a.side)==-1){return}var e=b.getMenus();if(!e){e={}}if(!b.addedSwipeListener){b.addedSwipeListener=true;b.element.on({tap:b.onTap,swipestart:b.onSwipeStart,edgeswipestart:b.onEdgeSwipeStart,edgeswipe:b.onEdgeSwipe,edgeswipeend:b.onEdgeSwipeEnd,scope:b});if(window.blackberry){var d=function(){var g=b.getMenus(),h=g.top;if(!h){return}if(h.isHidden()){b.showMenu("top")}else{b.hideMenu("top")}};if(blackberry.app&&blackberry.app.event&&blackberry.app.event.onSwipeDown){blackberry.app.event.onSwipeDown(d)}else{if(blackberry.event&&blackberry.event.addEventListener){blackberry.event.addEventListener("swipedown",d)}}}}e[a.side]=f;f.$reveal=Boolean(a.reveal);f.$cover=a.cover!==false&&!f.$reveal;f.$side=a.side;b.fixMenuSize(f,a.side);if(a.side=="left"){f.setLeft(0);f.setRight(null);f.setTop(0);f.setBottom(0)}else{if(a.side=="right"){f.setLeft(null);f.setRight(0);f.setTop(0);f.setBottom(0)}else{if(a.side=="top"){f.setLeft(0);f.setRight(0);f.setTop(0);f.setBottom(null)}else{if(a.side=="bottom"){f.setLeft(0);f.setRight(0);f.setTop(null);f.setBottom(0)}}}}b.setMenus(e)},removeMenu:function(a){var b=this.getMenus()||{},d=b[a];if(d){this.hideMenu(a)}delete b[a];this.setMenus(b)},fixMenuSize:function(b,a){if(a=="top"||a=="bottom"){b.setWidth("100%")}else{if(a=="left"||a=="right"){b.setHeight("100%")}}},showMenu:function(b){var f=this.getMenus(),j=f[b],e,h,g,d;if(!j||j.isAnimating){return}this.hideOtherMenus(b);e={translateX:0,translateY:0};h={translateX:0,translateY:0};g={translateX:0,translateY:0};d={translateX:0,translateY:0};if(j.$reveal){Ext.getBody().insertFirst(j.element)}else{Ext.Viewport.add(j)}j.show();j.addCls("x-"+b);var a=(b=="left"||b=="right")?j.element.getWidth():j.element.getHeight();if(b=="left"){e.translateX=-a;d.translateX=a}else{if(b=="right"){e.translateX=a;d.translateX=-a}else{if(b=="top"){e.translateY=-a;d.translateY=a}else{if(b=="bottom"){e.translateY=a;d.translateY=-a}}}}if(j.$reveal){if(Ext.browser.getPreferredTranslationMethod()!="scrollposition"){j.translate(0,0)}}else{j.translate(e.translateX,e.translateY)}if(j.$cover){j.getTranslatable().on("animationend",function(){j.isAnimating=false},this,{single:true});j.translate(h.translateX,h.translateY,{preserveEndState:true,duration:200})}else{this.translate(g.translateX,g.translateY);this.getTranslatable().on("animationend",function(){j.isAnimating=false},this,{single:true});this.translate(d.translateX,d.translateY,{preserveEndState:true,duration:200})}j.isAnimating=true},hideMenu:function(d,a){var f=this.getMenus(),h=f[d],g,e,b;a=(a===false)?false:true;if(!h||(h.isHidden()||h.isAnimating)){return}g={translateX:0,translateY:0};e={translateX:0,translateY:0};b=(d=="left"||d=="right")?h.element.getWidth():h.element.getHeight();if(d=="left"){g.translateX=-b}else{if(d=="right"){g.translateX=b}else{if(d=="top"){g.translateY=-b}else{if(d=="bottom"){g.translateY=b}}}}if(h.$cover){if(a){h.getTranslatable().on("animationend",function(){h.isAnimating=false;h.hide()},this,{single:true});h.translate(g.translateX,g.translateY,{preserveEndState:true,duration:200})}else{h.translate(g.translateX,g.translateY);h.hide()}}else{if(a){this.getTranslatable().on("animationend",function(){h.isAnimating=false;h.hide()},this,{single:true});this.translate(e.translateX,e.translateY,{preserveEndState:true,duration:200})}else{this.translate(e.translateX,e.translateY);h.hide()}}},hideAllMenus:function(d){var b=this.getMenus();for(var a in b){this.hideMenu(a,d)}},hideOtherMenus:function(a,d){var b=this.getMenus();for(var e in b){if(a!=e){this.hideMenu(e,d)}}},toggleMenu:function(a){var b=this.getMenus(),d;if(b[a]){d=b[a];if(d.isHidden()){this.showMenu(a)}else{this.hideMenu(a)}}},sideForDirection:function(a){if(a=="left"){return"right"}else{if(a=="right"){return"left"}else{if(a=="up"){return"bottom"}else{if(a=="down"){return"top"}}}}},sideForSwipeDirection:function(a){if(a=="up"){return"top"}else{if(a=="down"){return"bottom"}}return a},onTap:function(a){},onSwipeStart:function(b){var a=this.sideForSwipeDirection(b.direction);this.hideMenu(a)},onEdgeSwipeStart:function(j){var l=this.sideForDirection(j.direction),f=this.getMenus(),b=f[l],m,k;if(!b||!b.isHidden()){return}for(m in f){k=f[m];if(k.isHidden()!==false){return}}this.$swiping=true;this.hideAllMenus(false);if(b.$reveal){Ext.getBody().insertFirst(b.element)}else{Ext.Viewport.add(b)}b.show();var n=(l=="left"||l=="right")?b.element.getWidth():b.element.getHeight(),a,h;a={translateX:0,translateY:0};h={translateX:0,translateY:0};if(l=="left"){a.translateX=-n}else{if(l=="right"){a.translateX=n}else{if(l=="top"){a.translateY=-n}else{if(l=="bottom"){a.translateY=n}}}}var d="webkitTransform" in document.createElement("div").style?"webkitTransform":"transform",g=b.element.dom.style[d];if(g){b.element.dom.style[d]=""}if(b.$reveal){if(Ext.browser.getPreferredTranslationMethod()!="scrollposition"){b.translate(0,0)}}else{b.translate(a.translateX,a.translateY)}if(!b.$cover){if(g){this.innerElement.dom.style[d]=""}this.translate(h.translateX,h.translateY)}},onEdgeSwipe:function(h){var d=this.sideForDirection(h.direction),k=this.getMenus()[d];if(!k||!this.$swiping){return}var b=(d=="left"||d=="right")?k.element.getWidth():k.element.getHeight(),j,g,a=Math.min(h.distance-b,0),f=Math.min(h.distance,b);j={translateX:0,translateY:0};g={translateX:0,translateY:0};if(d=="left"){j.translateX=a;g.translateX=f}else{if(d=="right"){j.translateX=-a;g.translateX=-f}else{if(d=="top"){j.translateY=a;g.translateY=f}else{if(d=="bottom"){j.translateY=-a;g.translateY=-f}}}}if(k.$cover){k.translate(j.translateX,j.translateY)}else{this.translate(g.translateX,g.translateY)}},onEdgeSwipeEnd:function(k){var l=this.sideForDirection(k.direction),b=this.getMenus()[l],j=false;if(!b){return}var m=(l=="left"||l=="right")?b.element.getWidth():b.element.getHeight(),g=(k.flick)?k.flick.velocity:0;if(l=="right"){if(g.x>0){j=true}}else{if(l=="left"){if(g.x<0){j=true}}else{if(l=="top"){if(g.y<0){j=true}}else{if(l=="bottom"){if(g.y>0){j=true}}}}}var d=(j)?m:0,f=(j)?0:-m,a,h;a={translateX:0,translateY:0};h={translateX:0,translateY:0};if(l=="left"){a.translateX=-d;h.translateX=-f}else{if(l=="right"){a.translateX=d;h.translateX=f}else{if(l=="top"){a.translateY=-d;h.translateY=-f}else{if(l=="bottom"){a.translateY=d;h.translateY=f}}}}if(b.$cover){b.getTranslatable().on("animationend",function(){if(j){b.hide()}},this,{single:true});b.translate(a.translateX,a.translateY,{preserveEndState:true,duration:200})}else{this.getTranslatable().on("animationend",function(){if(j){b.hide()}},this,{single:true});this.translate(h.translateX,h.translateY,{preserveEndState:true,duration:200})}this.$swiping=false}});Ext.define("Ext.viewport.Android",{extend:Ext.viewport.Default,config:{translatable:{translationMethod:"csstransform"}},constructor:function(){this.on("orientationchange","hideKeyboardIfNeeded",this,{prepend:true});this.callSuper(arguments);this.bodyElement.on("resize",this.onResize,this,{buffer:1})},getWindowWidth:function(){return this.element.getWidth()},getWindowHeight:function(){return this.element.getHeight()},getDummyInput:function(){var a=this.dummyInput,d=this.focusedElement,b=Ext.fly(d).getPageBox();if(!a){this.dummyInput=a=document.createElement("input");a.style.position="absolute";a.style.opacity="0";a.style.pointerEvents="none";document.body.appendChild(a)}a.style.left=b.left+"px";a.style.top=b.top+"px";a.style.display="";return a},doBlurInput:function(d){var b=d.target,f=this.focusedElement,a;if(f&&!this.isInputRegex.test(b.tagName)){a=this.getDummyInput();delete this.focusedElement;a.focus();setTimeout(function(){a.style.display="none"},100)}},hideKeyboardIfNeeded:function(){var a=arguments[arguments.length-1],b=this.focusedElement;if(b){delete this.focusedElement;a.pause();if(Ext.os.version.lt("4")){b.style.display="none"}else{b.blur()}setTimeout(function(){b.style.display="";a.resume()},1000)}},doFireOrientationChangeEvent:function(){var a=arguments[arguments.length-1];this.orientationChanging=true;a.pause();this.waitUntil(function(){return this.getWindowOuterHeight()!==this.windowOuterHeight},function(){this.windowOuterHeight=this.getWindowOuterHeight();this.updateSize();a.firingArguments[2]=this.windowWidth;a.firingArguments[3]=this.windowHeight;a.resume();this.orientationChanging=false},function(){});return this},determineOrientation:function(){return(this.getWindowHeight()>=this.getWindowWidth())?this.PORTRAIT:this.LANDSCAPE},getActualWindowOuterHeight:function(){return Math.round(this.getWindowOuterHeight()/window.devicePixelRatio)},maximize:function(){var d=this.stretchHeights,b=this.orientation,a;a=d[b];if(!a){d[b]=a=this.getActualWindowOuterHeight()}if(!this.addressBarHeight){this.addressBarHeight=a-this.getWindowHeight()}this.setHeight(a);var e=Ext.Function.bind(this.isHeightMaximized,this,[a]);this.scrollToTop();this.waitUntil(e,this.fireMaximizeEvent,this.fireMaximizeEvent)},isHeightMaximized:function(a){this.scrollToTop();return this.getWindowHeight()===a},supportsOrientation:function(){return false},onResize:function(){this.waitUntil(function(){var d=this.windowWidth,g=this.windowHeight,f=this.getWindowWidth(),a=this.getWindowHeight(),e=this.getOrientation(),b=this.determineOrientation();return((d!==f&&g!==a)&&e!==b)},function(){var b=this.getOrientation(),a=this.determineOrientation();this.fireOrientationChangeEvent(a,b)},Ext.emptyFn,250)},doPreventZooming:function(b){if("button" in b&&b.button!==0){return}var a=b.target;if(a&&a.nodeType===1&&!this.isInputRegex.test(a.tagName)&&!this.focusedElement){b.preventDefault()}}},function(){if(!Ext.os.is.Android){return}var a=Ext.os.version,b=Ext.browser.userAgent,d=/(htc|desire|incredible|ADR6300)/i.test(b)&&a.lt("2.3");if(d){this.override({constructor:function(e){if(!e){e={}}e.autoMaximize=false;this.watchDogTick=Ext.Function.bind(this.watchDogTick,this);setInterval(this.watchDogTick,1000);return this.callParent([e])},watchDogTick:function(){this.watchDogLastTick=Ext.Date.now()},doPreventPanning:function(){var f=Ext.Date.now(),g=this.watchDogLastTick,e=f-g;if(e>=2000){return}return this.callParent(arguments)},doPreventZooming:function(){var f=Ext.Date.now(),g=this.watchDogLastTick,e=f-g;if(e>=2000){return}return this.callParent(arguments)}})}if(a.match("2")){this.override({onReady:function(){this.addWindowListener("resize",Ext.Function.bind(this.onWindowResize,this));this.callParent(arguments)},scrollToTop:function(){document.body.scrollTop=100},onWindowResize:function(){var f=this.windowWidth,h=this.windowHeight,g=this.getWindowWidth(),e=this.getWindowHeight();if(this.getAutoMaximize()&&!this.isMaximizing&&!this.orientationChanging&&window.scrollY===0&&f===g&&e<h&&((e>=h-this.addressBarHeight)||!this.focusedElement)){this.scrollToTop()}}})}else{if(a.gtEq("3.1")){this.override({isHeightMaximized:function(e){this.scrollToTop();return this.getWindowHeight()===e-1}})}else{if(a.match("3")){this.override({isHeightMaximized:function(){this.scrollToTop();return true}})}}}if(a.gtEq("4")){this.override({doBlurInput:Ext.emptyFn})}});Ext.define("Ext.viewport.Ios",{extend:Ext.viewport.Default,isFullscreen:function(){return this.isHomeScreen()},isHomeScreen:function(){return window.navigator.standalone===true},constructor:function(){this.callParent(arguments);if(this.getAutoMaximize()&&!this.isFullscreen()){this.addWindowListener("touchstart",Ext.Function.bind(this.onTouchStart,this))}},maximize:function(){if(this.isFullscreen()){return this.callParent()}var d=this.stretchHeights,b=this.orientation,e=this.getWindowHeight(),a=d[b];if(window.scrollY>0){this.scrollToTop();if(!a){d[b]=a=this.getWindowHeight()}this.setHeight(a);this.fireMaximizeEvent()}else{if(!a){a=this.getScreenHeight()}this.setHeight(a);this.waitUntil(function(){this.scrollToTop();return e!==this.getWindowHeight()},function(){if(!d[b]){a=d[b]=this.getWindowHeight();this.setHeight(a)}this.fireMaximizeEvent()},function(){a=d[b]=this.getWindowHeight();this.setHeight(a);this.fireMaximizeEvent()},50,1000)}},getScreenHeight:function(){return window.screen[this.orientation===this.PORTRAIT?"height":"width"]},onElementFocus:function(){if(this.getAutoMaximize()&&!this.isFullscreen()){clearTimeout(this.scrollToTopTimer)}this.callParent(arguments)},onElementBlur:function(){if(this.getAutoMaximize()&&!this.isFullscreen()){this.scrollToTopTimer=setTimeout(this.scrollToTop,500)}this.callParent(arguments)},onTouchStart:function(){if(this.focusedElement===null){this.scrollToTop()}},scrollToTop:function(){window.scrollTo(0,0)}},function(){if(!Ext.os.is.iOS){return}if(Ext.os.version.lt("3.2")){this.override({constructor:function(){var a=this.stretchHeights={};a[this.PORTRAIT]=416;a[this.LANDSCAPE]=268;return this.callOverridden(arguments)}})}if(Ext.os.version.lt("5")){this.override({fieldMaskClsTest:"-field-mask",doPreventZooming:function(b){var a=b.target;if(a&&a.nodeType===1&&!this.isInputRegex.test(a.tagName)&&a.className.indexOf(this.fieldMaskClsTest)==-1){b.preventDefault()}}})}if(Ext.os.is.iPad){this.override({isFullscreen:function(){return true}})}if(Ext.os.version.gtEq("7")){if(Ext.os.deviceType==="Tablet"||!Ext.browser.is.Safari||window.navigator.standalone){this.override({constructor:function(){var e={},b={},a=this.determineOrientation(),g=window.screen.height,d=window.screen.width,f=a===this.PORTRAIT?g-window.innerHeight:d-window.innerHeight;e[this.PORTRAIT]=g-f;e[this.LANDSCAPE]=d-f;b[this.PORTRAIT]=d;b[this.LANDSCAPE]=g;this.stretchHeights=e;this.stretchWidths=b;this.callOverridden(arguments);this.on("ready",this.setViewportSizeToAbsolute,this);this.on("orientationchange",this.setViewportSizeToAbsolute,this)},getWindowHeight:function(){return this.stretchHeights[this.orientation]},getWindowWidth:function(){return this.stretchWidths[this.orientation]},setViewportSizeToAbsolute:function(){this.setWidth(this.getWindowWidth());this.setHeight(this.getWindowHeight())}})}if(Ext.os.deviceType==="Tablet"){this.override({constructor:function(){this.callOverridden(arguments);window.addEventListener("scroll",function(){if(window.scrollX!==0){window.scrollTo(0,window.scrollY)}},false)},setViewportSizeToAbsolute:function(){window.scrollTo(0,0);this.callOverridden(arguments)},onElementBlur:function(){this.callOverridden(arguments);if(window.scrollY!==0){window.scrollTo(0,0)}}})}}});Ext.define("Ext.viewport.WindowsPhone",{requires:[],alternateClassName:"Ext.viewport.WP",extend:Ext.viewport.Default,config:{translatable:{translationMethod:"csstransform"}},initialize:function(){var a=function(f){var d=f.srcElement.nodeName.toUpperCase(),b=["INPUT","TEXTAREA"];if(b.indexOf(d)==-1){return false}};document.body.addEventListener("onselectstart",a);this.callParent(arguments)},supportsOrientation:function(){return false},onResize:function(){this.waitUntil(function(){var d=this.windowWidth,g=this.windowHeight,f=this.getWindowWidth(),a=this.getWindowHeight(),e=this.getOrientation(),b=this.determineOrientation();return((d!==f&&g!==a)&&e!==b)},function(){var b=this.getOrientation(),a=this.determineOrientation();this.fireOrientationChangeEvent(a,b)},Ext.emptyFn,250)}});Ext.define("Ext.viewport.Viewport",{constructor:function(b){var d=Ext.os.name,e,a;switch(d){case"Android":e=(Ext.browser.name=="ChromeMobile")?"Default":"Android";break;case"iOS":e="Ios";break;case"Windows":e=(Ext.browser.name=="IE")?"WindowsPhone":"Default";break;case"WindowsPhone":e="WindowsPhone";break;default:e="Default";break}a=Ext.create("Ext.viewport."+e,b);return a}});Ext.define("NisTRApp.view.SysUtility",{extend:Ext.Base,alias:"widget.SysUtility",statics:{ProtalServer:function(){try{switch(location.hostname.toLowerCase()){case"172.16.254.150":case"hisweb3.kfcc.intra":return NIS_SERVER.PortalServer.Developing;break;case"localhost":case"127.0.0.1":return NIS_SERVER.PortalServer.Developing;default:return NIS_SERVER.PortalServer.Production}}catch(a){return NIS_SERVER.PortalServer.Production}},NisServer:function(){try{switch(location.hostname.toLowerCase()){case"172.16.254.150":case"hisweb3.kfcc.intra":return NIS_SERVER.NisServer.Developing;break;case"localhost":case"127.0.0.1":return"//"+location.hostname+":5000";case"go.kfcc.intra":case"172.16.254.39":case"172.16.254.124":case"172.16.254.125":return NIS_SERVER.NisServer.Production;default:return NIS_SERVER.NisServer.Developing}}catch(a){return NIS_SERVER.NisServer.Developing}},GetAppID:function(){return"NisTRApp"},Logout:function(){var b=function b(){var d=Ext.ComponentQuery.query(".container");for(var e in d){try{d[e].fireEvent("SysLogout",d[e])}catch(f){}}d=null;delete d};b();Ext.getStore("sUserConfig").removeAll();NisTRApp.view.SysUtility.RemoveUserInfo();delete localStorage.hash;location.hash="";localStorage.clear();if(!Ext.isEmpty(Ext.getCmp("MainUI"))){try{Ext.getCmp("MainUI").destroy()}catch(a){}}$.ajax({url:NisTRApp.view.SysUtility.ProtalServer()+"/portal/o",type:"get",dataType:"text",timeout:10000,crossDomain:true,xhrFields:{withCredentials:true},beforeSend:function(){Ext.Viewport.setMasked({xtype:"loadmask",message:"登出中..."})},complete:function(){if(Ext.isEmpty(Ext.getCmp("Login"))){Ext.create("NisTRApp.view.Login",{id:"Login",fullscreen:true})}Ext.Viewport.animateActiveItem(Ext.getCmp("Login"),{type:"slide",direction:"right"});Ext.Viewport.setMasked(false);b=null;delete b;typeof(Portal)!="undefined"&&Portal.doClearCurrentCredential()}})},RemoveUserInfo:function(){Ext.getStore("sUserInfo").removeAll()},GetUserInfo:function(){try{var b=Ext.getStore("sUserInfoLocal");if(!Ext.isEmpty(b)){if(b.getCount()<=0){b.load()}if(b.getCount()>0){return b.getAt(0)}}b=null;delete b;return null}catch(a){return null}},GetUserID:function(a){var b=NisTRApp.view.SysUtility.GetUserInfo();if((null!=b)&&(null!=b.data)&&(!String.IsNull(b.data.UserID))){return b.data.UserID}else{delete localStorage.hash;Ext.Msg.alert(SYS_CONST.Warning.SCW5);throw SYS_CONST.Warning.SCW5;return null}},GetUserName:function(){var a=NisTRApp.view.SysUtility.GetUserInfo();if((null!=a)&&(null!=a.data)&&(!String.IsNull(a.data.UserName))){return a.data.UserName}else{return null}},GetToken:function(){try{var b=NisTRApp.view.SysUtility.GetUserInfo();return b.data.Token}catch(a){return null}},Verification:function(e,b){var d=NisTRApp.view.SysUtility.GetToken();var a=Ext.getStore("sUserInfo");if(null==d||""==d||Ext.isEmpty(a)){a=null;delete a;b(SYS_CONST.Warning.SCW6);return false}else{if(a.isLoading()){a=null;delete a;return}a.getProxy().setUrl(NisTRApp.view.SysUtility.ProtalServer()+"/api/authentication/verify.ashx");a.getProxy().setExtraParams({AppID:NisTRApp.view.SysUtility.GetAppID(),Token:d});a.load({callback:function(g,f,j){if(j&&!Ext.isEmpty(g)&&g.length>0){try{result=g[0].data;if(null==result.Token||""==result.Token||result.Token!=d){b(SYS_CONST.Warning.SCW7,request);return false}else{if(null==result.UserID||""==result.UserID){b(SYS_CONST.Warning.SCW8,request);return false}else{e(result);result=null;delete result;return true}}}catch(h){NisTRApp.view.SysUtility.RemoveUserInfo();b(SYS_CONST.Warning.SCW9);console.log("Verification Error : "+h);return true}}else{b(SYS_CONST.Warning.SCW9,f);return false}},scope:this})}a=null;delete a;return},VerificationPortal:function(d,b){var a=new Promise(function(e){$.ajax({url:NisTRApp.view.SysUtility.ProtalServer()+"/hash/u/"+JSON.parse(Portal.currentCredential()).EmployeeNumber,success:function(f){e(f)}})});a.then(function(f){var e=Ext.getStore("sUserInfo");e.getProxy().setUrl(NisTRApp.view.SysUtility.ProtalServer()+"/api/authentication/signin.ashx");e.getProxy().setExtraParams({AppID:NisTRApp.view.SysUtility.GetAppID(),attmptLogin:true});e.load({callback:function(h,g,k){if(k&&!Ext.isEmpty(h)&&h.length>0){try{result=h[0].data;if(null==result.Token||""==result.Token){b(SYS_CONST.Warning.SCW7,request);return false}else{if(null==result.UserID||""==result.UserID){b(SYS_CONST.Warning.SCW8,request);return false}else{d(result);result=null;delete result}}}catch(j){NisTRApp.view.SysUtility.RemoveUserInfo();b(SYS_CONST.Warning.SCW9);console.log("Verification Error : "+j);return false}}else{b(SYS_CONST.Warning.SCW9,g);return false}a.then(function(l){console.log("VerificationPortal : ",NisTRApp.view.SysUtility.GetUserInfo().data)});return true},scope:this});e=null;delete e})},getUserID:function(a){var b=NisTRApp.view.SysUtility.GetUserInfo();if((null!=b)&&(null!=b.data)&&(!String.IsNull(b.data.UserID))){return b.data.UserID}else{return null}},IsLogOut:function(){var a=NisTRApp.view.SysUtility.GetUserInfo();if((null!=a)&&(null!=a.UserID)&&(""!=a.UserID)){return false}else{return true}},InnerWidth:function(){return $("body").innerWidth()},ClcWidth:function(b){var a=$("body").innerWidth();try{if(null!=b&&0<b&&100>=b){return(a*(b/100))}}catch(d){return a}return a},InnerHeight:function(){return $("body").innerHeight()},ClcHeight:function(a){var d=$("body").innerHeight();try{if(null!=a&&0<a&&100>=a){return(d*(a/100))}}catch(b){return d}return d},GetExternalWeb:function(b){var a="";if(b==undefined){a==""}else{a=b}var d={HISWEB:"go.kfcc.intra",Production:"go.kfcc.intra",Staging:"172.16.254.150",TestWeb:"172.16.254.150"}[a];if(a==""||d==undefined){d="go.kfcc.intra"}return"http://"+d+"/"},AgentServer:function(){return"http://emr-db.kfcc.intra/AgentServer";try{switch(location.hostname.toLowerCase()){case"172.16.254.150":case"hisweb3.kfcc.intra":return"http://hisweb3.kfcc.intra/AgentServer";break;case"localhost":case"127.0.0.1":return"http://hisweb3.kfcc.intra/AgentServer";default:return"http://172.16.254.39/AgentServer"}}catch(a){return"http://172.16.254.39/AgentServer"}},SysServer:function(){try{switch(location.hostname.toLowerCase()){case"172.16.254.150":case"hisweb3.kfcc.intra":return"//hisweb3.kfcc.intra";break;case"localhost":case"127.0.0.1":return"//hisweb3.kfcc.intra";default:return"//go.kfcc.intra"}}catch(a){return"//go.kfcc.intra"}},IsProtalDevice:function(){return(navigator.userAgent.indexOf("KFSYSCC_Portal")!=-1)},IsiDevice:function(){return(/ipad/i).test(navigator.userAgent)||(/iphone/i).test(navigator.userAgent)||(/ipod/i).test(navigator.userAgent)},tapEventName:function(){return NisTRApp.view.SysUtility.IsiDevice()?"touchstart":"click"},KfccAuthentication:function(d,b,e,a){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"action/KfsysccAuthentication.ashx",scope:this,method:"POST",timeout:30000,params:{UserID:encodeURIComponent(d.toUpperCase()),Password:encodeURIComponent(b)},success:function(g){try{if(g.responseText=="False"){a("帳號密碼錯誤");return false}var j=Ext.decode(g.responseText);var f=Ext.create("NisTRApp.model.Sys.UserInfo",{UserID:j.EmpNO,UserName:j.NameCH,DeptCode:j.DeptID,EmpNo:j.EmpNO,UserEngName:j.NameEN});e(f);return true}catch(h){a("AD 驗證異常");return false}},failure:function(){a("AD 驗證異常");return false}})},NameToFunctionType:function(a){if(SYS_CONST.FunctionType.Default.Name==a){return SYS_CONST.FunctionType.Default}else{if(SYS_CONST.FunctionType.OPR.Name==a){return SYS_CONST.FunctionType.OPR}else{if(SYS_CONST.FunctionType.ACC.Name==a){return SYS_CONST.FunctionType.ACC}else{if(SYS_CONST.FunctionType.EMR.Name==a){return SYS_CONST.FunctionType.EMR}else{if(SYS_CONST.FunctionType.WB.Name==a){return SYS_CONST.FunctionType.WB}else{if(SYS_CONST.FunctionType.ENDO.Name==a){return SYS_CONST.FunctionType.ENDO}else{if(SYS_CONST.FunctionType.RIS.Name==a){return SYS_CONST.FunctionType.RIS}else{if(SYS_CONST.FunctionType.CMS.Name==a){return SYS_CONST.FunctionType.CMS}else{if(SYS_CONST.FunctionType.OUTP.Name==a){return SYS_CONST.FunctionType.OUTP}else{if(SYS_CONST.FunctionType.NULL.Name==a){return SYS_CONST.FunctionType.NULL}else{if(SYS_CONST.FunctionType.IPB.Name==a){return SYS_CONST.FunctionType.IPB}else{return SYS_CONST.FunctionType.Default}}}}}}}}}}}}},config:{appId:"NisTRApp"}});Ext.define("NisTRApp.view.Misc",{extend:Ext.Base,statics:{MsgShow:function(f,b,a){var e=null;var d=0;if(null!=a&&0<a){d=setTimeout(function(){if(null!=e){e.hide();delete e}clearTimeout(d)},a)}e=Ext.Msg.show({title:b,message:('<span style="word-wrap:break-word;">'+f+"</span>"),scope:this,buttons:[{itemId:"ok",id:"ok",text:"ok"}],fn:function(g){if(d>0){clearTimeout(d);d=0}}})},ButtonSelect:function(k,j,e,d,f,g,a){try{var h=k.items;if(null!=h){h.each(function(n,l,m){if(n.xtype=="button"){if(n.id==j.id){n.setUi(e);if(!(!Ext.isEmpty(a)&&a==false)){n.setBadgeText(f)}}else{n.setUi(d);if(!(!Ext.isEmpty(a)&&a==false)){n.setBadgeText(g)}}}})}h=null;delete h}catch(b){}},ResetContentDiv:function(b,a){if($("#"+b)!=null&&$("#"+b)!=undefined){$("#"+b).find("iframe").remove();$("#"+b).empty()}if(null!=a&&undefined!=a){a.setHtml('<div style="width: 100%; height: 100%;" id="'+b+'" ></div>')}},createFrameContent:function(e,a,g,b){e[0].style.cssText="width:100% !important; height: 100% !important;";var f=String.format('<iframe {0} style="overflow-y:scroll !important; -webkit-overflow-scrolling:touch !important;overflow:hidden;overflow-x:hidden;overflow-y:hidden;height:100%;width:100%;position:absolute; top:0px; left:0px; right:0px; bottom:0px;" width="100%" height="100%" frameborder="0" />',(String.IsNull(g)?"":('id="'+g+'"')));var d=$(f).on("load",function(){if(!Ext.isEmpty(b)){b()}}).attr("src",a);e.empty().append(d);delete f;f=null},createResizeFrameContent:function(e,a,g,b){e[0].style.cssText="width:100% !important; height: 100% !important;";var f=String.format('<iframe {0} style="overflow-y:scroll !important; -webkit-overflow-scrolling:touch !important;overflow:hidden;overflow-x:hidden;overflow-y:hidden;height:100%;width:100%;position:absolute; top:0px; left:0px; right:0px; bottom:0px;" width="100%" height="100%" frameborder="0" />',(String.IsNull(g)?"":('id="'+g+'"')));var d=$(f).on("load",function(){try{var h=$(this).parents("div.x-inner.x-panel-inner")[0].offsetHeight;var j=parseInt(h-this.offsetTop-4)+"px";this.height=j;if(!Ext.isEmpty(b)){b()}}catch(k){return false}}).attr("src",a);e.empty().append(d);delete f;f=null},Alert:function(e,a){var d=null;var b=0;if(null!=a&&0<a){b=setTimeout(function(){if(null!=d){d.hide();delete d}clearTimeout(b)},a)}var d=Ext.Msg.alert(e,"")},createPortalContent:function(a,d){var b=a;if(!NisTRApp.view.Misc.IsValidURL(b)){b=location.protocol+a}if(!NisTRApp.view.Misc.IsValidURL(b)){NisTRApp.view.Misc.Alert("網址錯誤",1000)}else{Portal.popupCallbackEventWithEvent(b,d)}b=null;delete b},IsValidURL:function(b){var a=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;if(a.test(b)){return true}else{return false}},htmlEncode:function(b){try{return $("<div/>").text(b).html()}catch(a){return b}},htmlDecode:function(b){try{return $("<div/>").html(b).text()}catch(a){return b}},CheckBoxSingleSelect:function(f,a,e){if(e!=true){return}try{var b=f.items;if(null!=b){b.each(function(j,g,h){if(j.xtype=="checkboxfield"){if(j.id!=a.id){j.uncheck()}}})}b=null;delete b}catch(d){}},Substr:function(b,d,a){if(!Ext.isEmpty(b)){return b.substr(d,a)}else{return""}},SigleSelectFn:function(d){try{var a=d.items;if(null!=a){a.each(function(g,e,f){if(g.xtype=="checkboxfield"){g.addListener("change",function(h,l,j,k){NisTRApp.view.Misc.CheckBoxSingleSelect(h.getParent(),h,l)},d)}})}a=null;delete a}catch(b){}},OpenOutSite:function(b){var a=(Ext.os.deviceType!="Desktop");var d=document.createElement("a");d.href=b;if(a){d.click()}else{window.open(b)}},PanelChange:function(b,a,e){try{var d=b.items;if(null!=d){d.each(function(j,g,h){if(j.xtype=="panel"){if(j._itemId==a){j.setHidden(false)}else{j.setHidden(true)}}})}d=null;delete d}catch(f){}},LoadData:function(a,e,b){if(Ext.isEmpty(a)||Ext.isEmpty(Ext.getStore(a))||Ext.getStore(a).isLoading()){return}var d=Ext.getStore(a);if(b==true){d.removeAll()}d.getProxy().setExtraParams(e);d.load();d=null;delete d;e=null;delete e}},config:{}});Ext.define("NisTRApp.model.Form.ListItem",{extend:Ext.data.Model,config:{fields:[{name:"text"},{name:"formID"},{convert:function(a,b){return b.data.formID},name:"FormID",type:"string"},{convert:function(a,b){return b.data.text},name:"Title",type:"string"},{name:"CategoryID",type:"string"}]}});Ext.define("NisTRApp.view.TRUtility",{extend:Ext.Base,statics:{BirthdayFormat:function(a){if(!String.IsNull(a)&&a.length==8){return a.substr(0,4)+"-"+a.substr(4,2)+"-"+a.substr(6,2)}else{return a}},OpenOprMainUI:function(a,f,b){if(Ext.isEmpty(a)||String.IsNull(a.data.ChartNO)){return false}if(null==f||undefined==f){f=SYS_CONST.PageDef.Profile}if(a.data.Source.Type==2){var e=Ext.getStore("sInpPatient");e.removeAll();e.getProxy().setExtraParams({ChartNo:a.data.ChartNo,InpNo:a.data.InpNO});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});e.load({callback:function(h,g,j){if(null!=h&&null!=h[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(!String.IsNull(h[0].data.InpNo)){if(null==Ext.getCmp("MainUI")){Ext.create("NisTRApp.view.MainUI",{id:"MainUI",fullscreen:true})}Ext.getCmp("MainUI").setPatient(h[0]);if(null==Ext.getCmp("MainUI").down(".INP_PatInfoBar")){if(null==Ext.getCmp("InpPatInfoBar")||undefined==Ext.getCmp("InpPatInfoBar")){Ext.create("NisTRApp.view.INP_PatInfoBar",{id:"InpPatInfoBar",maskOnOpen:false,docked:"top",record:h[0]})}Ext.getCmp("MainUI").add([Ext.getCmp("InpPatInfoBar")])}if(undefined==Ext.getCmp("InpMainUI")||null==Ext.getCmp("InpMainUI")){Ext.create("NisTRApp.view.InpMainUI",{id:"InpMainUI",fullscreen:true})}Ext.getCmp("InpMainUI").list.select(f.INP);Ext.getCmp("InpMainUI").setRecord(h[0]);Ext.getCmp("MainUI").add([Ext.getCmp("InpMainUI")]);location.hash="";Ext.Viewport.setActiveItem(Ext.getCmp("MainUI"));return false}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("住院資料錯誤!","");return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");return false}},scope:this});e=null;delete e;return false}else{if(a.data.Source.Type==1){var d=Ext.getStore("sRegPatient");d.removeAll();d.getProxy().setExtraParams({ChartNo:a.data.ChartNo,ChartSeq:a.data.ChartSeq});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});d.load({callback:function(h,g,j){if(null!=h&&null!=h[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(h[0].data.ChartLastVol>0){if(null==Ext.getCmp("MainUI")){Ext.create("NisTRApp.view.MainUI",{id:"MainUI",fullscreen:true})}Ext.getCmp("MainUI").setPatient(h[0]);if(null==Ext.getCmp("MainUI").down(".OPD_PatInfoBar")){if(null==Ext.getCmp("OpdPatInfoBar")||undefined==Ext.getCmp("OpdPatInfoBar")){Ext.create("NisTRApp.view.OPD_PatInfoBar",{id:"OpdPatInfoBar",maskOnOpen:false,docked:"top",record:h[0]})}Ext.getCmp("MainUI").add([Ext.getCmp("OpdPatInfoBar")])}if(undefined==Ext.getCmp("OpdMainUI")||null==Ext.getCmp("OpdMainUI")){Ext.create("NisTRApp.view.OpdMainUI",{id:"OpdMainUI",fullscreen:true})}Ext.getCmp("OpdMainUI").setRecord(h[0]);Ext.getCmp("OpdMainUI").list.select(f.OPD);Ext.getCmp("MainUI").add([Ext.getCmp("OpdMainUI")]);location.hash="";Ext.Viewport.setActiveItem(Ext.getCmp("MainUI"));return false}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("無病歷檔或初診尚未報到!","");return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");return false}},scope:this});d=null;delete d}else{NisTRApp.view.Misc.MsgShow("病人無住院或門診掛號資料!","",2000)}}return false},IniaialSysStore:function(a,b){console.log(a,b,(b?true:false));return;if((Ext.isEmpty(a)||a=="sNewAssessmentRecord")&&Ext.getStore("sNewAssessmentRecord")==null){Ext.create("Ext.data.TreeStore",{storeId:"sNewAssessmentRecord",autoLoad:(b?true:false),model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Assessment"},url:"../api/Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}},NoonTranToName:function(d){var a="";try{switch(d){case"1":a="上午";break;case"2":a="下午";break;case"A":a="教學上午";break;case"P":a="教學下午";break;case"M":a="教學上午二";break;case"N":a="教學下午二";break;case"U":a="教學上午三";break;case"D":a="教學下午三";break;case"S":a="特診";break;default:a="Error"}return a}catch(b){return"Error"}},confirm:function(e,a,d,b,f){Ext.Msg.confirm(e,a,function(h,j,g){if(h=="no"){if(!Ext.isEmpty(b)){b()}return}else{if(h=="yes"){if(!Ext.isEmpty(d)){d(f)}}}},f)},OpenMainUI:function(b,g,d){if(Ext.isEmpty(b)||String.IsNull(b.data.ChartNO)){return false}if(null==g||undefined==g){g=SYS_CONST.PageDef.Profile}if(b.data.Source.Type==2){var f=Ext.getStore("sInpPatient");f.removeAll();f.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNO});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});f.load({callback:function(k,j,l){if(null!=k&&null!=k[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(!String.IsNull(k[0].data.InpNo)){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").destroy()}if(null==Ext.getCmp("MainUI")){Ext.create("NisTRApp.view.MainUI",{id:"MainUI",fullscreen:true})}Ext.getCmp("MainUI").setPatient(k[0]);if(null==Ext.getCmp("MainUI").down(".INP_PatInfoBar")){if(null==Ext.getCmp("InpPatInfoBar")||undefined==Ext.getCmp("InpPatInfoBar")){Ext.create("NisTRApp.view.INP_PatInfoBar",{id:"InpPatInfoBar",maskOnOpen:false,docked:"top",record:k[0]})}Ext.getCmp("MainUI").add([Ext.getCmp("InpPatInfoBar")])}if(undefined==Ext.getCmp("InpMainUI")||null==Ext.getCmp("InpMainUI")){Ext.create("NisTRApp.view.InpMainUI",{id:"InpMainUI",fullscreen:true})}Ext.getCmp("InpMainUI").list.select(g.INP);Ext.getCmp("InpMainUI").setRecord(k[0]);Ext.getCmp("MainUI").add([Ext.getCmp("InpMainUI")]);Ext.Viewport.setActiveItem(Ext.getCmp("MainUI"));return false}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("住院資料錯誤!","");return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");return false}},scope:this});f=null;delete f;return false}else{if(b.data.Source.Type==1&&(Ext.isEmpty(b.data.IsPHE)||b.data.IsPHE==false)){var e=Ext.getStore("sRegPatient");e.removeAll();e.getProxy().setExtraParams({ChartNo:b.data.ChartNo,ChartSeq:b.data.ChartSeq});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});e.load({callback:function(k,j,l){if(null!=k&&null!=k[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(k[0].data.ChartLastVol>0){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").destroy()}if(null==Ext.getCmp("MainUI")){Ext.create("NisTRApp.view.MainUI",{id:"MainUI",fullscreen:true})}Ext.getCmp("MainUI").setPatient(k[0]);if(null==Ext.getCmp("MainUI").down(".OPD_PatInfoBar")){if(null==Ext.getCmp("OpdPatInfoBar")||undefined==Ext.getCmp("OpdPatInfoBar")){Ext.create("NisTRApp.view.OPD_PatInfoBar",{id:"OpdPatInfoBar",maskOnOpen:false,docked:"top",record:k[0]})}Ext.getCmp("MainUI").add([Ext.getCmp("OpdPatInfoBar")])}if(undefined==Ext.getCmp("OpdMainUI")||null==Ext.getCmp("OpdMainUI")){Ext.create("NisTRApp.view.OpdMainUI",{id:"OpdMainUI",fullscreen:true})}Ext.getCmp("OpdMainUI").setRecord(k[0]);Ext.getCmp("OpdMainUI").list.select(g.OPD);Ext.getCmp("MainUI").add([Ext.getCmp("OpdMainUI")]);location.hash="";Ext.Viewport.setActiveItem(Ext.getCmp("MainUI"));return false}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("無病歷檔或初診尚未報到!","");return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");return false}},scope:this});e=null;delete e}else{if(b.data.Source.Type==1&&(!Ext.isEmpty(b.data.IsPHE)&&b.data.IsPHE==true)){var a=Ext.getStore("sPhePatient");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,ChartSeq:b.data.ChartSeq,UserID:NisTRApp.view.SysUtility.GetUserID(),Source:"PHE"});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});a.load({callback:function(k,j,l){if(null!=k&&null!=k[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(k[0].data.ChartLastVol>0){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").destroy()}if(null==Ext.getCmp("MainUI")){Ext.create("NisTRApp.view.MainUI",{id:"MainUI",fullscreen:true})}Ext.getCmp("MainUI").setPatient(k[0]);if(null==Ext.getCmp("MainUI").down(".OPD_PatInfoBar")){if(null==Ext.getCmp("OpdPatInfoBar")||undefined==Ext.getCmp("OpdPatInfoBar")){Ext.create("NisTRApp.view.OPD_PatInfoBar",{id:"OpdPatInfoBar",maskOnOpen:false,docked:"top",record:k[0]})}Ext.getCmp("MainUI").add([Ext.getCmp("OpdPatInfoBar")])}if(undefined==Ext.getCmp("OpdMainUI")||null==Ext.getCmp("OpdMainUI")){Ext.create("NisTRApp.view.OpdMainUI",{id:"OpdMainUI",fullscreen:true})}Ext.getCmp("OpdMainUI").setRecord(k[0]);Ext.getCmp("OpdMainUI").list.select(g.OPD);Ext.getCmp("MainUI").add([Ext.getCmp("OpdMainUI")]);location.hash="";Ext.Viewport.setActiveItem(Ext.getCmp("MainUI"));return false}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("無病歷檔或初診尚未報到!","");return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");return false}},scope:this});a=null;delete a}else{if(b.data.Source.Type==4){var h=Ext.getStore("sVirtualPatient");h.removeAll();h.getProxy().setExtraParams({ChartNo:b.data.ChartNo,ChartSeq:b.data.ChartSeq,UserID:NisTRApp.view.SysUtility.GetUserID(),Source:b.data.Source.Name});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});h.load({callback:function(k,j,l){if(null!=k&&null!=k[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(k[0].data.ChartLastVol>0){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").destroy()}if(null==Ext.getCmp("MainUI")){Ext.create("NisTRApp.view.MainUI",{id:"MainUI",fullscreen:true})}Ext.getCmp("MainUI").setPatient(k[0]);if(null==Ext.getCmp("MainUI").down(".OPD_PatInfoBar")){if(null==Ext.getCmp("OpdPatInfoBar")||undefined==Ext.getCmp("OpdPatInfoBar")){Ext.create("NisTRApp.view.OPD_PatInfoBar",{id:"OpdPatInfoBar",maskOnOpen:false,docked:"top",record:k[0]})}Ext.getCmp("MainUI").add([Ext.getCmp("OpdPatInfoBar")])}if(undefined==Ext.getCmp("OpdMainUI")||null==Ext.getCmp("OpdMainUI")){Ext.create("NisTRApp.view.OpdMainUI",{id:"OpdMainUI",fullscreen:true})}Ext.getCmp("OpdMainUI").setRecord(k[0]);Ext.getCmp("OpdMainUI").list.select(g.OPD);Ext.getCmp("MainUI").add([Ext.getCmp("OpdMainUI")]);location.hash="";Ext.Viewport.setActiveItem(Ext.getCmp("MainUI"));return false}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("無病歷檔或初診尚未報到!","");return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");return false}},scope:this});h=null;delete h}else{NisTRApp.view.Misc.MsgShow("病人無住院或門診掛號資料!","",2000)}}}}return false},OpenCommonInfoPanel:function(f,d,e,b){if(!Ext.isEmpty(Ext.getCmp("_commonPanel"))){Ext.getCmp("_commonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_commonPanel"))){var a=Ext.create("NisTRApp.view.CommonPanel",{id:"_commonPanel",modal:true,centered:true,record:f,hideOnMaskTap:false,height:"90%",width:"98%",caller:d,defaultPage:e,hiddens:((Ext.isEmpty(b)||!Array.isArray(b))?[]:b)});a.showBy(Ext.Viewport,"cc-cc");a=null;delete a}d=null;delete d;f=null;delete f;wi=null;delete wi;he=null;delete he},LabTeamToName:function(b){try{switch(b){case"B":return"細菌";break;case"C":return"生化";break;case"E":return"緊急生化";break;case"H":return"血液";break;case"I":return"免疫";break;case"M":return"多用";break;case"S":return"屎";break;case"T":return"輸血檢查(血型)";break;case"U":return"尿";break;case"D":return"防疫";break;default:return""}}catch(a){return""}},TimeFormat:function(a){if(!String.IsNull(a)&&a.length==6){return a.substr(0,2)+":"+a.substr(2,2)+":"+a.substr(4,2)}else{if(!String.IsNull(a)&&a.length==4){return a.substr(0,2)+":"+a.substr(2,2)}else{return birthday}}},GetUrlInfo:function(){var d=location.hash.replace(/^#/,"");var b=undefined;if(!Ext.isEmpty(d)){d=decodeURI(d)}if(!Ext.isEmpty(d)&&d.indexOf("&")!=-1){var a=d.split("&");b={};b.ChartSeq=-1;$(a).each(function(){var e=this.split("=");switch(e[0].toLowerCase()){case"c":b.ChartNo=e[1];break;case"s":b.ChartSeq=parseInt(e[1],10);break;case"i":b.InpNo=(e[1]);break;case"tk":b.Token=e[1];break;case"appid":b.AppID=e[1];break;case"userid":b.UserID=e[1];break;case"system":b.System=e[1];break;case"pg":b.Page=e[1];break;case"spg":b.SubPage=e[1];break;default:b[e[0].toLowerCase()]=e[1];break}});a=null;delete a;return b}return null}},config:{}});Ext.define("NisTRApp.view.GridUtility",{extend:Ext.Base,alias:"widget.GridUtility",statics:{GenIPBInPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:"基本資料",xtype:"gridheadergroup",cls:"gridInPatBaseInfoFont",items:[{text:"Care",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CareTag(values.CareFlag, values.KeyOne)]}",{CareTag:function(e,f){if(!String.IsNull(e)&&e!=""){return' <img id="IPBCARECHECK_CAREFLAG_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="IPBCARECHECK_CAREFLAG_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}}}),width:50,hidden:false,sortable:false,flex:1},{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="INSERT_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:"床號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="IPBMGR_BEDNO_{KeyOne}" class="link-btn" style="font-size: 20px; font-weight:bold;"; color:{StyleColor};>{StationStr}</a>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="IPBMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:true,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<div style="background-color:{BgColor}; width:150;height:90%; margin: 2px 2px 2px 2px;"><span id="IPBPTWORKLIST_PTNAME_{KeyOne}" style="color:{StyleColor}; font-size: 16px; font-weight: bold;">{PatName}</span></div>',flex:1,width:150,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false}]},{text:"高風險",xtype:"gridheadergroup",cls:"gridInPatHighRiskFont",items:[{text:"跌倒",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:DarkOrange; font-size: 18px; font-weight:bold;">{[this.format(values.RiskFall)]}</span>',{format:function(e){return((!String.IsNull(e)&&e=="Y")?"跌":"")}}),flex:1,width:60,hidden:false,editable:false,sortable:false},{text:"壓瘡",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:blue; font-size: 18px; font-weight:bold;">{[this.format(values.RiskBedSore)]}</span>',{format:function(e){return((!String.IsNull(e)&&e=="Y")?"壓":"")}}),flex:1,width:60,hidden:false,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:DarkGreen; font-size: 18px; font-weight:bold;">{[this.format(values.RiskCath)]}</span>',{format:function(e){return((!String.IsNull(e)&&e=="Y")?"管":"")}}),flex:1,width:60,hidden:false,editable:false,sortable:false},{text:"DNR",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 14px; font-weight:bold;">{[this.format(values.RiskDnr)]}</span>',{format:function(e){return((!String.IsNull(e)&&e=="Y")?"Dnr":"")}}),flex:1,width:60,hidden:false,editable:false,sortable:false}]},{text:"醫囑",xtype:"gridheadergroup",cls:"gridInPatOrderFont",items:[{text:"新醫囑",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 16px; font-weight:bold;">{[this.format(values.NewOrdCnt)]}</span>',{format:function(e){return(e>0?e:"")}}),flex:1,width:70,hidden:false,editable:false,sortable:false},{text:"Stat",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 14px; font-weight:bold;">{[this.format(values.StatOrderCount)]}</span>',{format:function(e){return(e>0?e:"")}}),flex:1,width:70,hidden:false,editable:false,sortable:false},{text:"逾時",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 16px; font-weight:bold;">{[this.format(values.OverTimeCount)]}</span>',{format:function(e){return(e>0?e:"")}}),flex:1,width:70,hidden:false,editable:false,sortable:false},{text:"給藥",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 16px; font-weight:bold;">{[this.format(values.NeedDrugCount)]}</span>',{format:function(e){return(e>0?e:"")}}),flex:1,width:70,hidden:false,editable:false,sortable:false},{text:"化療",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 16px; font-weight:bold;">{[this.format(values.ChemoCount)]}</span>',{format:function(e){return(e>0?e:"")}}),flex:1,width:70,hidden:false,editable:false,sortable:false},{text:"PCA",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 16px; font-weight:bold;">{[this.format(values.PCACount)]}</span>',{format:function(e){return(e>0?e:"")}}),flex:1,width:70,hidden:false,editable:false,sortable:false}]}]})},ItemSingleTapIPBGrid:function(j,d,f,b,g,h){var l=function(e,p,n){var o=e.data.CareFlag;var m=Ext.fly(p);e.data.CareFlag=(String.IsNull(o)?NisTRApp.view.SysUtility.GetUserID():"");m.dom.src=SYS_CONST.ImgRoot+"checkbox-icon.png";n.refresh();Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/UpdatePatientCareList.ashx",useDefaultXhrHeader:false,method:"POST",scope:n,params:{InpNO:e.data.InpNO,UserID:(String.IsNull(o)?NisTRApp.view.SysUtility.GetUserID():o),Flag:(String.IsNull(o)?"ADD":"DEL")},success:function(q){var r=Ext.decode(q.responseText);if(!Ext.isEmpty(n)&&r.Success){}else{NisTRApp.view.Misc.Alert(r.Message,(r.Success?1200:0))}r=null;delete r},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);n=null;delete n;e=null;delete e}})};var a=function(e,n,m){location.hash=String.format("system={0}&c={1}&i={2}&pg=Management&spg={3}",NisTRApp.app.getFuncType().Name,e.data.ChartNO,e.data.InpNO,((e.data.NewOrdCnt>0)?4:0))};var j=this;var k=g.event.target.id.split("_");if(null==k||k.length<=0){g.preventDefault();return false}if(g.event.target.nodeName=="IMG"||g.event.target.nodeName=="SPAN"||g.event.target.nodeName=="A"){switch(k[0]){case"TEST":NisTRApp.view.TRUtility.OpenMainUI(b,SYS_CONST.PageDef.Management,this);break;case"IPBMGR":a(b,g.event.target.id,j);NisTRApp.view.TRUtility.OpenMainUI(b,SYS_CONST.PageDef.Management,this);break;case"IPBMED":NisTRApp.view.TRUtility.OpenCommonInfoPanel(b,j,"MED",["OPR","RIS","ENDO"]);break;case"IPBCARECHECK":l(b,g.event.target.id,j);break;default:break}g.preventDefault()}else{if(g.event.target.nodeName=="INPUT"){}}l=null;delete l;a=null;delete a;k=null;delete k;j=null;delete j;return false},GenOPRInPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img class="{SexStr}" id="OPRSEX_SEX_{KeyOne}" alt="{SexStr}" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRPTMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRPTWORKLIST_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"手術狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.GridUtility.OprStatusSelectTemplate(values.OpStatus,values.KeyOne, "OPROPSTATUSSETTING_SELECT")]}&nbsp&nbsp&nbsp&nbsp</span><img id="OPROPSTATUSSETTING_IMG_{KeyOne}" class="{[this.imgPath(values.OpStatus)]}" height="25" width="25"">',{imgPath:function(e){if(!String.IsNull(e)&&(e>=0&&e<=6)){return"redCheckIcon25"}else{return"saveIcon25"}}}),flex:1,width:200,hidden:false,editable:false,sortable:false},{text:"來源",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{KindName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:OPR_CONST.RoomName,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{RoomName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:OPR_CONST.FirstKnf,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{FirstKnf}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"手術時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{OpTime}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DrName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"追蹤狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.careTag(values.CareFlag)]}",{careTag:function(e,f){if(!String.IsNull(e)&&"Y"==e){return' <a id="OPRPTCAREINFO_IPLFINISHED_"'+f+' class="link-btn" style="font-size: 14px"; >結案點我</a>'}else{if(!String.IsNull(e)&&"Y"!=e&&"N"!=e){return' <a id="OPRPTCAREINFO_IPLFINISHED_"'+f+' class="link-btn" style="font-size: 14px"; >'+NisTRApp.view.TRUtility.BirthdayFormat(e)+"</a>"}else{if(String.IsNull(e)||"N"==e){return' <a id="OPRPTCAREINFO_IPLFINISHED_"'+f+' class="link-btn" style="font-size: 14px"; >未追蹤</a>'}}}}}),width:100,hidden:false,sortable:false,flex:1},{text:"*術前診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAG_SPAN",values.BefDiag_1, "14px", 12, values.StyleColor, "OPRPTBEFDIAG_IMG","handPoint.png","25","25" )]}'),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"術前診斷1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAGNAME_SPAN",values.BefDiagName1, "14px", 14, values.StyleColor, "OPRPTBEFDIAGNAME_IMG","handPoint.png","25","25" )]}'),width:140,hidden:false,sortable:false,flex:1},{text:"*預定術式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<div id="OPRPTBEFOPR_DIV_{KeyOne}; width:98%;height:98%; margin: 1px 1px 1px 1px;">{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPR_SPAN",values.BefOper_1, "14px", 16, values.StyleColor, "OPRPTBEFOPR_IMG","handPoint.png","25","25" )]}</div>'),flex:1,width:140,hidden:false,editable:false,sortable:false},{text:"預定主術1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME_SPAN",values.BefOperName1, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1},{text:"預定主術2",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME2_SPAN",values.BefOperName2, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1},{text:"麻醉方式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTANESTIC_SPAN",values.Anestic, "14px", 12, values.StyleColor, "OPRPTANESTIC_IMG","handPoint.png","25","25" )]}'),width:120,hidden:false,sortable:false,flex:1},{text:REG_CONST.Search,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="OPRPTSEARCH_SEARCH_{KeyOne}" class="search" alt="Smiley face" height="50" width="50">',width:60,sortable:false,hidden:false,flex:1},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"EKG",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <span id="OPRLABECG_ECG_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabECG)]}</span>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"XR",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <span id="OPRLABXR_XR_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabXR)]}</span>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<img id="OPRPTCATH_CATH_{KeyOne}" class="{[this.imgPath(values.HasPortA)]}" alt="Smiley face" height="45" width="45">',{imgPath:function(e){if(String.IsNull(e)){return"empty"}else{return"pipe"}}}),flex:1,width:50,hidden:false,editable:false,sortable:false},{text:"手術時間*",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<div id="OPROPTIMECLEAR_IMG_{KeyOne}" class="{[this.cancelImgpath(values.OpTime)]}"></div> <div style="display:inline"><span style="color:{StyleColor}; font-size: 14px">&nbsp;&nbsp;<input type="time" id="OPROPTIMESETTING_INPUT_{KeyOne}" name="OPROPTIME_INPUT_{KeyOne}" style="width:110px;color:black;" id="OpTime" value="{OpTimeFormat}">&nbsp;&nbsp;&nbsp;&nbsp</span></div><div id="OPROPTIMESETTING_IMG_{KeyOne}" class="{[this.imgPath(values.OpTime)]}"></div>',{imgPath:function(e){if(!String.IsNull(e)){return"redCheckIcon25"}else{return"saveIcon25"}},cancelImgpath:function(e){if(!String.IsNull(e)){return"buttonCancel"}else{return"empty"}}}),flex:1,width:230,hidden:true,editable:false,sortable:false},{text:"抗生素作業",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:100,tpl:'<img class="capsule" id="OPENOPR009M_OPR009M_{KeyOne}" alt="抗生素作業" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false}]})},GenOPRMyPatientGrid:function(a,b,d,e){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"},{type:"gridcolumnresizing"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="OPRSEX_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false,dataIndex:"Sex"},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRPTMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:true,dataIndex:"ChartNO"},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRPTWORKLIST_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:true},{text:"手術日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OprmDate)]}</span>',flex:1,width:100,hidden:false,editable:false,sortable:true,dataIndex:"OprmDate"},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:true,dataIndex:"Birthday"},{text:"來源",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{KindName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false,dataIndex:"KindName"},{text:OPR_CONST.RoomName,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{RoomName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false,dataIndex:"RoomName"},{text:OPR_CONST.FirstKnf,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{FirstKnf}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false,dataIndex:"FirstKnf"},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{DrName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false,dataIndex:"DrName"},{text:"追蹤狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.careTag(values.CareFlag)]}",{careTag:function(f,g){if(!String.IsNull(f)&&"Y"==f){return' <a id="OPRPTCAREINFO_MPLFINISHED_"'+g+' class="link-btn" style="font-size: 14px"; >結案點我</a>'}else{if(!String.IsNull(f)&&"Y"!=f&&"N"!=f){return' <a id="OPRPTCAREINFO_MPLFINISHED_"'+g+' class="link-btn" style="font-size: 14px"; >'+NisTRApp.view.TRUtility.BirthdayFormat(f)+"</a>"}else{if(String.IsNull(f)||"N"==f){return' <a id="OPRPTCAREINFO_MPLCAREFLAG_"'+g+' class="link-btn" style="font-size: 14px"; >未追蹤</a>'}}}}}),width:100,hidden:false,sortable:false,flex:1},{text:"*術前診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAG_SPAN",values.BefDiag_1, "14px", 12, values.CareStyleColor, "OPRPTBEFDIAG_IMG","handPoint.png","25","25" )]}'),flex:1,width:120,hidden:false,editable:false,sortable:false,dataIndex:"BefDiag_1"},{text:"術前診斷1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAGNAME_SPAN",values.BefDiagName1, "14px", 14, values.CareStyleColor, "OPRPTBEFDIAGNAME_IMG","handPoint.png","25","25" )]}'),width:140,hidden:false,sortable:false,flex:1,dataIndex:"BefDiagName1"},{text:"*預定術式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<div id="OPRPTBEFOPR_DIV_{KeyOne}; width:98%;height:98%; margin: 1px 1px 1px 1px;">{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPR_SPAN",values.BefOper_1, "14px", 16, values.CareStyleColor, "OPRPTBEFOPR_IMG","handPoint.png","25","25" )]}</div>'),flex:1,width:140,hidden:false,editable:false,sortable:false,dataIndex:"BefOper_1"},{text:"預定主術1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME_SPAN",values.BefOperName1, "14px", 16, values.CareStyleColor, "OPRPTBEFOPRNAME_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1,dataIndex:"BefOperName1"},{text:"預定主術2",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME2_SPAN",values.BefOperName2, "14px", 16, values.CareStyleColor, "OPRPTBEFOPRNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1,dataIndex:"BefOperName2"},{text:"手術狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{OpStatusName}</span>',flex:1,width:150,hidden:false,editable:false,sortable:false,dataIndex:"OpStatusName"},{text:"麻醉方式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTANESTIC_SPAN",values.Anestic, "14px", 12, values.CareStyleColor, "OPRPTANESTIC_IMG","handPoint.png","25","25" )]}'),width:120,hidden:false,sortable:false,flex:1,dataIndex:"Anestic"},{text:REG_CONST.Search,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="OPRPTSEARCH_SEARCH_{KeyOne}" src="'+SYS_CONST.ImgRoot+'search.png" alt="Smiley face" height="50" width="50">',width:60,sortable:false,hidden:false,flex:1},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"EKG",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <span id="OPRLABECG_ECG_{KeyOne}" style="color:{CareStyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabECG)]}</span>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"XR",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <span id="OPRLABXR_XR_{KeyOne}" style="color:{CareStyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabXR)]}</span>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="OPRPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:false,editable:false,sortable:false},{text:REG_CONST.Setting,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="OPRPTST_SETTING_{KeyOne}" src="'+SYS_CONST.ImgRoot+'buttonSetting.png" alt="Smiley face" height="50" width="50">',width:60,hidden:true,sortable:false,flex:1},{text:"抗生素作業",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:100,tpl:'<img id="OPENOPR009M_MYPATG_{KeyOne}" src="'+SYS_CONST.ImgRoot+'capsule.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false}]})},ItemSingleTapOPRGrid:function(q,h,l,d,m,n){var o=function j(v,u){var e=NisTRApp.view.SysUtility.InnerWidth()<=940?480:NisTRApp.view.SysUtility.ClcWidth(95);var x=NisTRApp.view.SysUtility.InnerHeight()<=640?320:NisTRApp.view.SysUtility.ClcHeight(90);if(!Ext.isEmpty(Ext.getCmp("_opr009mPanel"))){Ext.getCmp("_opr009mPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opr009mPanel"))){var w=Ext.create("NisTRApp.view.OPR_OPR009M",{id:"_opr009mPanel",modal:true,centered:true,record:v,hideOnMaskTap:false,height:x,width:e,caller:u,});u.overlay=Ext.Viewport.add(w);u.overlay.show();w=null;delete OPRCareInfoPanel}u=null;delete u;v=null;delete v;e=null;delete e;x=null;delete x};var j=function j(v,u){var e=520;var x=NisTRApp.view.SysUtility.InnerHeight()<=640?320:NisTRApp.view.SysUtility.ClcHeight(65);if(!Ext.isEmpty(Ext.getCmp("_oprCareInfoPanel"))){Ext.getCmp("_oprCareInfoPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_oprCareInfoPanel"))){var w=Ext.create("NisTRApp.view.OPR_CareInfoPanel",{id:"_oprCareInfoPanel",modal:true,centered:true,record:v,hideOnMaskTap:false,height:x,width:e,caller:u,hiddenHeadBar:false});u.overlay=Ext.Viewport.add(w);u.overlay.show();w=null;delete w}u=null;delete u;v=null;delete v;e=null;delete e;x=null;delete x};var k=function k(w,u,v){if(!Ext.isEmpty(Ext.getCmp("_commonPanel"))){Ext.getCmp("_commonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_commonPanel"))){var e=Ext.create("NisTRApp.view.CommonPanel",{id:"_commonPanel",modal:true,centered:true,record:w,hideOnMaskTap:false,height:"90%",width:"98%",caller:u,defaultPage:v});e.showBy(Ext.Viewport,"cc-cc");e=null;delete e}u=null;delete u;w=null;delete w;wi=null;delete wi;he=null;delete he};var p=function p(u,e){Ext.Msg.confirm("Confirm","是否確認追蹤結案? 病人:"+u.data.PatName,function(w,x,v){if(w=="no"){return}else{if(w=="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OprCareFinished.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OprmstID:u.data.OprmstID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(y){var z=Ext.decode(y.responseText);NisTRApp.view.Misc.Alert(z.Message,(z.Success?800:0));if(!Ext.isEmpty(e)&&z.Success){e.getStore().load()}z=null;delete z;e=null;delete e;u=null;delete u},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);e=null;delete e;u=null;delete u}})}}},this)};var g=function g(u,v,e){var w={};w.ChartNo=u.data.ChartNo;w.TEAM=v;NisApp.view.NisPDFUtil.createProfileContent(null,"311",w);w=null;delete w};var b=function b(x,A,w){var u=A.split("_");var v=u[0]+"_INPUT_"+x.data.KeyOne;var e=document.getElementById(v);var z="";var y=false;if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.value)&&(e.value!=e.defaultValue)){z=e.value.replace(":","");y=true}else{if(String.IsNull(e.value)&&(e.value!=e.defaultValue)){z="";y=true}}if(y){NisTRApp.view.TRUtility.confirm("Confirm","存檔? 病人:"+x.data.PatName+"</br> 手術時間:"+e.value,function(B){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OpTimeUpdate.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OprmstID:x.data.OprmstID,UserID:NisTRApp.view.SysUtility.GetUserID(),OpTime:z},success:function(C){var D=Ext.decode(C.responseText);NisTRApp.view.Misc.Alert(D.Message,(D.Success?800:0));if(!Ext.isEmpty(w)&&D.Success){w.getStore().load()}D=null;delete D;w=null;delete w;x=null;delete x;z=null;delete z},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);w=null;delete w;x=null;delete x;z=null;delete z}})},null,this)}u=null;delete u;v=null;delete v;e=null;delete e;y=null;delete y};var a=function b(y,z,x){var v=z.split("_");var w=v[0]+"_SELECT_"+y.data.KeyOne;var u=document.getElementById(w);var e=u.value;if(!Ext.isEmpty(u)&&!Ext.isEmpty(u.value)){NisTRApp.view.TRUtility.confirm("Confirm","存檔? 病人:"+y.data.PatName+"</br> 手術狀態:"+$(u[u.value]).text(),function(A){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OpStatusUpdate.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OprmstID:y.data.OprmstID,UserID:NisTRApp.view.SysUtility.GetUserID(),OpStatus:e},success:function(B){var C=Ext.decode(B.responseText);NisTRApp.view.Misc.Alert(C.Message,(C.Success?800:0));if(!Ext.isEmpty(x)&&C.Success){x.getStore().load()}C=null;delete C;x=null;delete x;y=null;delete y;e=null;delete e},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);x=null;delete x;y=null;delete y;e=null;delete e}})},null,x)}v=null;delete v;w=null;delete w;u=null;delete u};var r=function r(x,y,w){var u=y.split("_");var v="OPROPTIMESETTING_INPUT_"+x.data.KeyOne;var e=document.getElementById(v);NisTRApp.view.TRUtility.confirm("Confirm","清除手術時間? 病人:"+x.data.PatName,function(z){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OpTimeUpdate.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OprmstID:x.data.OprmstID,UserID:NisTRApp.view.SysUtility.GetUserID(),OpTime:""},success:function(A){var B=Ext.decode(A.responseText);NisTRApp.view.Misc.Alert(B.Message,(B.Success?800:0));if(!Ext.isEmpty(w)&&B.Success){w.getStore().load()}B=null;delete B;w=null;delete w;x=null;delete x;optime=null;delete optime},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);w=null;delete w;x=null;delete x;optime=null;delete optime}})},null,this);u=null;delete u;v=null;delete v;e=null;delete e};var f=function f(u,e){NisTRApp.view.TRUtility.confirm("Confirm","取消追蹤?",function(v){e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/ModifyMyPatient.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprmstID:u.data.OprmstID,ChartNo:u.data.ChartNO,Flag:"DEL"},success:function(w){e.setMasked(false);var x=Ext.decode(w.responseText);NisTRApp.view.Misc.Alert(x.Message,(x.Success?800:0));if(!Ext.isEmpty(e)&&x.Success){e.getStore().load()}x=null;delete x;q=null;delete q},failure:function(){e.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);q=null;delete q}})},null,e)};var q=this;var s=m.event.target.id.split("_");if(null==s||s.length<=0){m.preventDefault();return false}if(m.event.target.nodeName=="IMG"||m.event.target.nodeName=="SPAN"||m.event.target.nodeName=="A"||m.event.target.nodeName=="DIV"){switch(s[0]){case"OPRPTBEFOPR":NisTRApp.view.Misc.MsgShow(d.data.BefOper_1,"",2500);break;case"OPRPTBEFDIAG":NisTRApp.view.Misc.MsgShow(d.data.BefDiag_1,"",2500);break;case"OPRPTBEFDIAGNAME":NisTRApp.view.Misc.MsgShow(d.data.BefDiagName1,"",2500);break;case"OPRPTBEFOPRNAME":NisTRApp.view.Misc.MsgShow(d.data.BefOperName1,"",2500);break;case"OPRPTBEFOPRNAME2":NisTRApp.view.Misc.MsgShow(d.data.BefOperName2,"",2500);break;case"OPRPTANESTIC":NisTRApp.view.Misc.MsgShow(d.data.Anestic,"",2500);break;case"OPRPTSEARCH":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.Profile,this);break;case"OPRPTCATH":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.Cath,this);break;case"OPRPTMED":k(d,q,"MED");break;case"OPRPTWORKLIST":k(d,q,"WORKLIST");break;case"OPRPTMAIN":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.NurPrepare,this);break;case"OPRVITAL":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.VitalSigns,this);break;case"OPRMANAGEMENT":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.Management,this);break;case"OPRPTCAREINFO":j(d,q);break;case"OPRLABC":NisTRApp.view.GridUtility.OpenLabOutLink(d.data.ChartNO,"C");break;case"OPRLABH":NisTRApp.view.GridUtility.OpenLabOutLink(d.data.ChartNO,"H");break;case"OPRFINISHED":p(d,q);break;case"OPROPTIMESETTING":b(d,m.event.target.id,q);break;case"OPROPTIMECLEAR":r(d,m.event.target.id,q);break;case"OPROPSTATUSSETTING":a(d,m.event.target.id,q);break;case"OPRSEX":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.Management,this);break;case"OPRDELMYPATIENT":f(d,q);break;case"OPENOPR009M":o(d,q);break;default:break}m.preventDefault()}else{if(m.event.target.nodeName=="INPUT"){}}s=null;delete s;q=null;delete q;j=null;delete j;p=null;delete p;g=null;delete g;k=null;delete k;o=null;delete o;b=null;delete b;a=null;delete a;r=null;delete r;f=null;delete f;return false},GenRISPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="TEST_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="RISMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="RISPTWORKLIST_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"來源",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{PatSourceName.Description}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"床號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{NowBedNo}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"檢查名稱",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{ExamEName}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false},{text:"需留觀",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.ObservedTag(values.ObservedFlag, values.KeyOne)]}",{ObservedTag:function(e,f){if(!String.IsNull(e)&&e=="Y"){return' <img id="RISOBSERVEDCHECK_OBSERVEDDATE_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="RISOBSERVEDCHECK_OBSERVEDDATE_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}}}),width:80,hidden:false,sortable:false,flex:1},{text:"去向",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.GridUtility.RISClosedSelectTemplate(values.ClosedReason,values.KeyOne, "RISCLOSEDSETTING_SELECT", values.ReqNO, values.ItemNO, values.PatName, "'+a+'")]}&nbsp&nbsp&nbsp&nbsp</span>',{imgPath:function(e){if(!String.IsNull(e)){return"../_/img/red-check-icon.png"}else{return"../_/img/save01.png"}}}),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="RISLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="RISLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"排程日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",itemId:"RisPreExamDate",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.PreExamDate)]}</span>',flex:1,width:100,hidden:true,editable:false,sortable:false},{text:"排程時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{PreExamTime}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"麻醉",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{AnestFlag}</span>',flex:1,width:60,hidden:false,editable:false,sortable:false},{text:"檢查醫師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{RealExamDrUserName}</span>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"取消",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CancelColor}; font-size: 14px">{CancelFlagName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"手工單號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{ManualNO}</span>',flex:1,width:150,hidden:true,editable:false,sortable:false},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{ExamStatusName}</span>',flex:1,width:150,hidden:true,editable:false,sortable:false},{text:REG_CONST.Search,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="RISPTSEARCH_SEARCH_{KeyOne}" src="'+SYS_CONST.ImgRoot+'search.png" alt="Smiley face" height="50" width="50">',width:60,sortable:false,hidden:true,flex:1},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="RISPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:true,editable:false,sortable:false},{text:"報告櫃檯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{PreExamRoomName}</span>',flex:1,width:150,hidden:true,editable:false,sortable:false},{text:"檢查室",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{PreExamQueue}</span>',flex:1,width:110,hidden:true,editable:false,sortable:false}]})},ItemSingleTapRISGrid:function(l,g,h,b,j,k){var d=function d(e,o,n){if(String.IsNull(e.data.ObservedFlag)||e.data.ObservedFlag=="N"){Ext.Msg.confirm("Confirm","留觀? 病人:"+e.data.PatName,function(q,r,p){if(q=="no"){return}else{if(q=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/UpdateObservedFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:n,params:{ReqNO:e.data.ReqNO,ItemNO:e.data.ItemNO,UserID:NisTRApp.view.SysUtility.GetUserID(),ObservedFlag:"Y"},success:function(s){Ext.Viewport.setMasked(false);var u=Ext.decode(s.responseText);NisTRApp.view.Misc.Alert(u.Message,(u.Success?800:0));if(!Ext.isEmpty(n)&&u.Success){n.getStore().load()}u=null;delete u;n=null;delete n;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);n=null;delete n;e=null;delete e}})}}},n)}else{Ext.Msg.confirm("Confirm","取消留觀? 病人:"+e.data.PatName,function(q,r,p){if(q=="no"){return}else{if(q=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/UpdateObservedFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:n,params:{ReqNO:e.data.ReqNO,ItemNO:e.data.ItemNO,UserID:NisTRApp.view.SysUtility.GetUserID(),ObservedFlag:"N"},success:function(s){Ext.Viewport.setMasked(false);var u=Ext.decode(s.responseText);NisTRApp.view.Misc.Alert(u.Message,(u.Success?800:0));if(!Ext.isEmpty(n)&&u.Success){n.getStore().load()}u=null;delete u;n=null;delete n;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);n=null;delete n;e=null;delete e}})}}},n)}return};var a=function a(p,s,r){var o=s.split("_");var q=o[0]+"_SELECT_"+p.data.KeyOne;var n=document.getElementById(q);var e=n.value;if(!Ext.isEmpty(e)){Ext.Msg.confirm("Confirm","存檔? 病人:"+p.data.PatName+"</br> 結案狀態:"+(e=="99"?"取消結案":e),function(v,w,u){if(v=="no"){return}else{if(v=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/UpdateClosedStatus.ashx",useDefaultXhrHeader:false,method:"POST",scope:r,params:{ReqNO:p.data.ReqNO,ItemNO:p.data.ItemNO,ClosedReason:e,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(x){Ext.Viewport.setMasked(false);var y=Ext.decode(x.responseText);NisTRApp.view.Misc.Alert(y.Message,(y.Success?800:0));if(!Ext.isEmpty(r)&&y.Success){r.getStore().load()}y=null;delete y;r=null;delete r;p=null;delete p;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);r=null;delete r;p=null;delete p;e=null;delete e}})}}},r)}o=null;delete o;q=null;delete q;n=null;delete n};var f=function f(n,e){NisTRApp.view.TRUtility.confirm("Confirm","取消追蹤?",function(o){e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/ModifyMyPatient.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),ReqNO:n.data.ReqNO,ItemNO:n.data.ItemNO,ChartNo:n.data.ChartNO,Flag:"DEL"},success:function(p){e.setMasked(false);var q=Ext.decode(p.responseText);NisTRApp.view.Misc.Alert(q.Message,(q.Success?800:0));if(!Ext.isEmpty(e)&&q.Success){e.getStore().load()}q=null;delete q;l=null;delete l},failure:function(){e.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);l=null;delete l}})},null,e)};var l=this;var m=j.event.target.id.split("_");if(null==m||m.length<=0){j.preventDefault();return false}if(j.event.target.nodeName=="IMG"||j.event.target.nodeName=="SPAN"||j.event.target.nodeName=="A"){switch(m[0]){case"TEST":NisTRApp.view.TRUtility.OpenMainUI(b,SYS_CONST.PageDef.Management,this);break;case"RISMED":NisTRApp.view.TRUtility.OpenCommonInfoPanel(b,l,"MED");break;case"RISOBSERVEDCHECK":d(b,j.event.target.id,l);break;case"RISCLOSEDSETTING":a(b,j.event.target.id,l);break;case"RISLABH":NisTRApp.view.GridUtility.OpenLabOutLink(b.data.ChartNO,"H");break;case"RISLABC":NisTRApp.view.GridUtility.OpenLabOutLink(b.data.ChartNO,"C");break;case"RISPTCATH":NisTRApp.view.TRUtility.OpenMainUI(b,SYS_CONST.PageDef.Cath,this);break;case"RISPTSEARCH":NisTRApp.view.TRUtility.OpenMainUI(b,SYS_CONST.PageDef.Profile,this);break;case"RISPTWORKLIST":NisTRApp.view.TRUtility.OpenCommonInfoPanel(b,l,"WORKLIST");break;case"RISDELMYPATIENT":f(b,l);break;default:break}j.preventDefault()}else{if(j.event.target.nodeName=="INPUT"){}}m=null;delete m;l=null;delete l;d=null;delete d;a=null;delete a;f=null;delete f;return false},GenENDOInPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="TEST_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDOPTMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDOPTWORKLIST_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="WEBEMR_BIRTHDAY_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"床號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{BedNO}</span>',flex:1,width:60,hidden:false,editable:false,sortable:false},{text:"排程時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormatRegTime(values.SchedTime)]}</span>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"報到時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormatRegTime(values.AccTime)]}</span>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"檢查項目一",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"ENDOITMNAME1_SPAN",values.ItmName1, "14px", 18, values.StyleColor, "ENDOITMNAME1_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,},{text:"檢查項目二",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"ENDOITMNAME2_SPAN",values.ItmName2, "14px", 18, values.StyleColor, "ENDOITMNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,},{text:"檢查項目三",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"ENDOITMNAME3_SPAN",values.ItmName3, "14px", 18, values.StyleColor, "ENDOITMNAME3_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,},{text:"檢查醫師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{SchdUserName}</span>',width:100,hidden:false,editable:false,sortable:false},{text:"已完成",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<img id="WKFINISHED_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath(values.WkFinishedDate)]}" alt="Smiley face" height="50" width="50">',{ImgPath:function(e){if(!Ext.isEmpty(e)){return"FrmFinish.png"}else{return"FrmAdd.png"}}}),width:70,hidden:false,sortable:false},{text:"追蹤狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.careTag(values.CareFlag)]}",{careTag:function(e,f){if(!String.IsNull(e)&&"Y"==e){return' <a id="PTCONTACT_IPLFINISHED_"'+f+' class="link-btn" style="font-size: 14px"; >結案點我</a>'}else{if(!String.IsNull(e)&&"Y"!=e&&"N"!=e){return' <a id="PTCONTACT_IPLFINISHED_"'+f+' class="link-btn" style="font-size: 14px"; >'+NisTRApp.view.TRUtility.BirthdayFormat(e)+"</a>"}else{if(String.IsNull(e)||"N"==e){return' <a id="PTCONTACT_IPLFINISHED_"'+f+' class="link-btn" style="font-size: 14px"; >未追蹤</a>'}}}}}),width:100,hidden:false,sortable:false,flex:1},{text:"需留觀",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.ObservedTag(values.NeedObservedFlag, values.KeyOne)]}",{ObservedTag:function(e,f){if(!String.IsNull(e)&&e=="Y"){return' <img id="ENDOOBSERVEDCHECK_OBSERVEDDATE_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="ENDOOBSERVEDCHECK_OBSERVEDDATE_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}}}),width:80,hidden:false,sortable:false,flex:1},{text:"留觀床位",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.GridUtility.ENDOObservedRoomSelectTemplate(values.ExamFloor,values.KeyOne, "ENDOOBROOMSETTING_SELECT", values.GroupID, values.PatName, "'+a+'", values.ObservedFloor, values.ObservedRoom)]}&nbsp&nbsp&nbsp&nbsp</span>'),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"癌篩",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.ObservedTag(values.CaFlag, values.KeyOne)]}",{ObservedTag:function(e,f){if(!String.IsNull(e)&&e=="Y"){return' <img id="ENDOCACHECK_CAFLAG_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="ENDOCACHECK_CAFLAG_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}}}),width:80,hidden:false,sortable:false,flex:1},{text:"顯示狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDOPTSTATUS_PTSTATUS_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ExamStatusName}</a>',width:140,hidden:false,editable:false,sortable:false},{text:"去向",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.GridUtility.ENDOLeaveSelectTemplate(values.LeaveReason,values.KeyOne, "ENDOLEAVESETTING_SELECT", values.GroupID, values.PatName, "'+a+'")]}&nbsp&nbsp&nbsp&nbsp</span>'),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"麻醉 N/Y",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{[this.anColor(values.AnFlag)]}; font-size: 14px">{AnFlag}</span>',{anColor:function(e){if(!String.IsNull(e)&&e=="Y"){return"red"}else{return"black"}}}),width:100,hidden:false,editable:false,sortable:false},{text:"病人來源",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{IpWaynm}</span>',width:100,hidden:false,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="ENDOPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:true,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDOLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDOLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false}]})},ItemSingleTapENDOGrid:function(m,h,j,d,k,l){var f=function f(e,p,o){if(String.IsNull(e.data.NeedObservedFlag)||e.data.NeedObservedFlag=="N"){Ext.Msg.confirm("Confirm","留觀? 病人:"+e.data.PatName,function(r,s,q){if(r=="no"){return}else{if(r=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateNeedObservedFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:o,params:{GroupID:e.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),NeedObservedFlag:"Y"},success:function(u){Ext.Viewport.setMasked(false);var v=Ext.decode(u.responseText);NisTRApp.view.Misc.Alert(v.Message,(v.Success?800:0));if(!Ext.isEmpty(o)&&v.Success){o.getStore().load()}v=null;delete v;o=null;delete o;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);o=null;delete o;e=null;delete e}})}}},o)}else{Ext.Msg.confirm("Confirm","取消留觀? 病人:"+e.data.PatName,function(r,s,q){if(r=="no"){return}else{if(r=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateNeedObservedFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:o,params:{GroupID:e.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),NeedObservedFlag:"N"},success:function(u){Ext.Viewport.setMasked(false);var v=Ext.decode(u.responseText);NisTRApp.view.Misc.Alert(v.Message,(v.Success?800:0));if(!Ext.isEmpty(o)&&v.Success){o.getStore().load()}v=null;delete v;o=null;delete o;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);o=null;delete o;e=null;delete e}})}}},o)}return};var a=function a(e,p,o){if(String.IsNull(e.data.CaFlag)||e.data.CaFlag=="N"){Ext.Msg.confirm("Confirm","癌篩? 病人:"+e.data.PatName,function(r,s,q){if(r=="no"){return}else{if(r=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateCAFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:o,params:{GroupID:e.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"Y"},success:function(u){Ext.Viewport.setMasked(false);var v=Ext.decode(u.responseText);NisTRApp.view.Misc.Alert(v.Message,(v.Success?800:0));if(!Ext.isEmpty(o)&&v.Success){o.getStore().load()}v=null;delete v;o=null;delete o;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);o=null;delete o;e=null;delete e}})}}},o)}else{Ext.Msg.confirm("Confirm","取消癌篩? 病人:"+e.data.PatName,function(r,s,q){if(r=="no"){return}else{if(r=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateCAFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:o,params:{GroupID:e.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"N"},success:function(u){Ext.Viewport.setMasked(false);var v=Ext.decode(u.responseText);NisTRApp.view.Misc.Alert(v.Message,(v.Success?800:0));if(!Ext.isEmpty(o)&&v.Success){o.getStore().load()}v=null;delete v;o=null;delete o;e=null;delete e},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);o=null;delete o;e=null;delete e}})}}},o)}return};var g=function g(o,e){NisTRApp.view.TRUtility.confirm("Confirm","取消追蹤?",function(p){e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/ModifyMyPatient.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),GroupID:o.data.GroupID,ChartNo:o.data.ChartNO,Flag:"DEL"},success:function(q){e.setMasked(false);var r=Ext.decode(q.responseText);NisTRApp.view.Misc.Alert(r.Message,(r.Success?800:0));if(!Ext.isEmpty(e)&&r.Success){e.getStore().load()}r=null;delete r;m=null;delete m},failure:function(){e.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);m=null;delete m}})},null,e)};var b=function b(r,p){try{if(!Ext.isEmpty(Ext.getCmp("_endoSchedDetails"))){Ext.getCmp("_endoSchedDetails").destroy()}if(Ext.isEmpty(Ext.getCmp("_endoSchedDetails"))){var o=Ext.create("NisTRApp.view.ENDO.SechdDetails",{id:"_endoSchedDetails",record:r,caller:p});p.overlay=Ext.Viewport.add(o);p.overlay.show();o=null;delete o}}catch(q){console.log(q)}return};var m=this;var n=k.event.target.id.split("_");if(null==n||n.length<=0){k.preventDefault();return false}if(k.event.target.nodeName=="IMG"||k.event.target.nodeName=="SPAN"||k.event.target.nodeName=="A"){switch(n[0]){case"TEST":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.Management,this);break;case"WEBEMR":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),d.data.PatIdno,"ENDO/ENDO001I.asp");break;case"ENDOPTMED":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"MED");break;case"ENDOITMNAME":NisTRApp.view.Misc.MsgShow(d.data.ItmName,"",2500);break;case"ENDOITMNAME1":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"ENDOSCHDEITAL");break;case"ENDOITMNAME2":NisTRApp.view.Misc.MsgShow(d.data.ItmName2,"",2500);break;case"ENDOITMNAME3":NisTRApp.view.Misc.MsgShow(d.data.ItmName3,"",2500);break;case"RISPTWORKLIST":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"WORKLIST");break;case"ENDOPTSTATUS":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"WORKLIST");break;case"ENDOOBSERVEDCHECK":f(d,k.event.target.id,m);break;case"ENDODELMYPATIENT":g(d,m);break;case"ENDOPTWORKLIST":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"WORKLIST");break;case"WKFINISHED":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"WORKLIST");break;case"ENDOLABC":NisTRApp.view.GridUtility.OpenLabOutLink(d.data.ChartNO,"C");break;case"ENDOLABH":NisTRApp.view.GridUtility.OpenLabOutLink(d.data.ChartNO,"H");break;case"ENDOPTCATH":NisTRApp.view.TRUtility.OpenMainUI(d,SYS_CONST.PageDef.Cath,this);break;case"ENDOCACHECK":a(d,k.event.target.id,m);break;case"PTCONTACT":NisTRApp.view.TRUtility.OpenCommonInfoPanel(d,m,"CONTACT");break;default:break}k.preventDefault()}else{if(k.event.target.nodeName=="INPUT"){}}n=null;delete n;m=null;delete m;f=null;delete f;g=null;delete g;a=null;delete a;b=null;delete b;return false},GenENDOHxSheetGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"醫令日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.IpDate)]}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"醫令時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormatRegTime(values.IpTime)]}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"檢查項目",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"ENDOHXITMNAME_SPAN",values.ItmName, "14px", 28, "Blue", "ENDOHXITMNAME_IMG","handPoint.png","25","25" )]}'),width:260,hidden:false,editable:false,sortable:false},{text:"來源",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{IpWaynm}</span>',width:60,hidden:false,editable:false,sortable:false},{text:"科別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{IpDpt}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"醫令群組",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ItmGroup}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"醫令代碼",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ItmNO}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"排程日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{SchdDate}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"排程時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{SchdTime}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"麻醉(預設)",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{AnFlag}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"麻醉(結果)",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{AnFinalFlag}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"麻醉說明",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"ENDOANFINALREASON_SPAN",values.AnFinalReason, "14px", 28, "Blue", "ENDOANFINALREASON_IMG","handPoint.png","25","25" )]}'),flex:1,width:260,hidden:false,editable:false,sortable:false},{text:"檢查醫師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{SchdUserName}</span>',width:90,hidden:true,editable:false,sortable:false},{text:"檢查樓層",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ExamFloor}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"檢查室",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ExamRoom}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"報到日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{AccDate}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"報到時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{AccTime}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"準備日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{PrepareDate}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"準備時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{PrepareTime}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"檢查開始日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ExamstartDate}</span>',width:120,hidden:false,editable:false,sortable:false},{text:"檢查開始時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ExamstartTime}</span>',width:120,hidden:false,editable:false,sortable:false},{text:"檢查結束日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ExamendDate}</span>',width:120,hidden:false,editable:false,sortable:false},{text:"檢查結束時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{ExamendTime}</span>',width:120,hidden:false,editable:false,sortable:false},{text:"恢復日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{RecoverDate}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"恢復時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{RecoverTime}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"離開日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{FinishDate}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"離開時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{FinishTime}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"報告日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{RptDate}</span>',width:90,hidden:false,editable:false,sortable:false},{text:"報告時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{RptTime}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"報告醫師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style=" font-size: 14px">{RptManName}</span>',width:90,hidden:true,editable:false,sortable:false}]})},StrToImg:function(b,g,l,j,k,d,a,s,e,n){var r=l;var m=l.Blength();var p="";var o=k;var h=r.match(/[^\x00-\xff]/ig);if(null!=k&&k>0&&!String.IsNull(l)&&m>k){if(null!=h&&h.length>0){for(var f=0;f<h.length;f++){if(o>(k/2)){o=o-1}else{break}}}r=l.substring(0,o);if(o>4){r=r.charCodeAt(r.length-1)<256?r.substring(0,r.length-2):r.substring(0,r.length-1)}else{r=r.substring(0,r.length)}if(!String.IsNull(s)){p=String.format('<img id="{0}" src="{1}" alt="Smiley face" height="{2}" width="{3}">',String.IsNull(a)?b:(a+"_"+b),String.IsNull(s)?"":SYS_CONST.ImgRoot+s,String.IsNull(e)?"25":e,String.IsNull(n)?"25":n)}}var q=String.format('<span id="{0}" style="{1} {2}">{3}</span>{4}',String.IsNull(g)?b:(g+"_"+b),String.IsNull(d)?"":("color:"+d+";"),String.IsNull(j)?"font-size: 14px;":("font-size:"+j+";"),r,p);r=null;delete r;m=null;delete m;p=null;delete p;o=null;delete o;h=null;delete h;return q},OprStatusSelectTemplate:function(a,e,b){var d='<select id="{8}" name="{9}"><option {0} value="0">病人報到</option><option {1} value="1">等候區準備中</option><option {2} value="2">手術進行中</option><option {3} value="3">恢復室休息中</option><option {4} value="4">返回病房</option><option {5} value="5">送往加護病房</option><option {6} value="6">已離開手術室</option><option {7} value="7">未報到</option></select>';return String.format(d,(!Ext.isEmpty(a)&&(a=="0"))?"selected":"",(!Ext.isEmpty(a)&&(a=="1"))?"selected":"",(!Ext.isEmpty(a)&&(a=="2"))?"selected":"",(!Ext.isEmpty(a)&&(a=="3"))?"selected":"",(!Ext.isEmpty(a)&&(a=="4"))?"selected":"",(!Ext.isEmpty(a)&&(a=="5"))?"selected":"",(!Ext.isEmpty(a)&&(a=="6"))?"selected":"",(Ext.isEmpty(a)||(a>6)||(a<0))?"selected":"",(b+"_"+e),(b+"_"+e))},ZeroToEmpty:function(a){if(Ext.isEmpty(a)||"0"==a||0==a){return""}else{return a}},RISClosedSelectTemplate:function(a,j,f,d,e,g,b){var h='<select  class="risClosedSelectField{12}" id="{5}" name="{6}" reqno="{7}" itemno="{8}" patname="{9}" oldValue="{10}" grid={11} ><option {0} value="留觀">留觀</option><option {1} value="UCU">UCU</option><option {2} value="住院">住院</option><option {3} value="離開檢查室">離開檢查室</option><option {4} value="99">未知</option></select>';return String.format(h,(!Ext.isEmpty(a)&&(a=="留觀"))?"selected":"",(!Ext.isEmpty(a)&&(a=="UCU"))?"selected":"",(!Ext.isEmpty(a)&&(a=="住院"))?"selected":"",(!Ext.isEmpty(a)&&(a=="離開檢查室"))?"selected":"",(Ext.isEmpty(a))?"selected":"",(f+"_"+j),(f+"_"+j),d,e,g,a,b,b)},onChangeRISClosedSelect:function(a){setTimeout(function(){Ext.each(Ext.query(".risClosedSelectField"+a),function(b){Ext.get(b).addListener("focus",function(d){$(d.target).attr("oldValue",$(d.target).val())})});Ext.each(Ext.query(".risClosedSelectField"+a),function(b){Ext.get(b).addListener("change",function(g){var f=$(g.target);var d=f.val();var h=f.attr("grid");Ext.Msg.confirm("Confirm","存檔? 病人:"+f.attr("patname")+"</br> 去向:"+(d=="99"?"取消去向":d),function(j,k,e){if(j=="no"){f.val(f.attr("oldValue"));f=null;delete f;h=null;delete h;d=null;delete d;return}else{if(j=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/UpdateClosedStatus.ashx",useDefaultXhrHeader:false,method:"POST",scope:f,params:{ReqNO:f.attr("reqno"),ItemNO:f.attr("itemno"),ClosedReason:d,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(l){Ext.Viewport.setMasked(false);var m=Ext.decode(l.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(!m.Success){f.val(f.attr("oldValue"))}else{if(!Ext.isEmpty(Ext.getCmp(h))&&m.Success){Ext.getCmp(h).getStore().load()}}m=null;delete m;f=null;delete f;h=null;delete h;d=null;delete d},failure:function(){f.attr("oldValue",f.val());Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f;h=null;delete h;d=null;delete d}})}}},f)})})},300)},OpenLabOutLink:function(d,a){var b={};b.ChartNo=d;b.TEAM=a;NisApp.view.NisPDFUtil.createProfileContent(null,"311",b);b=null;delete b},TimeStrFormat:function(a){},ENDOLeaveSelectTemplate:function(a,h,e,d,f,b){var g='<select  class="endoLeaveSelectField{11}" id="{5}" name="{6}" groupid="{7}" patname="{8}" oldValue="{9}" grid={10} ><option {0} value="ICU">ICU</option><option {1} value="UCU">UCU</option><option {2} value="住院">住院</option><option {3} value="留觀">留觀</option><option {4} value="99">未知</option></select>';return String.format(g,(!Ext.isEmpty(a)&&(a=="ICU"))?"selected":"",(!Ext.isEmpty(a)&&(a=="UCU"))?"selected":"",(!Ext.isEmpty(a)&&(a=="住院"))?"selected":"",(!Ext.isEmpty(a)&&(a=="留觀"))?"selected":"",(Ext.isEmpty(a))?"selected":"",(e+"_"+h),(e+"_"+h),d,f,a,b,b)},onChangeENDOLeaveSelect:function(a){setTimeout(function(){Ext.each(Ext.query(".endoLeaveSelectField"+a),function(b){Ext.get(b).addListener("focus",function(d){$(d.target).attr("oldValue",$(d.target).val())})});Ext.each(Ext.query(".endoLeaveSelectField"+a),function(b){Ext.get(b).addListener("change",function(g){var f=$(g.target);var d=f.val();var h=f.attr("grid");Ext.Msg.confirm("Confirm","存檔? 病人:"+f.attr("patname")+"</br> 去向:"+(d=="99"?"取消去向":d),function(j,k,e){if(j=="no"){f.val(f.attr("oldValue"));f=null;delete f;h=null;delete h;d=null;delete d;return}else{if(j=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateLeaveFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:f,params:{GroupID:f.attr("groupid"),LeaveReason:d,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(l){Ext.Viewport.setMasked(false);var m=Ext.decode(l.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(!m.Success){f.val(f.attr("oldValue"))}else{if(!Ext.isEmpty(Ext.getCmp(h))&&m.Success){Ext.getCmp(h).getStore().load()}}m=null;delete m;f=null;delete f;h=null;delete h;d=null;delete d},failure:function(){f.attr("oldValue",f.val());Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f;h=null;delete h;d=null;delete d}})}}},f)})})},300)},ENDOObservedRoomSelectTemplate:function(e,b,d,f,g,a,k,l){var j="NA-NA";if(!Ext.isEmpty(k)&&!Ext.isEmpty(l)){j=k+"-"+l}if(e=="B1"){var h='<select  class="endoObservedRoomSelectField{17}" id="{11}" name="{12}" groupid="{13}" patname="{14}" oldValue="{15}" grid={16} ><option {0} value="NA-NA">請選擇</option><option {1} value="B1-R1">B1-R1</option><option {2} value="B1-R2">B1-R2</option><option {3} value="B1-R3">B1-R3</option><option {4} value="B1-R4">B1-R4</option><option {5} value="B1-R5">B1-R5</option><option {6} value="B1-R6">B1-R6</option><option {7} value="B1-R7">B1-R7</option><option {8} value="B1-C1">B1-C1</option><option {9} value="B1-C2">B1-C2</option><option {10} value="B1-C3">B1-C3</option></select>';return String.format(h,(!Ext.isEmpty(j)&&(j=="NA-NA"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R1"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R2"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R3"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R4"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R5"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R6"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-R7"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-C1"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-C2"))?"selected":"",(!Ext.isEmpty(j)&&(j=="B1-C3"))?"selected":"",(d+"_"+b),(d+"_"+b),f,g,j,a,a)}else{var h='<select  class="endoObservedRoomSelectField{17}" id="{11}" name="{12}" groupid="{13}" patname="{14}" oldValue="{15}" grid={16} ><option {0} value="NA-NA">請選擇</option><option {1} value="3F-R1">3F-R1</option><option {2} value="3F-R2">3F-R2</option><option {3} value="3F-R3">3F-R3</option><option {4} value="3F-R4">3F-R4</option><option {5} value="3F-R5">3F-R5</option><option {6} value="3F-R6">3F-R6</option><option {7} value="3F-R7">3F-R7</option><option {8} value="3F-R8">3F-R8</option><option {9} value="3F-R9">3F-R9</option><option {10} value="3F-R10">3F-R10</option></select>';return String.format(h,(!Ext.isEmpty(j)&&(j=="NA-NA"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R1"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R2"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R3"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R4"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R5"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R6"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R7"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R8"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R9"))?"selected":"",(!Ext.isEmpty(j)&&(j=="3F-R10"))?"selected":"",(d+"_"+b),(d+"_"+b),f,g,j,a,a)}return},onChangeENDOObsRoomSelect:function(a){setTimeout(function(){Ext.each(Ext.query(".endoObservedRoomSelectField"+a),function(b){Ext.get(b).addListener("focus",function(d){$(d.target).attr("oldValue",$(d.target).val())})});Ext.each(Ext.query(".endoObservedRoomSelectField"+a),function(b){Ext.get(b).addListener("change",function(j){var h=$(j.target);var f=h.val();var g=f.split("-");var l=g[0];var d=g[1];var k=h.attr("grid");Ext.Msg.confirm("Confirm","存檔? 病人:"+h.attr("patname")+"</br>"+(f=="NA-NA"?"取消床位":(" 床位:"+f)),function(m,n,e){if(m=="no"){h.val(h.attr("oldValue"));h=null;delete h;k=null;delete k;f=null;delete f;return}else{if(m=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateObservedInfo.ashx",useDefaultXhrHeader:false,method:"POST",scope:h,params:{GroupID:h.attr("groupid"),UserID:NisTRApp.view.SysUtility.GetUserID(),ObFloor:l,ObRoom:d},success:function(o){Ext.Viewport.setMasked(false);var p=Ext.decode(o.responseText);NisTRApp.view.Misc.Alert(p.Message,(p.Success?800:0));if(!p.Success){h.val(h.attr("oldValue"))}else{if(!Ext.isEmpty(Ext.getCmp(k))&&p.Success){Ext.getCmp(k).getStore().load()}}p=null;delete p;h=null;delete h;k=null;delete k;f=null;delete f;g=null;delete g;l=null;delete l;d=null;delete d},failure:function(){h.attr("oldValue",h.val());Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);h=null;delete h;k=null;delete k;f=null;delete f;g=null;delete g;l=null;delete l;d=null;delete d}})}}},h)})})},300)},OpenWebEMR:function(d,b,f){var e="DIS/DIS001I_1.asp";if(!Ext.isEmpty(f)){e=f}var a="http://go.kfcc.intra/"+e+"?LOG_USER_ID="+d+"&PAT_IDNO="+b;NisTRApp.view.Misc.OpenOutSite(a);a=null;delete a;e=null;delete e},GenCMSDiscroverPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:"癌別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:180,tpl:'<a id="TOP_CANCERNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{CancerName}</a>',flex:1,hidden:false,editable:false,sortable:false},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMSSTATUS_CMSSTATUS_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{StatusName}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"診斷碼",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:80,tpl:'<span id="CMSCANCER_CANCER_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{IcdhCode}</span>',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="TEST_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSINCASE_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="WEBEMR_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="WEBEMR_BIRTHDAY_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"個管師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.CmsUserName, values.KeyOne)]}",{inCaseTag:function(e,f){if(!String.IsNull(e)){return' <a id="CMSINCASE_CMSUSERNAME_"'+f+' class="link-btn" style="font-size: 14px"; >'+e+"</a>"}}}),width:100,hidden:false,sortable:false,flex:1},{text:"收案日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMS_IN_DATE_CmsInDate_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.InDate)]}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"收案人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.InUserName, values.KeyOne)]}",{inCaseTag:function(e,f){if(!String.IsNull(e)){return' <a id="CMSINCASE_INUSERNAME_"'+f+' class="link-btn" style="font-size: 14px"; >'+e+"</a>"}else{return' <a id="CMSINCASE_INUSERNAME_"'+f+' class="link-btn" style="font-size: 14px"; >未收案</a>'}}}),width:100,hidden:false,sortable:false,flex:1},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="CMSPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:true,editable:false,sortable:false},{text:"尿液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABU_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabU)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"檢驗",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I04_LAB04_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>檢驗</a>',width:60,hidden:false,editable:false,sortable:false},{text:"病理/細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I10_LAB10_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>病理/細胞</a>',width:100,hidden:false,editable:false,sortable:false},{text:"放診",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I02_LAB02_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>放診</a>',width:60,hidden:false,editable:false,sortable:false},{text:"核醫",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="NEU001I01_NEU01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>核醫</a>',width:60,hidden:false,editable:false,sortable:false},{text:"幹細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I20_LAB20_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>幹細胞</a>',width:70,hidden:false,editable:false,sortable:false},{text:"肺功能",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I17_LAB17_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>肺功能</a>',width:70,hidden:false,editable:false,sortable:false},{text:"心超",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="UCG001I01_UCG01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心超</a>',width:60,hidden:false,editable:false,sortable:false},{text:"心電圖",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006IECG_ECG_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心電圖</a>',width:70,hidden:false,editable:false,sortable:false},{text:"內視鏡",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDO001I_ENDO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>內視鏡</a>',width:70,hidden:false,editable:false,sortable:false}]})},ItemSingleTapCMSDiscoverGrid:function(g,b,j,a,h,d){var g=this;var f=h.event.target.id.split("_");if(null==f||f.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"){switch(f[0]){case"TEST":NisTRApp.view.TRUtility.OpenMainUI(a,SYS_CONST.PageDef.VitalSigns,this);break;case"WEBEMR":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"ENDO/ENDO001I.asp");break;case"CMSPTMED":NisTRApp.view.TRUtility.OpenCommonInfoPanel(a,g,"MED");break;case"CMSLABU":NisTRApp.view.GridUtility.OpenLabOutLink(a.data.ChartNO,"U");break;case"CMSLABC":NisTRApp.view.GridUtility.OpenLabOutLink(a.data.ChartNO,"C");break;case"CMSLABH":NisTRApp.view.GridUtility.OpenLabOutLink(a.data.ChartNO,"H");break;case"CMSPTCATH":NisTRApp.view.TRUtility.OpenMainUI(a,SYS_CONST.PageDef.Cath,this);break;case"CMSINCASE":NisTRApp.view.CMS.CommonPanel.Create(a,g);break;case"TOP":NisTRApp.view.GridUtility.OpenTop(NisTRApp.view.SysUtility.GetUserID(),a.data.ChartNO,"profile");break;case"LAB006I04":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/LAB006I_4.asp");break;case"LAB006I10":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/LAB006I_10.asp");break;case"LAB006I02":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/LAB006I_2.asp");break;case"NEU001I01":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"NEU/NEU001I_1.asp");break;case"LAB006I20":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/LAB006I_20.asp");break;case"LAB006I17":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/LAB006I_17.asp");break;case"UCG001I01":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/UCG001I_1.asp");break;case"LAB006IECG":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"LAB/LAB006I_ECG.asp");break;case"ENDO001I":NisTRApp.view.GridUtility.OpenWebEMR(NisTRApp.view.SysUtility.GetUserID(),a.data.PatIdno,"ENDO/ENDO001I.asp");break;case"CMRECUR":NisTRApp.view.GridUtility.OpenCM("CMRECUR",NisTRApp.view.SysUtility.GetUserID(),a.data.ChartNO,"06",a.data.CmsID,"4");break;case"CMCONFIRM":NisTRApp.view.GridUtility.OpenCM("CMCONFIRM",NisTRApp.view.SysUtility.GetUserID(),a.data.ChartNO,"06",a.data.CmsID,"4");break;default:break}h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}f=null;delete f;g=null;delete g;_OpenCmsDatmPanel=null;delete _OpenCmsDatmPanel;return false},GenCMSInPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:"癌別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:180,tpl:'<a id="TOP_CANCER_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{CancerName}</a>',flex:1,hidden:false,editable:false,sortable:false},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMSSTATUS_CMSSTATUS_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{StatusName}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="TEST_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSINCASE_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="WEBEMR_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="WEBEMR_BIRTHDAY_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"個管師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.CmsUserName, values.KeyOne)]}",{inCaseTag:function(e,f){if(!String.IsNull(e)){return' <a id="CMSINCASE_CMSUSERNAME_"'+f+' class="link-btn" style="font-size: 14px"; >'+e+"</a>"}}}),width:100,hidden:false,sortable:false,flex:1},{text:"收案日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMSINDATE_CmsInDate_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.InDate)]}</span>',width:120,hidden:false,editable:false,dataIndex:"InDate",sortable:false},{text:"結案日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMS_Close_DATE_CmsCloseDate_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.CloseDate)]}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false,dataIndex:"CloseDate"},{text:"結案原因",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMSCloseRemark_CmsCloseRemark_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{CloseRemark}</span>',flex:1,width:180,hidden:false,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="CMSPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:true,editable:false,sortable:false},{text:"尿液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABU_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabU)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"檢驗",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I04_LAB04_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>檢驗</a>',width:60,hidden:false,editable:false,sortable:false},{text:"病理/細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I10_LAB10_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>病理/細胞</a>',width:100,hidden:false,editable:false,sortable:false},{text:"放診",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I02_LAB02_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>放診</a>',width:60,hidden:false,editable:false,sortable:false},{text:"核醫",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="NEU001I01_NEU01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>核醫</a>',width:60,hidden:false,editable:false,sortable:false},{text:"幹細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I20_LAB20_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>幹細胞</a>',width:70,hidden:false,editable:false,sortable:false},{text:"肺功能",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I17_LAB17_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>肺功能</a>',width:70,hidden:false,editable:false,sortable:false},{text:"心超",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="UCG001I01_UCG01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心超</a>',width:60,hidden:false,editable:false,sortable:false},{text:"心電圖",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006IECG_ECG_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心電圖</a>',width:70,hidden:false,editable:false,sortable:false},{text:"內視鏡",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDO001I_ENDO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>內視鏡</a>',width:70,hidden:false,editable:false,sortable:false},{text:"領航-新診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CmConfirmFlag(values.CmConfirmFlag, values.KeyOne)]}",{CmConfirmFlag:function(e,f){if(!String.IsNull(e)&&e=="1"){return' <img id="CMCONFIRM_INPAT_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{if(!String.IsNull(e)&&e=="2"){return' <img id="CMCONFIRM_INPAT_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="CMCONFIRM_INPAT_'+f+'" src="'+SYS_CONST.ImgRoot+'Done.png" alt="Smiley face" height="25" width="25">'}}}}),width:70,hidden:false,sortable:false,flex:1},{text:"領航-復發",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CmConfirmFlag(values.CmCMRECURFlag, values.KeyOne)]}",{CmConfirmFlag:function(e,f){if(!String.IsNull(e)&&e=="1"){return' <img id="CMRECUR_INPAT_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{if(!String.IsNull(e)&&e=="2"){return' <img id="CMRECUR_INPAT_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="CMRECUR_INPAT_'+f+'" src="'+SYS_CONST.ImgRoot+'Done.png" alt="Smiley face" height="25" width="25">'}}}}),width:70,hidden:false,sortable:false,flex:1}]})},GenCMSRegPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="TEST_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:"癌別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:180,tpl:'<a id="TOP_REGCANCER_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{CancerName}</a>',flex:1,hidden:false,editable:false,sortable:false},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMSSTATUS_CMSSTATUS_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{StatusName}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"個管師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.CmsUserName, values.KeyOne)]}",{inCaseTag:function(e,f){if(!String.IsNull(e)){return' <a id="CMSINCASE_CMSUSERNAME_"'+f+' class="link-btn" style="font-size: 14px"; >'+e+"</a>"}}}),width:100,hidden:false,sortable:false,flex:1},{text:REG_CONST.DisplayStatus,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<div style="background-color:{BgColor}; width:180px;height:90%; margin: 2px 2px 2px 2px;"><span style="color:{StyleColor}; font-size: 14px; font-weight: bold;">{DispStatus}</span></div>',flex:1,width:180,hidden:false,editable:false,sortable:false},{text:"收案日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMS_IN_DATE_CmsInDate_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.InDate)]}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSINCASE_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="WEBEMR_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="WEBEMR_BIRTHDAY_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.HdeptCode,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{HdeptName} </span>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:REG_CONST.DocNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DocName} </span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"預約",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormatRegTime(values.TimeS)]}</span>',flex:1,width:50,hidden:false,editable:false,sortable:false},{text:"報到",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{[this.ArrColor(values.StyleColor)]}; font-size: 14px">{[NisTRApp.view.DateUtil.FormatRegTime(values.ArrivalTime)]}</span>',{ArrColor:function(e){if(null!=e&&"Silver"==e){return e}else{return"Blue"}}}),flex:1,width:50,hidden:false,editable:false,sortable:false},{text:"到院",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:red; font-size: 14px">{[this.ResetStr(values.RegInPerson)]}</span>',{ResetStr:function(e){if(!String.IsNull(e)&&"Y"==e){return""}else{return e}}}),flex:1,width:50,hidden:false,editable:false,sortable:false},{text:"住院",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[this.ImgPath(values.InpNO)]}</span>',{ImgPath:function(e){if(String.IsNull(e)||"undefined"==e){return""}else{var f=e.split("_");return String.IsNull(f[2])?"":f[2]}}}),width:50,hidden:true,sortable:false,flex:1},{text:"備註",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="CMSPTCATH_PTMEMO_{KeyOne}" class="btn link-btn" style="font-size: 14px"; color:{StyleColor};>{Memo}</a>',flex:1,width:200,hidden:false,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="CMSPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:true,editable:false,sortable:false},{text:"尿液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABU_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabU)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"檢驗",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I04_LAB04_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>檢驗</a>',width:60,hidden:false,editable:false,sortable:false},{text:"病理/細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I10_LAB10_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>病理/細胞</a>',width:100,hidden:false,editable:false,sortable:false},{text:"放診",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I02_LAB02_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>放診</a>',width:60,hidden:false,editable:false,sortable:false},{text:"核醫",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="NEU001I01_NEU01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>核醫</a>',width:60,hidden:false,editable:false,sortable:false},{text:"幹細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I20_LAB20_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>幹細胞</a>',width:70,hidden:false,editable:false,sortable:false},{text:"肺功能",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I17_LAB17_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>肺功能</a>',width:70,hidden:false,editable:false,sortable:false},{text:"心超",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="UCG001I01_UCG01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心超</a>',width:60,hidden:false,editable:false,sortable:false},{text:"心電圖",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006IECG_ECG_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心電圖</a>',width:70,hidden:false,editable:false,sortable:false},{text:"內視鏡",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDO001I_ENDO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>內視鏡</a>',width:70,hidden:false,editable:false,sortable:false},{text:"領航-新診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CmConfirmFlag(values.CmConfirmFlag, values.KeyOne)]}",{CmConfirmFlag:function(e,f){if(!String.IsNull(e)&&e=="1"){return' <img id="CMCONFIRM_REG_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{if(!String.IsNull(e)&&e=="2"){return' <img id="CMCONFIRM_REG_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="CMCONFIRM_REG_'+f+'" src="'+SYS_CONST.ImgRoot+'Done.png" alt="Smiley face" height="25" width="25">'}}}}),width:70,hidden:false,sortable:false,flex:1},{text:"領航-復發",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CmConfirmFlag(values.CmCMRECURFlag, values.KeyOne)]}",{CmConfirmFlag:function(e,f){if(!String.IsNull(e)&&e=="1"){return' <img id="CMRECUR_REG_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{if(!String.IsNull(e)&&e=="2"){return' <img id="CMRECUR_REG_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="CMRECUR_REG_'+f+'" src="'+SYS_CONST.ImgRoot+'Done.png" alt="Smiley face" height="25" width="25">'}}}}),width:70,hidden:false,sortable:false,flex:1}]})},GenCMSIpbPatientGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:"床號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="IPBMGR_BEDNO_{KeyOne}" class="link-btn" style="font-size: 20px; font-weight:bold;"; color:{StyleColor};>{NowStationNo}-{NowBedNo}</a>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="TEST_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:"癌別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:180,tpl:'<a id="TOP_IPBCANCER_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{CancerName}</a>',flex:1,hidden:false,editable:false,sortable:false},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMSSTATUS_CMSSTATUS_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{StatusName}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"個管師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.CmsUserName, values.KeyOne)]}",{inCaseTag:function(e,f){if(!String.IsNull(e)){return' <a id="CMSINCASE_CMSUSERNAME_"'+f+' class="link-btn" style="font-size: 14px"; >'+e+"</a>"}}}),width:100,hidden:false,sortable:false,flex:1},{text:"收案日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="CMS_IN_DATE_CmsInDate_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.InDate)]}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSINCASE_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="WEBEMR_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="WEBEMR_BIRTHDAY_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:REG_CONST.DocNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DocName} </span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"管路",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="CMSPTCATH_CATH_{KeyOne}" src="{HasPortAImgSrc}" alt="Smiley face" height="45" width="45">',flex:1,width:50,hidden:true,editable:false,sortable:false},{text:"尿液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABU_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabU)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"血液",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABH_LABH_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabH)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"生化",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="CMSLABC_LABC_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{[NisTRApp.view.TRUtility.BirthdayFormat(values.LabC)]}</a>',flex:1,width:100,hidden:false,editable:false,sortable:false},{text:"檢驗",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I04_LAB04_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>檢驗</a>',width:60,hidden:false,editable:false,sortable:false},{text:"病理/細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I10_LAB10_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>病理/細胞</a>',width:100,hidden:false,editable:false,sortable:false},{text:"放診",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I02_LAB02_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>放診</a>',width:60,hidden:false,editable:false,sortable:false},{text:"核醫",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="NEU001I01_NEU01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>核醫</a>',width:60,hidden:false,editable:false,sortable:false},{text:"幹細胞",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I20_LAB20_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>幹細胞</a>',width:70,hidden:false,editable:false,sortable:false},{text:"肺功能",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006I17_LAB17_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>肺功能</a>',width:70,hidden:false,editable:false,sortable:false},{text:"心超",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="UCG001I01_UCG01_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心超</a>',width:60,hidden:false,editable:false,sortable:false},{text:"心電圖",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="LAB006IECG_ECG_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>心電圖</a>',width:70,hidden:false,editable:false,sortable:false},{text:"內視鏡",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="ENDO001I_ENDO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>內視鏡</a>',width:70,hidden:false,editable:false,sortable:false},{text:"領航-新診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CmConfirmFlag(values.CmConfirmFlag, values.KeyOne)]}",{CmConfirmFlag:function(e,f){if(!String.IsNull(e)&&e=="1"){return' <img id="CMCONFIRM_IPB_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{if(!String.IsNull(e)&&e=="2"){return' <img id="CMCONFIRM_IPB_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="CMCONFIRM_IPB_'+f+'" src="'+SYS_CONST.ImgRoot+'Done.png" alt="Smiley face" height="25" width="25">'}}}}),width:70,hidden:false,sortable:false,flex:1},{text:"領航-復發",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.CmConfirmFlag(values.CmCMRECURFlag, values.KeyOne)]}",{CmConfirmFlag:function(e,f){if(!String.IsNull(e)&&e=="1"){return' <img id="CMRECUR_IPB_'+f+'" src="'+SYS_CONST.ImgRoot+'unchecked-checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{if(!String.IsNull(e)&&e=="2"){return' <img id="CMRECUR_IPB_'+f+'" src="'+SYS_CONST.ImgRoot+'checkbox-icon.png" alt="Smiley face" height="25" width="25">'}else{return' <img id="CMRECUR_IPB_'+f+'" src="'+SYS_CONST.ImgRoot+'Done.png" alt="Smiley face" height="25" width="25">'}}}}),width:70,hidden:false,sortable:false,flex:1}]})},OpenTop:function(a,f,e){var d="profile";if(!Ext.isEmpty(e)){d=e}var b=String.format("https://emr.kfsyscc.org?chartno={1}&app={0}",d,f);NisTRApp.view.Misc.OpenOutSite(b);b=null;delete b},GenCmsOutpatGrid:function(a,b,d,e){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="IPBMGR_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="IPBMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OUTPREPARE_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{StyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="WEBEMR_BIRTHDAY_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"床號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="IPBMGR_BEDNO_{KeyOne}" class="link-btn" style="font-size: 20px; font-weight:bold;"; color:{StyleColor};>{NowStationNO}-{NowBedNO}</a>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"入院日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="NONE_IPBINDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.InDate)]} ({InDays})</span>',flex:1,width:140,hidden:false,editable:false,sortable:false},{text:"出院日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="NONE_IPBOUTDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutDate)]}</span>',flex:1,width:140,hidden:false,editable:false,sortable:false},{text:"主治醫師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{NowDocName1} </span>',flex:1,width:90,hidden:false,editable:false,sortable:false},{text:"結案日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="OUTPREPARE_CMSSTATUS_{KeyOne}" style="color:red; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.CloseDate)]}</span>',flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"個管師",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.CmsUserName, values.KeyOne)]}",{inCaseTag:function(f,g){if(!String.IsNull(f)){return' <a id="OUTPREPARE_CMSUSERNAME_"'+g+' class="link-btn" style="font-size: 14px"; >'+f+"</a>"}}}),width:100,hidden:false,sortable:false,flex:1},{text:"收案日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.inCaseTag(values.CmsDate, values.Status ,values.KeyOne)]}",{inCaseTag:function(g,f,h){if(!String.IsNull(g)){return' <a id="OUTPREPARE_CMSINDATE_"'+h+' class="link-btn" style="font-size: 14px"; >'+NisTRApp.view.TRUtility.BirthdayFormat(g)+"</a>"}else{if(String.IsNull(g)&&f=="0"){return' <a id="OUTPREPARE_CMSINDATE_"'+h+' class="link-btn" style="font-size: 14px"; >待收</a>'}}}}),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"出院理由",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[this.isForm(values.OutRsnForm ,values.KeyOne)]}<span id="WORKLIST_OUTRSNNAME_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{OutRsnName}</span>',{isForm:function(f,g){return(f=="1"?'<img id="WORKLIST_OUTRSNNAME_'+g+'_IMG" src="'+SYS_CONST.ImgRoot+'documents.png" alt="Smiley face" height="20" width="20">&nbsp;&nbsp;':"")}}),flex:1,width:140,hidden:false,editable:false,sortable:false}]})},ItemSingleTapCmsOutPatGrid:function(g,b,j,a,h,d){var g=this;var f=h.event.target.id.split("_");if(null==f||f.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"){switch(f[0]){case"IPBMGR":NisTRApp.view.TRUtility.OpenMainUI(a,SYS_CONST.PageDef.Profile,this);break;case"IPBMED":NisTRApp.view.TRUtility.OpenCommonInfoPanel(a,g,"MED");break;case"WORKLIST":NisTRApp.view.TRUtility.OpenCommonInfoPanel(a,g,"WORKLIST");break;case"OUTPREPARE":NisTRApp.view.TRUtility.OpenCommonInfoPanel(a,g,"OUTPREPARE");break;default:break}h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}f=null;delete f;g=null;delete g;_OpenCmsDatmPanel=null;delete _OpenCmsDatmPanel;return false},OpenCM:function(f,d,h,b,g,a){if(f==="CMRECUR"){f="cm_first_recur"}else{if(f==="CMCONFIRM"){f="cm_confirm"}else{if(f==="CMLIST"){NisTRApp.view.Misc.OpenOutSite("http://pc0601007/cm/cm_declare_list.aspx?cm_form=NIS&userid="+d);return false}else{return false}}}var e=String.format("http://pc0601007/cm/{0}.aspx?cm_form=NIS&chart_no={1}&seq={2}&cm_masterseq={3}&cm_seq={4}&userid={6}&ca={6}",f,h,b,g,g,d,a);NisTRApp.view.Misc.OpenOutSite("http://edsweb.kfcc.intra/cm/cm_first_recur.aspx?cm_form=HN&cancer=LIPORAL&chart_no=04631875&seq=06&cm_masterseq=01&cm_seq=01&userid=001565&ca=4");e=null}},config:{}});Ext.define("NisTRApp.view.DateUtil",{extend:Ext.Base,statics:{DateFormat:function(b){var a="";try{if(b!=null){a=String.format("{0}/{1}/{2} {3}",b.getFullYear(),b.getMonth()+1,b.getDate(),NisTRApp.view.DateUtil.DayToStr(b.getDay()))}}catch(d){a=""}return a},DayToStr:function(a){try{switch(a){case 1:return"星期一";break;case 2:return"星期二";break;case 3:return"星期三";break;case 4:return"星期四";break;case 5:return"星期五";break;case 6:return"星期六";break;case 7:case 0:return"星期日";break;default:return"星期"}}catch(b){return"星期"}},FormatRegTime:function(b){try{if(null!=b&&!Ext.isEmpty(b)){if(b.length==4){return b.substr(0,2)+":"+b.substr(2,2)}else{if(b.length>=6){return b.substr(0,2)+":"+b.substr(2,2)+":"+b.substr(4,2)}}}}catch(a){return b}return b},FormDateFormat:function(a){if(!String.IsNull(a)&&a.substring(0,10)!="1753-01-01"){return a.substring(0,10)+" "+a.substring(11,16)}else{return""}},DTToDate:function(a,f){try{if(null!=a&&null!=f){var h=a;var e=f;var g=new Date(h.getFullYear(),h.getMonth(),h.getDate(),e.getHours(),e.getMinutes(),e.getSeconds());return g;delete h;delete e}}catch(b){return null}return null},AppFirstYear:function(){return new Date(2012,6,1,0,0,0,0)},StrToDateTime:function(d,g){try{var b,h;var a=SYS_CONST.SysDate;if(!Ext.isEmpty(d)&&!Ext.isEmpty(g)){b=d.match(REGEXP_CONST.Date.DATE_CHK);h=g.match(REGEXP_CONST.Date.TIME_CHK);if(!Ext.isEmpty(b)&&!Ext.isEmpty(h)){a=new Date(b[1],b[2]-1,b[3],h[1],h[2],(Ext.isEmpty(h[3])?0:h[3]))}}else{if(!Ext.isEmpty(d)&&Ext.isEmpty(g)){b=d.match(REGEXP_CONST.Date.DATE_CHK);if(!Ext.isEmpty(b)){a=new Date(b[1],b[2]-1,b[3],0,0,0)}}else{if(Ext.isEmpty(d)&&!Ext.isEmpty(g)){h=g.match(REGEXP_CONST.Date.TIME_CHK);b=SYS_CONST.SysDate;if(!Ext.isEmpty(h)){a=new Date(b.getFullYear(),b.getMonth(),b.getDate(),h[1],h[2],(Ext.isEmpty(h[3])?0:h[3]))}}else{a=SYS_CONST.SysDate}}}b=null;delete b;h=null;delete h;return a}catch(f){return SYS_CONST.SysDate;console.error(f)}},GetWeekFirstDay:function(){var b=SYS_CONST.SysDate.getDay();if(b==0){b=7}var a=new Date(SYS_CONST.SysDate-(b)*86400000);a.setHours(0);a.setMinutes(0);a.setSeconds(0);b=null;delete b;return a},GetWeekLastDay:function(){var d=SYS_CONST.SysDate.getDay();if(d==0){d=7}var a=new Date(SYS_CONST.SysDate-(d-1)*86400000);var b=new Date((a/1000+6*86400)*1000);b.setHours(23);b.setMinutes(59);b.setSeconds(59);d=null;delete d;a=null;delete a;return b},GetDayCount:function(b){if(null==b|""==b){return""}try{var f=undefined;var a=b.match(REGEXP_CONST.Date.DATE_CHK);if(!Ext.isEmpty(a)){f=new Date(a[1],a[2]-1,a[3],0,0,0)}if(undefined==f||null==f){a=null;delete a;f=null;delete f;return""}else{var d=NisTRApp.view.DateUtil.DateDiffInDays(f,new Date());d=d+1;return d.toString()}}catch(g){console.log(g);return""}},GetOpCount:function(b){if(null==b|""==b){return""}try{var d=undefined;var a=b.match(REGEXP_CONST.Date.DATE_CHK);if(!Ext.isEmpty(a)){d=new Date(a[1],a[2]-1,a[3],0,0,0)}if(undefined==d||null==d){a=null;delete a;d=null;delete d;return""}else{return NisTRApp.view.DateUtil.DateDiffInDays(d,new Date()).toString()}}catch(f){console.log(f);return""}},DateDiffInDays:function(f,b){var a=1000*60*60*24;var e=Date.UTC(f.getFullYear(),f.getMonth(),f.getDate());var d=Date.UTC(b.getFullYear(),b.getMonth(),b.getDate());return Math.floor((d-e)/a)},GetSysDateStr:function(){var b=new Date();var e=b.getFullYear().toString();var d=("00"+(b.getMonth()+1)).slice(-2);var a=("00"+b.getDate()).slice(-2);b=null;delete b;return(e+d+a)},GetSysTimeStr:function(){var a=new Date();var d=("00"+a.getHours()).slice(-2);var e=("00"+a.getMinutes()).slice(-2);var b=("00"+a.getSeconds()).slice(-2);a=null;delete a;return(d+e+b)},CreatDateField:function(g,d,e,b,a,f){return Ext.create("Ext.field.DatePicker",{itemId:g,name:d,label:e,value:f,labelWidth:b,dateFormat:"Y/m/d",style:"float:left;font-size:16px;",width:a,picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2000,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}})},CreateCloseBtn:function(f,b,e,a){var d=Ext.create("Ext.Button",{html:b,itemId:f,margin:"5 5 5 5",ui:"plain",style:"float:left;font-size:16px;",timeField:e}).addListener("tap",a);e.addListener("hiddenchange",function(h,k,g,j){this.setHidden(k)},d);d.timeField=e;return d}},config:{}});Ext.define("NisTRApp.view.FormUtil",{extend:Ext.Base,statics:{FormServer:function(){try{switch(location.hostname.toLowerCase()){case"172.16.254.150":case"hisweb3.kfcc.intra":return NIS_SERVER.FormServer.Developing;break;case"localhost":case"127.0.0.1":return SYS_CONST.FormServer.Developing;case"go.kfcc.intra":case"172.16.254.39":case"172.16.254.124":case"172.16.254.125":return NIS_SERVER.FormServer.Production;default:return NIS_SERVER.FormServer.Developing}}catch(a){return NIS_SERVER.FormServer.Developing}},ResetContentDiv:function(e,b,a){if($("#"+e)!=null&&$("#"+e)!=undefined){$("#"+e).find("iframe").remove();$("#"+e).empty()}if(null!=b&&undefined!=b){var d=String.format('<div  style="width: 100% !important; height: 100% !important;" id="{0}"  ></div>',e);b.setHtml(d)}},ProbAddr:function(f,d,e,a,g){try{return String.format("{0}/RenderOpdProblem.aspx?Standalone=true&FormID={1}&ChartNo={2}&ChartSeq={3}&UserID={4}&CallBack={5}",NisOpdApp.view.FormUtil.FormServer(),f,e,a,d,g)}catch(b){return null}},AssessmentAddr:function(h,m,g,k,b,l,j,n,e,f,a){try{if(null==e||"undefine"==e){e=""}return String.format("{0}/{1}.aspx?Standalone=true&FormID={2}&ChartNo={3}&ChartSeq={4}&UserID={5}&CallBack={6}&CategoryID={7}&FunctionType=Assessment&OpenRecordID={8}&Status={9}&InpNo={10}&Source={11}",NisTRApp.view.FormUtil.FormServer(),h,m,k,b,g,n,l,j,e,f,a)}catch(d){return null}},PrepareAddr:function(k,p,j,m,b,n,l,q,g,h,a,f,o,e){try{if(null==g||"undefine"==g){g=""}return String.format("{0}/{1}.aspx?Standalone=true&FormID={2}&ChartNo={3}&ChartSeq={4}&UserID={5}&CallBack={6}&CategoryID={7}&FunctionType=Assessment&OpenRecordID={8}&Status={9}&InpNo={10}&Source={11}&RefIDForPrepare={12}&SubTitleForPrepare={13}&SourceForPrepare={14}",NisTRApp.view.FormUtil.FormServer(),k,p,m,b,j,q,n,l,g,h,a,f,o,e)}catch(d){return null}},HealthProblemAddr:function(h,m,g,k,b,l,j,n,e,f,a){try{if(null==e||"undefine"==e){e=""}return String.format("{0}/{1}.aspx?Standalone=true&FormID={2}&ChartNo={3}&ChartSeq={4}&UserID={5}&CallBack={6}&CategoryID={7}&FunctionType=Problem&OpenRecordID={8}&Status={9}&InpNo={10}&Source={11}",NisTRApp.view.FormUtil.FormServer(),h,m,k,b,g,n,l,j,e,f,a)}catch(d){return null}},HealthTeachAddr:function(h,m,g,k,b,l,j,n,e,f,a){try{if(null==e||"undefine"==e){e=""}return String.format("{0}/{1}.aspx?Standalone=true&FormID={2}&ChartNo={3}&ChartSeq={4}&UserID={5}&CallBack={6}&CategoryID={7}&FunctionType=Teach&OpenRecordID={8}&Status={9}&InpNo={10}&Source={11}",NisTRApp.view.FormUtil.FormServer(),h,m,k,b,g,n,l,j,e,f,a)}catch(d){return null}},OpenWorkListForm:function(a,f,d){if(Ext.isEmpty(a)){Ext.Msg.alert("OPR_CareInfoPanel 表單網址錯誤");return}try{var b=Ext.getCmp(f);if(!Ext.isEmpty(b)){b.destroy()}if(Ext.isEmpty(b)){b=Ext.create("NisTRApp.view.NIS_FormPanel",{id:f,centered:true,modal:true,url:a,height:NisTRApp.view.SysUtility.ClcHeight(95),width:NisTRApp.view.SysUtility.ClcWidth(95),divID:"WorkListFrameDIV"})}if(!Ext.isEmpty(b)){Ext.Viewport.addListener("resize",function(h,e){this.setWidth(NisTRApp.view.SysUtility.ClcWidth(95));this.setHeight(NisTRApp.view.SysUtility.ClcHeight(95))},b);b.setCaller(d);b.setCloseFn(function(e){});Ext.Viewport.add(b);b.show()}b=null;delete b;a=null;delete a}catch(g){console.log(g)}},MedicalDateFormat:function(b){if(null!=b&&undefined!=b){var a=b.toString();return a.substring(0,16).replace("T"," ")}else{return""}},CmsRemarkAddr:function(j,o,h,l,d,m,k,q,f,g,a,p,n,b,s,r){try{if(null==f||"undefine"==f){f=""}return String.format("{0}/{1}.aspx?Standalone=true&FormID={2}&ChartNo={3}&ChartSeq={4}&UserID={5}&CallBack={6}&CategoryID={7}&FunctionType=CMSAssessment&OpenRecordID={8}&Status={9}&InpNo={10}&Source={11}&RelatedCode={12}&RelatedKey={13}&CmsID={14}&ItemName={15}",NisTRApp.view.FormUtil.FormServer(),j,o,l,d,h,q,m,k,f,g,a,p,n,b,s)}catch(e){return null}}},config:{}});Ext.define("NisTRApp.view.UserConfig",{extend:Ext.Base,statics:{onTap_OprInPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","OPR_INPAT_GRID")},onPainted_OprInPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("OPR_INPAT_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)},LoadUserConfig:function(a){if(Ext.getStore("sUserConfig").isLoading()){return}var b=Ext.getStore("sUserConfig");b.removeAll();b.getProxy().setExtraParams({UserID:NisTRApp.view.SysUtility.GetUserID(),});b.load({callback:function(e,d,f){if(!Ext.isEmpty(a)){a(true)}return true},scope:this});b=null;delete b},GetBySettingName:function(b){if(Ext.getStore("sUserConfig").isLoading()){return}var d=Ext.getStore("sUserConfig");var a=d.find("SettingName",b);if(a>=0){return d.getAt(a).raw.Value}d=null;delete d;return""},GetDefaultPage:function(){try{var a=NisTRApp.view.TRUtility.GetUrlInfo();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.System)){return NisTRApp.view.SysUtility.NameToFunctionType(a.System)}var b=NisTRApp.view.UserConfig.GetBySettingName("DEFAULT_PAGE");if(Ext.isEmpty(b)){return SYS_CONST.FunctionType.OPR}else{return Ext.decode(b)}}catch(d){console.error(d);return SYS_CONST.FunctionType.OPR}},SaveUserConfig:function(d,h,b,f,a,j){try{Ext.Ajax.request({url:SYS_CONST.ApiRoot+"action/UpdateUserConfig.ashx",scope:a,method:"POST",params:{UserID:d,Group:h,SettingName:b,Value:JSON.stringify(f)},success:function(e){var k=Ext.decode(e.responseText);if(k.Success){NisTRApp.view.UserConfig.LoadUserConfig(function(l,m){})}if(!Ext.isEmpty(j)&&Ext.isFunction(j)){j(k.Success)}k=null;delete k},failure:function(){if(!Ext.isEmpty(j)&&Ext.isFunction(j)){j(false)}}})}catch(g){if(!Ext.isEmpty(j)&&Ext.isFunction(j)){j(false)}console.error(g)}},onTap_RisInPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","RIS_INPAT_GRID")},onPainted_RisInPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("RIS_INPAT_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)},onPainted_EndoInPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("ENDO_IPL_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)},onTap_EndoInPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","ENDO_IPL_GRID")},onTap_DiscoverPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","CMS_DIS_GRID")},onPainted_DiscoverPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("CMS_DIS_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)},saveBtnStatus:function(a,k,f){try{var d=a;var b=d.query("templatecolumn");var m=NisTRApp.view.SysUtility.GetUserID();var g=[];for(var h in b){var j=new Object();j.Name=b[h].getText();j.IsHidden=b[h].isHidden();j.SeqNo=h;g.push(j);j=null;delete j}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"action/UpdateUserConfig.ashx",scope:a,method:"POST",params:{UserID:m,Group:k,SettingName:f,Value:JSON.stringify(g)},success:function(e){NisTRApp.view.UserConfig.LoadUserConfig(null)},failure:function(){}});g=null;delete g;d=null;delete d;b=null;delete b;m=null;delete m}catch(l){console.log(l)}},sortGrid:function(a,n){if(!Ext.isEmpty(a.initialFlag)&&!a.initialFlag){return}if(!Ext.isEmpty(n)){a.initialFlag=false;var h=Ext.decode(n);h.sort(function(k,j){var q=parseInt(k.SeqNo,10);var p=parseInt(j.SeqNo,10);if(q>p){return 1}if(q<p){return -1}return 0});var e=a;var b=e.query("templatecolumn");var m=[];var l=0;for(l in b){b[l].setHidden(false);var d=Ext.create("Ext.grid.column.Template",{text:b[l].config.text,align:b[l].config.align,cls:b[l].config.cls,itemId:b[l].config.itemId,tpl:b[l].config.tpl,width:b[l].config.width,hidden:b[l].config.hidden,sortable:b[l].config.sortable,flex:b[l].config.flex});m.push(d);e.removeColumn(b[l]);b[l].destroy();d=null;delete d}for(var g in h){var o=$.grep(m,function(j){return j.getText()==h[g].Name});if(!Ext.isEmpty(o)&&!Ext.isEmpty(o[0])){o[0].setHidden(h[g].IsHidden);e.insertColumn(parseInt(h[g].SeqNo,10),o[0]);Ext.Array.remove(m,o[0])}o=null;delete o}if(!Ext.isEmpty(m)&&m.length>0){for(var f in m){if(!Ext.isEmpty(m[f])){e.insertColumn(l+1,m[f])}}}e.updateTotalColumnWidth();m=null;delete m;h=null;delete h;e=null;delete e;b=null;delete b;l=null;delete l}n=null;delete n},onTap_CmsInPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","CMS_INPAT_GRID")},onPainted_CmsInPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("CMS_INPAT_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)},onTap_CmsRegPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","CMS_REG_GRID")},onPainted_CmsRegPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("CMS_REG_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)},onTap_CmsIpbPatGrid:function(b,d,a){NisTRApp.view.UserConfig.saveBtnStatus(this,"GridControl","CMS_IPB_GRID")},onPainted_CmsIpbPatGrid:function(d,b){if(!Ext.isEmpty(this.initialFlag)&&!this.initialFlag){return}var a=NisTRApp.view.UserConfig.GetBySettingName("CMS_IPB_GRID");NisTRApp.view.UserConfig.sortGrid(this,a)}},config:{}});Ext.define("NisTRApp.view.URLAdapter.FORM",{extend:Ext.Base,statics:{Link:function(b,a){if(!Ext.isEmpty(b.System)&&b.System=="FORM"&&!Ext.isEmpty(b.Page)&&b.Page=="ENDOOPRFORM"){console.log("Start FORM System....");if(Ext.isEmpty(Ext.getCmp("_OprForm"))){Ext.create("NisTRApp.view.OuterLink.ENDO.OprForm",{id:"_OprForm",fullscreen:true,urlInfo:b,record:a})}Ext.Viewport.animateActiveItem(Ext.getCmp("_OprForm"),{type:"slide",direction:"right"});return true}return false}},config:{}});Ext.define("NisTRApp.view.URLAdapter.INP",{extend:Ext.Base,statics:{Link:function(b,a){if(!Ext.isEmpty(b.System)&&b.System=="INP"&&!Ext.isEmpty(b.Page)&&b.Page=="PAINSCORT"&&!Ext.isEmpty(b.InpNo)){console.log("Start INP System....");var d=Ext.getStore("sInpPatient");d.removeAll();d.getProxy().setExtraParams({ChartNo:b.ChartNo,InpNo:b.InpNo});Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});d.load({callback:function(f,e,g){if(null!=f&&null!=f[0]){setTimeout(function(){Ext.Viewport.setMasked(false)},1000);if(!String.IsNull(f[0].data.InpNo)&&!Ext.isEmpty(f[0].raw.Ipbinp)){if(Ext.isEmpty(Ext.getCmp("_PainScort"))){Ext.create("NisTRApp.view.VitalSigns.INP_PainScort",{id:"_PainScort",record:f[0],userInfo:a,fullscreen:true,hideOnMaskTap:false,modal:false,title:"疼痛評估"})}if(null==Ext.getCmp("_PainScort").down(".OINP_PatInfoBar")){if(null==Ext.getCmp("OINP_PatInfoBar")||undefined==Ext.getCmp("OINP_PatInfoBar")){Ext.create("NisTRApp.view.OUT_LINK_INP_PatInfoBar",{id:"OINP_PatInfoBar",maskOnOpen:false,docked:"top",userInfo:a,record:f[0]})}Ext.getCmp("_PainScort").add([Ext.getCmp("OINP_PatInfoBar")])}Ext.Viewport.animateActiveItem(Ext.getCmp("_PainScort"),{type:"slide",direction:"right"});return true}else{Ext.Viewport.setMasked(false);Ext.Msg.alert("住院資料錯誤!","");NisTRApp.app.DefaultStart();return false}}else{Ext.Viewport.setMasked(false);Ext.Msg.alert(MED_CONST.NoMedf,"");NisTRApp.app.DefaultStart();return false}},scope:this});d=null;delete d;return true}return false}},config:{}});Ext.define("NisTRApp.model.OPR.OprmstvEntity",{extend:Ext.data.Model,config:{idProperty:"OprmstID",fields:[{name:"OprmDate",type:"string"},{name:"OprmDateTime",type:"date"},{name:"ChartNO",type:"string"},{name:"Sex",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"RoomName",type:"string"},{name:"FirstKnf",type:"string"},{name:"DrName",type:"string"},{name:"BefDiagName1",type:"string"},{name:"BefDiag_1",type:"string"},{name:"BefOperName1",type:"string"},{name:"BefOperName2",type:"string"},{name:"BefOper_1",type:"string"},{name:"AftOperName1",type:"string"},{name:"AftOperName2",type:"string"},{name:"Anestic",type:"string"},{name:"OprmstID",type:"int"},{name:"PatIdno",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.PatIdno+"_"+b.data.OprmstID},name:"KeyOne",type:"string"},{name:"ChartExpire",type:"string"},{convert:function(a,b){return b.data.Sex+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")},name:"SexStr",type:"string"},{name:"HasPortA",type:"string"},{convert:function(a,b){if(String.IsNull(b.data.HasPortA)){return SYS_CONST.ImgRoot+"empty.png"}else{return SYS_CONST.ImgRoot+"pipe.png"}},name:"HasPortAImgSrc",type:"string"},{name:"Room",type:"int"},{name:"OpStatus",type:"string"},{name:"OpStatusName",type:"string"},{name:"Kind"},{name:"KindName",type:"string"},{name:"ChartSeq",type:"int"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{name:"InpNO",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"},{convert:function(a,b){if(b.data.Kind=="O"&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return SYS_CONST.PatSource.OPD}else{if((b.data.Kind=="O"||b.data.Kind=="E")&&!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{if(!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{return SYS_CONST.PatSource.OPD}}}},name:"Source",type:"auto"},{name:"Age",type:"int"},{name:"CareFlag"},{name:"LabC",type:"string"},{name:"LabH",type:"string"},{name:"LabU",type:"string"},{name:"LabECG",type:"string"},{name:"LabXR",type:"string"},{convert:function(a,b){if((b.data.OpStatus=="6")||(b.data.OpStatus=="5")||(b.data.OpStatus=="4")){return"Silver"}return"Black"},name:"StyleColor",type:"string"},{convert:function(a,b){return"Black"},name:"CareStyleColor",type:"string"},{convert:function(a,b){return SYS_CONST.FunctionType.OPR},name:"SysFunctionType"},{name:"OpTime",type:"string"},{convert:function(a,b){if(!String.IsNull(b.data.OpTime)&&(b.data.OpTime.length==4||b.data.OpTime.length==6)){return b.data.OpTime.substr(0,2)+":"+b.data.OpTime.substr(2,2)}else{return""}},name:"OpTimeFormat",type:"string"},{name:"UserID",type:"string"},{convert:function(a,b){return false},name:"IsPHE",type:"boolean"},{name:"DrCode",type:"string"},{name:"SeqNO",type:"string"},{name:"OpCnt",type:"string"},{name:"DeptName",type:"string"}]}});Ext.define("NisTRApp.model.OPR.OprRoom",{extend:Ext.data.Model,config:{fields:[{name:"RoomID",type:"string"},{name:"RoomName",type:"string"},{name:"RoomIndex",type:"int"}]}});Ext.define("NisTRApp.model.CMS.OutpatData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"InpNO",type:"string"},{name:"Status",type:"string"},{name:"CmsDate",type:"string"},{name:"CmsTime",type:"string"},{name:"CmsUserID",type:"string"},{name:"CmsUserName"},{name:"CmsReason",type:"string"},{name:"CmsRemark",type:"string"},{name:"CloseDate",type:"string"},{name:"CloseTime",type:"string"},{name:"CloseUserID",type:"string"},{name:"CloseReason",type:"string"},{name:"CloseRemark",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"CreUserID",type:"string"},{name:"IsOIN",type:"string"},{name:"MainCare",type:"string"},{name:"MainCareRel",type:"string"},{name:"MainCareTel",type:"string"},{name:"MainCareMobile",type:"string"},{name:"MainContact",type:"string"},{name:"MainContactRel",type:"string"},{name:"MainContactTel",type:"string"},{name:"MainContactMobile",type:"string"},{name:"TransDate",type:"string"},{name:"TransTime",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{name:"PatIdno",type:"string"},{name:"PatName",type:"string"},{name:"Sex",type:"string"},{name:"ChartExpire",type:"string"},{convert:function(a,b){return b.data.Sex+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")},name:"SexStr",type:"string"},{name:"Birthday",type:"string"},{name:"Age",type:"int"},{convert:function(a,b){return SYS_CONST.FunctionType.OUTP},name:"SysFunctionType",type:"auto"},{convert:function(a,b){return SYS_CONST.PatSource.INP},name:"Source",type:"string"},{convert:function(a,b){if(!Ext.isEmpty(b.data.OutDate)){return"Silver"}return"Black"},name:"StyleColor",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.InpNO},name:"KeyOne",type:"string"},{convert:function(a,b){return false},name:"IsPHE",type:"boolean"},{name:"InDate",type:"string"},{name:"InTime",type:"string"},{name:"StationNO",type:"string"},{name:"BedNO",type:"string"},{name:"NowStationNO",type:"string"},{name:"NowBedNO",type:"string"},{name:"DocNO1",type:"string"},{name:"DocName1",type:"string"},{name:"DocNO2",type:"string"},{name:"DocName2",type:"string"},{name:"OutDate",type:"string"},{name:"OutTime",type:"string"},{name:"OutStationNO",type:"string"},{name:"OutBedNO",type:"string"},{name:"HdeptCode",type:"string"},{name:"HdeptName",type:"string"},{name:"NowHdeptCode",type:"string"},{name:"NowHdeptName",type:"string"},{name:"NowDocNO1",type:"string"},{name:"NowDocName1",type:"string"},{name:"NowDocNO2",type:"string"},{name:"NowDocName2",type:"string"},{name:"CmsSource",type:"string"},{name:"ConsoultDate",type:"string"},{name:"RemainReason",type:"string"},{convert:function(a,b){return""},name:"StatusName",type:"string"},{name:"InDays",type:"int"},{name:"CooperationFlag",type:"boolean"},{name:"CooperationBegDate",type:"string"},{name:"CooperationEndDate",type:"string"},{name:"ServiceReq",type:"string"},{name:"ServiceReqOTH",type:"string"},{name:"GetCounty",type:"string"},{name:"GetOrgCode",type:"string"},{name:"GetOrgName",type:"string"},{name:"GetOrgTel",type:"string"},{name:"GetOrgUser",type:"string"},{name:"GetOrgResDate",type:"string"},{name:"GetOrgServiceFlag",type:"string"},{name:"GetOrgServiceDesc",type:"string"},{name:"GetOrgTransDate",type:"string"},{name:"MainIcdhCode",type:"string"},{name:"OutRsnName",type:"string"},{name:"OutRsnForm",type:"string"},{name:"AADReason",type:"string"}]}});Ext.define("NisTRApp.model.Sys.UserInfo",{extend:Ext.data.Model,config:{fields:[{name:"AppID",type:"string"},{name:"UserID",type:"string"},{name:"UserName",type:"string"},{name:"DeviceID",type:"string"},{name:"DeptCode",type:"string"},{name:"EmpNo",type:"string"},{name:"UserEngName",type:"string"},{name:"Token",type:"string"}]}});Ext.define("NisTRApp.model.Reg.Regregm",{extend:Ext.data.Model,config:{fields:[{name:"OrdOutTime"},{name:"TurnOutHosp"},{name:"TurnINFlag"},{name:"PcardDate"},{name:"IccardFlag"},{name:"ICSeqNO"},{name:"OutDate"},{name:"ArrivalNO"},{name:"RegDate"},{name:"Noon"},{name:"NoonName"},{name:"HdeptCode"},{name:"DocNO"},{name:"SectCode"},{name:"RegNO"},{name:"ChartNO"},{name:"ChartSeq"},{name:"PayKind1"},{name:"PayKind2"},{name:"Memo"},{name:"FirstType"},{name:"RegType"},{name:"RegTypeName"},{name:"SpcCode"},{name:"PerType"},{name:"RegSource"},{name:"RegReason"},{name:"UserID"},{name:"ProcDate"},{name:"ProcTime"},{name:"DeleteUserID"},{name:"DeleteDate"},{name:"DeleteTime"},{name:"OpdStatus"},{name:"NeedChart"},{name:"ChartUserID"},{name:"ChartDate"},{name:"ChartTime"},{name:"ChartCount"},{name:"NeedXray"},{name:"XrayUserID"},{name:"XrayDate"},{name:"XrayTime"},{name:"XrayCount"},{name:"NeedNeu"},{name:"NeuUserID"},{name:"NeuDate"},{name:"NeuTime"},{name:"NeuCount"},{name:"NeedRT"},{name:"RTUserID"},{name:"RTDate"},{name:"RTTime"},{name:"RTCount"},{name:"ArrivalEmpid"},{name:"ArrivalTime"},{name:"OpdEmpid"},{name:"OpdTime"},{name:"NeedCount"},{name:"FlgCharge"},{name:"OwnCard"},{name:"CardNO"},{name:"CaseKind"},{name:"PartCode"},{name:"TurnINHosp"},{name:"TurnOutFlag"},{name:"IcdhCode1"},{name:"IcdhCode2"},{name:"IcdhCode3"},{name:"IcdhCode4"},{name:"IcdhCode5"},{name:"OPCode1"},{name:"OPCode2"},{name:"HdrgCode"},{name:"DrugDays"},{name:"GivenFlag"},{name:"OinFlag"},{name:"MultiTreat"},{name:"LastTreatDate"},{name:"OrdFlag"},{name:"SickKind"},{name:"ContiFlag"},{name:"ContiDays"},{name:"SpcCase"},{name:"OverFlag"},{name:"HppFlag"},{name:"SpeID"},{name:"OldchartSeq"},{name:"ExamClass"},{name:"ChmInfo"},{name:"INPerson"},{name:"InpNO"},{name:"OrdINTime"},{name:"OrdTmpTime"},{name:"UDClosed"},{name:"OuthospDocID"},{name:"DocNo2"},{name:"ContiTicket"},{name:"SchTime"},{name:"SchArrivalTime"},{name:"ChmFlag"},{name:"DocName"}]}});Ext.define("NisTRApp.model.Reg.RegPatient",{extend:Ext.data.Model,alias:"model.RegPatient",config:{fields:[{name:"ChartNo",type:"string"},{name:"PatIdNo",type:"string"},{name:"PatName",type:"string"},{name:"Sex",type:"string"},{name:"ChartSeq",type:"int"},{name:"Birthday",type:"string"},{name:"FixBrith",type:"string"},{name:"ComChart",type:"string"},{name:"Age",type:"int"},{name:"Risk",type:"string"},{name:"IcdType",type:"string"},{name:"Suicide",type:"string"},{name:"BloodType",type:"string"},{name:"IsMutiBlood",type:"boolean"},{name:"Dnr",type:"string"},{name:"IsAllergy",type:"boolean"},{name:"ChartLastVol",type:"int"},{convert:function(a,d){try{if(!String.IsNull(d.data.Birthday)){return d.data.Birthday.substr(0,4)+"-"+d.data.Birthday.substr(4,2)+"-"+d.data.Birthday.substr(6,2)}else{return d.data.Birthday}}catch(b){return""}},name:"BirthdayStr"},{name:"Allergy",type:"int"},{convert:function(a,b){return SYS_CONST.PatSource.OPD},name:"Source",type:"auto"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return b.data.PatIdNo},name:"PatIdno",type:"string"}],hasOne:{associatedName:"Regregm",associationKey:"Regregm",model:"NisTRApp.model.Reg.Regregm",getterName:"getRegregm",setterName:"setRegregm"}}});Ext.define("NisTRApp.model.Sys.UserInfoLocal",{extend:Ext.data.Model,config:{identifier:"uuid",fields:[{name:"AppID",type:"string"},{name:"UserID",type:"string"},{name:"UserName",type:"string"},{name:"DeviceID",type:"string"},{name:"DeptCode",type:"string"},{name:"EmpNo",type:"string"},{name:"UserEngName",type:"string"},{name:"Token",type:"string"}],proxy:{type:"localstorage",id:"NisTRAppUserInfoJson"}}});Ext.define("NisTRApp.model.Note.WdisprognoteEntity",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"string"},{name:"InpNO",type:"string"},{name:"ProgDate",type:"string"},{name:"ProgTime",type:"string"},{name:"Source",type:"string"},{name:"ContentS",type:"string"},{name:"ContentO",type:"string"},{name:"ContentA",type:"string"},{name:"ContentP",type:"string"},{name:"UserID",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"Problem",type:"string"},{name:"Md5",type:"string"},{name:"ContentAT",type:"string"},{name:"ATMd5",type:"string"},{name:"ATUserID",type:"string"},{name:"ATDate",type:"string"},{name:"ATTime",type:"string"},{name:"PrnTimestamp",type:"string"},{name:"PrnCount",type:"string"},{name:"SeqNO",type:"int"},{name:"ContentD",type:"string"},{name:"Note",type:"string"},{name:"NoteType",type:"string"},{name:"DssFlag",type:"string"},{name:"UserName",type:"string"},{name:"ProgDateTimeStr",type:"string"},{name:"ProgDateTime",type:"date"}]}});Ext.define("NisTRApp.model.Profile.ptData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"summaryName",type:"string"},{name:"summaryGroup",type:"string"}]}});Ext.define("NisTRApp.model.NUR.NurexamitemEntity",{extend:Ext.data.Model,config:{fields:[{name:"NurexamitemId",type:"int"},{name:"InpNo",type:"string"},{name:"ChartNo",type:"string"},{name:"ExamDate",type:"string"},{name:"ExamItem",type:"string"},{name:"ExamResult",type:"string"},{name:"CodeNo",type:"string"},{name:"OrddRid",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"UserId",type:"string"}]}});Ext.define("NisTRApp.model.NUR.NurdatmEntity",{extend:Ext.data.Model,config:{fields:[{name:"NurdatmId",type:"int"},{name:"InpNo",type:"string"},{name:"ChartNo",type:"string"},{name:"ValidFlag",type:"string"},{name:"Nurdiag",type:"string"},{name:"Nurclass",type:"string"},{name:"Pasthistory",type:"string"},{name:"EmrTel",type:"string"},{name:"EmrRel",type:"string"},{name:"EmrTel2",type:"string"},{name:"EmrRel2",type:"string"},{name:"Memo",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"UserId",type:"string"},{name:"IpbReason",type:"string"},{name:"RiskFall",type:"string"},{name:"RiskBedSore",type:"string"},{name:"RiskCath",type:"string"},{name:"BmtDate",type:"string"},{name:"OpTreat",type:"string"},{name:"OpDate",type:"string"},{name:"ReOpDate",type:"string"},{convert:function(d,e){if(null!=e.data.BmtDate&&""!=e.data.BmtDate){var b=e.data.BmtDate;var a=new Date(parseInt(b.substr(0,4),10),parseInt(b.substr(4,2),10)-1,parseInt(b.substr(6,2),10));return a}else{return null}},name:"BmtDateTime",type:"date"},{convert:function(d,e){if(null!=e.data.OpDate&&""!=e.data.OpDate){var b=e.data.OpDate;var a=new Date(parseInt(b.substr(0,4),10),parseInt(b.substr(4,2),10)-1,parseInt(b.substr(6,2),10));return a}else{return null}},name:"OpDateTime",type:"date"},{convert:function(d,e){if(null!=e.data.ReOpDate&&""!=e.data.ReOpDate){var b=e.data.ReOpDate;var a=new Date(parseInt(b.substr(0,4),10),parseInt(b.substr(4,2),10)-1,parseInt(b.substr(6,2),10));return a}else{return null}},name:"ReOpDateTime",type:"date"},{name:"EmrInfo",type:"string"},{name:"IcdhCodeName1",type:"string"}],hasMany:{model:"NisTRApp.model.NUR.NurexamitemEntity",name:"Nurexamitems"}}});Ext.define("NisTRApp.model.PatientInfo",{extend:Ext.data.Model,config:{fields:[{name:"ChaerNO",type:"string"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{name:"ChartSeq",type:"int"},{name:"InpNO",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"}]}});Ext.define("NisTRApp.model.mHemdatv",{extend:Ext.data.Model,config:{fields:[{name:"SourceName",type:"string"},{name:"ChartNO",type:"string"},{name:"HrmDate",type:"string"},{name:"HrmTime",type:"string"},{name:"HrmType",type:"string"},{name:"UserId",type:"string"},{name:"Report",type:"string"},{name:"HrmLevel",type:"string"},{name:"CreDate",type:"string"},{name:"CreUser",type:"string"},{name:"CreName",type:"string"},{name:"Source",type:"string"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"}]}});Ext.define("NisTRApp.model.mInpInfo",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"InpNO",type:"string"},{name:"NowStationNo",type:"string"},{name:"NowBedNo",type:"string"},{name:"NowDocName",type:"string"},{name:"RsName",type:"string"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"},{name:"InDate",type:"string"},{name:"OutDate",type:"string"},{name:"InpStatus",type:"string"},{name:"PreOutDate",type:"string"}]}});Ext.define("NisTRApp.model.Inp.IpbinpEntity",{extend:Ext.data.Model,config:{fields:[{name:"OweCard",type:"string"},{name:"ISIpbDiag",type:"string"},{name:"DelReason",type:"string"},{name:"AccDate",type:"string"},{name:"Wireless",type:"string"},{name:"VisitNO",type:"string"},{name:"NowPayKind1",type:"string"},{name:"NowPayKind2",type:"string"},{name:"SPID",type:"string"},{name:"ComFlag",type:"string"},{name:"OutStatus",type:"string"},{name:"ComInpNO",type:"string"},{name:"Reason1",type:"string"},{name:"Reason2",type:"string"},{name:"Reason3",type:"string"},{name:"Reason4",type:"string"},{name:"Reason5",type:"string"},{name:"PreOutDate",type:"string"},{name:"CancelReason",type:"string"},{name:"HppFlag",type:"string"},{name:"NowStationno",type:"string"},{name:"NowBedno",type:"string"},{name:"NowHdeptCode",type:"string"},{name:"NowDocNo1",type:"string"},{name:"NowDocNo2",type:"string"},{name:"NowDocNo3",type:"string"},{name:"NowDocNo4",type:"string"},{name:"Pca",type:"string"},{name:"RtnBox",type:"string"},{name:"INOperDate",type:"string"},{name:"INOperTime",type:"string"},{name:"INOperUser",type:"string"},{name:"OutOperDate",type:"string"},{name:"OutOperTime",type:"string"},{name:"OutOperUser",type:"string"},{name:"OpenBedno",type:"string"},{name:"IniCloseDate",type:"string"},{name:"IniCloseTime",type:"string"},{name:"TeachStatus",type:"string"},{name:"NowTeachStatus",type:"string"},{name:"InpNO",type:"string"},{name:"ChartNO",type:"string"},{name:"InpStatus",type:"string"},{name:"InpSource",type:"string"},{name:"INDate",type:"string"},{name:"INTime",type:"string"},{name:"PayKind1",type:"string"},{name:"PayKind2",type:"string"},{name:"PayKind3",type:"string"},{name:"StationNO",type:"string"},{name:"BedNO",type:"string"},{name:"HdeptCode",type:"string"},{name:"DocNo1",type:"string"},{name:"DocNo2",type:"string"},{name:"DocNo3",type:"string"},{name:"DocNo4",type:"string"},{name:"BabyMaterial",type:"string"},{name:"SeparateBed",type:"string"},{name:"OutDate",type:"string"},{name:"OutTime",type:"string"},{name:"OutStationno",type:"string"},{name:"OutBedno",type:"string"},{name:"ReturnNO",type:"string"},{name:"BornFlag",type:"string"},{name:"CardNO",type:"string"},{name:"TrafficFlag",type:"string"},{name:"MergeFlag",type:"string"},{name:"BccFlag",type:"string"},{name:"AgreeFlag",type:"string"},{name:"ExpectDays",type:"int"},{name:"LInpNO",type:"string"},{name:"LEroomDays",type:"int"},{name:"LCroomDays",type:"int"},{name:"EroomDays",type:"int"},{name:"CroomDays",type:"int"},{name:"PartCode",type:"string"},{name:"SickKind",type:"string"},{name:"CaseNO",type:"string"},{name:"HdrgCode",type:"string"},{name:"IniFlag",type:"string"},{name:"FcloseDate",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"UserID",type:"string"},{name:"TurnOB",type:"string"},{name:"OutHdeptCode",type:"string"},{name:"OutDocNo1",type:"string"},{name:"OutDocNo2",type:"string"},{name:"OutDocNo3",type:"string"},{name:"OutDocNo4",type:"string"},{name:"PowderFlag",type:"string"},{name:"DrugNO",type:"string"},{name:"DrugDate",type:"string"},{name:"UDClose",type:"string"},{name:"FmsClose",type:"string"},{name:"OldKind1",type:"string"},{name:"ICAttach",type:"string"},{name:"ICSeqNOError",type:"string"},{name:"IcdhCode1",type:"string"},{name:"IcdhCode2",type:"string"},{name:"IcdhCode3",type:"string"},{name:"IcdhCode4",type:"string"},{name:"IcdhCode5",type:"string"},{name:"IcdhCode6",type:"string"},{name:"IcdhCode7",type:"string"},{name:"IcdhCode8",type:"string"},{name:"IcdhCode9",type:"string"},{name:"IcdhCode10",type:"string"},{name:"IcdhCode11",type:"string"},{name:"IcdhCode12",type:"string"},{name:"IcdhCode13",type:"string"},{name:"IcdhCode14",type:"string"},{name:"IcdhCode15",type:"string"},{name:"IcdhCode16",type:"string"},{name:"IcdhCode17",type:"string"},{name:"IcdhCode18",type:"string"},{name:"IcdhCode19",type:"string"},{name:"IcdhCode20",type:"string"},{name:"NowDocName1",type:"string"},{name:"NowDocName2",type:"string"},{name:"NowDocName3",type:"string"},{name:"NowDocName4",type:"string"},{name:"HdeptCodeName",type:"string"},{name:"ReasonName1",type:"string"},{name:"ReasonName2",type:"string"},{name:"ReasonName3",type:"string"},{name:"ReasonName4",type:"string"},{name:"ReasonName5",type:"string"},{name:"IcdhCodeName1",type:"string"},{name:"IcdhCodeName2",type:"string"},{name:"IcdhCodeName3",type:"string"},{name:"IcdhCodeName4",type:"string"},{name:"IcdhCodeName5",type:"string"},{name:"IcdhCodeName6",type:"string"},{name:"IcdhCodeName7",type:"string"},{name:"IcdhCodeName8",type:"string"},{name:"IcdhCodeName9",type:"string"},{name:"IcdhCodeName10",type:"string"},{name:"IcdhCodeName11",type:"string"},{name:"IcdhCodeName12",type:"string"},{name:"IcdhCodeName13",type:"string"},{name:"IcdhCodeName14",type:"string"},{name:"IcdhCodeName15",type:"string"},{name:"IcdhCodeName16",type:"string"},{name:"IcdhCodeName17",type:"string"},{name:"IcdhCodeName18",type:"string"},{name:"IcdhCodeName19",type:"string"},{name:"IcdhCodeName20",type:"string"},{name:"IcdhCodeNameE1",type:"string"},{name:"IcdhCodeNameE2",type:"string"},{name:"IcdhCodeNameE3",type:"string"},{name:"IcdhCodeNameE4",type:"string"},{name:"IcdhCodeNameE5",type:"string"},{name:"IcdhCodeNameE6",type:"string"},{name:"IcdhCodeNameE7",type:"string"},{name:"IcdhCodeNameE8",type:"string"},{name:"IcdhCodeNameE9",type:"string"},{name:"IcdhCodeNameE10",type:"string"},{name:"IcdhCodeNameE11",type:"string"},{name:"IcdhCodeNameE12",type:"string"},{name:"IcdhCodeNameE13",type:"string"},{name:"IcdhCodeNameE14",type:"string"},{name:"IcdhCodeNameE15",type:"string"},{name:"IcdhCodeNameE16",type:"string"},{name:"IcdhCodeNameE17",type:"string"},{name:"IcdhCodeNameE18",type:"string"},{name:"IcdhCodeNameE19",type:"string"},{name:"IcdhCodeNameE20",type:"string"},{name:"InDateTime",type:"date"},{name:"OutDateTime",type:"date"},{name:"TurnInDate",type:"string"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo"},{convert:function(a,b){return b.data.InpNO},name:"InpNo"},{convert:function(a,d){var b="";if(d.data.Reason1!=null){b+=d.data.ReasonName1+";"}if(d.data.Reason2!=null){b+=d.data.ReasonName2+";"}if(d.data.Reason3!=null){b+=d.data.ReasonName3+";"}return b},name:"ReasonSummary"},{convert:function(a,b){return b.data.INDate},name:"InDate",type:"string"},{convert:function(a,b){return b.data.NowBedno},name:"NowBedNo",type:"string"}]}});Ext.define("NisTRApp.model.InpPatient",{extend:Ext.data.Model,config:{fields:[{name:"IsMutiBlood",type:"boolean"},{name:"Dnr",type:"string"},{name:"ChartNo",type:"string"},{name:"Sex",type:"string"},{convert:function(a,b){return b.data.Birthday.substr(0,4)+"-"+b.data.Birthday.substr(4,2)+"-"+b.data.Birthday.substr(6,2)},name:"BirthdayStr",type:"string"},{name:"InpNo",type:"string"},{name:"PatIdNo",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"Age",type:"int"},{name:"Risk",type:"string"},{name:"BloodType",type:"string"},{name:"IsAllergy",type:"boolean"},{name:"IcdType",type:"string"},{name:"Suicide",type:"string"},{name:"Allergy",type:"int"},{convert:function(a,b){return b.data.InpNo},name:"InpNO",type:"string"},{convert:function(a,b){return SYS_CONST.PatSource.INP},name:"Source",type:"auto"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return b.data.PatIdNo},name:"PatIdno",type:"string"},{name:"EmrName",type:"string"},{name:"EmrRel",type:"string"},{name:"EmrTel",type:"string"},{name:"EmrMobile",type:"string"}],hasMany:{associationKey:"Hemdatvs",model:"NisTRApp.model.mHemdatv",name:"Hemdatvs"},hasOne:[{associatedName:"InpInfo",associationKey:"InpInfo",model:"NisTRApp.model.mInpInfo",getterName:"getInpInfo",setterName:"setInpInfo"},{associatedName:"Ipbinp",associationKey:"Ipbinp",model:"NisTRApp.model.Inp.IpbinpEntity",getterName:"getIpbinp",setterName:"setIpbinp"},{associatedName:"Nurdatm",associationKey:"Nurdatm",model:"NisTRApp.model.NUR.NurdatmEntity",getterName:"getNurdatm",setterName:"setNurdatm"},{associatedName:"CmsOutpat",associationKey:"CmsOutpat",primaryKey:"InpNO",model:"NisTRApp.model.CMS.OutpatData",getterName:"getCmsOutpat",setterName:"setCmsOutpat"}]}});Ext.define("NisTRApp.model.Management.ConfirmOrder",{extend:Ext.data.Model,config:{fields:[{name:"InpNo",type:"string"},{name:"ChartNo",type:"string"},{name:"MajorClass",type:"string"},{name:"OrddRid",type:"string"},{name:"OrderType",type:"string"},{name:"MajorClassName",type:"string"},{name:"SeqNo",type:"string"},{name:"RowId",type:"string"},{name:"Status",type:"string"},{name:"NowStationNo",type:"string"},{name:"NowBedNo",type:"string"},{name:"TimeMsg",type:"string"},{name:"ModId",type:"string"},{name:"ModName",type:"string"},{name:"OrddTxt",type:"string"},{name:"OrddBin",type:"string"},{name:"OrddCheck",type:"string"},{name:"OrddLock",type:"string"},{name:"ExeFreqDate",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"StopDate",type:"string"},{name:"StopTime",type:"string"},{name:"EndDate",type:"string"},{name:"EndTime",type:"string"},{name:"ExeFlag",type:"string"},{name:"ExeDate",type:"string"},{name:"ExeTime",type:"string"},{name:"PexeDate",type:"string"},{name:"PexeTime",type:"string"},{name:"ConfirmFlag",type:"string"},{name:"ProfRid",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{convert:function(b,d){var a="black";if(d.data.Status=="新增"){a="blue"}if(d.data.Status=="停用"){a="red"}if(d.data.Status=="Change"){a="green"}return a},name:"Color"},{convert:function(a,b){return b.data.ProcDate.substr(0,4)+"-"+b.data.ProcDate.substr(4,2)+"-"+b.data.ProcDate.substr(6,2)+" "+b.data.ProcTime.substr(0,2)+":"+b.data.ProcTime.substr(2,2)},name:"ProcDateTimeStr"},{name:"OrddHtml"}]}});Ext.define("NisTRApp.model.mOPDVitalSignData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"Temp",type:"float"},{name:"Bps",type:"float"},{name:"Bpd",type:"float"},{name:"Pulse",type:"auto"},{name:"Resp",type:"float"},{name:"Pain",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"Height",type:"float"},{name:"Weight",type:"float"},{name:"Spo2",type:"float"},{name:"Remark",type:"string"},{convert:function(a,b){if(b.data.Temp!=null&&b.data.Temp>="38"){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}},name:"TempStyle"},{convert:function(a,b){if(b.data.Pulse!=null&&(b.data.Pulse>=120||b.data.Pulse<=60)){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}},name:"PulseStyle",type:"string"},{convert:function(a,b){if(b.data.Resp>=26&b.data.Resp!=null){return"color:red; font-weight:bold; font-size: 14px"}else{if(b.data.Resp<=14&b.data.Resp!=null){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}}},name:"RespStyle",type:"string"},{convert:function(a,b){if(b.data.Bps!=null&&(b.data.Bps>=160||b.data.Bps<=90)){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}},name:"BpsStyle",type:"string"},{convert:function(a,b){if(b.data.Pain=="Y"&b.data.Pain!=""){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black;  font-size: 14px"}},name:"PainStyle",type:"string"},{name:"OpdvitalID",type:"string"},{convert:function(a,d){if(d.data.Bpd!=null&d.data.Bps!=null){var b=Math.round((2*parseInt(d.data.Bpd,10)+parseInt(d.data.Bps,10))/3);return b}else{return""}},name:"Mbp",type:"float"}]}});Ext.define("NisTRApp.model.Patient.ActiveCatheterData",{extend:Ext.data.Model,config:{fields:[{name:"Accessnum",type:"string"},{name:"ChartNo",type:"string"},{name:"ProNo",type:"string"},{name:"ProTitle",type:"string"},{name:"Site",type:"string"},{name:"NextAddDate",type:"string"},{name:"LateFlag",type:"string"},{name:"Cate1",type:"string"},{name:"DeptCode",type:"string"},{name:"Ver",type:"string"},{name:"ProgVer",type:"string"},{name:"ProgVer2",type:"string"},{name:"ProgFlag",type:"string"},{name:"ProgDc",type:"string"},{name:"ProgDate",type:"string"},{name:"AddDate",type:"string"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"}]}});Ext.define("NisTRApp.model.Form.OpenRecord",{extend:Ext.data.Model,config:{idProperty:"OpenRecordID",fields:[{name:"FormID",type:"string"},{name:"Discontinue",type:"boolean"},{name:"PlanLatestDate",type:"string"},{name:"StartDate",type:"string"},{name:"LastNotesDate",type:"string"},{name:"Finished",type:"boolean"},{name:"SubTitle",type:"string"},{name:"OpenRecordID",type:"string"},{name:"Title",type:"string"},{name:"DiscontinueUserID",type:"string"},{name:"DiscontinueUserName",type:"string"},{name:"DiscontinueDate",type:"string"},{name:"LastMainDate",type:"string"},{name:"LastConfirmDate",type:"string"},{name:"UserID",type:"string"},{name:"PlanFinishedFlag",type:"string"},{name:"SignatureDate",type:"string"},{name:"CategoryID",type:"string"},{convert:function(a,b){return"Black"},name:"StyleColor",type:"string"},{convert:function(a,d){var b=d.data;return b.FormID+"_"+b.OpenRecordID},name:"KeyOne",type:"string"},{name:"CategoryTitle",type:"string"},{name:"InpNo",type:"string"},{name:"PatSignChecked",type:"string"},{name:"ChartSeq",type:"int"},{name:"ChartNo",type:"string"},{convert:function(a,b){return b.data.Title},name:"text",type:"string"},{convert:function(a,b){return b.data.FormID},name:"formID",type:"string"},{name:"RegDate",type:"string"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return b.data.InpNo},name:"InpNO",type:"string"},{convert:function(a,b){return b.data.OpenRecordID},name:"OpenRecordId",type:"string"},{name:"PrepareTitle",type:"string"},{name:"MainMasterID",type:"string"},{convert:function(b,d){var a=d.data.Title;if(null!=d.data.Discontinue&&true==d.data.Discontinue){a="(停用) "+d.data.Title}return a},name:"DisplayTitle",type:"string"}]}});Ext.define("NisTRApp.model.EMR.UnsignForm",{extend:Ext.data.Model,config:{idProperty:"MasterID",fields:[{name:"MasterID",type:"string"},{name:"InpNO",type:"string"},{name:"UserID",type:"string"},{name:"FunctionType",type:"string"},{name:"Title",type:"string"},{name:"SubTitle",type:"string"},{name:"Html",type:"string"},{name:"Finished",type:"string"},{name:"Flag",type:"string"},{name:"Discontinue",type:"string"},{name:"MedicalDate",type:"string"},{name:"SignatureDate",type:"string"},{name:"DiscontinueDate",type:"string"},{name:"PatName",type:"string"},{name:"ChartNo",type:"string"},{name:"UserName",type:"string"},{convert:function(b,d){var a="";switch(d.data.FunctionType){case"Assessment":a="護理評估";break;case"Problem":a="護理問題";break;case"Notes":a="護理記錄";break;case"Consult":a="照會作業";break;case"Teach":a="衛教指導";break;case"Prepare":a="準備單";break;default:a=""}return a},name:"FunctionTypeName",type:"string"},{name:"ChartSeq",type:"int"}]}});Ext.define("NisTRApp.model.Form.InitialRecordItem",{extend:Ext.data.Model,config:{idProperty:"Title",fields:[{name:"Ordseq",type:"int"},{name:"Type",type:"string"},{name:"ProcDate",type:"string"},{name:"OpenRecordId",type:"string"},{name:"CategoryId",type:"string"},{name:"FormId",type:"string"},{name:"Title",type:"string"}]}});Ext.define("NisTRApp.model.OPR.ContactData",{extend:Ext.data.Model,config:{fields:[{name:"OprmstID",type:"int"},{name:"OprmDate",type:"string"},{name:"TelHome",type:"string"},{name:"TelOffice",type:"string"},{name:"TelMobile",type:"string"},{name:"ContactTime1",type:"string"},{name:"ContactTime2",type:"string"},{name:"ContactTimeOthers",type:"string"},{name:"HppFlag",type:"string"},{name:"ContacterPatient",type:"string"},{name:"ContacterFamily",type:"string"},{name:"ContacterFamilyRelationship",type:"string"},{name:"ContacterFriend",type:"string"},{name:"ContacterFriendName",type:"string"},{name:"ContactYes",type:"string"},{name:"ContactNo",type:"string"},{name:"ContactOther",type:"string"},{name:"CreUserID",type:"string"},{name:"CreUserName",type:"string"},{name:"CreDateTime",type:"string"},{name:"ModifyUserID",type:"string"},{name:"ModifyUserName",type:"string"},{name:"ModifyDateTime",type:"string"}]}});Ext.define("NisTRApp.model.Form.NursingNotes",{extend:Ext.data.Model,config:{fields:[{name:"Finished",type:"boolean"},{name:"MedicalDate",type:"date"},{name:"MedicalDateFormat",type:"string"},{name:"MedicalTimeFormat",type:"string"},{name:"MasterID",type:"string"},{name:"NotesID",type:"auto"},{name:"Version",type:"string"},{name:"Title",type:"string"},{name:"Content",type:"string"},{name:"Value",type:"string"},{name:"ValueMemo",type:"string"},{name:"UserName",type:"string"},{convert:function(a,b){return NisTRApp.view.Misc.htmlEncode(b.data.Content)},name:"HtmlEncodeContent",type:"string"},{name:"NurseName",type:"string"}]}});Ext.define("NisTRApp.model.Note.NotesTempRecord",{extend:Ext.data.Model,config:{idProperty:"FormID",fields:[{name:"ChartNo",type:"string"},{name:"ChartSeq",type:"int"},{name:"Title",type:"string"},{name:"MedicalDate",type:"string"},{name:"OpenRecordId",type:"string"},{name:"FormID",type:"string"},{convert:function(a,b){return b.data.Title},name:"text",type:"string"},{convert:function(a,b){return b.data.FormID},name:"formID",type:"string"}]}});Ext.define("NisTRApp.model.Form.FrmTemplateEntity",{extend:Ext.data.Model,config:{fields:[{name:"FunctionType",type:"auto"},{name:"FormID",type:"string"},{name:"TemplateID",type:"string"},{name:"Title",type:"string"},{name:"Content",type:"string"},{name:"OrderNo",type:"string"}]}});Ext.define("NisTRApp.model.Med.MedmedfEntity",{extend:Ext.data.Model,config:{fields:[{name:"XrayWarehouse",type:"string"},{name:"LastDateO",type:"string"},{name:"LastDateI",type:"string"},{name:"MissDate",type:"string"},{name:"MissCount",type:"int"},{name:"CreditO",type:"int"},{name:"CreditI",type:"int"},{name:"CardSeq",type:"string"},{name:"ChartSeq",type:"int"},{name:"FlgMrsa",type:"string"},{name:"FlgTB",type:"string"},{name:"FlgAids",type:"string"},{name:"FirstDate",type:"string"},{name:"RtcLastVol",type:"int"},{name:"RtcWarehouse",type:"string"},{name:"RtxLastVol",type:"int"},{name:"RtxWarehouse",type:"string"},{name:"CreateTime",type:"string"},{name:"XcreateDate",type:"string"},{name:"XcreateTime",type:"string"},{name:"XcreateEmpid",type:"string"},{name:"ICUpdateTimes",type:"string"},{name:"UserID",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"ExpDate",type:"string"},{name:"ExpSource",type:"string"},{name:"ChartNO",type:"string"},{name:"PatIdno",type:"string"},{name:"PatName",type:"string"},{name:"Sex",type:"string"},{name:"Birthday",type:"string"},{name:"Married",type:"string"},{name:"Education",type:"string"},{name:"Occupation",type:"string"},{name:"BloodGroup",type:"string"},{name:"TelHome",type:"string"},{name:"TelOffice",type:"string"},{name:"TelMobile",type:"string"},{name:"AreaCode",type:"string"},{name:"Address",type:"string"},{name:"DomicileZip",type:"string"},{name:"Domicile",type:"string"},{name:"Email",type:"string"},{name:"PayKind1",type:"string"},{name:"PayKind2",type:"string"},{name:"Vip",type:"string"},{name:"District",type:"string"},{name:"EmrName",type:"string"},{name:"EmrTel",type:"string"},{name:"EmrZip",type:"string"},{name:"EmrAddr",type:"string"},{name:"EmrRel",type:"string"},{name:"CreateDate",type:"string"},{name:"CreateEmpid",type:"string"},{name:"Remark",type:"string"},{name:"ComChart",type:"string"},{name:"ComDate",type:"string"},{name:"Status",type:"string"},{name:"ChartExpire",type:"string"},{name:"ChartLastVol",type:"int"},{name:"ChartWarehouse",type:"string"},{name:"XrayLastVol",type:"int"},{name:"Aboriginal",type:"string"},{name:"LastName",type:"string"},{name:"FirstName",type:"string"},{name:"OccComp",type:"string"},{name:"OccTitle",type:"string"},{name:"TurnInDoc",type:"string"},{name:"TurnInTel",type:"string"},{name:"TurnInHosp",type:"string"},{name:"EmrBb",type:"string"},{name:"LastSelfO",type:"string"},{name:"CbOth1",type:"string"},{name:"CbOth2",type:"string"},{name:"CbOth3",type:"string"},{name:"DistrName",type:"string"},{name:"OccupationName",type:"string"},{name:"AreaName",type:"string"},{name:"CommAreaName",type:"string"},{name:"EmrAreaName",type:"string"},{name:"CreUserName",type:"string"},{name:"PartNOI",type:"string"},{name:"Age",type:"int"},{convert:function(a,d){try{if(!String.IsNull(d.data.Sex)){switch(d.data.Sex){case"M":return"Male 男性";break;case"F":return"Female 女性";break;default:return d.data.Sex}}}catch(b){return""}},name:"SexStr",type:"string"},{convert:function(a,d){try{if(!String.IsNull(d.data.Birthday)){return d.data.Birthday.substr(0,4)+"-"+d.data.Birthday.substr(4,2)+"-"+d.data.Birthday.substr(6,2)}else{return d.data.Birthday}}catch(b){return""}},name:"BirthdayStr",type:"string"},{convert:function(a,d){try{if(!String.IsNull(d.data.Married)){switch(d.data.Married){case"1":return"1-未婚";break;case"2":return"2-已婚";break;case"3":return"3-離婚";break;case"4":return"4-分居";break;case"5":return"5-喪偶";break;case"6":return"6-再婚";break;case"7":return"7-其它";break;default:return"X-不詳"}}}catch(b){return"E-不詳"}return"N-不詳"},name:"MarriedStr",type:"string"},{convert:function(a,d){try{if(!String.IsNull(d.data.Education)){switch(d.data.Education){case"1":return"1-文盲";break;case"2":return"2-小學";break;case"3":return"3-初中";break;case"4":return"4-高中";break;case"5":return"5-大專";break;case"6":return"6-大學";break;case"7":return"7-碩士";break;case"8":return"8-博士";break;case"9":return"9-其它";break;default:return"X-不詳"}}}catch(b){return"E-不詳"}return"N-不詳"},name:"EducationStr",type:"string"},{convert:function(a,d){try{if(!String.IsNull(d.data.Domicile)&&!String.IsNull(d.data.DomicileZip)){return d.data.DomicileZip+"  "+d.data.Domicile}else{if(!String.IsNull(d.data.Domicile)){return d.data.Domicile}}}catch(b){return""}return""},name:"DomicileStr",type:"string"},{convert:function(a,d){try{if(!String.IsNull(d.data.Address)&&!String.IsNull(d.data.AreaCode)){return d.data.AreaCode+"  "+d.data.Address}else{if(!String.IsNull(d.data.Address)){return d.data.Address}}}catch(b){return""}return""},name:"AddressStr",type:"string"},{convert:function(a,d){try{if(!String.IsNull(d.data.EmrAddr)&&!String.IsNull(d.data.EmrZip)){return d.data.EmrZip+"  "+d.data.EmrAddr}else{if(!String.IsNull(d.data.EmrAddr)){return d.data.EmrAddr}}}catch(b){return""}return""},name:"EmrAddrStr",type:"string"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"}]}});Ext.define("NisTRApp.model.Reg.RegHistoryData",{extend:Ext.data.Model,config:{fields:[{name:"Sex",type:"string"},{name:"PatIdno",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"ChartNo",type:"string"},{name:"ChartSeq",type:"int"},{name:"RegDate",type:"string"},{name:"Noon",type:"string"},{name:"HdeptCode",type:"string"},{name:"HdeptName",type:"string"},{name:"DocNo",type:"string"},{name:"DocName",type:"string"},{name:"DocNo2",type:"string"},{name:"DocName2",type:"string"},{name:"ChartExpire",type:"string"},{name:"FirstFlag",type:"string"},{convert:function(a,b){return"Black"},name:"StyleColor",type:"string"},{convert:function(a,b){return b.data.ChartNo+"_"+b.data.ChartSeq+"_"+b.data.PatIdno},name:"KeyOne",type:"string"},{convert:function(a,b){return NisTRApp.view.TRUtility.NoonTranToName(b.data.Noon)},name:"NoonStr",type:"string"},{convert:function(a,b){if(b.data.Sex==3){return"male"+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")}else{return"female"+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")}},name:"SexStr",type:"string"},{name:"Reason",type:"int"},{name:"Remark",type:"string"},{name:"RegType",type:"string"},{name:"RegTypeName",type:"string"},{name:"AreaName",type:"string"},{name:"OpdStatus",type:"string"},{name:"AccTime",type:"string"},{name:"ArrivalTime",type:"string"},{name:"OrdInTime",type:"string"},{name:"OrdOutTime",type:"string"},{name:"NoteTime",type:"string"},{name:"BedNo",type:"string"}]}});Ext.define("NisTRApp.model.mWorkingItem",{extend:Ext.data.Model,config:{idProperty:"ItemID",fields:[{name:"ItemID",type:"string"},{name:"ItemName",type:"string"},{name:"Completeness",type:"float"},{name:"DisplayMsg",type:"string"},{name:"IsFinished",type:"boolean"},{name:"WorkType",type:"string"}]}});Ext.define("NisTRApp.model.Ipo.IpovitalEntity",{extend:Ext.data.Model,config:{fields:[{name:"VitalID",type:"int"},{name:"ChartNO",type:"string"},{name:"InpNO",type:"string"},{name:"Temp",type:"float"},{name:"Bpd",type:"float"},{name:"Bps",type:"float"},{name:"BpsArterial",type:"float"},{name:"BpdArterial",type:"float"},{name:"Pulse",type:"int"},{name:"Desp",type:"int"},{name:"Resp",type:"int"},{name:"Dt",type:"string"},{name:"UserID",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"DelFlag",type:"string"},{name:"Heart",type:"int"},{name:"DelDate",type:"string"},{name:"DelTime",type:"string"},{name:"DelUser",type:"string"},{name:"Remark",type:"string"},{name:"Map",type:"string"},{name:"Mbp",type:"string"},{convert:function(a,b){if(b.data.Temp!=null&&b.data.Temp>="38"){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}},name:"TempStyle",type:"string"},{convert:function(a,b){if(b.data.Pulse!=null&&(b.data.Pulse>=120||b.data.Pulse<=60)){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}},name:"PulseStyle",type:"string"},{convert:function(a,b){if(b.data.Resp>=26&b.data.Resp!=null){return"color:red; font-weight:bold; font-size: 14px"}else{if(b.data.Resp<=14&b.data.Resp!=null){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}}},name:"RespStyle",type:"string"},{convert:function(a,b){if(b.data.Bps!=null&&(b.data.Bps>=160||b.data.Bps<=90)){return"color:red; font-weight:bold; font-size: 14px"}else{return"color:black; font-size: 14px"}},name:"BpsStyle",type:"string"},{name:"CreDateTime",type:"date"},{convert:function(a,b){return(b.data.Bpd==0?0:b.data.Mbp)},name:"MbpNum",type:"float"},{convert:function(a,b){return(b.data.Bpd==0?0:b.data.Bpd)},name:"Dbp",type:"float"},{convert:function(a,b){return(b.data.BpdArterial==0?0:b.data.BpdArterial)},name:"Adbp",type:"float"},{convert:function(a,b){return(b.data.BpdArterial==0?0:b.data.Map)},name:"MapNum",type:"string"}]}});Ext.define("NisTRApp.model.InpRecentBodyWeight",{extend:Ext.data.Model,config:{fields:[{name:"MBH",type:"string"},{name:"MBHRemark",type:"string"},{name:"MBHCreDate",type:"string"},{name:"MBW",type:"string"},{name:"MBWRemark",type:"string"},{name:"MBWCreDate",type:"string"}]}});Ext.define("NisTRApp.model.Sys.DrugTimeMapping",{extend:Ext.data.Model,config:{fields:[{name:"DrugTime",type:"auto"},{name:"IsNeedMedication",type:"boolean"},{name:"TimeGroup",type:"string"},{name:"YYYY",type:"string"},{name:"MM",type:"string"},{name:"DD",type:"string"},{name:"HH",type:"string"},{name:"MI",type:"string"},{name:"SS",type:"string"},{name:"DisplayString",type:"string"}]}});Ext.define("NisTRApp.model.Management.HoursDrugInfo",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"InpNo",type:"string"},{name:"OrddRid",type:"string"},{name:"HasDruglogs",type:"boolean"}],hasOne:{associatedName:"DrugTimeMap",associationKey:"DrugTimeMap",model:"NisTRApp.model.Sys.DrugTimeMapping",getterName:"getDrugTimeMap",setterName:"setDrugTimeMap"}}});Ext.define("NisTRApp.model.Management.ActiveOrd",{extend:Ext.data.Model,config:{fields:[{name:"InpNo",type:"string"},{name:"ChartNo",type:"string"},{name:"MajorClass",type:"string"},{name:"OrddRid",type:"string"},{name:"OrderType",type:"string"},{name:"MajorClassName",type:"string"},{name:"MinorClass",type:"string"},{name:"Frequency",type:"string"},{name:"Status",type:"string"},{name:"SeqNo",type:"int"},{name:"CodeSeq",type:"string"},{name:"CodeNo",type:"string"},{name:"Dateb",type:"string"},{name:"Route",type:"string"},{name:"DrugDays",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"EndDate",type:"string"},{name:"PayFlag",type:"string"},{name:"ExeDate",type:"string"},{name:"ExeFlag",type:"string"},{name:"PexeDate",type:"string"},{name:"PexeStatus",type:"string"},{name:"Remark",type:"string"},{name:"Explain",type:"string"},{name:"ShtId",type:"string"},{name:"ShtVer",type:"string"},{name:"ShtData",type:"string"},{name:"MbdFlag",type:"string"},{name:"OrddCheck",type:"string"},{name:"OrddTxt",type:"string"},{name:"OrddBin",type:"string"},{name:"ExeFreqDate",type:"string"},{name:"ExeUserId",type:"string"},{name:"PexeTime",type:"string"},{name:"Accessnum",type:"string"},{name:"FreqTimeShift",type:"int"},{name:"ShiftUser",type:"string"},{name:"StopDate",type:"string"},{name:"StopTime",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"CreId",type:"string"},{name:"CreUserName",type:"string"},{name:"EndTime",type:"string"},{name:"Sampcode",type:"string"},{name:"Fluidcnt",type:"int"},{name:"Origin",type:"string"},{name:"MicroType",type:"string"},{name:"OriOthers",type:"string"},{name:"ShtOutput",type:"string"},{name:"ExeTime",type:"string"},{name:"Rid",type:"string"},{name:"Mgrseq",type:"string"},{name:"OrddHtml",type:"string"},{name:"NurseCallDrugFlag",type:"boolean"},{name:"ErcarDrugListFlag",type:"boolean"},{name:"TotQty",type:"int"},{name:"Dose",type:"auto"},{name:"DoseUnit",type:"string"},{name:"DrugTime",type:"string"},{name:"OriginalDrugTime",type:"string"},{name:"LastDrugDate",type:"auto"},{name:"PreExamDateTime",type:"auto"},{name:"OrddCheckStatus",type:"string"},{name:"IsAo",type:"boolean"},{name:"IsStat",type:"boolean"},{name:"IsPrn",type:"boolean"},{name:"IsOverTime",type:"boolean"},{name:"IsChangeTime",type:"boolean"},{name:"LastOverTime",type:"auto"},{name:"BagCount",type:"int"},{name:"IsActive",type:"boolean"},{name:"IsOrderBegin",type:"boolean"},{name:"IsOrderEnd",type:"boolean"},{convert:function(a,d){var b=d.data;if(!Ext.isEmpty(b.BegDate)){return String.format("{0}-{1}-{2} {3}:{4}",b.BegDate.substr(0,4),b.BegDate.substr(4,2),b.BegDate.substr(6,2),(Ext.isEmpty(b.BegTime)?"00":b.BegTime.substr(0,2)),(Ext.isEmpty(b.BegTime)?"00":b.BegTime.substr(2,2)))}else{return""}},name:"BegDateTime",type:"string"},{convert:function(a,b){return b.data.OrddHtml},name:"OrddTextStr",type:"string"},{name:"EndDateTime",type:"auto"},{name:"DblchkFlag",type:"string"},{name:"IsEsam",type:"boolean"},{name:"IsBottle",type:"boolean"},{name:"IsQD",type:"boolean"},{name:"IsIplusB",type:"boolean"},{name:"Dose2",type:"auto"},{name:"Formula",type:"string"},{name:"TpnBegDate",type:"string"},{name:"ProCode"},{name:"ChmSeq"},{name:"IsNurSchedule",type:"boolean"},{name:"ScheDateTime",type:"auto"},{name:"ScheTimeslot"},{name:"ScheDate"},{name:"ScheTime"},{name:"Chemo",type:"string"},{name:"NewDose",type:"auto"},{name:"NewDoseUnit",type:"auto"},{name:"IsBottleInjection",type:"boolean"},{name:"IsOP",type:"boolean"},{name:"ChmLevCode",type:"string"}],hasOne:[{associatedName:"DrugInfo1",associationKey:"DrugInfo1",model:"NisTRApp.model.Management.HoursDrugInfo",getterName:"getDrugInfo1",setterName:"setDrugInfo1"},{associatedName:"DrugInfo2",associationKey:"DrugInfo2",model:"NisTRApp.model.Management.HoursDrugInfo",getterName:"getDrugInfo2",setterName:"setDrugInfo2"},{associatedName:"DrugInfo3",associationKey:"DrugInfo3",model:"NisTRApp.model.Management.HoursDrugInfo",getterName:"getDrugInfo3",setterName:"setDrugInfo3"}]}});Ext.define("NisTRApp.model.Management.ActiveOrds",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"InpNo",type:"string"},{name:"ScheCnt",type:"int"},{name:"MbdCnt",type:"int"},{name:"OpChemoCnt",type:"int"},{name:"ChemoCnt",type:"int"},{name:"PcaCnt",type:"int"},{name:"LabCnt",type:"int"},{name:"AllStatCnt",type:"int"},{name:"TreatStatCnt",type:"int"},{name:"OpChemoStatCnt",type:"int"},{name:"LabStatCnt",type:"int"},{name:"ChemoStatCnt",type:"int"},{name:"PcaStatCnt",type:"int"},{name:"DrugStatCnt",type:"int"},{name:"BIStatCnt",type:"int"}],hasMany:[{associatedName:"Orders",associationKey:"Orders",model:"NisTRApp.model.Management.ActiveOrds",foreignKey:"Orders",name:"Orders"},{associationKey:"Orders",model:"NisTRApp.model.Management.ActiveOrd",foreignKey:"Orders",name:"orders"}]}});Ext.define("NisTRApp.model.PrintLocation",{extend:Ext.data.Model,config:{fields:[{name:"id",type:"string"},{name:"station",type:"string"}]}});Ext.define("NisTRApp.model.ORD.DruglogEntity",{extend:Ext.data.Model,config:{fields:[{name:"LogID",type:"int"},{name:"ExeDate",type:"string"},{name:"ExeTime",type:"string"},{name:"Remark",type:"string"},{name:"Ischeck",type:"string"},{name:"TimeBlock",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"FreqTimeShift",type:"int"},{name:"ShiftUser",type:"string"},{name:"SignSeq",type:"string"},{name:"SeqList",type:"string"},{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"int"},{name:"InpNO",type:"string"},{name:"SeqNO",type:"int"},{name:"OrddRid",type:"string"},{name:"UserID",type:"string"},{name:"UserName",type:"string"},{name:"XordNo",type:"string"},{name:"DblchkDate",type:"string"},{name:"DblchkTime",type:"string"},{name:"DblchkId",type:"string"},{name:"DblchkName",type:"string"}],hasMany:{associatedName:"Notes",associationKey:"Notes",model:"NisTRApp.model.Note.WdisprognoteEntity",name:"Notes"}}});Ext.define("NisTRApp.model.mNurScheduleEntity",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo"},{name:"ChartSeq"},{name:"InpNo"},{name:"ScheDate"},{name:"ScheTime"},{name:"ScheTimeSlot"},{name:"ScheName"},{name:"ScheArea"},{name:"ScheMemo"},{name:"OrddRid"},{name:"CodeNo"},{name:"Accessnum"},{name:"MajorClass"},{name:"MinorClass"},{name:"OpenRecordID"}]}});Ext.define("NisTRApp.model.Form.OpenRecords",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"InpNo",type:"string"},{name:"Count",type:"int"}],hasMany:[{associatedName:"Records",associationKey:"Records",model:"NisTRApp.model.Form.OpenRecords",foreignKey:"Records",name:"Records"},{associationKey:"Records",primaryKey:"OpenRecordID",model:"NisTRApp.model.Form.OpenRecord",name:"records"}]}});Ext.define("NisTRApp.model.EMR.FormRecord",{extend:Ext.data.Model,config:{fields:[{name:"MasterID",type:"string"},{name:"InpNO",type:"string"},{name:"UserID",type:"string"},{name:"FunctionType",type:"string"},{name:"Title",type:"string"},{name:"SubTitle",type:"string"},{name:"Html",type:"string"},{name:"Finished",type:"string"},{name:"Flag",type:"string"},{name:"Discontinue",type:"string"},{name:"MedicalDate",type:"string"},{name:"SignatureDate",type:"string"},{name:"DiscontinueDate",type:"string"},{name:"PatName",type:"string"},{name:"ChartNo",type:"string"},{convert:function(b,d){var a="";switch(d.data.FunctionType){case"Assessment":a="護理評估";break;case"Problem":a="護理問題";break;case"Notes":a="護理記錄";break;case"Consult":a="照會作業";break;case"Teach":a="衛教指導";break;default:a=""}return a},name:"FunctionTypeName"},{name:"UserName",type:"string"}]}});Ext.define("NisTRApp.model.Form.mNursingNotesHistory",{extend:Ext.data.Model,config:{fields:[{name:"MainMasterID",type:"string"},{name:"Version",type:"int"},{name:"CreateDate",type:"auto"},{name:"Cause",type:"string"},{name:"Plan",type:"string"},{name:"Tech",type:"string"},{name:"Title",type:"string"},{name:"MedicalDate",type:"string"},{name:"UserName",type:"string"}],hasMany:{associatedName:"Notes",associationKey:"Notes",primaryKey:"NotesID",model:"NisTRApp.model.Form.NursingNotes",name:"Notes"}}});Ext.define("NisTRApp.model.Form.PrepareNewList",{extend:Ext.data.Model,config:{idProperty:"KeyOne",fields:[{name:"PexeDate"},{name:"CodeName"},{name:"Type"},{name:"FormID"},{name:"SubTitleForPrepare"},{name:"RefID",type:"int"},{name:"Source",type:"string"},{name:"IsSelect",type:"string"},{convert:function(a,b){return b.data.Source+b.data.RefID},name:"KeyOne",type:"string"},{name:"IsBind",type:"boolean"},{convert:function(a,b){return b.data.FormID},name:"formID",type:"string"}]}});Ext.define("NisTRApp.model.Form.PrepareOpenRecord",{extend:Ext.data.Model,config:{fields:[{name:"OpenRecordID",type:"string"},{name:"ChartNo",type:"string"},{name:"InpNo",type:"string"},{name:"FunctionType",type:"auto"},{name:"CategoryID",type:"string"},{name:"FormID",type:"string"},{name:"Title",type:"string"},{name:"SubTitle",type:"string"},{name:"Discontinue",type:"boolean"},{name:"DiscontinueDate",type:"auto"},{name:"StartDate",type:"auto"},{name:"PlanLatestDate",type:"auto"},{name:"SignatureDate",type:"auto"},{name:"PatientSignature",type:"string"},{name:"DiscontinueUserID",type:"string"},{name:"StartDateFormat",type:"string"},{name:"FinalConfirm",type:"boolean"},{name:"FinalConfirmUserName",type:"string"},{name:"FinalConfirmDate",type:"auto"},{name:"PrepareTitle",type:"string"},{name:"PrepareSource",type:"string"},{name:"PrepareRefID",type:"int"}]}});Ext.define("NisTRApp.model.Sys.SysdrugnbEntity",{extend:Ext.data.Model,config:{fields:[{name:"NBCode",type:"string"},{name:"Dscr",type:"string"}]}});Ext.define("NisTRApp.model.Sys.SysstdEntity",{extend:Ext.data.Model,config:{fields:[{name:"DefOPayFlag"},{name:"DefIPayFlag"},{name:"ICCodeKind"},{name:"RateType"},{name:"Rate",type:"int"},{name:"EmrexeFlag"},{name:"DrugPrn"},{name:"PharmPrn"},{name:"MolUnit"},{name:"MolBaseDose",type:"int"},{name:"ExecDept"},{name:"OrdopdLink"},{name:"CodeNO"},{name:"DateB"},{name:"DateE"},{name:"EasyNO"},{name:"CodeKind"},{name:"CodeType"},{name:"MajorClass"},{name:"MinorClass"},{name:"NhiCode"},{name:"AccCode",type:"int"},{name:"NhiGroup",type:"int"},{name:"ProdUnit"},{name:"ProcCode"},{name:"StockCode"},{name:"StockConvert",type:"string"},{name:"DrugCode"},{name:"MatCode"},{name:"CodeName"},{name:"DrugName"},{name:"Frequency"},{name:"BaseDose",type:"int"},{name:"ChargeUnit"},{name:"DoseUnit"},{name:"CostPrice",type:"int"},{name:"Route"},{name:"Remarks"},{name:"Automachine"},{name:"SetCode"},{name:"LimitQtyO",type:"int"},{name:"LimitQityI",type:"int"},{name:"LimitDayO",type:"int"},{name:"LimitDayI",type:"int"},{name:"LimitDose",type:"int"},{name:"Anestaetice"},{name:"Antibiotic"},{name:"FlgSpcO"},{name:"FlgSpcI"},{name:"FlgRepO"},{name:"FlgRepI"},{name:"FlgOtherO"},{name:"FlgOtherI"},{name:"FlgNotO"},{name:"FlgNotI"},{name:"FlgTrmO"},{name:"FlgTrmI"},{name:"FlgDiscount"},{name:"StopFlag"},{name:"RsnStop"},{name:"FlgBcc"},{name:"NhiPrice",type:"int"},{name:"StdPrice",type:"int"},{name:"HppPrice",type:"int"},{name:"AddonSpd",type:"int"},{name:"EmrRate",type:"int"},{name:"KidRate",type:"int"},{name:"NBRate",type:"int"},{name:"ArrivalRate",type:"int"},{name:"MatRate",type:"int"},{name:"SpmatRate",type:"int"},{name:"SpmatAccno",type:"int"},{name:"TreatCode"},{name:"UserID"},{name:"ProcDate"},{name:"ProcTime"},{name:"RepeatFlag"},{name:"RestrictFlag"},{name:"RestrictTerms"},{name:"RestrictQty",type:"int"},{name:"ConsignFlag"},{name:"AnestaeticeFlag"},{name:"NhiExplain"},{name:"ExternFlag",type:"string"},{name:"LinitDay",type:"int"},{name:"MsgType",type:"string"},{name:"OPCode",type:"string"},{name:"NhiName",type:"string"},{name:"ExeFlag",type:"string"},{name:"FlgEmr",type:"string"},{name:"Chemo",type:"string"},{convert:function(b,d){var a="http://go.kfcc.intra/UD/Drug/"+d.data.CodeNO+".jpg";return a},name:"ImgUrl",type:"string"},{name:"FallRisk",type:"string"}],hasMany:{associatedName:"NBItems",associationKey:"NBItems",model:"NisTRApp.model.Sys.SysdrugnbEntity",name:"NBItems"}}});Ext.define("NisTRApp.model.Form.PrepareHistory",{extend:Ext.data.Model,config:{fields:[{name:"Title",type:"string"},{name:"SubTitle",type:"string"},{name:"MedicalDate"},{name:"UserName",type:"string"},{name:"Html",type:"string"}]}});Ext.define("NisTRApp.model.Sys.SystreatdEntity",{extend:Ext.data.Model,config:{fields:[{name:"TRCode",type:"string"},{name:"CodeNO",type:"string"},{name:"TprFlag",type:"string"},{name:"DefTotQty",type:"int"},{name:"NeedInput",type:"string"},{name:"IcuCharge",type:"string"},{name:"TRCodeNAME"},{name:"CodeName",type:"string"},{name:"TransToDrugName",type:"string"}]}});Ext.define("NisTRApp.model.Sys.SystprEntity",{extend:Ext.data.Model,config:{fields:[{name:"TprCode",type:"string"},{name:"TprName",type:"string"},{name:"TprMajor",type:"string"},{name:"TprUnit",type:"string"},{name:"TprType",type:"string"},{name:"TprSeq",type:"int"},{name:"DefFlag",type:"string"},{name:"IcuFlag",type:"string"},{name:"SelfExpand",type:"string"},{name:"Phrase",type:"string"},{name:"EasySeq",type:"int"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"UserID",type:"string"},{name:"Explain",type:"string"},{name:"PhraseList",type:"auto"}]}});Ext.define("NisTRApp.model.Sys.SystreatmEntity",{extend:Ext.data.Model,config:{fields:[{name:"Frequency",type:"string"},{name:"TRCode",type:"string"},{name:"DateB",type:"string"},{name:"DateE",type:"string"},{name:"TRType",type:"string"},{name:"TRName",type:"string"},{name:"OPFreq",type:"string"},{name:"Remark",type:"string"},{name:"StopFlag",type:"string"},{name:"OrdPrivs",type:"string"},{name:"RefFreq",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"UserID",type:"string"},{name:"NhiExplain",type:"string"}]}});Ext.define("NisTRApp.model.VitalSigns.TimesDisplayInfo",{extend:Ext.data.Model,config:{fields:[{name:"StringValue",type:"string"},{name:"YYYY",type:"string"},{name:"MM",type:"string"},{name:"DD",type:"string"},{name:"HH",type:"string"},{name:"MI",type:"string"},{name:"SS",type:"string"},{name:"StringValues",type:"auto"},{name:"time",type:"auto"},{name:"DayOfWeek",type:"auto"},{convert:function(a,b){switch(b.data.DayOfWeek){case (0):return"日";case (1):return"一";case (2):return"二";case (3):return"三";case (4):return"四";case (5):return"五";case (6):return"六"}},name:"DayOfWeekStr",type:"string"}]}});Ext.define("NisTRApp.model.VitalSigns.TprDailyData",{extend:Ext.data.Model,config:{fields:[{name:"TprType"},{name:"TprMajor",type:"int"},{name:"TypeMajorName"},{name:"Name"},{name:"GrpSeq"},{name:"TprSeq",type:"int"},{name:"TprUnit"},{name:"TprCode"},{name:"Phrase"},{name:"Daily",type:"string"},{name:"HH"},{name:"MI"},{convert:function(a,b){return(b.data.Name=="Hourly"||b.data.Name=="Grand Total"||b.data.Name=="Intake"||b.data.Name=="Output"||b.data.Name=="Balance"||b.data.Name=="Hourly Total")},name:"IsClcItem",type:"boolean"}],hasMany:{associatedName:"infos",associationKey:"infos",model:"NisTRApp.model.VitalSigns.TimesDisplayInfo",name:"infos"}}});Ext.define("NisTRApp.model.VitalSigns.TprWeeklyData",{extend:Ext.data.Model,config:{fields:[{name:"MajorType",type:"auto"},{name:"MajorTypeName",type:"string"},{name:"Name",type:"string"},{name:"GrpSeq",type:"string"},{name:"TprSeq",type:"int"}],hasMany:{associationKey:"infos",model:"NisTRApp.model.VitalSigns.TimesDisplayInfo",name:"infos"}}});Ext.define("NisTRApp.model.VitalSigns.OptionTprItem",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"InpNo",type:"string"},{name:"TprCode",type:"string"},{name:"TprType",type:"string"},{name:"TprMajor",type:"string"},{name:"TprName",type:"string"},{name:"TprSeq",type:"string"},{name:"TprUnit",type:"string"},{name:"GrpSeq",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"OrddRid",type:"string"},{name:"SelfCode",type:"string"},{name:"Phrase",type:"string"},{name:"IcuFlag",type:"string"},{name:"DefFlag",type:"string"},{name:"TprMajorName1",type:"string"},{name:"CodeName",type:"string"},{name:"GrpNo",type:"string"},{name:"SelfExpand",type:"string"},{convert:function(b,d){var a="";switch(d.data.TprMajorName1){case"In":a="Intake";break;case"IV":a="IntakeIV";break;case"Mon":a="Monitor";break;case"Out":a="Output";break;default:break}return a},name:"TprMajorStr"}]}});Ext.define("NisTRApp.model.Ipo.IpomonitorEntity",{extend:Ext.data.Model,config:{fields:[{name:"MonitorID",type:"int"},{name:"InpNO",type:"string"},{name:"TprMajor",type:"string"},{name:"TprCode",type:"string"},{name:"TprName",type:"string"},{name:"SelfCode",type:"string"},{name:"OrddRid",type:"string"},{name:"SeqNO",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"BegUser",type:"string"},{name:"EndDate",type:"string"},{name:"EndTime",type:"string"},{name:"EndUser",type:"string"},{name:"TprSeq",type:"string"},{name:"SelfExpand",type:"string"},{convert:function(b,d){var a="";switch(d.data.TprMajor){case"I":a="Intake";break;case"IV":a="IntakeIV";break;case"M":a="Monitor";break;case"O":a="Output";break}return a},name:"TprMajorStr",type:"string"}]}});Ext.define("NisTRApp.model.Sys.SysparamEntity",{extend:Ext.data.Model,config:{fields:[{name:"SeqNO",type:"int"},{name:"ParSys",type:"string"},{name:"ParClass",type:"string"},{name:"ParID",type:"string"},{name:"ParValue",type:"string"},{name:"ParDesc",type:"string"},{name:"ISValid",type:"string"},{name:"RefFlag",type:"string"}]}});Ext.define("NisTRApp.model.Form.UnsignedFormPatData",{extend:Ext.data.Model,config:{fields:[{name:"PatName",type:"string"},{name:"ChartNo",type:"string"},{name:"InpNo",type:"string"},{name:"Cnt",type:"int"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return b.data.InpNo},name:"InpNO",type:"string"}]}});Ext.define("NisTRApp.model.EMR.UnsignedExcutionRecord",{extend:Ext.data.Model,config:{fields:[{name:"SHT_ID",type:"string"},{name:"PAR_VALUE",type:"string"},{name:"FULLTEXT",type:"string"},{name:"LOG_ID",type:"string"},{name:"NAME",type:"string"},{name:"ROW_ID",type:"string"},{name:"ORDD_RID",type:"string"},{name:"CODE_NO",type:"string"},{name:"USER_ID",type:"string"},{name:"ORDER_NAME",type:"string"},{name:"REMARK",type:"string"},{name:"ORDD_TXT",type:"string"},{name:"CHART_SEQ",type:"int"},{name:"DATE_TIME",type:"string"},{name:"STATUS",type:"string"},{name:"TYPE_NAME",type:"string"},{name:"TYPE",type:"string"},{name:"SEQ_NO",type:"string"},{name:"CONTENT_AT",type:"string"},{name:"AT_DATETIME",type:"string"},{name:"CHART_NO",type:"string"},{name:"PAT_NAME",type:"string"},{name:"INP_NO",type:"string"},{name:"USER_NAME",type:"string"},{convert:function(b,d){var a="";if(d.data.NAME=="NOTE"){a=d.data.CONTENT_AT}else{a=d.data.REMARK}return a},name:"ContentStr"},{convert:function(b,d){var a="";if(d.data.NAME=="NOTE"){a=d.data.AT_DATETIME}else{a=d.data.DATE_TIME}return a},name:"ContentDateTime"}]}});Ext.define("NisTRApp.model.EMR.UnFinailPrepareFrmData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNo",type:"string"},{name:"PatName",type:"string"},{name:"OutDate",type:"string"},{name:"Record",type:"string"},{name:"PrepareDate",type:"string"},{name:"NowBedNo",type:"string"},{name:"NowStationNo",type:"string"},{name:"Type",type:"int"},{name:"InpNo",type:"string"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return SYS_CONST.PatSource.INP},name:"Source",type:"auto"},{convert:function(a,b){return b.data.InpNo},name:"InpNO",type:"string"}]}});Ext.define("NisTRApp.model.Nur.NurrefEntity",{extend:Ext.data.Model,config:{fields:[{name:"NurrefId",type:"int"},{name:"ValidFlag",type:"string"},{name:"NurMajor",type:"string"},{name:"NurMinor",type:"string"},{name:"MinorName",type:"string"},{name:"ItemValue",type:"auto"},{name:"ItemName",type:"string"},{name:"ItemID",type:"int"},{convert:function(a,b){return parseInt(b.data.NurMinor)},name:"NurMinorInt",type:"int"}]}});Ext.define("NisTRApp.model.Patient.DrugLogData",{extend:Ext.data.Model,config:{fields:[{name:"RowId",type:"string"},{name:"OrddRid",type:"string"},{name:"SeqNo",type:"int"},{name:"CodeNo",type:"string"},{name:"MajorClass",type:"string"},{name:"OrddTxt",type:"string"},{name:"UserName",type:"string"},{name:"Remark",type:"string"},{name:"OrderName",type:"string"},{name:"DateTime",type:"string"},{name:"Status",type:"string"},{name:"SignSeq",type:"int"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"SeqList",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"OrderDate",type:"string"},{name:"OrderTime",type:"string"},{name:"PexeDate",type:"string"},{name:"PexeTime",type:"string"},{name:"ContentAt",type:"string"},{name:"OrddHtml",type:"string"},{name:"Record",type:"string"},{name:"DcDateStr",type:"string"},{name:"OpenDateStr",type:"string"},{name:"Type",type:"string"}]}});Ext.define("NisTRApp.model.Patient.DrugLogGroup",{extend:Ext.data.Model,config:{fields:[{name:"OrddRid",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"OrderName",type:"string"},{name:"OrderType",type:"string"},{name:"OrddTxt",type:"string"},{name:"DcDateTime",type:"string"},{name:"DcDateStr",type:"string"},{name:"ReceverDateTime",type:"string"},{name:"ReceverDateStr",type:"string"},{name:"OrddHtml",type:"string"},{name:"AplDateStr",type:"string"},{name:"Chemo",type:"string"}],hasMany:{associationKey:"DrugLogDatas",model:"NisTRApp.model.Patient.DrugLogData",name:"DrugLogDatas"}}});Ext.define("NisTRApp.model.mUserConfig",{extend:Ext.data.Model,config:{idProperty:"KeyOne",fields:[{convert:function(a,b){return b.data.UserID+"_"+b.data.Group+"_"+b.data.SettingName},name:"KeyOne",type:"string"},{name:"UserID",type:"string"},{name:"Group",type:"string"},{name:"SettingName",type:"string"},{name:"Value",type:"string"}]}});Ext.define("NisTRApp.model.RIS.SchuleData",{extend:Ext.data.Model,config:{fields:[{name:"PreExamDate",type:"string"},{name:"PreExamTime",type:"string"},{name:"ChartNO",type:"string"},{name:"PatIdno",type:"string"},{name:"Sex",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"ChartExpire"},{name:"PreExamNoon",type:"string"},{name:"ReqNO",type:"string"},{name:"ItemNO",type:"string"},{name:"ManualNO",type:"string"},{name:"ExamCName",type:"string"},{name:"ExamEName",type:"string"},{name:"PatSource",type:"int"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.ReqNO+"_"+b.data.ItemNO},name:"KeyOne",type:"string"},{convert:function(a,b){return b.data.Sex+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")},name:"SexStr",type:"string"},{name:"ChartSeq",type:"int"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{name:"InpNO",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"},{convert:function(a,b){if((b.data.PatSource==1)&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return SYS_CONST.PatSource.OPD}else{if(b.data.PatSource==3&&!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}}if((b.data.PatSource==2)&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return SYS_CONST.PatSource.OPD}else{if(!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{return SYS_CONST.PatSource.OPD}}},name:"Source",type:"auto"},{name:"Age",type:"int"},{name:"ExamStatus",type:"int"},{convert:function(a,b){if((b.data.ExamStatus>=40)||(!Ext.isEmpty(b.data.ClosedDate))){return"Silver"}return"Black"},name:"StyleColor",type:"string"},{convert:function(a,b){return"Black"},name:"CareStyleColor",type:"string"},{convert:function(a,b){return SYS_CONST.FunctionType.RIS},name:"SysFunctionType"},{convert:function(a,b){switch(b.data.ExamStatus){case 0:return"未報到";break;case 10:return"未報到";break;case 20:return"未報到";break;case 30:return"已報到";break;case 35:return"檢查中";break;case 37:return"待check";break;case 40:return"檢查完成";break;case 45:return"第一張影像完成";break;case 55:return"已完成錄音";break;case 65:return"已完成聽打";break;case 75:return"已完成初步報告";break;case 82:return"待簽";break;case 85:return"已完成正式報告";break;default:if(b.data.ExamStatus<30){return"未報到"}else{if(b.data.ExamStatus==30){return"已報到"}else{if(b.data.ExamStatus>30&&b.data.ExamStatus<40){return"檢查中"}else{if(b.data.ExamStatus>=40){return"檢查完成"}else{return"Error"}}}}}},name:"ExamStatusName",type:"string"},{name:"HasPortA",type:"string"},{convert:function(a,b){if(String.IsNull(b.data.HasPortA)){return SYS_CONST.ImgRoot+"empty.png"}else{return SYS_CONST.ImgRoot+"pipe.png"}},name:"HasPortAImgSrc",type:"string"},{name:"LabC",type:"string"},{name:"LabH",type:"string"},{name:"LabU",type:"string"},{name:"PreExamRoomName",type:"string"},{name:"PreExamQueue",type:"string"},{name:"ObservedFlag",type:"string"},{name:"ClosedDate",type:"string"},{name:"ClosedTime",type:"string"},{name:"ClosedReason",type:"string"},{name:"ClosedUserID",type:"string"},{name:"CareFlag",type:"string"},{name:"AnestFlag",type:"string"},{convert:function(a,b){if((b.data.PatSource==1)&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return SYS_CONST.PatSource.OPD}else{if(b.data.PatSource==3&&!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}}if((b.data.PatSource==2)&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return SYS_CONST.PatSource.PHE}else{if(!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{return SYS_CONST.PatSource.OPD}}},name:"PatSourceName",type:"string"},{convert:function(a,b){if((b.data.PatSource==2)&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return true}else{return false}},name:"IsPHE",type:"boolean"},{name:"NowBedNo",type:"string"},{name:"RealExamDrUserName",type:"string"},{name:"MyPatUserID",type:"string"},{name:"CancelFlag",type:"string"},{convert:function(a,b){if(b.data.CancelFlag=="Y"){return"排程取消"}else{return""}},name:"CancelFlagName",type:"string"},{convert:function(a,b){if(b.data.CancelFlag=="Y"){return"red"}return"Black"},name:"CancelColor",type:"string"}]}});Ext.define("NisTRApp.model.Ris.RisLabSchData",{extend:Ext.data.Model,config:{fields:[{name:"Reqdate",type:"string"},{name:"Reqno",type:"string"},{name:"Itemno",type:"string"},{name:"Patid",type:"string"},{name:"Patidno",type:"string"},{name:"Patcname",type:"string"},{name:"Manualno",type:"string"},{name:"Billdate",type:"string"},{name:"Reqdoctid",type:"string"},{name:"Reqdoctcname",type:"string"},{name:"Examid",type:"string"},{name:"Examcname",type:"string"},{name:"Examstatus",type:"string"},{name:"Scheduleflag",type:"string"},{name:"Cancelflag",type:"string"},{name:"Preexamqueue",type:"string"},{name:"Preexamroom",type:"string"},{name:"Scheduleuserid",type:"string"},{name:"Schedulestxdate",type:"string"},{name:"Schedulestxtime",type:"string"},{name:"Scheduletxdate",type:"string"},{name:"Scheduletxtime",type:"string"},{name:"Preexamdate",type:"string"},{name:"Preexamtime",type:"string"},{name:"Realexamtxdate",type:"string"},{name:"Realexamtxdateend",type:"string"},{convert:function(a,b){return b.data.Patid+"_"+b.data.Reqno+"_"+b.data.Itemno},name:"KeyOne",type:"string"},{convert:function(a,b){return"RIS"},name:"ExamType",type:"string"},{convert:function(a,b){return b.data.Reqno+"_"+b.data.Itemno},name:"FrmKey",type:"string"},{convert:function(a,b){return"RIS_SCH"},name:"FrmCode",type:"string"},{name:"RemarkCnt",type:"int"}]}});Ext.define("NisTRApp.model.RIS.ContactData",{extend:Ext.data.Model,config:{fields:[{name:"TelHome",type:"string"},{name:"TelOffice",type:"string"},{name:"TelMobile",type:"string"},{name:"ContactTime1",type:"string"},{name:"ContactTime2",type:"string"},{name:"ContactTimeOthers",type:"string"},{name:"HppFlag",type:"string"},{name:"ContacterPatient",type:"string"},{name:"ContacterFamily",type:"string"},{name:"ContacterFamilyRelationship",type:"string"},{name:"ContacterFriend",type:"string"},{name:"ContacterFriendName",type:"string"},{name:"ContactYes",type:"string"},{name:"ContactNo",type:"string"},{name:"ContactOther",type:"string"},{name:"CreUserID",type:"string"},{name:"CreUserName",type:"string"},{name:"CreDateTime",type:"string"},{name:"ReqNO",type:"string"},{name:"ItemNO",type:"string"}]}});Ext.define("NisTRApp.model.ENDO.SchuleData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"PatIdno",type:"string"},{name:"Sex",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"ChartExpire"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.GroupID},name:"KeyOne",type:"string"},{convert:function(a,b){return b.data.Sex+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")},name:"SexStr",type:"string"},{name:"ChartSeq",type:"int"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{name:"InpNO",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"},{name:"Age",type:"int"},{convert:function(a,b){return SYS_CONST.FunctionType.ENDO},name:"SysFunctionType"},{name:"HasPortA",type:"string"},{convert:function(a,b){if(String.IsNull(b.data.HasPortA)){return SYS_CONST.ImgRoot+"empty.png"}else{return SYS_CONST.ImgRoot+"pipe.png"}},name:"HasPortAImgSrc",type:"string"},{name:"AnFlag",type:"string"},{name:"AccNO",type:"string"},{name:"IpDate",type:"string"},{name:"IpTime",type:"string"},{name:"PatNO",type:"string"},{name:"PatID",type:"string"},{name:"IpWaycd",type:"string"},{name:"IpWaynm",type:"string"},{name:"IpDptID",type:"string"},{name:"IpDpt",type:"string"},{name:"ItmName",type:"string"},{name:"PatStatus",type:"string"},{name:"SchedSw",type:"string"},{name:"SchedDate",type:"string"},{name:"SchedTime",type:"string"},{name:"SchdUser",type:"string"},{name:"PlnUser",type:"string"},{name:"AccSw",type:"string"},{name:"AccDate",type:"string"},{name:"AccTime",type:"string"},{name:"AccMan",type:"string"},{name:"CkMan",type:"string"},{name:"PrepareSw",type:"string"},{name:"PrepareDate",type:"string"},{name:"PrepareTime",type:"string"},{name:"PrepareUser",type:"string"},{name:"ExamFlag",type:"string"},{name:"ExamstartDate",type:"string"},{name:"ExamstartTime",type:"string"},{name:"ExamFloor",type:"string"},{name:"ExamRoom",type:"string"},{name:"ExamendDate",type:"string"},{name:"ExamendTime",type:"string"},{name:"AnFinalFlag",type:"string"},{name:"RptFlag",type:"string"},{name:"RptDate",type:"string"},{name:"RptTime",type:"string"},{name:"RtpMan",type:"string"},{name:"RecoverFlag",type:"string"},{name:"RecoverDate",type:"string"},{name:"RecoverTime",type:"string"},{name:"RecoverUser",type:"string"},{name:"FinishFlag",type:"string"},{name:"FinishDate",type:"string"},{name:"FinishTime",type:"string"},{name:"FinishUser",type:"string"},{name:"FinishReason",type:"string"},{name:"AccManName",type:"string"},{name:"SchdUserName",type:"string"},{convert:function(a,b){if((b.data.IpWaycd=="O"||b.data.IpWaycd=="E"||b.data.IpWaycd=="L")&&!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{if((b.data.IpWaycd=="I"||b.data.IpWaycd=="E")&&!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{if((b.data.IpWaycd=="O"||b.data.IpWaycd=="H")&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return SYS_CONST.PatSource.OPD}else{if(!Ext.isEmpty(b.data.InpNO)){return SYS_CONST.PatSource.INP}else{return SYS_CONST.PatSource.OPD}}}}},name:"Source"},{convert:function(a,b){if((b.data.IpWaynm=="H")&&b.data.ChartSeq!=null&&b.data.ChartSeq>0){return true}else{return false}},name:"IsPHE",type:"boolean"},{name:"NeedObservedFlag",type:"string"},{name:"LabC",type:"string"},{name:"LabH",type:"string"},{name:"LabU",type:"string"},{name:"NeedObservedUserID",type:"string"},{name:"IdcFlags",type:"string"},{name:"ObservedFloor",type:"string"},{name:"ObservedRoom",type:"string"},{name:"ObservedInDate",type:"string"},{name:"ObservedInTime",type:"string"},{name:"ObservedOutDate",type:"string"},{name:"ObservedOutTime",type:"string"},{name:"GroupID",type:"int"},{name:"ItmName1",type:"string"},{name:"ItmName2",type:"string"},{name:"ItmName3",type:"string"},{name:"BedNO",type:"string"},{name:"LeaveReason",type:"string"},{name:"LeaveDate",type:"string"},{name:"LeaveTime",type:"string"},{name:"LeaveUserID",type:"string"},{name:"MyPatUserID",type:"string"},{name:"CareFlag",type:"string"},{convert:function(a,b){if(!Ext.isEmpty(b.data.RejectFlag)&&b.data.RejectFlag=="Y"){return"Silver"}else{if(!Ext.isEmpty(b.data.FinishDate)){return"Silver"}else{return"Black"}}},name:"StyleColor",type:"string"},{name:"CaFlag",type:"string"},{name:"WkFinishedDate",type:"string"},{name:"WkFinishedTime",type:"string"},{name:"WkFinishedUserID",type:"string"},{name:"RejectFlag",type:"string"},{name:"RejectReason",type:"string"},{name:"RejectUserID",type:"string"},{convert:function(a,b){if(!Ext.isEmpty(b.data.RejectFlag)&&b.data.RejectFlag=="Y"){return"F"}else{if(!Ext.isEmpty(b.data.FinishDate)){return"F"}else{if(!Ext.isEmpty(b.data.ObservedInDate)){return"O"}else{if(!Ext.isEmpty(b.data.RecoverDate)){return"R"}else{if(!Ext.isEmpty(b.data.ExamendDate)){return"ES"}else{if(!Ext.isEmpty(b.data.ExamstartDate)){return"ES"}else{if(!Ext.isEmpty(b.data.PrepareDate)){return"P"}else{if(!Ext.isEmpty(b.data.AccDate)){return"A"}else{return"NA"}}}}}}}}},name:"ExamStatusFlag",type:"string"},{convert:function(a,b){if(!Ext.isEmpty(b.data.RejectFlag)&&b.data.RejectFlag=="Y"){return"病人未作"}else{if(!Ext.isEmpty(b.data.FinishDate)){return"病人離開"}else{if(!Ext.isEmpty(b.data.ObservedInDate)){return"恢復中"}else{if(!Ext.isEmpty(b.data.RecoverDate)){return"恢復中"}else{if(!Ext.isEmpty(b.data.ExamendDate)){return"檢查中"}else{if(!Ext.isEmpty(b.data.ExamstartDate)){return"檢查中"}else{if(!Ext.isEmpty(b.data.PrepareDate)){return"準備中"}else{if(!Ext.isEmpty(b.data.AccDate)){return"報到"}else{return"未報到"}}}}}}}}},name:"ExamStatusName",type:"string"},{name:"AMPM",type:"string"}]}});Ext.define("NisTRApp.model.ENDO.ContactData",{extend:Ext.data.Model,config:{fields:[{name:"TelHome",type:"string"},{name:"TelOffice",type:"string"},{name:"TelMobile",type:"string"},{name:"ContactTime1",type:"string"},{name:"ContactTime2",type:"string"},{name:"ContactTimeOthers",type:"string"},{name:"HppFlag",type:"string"},{name:"ContacterPatient",type:"string"},{name:"ContacterFamily",type:"string"},{name:"ContacterFamilyRelationship",type:"string"},{name:"ContacterFriend",type:"string"},{name:"ContacterFriendName",type:"string"},{name:"ContactYes",type:"string"},{name:"ContactNo",type:"string"},{name:"ContactOther",type:"string"},{name:"CreUserID",type:"string"},{name:"CreUserName",type:"string"},{name:"CreDateTime",type:"string"},{name:"GroupID",type:"int"},{name:"ContacterReason",type:"string"}]}});Ext.define("NisTRApp.model.IPB.mPatientData",{extend:Ext.data.Model,config:{fields:[{name:"NowDocNo1",type:"string"},{name:"NowDocNo2",type:"auto"},{name:"NowDocName",type:"string"},{name:"RiskFall",type:"string"},{name:"RiskBedSore",type:"string"},{name:"RiskCath",type:"string"},{name:"RiskDnr",type:"string"},{name:"NurFlag",type:"string"},{name:"RsName",type:"string"},{name:"NewOrdCnt",type:"int"},{name:"IsOverTime",type:"boolean"},{name:"IsNeedExeDrug",type:"boolean"},{name:"ChemoCount",type:"int"},{name:"NeedDrugCount",type:"int"},{name:"OverTimeCount",type:"int"},{name:"StatOrderCount",type:"int"},{name:"TotalOrderCount",type:"int"},{name:"Confirm"},{name:"StatusName",type:"string"},{name:"PatName",type:"string"},{name:"PatIdNo",type:"string"},{name:"Sex",type:"string"},{name:"Birthday",type:"string"},{name:"Age",type:"int"},{name:"InpNo"},{name:"InDate",type:"string"},{name:"OutDate",type:"string"},{name:"ChartNo",type:"string"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return b.data.InpNo},name:"InpNO",type:"string"},{name:"NowBedNo",type:"string"},{name:"NowStationNo",type:"string"},{convert:function(a,b){return b.data.Birthday.substr(0,4)+"-"+b.data.Birthday.substr(4,2)+"-"+b.data.Birthday.substr(6,2)},name:"BirthdayStr",type:"string"},{name:"BloodType",type:"string"},{name:"PCACount",type:"int"},{name:"PCAReason",type:"string"},{convert:function(a,b){return b.data.ChartNo+"_"+b.data.PatIdNo+"_"+b.data.InpNO},name:"KeyOne",type:"string"},{convert:function(a,b){return SYS_CONST.PatSource.INP},name:"Source"},{name:"ChartExpire",type:"string"},{convert:function(a,b){return b.data.Sex+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")},name:"SexStr",type:"string"},{convert:function(a,b){return b.data.PatIdNo},name:"PatIdno"},{convert:function(a,b){return""},name:"StyleColor",type:"string"},{convert:function(b,e){var a="";var d=e.data;if(d.NurFlag=="Y"){a="PaleGreen"}if(d.StatusName=="已結帳"){a="Crimson"}return a},name:"BgColor",type:"string"},{convert:function(a,d){var b="";if(d.data.StatusName=="已結帳"){b="已出院"}else{b=d.data.NowStationNo+"-"+d.data.NowBedNo}return b},name:"StationStr",type:"string"},{name:"CareFlag",type:"string"}]}});Ext.define("NisTRApp.model.IPB.mStationInfo",{extend:Ext.data.Model,config:{fields:[{name:"DeptCode"},{name:"ChemoCnt",type:"int"},{name:"NeedDrugCnt",type:"int"},{name:"NewOrdCnt",type:"int"},{name:"OverTimeCnt",type:"int"},{name:"PcaCnt",type:"int"},{name:"StatCnt",type:"int"}],hasMany:{associatedName:"Patients",associationKey:"Patients",model:"NisTRApp.model.IPB.mPatientData",name:"Patients"}}});Ext.define("NisTRApp.model.ENDO.HdhisexchangeEntity",{extend:Ext.data.Model,config:{fields:[{name:"OriginalCreTime",type:"string"},{name:"AccNO",type:"string"},{name:"OrdDate",type:"string"},{name:"OrdTime",type:"string"},{name:"Vip",type:"string"},{name:"ChartSeq",type:"string"},{name:"ChartNO",type:"string"},{name:"PatIdno",type:"string"},{name:"RequestID",type:"string"},{name:"RequestMan",type:"string"},{name:"Source",type:"string"},{name:"SourceName",type:"string"},{name:"Hdept",type:"string"},{name:"HdeptName",type:"string"},{name:"IcdhCode1",type:"string"},{name:"IcdhCode2",type:"string"},{name:"IcdhCode3",type:"string"},{name:"IdcFlags",type:"string"},{name:"EmrFlag",type:"string"},{name:"Remark",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"SchdDate",type:"string"},{name:"SchdTime",type:"string"}]}});Ext.define("NisTRApp.model.ENDO.EndohxsheetEntity",{extend:Ext.data.Model,config:{fields:[{name:"CreTime",type:"string"},{name:"AccNO",type:"string"},{name:"IpDate",type:"string"},{name:"IpTime",type:"string"},{name:"ChkNO",type:"string"},{name:"TrnNum",type:"string"},{name:"CurrentHcode",type:"string"},{name:"PatNO",type:"string"},{name:"PatID",type:"string"},{name:"PatName",type:"string"},{name:"InpNO",type:"string"},{name:"RefMan",type:"string"},{name:"RequestID",type:"string"},{name:"RequestMan",type:"string"},{name:"IpWaycd",type:"string"},{name:"IpWaynm",type:"string"},{name:"IpDptID",type:"string"},{name:"ItmNO",type:"string"},{name:"ItmName",type:"string"},{name:"ItmGroup",type:"string"},{name:"PatStatus",type:"string"},{name:"SchedSw",type:"string"},{name:"SchdDate",type:"string"},{name:"SchdTime",type:"string"},{name:"AnFlag",type:"string"},{name:"SchdUser",type:"string"},{name:"PlnUser",type:"string"},{name:"AccSw",type:"string"},{name:"AccDate",type:"string"},{name:"AccTime",type:"string"},{name:"AccMan",type:"string"},{name:"CkMan",type:"string"},{name:"PrepareDate",type:"string"},{name:"PrepareTime",type:"string"},{name:"PrepareUser",type:"string"},{name:"ExamFlag",type:"string"},{name:"ExamstartDate",type:"string"},{name:"ExamstartTime",type:"string"},{name:"ExamFloor",type:"string"},{name:"ExamRoom",type:"string"},{name:"ExamendDate",type:"string"},{name:"ExamendTime",type:"string"},{name:"AnFinalFlag",type:"string"},{name:"RptFlag",type:"string"},{name:"RptDate",type:"string"},{name:"RptTime",type:"string"},{name:"RtpMan",type:"string"},{name:"RecoverFlag",type:"string"},{name:"RecoverDate",type:"string"},{name:"RecoverTime",type:"string"},{name:"RecoverUser",type:"string"},{name:"FinishFlag",type:"string"},{name:"FinishDate",type:"string"},{name:"FinishTime",type:"string"},{name:"FinishUser",type:"string"},{name:"CaFlag",type:"string"},{name:"GroupID",type:"int"},{name:"IpDpt"},{convert:function(a,b){return b.data.CreTime},name:"KeyOne",type:"string"},{name:"AnFinalReason",type:"string"}]}});Ext.define("NisTRApp.model.Patient.Patient",{extend:Ext.data.Model,config:{fields:[{name:"IsMutiBlood",type:"boolean"},{name:"Dnr",type:"string"},{name:"ChartNo",type:"string"},{name:"Sex",type:"string"},{convert:function(a,b){return b.data.Birthday.substr(0,4)+"-"+b.data.Birthday.substr(4,2)+"-"+b.data.Birthday.substr(6,2)},name:"BirthdayStr",type:"string"},{name:"PatIdNo",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"Age",type:"int"},{name:"Risk",type:"string"},{name:"BloodType",type:"string"},{name:"IsAllergy",type:"boolean"},{name:"IcdType",type:"string"},{name:"Suicide",type:"string"},{name:"Allergy",type:"int"},{convert:function(a,b){return b.data.ChartNo},name:"ChartNO",type:"string"},{convert:function(a,b){return b.data.PatIdNo},name:"PatIdno",type:"string"},{name:"Org",type:"string"}]}});Ext.define("NisTRApp.model.OPR.AntimData",{extend:Ext.data.Model,config:{fields:[{name:"AntimID",type:"string"},{name:"OprmDate",type:"string"},{name:"ChartNO",type:"string"},{name:"OpCnt",type:"string"},{name:"DrCode",type:"string"},{dateFormat:"Y-m-d\\TH:i:s",name:"EnterDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"AnsDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"CloseDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"ReadyDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"ArrivalDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"StartDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"EndDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"CreateDateTime",type:"date"},{name:"CreateUser",type:"string"},{dateFormat:"Y-m-d\\TH:i:s",name:"AnsOkDateTime",type:"date"},{name:"SeqNO",type:"string"},{name:"OpPartFlag",type:"string"},{name:"DrSOpPart",type:"string"},{dateFormat:"Y-m-d\\TH:i:s",name:"InRecoveryDateTime",type:"date"},{dateFormat:"Y-m-d\\TH:i:s",name:"OutRecoveryDateTime",type:"date"},{name:"RecoveryAnsDr",type:"string"},{name:"UseAnti",type:"string"},{name:"IsDelay",type:"string"},{name:"NondelayRsn",type:"string"}]}});Ext.define("NisTRApp.model.Sys.RouteEntity",{extend:Ext.data.Model,config:{idProperty:"Route",fields:[{name:"Route",type:"string"},{name:"RouteRemark",type:"string"},{convert:function(a,b){return b.data.Route+" - "+b.data.RouteRemark},name:"DisplayField",type:"string"}]}});Ext.define("NisTRApp.model.Sys.FreqEntity",{extend:Ext.data.Model,config:{idProperty:"FreqCode",fields:[{name:"FreqCode",type:"string"},{name:"FreqDesc",type:"string"},{convert:function(a,b){return b.data.FreqCode+" - "+b.data.FreqDesc},name:"DisplayField",type:"string"}]}});Ext.define("NisTRApp.model.OPR.OprantidEntity",{extend:Ext.data.Model,config:{fields:[{name:"AntidID",type:"string"},{name:"OprmDate",type:"string"},{name:"ChartNO",type:"string"},{name:"OpCnt",type:"string"},{name:"DrCode",type:"string"},{name:"SeqNO",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"NhiCode",type:"string"},{name:"CodeMainseq",type:"int"},{name:"CodeSubseq",type:"int"},{name:"Dose",type:"int"},{name:"Frequency",type:"string"},{name:"Route",type:"string"},{name:"Unit",type:"string"},{name:"AccCode",type:"string"},{name:"CodeType",type:"string"},{name:"ExeDate",type:"string"},{name:"ExeTime",type:"string"}]}});Ext.define("NisTRApp.model.OPR.AntidTempData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"InpNO",type:"string"},{name:"OpWhen",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"Frequency",type:"string"},{name:"Route",type:"string"},{name:"ExeDate",type:"string"},{name:"ExeTime",type:"string"},{name:"ProcName",type:"string"}]}});Ext.define("NisTRApp.model.Sys.SyscatypeEntity",{extend:Ext.data.Model,config:{fields:[{name:"CaID",type:"string"},{name:"CaRegex",type:"string"},{name:"CaName",type:"string"},{name:"DefaultClassification",type:"string"}]}});Ext.define("NisTRApp.model.CMS.CmsdatmData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"PatIdno",type:"string"},{name:"Sex",type:"string"},{name:"PatName",type:"string"},{name:"Birthday",type:"string"},{name:"ChartExpire"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.Cancer+"_"+b.data.CmsID},name:"KeyOne",type:"string"},{convert:function(a,b){return b.data.Sex+((!String.IsNull(b.data.ChartExpire)&&b.data.ChartExpire=="Y")?"Death":"")},name:"SexStr",type:"string"},{name:"ChartSeq",type:"int"},{convert:function(a,b){return b.data.ChartNO},name:"ChartNo",type:"string"},{name:"InpNO",type:"string"},{convert:function(a,b){return b.data.InpNO},name:"InpNo",type:"string"},{name:"Age",type:"int"},{convert:function(a,b){return SYS_CONST.FunctionType.CMS},name:"SysFunctionType"},{name:"HasPortA",type:"string"},{convert:function(a,b){if(String.IsNull(b.data.HasPortA)){return SYS_CONST.ImgRoot+"empty.png"}else{return SYS_CONST.ImgRoot+"pipe.png"}},name:"HasPortAImgSrc",type:"string"},{convert:function(a,b){return SYS_CONST.PatSource.CMS},name:"Source"},{convert:function(a,b){return false},name:"IsPHE",type:"boolean"},{name:"LabC",type:"string"},{name:"LabH",type:"string"},{name:"LabU",type:"string"},{convert:function(a,b){return"Black"},name:"StyleColor",type:"string"},{name:"CmsID",type:"string"},{name:"Cancer",type:"string"},{name:"CancerName",type:"string"},{name:"Seq",type:"int"},{name:"CmsFlag",type:"int"},{name:"Status",type:"int"},{name:"InDate",type:"string"},{name:"InUserID",type:"string"},{name:"InUserName",type:"string"},{name:"PatKind",type:"int"},{name:"InTreat",type:"string"},{name:"FirstContactDate",type:"string"},{name:"FirstDiagDateK",type:"string"},{name:"FirstDiagDate",type:"string"},{name:"DiagWay",type:"string"},{name:"ClinicalStage",type:"string"},{name:"VisitH",type:"string"},{name:"VisitHCode",type:"string"},{name:"ProcessWay",type:"string"},{name:"NotTxReason",type:"string"},{name:"NotTxReasonTxt",type:"string"},{name:"FirstTxDate",type:"string"},{name:"FirstTxKind",type:"string"},{name:"FirstTxKindTxt",type:"string"},{name:"PathoStage",type:"string"},{name:"CloseDate",type:"string"},{name:"CloseUserID",type:"string"},{name:"CloseReason",type:"string"},{name:"DeleteFlag",type:"string"},{name:"DeleteDate",type:"string"},{name:"DeleteTime",type:"string"},{name:"DeleteUserID",type:"string"},{name:"CmsSystem",type:"string"},{name:"CmsUserID",type:"string"},{name:"ConfirmH",type:"string"},{name:"ConfirmHCode",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"CreUserID",type:"string"},{name:"CmsUserName",type:"string"},{name:"CaClassification"},{name:"CloseRemark",type:"string"},{convert:function(a,b){},name:"CmsFlagName",type:"string"},{convert:function(b,d){var a="";if(d.data.CmsFlag=="1"){a="首發"}else{if(d.data.CmsFlag=="2"){a="復發"}else{a=""}}if(d.data.Status=="2"){a=a+" - 結案"}else{if(d.data.Status=="1"){if(!Ext.isEmpty(d.data.ProcessWay)){if(d.data.ProcessWay=="1"){a=a+" - 治療中"}else{if(d.data.ProcessWay=="6"){a=a+" - 追蹤中"}else{if(d.data.ProcessWay=="0"){a=a+" - 未治療"}else{return""}}}}}}if(d.data.Status=="2"){a='<span style="color:red;">'+a+"</span>"}else{a="<span>"+a+"</span>"}return a},name:"StatusName",type:"string"},{name:"TeamConsultDate",type:"string"},{name:"CStage",type:"string"},{name:"PStage",type:"string"},{name:"RStage",type:"string"},{name:"ConfirmHName",type:"string"},{name:"FTPItem",type:"string"},{name:"FTPEndDate",type:"string"},{name:"ALLTPEndDate",type:"string"},{name:"RecoverDate",type:"string"},{name:"CmsReason",type:"string"},{name:"CmsRemark",type:"string"},{name:"OutRsnName",type:"string"},{name:"AADReason",type:"string"}]}});Ext.define("NisTRApp.model.mBarcodePrinter",{extend:Ext.data.Model,config:{fields:[{name:"Name",type:"string"},{name:"IpAddress",type:"string"},{name:"Port",type:"int"},{name:"Location",type:"string"},{name:"Sequence",type:"int"},{name:"CreateDateTime",type:"date"},{name:"SiteName",type:"string"}]}});Ext.define("NisTRApp.view.CommonPanel",{extend:Ext.Container,alias:"widget.CommonPanel",config:{defaultPage:"MED",centered:true,height:"50%",width:"50%",layout:{type:"fit"},caller:{},hiddens:["1"],items:[{xtype:"toolbar",cls:"commonPanel-toolbar",docked:"top",items:[{xtype:"label",html:"Common_INFO",itemId:"CommonInfoLbl",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   生日.{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age}) &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        身份證號. {PatIdno} </span>","</td>","","</tr>","</table>"]},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"COMMONINFO_CloseBtn",margin:"5 5 5 5",right:"1px",style:"float:left;font-size:16px;",ui:"plain",width:"60px",text:"MyButton16"}]},{xtype:"tabpanel",itemId:"CINFO_MainTabPanel",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"基本資料",height:"100%",itemId:"COMMON_Medmedf",width:"100%",layout:{type:"fit"},items:[{xtype:"formpanel",cls:"mediumfont",itemId:"MedfInfoPanel",items:[{xtype:"fieldset",itemId:"ChartExpireFieldSet",width:"80%",items:[{xtype:"checkboxfield",itemId:"ChartExpireCb",width:"50%",label:"死亡註記",name:"ChartExpire"}]},{xtype:"fieldset",layout:{type:"vbox"},title:"體重 (kg)",items:[{xtype:"textfield",itemId:"InpLast",label:"住院",readOnly:true},{xtype:"textfield",itemId:"OpdLast",label:"門診前次",readOnly:true},{xtype:"textfield",itemId:"OpdToday",label:"門診今天",readOnly:true}]},{xtype:"fieldset",title:"通訊資料",items:[{xtype:"textfield",label:"電話(宅)",name:"TelHome",readOnly:true},{xtype:"textfield",label:"電話(公)",name:"TelOffice",readOnly:true},{xtype:"textfield",label:"手機",name:"TelMobile",readOnly:true},{xtype:"textfield",label:"電子信箱",name:"Email",readOnly:true},{xtype:"textfield",label:"戶籍地址",name:"DomicileStr",readOnly:true},{xtype:"textfield",label:"通訊地址",name:"AddressStr",readOnly:true}]},{xtype:"fieldset",title:"個人資料",items:[{xtype:"textfield",label:"病歷號",name:"ChartNO",readOnly:true},{xtype:"textfield",label:"身份證號",name:"PatIdno",readOnly:true},{xtype:"textfield",label:"姓名",name:"PatName",readOnly:true},{xtype:"textfield",label:"Last Name",name:"LastName",readOnly:true},{xtype:"textfield",label:"First Name",name:"FirstName",readOnly:true},{xtype:"textfield",label:"性別",name:"SexStr",readOnly:true},{xtype:"textfield",label:"生日",name:"BirthdayStr",readOnly:true},{xtype:"textfield",label:"年齡",name:"Age",readOnly:true},{xtype:"textfield",label:"婚姻狀況",name:"MarriedStr",readOnly:true},{xtype:"textfield",label:"出身地",name:"DistrName",readOnly:true},{xtype:"textfield",label:"教育程度",name:"EducationStr",readOnly:true},{xtype:"textfield",label:"職業別",name:"OccupationName",readOnly:true},{xtype:"textfield",label:"公司行號",name:"OccComp",readOnly:true},{xtype:"textfield",label:"職稱",name:"OccTitle",readOnly:true}]},{xtype:"fieldset",title:"緊急聯絡人",items:[{xtype:"textfield",label:"姓名",name:"EmrName",readOnly:true},{xtype:"textfield",label:"關係",name:"EmrRel",readOnly:true},{xtype:"textfield",label:"聯絡人電話",name:"EmrTel",readOnly:true},{xtype:"textfield",label:"聯絡人手機",name:"EmrBb",readOnly:true},{xtype:"textfield",label:"聯絡地址",name:"EmrAddrStr",readOnly:true}]}]},{xtype:"toolbar",docked:"bottom",id:"MEDFnBar",itemId:"MEDFnBar",items:[{xtype:"panel",hidden:false,itemId:"CINFO_BR_Panel",width:"75%",layout:{type:"hbox"},items:[{xtype:"button",itemId:"CINFO_BR_OneBtn",width:"20%",text:"1 張"},{xtype:"button",itemId:"CINFO_BR_FiveBtn",width:"25%",text:"5 張"},{xtype:"selectfield",itemId:"CINFO_BR_SiteField",width:"50%",label:"地點",displayField:"SiteName",valueField:"SiteName"}]},{xtype:"button",itemId:"CINFO_MEDCloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"}]}]}],tabBar:{docked:"top",scrollable:"horizontal"}},{xtype:"toolbar",docked:"bottom",id:"CommonFnBar",itemId:"CommonFnBar",items:[{xtype:"button",itemId:"CINFO_CloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"}]}],listeners:[{fn:"onCOMMONINFO_CloseBtnTap",event:"tap",delegate:"#COMMONINFO_CloseBtn"},{fn:"onCOMMON_MedmedfShow",event:"show",delegate:"#COMMON_Medmedf"},{fn:"onCINFO_BR_OneBtnTap",event:"tap",delegate:"#CINFO_BR_OneBtn"},{fn:"onCINFO_BR_FiveBtnTap",event:"tap",delegate:"#CINFO_BR_FiveBtn"},{fn:"onCINFO_MEDCloseBtnTap",event:"tap",delegate:"#CINFO_MEDCloseBtn"},{fn:"onCINFO_CloseBtnTap",event:"tap",delegate:"#CINFO_CloseBtn"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerHide",event:"hide"}]},onCOMMONINFO_CloseBtnTap:function(b,d,a){try{this.destroy()}catch(d){console.error(d);this.destroy()}},onCOMMON_MedmedfShow:function(k,f){if(Ext.getStore("sBarcodePrinterSite").getCount()<=0){Ext.getStore("sBarcodePrinterSite").load({callback:function(m,l,o){var n=localStorage.getItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());if(!Ext.isEmpty(n)){this.down("#CINFO_BR_SiteField").setValue(n)}n=null;delete n},scope:this})}var e=function e(m,l){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Search/PatientVitalSign_V.ashx",scope:this,method:"POST",params:{ChartNo:m},success:function(n){try{if(null==n||String.IsNull(n.responseText)){return}var q=Ext.decode(n.responseText);if(null==q||q.length<=0){q=null;delete q;return}q.forEach(function o(u,s,r){if(u.Type=="OPD_TODAY"){l.down("#OpdToday").setValue(u.Weight);l.down("#OpdToday").setLabel("門診今日  "+NisTRApp.view.TRUtility.BirthdayFormat(u.CreDate))}if(u.Type=="OPD"){l.down("#OpdLast").setValue(u.Weight);l.down("#OpdLast").setLabel("門診前次  "+NisTRApp.view.TRUtility.BirthdayFormat(u.CreDate))}if(u.Type=="INP"){l.down("#InpLast").setValue(u.Weight);l.down("#InpLast").setLabel("住院  "+NisTRApp.view.TRUtility.BirthdayFormat(u.CreDate))}});q=null;delete q;l=null;delete l}catch(p){console.error(p)}},failure:function(){}})};var b=function b(n){var m=localStorage.getItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());if(Ext.getStore("sBarcodePrinterSite")==null){Ext.define("mBarcodePrinter",{extend:Ext.data.Model,config:{fields:[{name:"Name",type:"string"},{name:"IpAddress",type:"string"},{name:"Port",type:"int"},{name:"Location",type:"string"},{name:"Sequence",type:"int"},{name:"CreateDateTime",type:"date"},{name:"SiteName",type:"string"},]}});var l=Ext.create("Ext.data.Store",{storeId:"sBarcodePrinterSite",model:"mBarcodePrinter",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},useDefaultXhrHeader:false,url:NisTRApp.view.SysUtility.AgentServer()+"/api/Search/QueryBarcodeSite.ashx",reader:{type:"json"}}});l.sort([{property:"Location",direction:"DESC"},{property:"Sequence",direction:"ASC"}]);l.load({callback:function(p,o,q){if(null!=p&&null!=p[0]){}},scope:this});l=null;delete l}else{Ext.getStore("sBarcodePrinterSite").load();Ext.getStore("sBarcodePrinterSite").sort([{property:"Location",direction:"DESC"},{property:"Sequence",direction:"ASC"}])}n.down("#RSP_BarcodeSiteSelect").setStore(Ext.getStore("sBarcodePrinterSite"));n.down("#RSP_BarcodeSiteSelect").setValue(m);m=null;delete m;n=null;delete n};var h=this;h.down("#InpLast").setValue("");h.down("#OpdLast").setValue("");h.down("#OpdToday").setValue("");h.down("#InpLast").setLabel("住院  ");h.down("#OpdLast").setLabel("門診前次  ");h.down("#OpdToday").setLabel("門診今日  ");if(!Ext.isEmpty(this.getRecord())){var a=this.down("#MedfInfoPanel");a.reset();a.down("#ChartExpireCb").uncheck();a.down("#ChartExpireFieldSet").hide();var d=this.getRecord().data;var g=Ext.getStore("sMedmedf");var j=null;if(g.getCount()>0){j=g.getAt(0)}e(d.ChartNo,h);if((null==j||String.IsNull(j.data.ChartNo)||d.ChartNo!=j.data.ChartNo)&&!Ext.isEmpty(Ext.getStore("sMedmedf"))){g.getProxy().setExtraParams({ChartNo:d.ChartNo});h.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD});g.load({callback:function(m,l,n){h.setMasked(false);if(null!=m&&null!=m[0]){a.setRecord(m[0]);if(!String.IsNull(m[0].data.ChartExpire)&&"Y"==m[0].data.ChartExpire){a.down("#ChartExpireCb").check();a.down("#ChartExpireFieldSet").show()}}a=null;delete a;h=null;delete h},scope:this})}else{a.setRecord(j);if(!String.IsNull(j.data.ChartExpire)&&"Y"==j.data.ChartExpire){a.down("#ChartExpireCb").check();a.down("#ChartExpireFieldSet").show()}a=null;delete a;h=null;delete h}d=null;delete d;j=null;delete j;g=null;delete g}else{Ext.Msg.alert(SYS_CONST.Error.ERROR,"");h=null;delete h;this.destroy()}e=null;delete e;b=null;delete b},onCINFO_BR_OneBtnTap:function(b,d,a){this.PrintBarcode(1)},onCINFO_BR_FiveBtnTap:function(b,d,a){this.PrintBarcode(5)},onCINFO_MEDCloseBtnTap:function(b,d,a){try{this.destroy()}catch(d){console.error(d);this.destroy()}},onCINFO_CloseBtnTap:function(b,d,a){try{this.destroy()}catch(d){console.error(d);this.destroy()}},onContainerShow:function(a,b){var d=this.down("#CINFO_MainTabPanel").getActiveItem();if(!Ext.isEmpty(d)){d.fireEvent("show",d,null,null)}d=null;delete d},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sBarcodePrinterSite"))){Ext.getStore("sBarcodePrinterSite").removeAll();Ext.getStore("sBarcodePrinterSite").destroy()}if(!Ext.isEmpty(Ext.getStore("sMedmedf"))){Ext.getStore("sMedmedf").removeAll();Ext.getStore("sMedmedf").destroy()}if(!Ext.isEmpty(Ext.getCmp("CommonFnBar"))){Ext.getCmp("CommonFnBar").destroy()}_HideCommonFnBar=null;delete _HideCommonFnBar;_ShowCommonFnBar=null;delete _ShowCommonFnBar;console.log("on destroy :","Common Panel");this.removeAll()},onContainerHide:function(a,b){this.destroy()},initialize:function(){this.callParent();_ShowCommonFnBar=function(k,l){Ext.getCmp("CommonFnBar").setHidden(false)};_HideCommonFnBar=function(k,l){Ext.getCmp("CommonFnBar").setHidden(true)};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("CommonPanel 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("CommonPanel 住院病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("CommonPanel 門診病人資料錯誤");return false}var d=this.getRecord();this.down("#CommonInfoLbl").setRecord(d);if(Ext.isEmpty(Ext.getStore("sBarcodePrinterSite"))){var e=Ext.create("Ext.data.Store",{storeId:"sBarcodePrinterSite",model:"NisTRApp.model.mBarcodePrinter",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},useDefaultXhrHeader:false,url:NisTRApp.view.SysUtility.AgentServer()+"/api/Search/QueryBarcodeSite.ashx",reader:{type:"json"}},sorters:[{direction:"Location",property:"Location"},{property:"Sequence",direction:"ASC"}]})}this.down("#CINFO_BR_SiteField").setStore(Ext.getStore("sBarcodePrinterSite"));if(Ext.isEmpty(Ext.getStore("sMedmedf"))){Ext.create("Ext.data.Store",{storeId:"sMedmedf",autoLoad:false,model:"NisTRApp.model.Med.MedmedfEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryFullMedmedf.ashx",reader:{type:"json"}}})}this.down("#COMMON_Medmedf").addListener("painted",_HideCommonFnBar,this.down("#COMMON_Medmedf"));if(Ext.isEmpty(this.down("#_regregHistory"))){var j=Ext.create("NisTRApp.view.REG.RegHistory",{itemId:"_regregHistory",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"掛號記錄",caller:this});this.down("#CINFO_MainTabPanel").add(j);j=null;delete j}this.down("#_regregHistory").addListener("painted",_ShowCommonFnBar,this.down("#_regregHistory"));if(Ext.isEmpty(this.down("#_schschHistory"))){var b=Ext.create("NisTRApp.view.REG.ScheduleHistory",{itemId:"_schschHistory",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"放診排檢記錄",caller:this});this.down("#CINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_schschHistory").addListener("painted",_ShowCommonFnBar,this.down("#_schschHistory"));if(Ext.isEmpty(this.down("#_hrmView"))){var h=Ext.create("NisTRApp.view.HrmView",{itemId:"_hrmView",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"高風險",caller:this});this.down("#CINFO_MainTabPanel").add(h);h=null;delete h}this.down("#_hrmView").addListener("painted",_ShowCommonFnBar,this.down("#_hrmView"));if(Ext.isEmpty(this.down("#_endoSchschHistory"))){var f=Ext.create("NisTRApp.view.ENDO.SchdHistory",{itemId:"_endoSchschHistory",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"內視鏡排檢記錄",caller:this.getCaller()});this.down("#CINFO_MainTabPanel").add(f);f=null;delete f}this.down("#_endoSchschHistory").addListener("painted",_ShowCommonFnBar,this.down("#_endoSchschHistory"));if(this.getRecord().data.Source.Type==2){if(Ext.isEmpty(this.down("#_ipdInpInformationPanel"))){var g=Ext.create("NisTRApp.view.IPD.InpInformationPanel",{itemId:"_ipdInpInformationPanel",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"住院資訊",caller:this});this.down("#CINFO_MainTabPanel").add(g);g=null;delete g}this.down("#_ipdInpInformationPanel").addListener("painted",_ShowCommonFnBar,this.down("#_ipdInpInformationPanel"))}if(!Ext.Array.contains(this.getHiddens(),"OPR")&&NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.OPR.Name){this.initialOprList(this.getRecord())}if(!Ext.Array.contains(this.getHiddens(),"RIS")&&NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.RIS.Name){this.initialRisList(this.getRecord())}if(!Ext.Array.contains(this.getHiddens(),"ENDO")&&NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.ENDO.Name){this.initialEndoList(this.getRecord())}if(NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.OUTP.Name){this.initialOutpList(this.getRecord())}var a=0;if(this.getDefaultPage()=="MED"){a=0}else{if(this.getDefaultPage()=="INPINFO"&&this.getRecord().data.Source.Type==2){a=5}else{if(this.getDefaultPage()=="WORKLIST"){if(NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.OPR.Name||NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.RIS.Name||NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.ENDO.Name||NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.OUTP.Name){a=5;if(this.getRecord().data.Source.Type==2){a=a+1}}}else{if(this.getDefaultPage()=="CONTACT"){if(NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.ENDO.Name){a=6;if(this.getRecord().data.Source.Type==2){a=a+1}}}else{if(this.getDefaultPage()=="ENDOSCHDEITAL"){if(NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.ENDO.Name){a=7;if(this.getRecord().data.Source.Type==2){a=a+1}}}else{if(this.getDefaultPage()=="OUTPREPARE"){if(NisTRApp.app.getFuncType().Name===SYS_CONST.FunctionType.OUTP.Name){a=6;if(this.getRecord().data.Source.Type==2){a=a+1}}}}}}}}this.down("#CINFO_MainTabPanel").setActiveItem(a);d=null;delete d},initialOprList:function(e){var e=this.getRecord();if(Ext.isEmpty(this.down("#_oprWorkList"))){var d=Ext.create("NisTRApp.view.OPR.WorkList",{itemId:"_oprWorkList",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"工作清單",stopDistroyEvent:true,caller:this});this.down("#CINFO_MainTabPanel").add(d);d=null;delete d}this.down("#_oprWorkList").addListener("painted",_HideCommonFnBar,this.down("#_oprWorkList"));this.down("#_oprWorkList").down("#OPRWK_CloseBtn").addListener("tap",function(f){this.destroy()},this);if(Ext.isEmpty(this.down("#_oprCareInfoPanel"))){var b=Ext.create("NisTRApp.view.OPR_CareInfoPanel",{itemId:"_oprCareInfoPanel",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"追蹤設定",caller:this.getCaller(),centered:false,hiddenHeadBar:true,stopDistroyEvent:true});this.down("#CINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_oprCareInfoPanel").addListener("painted",_HideCommonFnBar,this.down("#_oprCareInfoPanel"));this.down("#_oprCareInfoPanel").down("#OPRC_CloseMasterBtn").addListener("tap",function(f){this.destroy()},this);if(Ext.isEmpty(this.down("#_nurCathCreatePanel"))){var a=Ext.create("NisTRApp.view.Nur.CathCreatePanel",{itemId:"_nurCathCreatePanel",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"PortA",caller:this.getCaller(),centered:false,hiddenHeadBar:true,stopDistroyEvent:true});this.down("#CINFO_MainTabPanel").add(a);a=null;delete a}this.down("#_nurCathCreatePanel").addListener("painted",_HideCommonFnBar,this.down("#_nurCathCreatePanel"));this.down("#_nurCathCreatePanel").down("#NCCP_CloseBtn").addListener("tap",function(f){this.destroy()},this);e=null;delete e},initialRisList:function(d){var d=this.getRecord();if(Ext.isEmpty(this.down("#_risWorkList"))){var a=Ext.create("NisTRApp.view.RIS.WorkList",{itemId:"_risWorkList",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"工作清單",stopDistroyEvent:true,caller:this});this.down("#CINFO_MainTabPanel").add(a);a=null;delete a}this.down("#_risWorkList").addListener("painted",_HideCommonFnBar,this.down("#_risWorkList"));this.down("#_risWorkList").down("#RISWK_CloseBtn").addListener("tap",function(e){this.destroy()},this);if(Ext.isEmpty(this.down("#_risContactPanel"))){var b=Ext.create("NisTRApp.view.RIS_ContactPanel",{itemId:"_risContactPanel",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"追蹤設定",caller:this.getCaller(),centered:false,hiddenHeadBar:true,stopDistroyEvent:true});this.down("#CINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_risContactPanel").addListener("painted",_HideCommonFnBar,this.down("#_risContactPanel"));this.down("#_risContactPanel").down("#RISC_CloseMasterBtn").addListener("tap",function(e){this.destroy()},this);d=null;delete d},initialEndoList:function(e){var e=this.getRecord();if(Ext.isEmpty(this.down("#_endoWorkList"))){var d=Ext.create("NisTRApp.view.ENDO.WorkList",{itemId:"_endoWorkList",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"工作清單",stopDistroyEvent:true,caller:this});this.down("#CINFO_MainTabPanel").add(d);d=null;delete d}this.down("#_endoWorkList").addListener("painted",_HideCommonFnBar,this.down("#_endoWorkList"));this.down("#_endoWorkList").down("#ENDOWK_CloseBtn").addListener("tap",function(f){this.destroy()},this);if(Ext.isEmpty(this.down("#_endoContactPanel"))){var b=Ext.create("NisTRApp.view.ENDO_ContactPanel",{itemId:"_endoContactPanel",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"追蹤設定",caller:this.getCaller(),centered:false,hiddenHeadBar:true,stopDistroyEvent:true});this.down("#CINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_endoContactPanel").addListener("painted",_HideCommonFnBar,this.down("#_endoContactPanel"));this.down("#_endoContactPanel").down("#ENDOC_CloseMasterBtn").addListener("tap",function(f){this.destroy()},this);if(!Ext.isEmpty(Ext.getCmp("_endoSechdDetails"))){Ext.getCmp("_endoSechdDetails").destroy()}if(Ext.isEmpty(this.down("#_endoSechdDetails"))){var a=Ext.create("NisTRApp.view.ENDO.SechdDetails",{id:"_endoSechdDetails",itemId:"_endoSechdDetails",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"醫令明細",stopDistroyEvent:true,hiddenHeadBar:true,caller:this.getCaller()});this.down("#CINFO_MainTabPanel").add(a);a=null;delete a}this.down("#_endoSechdDetails").addListener("painted",_ShowCommonFnBar,this.down("#_endoSechdDetails"));e=null;delete e},initialOutpList:function(d){var d=this.getRecord();if(Ext.isEmpty(this.down("#_outpWorkList"))){var b=Ext.create("NisTRApp.view.OUTP.WorkList",{itemId:"_outpWorkList",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"工作清單",stopDistroyEvent:true,caller:this});this.down("#CINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_outpWorkList").addListener("painted",_HideCommonFnBar,this.down("#_outpWorkList"));this.down("#_outpWorkList").down("#OUTPWK_CloseBtn").addListener("tap",function(f){this.destroy()},this);if(Ext.isEmpty(this.down("#_outpInCasePanel"))){var a=Ext.create("NisTRApp.view.OUTP.InCase",{itemId:"_outpInCasePanel",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"出院準備",caller:this.getCaller(),centered:false,hiddenHeadBar:true,stopDistroyEvent:true});this.down("#CINFO_MainTabPanel").add(a);a=null;delete a}this.down("#_outpInCasePanel").addListener("painted",_HideCommonFnBar,this.down("#_outpInCasePanel"));this.down("#_outpInCasePanel").down("#OUTPIC_CloseBtn").addListener("tap",function(f){this.destroy()},this);if(Ext.isEmpty(this.down("#_ConsoultRecordPanel"))){var e=Ext.create("NisTRApp.view.ConsoultRecordPanel",{itemId:"_ConsoultRecordPanel",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"會診",caller:this.getCaller(),centered:false,hiddenHeadBar:true,stopDistroyEvent:true});this.down("#CINFO_MainTabPanel").add(e);e=null;delete e}this.down("#_ConsoultRecordPanel").addListener("painted",_ShowCommonFnBar,this.down("#_ConsoultRecordPanel"));this.down("#_ConsoultRecordPanel").down("#CloseBtn").addListener("tap",function(f){this.destroy()},this);d=null;delete d},PrintBarcode:function(b){var g=this.getRecord();if(g==null){return}var a=this.down("#CINFO_BR_SiteField").getRecord();if(null==a){g=null;delete g;a=null;delete a;return}var f=localStorage.getItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());if(f!=a.data.SiteName){localStorage.removeItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());localStorage.setItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID(),a.data.SiteName)}try{Ext.Ajax.request({url:NisTRApp.view.SysUtility.AgentServer()+"/api/action/PrintBarcode.ashx",scope:this,useDefaultXhrHeader:false,method:"POST",params:{ChartNo:g.data.ChartNo,SiteName:a.data.SiteName,Cnt:b},success:function(e){NisTRApp.view.Misc.Alert("列印成功!",800)},failure:function(e){NisTRApp.view.Misc.Alert("列印失敗!請重新整理。")}})}catch(d){NisTRApp.view.Misc.Alert("列印失敗!請重新整理。")}g=null;delete g;a=null;delete a;f=null;delete f;return}});Ext.define("NisTRApp.model.CMS.NeuSchData",{extend:Ext.data.Model,config:{fields:[{name:"ChkDrName",type:"string"},{name:"SignDtatusDesc",type:"string"},{name:"OrdNO",type:"string"},{name:"Title",type:"string"},{name:"RptKind",type:"string"},{name:"ChartNO",type:"string"},{name:"ChkGroup",type:"string"},{name:"ChkDrNO",type:"string"},{name:"SysDate",type:"string"},{name:"RptDate",type:"string"},{name:"SignStatus",type:"string"},{name:"DocNO",type:"string"},{name:"AplDrName",type:"string"},{name:"Resident",type:"string"},{name:"Attending",type:"string"},{name:"Scan",type:"string"},{name:"Idx",type:"string"},{name:"DrugName",type:"string"},{name:"EmrConfirmed",type:"string"},{name:"PacsAccno",type:"string"},{name:"NeuVer",type:"string"},{name:"ImgReport",type:"string"},{name:"Version",type:"string"},{name:"NeuVerText",type:"string"},{convert:function(a,b){return"NEU"},name:"ExamType",type:"string"},{convert:function(a,b){return b.data.OrdNO},name:"FrmKey"},{convert:function(a,b){return"NEU_SCH"},name:"FrmCode",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.OrdNO},name:"KeyOne",type:"string"},{name:"RemarkCnt",type:"int"}]}});Ext.define("NisTRApp.model.CMS.PathologySchData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"AccessnumName",type:"string"},{name:"StatusName",type:"string"},{name:"FrmCode",type:"string"},{name:"FrmKey",type:"string"},{name:"RptVer",type:"string"},{name:"RptMax",type:"string"},{name:"EmrConfirmed",type:"string"},{name:"PathoDate",type:"string"},{name:"PathoNO",type:"string"},{name:"SysDate",type:"string"},{name:"Cate",type:"string"},{name:"Accessnum",type:"string"},{name:"Topo",type:"string"},{name:"Morpho",type:"string"},{name:"Status",type:"string"},{name:"StatusHm",type:"string"},{name:"RptSignDate",type:"string"},{name:"AplDrCode",type:"string"},{name:"RemarkCnt",type:"int"},{name:"KeyOne",type:"string"},{name:"AplDrName",type:"string"},{convert:function(a,b){return"PATHOLOGY"},name:"ExamType",type:"string"},{convert:function(a,b){if(b.data.Cate=="A"||b.data.Cate=="P"||b.data.Cate=="R"){return"PGV_PATHO"}else{if(b.data.Cate=="N"||b.data.Cate=="G"){return"PGV_CYTO"}else{return""}}},name:"Table",type:"string"}]}});Ext.define("NisTRApp.model.CMS.ChemoSchData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"FrmCode",type:"string"},{name:"FrmKey",type:"string"},{name:"RemarkCnt",type:"int"},{name:"KeyOne",type:"string"},{name:"AplDocName",type:"string"},{convert:function(a,b){return"CHEMO"},name:"ExamType",type:"string"},{name:"Adeffect",type:"string"},{name:"ChpWay",type:"string"},{name:"BedNO",type:"string"},{name:"ActMethod",type:"string"},{name:"RptFlag",type:"string"},{name:"ChartSeq",type:"int"},{name:"ChemoType",type:"string"},{name:"Source",type:"string"},{name:"ChemoName",type:"string"},{name:"ChemoNO",type:"string"},{name:"Status",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"EndDate",type:"string"},{name:"AplDate",type:"string"},{name:"AplHdeptCode",type:"string"},{name:"AplDocNO",type:"string"},{name:"ArvlUserID",type:"string"},{name:"ArvlDate",type:"string"},{name:"ArvlTime",type:"string"},{name:"Weight",type:"string"}]}});Ext.define("NisTRApp.model.CMS.TreatmentPlanMEntity",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"PlanmID",type:"string"},{name:"FirstPreDate",type:"string"},{name:"FirstEndDate",type:"string"},{name:"AllFinishedDate",type:"string"},{name:"Content",type:"string"},{name:"Item",type:"string"},{name:"CmsID",type:"string"},{name:"DeleteFlag",type:"string"},{name:"DeleteDate",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"CreUserID",type:"string"},{convert:function(a,b){return b.data.PlanmID},name:"KeyOne",type:"string"},{name:"ItemNameCH",type:"string"},{name:"CreUserName",type:"string"},{convert:function(b,e){var a="";try{if(e.data!=null){a=String.format("項目: {0} ;  首治日期: {1} ;  建檔日: {2} ;  建檔人:{4}",e.data.ItemNameCH,e.data.FirstEndDate,e.data.CreDate,e.data.CreTime,e.data.CreUserName)}}catch(d){a=""}return a},name:"DisplayStr",type:"string"}]}});Ext.define("NisTRApp.model.CMS.TreatmentPlanDEntity",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"PlandID",type:"string"},{name:"PlanmID",type:"string"},{name:"Kind",type:"string"},{name:"Item",type:"string"},{name:"Purpose",type:"string"},{name:"PreBegDate",type:"string"},{name:"PreEndDate",type:"string"},{name:"RealBegDate",type:"string"},{name:"RealEndDate",type:"string"},{name:"CloseReason",type:"string"},{name:"FinishedDate",type:"string"},{name:"FinishedFlag",type:"boolean"},{name:"DeleteFlag",type:"boolean"},{name:"DeleteDate",type:"string"},{name:"DeleteTime",type:"string"},{name:"DeleteUserID",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"CreUserID",type:"string"},{name:"CreUserName",type:"string"},{name:"ItemNameCH",type:"string"},{name:"FrmCode",type:"string"},{name:"FrmKey",type:"string"},{convert:function(a,b){return b.data.ItemNameCH},name:"FrmItemName",type:"string"},{convert:function(a,b){return b.data.PlandID},name:"KeyOne",type:"string"},{name:"RemarkCnt",type:"int"},{name:"TreatH",type:"string"}]}});Ext.define("NisTRApp.model.mSysClinc",{extend:Ext.data.Model,config:{fields:[{name:"ClinCode",type:"string"},{name:"ClinName",type:"string"},{name:"Rang",type:"int"}]}});Ext.define("NisTRApp.model.VitalSigns.ChroniclesData",{extend:Ext.data.Model,config:{fields:[{name:"GroupId",type:"string"},{name:"Content",type:"string"},{name:"EventSeq",type:"int"},{name:"InpNo",type:"string"},{name:"InSource",type:"string"},{name:"StartDate",type:"string"},{name:"EndDate",type:"string"},{name:"BgColor",type:"int"},{name:"Topic",type:"string"},{name:"ProcDate",type:"string"},{name:"ProcTime",type:"string"},{name:"UserId",type:"string"},{name:"GrpDate",type:"string"}]}});Ext.define("NisTRApp.view.WorkList",{extend:Ext.Container,config:{initialFlag:true,readFlag:false,layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"WL_HeadBar",items:[{xtype:"button",hidden:true,html:'<marquee scrollamount="3"><h6><span style="color:pink">❤❤❤ </span><span style="color:Lime">護理部祝您 "護理師節快樂！" <span style="color:pink">❤❤❤ </span></span></h6></marquee>',itemId:"nInfoBtn",right:"280px",width:"380px",text:"MyButton89"},{xtype:"button",cls:"btn",html:"<h1>登 出</h1>",itemId:"WL_LogoutBtn",right:"10px",width:"90px",iconCls:"action",text:""},{xtype:"button",html:"<h1> User Info </h1>",itemId:"WL_UsetInfoBtn",right:"110px",width:"150px",iconCls:"user",text:"MyButton2"},{xtype:"segmentedbutton",centered:false,hidden:false,itemId:"WL_FN_Btns",right:"280px",top:"6px",allowToggle:false,items:[{xtype:"button",itemId:"WL_FN_IPB_Btn",width:"70px",text:"住院區"},{xtype:"button",itemId:"WL_FN_OPR_Btn",width:"70px",text:"開刀房"},{xtype:"button",hidden:false,itemId:"WL_FN_RIS_Btn",width:"70px",text:"放診科"},{xtype:"button",hidden:false,itemId:"WL_FN_ENDO_Btn",width:"70px",text:"內視鏡"},{xtype:"button",hidden:false,itemId:"WL_FN_CMS_Btn",width:"80px",text:"全癌個管"},{xtype:"button",hidden:false,itemId:"WL_FN_OUTPAT_Btn",width:"80px",text:"出院個管"},{xtype:"button",hidden:true,itemId:"WL_FN_OPD_Btn",width:"70px",text:"門診"},{xtype:"button",hidden:true,itemId:"WL_FN_ACC_Btn",width:"70px",text:"ACC"},{xtype:"button",itemId:"WL_FN_EMR_Btn",width:"70px",text:"EMR"},{xtype:"button",hidden:true,itemId:"WL_FN_WB_Btn",width:"80px",text:"護理白板"},{xtype:"button",itemId:"WL_FN_SETTING_Btn",iconCls:"settings",text:""}]}]}],listeners:[{fn:"onWL_LogoutBtnTap",delay:100,event:"tap",delegate:"#WL_LogoutBtn"},{fn:"onWL_UsetInfoBtnTap",event:"tap",delegate:"#WL_UsetInfoBtn"},{fn:"onWL_FN_IPB_BtnTap",event:"tap",delegate:"#WL_FN_IPB_Btn"},{fn:"onWL_FN_OPR_BtnTap",delay:100,event:"tap",delegate:"#WL_FN_OPR_Btn"},{fn:"onWL_FN_RIS_BtnTap",event:"tap",delegate:"#WL_FN_RIS_Btn"},{fn:"onWL_FN_ENDO_BtnTap",event:"tap",delegate:"#WL_FN_ENDO_Btn"},{fn:"onWL_FN_CMS_BtnTap",event:"tap",delegate:"#WL_FN_CMS_Btn"},{fn:"onWL_FN_OUTPAT_BtnTap",event:"tap",delegate:"#WL_FN_OUTPAT_Btn"},{fn:"onWL_FN_ACC_BtnTap",delay:100,event:"tap",delegate:"#WL_FN_ACC_Btn"},{fn:"onWL_FN_EMR_BtnTap",event:"tap",delegate:"#WL_FN_EMR_Btn"},{fn:"onWL_FN_WB_BtnTap",event:"tap",delegate:"#WL_FN_WB_Btn"},{fn:"onWL_FN_SETTING_BtnTap",event:"tap",delegate:"#WL_FN_SETTING_Btn"},{fn:"onContainerFunctionChange1",event:"FunctionChange",delegate:"#WL_FN_Btns"},{fn:"onContainerFunctionChange",event:"FunctionChange"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerSysLogout",event:"SysLogout"},{fn:"onContainerUpdatedata",event:"updatedata"}]},onWL_LogoutBtnTap:function(b,d,a){NisTRApp.view.SysUtility.Logout()},onWL_UsetInfoBtnTap:function(b,d,a){var f=String.format("員工編號：{0} </br> 員工姓名：{1} </br>",NisTRApp.view.SysUtility.GetUserID(),NisTRApp.view.SysUtility.GetUserName());NisTRApp.view.Misc.MsgShow(f,"",5000);f=null;delete f},onWL_FN_IPB_BtnTap:function(d,g,b){this.ButtonSelect(d,g,b);console.log(SYS_CONST.FunctionType.IPB);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.IPB);var a=this;if(Ext.isEmpty(Ext.getCmp("_wlipb"))||Ext.isEmpty(this.down("#_wlipb"))){var f=Ext.create("NisTRApp.view.WorkList.IPB",{id:"_wlipb",itemId:"_wlipb",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(f);f=null;delete f}a=null;delete a},onWL_FN_OPR_BtnTap:function(d,f,b){this.ButtonSelect(d,f,b);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.OPR);var a=this;if(Ext.isEmpty(Ext.getCmp("_wlopr"))||Ext.isEmpty(this.down("#_wlopr"))){var g=Ext.create("NisTRApp.view.WorkList.OPR",{id:"_wlopr",itemId:"_wlopr",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(g);g=null;delete g}a=null;delete a},onWL_FN_RIS_BtnTap:function(d,g,b){this.ButtonSelect(d,g,b);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.RIS);var a=this;if(Ext.isEmpty(Ext.getCmp("_wlris"))||Ext.isEmpty(this.down("#_wlris"))){var f=Ext.create("NisTRApp.view.WorkList.RIS",{id:"_wlris",itemId:"_wlris",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(f);f=null;delete f}a=null;delete a},onWL_FN_ENDO_BtnTap:function(d,f,b){this.ButtonSelect(d,f,b);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.ENDO);var a=this;if(Ext.isEmpty(Ext.getCmp("_wlendo"))||Ext.isEmpty(this.down("#_wlendo"))){var g=Ext.create("NisTRApp.view.WorkList.ENDO",{id:"_wlendo",itemId:"_wlendo",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(g);g=null;delete g}a=null;delete a},onWL_FN_CMS_BtnTap:function(d,g,b){this.ButtonSelect(d,g,b);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.CMS);var a=this;if(Ext.isEmpty(Ext.getCmp("_wlcms"))||Ext.isEmpty(this.down("#_wlcms"))){var f=Ext.create("NisTRApp.view.WorkList.CMS",{id:"_wlcms",itemId:"_wlcms",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(f);f=null;delete f}a=null;delete a},onWL_FN_OUTPAT_BtnTap:function(f,g,d){this.ButtonSelect(f,g,d);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.OUTP);var a=this;if(Ext.isEmpty(Ext.getCmp("_wloutp"))||Ext.isEmpty(this.down("#_wloutp"))){var b=Ext.create("NisTRApp.view.WorkList.OUTP",{id:"_wloutp",itemId:"_wloutp",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(b);b=null;delete b}a=null;delete a},onWL_FN_ACC_BtnTap:function(f,g,d){this.ButtonSelect(f,g,d);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.ACC);var b=this;if(undefined==Ext.getCmp("_wlacc")||null==this.down("#_wlacc")){var a=Ext.create("NisTRApp.view.WorkList.ACC",{id:"_wlacc",itemId:"_wlacc",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(a)}b=null;delete b},onWL_FN_EMR_BtnTap:function(f,g,d){this.ButtonSelect(f,g,d);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.EMR);var b=this;if(Ext.isEmpty(Ext.getCmp("_wlemr"))||Ext.isEmpty(this.down("#_wlemr"))){var a=Ext.create("NisTRApp.view.WorkList.EMR",{id:"_wlemr",itemId:"_wlemr",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(a);a=null;delete a}b=null;delete b},onWL_FN_WB_BtnTap:function(d,g,b){this.ButtonSelect(d,g,b);NisTRApp.app.setFuncType(SYS_CONST.FunctionType.WB);var a=this;if(Ext.isEmpty(Ext.getCmp("_wlwb"))||Ext.isEmpty(this.down("#_wlwb"))){var f=Ext.create("NisTRApp.view.WorkList.WB",{id:"_wlwb",itemId:"_wlwb",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.down("#WL_MainPanel").add(f);f=null;delete f}a=null;delete a},onWL_FN_SETTING_BtnTap:function(b,d,a){try{if(!Ext.isEmpty(Ext.getCmp("_SysInfoPanel"))){Ext.getCmp("_SysInfoPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_SysInfoPanel"))){var f=Ext.create("NisTRApp.view.Sys.SysInfoPanel",{id:"_SysInfoPanel",record:NisTRApp.view.SysUtility.GetUserInfo()});this.overlay=Ext.Viewport.add(f);f=null;delete f}this.overlay.show()}catch(d){console.log(d)}return},onContainerFunctionChange1:function(b,f,d,a){var e=this;e.down("#WL_MainPanel").removeAll(true,true);if(d.Name==SYS_CONST.FunctionType.OPR.Name){e.down("#WL_FN_OPR_Btn").fireEvent("tap",e.down("#WL_FN_OPR_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.ACC.Name){e.down("#WL_FN_ACC_Btn").fireEvent("tap",this.down("#WL_FN_ACC_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.EMR.Name){e.down("#WL_FN_EMR_Btn").fireEvent("tap",this.down("#WL_FN_EMR_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.ENDO.Name){e.down("#WL_FN_ENDO_Btn").fireEvent("tap",this.down("#WL_FN_ENDO_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.RIS.Name){e.down("#WL_FN_RIS_Btn").fireEvent("tap",this.down("#WL_FN_RIS_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.CMS.Name){e.down("#WL_FN_CMS_Btn").fireEvent("tap",this.down("#WL_FN_CMS_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.OUTP.Name){e.down("#WL_FN_OUTPAT_Btn").fireEvent("tap",this.down("#WL_FN_OUTPAT_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.WB.Name){e.down("#WL_FN_WB_Btn").fireEvent("tap",this.down("#WL_FN_WB_Btn"),null,null)}else{if(d.Name==SYS_CONST.FunctionType.IPB.Name){e.down("#WL_FN_IPB_Btn").fireEvent("tap",this.down("#WL_FN_IPB_Btn"),null,null)}}}}}}}}}e=null;delete e},onContainerFunctionChange:function(b,e,d,a){},onContainerPainted:function(b,a){this.down("#WL_UsetInfoBtn").setHtml("<h1>"+NisTRApp.view.SysUtility.GetUserName()+"</h1>")},onContainerSysLogout:function(b,d,a){b.down("#WL_UsetInfoBtn").setHtml("<h1>USER</h1>");NisTRApp.app.setFuncType(SYS_CONST.FunctionType.NULL);console.log("WorkList UI recive logout notify")},onContainerUpdatedata:function(a,e,b){var d=NisTRApp.view.SysUtility.getUserID();$.ajax({url:NisTRApp.view.SysUtility.ProtalServer()+"/hash/u/"+d,type:"get",dataType:"text",crossDomain:true,xhrFields:{withCredentials:true},error:function(g,f,h){console.log(g,f,h)},success:function(f){console.log(f)}});d=null;delete d},initialize:function(){this.callParent();this.setReadFlag(localStorage.getItem(NisTRApp.view.SysUtility.GetUserID()+"_readflag"));this.initialStore();if(Ext.isEmpty(Ext.getCmp("WL_MainPanel"))||Ext.isEmpty(this.down("#WL_MainPanel"))){var a=Ext.create("NisTRApp.view.WorkList.MainPanel",{itemId:"WL_MainPanel",centered:false,height:"100%",width:"100%",hideOnMaskTap:false,modal:false});this.add(a);a=null;delete a}this.down("#WL_UsetInfoBtn").setHtml("<h1>USER</h1>")},ButtonSelect:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#WL_FN_Btns"),b,"confirm-round","normal","","")},initialStore:function(){if(Ext.getStore("sWorkStationList")==null){Ext.create("Ext.data.Store",{storeId:"sWorkStationList",fields:[{name:"StationName"},{name:"DeptCode"}],data:[{StationName:"ICU病房",DeptCode:"1306"},{StationName:"五北全區",DeptCode:"1312"},{StationName:"五北-A護理站",DeptCode:"05A"},{StationName:"五北-B護理站",DeptCode:"05B"},{StationName:"五南全區",DeptCode:"1313"},{StationName:"五南-C護理站",DeptCode:"05C"},{StationName:"五南-D護理站",DeptCode:"05D"},{StationName:"六北全區",DeptCode:"1308"},{StationName:"六北-A護理站",DeptCode:"06A"},{StationName:"六北-B護理站",DeptCode:"06B"},{StationName:"六南全區",DeptCode:"1314"},{StationName:"六南-C護理站",DeptCode:"06C"},{StationName:"六南-D護理站",DeptCode:"06D"},{StationName:"外北全區",DeptCode:"1311"},{StationName:"外北-A護理站",DeptCode:"07A"},{StationName:"外北-B護理站",DeptCode:"07B"},{StationName:"四南病房",DeptCode:"1302"},{StationName:"全護理站",DeptCode:""}]})}if(Ext.getStore("sWorkStationList2")==null){Ext.create("Ext.data.Store",{storeId:"sWorkStationList2",fields:[{name:"StationName"},{name:"DeptCode"}],data:[{StationName:"我的住院病人",DeptCode:"mypatient"},{StationName:"ICU病房",DeptCode:"1306"},{StationName:"五北全區",DeptCode:"1312"},{StationName:"五北-A護理站",DeptCode:"05A"},{StationName:"五北-B護理站",DeptCode:"05B"},{StationName:"五南全區",DeptCode:"1313"},{StationName:"五南-C護理站",DeptCode:"05C"},{StationName:"五南-D護理站",DeptCode:"05D"},{StationName:"六北全區",DeptCode:"1308"},{StationName:"六北-A護理站",DeptCode:"06A"},{StationName:"六北-B護理站",DeptCode:"06B"},{StationName:"六南全區",DeptCode:"1314"},{StationName:"六南-C護理站",DeptCode:"06C"},{StationName:"六南-D護理站",DeptCode:"06D"},{StationName:"外北全區",DeptCode:"1311"},{StationName:"外北-A護理站",DeptCode:"07A"},{StationName:"外北-B護理站",DeptCode:"07B"},{StationName:"四南病房",DeptCode:"1302"},{StationName:"全護理站",DeptCode:""}]})}},NurseDay:function(){var b=this;try{if(!Ext.isEmpty(Ext.getCmp("_nurseInformationPanel"))){Ext.getCmp("_nurseInformationPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){var a=Ext.create("NisTRApp.view.InformationPanel",{id:"_nurseInformationPanel"});b.overlay=Ext.Viewport.add(a);a=null;delete a}b.overlay.show()}catch(d){console.log(d)}}});Ext.define("NisTRApp.view.Login",{extend:Ext.Container,config:{height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"panel",height:"20%",itemId:"LoginHeadPanel",width:"100%"},{xtype:"panel",height:"80%",width:"100%",items:[{xtype:"fieldset",centered:false,left:"30%",top:"1%",ui:"dark",width:"40%",title:"護理資訊系統-登入",items:[{xtype:"textfield",id:"UserID",margin:"10px",label:"帳號",autoComplete:false,placeHolder:"請輸入使用者帳號"},{xtype:"passwordfield",id:"Password",margin:"10px",label:"密碼",autoComplete:false,placeHolder:"請輸入使用者密碼"},{xtype:"button",html:'<span style="font-family: 微軟正黑體;"> 登 入 </span>',id:"LoginBtn",margin:"10px",ui:"action",text:"MyButton46"}]},{xtype:"label",bottom:0,centered:false,docked:"bottom",itemId:"NisVersionLbl",right:20,ui:"light",width:"50%"}]}],listeners:[{fn:"onLoginBtnTap",event:"tap",delegate:"#LoginBtn"},{fn:"onContainerShow",event:"show"},{fn:"onContainerSysLogout",event:"SysLogout"},{fn:"onContainerPainted",event:"painted"}]},onLoginBtnTap:function(d,g,b){if(Ext.getCmp("UserID").getValue()==null||Ext.getCmp("UserID").getValue()==""){Ext.Msg.alert(SYS_CONST.Warning.SCW1);return}if(Ext.getCmp("UserID").getValue()!=null&&Ext.getCmp("UserID").getValue()!=""){var f=btoa(Ext.getCmp("UserID").getValue().toUpperCase());var h=btoa(Ext.getCmp("Password").getValue());Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});var a=Ext.getStore("sUserInfo");if(a.isLoading()){a=null;delete a;return}a.getProxy().setUrl(NisTRApp.view.SysUtility.ProtalServer()+"/api/authentication/signin.ashx");a.getProxy().setExtraParams({UserID:encodeURIComponent(f),AppID:NisTRApp.view.SysUtility.GetAppID(),Password:encodeURIComponent(h),Flag:"1"});$.ajax({url:NisTRApp.view.SysUtility.ProtalServer()+"/portal/o",type:"get",dataType:"text",timeout:5000,crossDomain:true,xhrFields:{withCredentials:true},beforeSend:function(){},complete:function(){Ext.getStore("sUserConfig").removeAll();NisTRApp.view.SysUtility.RemoveUserInfo();typeof(Portal)!="undefined"&&Portal.doClearCurrentCredential();a.load({callback:function(j,e,l){setTimeout(function(){Ext.Viewport.setMasked(false)},1200);if(l&&!Ext.isEmpty(j)&&j.length>0){try{result=j[0].data;if(Ext.isEmpty(result.Token)||Ext.isEmpty(result.UserID)){NisTRApp.view.SysUtility.RemoveUserInfo();Ext.Msg.alert(SYS_CONST.Warning.SCW3);console.log("LoginPage Error :</Br> 請檢查帳號密碼正確性!!");result=null;delete result;return false}else{NisTRApp.view.UserConfig.LoadUserConfig(function(m,n){if(Ext.isEmpty(Ext.getCmp("WorkList"))){Ext.create("NisTRApp.view.WorkList",{id:"WorkList",fullscreen:true})}NisTRApp.app.setFuncType(NisTRApp.view.UserConfig.GetDefaultPage());Ext.getCmp("WorkList").setRecord(NisTRApp.view.SysUtility.GetUserInfo());Ext.Viewport.animateActiveItem(Ext.getCmp("WorkList"),{type:"slide",direction:"right"})})}result=null;delete result}catch(k){NisTRApp.view.SysUtility.RemoveUserInfo();alert(k);console.log("LoginPage Error : "+k);return false}}else{NisTRApp.view.SysUtility.RemoveUserInfo();Ext.Viewport.setMasked(false);Ext.Msg.alert(SYS_CONST.Warning.SCW4);return false}},scope:this});a=null;delete a}})}},onContainerShow:function(b,e){var a=String.format('<Div><span style="color:blue; font-size:14px; float: right;">{0}</span> <br> <span style="color:DarkSlateGray; font-size:14px; float: right;">{1}</span> <Div>',"Copyright © 2015 Kfsyscc Org. All rights reserved","Version 1.17.6.1");this.down("#NisVersionLbl").setHtml(a);a=null;delete a;var d=$("#UserID");var f=$("#Password");var g=$("#LoginBtn");d.unbind("keyup");f.unbind("keyup");d.on("keyup",function(h){if(h.keyCode==13){f.find("input").focus()}});f.on("keyup",function(h){if(h.keyCode==13){Ext.getCmp("LoginBtn").fireEvent("tap")}});g.parent().css("height","auto");delete d;delete f;delete g;if(Ext.getCmp("UserID")!=null){Ext.getCmp("UserID").setValue(null)}if(Ext.getCmp("Password")!=null){Ext.getCmp("Password").setValue(null)}Ext.getCmp("UserID").focus()},onContainerSysLogout:function(b,d,a){if(Ext.getCmp("UserID")!=null){Ext.getCmp("UserID").setValue("")}if(Ext.getCmp("Password")!=null){Ext.getCmp("Password").setValue("")}console.log("Login UI recive logout notify")},onContainerPainted:function(b,a){},initialize:function(){this.callParent()}});Ext.define("NisTRApp.view.WorkList.OPR.InPatientList",{extend:Ext.Container,alias:"widget.OPR_InPatientList",config:{itemId:"OPR_InPatientList",items:[{xtype:"panel",height:"100%",itemId:"OPR_IPL_MainPanel",width:"100%"},{xtype:"toolbar",docked:"bottom",itemId:"OPR_IPL_ToolBar",width:"100%",items:[{xtype:"datepickerfield",itemId:"OPR_IPL_OprmDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"selectfield",itemId:"OPR_IPL_RoomsFields",width:"20%",label:"手術房間",labelWidth:"50%",displayField:"RoomName",store:"sOprRooms",valueField:"RoomIndex"},{xtype:"segmentedbutton",itemId:"OPR_IPL_FnBtn",width:"500px",items:[{xtype:"button",pressed:true,html:"<div> 全 部 </div>",itemId:"OPR_IPL_AllBtn",width:"16%",text:"MyButton9"},{xtype:"button",html:"<div> 已 報 到  </div>",itemId:"OPR_IPL_ArrBtn",width:"16%",text:"MyButton9"},{xtype:"button",html:"<div> 等 候 中 </div>",itemId:"OPR_IPL_WaitingBtn",width:"16%",text:"MyButton9"},{xtype:"button",html:"<div> 手 術 中 </div>",itemId:"OPR_IPL_OpringBtn",width:"16%",text:"MyButton9"},{xtype:"button",html:"<div>離開手術室</div>",itemId:"OPR_IPL_OprendingBtn",width:"19%",text:"MyButton9"},{xtype:"button",html:"<div> PACU </div>",itemId:"OPR_IPL_PacuBtn",width:"16%",text:"MyButton9"}]},{xtype:"button",itemId:"OPR_IPL_RefreshBtn",margin:"0px 15px 0px 7px",ui:"decline",width:"60px",iconCls:"refresh"}]}],listeners:[{fn:"onOPR_IPL_OprmDatePickerChange",event:"change",delegate:"#OPR_IPL_OprmDatePicker"},{fn:"onOPR_IPL_RoomsFieldsChange",event:"change",delegate:"#OPR_IPL_RoomsFields"},{fn:"onOPR_IPL_AllBtnTap",event:"tap",delegate:"#OPR_IPL_AllBtn"},{fn:"onOPR_IPL_ArrBtnTap",event:"tap",delegate:"#OPR_IPL_ArrBtn"},{fn:"onOPR_IPL_WaitingBtnTap",event:"tap",delegate:"#OPR_IPL_WaitingBtn"},{fn:"onOPR_IPL_OpringBtnTap",event:"tap",delegate:"#OPR_IPL_OpringBtn"},{fn:"onOPR_IPL_OprendingBtnTap",event:"tap",delegate:"#OPR_IPL_OprendingBtn"},{fn:"onOPR_IPL_PacuBtnTap",event:"tap",delegate:"#OPR_IPL_PacuBtn"},{fn:"onOPR_IPL_RefreshBtnTap",event:"tap",delegate:"#OPR_IPL_RefreshBtn"},{fn:"onOPR_InPatientListDestroy",event:"destroy"}]},onOPR_IPL_OprmDatePickerChange:function(d,a,e,b){if(null!=a){this.LoadInPatientList(a)}},onOPR_IPL_RoomsFieldsChange:function(a,e,b,d){this.SetInPatientFilter("OPR_IPL_RoomFilter",function(f){return((e==-1)||(f.data.Room==e))})},onOPR_IPL_AllBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.SetInPatientFilter("OPR_IPL_StatusFilter",function(e){return true})},onOPR_IPL_ArrBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.SetInPatientFilter("OPR_IPL_StatusFilter",function(e){return(e.data.OpStatus=="0")})},onOPR_IPL_WaitingBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.SetInPatientFilter("OPR_IPL_StatusFilter",function(e){return(e.data.OpStatus=="1")})},onOPR_IPL_OpringBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.SetInPatientFilter("OPR_IPL_StatusFilter",function(e){return(e.data.OpStatus=="2")})},onOPR_IPL_OprendingBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.SetInPatientFilter("OPR_IPL_StatusFilter",function(e){return(e.data.OpStatus=="6")||(e.data.OpStatus=="5")||(e.data.OpStatus=="4")})},onOPR_IPL_PacuBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.SetInPatientFilter("OPR_IPL_StatusFilter",function(e){return(e.data.OpStatus=="3")})},onOPR_IPL_RefreshBtnTap:function(b,d,a){this.LoadInPatientList(this.down("#OPR_IPL_OprmDatePicker").getValue())},onOPR_InPatientListDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sOprInPatients"))){var b=Ext.getStore("sOprInPatients");b.each(function(f,d,e){f.destroy()});b.removeAll()}this.removeAll(true,true)},initialize:function(){this.callParent();Ext.getStore("sOprInPatients").addListener("beforeload",function(g,f,h){},this);var a=this;var d=Ext.getCmp("OPR_InPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenOPRInPatientGrid("OPR_InPatGrid","我的病人清單");d.initialFlag=true;d.resetFlag=false;var e=Ext.getStore("sOprInPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapOPRGrid,d);this.down("#OPR_IPL_MainPanel").add(d);d.addListener("painted",NisTRApp.view.UserConfig.onPainted_OprInPatGrid,d);var b=d.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_OprInPatGrid,d);d=null;delete d;b=null;delete b}this.down("#OPR_IPL_OprmDatePicker").setValue(SYS_CONST.SysDate);this.down("#OPR_IPL_AllBtn").fireEvent("tap",this.down("#OPR_IPL_AllBtn"),null,null);a=null;delete a},LoadInPatientList:function(b){var a=function(d){var e=Ext.getStore("sOprInPatients");if(e.isLoading()||String.IsNull(d)){return}e.getProxy().setExtraParams({OprmstDate:d});e.load({callback:function(h,g,l){Ext.Viewport.setMasked(false);var k=Ext.getCmp("OPR_InPatGrid");var f="";if(null!=h&&null!=h[0]){var j=h[0].data;f=String.format("{0} {1}",NisTRApp.view.DateUtil.DateFormat(j.OprmDateTime),"手術病人清單");j=null;delete j}else{f="手術病人清單"}if(null!=k){k.setTitle("<h1>"+f+"</h1>");k.refresh()}f=null;delete f},scope:this});e=null;delete e};a(b);a=null;delete a},ButtonSelect:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#OPR_IPL_FnBtn"),b,"confirm-round","normal","","")},SetInPatientFilter:function(b,e){var d=Ext.getStore("sOprInPatients");var f=d.getFilters();d.clearFilter();if(null!=f){for(var a=0;a<f.length;a++){if(f[a].getId()!=b){d.filter(f[a])}f[a]=null}}d.filter(new Ext.util.Filter({id:b,filterFn:e}));f.length=0;f=null;delete f;if((d.getCount()<=0)){}d=null;delete d}});Ext.define("NisTRApp.view.WorkList.OPR.MyCarePatient",{extend:Ext.Container,alias:"widget.OPR_MyCarePatient",config:{height:"100%",itemId:"OPR_MyCarePatient",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"OPR_MPL_TabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onOPR_MyCarePatientDestroy",event:"destroy"},{fn:"onOPR_MyCarePatientActivate",event:"activate"}]},onOPR_MyCarePatientDestroy:function(a){console.log("On Destroy :","OPR.MyCarePatient");this.removeAll(true,true)},onOPR_MyCarePatientActivate:function(h,b,a,e){if(Ext.isEmpty(this.down("#_oprMPLCareContainer"))){var g=Ext.create("NisTRApp.view.OPR_MPL_CareContainer",{id:"_oprMPLCareContainer",itemId:"_oprMPLCareContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"術後追蹤病人"});this.down("#OPR_MPL_TabPanel").add(g);g=null;delete g}else{this.down("#_oprMPLCareContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_oprMPLFinishedCareContainer"))){var j=Ext.create("NisTRApp.view.OPR_MPL_FinishedCareContainer",{id:"_oprMPLFinishedCareContainer",itemId:"_oprMPLFinishedCareContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"結案病人"});this.down("#OPR_MPL_TabPanel").add(j);j=null;delete j}else{this.down("#_oprMPLFinishedCareContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_oprMPLQueryPatContainer"))){var f=Ext.create("NisTRApp.view.OPR_MPL_QueryPatientsContainer",{id:"_oprMPLQueryPatContainer",itemId:"_oprMPLQueryPatContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"追蹤病人查詢"});this.down("#OPR_MPL_TabPanel").add(f);f=null;delete f}else{this.down("#_oprMPLFinishedCareContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_oprWL_MPS"))){var d=Ext.create("NisTRApp.view.WorkList.OPR.MyPatients",{id:"_oprWL_MPS",itemId:"_oprWL_MPS",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"我的手術病人"});this.down("#OPR_MPL_TabPanel").add(d);d=null;delete d}else{this.down("#_oprWL_MPS").setRecord(this.getRecord())}},initialize:function(){this.callParent()}});Ext.define("NisTRApp.view.WorkList.OPR.Report",{extend:Ext.Container,alias:"widget.OPR_Report",config:{layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"OPRRPT_Main"}],listeners:[{fn:"onContainerActivate",event:"activate"},{fn:"onContainerDestroy",event:"destroy"}]},onContainerActivate:function(f,b,a,e){if(Ext.isEmpty(this.down("#_oprRptAntiTransLog"))){var d=Ext.create("NisTRApp.view.OPR_RPT_ANTIMTRANSLOG",{id:"_oprRptAntiTransLog",itemId:"_oprRptAntiTransLog",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"手術轉檔"});this.down("#OPRRPT_Main").add(d);d=null;delete d}else{this.down("#_oprRptAntiTransLog").setRecord(this.getRecord())}},onContainerDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent()}});Ext.define("NisTRApp.view.WorkList.OPR",{extend:Ext.Container,alias:"widget.WL_OPR",config:{layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"WL_OPR_TabPanel",layout:{animation:false,type:"card"},items:[{xtype:"OPR_InPatientList",itemId:"WorkList.OPR.InPatientList",title:"手術清單"},{xtype:"OPR_MyCarePatient",itemId:"WorkList.OPR.MyCarePatient",title:"追蹤病人"}]}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){console.log("On Destroy :","WorkList.OPR");this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.down("#_oprReport"))){var a=Ext.create("NisTRApp.view.WorkList.OPR.Report",{id:"_oprReport",itemId:"_oprReport",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"報表"});this.down("#WL_OPR_TabPanel").add(a);a=null;delete a}}});Ext.define("NisTRApp.view.WorkList.ACC",{extend:Ext.Container,alias:"widget.WL_ACC",config:{layout:{type:"fit"},items:[{xtype:"tabpanel",items:[{xtype:"container",title:"Tab 1"}]}]}});Ext.define("NisTRApp.view.WorkList.MainPanel",{extend:Ext.Container,config:{html:"",itemId:"WL_MainPanel"}});Ext.define("NisTRApp.view.MainUI",{extend:Ext.Container,config:{id:"MainUI",layout:{type:"fit"},patient:{},listeners:[{fn:"onMainUIDestroy",event:"destroy"}]},onMainUIDestroy:function(a){console.log("On Destroy","Main UI");this.removeAll(true,true)},toggleContainer:function(){if(!Ext.isEmpty(this.down(".slidenavigationview"))){this.down(".slidenavigationview").toggleContainer()}},selectPage:function(a){if(!Ext.isEmpty(this.down(".slidenavigationview"))){this.down(".slidenavigationview").list.select(a)}}});Ext.define("NisTRApp.view.OPD_PatInfoBar",{extend:Ext.Toolbar,alias:"widget.OPD_PatInfoBar",config:{cls:"opd-toolbar",docked:"top",height:55,regPatient:{},items:[{xtype:"button",html:'<img src="../_/img/list_bullets.png" width="25px" height="14px">',itemId:"LeftList",width:"55px",text:"MyButton16"},{xtype:"button",html:"<h1> 清 單 </h1>",itemId:"PatientListBtn",width:"55px",text:"MyButton17"},{xtype:"label",html:"Patient Name",itemId:"PP_PtNameLbl",left:"130px",tpl:Ext.create("Ext.XTemplate","<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"   ","</td>",' <td rowspan="1" align="left" width="110px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="280px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"    {BirthdayStr} ({Age}) {BloodType} &nbsp;","</span>",'<span style="font-weight: bold;color:red; font-size: 13px;">',"    {[this.IsMutiBloodStr(values.IsMutiBlood)]}&nbsp;","</span>",'<span style="font-weight: bold;color:#ff66ff; font-size: 13px;">',"    登入.{[this.LoginUser()]}","</span>",'    <br style="line-height:0.1;">',"    ",'    <tpl if="Ext.isEmpty(values.Regregm)">','    	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">非門診就醫紀錄</span>',"    </tpl>","    ",'     <tpl if="!Ext.isEmpty(values.Regregm)">','        <tpl for="Regregm">','        <span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"            Dr.{DocName} / </span>",'        <span style="font-weight:bold; color:Linen;font-size: 13px;">',"            序 {ChartSeq} / {RegDate}</span>","        </tpl>","    </tpl>","","</td>","</tr>","</table>",{IsMutiBloodStr:function(b){var a="";if(b==true){a="(多)"}return a},LoginUser:function(){return NisTRApp.view.SysUtility.GetUserName("OPD_PatInfoBar")}})},{xtype:"button",itemId:"AllergyBtn",right:"364px",top:"4px",ui:"round",width:"53px",text:"過敏"},{xtype:"button",itemId:"IcdTypeBtn",right:"306px",top:"4px",ui:"round",width:"53px",text:"感染"},{xtype:"button",itemId:"SuicideBtn",right:"248px",top:"4px",ui:"round",width:"53px",text:"自傷"},{xtype:"button",itemId:"DnrBtn",right:"190px",top:"4px",ui:"round",width:"53px",text:"DNR"},{xtype:"button",html:"<h1>Notes</h1>",itemId:"PP_PatNotesBtn",right:"75px",top:"4px",width:"110px",text:"MyButton18"},{xtype:"button",flex:0,html:"<h1> 登 出 </h1>",itemId:"PP_LogoutBtn",right:"5px",top:"4px",width:"60px",text:"MyButton15"}],listeners:[{fn:"onLeftListTap",event:"tap",delegate:"#LeftList"},{fn:"onPatientListBtnTap",event:"tap",delegate:"#PatientListBtn"},{fn:"onAllergyBtnTap",event:"tap",delegate:"#AllergyBtn"},{fn:"onPP_PatNotesBtnTap",event:"tap",delegate:"#PP_PatNotesBtn"},{fn:"onPP_LogoutBtnTap",event:"tap",delegate:"#PP_LogoutBtn"}]},onLeftListTap:function(b,d,a){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").toggleContainer()}d.preventDefault()},onPatientListBtnTap:function(f,j,d){if(Ext.isEmpty(Ext.getCmp("WorkList"))){Ext.create("NisTRApp.view.WorkList",{id:"WorkList",fullscreen:true})}Ext.getStore("sRegPatient").removeAll();Ext.getStore("sPhePatient").removeAll();var h=Ext.ComponentQuery.query(".container");for(var b in h){try{h[b].fireEvent("BackToList",h[b])}catch(g){continue}}Ext.Viewport.setActiveItem(Ext.getCmp("WorkList"));function a(){var e=window.setTimeout(function(){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").destroy();window.clearTimeout(e)}},150)}location.hash="";a()},onAllergyBtnTap:function(b,d,a){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").selectPage(SYS_CONST.PageDef.Allergy.OPD)}},onPP_PatNotesBtnTap:function(d,f,b){var a=function a(j,g,h){if(!Ext.isEmpty(Ext.getCmp("_commonPanel"))){Ext.getCmp("_commonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_commonPanel"))){var e=Ext.create("NisTRApp.view.CommonPanel",{id:"_commonPanel",modal:true,centered:true,record:j,hideOnMaskTap:false,height:"95%",width:"95%",caller:g,defaultPage:h,hiddens:["OPR","RIS","ENDO"]});g.overlay=Ext.Viewport.add(e);g.overlay.show();e=null;delete e}g=null;delete g;j=null;delete j;wi=null;delete wi;he=null;delete he};a(this.getRecord(),this,"MED");a=null;delete a},onPP_LogoutBtnTap:function(b,d,a){NisTRApp.view.SysUtility.Logout()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)){this.down("#PP_PtNameLbl").setRecord(null)}var f=this.getRecord();this.down("#PP_PtNameLbl").setRecord(f);var b="",g="",v="",l="",u="",q="",a="";var m="",o="",e="",k="",p="",n="";var j="round",h="round",d="round",r="round",s="round";b="color:white;";g="color:white;";v="color:white;";l="color:white;";u="color:white;";if(f.data.Risk=="N"){b="color:grey;";j="round"}else{j="decline-round"}if(f.data.Allergy==0){g="";h="confirm-round"}else{if(f.data.Allergy==1){h="decline-round"}else{h="round"}}if(f.data.IcdType==""){v="color:grey;";d="round"}else{d="decline-round"}if(f.data.Suicide==""){l="color:grey;";r="round"}else{r="decline-round"}if(f.data.Dnr==""){u="color:grey;";s="round"}else{s="decline-round"}this.down("#PP_PatNotesBtn").setHtml("");this.down("#PP_PatNotesBtn").setHtml("<h1>"+f.data.PatIdNo+"</h1>");this.down("#AllergyBtn").setStyle(g);this.down("#AllergyBtn").setText("過敏");this.down("#AllergyBtn").setUi(h);this.down("#IcdTypeBtn").setStyle(v);this.down("#IcdTypeBtn").setText("感染");this.down("#IcdTypeBtn").setUi(d);this.down("#SuicideBtn").setStyle(l);this.down("#SuicideBtn").setText("自傷");this.down("#SuicideBtn").setUi(r);this.down("#DnrBtn").setStyle(u);this.down("#DnrBtn").setHtml("DNR");this.down("#DnrBtn").setUi(s);b=null;delete b;g=null;delete g;v=null;delete v;l=null;delete l;u=null;delete u;f=null;delete f}});Ext.define("NisTRApp.view.Profile.PtLab",{extend:Ext.Container,alias:"widget.PtLab",config:{width:"100%",layout:{type:"fit"},patient:{},items:[{xtype:"panel",height:"100%",html:'<div id="ptLabContainer" style="width: 100%; height: 100%;"></div>',itemId:"ptLContentPanel",style:"overflow: auto; -webkit-overflow-scrolling: touch;",width:"100%",scrollable:"vertical"}],listeners:[{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerErased",event:"erased"},{fn:"onContainerShow",event:"show"}]},onContainerPainted:function(b,a){this.loadList("ext-PtLab-1");$("#ptLabContainer").html("")},onContainerDestroy:function(a){$("#ptLabContainer").html("");this.removeAll(true,true);if(Ext.getStore("sPtLabList")!=null){Ext.getStore("sPtLabList").removeAll();Ext.getStore("sPtLabList").destroy()}},onContainerErased:function(a,b){NisTRApp.view.FormUtil.ResetContentDiv("ptLabContainer",this.down("#ptLContentPanel"))},onContainerShow:function(a,b){},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("PtLab 病人資料錯誤");return false}if(Ext.getStore("sPtLabList")==null){Ext.create("Ext.data.Store",{clearOnPageLoad:false,storeId:"sPtLabList",model:"NisTRApp.model.Profile.ptData",remoteSort:true,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Patient/ptSummaryList.ashx",reader:{type:"json",idProperty:"ptRecordListItems"}},grouper:{groupFn:function(a){return a.get("summaryGroup")}}})}},loadList:function(b){var e=this.getRecord();if(Ext.isEmpty(e)){e=null;delete e;return}var d=this;Ext.getStore("sPtLabList").removeAll();var a=Ext.getStore("sPtLabList");a.getProxy().setExtraParams({type:"ext-PtLab-1",ChartNo:e.data.ChartNo});d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});a.load({callback:function(){d.setMasked(false);var h=e.data.ChartNo;var g="BCEHIMSTUD";var f=$("#ptLabContainer");f.addClass("globalList");f.html('<table style="width: 1030px;"><thead><tr></tr></thead><tbody></tbody></table>');$(["檢查日期","細菌","生化","緊急生化","血液","免疫","多用","屎","輸血檢查<br/>(血型)","尿","防疫"]).each(function(j,l){var k=$("<th/>").html(this.toString().replace(/(\d{4})(\d{2})(\d{2})/,"$1-$2-$3")).css({width:"170px",textAlign:"center"});if(j>0){k.on("click",function(){var m={};m.ChartNo=h;m.TEAM=g[j-1];NisApp.view.NisPDFUtil.createProfileContent(null,"311",m);m=null;delete m}).css({width:"86px"})}f.find("thead tr:first()").append(k);k=null;delete k});$(Ext.getStore("sPtLabList").data.all).each(function(){var m=JSON.parse(this.raw.summaryRaw);var l=$("<tr/>");l.append($("<td/>").html(m.SysDate)).css({textAlign:"center"});for(var j=0;j<g.length;j++){var k=g[j];var n=$("<td/>").attr("_TEAM",k).attr("_date",m.SysDate).html(m[k+"Cnt"]).css({textAlign:"center"}).on("click",function(){if($(this).html().trim().length>0){var q=$(this).attr("_TEAM");var o=$(this).attr("_date");var p={};p.ChartNo=h;p.TEAM=q;p.Sysdate=o;NisApp.view.NisPDFUtil.createProfileContent(null,"312",p);p=null;delete p;q=null;delete q;o=null;delete o}});l.append(n);n=null;delete n;k=null;delete k}f.find("tbody").append(l);l=null;delete l;m=null;delete m});d=null;delete d;f=null;delete f}});a=null;delete a}});Ext.define("NisTRApp.view.Profile.PtRecord",{extend:Ext.Container,alias:"widget.PtRecord",config:{height:"100%",width:"100%",layout:{type:"hbox"},patient:{},items:[{xtype:"panel",width:"20%",layout:{type:"fit"},items:[{xtype:"list",id:"ptRecordList",itemId:"",emptyText:'<div style="width:auto; text-align:center; padding-bottom:30%; color:red; font-weight:bold;">無資料.</div>',itemTpl:['<div style="word-break: break-all;">{summaryName}</div>'],scrollToTopOnRefresh:false,grouped:true,plugins:[{type:"pullrefresh"}]}]},{xtype:"panel",height:"100%",hidden:false,html:'<div id="ptRecordContainer" style="width: 100%; height: 100%;"></div>\'',itemId:"ptRContentPanel",width:"80%",items:[{xtype:"toolbar",docked:"top",hidden:true,id:"ptRecordToolBar",items:[{xtype:"button",itemId:"mybutton31",width:"15%",text:"入院病摘"},{xtype:"button",itemId:"mybutton32",width:"15%",text:"病程記錄"},{xtype:"button",itemId:"mybutton33",width:"15%",text:"醫囑記錄"},{xtype:"button",itemId:"mybutton34",width:"15%",text:"出院計畫"},{xtype:"button",itemId:"mybutton35",width:"15%",text:"出院病摘"},{xtype:"button",itemId:"mybutton36",width:"15%",text:"住院藥物"}]},{xtype:"container",height:"100%",html:'<div id="_RecordProgressNote" class="globalList" style="width: 99%; height: 99%;"></div>',id:"RecordProgressNote",itemId:"",width:"100%",listeners:[{fn:function(b,a){$("#_RecordProgressNote").html("Loading");try{var f=JSON.parse(localStorage.rawProfileData);Ext.Ajax.request({url:"../api/Search/ProgressNote.ashx",scope:this,method:"POST",params:{chartNo:f.ChartNo,inpNo:f.OrdNo},success:function(e){if(null==e||null==e.responseText||""==e.responseText){$("#_RecordProgressNote").html("沒有資料");return}else{var k=Ext.decode(e.responseText);if(null==k||null==k[0]){$("#_RecordProgressNote").html("沒有資料");return}if(!$("#_RecordProgressNoteTable").size()){$("#_RecordProgressNote").html("");$('<table id="_RecordProgressNoteTable"  ></table>').appendTo($("#_RecordProgressNote"));$("#_RecordProgressNoteTable").append("<tbody>");for(var h=0;h<k.length;h++){var g=k[h];var j=g.NoteType;if(g.Problem!=""&&g.Problem!=null){j=j+"-"+g.Problem}$("#_RecordProgressNoteTable").append('<tr><td><div style="word-wrap: break-word;"><pre style="white-space: pre-wrap";>'+Ext.String.htmlEncode(g.Note)+"</pre> </div></td></tr>")}$("#_RecordProgressNoteTable").append("</tbody>")}}delete localStorage.rawProfileData},failure:function(){}});f=null;delete f}catch(d){}},event:"painted"}]},{xtype:"container",height:"100%",id:"RecordOrderHistory",itemId:"",width:"100%",items:[{xtype:"list",height:"100%",id:"OrderHistoryList",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-bottom:30%; color:red; font-weight:bold;">無資料.</div>',itemTpl:['<div><pre style="word-break: break-all; word-wrap: break-word;">{Note}</pre></div>',""],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:function(e,d){if(null==localStorage.rawProfileData||""==localStorage.rawProfileData||localStorage.rawProfileData==undefined){return}var b=Ext.getStore("sOrderHistory_PTR");var a=null;b.removeAll();if(localStorage.rawProfileData!=undefined){a={data:JSON.parse(localStorage.rawProfileData)};delete localStorage.rawProfileData}b.getProxy().setExtraParams({chartNo:a.data.ChartNo,inpNo:a.data.InpNo||a.data.OrdNo,limit:5});b.loadPage(1,null,this);Ext.getCmp("OrderHistoryList").setStore(b);b=null;delete b;a=null;delete a},event:"painted"}]}]}],listeners:[{fn:"onPtRecordListItemTap",event:"itemtap",delegate:"#ptRecordList"},{fn:"onContainerPainted",event:"painted"},{fn:"onMybutton31Tap",event:"tap",delegate:"#mybutton31"},{fn:"onMybutton32Tap",event:"tap",delegate:"#mybutton32"},{fn:"onMybutton33Tap",event:"tap",delegate:"#mybutton33"},{fn:"onMybutton34Tap",event:"tap",delegate:"#mybutton34"},{fn:"onMybutton35Tap",event:"tap",delegate:"#mybutton35"},{fn:"onMybutton36Tap",event:"tap",delegate:"#mybutton36"},{fn:"onRecordProgressNoteErased",event:"erased",delegate:"#RecordProgressNote"},{fn:"onRecordProgressNoteHide",event:"hide",delegate:"#RecordProgressNote"},{fn:"onRecordOrderHistoryErased",event:"erased",delegate:"#RecordOrderHistory"},{fn:"onRecordOrderHistoryHide",event:"hide",delegate:"#RecordOrderHistory"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerErased",event:"erased"},{fn:"onContainerShow",event:"show"}]},onPtRecordListItemTap:function(b,d,h,a,g,f){console.log(JSON.parse(a.raw.summaryRaw));NisApp.view.NisPDFUtil.createProfileContent($(b.observableId.replace(/List$/,"Container")),a.raw.summaryGroup,JSON.parse(a.raw.summaryRaw))},onContainerPainted:function(b,a){var d=this;d.loadList("ext-PtRecord-1");Ext.getCmp("ptRecordList").getPlugins()[0].clearListeners();Ext.getCmp("ptRecordList").getPlugins()[0].setListeners({latestfetched:function(e){}});Ext.getCmp("RecordProgressNote").setHidden(true);Ext.getCmp("RecordOrderHistory").setHidden(true);$("#ptRecordContainer").html("")},onMybutton31Tap:function(f,g,d){var b=Ext.getCmp("ptRecordList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round");b=null;delete b;a=null;delete a},onMybutton32Tap:function(f,g,d){var b=Ext.getCmp("ptRecordList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round");b=null;delete b;a=null;delete a},onMybutton33Tap:function(f,g,d){var b=Ext.getCmp("ptRecordList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round");b=null;delete b;a=null;delete a},onMybutton34Tap:function(f,g,d){var b=Ext.getCmp("ptRecordList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round");b=null;delete b;a=null;delete a},onMybutton35Tap:function(f,g,d){var b=Ext.getCmp("ptRecordList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round");b=null;delete b;a=null;delete a},onMybutton36Tap:function(f,g,d){var b=Ext.getCmp("ptRecordList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round");b=null;delete b;a=null;delete a},onRecordProgressNoteErased:function(a,b){$("#_RecordProgressNote").html("沒有資料")},onRecordProgressNoteHide:function(a,b){$("#_RecordProgressNote").html("沒有資料")},onRecordOrderHistoryErased:function(b,d){var a=Ext.getStore("sOrderHistory_PTR");if(null!=a){a.removeAll()}a=null;delete a},onRecordOrderHistoryHide:function(b,d){var a=Ext.getStore("sOrderHistory_PTR");if(null!=a){a.removeAll()}a=null;delete a},onContainerDestroy:function(a){NisTRApp.view.FormUtil.ResetContentDiv("ptRecordContainer",this.down("#ptRContentPanel"));if(Ext.getStore("sPtRecordList")!=null){Ext.getStore("sPtRecordList").removeAll();Ext.getStore("sPtRecordList").destroy()}if(Ext.getStore("sOrderHistory")!=null){Ext.getStore("sOrderHistory_PTR").removeAll();Ext.getStore("sOrderHistory_PTR").destroy()}this.removeAll(true,true)},onContainerErased:function(a,b){NisTRApp.view.FormUtil.ResetContentDiv("ptRecordContainer",this.down("#ptRContentPanel"))},onContainerShow:function(a,b){},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("PtRecord 病人資料錯誤");return false}if(Ext.getStore("sPtRecordList")==null){Ext.create("Ext.data.Store",{clearOnPageLoad:false,storeId:"sPtRecordList",model:"NisTRApp.model.Profile.ptData",remoteSort:true,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Patient/ptSummaryList.ashx",reader:{type:"json",idProperty:"ptRecordListItems"}},grouper:{groupFn:function(a){return a.get("summaryGroup")}}})}if(Ext.getStore("sOrderHistory_PTR")==null){Ext.create("Ext.data.Store",{clearOnPageLoad:false,model:"NisTRApp.model.Note.WdisprognoteEntity",storeId:"sOrderHistory_PTR",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Search/OrderHistory.ashx",reader:{type:"json"}}})}},loadList:function(b){var a=Ext.getStore("sPtRecordList");var d=this.getRecord();if(a.isLoading()||d==null){return}var a=Ext.getStore("sPtRecordList");a.removeAll();a.getProxy().setExtraParams({type:"ext-PtRecord-1",ChartNo:d.data.ChartNo,});a.load();Ext.getCmp("ptRecordList").setStore(a);d=null;delete d;a=null;delete a}});Ext.define("NisTRApp.view.Profile.PtExam",{extend:Ext.Container,alias:"widget.PtExam",config:{height:"100%",width:"100%",layout:{type:"hbox"},patient:{},items:[{xtype:"panel",height:"100%",width:"20%",layout:{type:"fit"},items:[{xtype:"list",id:"ptExamList",itemId:"mylist2",emptyText:'<div style="width:auto; text-align:center; padding-bottom:30%; color:red; font-weight:bold;">無資料.</div>',itemTpl:['<div style="word-break: break-all;">{summaryName}</div>'],scrollToTopOnRefresh:false,grouped:true,plugins:[{type:"pullrefresh"}]}]},{xtype:"panel",height:"100%",html:'<div id="ptExamContainer" style="width: 100%; height: 100%;"></div>',id:"",itemId:"ptEContentPanel",width:"80%",items:[{xtype:"toolbar",docked:"top",hidden:true,id:"ptExamToolBar",items:[{xtype:"button",itemId:"mybutton37",width:"25%",text:"報告"},{xtype:"button",itemId:"mybutton38",width:"25%",text:"影像"}]}]}],listeners:[{fn:"onPtExamListItemTap",event:"itemtap",delegate:"#ptExamList"},{fn:"onMybutton37Tap",event:"tap",delegate:"#mybutton37"},{fn:"onMybutton38Tap",event:"tap",delegate:"#mybutton38"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerErased",event:"erased"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onPtExamListItemTap:function(b,d,h,a,g,f){console.log(JSON.parse(a.raw.summaryRaw));NisApp.view.NisPDFUtil.createProfileContent($(b.observableId.replace(/List$/,"Container")),a.raw.summaryGroup,JSON.parse(a.raw.summaryRaw))},onMybutton37Tap:function(f,g,d){var b=Ext.getCmp("ptExamList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round")},onMybutton38Tap:function(f,g,d){var b=Ext.getCmp("ptExamList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round")},onContainerPainted:function(b,a){var d=this;d.loadList("ext-PtExam-5");Ext.getCmp("ptExamList").getPlugins()[0].clearListeners();Ext.getCmp("ptExamList").getPlugins()[0].setListeners({latestfetched:function(e){d.loadList(b)}});$("#ptExamContainer").html("")},onContainerErased:function(a,b){Ext.getStore("sPtExamList").removeAll();NisTRApp.view.FormUtil.ResetContentDiv("ptExamContainer",this.down("#ptEContentPanel"))},onContainerDestroy:function(a){NisTRApp.view.FormUtil.ResetContentDiv("ptExamContainer",this.down("#ptEContentPanel"));if(Ext.getStore("sPtExamList")!=null){Ext.getStore("sPtExamList").removeAll();Ext.getStore("sPtExamList").destroy()}this.removeAll(true,true)},onContainerShow:function(a,b){},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("PtExam 病人資料錯誤");return false}if(Ext.getStore("sPtExamList")==null){Ext.create("Ext.data.Store",{clearOnPageLoad:false,storeId:"sPtExamList",model:"NisTRApp.model.Profile.ptData",remoteSort:true,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Patient/ptSummaryList.ashx",reader:{type:"json",idProperty:"ptRecordListItems"}},grouper:{groupFn:function(a){return a.get("summaryGroup")}}})}},loadList:function(b){var d=this.getRecord();if(d==null){d=null;delete d;return}var a=Ext.getStore("sPtExamList");a.removeAll();a.getProxy().setExtraParams({type:"ext-PtExam-5",ChartNo:d.data.ChartNo});a.load();Ext.getCmp("ptExamList").setStore(a);a=null;delete a;d=null;delete d}});Ext.define("NisTRApp.view.Profile.PtTreat",{extend:Ext.Container,alias:"widget.PtTreat",config:{height:"100%",width:"100%",layout:{type:"hbox"},patient:{},items:[{xtype:"panel",height:"100%",width:"20%",layout:{type:"fit"},items:[{xtype:"list",id:"ptTreatList",itemId:"mylist3",emptyText:'<div style="width:auto; text-align:center; padding-bottom:30%; color:red; font-weight:bold;">無資料.</div>',itemTpl:['<div style="word-break: break-all;">{summaryName}</div>'],scrollToTopOnRefresh:false,grouped:true,plugins:[{type:"pullrefresh"}]}]},{xtype:"panel",height:"100%",html:'<div id="ptTreatContainer" style="width: 100%; height: 100%;"></div>',itemId:"ptTContentPanel",width:"80%",items:[{xtype:"toolbar",docked:"top",hidden:true,id:"ptTreatToolBar",items:[{xtype:"button",itemId:"mybutton40",width:"25%",text:"處方"},{xtype:"button",itemId:"mybutton39",width:"25%",text:"入院前評估"}]}]}],listeners:[{fn:"onPtTreatListItemTap",event:"itemtap",delegate:"#ptTreatList"},{fn:"onMybutton40Tap",event:"tap",delegate:"#mybutton40"},{fn:"onMybutton39Tap",event:"tap",delegate:"#mybutton39"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerErased",event:"erased"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onPtTreatListItemTap:function(b,d,h,a,g,f){console.log(JSON.parse(a.raw.summaryRaw));NisApp.view.NisPDFUtil.createProfileContent($(b.observableId.replace(/List$/,"Container")),a.raw.summaryGroup,JSON.parse(a.raw.summaryRaw))},onMybutton40Tap:function(f,g,d){var b=Ext.getCmp("ptTreatList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round")},onMybutton39Tap:function(f,g,d){var b=Ext.getCmp("ptTreatList").selected.items[0].raw;var a=0;$(f.parent.innerItems).each(function(e,h){if(h.id==f.id){a=e}});a++;NisApp.view.NisPDFUtil.createProfileContent($(f.parent.observableId.replace(/ToolBar$/,"Container")),b.summaryGroup.replace(/^([\d]{2})-(.+)$/,"$1"+a+"-$2"),JSON.parse(b.summaryRaw));f.active=true;f.setUi("confirm-round")},onContainerPainted:function(b,a){var d=this;d.loadList("ext-PtTreat-5");Ext.getCmp("ptTreatList").getPlugins()[0].clearListeners();Ext.getCmp("ptTreatList").getPlugins()[0].setListeners({latestfetched:function(e){d.loadList(b)}});$("#ptTreatContainer").html("")},onContainerErased:function(a,b){NisTRApp.view.FormUtil.ResetContentDiv("ptTreatContainer",this.down("#ptTContentPanel"))},onContainerDestroy:function(a){NisTRApp.view.FormUtil.ResetContentDiv("ptTreatContainer",this.down("#ptTContentPanel"));if(Ext.getStore("sPtTreatList")!=null){Ext.getStore("sPtTreatList").removeAll();Ext.getStore("sPtTreatList").destroy()}this.removeAll(true,true)},onContainerShow:function(a,b){},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("PtTreat 病人資料錯誤");return false}if(Ext.getStore("sPtTreatList")==null){Ext.create("Ext.data.Store",{clearOnPageLoad:false,storeId:"sPtTreatList",model:"NisTRApp.model.Profile.ptData",remoteSort:true,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Patient/ptSummaryList.ashx",reader:{type:"json",idProperty:"ptRecordListItems"}},grouper:{groupFn:function(a){return a.get("summaryGroup")}}})}},loadList:function(b){var d=this.getRecord();if(d==null){d=null;delete d;return}var a=Ext.getStore("sPtTreatList");a.removeAll();a.getProxy().setExtraParams({type:"ext-PtTreat-5",ChartNo:d.data.ChartNo});a.load();Ext.getCmp("ptTreatList").setStore(a);d=null;delete d;a=null;delete a}});Ext.define("NisTRApp.view.Profile",{extend:Ext.Container,alias:"widget.Profile",config:{height:"100%",width:"100%",layout:{type:"fit"},patient:{},items:[{xtype:"tabpanel",itemId:"Profile_MainTabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("Profile 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&(Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp()))){Ext.Msg.alert("Profile 住院病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("Profile 門診病人資料錯誤");return false}if(this.getRecord().data.Source.Type==2){if(Ext.isEmpty(this.down("#_profileInpPtSummary"))){var g=Ext.create("NisTRApp.view.Profile.Summary",{itemId:"_profileInpPtSummary",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"基本資料"});this.down("#Profile_MainTabPanel").add(g);g=null;delete g}if(Ext.isEmpty(this.down("#_profileInpPtShift"))){var d=Ext.create("NisTRApp.view.Profile.Shift",{itemId:"_profileInpPtShift",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"交班作業"});this.down("#Profile_MainTabPanel").add(d);d=null;delete d}}if(Ext.isEmpty(this.down("#_profilePtRecord"))){var b=Ext.create("NisTRApp.view.Profile.PtRecord",{itemId:"_profilePtRecord",patient:this.getRecord(),record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"醫療紀錄"});this.down("#Profile_MainTabPanel").add(b);b=null;delete b}if(Ext.isEmpty(this.down("#_profilePtLab"))){var f=Ext.create("NisTRApp.view.Profile.PtLab",{itemId:"_profilePtLab",patient:this.getRecord(),record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"檢驗資料"});this.down("#Profile_MainTabPanel").add(f);f=null;delete f}if(Ext.isEmpty(this.down("#_profilePtExam"))){var e=Ext.create("NisTRApp.view.Profile.PtExam",{itemId:"_profilePtExam",patient:this.getRecord(),record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"檢查報告"});this.down("#Profile_MainTabPanel").add(e);e=null;delete e}if(Ext.isEmpty(this.down("#_profilePtTreat"))){var a=Ext.create("NisTRApp.view.Profile.PtTreat",{itemId:"_profilePtTreat",patient:this.getRecord(),record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"醫療處置"});this.down("#Profile_MainTabPanel").add(a);a=null;delete a}}});Ext.define("NisTRApp.view.INP_PatInfoBar",{extend:Ext.Toolbar,alias:"widget.INP_PatInfoBar",config:{docked:"top",height:55,inpPatient:{},items:[{xtype:"button",html:'<img src="../_/img/list_bullets.png" width="25px" height="14px">',itemId:"LeftList",width:"55px",text:"MyButton16"},{xtype:"button",html:"<h1> 清 單 </h1>",itemId:"PatientListBtn",width:"55px",text:"MyButton17"},{xtype:"label",html:"Patient Name",itemId:"PP_PtNameLbl",left:"130px",tpl:Ext.create("Ext.XTemplate","<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="110px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="280px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"    {BirthdayStr} ({Age}) {BloodType} &nbsp;","</span>",'<span style="font-weight: bold;color:red; font-size: 13px;">',"    {[this.IsMutiBloodStr(values.IsMutiBlood)]}&nbsp;","</span>",'<span style="font-weight: bold;color:#ff66ff; font-size: 13px;">',"    登入.{[this.LoginUser()]}","</span>",'    <br style="line-height:0.1;">','    <tpl for="Ipbinp">','    <span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        Dr.{NowDocName1} / {NowDocName2} </span>",'    <span style="font-weight:bold; color:Linen;font-size: 13px;">',"         {NowStationno}-{NowBedNo}</span>","    </tpl>","</td>","</tr>","</table>","","","","",{IsMutiBloodStr:function(b){var a="";if(b==true){a="(多)"}return a},LoginUser:function(){return NisTRApp.view.SysUtility.GetUserName("INP_PatInfoBar")}})},{xtype:"button",itemId:"HighRiskBtn",right:"422px",top:"4px",ui:"round",width:"53px",text:"診斷"},{xtype:"button",itemId:"AllergyBtn",right:"364px",top:"4px",ui:"round",width:"53px",text:"過敏"},{xtype:"button",itemId:"IcdTypeBtn",right:"306px",top:"4px",ui:"round",width:"53px",text:"感染"},{xtype:"button",itemId:"SuicideBtn",right:"248px",top:"4px",ui:"round",width:"53px",text:"自傷"},{xtype:"button",itemId:"DnrBtn",right:"190px",top:"4px",ui:"round",width:"53px",text:"DNR"},{xtype:"button",html:"<h1>Notes</h1>",itemId:"PP_PatNotesBtn",right:"75px",top:"4px",width:"110px",text:"MyButton18"},{xtype:"button",flex:0,html:"<h1> 登 出 </h1>",itemId:"PP_LogoutBtn",right:"5px",top:"4px",width:"60px",text:"MyButton15"}],listeners:[{fn:"onLeftListTap",event:"tap",delegate:"#LeftList"},{fn:"onPatientListBtnTap",event:"tap",delegate:"#PatientListBtn"},{fn:"onAllergyBtnTap",event:"tap",delegate:"#AllergyBtn"},{fn:"onPP_PatNotesBtnTap",event:"tap",delegate:"#PP_PatNotesBtn"},{fn:"onPP_LogoutBtnTap",event:"tap",delegate:"#PP_LogoutBtn"}]},onLeftListTap:function(b,d,a){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").toggleContainer()}d.preventDefault()},onPatientListBtnTap:function(f,j,d){if(Ext.isEmpty(Ext.getCmp("WorkList"))){Ext.create("NisTRApp.view.WorkList",{id:"WorkList",fullscreen:true})}var h=Ext.ComponentQuery.query(".container");for(var b in h){try{h[b].fireEvent("BackToList",h[b])}catch(g){continue}}Ext.Viewport.setActiveItem(Ext.getCmp("WorkList"));function a(){var e=window.setTimeout(function(){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").destroy();window.clearTimeout(e)}},150)}location.hash="";a()},onAllergyBtnTap:function(b,d,a){if(!Ext.isEmpty(Ext.getCmp("MainUI"))){Ext.getCmp("MainUI").selectPage(SYS_CONST.PageDef.Allergy.INP)}},onPP_PatNotesBtnTap:function(d,f,b){var a=function a(j,g,h){if(!Ext.isEmpty(Ext.getCmp("_commonPanel"))){Ext.getCmp("_commonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_commonPanel"))){var e=Ext.create("NisTRApp.view.CommonPanel",{id:"_commonPanel",modal:true,centered:true,record:j,hideOnMaskTap:false,height:"95%",width:"95%",caller:g,defaultPage:h,hiddens:["OPR","RIS","ENDO"]});g.overlay=Ext.Viewport.add(e);g.overlay.show();e=null;delete e}g=null;delete g;j=null;delete j;wi=null;delete wi;he=null;delete he};a(this.getRecord(),this,"INPINFO");a=null;delete a},onPP_LogoutBtnTap:function(b,d,a){NisTRApp.view.SysUtility.Logout()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)){this.down("#PP_PtNameLbl").setRecord(null)}var f=this.getRecord();this.down("#PP_PtNameLbl").setRecord(f);var b="",g="",v="",l="",u="",q="",a="";var m="",o="",e="",k="",p="",n="";var j="round",h="round",d="round",r="round",s="round";b="color:white;";g="color:white;";v="color:white;";l="color:white;";u="color:white;";if(f.data.Risk=="N"){b="color:grey;";j="round"}else{j="decline-round"}if(f.data.Allergy==0){g="";h="confirm-round"}else{if(f.data.Allergy==1){h="decline-round"}else{h="round"}}if(f.data.IcdType==""){v="color:grey;";d="round"}else{d="decline-round"}if(f.data.Suicide==""){l="color:grey;";r="round"}else{r="decline-round"}if(f.data.Dnr==""){u="color:grey;";s="round"}else{s="decline-round"}this.down("#PP_PatNotesBtn").setHtml("");this.down("#PP_PatNotesBtn").setHtml("<h1>"+f.data.PatIdNo+"</h1>");this.down("#HighRiskBtn").setStyle(b);this.down("#HighRiskBtn").setText("診斷");this.down("#HighRiskBtn").setUi(j);this.down("#AllergyBtn").setStyle(g);this.down("#AllergyBtn").setText("過敏");this.down("#AllergyBtn").setUi(h);this.down("#IcdTypeBtn").setStyle(v);this.down("#IcdTypeBtn").setText("感染");this.down("#IcdTypeBtn").setUi(d);this.down("#SuicideBtn").setStyle(l);this.down("#SuicideBtn").setText("自傷");this.down("#SuicideBtn").setUi(r);this.down("#DnrBtn").setStyle(u);this.down("#DnrBtn").setHtml("DNR");this.down("#DnrBtn").setUi(s);b=null;delete b;g=null;delete g;v=null;delete v;l=null;delete l;u=null;delete u;f=null;delete f}});Ext.define("NisTRApp.view.Management",{extend:Ext.Container,config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"Management_MainTabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("Management 住院資料錯誤");return false}if(Ext.isEmpty(this.down("#_mgrOrderExcute"))){var f=Ext.create("NisTRApp.view.Management.OrderExcute",{itemId:"_mgrOrderExcute",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"醫囑執行"});this.down("#Management_MainTabPanel").add(f);f=null;delete f}else{this.down("#_mgrOrderExcute").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_mgrOrderDruglog"))){var e=Ext.create("NisTRApp.view.Management.Druglog",{itemId:"_mgrOrderDruglog",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"執行記錄"});this.down("#Management_MainTabPanel").add(e);e=null;delete e}else{this.down("#_mgrOrderDruglog").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_mgrNursingOrder"))){var g=Ext.create("NisTRApp.view.Management.NursingOrder",{itemId:"_mgrNursingOrder",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"開立護屬"});this.down("#Management_MainTabPanel").add(g);g=null;delete g}else{this.down("#_mgrNursingOrder").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_mgrOrderHistory"))){var d=Ext.create("NisTRApp.view.Management.OrderHistory",{itemId:"_mgrOrderHistory",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"醫囑紀錄"});this.down("#Management_MainTabPanel").add(d);d=null;delete d}else{this.down("#_mgrOrderHistory").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_mgrOrderRecive"))){var h=Ext.create("NisTRApp.view.Management.OrderRecive",{itemId:"_mgrOrderRecive",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"待接收醫囑"});this.down("#Management_MainTabPanel").add(h);h=null;delete h}else{this.down("#_mgrOrderRecive").setRecord(this.getRecord())}var b=NisTRApp.view.TRUtility.GetUrlInfo();if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.SubPage)){var a=parseInt(b.SubPage,10);if(Ext.isNumber(a)&&a>=0&&a<=4){this.down("#Management_MainTabPanel").setActiveItem(a)}a=null}b=null;delete b}});Ext.define("NisTRApp.view.Management.OrderRecive",{extend:Ext.Container,alias:"widget.OrderReceive",config:{layout:{type:"fit"},items:[{xtype:"list",itemId:"ReciveOrdList",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待接收醫囑.</div>',itemTpl:["<table>","  <tbody>","    <tr>",'    <td id={OrddRid} rowspan="1" align="left" width="100%">','	 <div class="receiveOrderlist" style="width:100%;height:100%;" orddrid="{OrddRid}"><pre><span style="color:{Color};width:50px;">{Status}</span> {ModName} {ProcDateTimeStr} <br style="line-height:0.1;">{OrddHtml}</pre></div>',"    </td>","    </tr>","  </tbody>    ","  ","</table>","","",""]},{xtype:"toolbar",docked:"bottom",itemId:"MOR_FnBtnBar",items:[{xtype:"button",centered:false,itemId:"mybutton88",ui:"confirm",width:"100px",text:"全 部 接 收"},{xtype:"button",centered:false,itemId:"mybutton87",right:"5px",ui:"decline",width:"100px",text:"重 新 整 理"}]}],listeners:[{fn:"onReciveOrdListItemTaphold",event:"itemtaphold",delegate:"#ReciveOrdList"},{fn:"onMybutton88Tap",event:"tap",delegate:"#mybutton88"},{fn:"onMybutton87Tap",event:"tap",delegate:"#mybutton87"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"},{fn:"onContainerErased",event:"erased"},{fn:"onContainerPainted",event:"painted"}]},onReciveOrdListItemTaphold:function(b,d,j,a,h,f){if(null==this.getRecord()){return}var g=this;var k=this.getRecord();g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:"../api/Inp/action/ReceiveOrderUpdate.ashx",scope:this,method:"POST",timeout:60000,params:{OrddRidList:a.data.OrddRid,InpNo:k.data.InpNO,UserID:NisTRApp.view.SysUtility.GetUserID("OrderRecive")},success:function(e){g.setMasked(false);g.loadReciveOrdList();g=null;delete g},failure:function(){g.setMasked(false);Ext.Msg.alert(" 接收失敗 ");g=null;delete g}});k=null;delete k},onMybutton88Tap:function(d,h,b){var a=Ext.getStore("sReceiveOrder");if(null==a||a.getCount()<=0){a=null;delete a;return}if(null==this.getRecord()){return}var f=this;var j=this.getRecord();var g=[];a.each(function(e){g.push(e.data.OrddRid)});f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:"../api/Inp/action/ReceiveOrderUpdate.ashx",scope:this,method:"POST",timeout:60000,params:{OrddRidList:g.toString(),InpNo:j.data.InpNO,UserID:NisTRApp.view.SysUtility.GetUserID("OrderRecive")},success:function(e){f.setMasked(false);f.loadReciveOrdList();f=null;delete f},failure:function(){f.setMasked(false);Ext.Msg.alert(" 接收失敗 ");f=null;delete f}});j=null;delete j;g=null;delete g;a=null;delete a},onMybutton87Tap:function(b,d,a){this.loadReciveOrdList()},onContainerDestroy:function(a){if(Ext.getStore("sReceiveOrder")!=null){Ext.getStore("sReceiveOrder").removeAll();Ext.getStore("sReceiveOrder").destroy()}this.removeAll(true,true)},onContainerShow:function(a,b){},onContainerErased:function(a,b){Ext.getStore("sReceiveOrder").removeAll()},onContainerPainted:function(b,a){this.loadReciveOrdList()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("OrderReceive 住院資料錯誤");return false}if(Ext.getStore("sReceiveOrder")==null){Ext.create("Ext.data.Store",{storeId:"sReceiveOrder",clearOnPageLoad:false,model:"NisTRApp.model.Management.ConfirmOrder",timeout:60000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/ReceiveOrder.ashx",reader:{type:"json"}}})}},loadReciveOrdList:function(){var a=Ext.getStore("sReceiveOrder");var b=this.getRecord();if(a.isLoading()||b==null){b=null;delete b;a=null;delete a;return}a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNo});this.down("#ReciveOrdList").setStore(a);a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.Management.OrderHistory",{extend:Ext.Container,alias:"widget.OrderHistory",config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"list",itemId:"OrderHistoryList",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無醫囑紀錄.</div>',itemTpl:['<div><pre style="word-break: break-all; word-wrap: break-word;">{Note}</pre></div>'],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerErased",event:"erased"}]},onContainerDestroy:function(a){if(Ext.getStore("sOrderHistory")!=null){Ext.getStore("sOrderHistory").removeAll();Ext.getStore("sOrderHistory").destroy()}this.removeAll(true,true)},onContainerPainted:function(b,a){this.loadOrdHistory()},onContainerErased:function(a,b){Ext.getStore("sOrderHistory").removeAll()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("OrderHistory 住院資料錯誤");return false}if(Ext.getStore("sOrderHistory")==null){Ext.create("Ext.data.Store",{storeId:"sOrderHistory",model:"NisTRApp.model.Note.WdisprognoteEntity",timeout:60000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/OrderHistory.ashx",reader:{type:"json"}}})}},loadOrdHistory:function(){var a=Ext.getStore("sOrderHistory");var b=this.getRecord();if(a.isLoading()||b==null){b=null;delete b;return}a.removeAll();a.getProxy().setExtraParams({chartNo:b.data.ChartNo,inpNo:b.data.InpNo,limit:5});this.down("#OrderHistoryList").setStore(a);a.loadPage(1,null,this);a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.Allergy",{extend:Ext.Container,alias:"widget.Allergy",config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"Allergy_Form",items:[{xtype:"button",centered:true,height:"30%",itemId:"AllergyStartBtn",ui:"decline",width:"30%",text:"啟 動 過 敏 評 估"},{xtype:"panel",height:"100%",hidden:true,html:'<div id="AllergyContent" style="width: 100% !important; height: 100% !important;"> </div>',itemId:"AllergyContentPanel",width:"100%"}],listeners:[{fn:function(d,b){var a=this.getParent().getRecord();if(null==a){this.setRecord(null);a=null;delete a;return}if(null!=this.getRecord()&&this.getRecord().data.ChartNo==a.data.ChartNo&&this.getRecord().data.Source.Type==a.data.Source.Type){console.log("Allergy the same patient")}else{this.setRecord(a)}a=null;delete a},event:"painted"}]}],listeners:[{fn:"onAllergyStartBtnTap",event:"tap",delegate:"#AllergyStartBtn"},{fn:"onAllergy_FormUpdatedata",event:"updatedata",delegate:"#Allergy_Form"},{fn:"onAllergy_FormDestroy",event:"destroy",delegate:"#Allergy_Form"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerErased",event:"erased"}]},onAllergyStartBtnTap:function(b,d,a){var f=this.getRecord();if(f.data.Source.Type==2){this.AllergyINP()}else{this.AllergyOPD()}f=null;delete f},onAllergy_FormUpdatedata:function(a,d,b){var e=this.getRecord();if(e==null){e=null;delete e;NisTRApp.view.Misc.ResetContentDiv("AllergyContent",this.down("#AllergyContentPanel"));return}this.down("#AllergyStartBtn").setHidden(true);this.down("#AllergyContentPanel").setHidden(true);if(e.data.Source.Type==2){this.AllergyINP()}else{this.AllergyOPD()}e=null;delete e},onAllergy_FormDestroy:function(a){this.setRecord(null)},onContainerDestroy:function(a){this.setRecord(null);$("#AllergyContent").find("iframe").remove();$("#AllergyContent").empty();NisTRApp.view.Misc.ResetContentDiv("AllergyContent",this.down("#AllergyContentPanel"));if(NisTRApp.view.SysUtility.IsProtalDevice()){typeof(Portal)!="undefined"&&typeof(Portal.setChartNo)!="undefined"&&Portal.setChartNo(" ");typeof(Portal)!="undefined"&&typeof(Portal.setInpNo)!="undefined"&&Portal.setInpNo(" ");typeof(Portal)!="undefined"&&typeof(Portal.setCareDoctorNo)!="undefined"&&Portal.setCareDoctorNo(" ")}this.removeAll(true,true);return},onContainerErased:function(a,b){this.down("#Allergy_Form").setRecord(null);if(NisTRApp.view.SysUtility.IsProtalDevice()){typeof(Portal)!="undefined"&&typeof(Portal.setChartNo)!="undefined"&&Portal.setChartNo(" ");typeof(Portal)!="undefined"&&typeof(Portal.setInpNo)!="undefined"&&Portal.setInpNo(" ");typeof(Portal)!="undefined"&&typeof(Portal.setCareDoctorNo)!="undefined"&&Portal.setCareDoctorNo(" ")}try{NisTRApp.view.Misc.ResetContentDiv("AllergyContent",this.down("#AllergyContentPanel"))}catch(d){}},initialize:function(){this.callParent();NisTRApp.view.Misc.ResetContentDiv("AllergyContent",this.down("#AllergyContentPanel"));if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("Allergy 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("Allergy 住院病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("Allergy 門診病人資料錯誤");return false}},AllergyINP:function(){console.log("Allergy INP");var d=this.getRecord();this.down("#AllergyStartBtn").setHidden(true);this.down("#AllergyContentPanel").setHidden(true);if(NisTRApp.view.SysUtility.IsProtalDevice()&&Ext.os.deviceType!="Desktop"){this.down("#AllergyStartBtn").setHidden(false);Portal.setChartNo(d.data.ChartNO);Portal.setInpNo(d.data.InpNO);Portal.setCareDoctorNo(d.getIpbinp().data.NowDocNo1);Portal.showViewController("WebEMR_ADR_Allergy")}else{this.down("#AllergyContentPanel").show();var b="";try{b=$("#AllergyContent").find("iframe").attr("src")}catch(a){}if(undefined==b||String.IsNull(b)){var f=String.format(NisTRApp.view.SysUtility.SysServer()+"/Portal/hash/u/{0}?ReturnUrl=/WebEMR/nursing-{1}/ADR_Allergy%3Fdoctor={2}",NisTRApp.view.SysUtility.GetUserID("AllergyINP"),d.data.ChartNO,d.getIpbinp().data.NowDocNo1);if(Ext.os.deviceType!="Desktop"){f=String.format(NisTRApp.view.SysUtility.SysServer()+"/Portal/hash/u/{0}?ReturnUrl=/PTEMR/embed-{1}%3Fdoctor={2}%23ADR/Allergy",NisTRApp.view.SysUtility.GetUserID("AllergyINP"),d.data.ChartNO,d.getIpbinp().data.NowDocNo1)}NisTRApp.view.Misc.createFrameContent($("#AllergyContent"),f,d.data.ChartNO);console.log($("#"+d.data.ChartNO));f=null;delete f}b=null;delete b}d=null;delete d},AllergyOPD:function(){console.log("Allergy OPD");var f=this.getRecord();this.down("#AllergyStartBtn").setHidden(true);this.down("#AllergyContentPanel").setHidden(true);var a="";try{a=f.getRegregm().data.DocNO}catch(b){console.log("AllergyOPD Error",b)}if(NisTRApp.view.SysUtility.IsProtalDevice()&&Ext.os.deviceType!="Desktop"){this.down("#AllergyStartBtn").setHidden(false);Portal.setChartNo(f.data.ChartNo);Portal.setInpNo(" ");Portal.setCareDoctorNo(a);Portal.showViewController("WebEMR_ADR_Allergy")}else{this.down("#AllergyContentPanel").show();var d="";try{d=$("#AllergyContent").find("iframe").attr("src")}catch(b){}if(undefined==d||String.IsNull(d)){var g=String.format(NisTRApp.view.SysUtility.SysServer()+"/Portal/hash/u/{0}?ReturnUrl=/WebEMR/nursing-{1}/ADR_Allergy%3Fdoctor={2}",NisTRApp.view.SysUtility.GetUserID("AllergyOPD"),f.data.ChartNo,a);if(Ext.os.deviceType!="Desktop"){g=String.format(NisTRApp.view.SysUtility.SysServer()+"/Portal/hash/u/{0}?ReturnUrl=/PTEMR/embed-{1}%3Fdoctor={2}%23ADR/Allergy",NisTRApp.view.SysUtility.GetUserID("AllergyOPD"),f.data.ChartNo,a)}NisTRApp.view.Misc.createFrameContent($("#AllergyContent"),g,f.data.ChartNo);g=null;delete g}d=null;delete d}a=null;delete a;f=null;delete f}});Ext.define("NisTRApp.view.VitalSigns",{extend:Ext.Container,config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"VitalSigns_MainTabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("VitalSigns 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("VitalSigns 住院病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("VitalSigns 門診病人資料錯誤");return false}if(this.getRecord().data.Source.Type==2){if(Ext.isEmpty(this.down("#_vsVitalChart"))){var e=Ext.create("NisTRApp.view.VitalSigns.VitalChart",{itemId:"_vsVitalChart",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"生命徵象"});this.down("#VitalSigns_MainTabPanel").add(e);e=null;delete e}else{this.down("#_vsVitalChart").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_vsPainScort"))){var d=Ext.create("NisTRApp.view.VitalSigns.INP_PainScort",{itemId:"_vsPainScort",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"疼痛評估"});this.down("#VitalSigns_MainTabPanel").add(d);d=null;delete d}else{this.down("#_vsPainScort").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_vsMonitorInput"))){var g=Ext.create("NisTRApp.view.VitalSigns.MonitorInput",{itemId:"_vsMonitorInput",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"Monitor"});this.down("#VitalSigns_MainTabPanel").add(g);g=null;delete g}else{this.down("#_vsMonitorInput").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_vsMonitorView"))){var f=Ext.create("NisTRApp.view.VitalSigns.MonitorView",{itemId:"_vsMonitorView",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"監測記錄"});this.down("#VitalSigns_MainTabPanel").add(f);f=null;delete f}else{this.down("#_vsMonitorView").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_vsMonitorListSetting"))){var h=Ext.create("NisTRApp.view.VitalSigns.MonitorListSetting",{itemId:"_vsMonitorListSetting",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"監測設定"});this.down("#VitalSigns_MainTabPanel").add(h);h=null;delete h}else{this.down("#_vsMonitorListSetting").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_vsEventLog"))){var a=Ext.create("NisTRApp.view.VitalSigns.EventLog",{itemId:"_vsEventLog",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"事件簿"});this.down("#VitalSigns_MainTabPanel").add(a);a=null;delete a}else{this.down("#_vsEventLog").setRecord(this.getRecord())}}if(this.getRecord().data.Source.Type!=2){if(Ext.isEmpty(this.down("#_vsOpdVitalChart"))){var b=Ext.create("NisTRApp.view.VitalSigns.OPD_VitalChart",{itemId:"_vsOpdVitalChart",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"生命徵象"});this.down("#VitalSigns_MainTabPanel").add(b)}else{this.down("#_vsOpdVitalChart").setRecord(this.getRecord())}}}});Ext.define("NisTRApp.view.VitalSigns.VitalChart",{extend:Ext.Container,alias:"widget.VitalChart",config:{items:[{xtype:"toolbar",docked:"top",itemId:"VitalChartHeadBar",items:[{xtype:"button",itemId:"vitalInputBtn",ui:"decline",width:"200px",iconCls:"add",text:"輸入本次生命徵象"},{xtype:"segmentedbutton",itemId:"VitalChangeFnBtn",margin:"0 0 0 10",items:[{xtype:"button",pressed:true,itemId:"INPVitalGraphicBtn",ui:"confirm",width:"60px",text:"圖"},{xtype:"button",itemId:"INPVitalValueBtn",width:"60px",text:"數值"}]},{xtype:"panel",margin:"0 0 0 10",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"VS_INPBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"VS_INPEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"VS_QueryBtn",margin:"0 0 0 20",text:"查詢"},{xtype:"button",itemId:"VS_QueryWeeklyBtn",margin:"0 0 0 20",text:"本週"},{xtype:"button",itemId:"VS_QueryTodayBtn",margin:"0 0 0 20",text:"本日"}]},{xtype:"panel",height:"100%",id:"VS_InpMainPanel",itemId:"VS_InpMainPanel",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",height:"100%",html:'<div id="_chartDiv" style="height: 400px !important; width: 100% !important;"><p>initial</p></div>',id:"",itemId:"VS_INPGraphicPanel",width:"100%",scrollable:"vertical",listeners:[{fn:function(b,a){},event:"painted"}]},{xtype:"panel",height:"100%",itemId:"VS_INPHistoryGridPanel",width:"100%"},{xtype:"label",docked:"bottom",itemId:"RecentBodyWeightLab",tpl:["<div>",'    <span style="font-size: 14pt; font-weight: bold; color:Black;" >身高:</span> ','    <span style="font-size: 14pt; font-weight: bold; color:Blue;" >{MBH} {MBHRemark} {MBHCreDate}</span>',"    &nbsp;&nbsp;&nbsp;&nbsp;",'    <span style="font-size: 14pt; font-weight: bold; color:Black;" >體重:</span> ','    <span style="font-size: 14pt; font-weight: bold; color:Blue;" >{MBW} {MBWRemark} {MBWCreDate}</span>',"</div>",""]}]},{xtype:"toolbar",docked:"bottom",itemId:"VitalChartFootBar",items:[{xtype:"button",itemId:"VS_INPPreBtn",ui:"confirm-back",width:"48%",text:"前一日"},{xtype:"button",itemId:"VS_INPNextBtn",ui:"confirm-forward",width:"48%",text:"後一日"}]}],listeners:[{fn:"onVitalInputBtnTap",event:"tap",delegate:"#vitalInputBtn"},{fn:"onINPVitalGraphicBtnTap",event:"tap",delegate:"#INPVitalGraphicBtn"},{fn:"onINPVitalValueBtnTap",event:"tap",delegate:"#INPVitalValueBtn"},{fn:"onVS_QueryBtnTap",event:"tap",delegate:"#VS_QueryBtn"},{fn:"onVS_QueryWeeklyBtnTap",event:"tap",delegate:"#VS_QueryWeeklyBtn"},{fn:"onVS_QueryTodayBtnTap",event:"tap",delegate:"#VS_QueryTodayBtn"},{fn:"onVS_InpMainPanelUpdatedata",event:"updatedata",delegate:"#VS_InpMainPanel"},{fn:"onVS_INPPreBtnTap",event:"tap",delegate:"#VS_INPPreBtn"},{fn:"onVS_INPNextBtnTap",event:"tap",delegate:"#VS_INPNextBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onVitalInputBtnTap:function(b,d,a){var f=this.getRecord();if(f!=null){this.CreateVitalSignInputPanel(f)}f=null;delete f},onINPVitalGraphicBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.down("#VS_INPGraphicPanel").setHidden(false);this.down("#VS_INPHistoryGridPanel").setHidden(true)},onINPVitalValueBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.down("#VS_INPGraphicPanel").setHidden(true);this.down("#VS_INPHistoryGridPanel").setHidden(false)},onVS_QueryBtnTap:function(b,d,a){this.QryButtonSelect(b,"On");this.down("#VS_INPPreBtn").setText("前一日");this.down("#VS_INPNextBtn").setText("後一日");this.QueryInpVital(this.down("#VS_INPBegDate").getValue(),this.down("#VS_INPEndDate").getValue())},onVS_QueryWeeklyBtnTap:function(b,d,a){this.QryButtonSelect(b,"On");this.down("#VS_INPBegDate").setValue(NisTRApp.view.DateUtil.GetWeekFirstDay());this.down("#VS_INPEndDate").setValue(NisTRApp.view.DateUtil.GetWeekLastDay());this.down("#VS_INPPreBtn").setText("前一周");this.down("#VS_INPNextBtn").setText("後一周");this.QueryInpVital(this.down("#VS_INPBegDate").getValue(),this.down("#VS_INPEndDate").getValue())},onVS_QueryTodayBtnTap:function(b,d,a){this.QryButtonSelect(b,"On");this.down("#VS_INPBegDate").setValue(SYS_CONST.SysDate);this.down("#VS_INPEndDate").setValue(SYS_CONST.SysDate);this.down("#VS_INPPreBtn").setText("前一日");this.down("#VS_INPNextBtn").setText("後一日");this.QueryInpVital(SYS_CONST.SysDate,SYS_CONST.SysDate)},onVS_InpMainPanelUpdatedata:function(a,d,b){var f=Ext.getStore("sRecentBodyWeight");f.removeAll();f.getProxy().setExtraParams({InpNo:d.InpNO});var e=this;f.load({callback:function(h,g,j){if(!Ext.isEmpty(h)&&!Ext.isEmpty(h[0])){if(!Ext.isEmpty(e.down("#RecentBodyWeightLab"))){e.down("#RecentBodyWeightLab").setRecord(h[0])}}e=null;delete e;patInfo=null;delete patInfo}},this);f=null;delete f},onVS_INPPreBtnTap:function(b,f,a){var d=-1;if("confirm-round"==this.down("#VS_QueryWeeklyBtn").getUi()){d=-7}this.down("#VS_INPBegDate").setValue(Ext.Date.add(this.down("#VS_INPBegDate").getValue(),Ext.Date.DAY,d));this.down("#VS_INPEndDate").setValue(Ext.Date.add(this.down("#VS_INPEndDate").getValue(),Ext.Date.DAY,d));this.QueryInpVital(this.down("#VS_INPBegDate").getValue(),this.down("#VS_INPEndDate").getValue())},onVS_INPNextBtnTap:function(b,f,a){var d=1;if("confirm-round"==this.down("#VS_QueryWeeklyBtn").getUi()){d=7}this.down("#VS_INPBegDate").setValue(Ext.Date.add(this.down("#VS_INPBegDate").getValue(),Ext.Date.DAY,d));this.down("#VS_INPEndDate").setValue(Ext.Date.add(this.down("#VS_INPEndDate").getValue(),Ext.Date.DAY,d));this.QueryInpVital(this.down("#VS_INPBegDate").getValue(),this.down("#VS_INPEndDate").getValue())},onContainerDestroy:function(a){if(Ext.getStore("sInpVitalSignDatas")!=null){Ext.getStore("sInpVitalSignDatas").removeAll();Ext.getStore("sInpVitalSignDatas").destroy()}if(Ext.getStore("sRecentBodyWeight")!=null){Ext.getStore("sRecentBodyWeight").removeAll();Ext.getStore("sRecentBodyWeight").destroy()}if($("#_chartDiv").highcharts()){$("#_chartDiv").highcharts().destroy()}$("#_chartDiv").html("");console.log("On Destroy:","Inp Vistal");this.removeAll(true,true)},onContainerPainted:function(b,a){},ButtonSelect:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#VitalChangeFnBtn"),b,"confirm-round","normal","","")},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("INP_VitalChart 住院資料錯誤");return false}var f=this.getRecord().getIpbinp();if(!Ext.isEmpty(f.data.OutDate)&&!Ext.isEmpty(f.data.InDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(f.data.InDate);var g=Ext.Date.add(b,Ext.Date.DAY,7);this.down("#VS_INPBegDate").setValue(b);this.down("#VS_INPEndDate").setValue(g);b=null;delete b;g=null;delete g}else{this.down("#VS_INPBegDate").setValue(new Date());this.down("#VS_INPEndDate").setValue(new Date())}if(Ext.getStore("sInpVitalSignDatas")==null){Ext.create("Ext.data.Store",{storeId:"sInpVitalSignDatas",clearOnPageLoad:false,model:"NisTRApp.model.Ipo.IpovitalEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/QueryVitalSign.ashx",reader:{type:"json"}},sorters:[]})}var e=this;var d=Ext.getCmp("INPVitalSignGrid");if(d==null){d=e.GenVitalSignGrid("INPVitalSignGrid","住院命徵象資料");d.getTitleBar().hide();var a=Ext.getStore("sInpVitalSignDatas");d.setStore(a);this.down("#VS_INPHistoryGridPanel").add(d);a=null;delete a}d=null;delete d;e=null;delete e;if(Ext.getStore("sRecentBodyWeight")==null){Ext.create("Ext.data.Store",{storeId:"sRecentBodyWeight",clearOnPageLoad:false,model:"NisTRApp.model.InpRecentBodyWeight",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/RecentBodyHeightWeight.ashx",reader:{type:"json"}},sorters:[]})}this.down("#VS_INPGraphicPanel").setHidden(true);this.down("#VS_INPHistoryGridPanel").setHidden(false);this.down("#VS_QueryTodayBtn").fireEvent("tap",this.down("#VS_QueryTodayBtn"),null,null);this.down("#INPVitalGraphicBtn").fireEvent("tap",this.down("#INPVitalGraphicBtn"),null,null);this.down("#VS_InpMainPanel").setRecord(this.getRecord())},GenVitalSignGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"99%",width:"99%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing"}],columns:[{text:"日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:100,tpl:'<span style="color:blue; font-size: 14px">{CreDate}</span>',flex:1,dataIndex:"CreDate",editable:false,sortable:false},{text:"時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:80,tpl:'<span style="color:blue; font-size: 14px">{[NisTRApp.view.Misc.Substr(values.CreTime, 0, 4)]}</span>',flex:1,dataIndex:"CreTime",editable:false,sortable:false},{text:"Temp",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Temp)]}</span>',flex:1,width:80,dataIndex:"Temp",editable:true,sortable:false},{text:"Pulse",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{PulseStyle}">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Pulse)]}</span>',flex:1,width:80,dataIndex:"Pulse",editable:false,sortable:true},{text:"Heart",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Heart)]} </span>',flex:1,width:80,editable:false,sortable:false},{text:"Resp",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{RespStyle}">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Resp)]} </span>',flex:1,width:80,dataIndex:"Resp",editable:false,sortable:false},{text:"SBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{BpsStyle}">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Bps)]} </span>',flex:1,width:80,dataIndex:"Sbp",editable:false,sortable:false},{text:"DBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Bpd)]}</span>',flex:1,width:80,dataIndex:"Dbp",editable:false,sortable:true},{text:"MBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px"> {[NisTRApp.view.GridUtility.ZeroToEmpty(values.Mbp)]}</span>',width:80,sortable:false,flex:1},{text:"ASBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.BpsArterial)]}</span>',flex:1,width:80,dataIndex:"Asbp",editable:false,sortable:false},{text:"ADBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.BpdArterial)]}</span>',flex:1,width:80,dataIndex:"Adbp",editable:false,sortable:false},{text:"MAP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{[NisTRApp.view.GridUtility.ZeroToEmpty(values.Map)]} </span>',width:80,sortable:false,flex:1},{text:"說明",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:blue; font-size: 14px">{Remark} </span>',width:180,sortable:false},{text:"記錄日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:100,tpl:'<span style="color:blue; font-size: 14px">{ProcDate}</span>',flex:1,dataIndex:"ProcDate",editable:false,sortable:false},{text:"記錄時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:100,tpl:'<span style="color:blue; font-size: 14px">{ProcTime}</span>',flex:1,dataIndex:"ProcTime",editable:false,sortable:false}]})},QryButtonSelect:function(a,d){try{this.down("#VS_QueryBtn").setUi("normal");this.down("#VS_QueryWeeklyBtn").setUi("normal");this.down("#VS_QueryTodayBtn").setUi("normal");if(!Ext.isEmpty(a)){a.setUi("confirm-round")}}catch(b){console.log(b)}},QueryInpVital:function(b,e){if(Ext.isEmpty(this.getRecord())){return}if(Ext.getStore("sInpVitalSignDatas").isLoading()){return}var f=this.getRecord();var a=Ext.getStore("sInpVitalSignDatas");a.getProxy().setExtraParams({InpNo:f.data.InpNO,BegDate:b,EndDate:e});if(!Ext.isEmpty(this.down("#VS_INPGraphicPanel"))){this.down("#VS_INPGraphicPanel").setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})}var d=this;a.load({callback:function(h,g,j){if(!Ext.isEmpty(d.down("#VS_INPGraphicPanel"))&&(!d.down("#VS_INPGraphicPanel").isHidden())){d.RenderVitalGraphic(f,b,e)}else{d.RenderVitalGraphic(f,b,e)}d.down("#VS_INPGraphicPanel").setMasked(false);d=null;delete d;f=null;delete f}},this);a=null;delete a},RenderVitalGraphic:function(g,q,u){var p=function p(e){if(Ext.isEmpty(e)||e===0||e==="0"){return NaN}else{return e}};if($("#_chartDiv").highcharts()){$("#_chartDiv").highcharts().destroy()}$("#_chartDiv").html("");if(Ext.isEmpty(this.getRecord())){return}if(Ext.getStore("sInpVitalSignDatas").isLoading()){$("#_chartDiv").html('<div style="width:auto; text-align:center; padding-top:15%; color:red; font-weight:bold;">資料讀取尚未完成.</div>');return}if(Ext.getStore("sInpVitalSignDatas").getCount()<=0){$("#_chartDiv").html('<div style="width:auto; text-align:center; padding-top:15%; color:red; font-weight:bold;">無資料.</div>');return}try{var o=new Date(q.getFullYear(),q.getMonth(),q.getDate(),0,0,0);var l=new Date(u.getFullYear(),q.getMonth(),u.getDate(),23,59,59);var n=$("#_chartDiv");var d=Ext.getStore("sInpVitalSignDatas");var b=Ext.getStore("sInpVitalSignDatas").getAt(0);var a=[];var x=[];var w=b.data.CreDateTime;var h={min:o.getTime(),max:l.getTime()};var r;var k=["99E6FF","33CCFF","3DF500","00C230","F5B800","FFCC33","FF8533","FF6600","E65C00","E60017","FF0000"];var m=[{name:"Temp",dispName:"Temp",unit:"℃",color:"#3366FF",axisIndex:0,symbol:"circle"},{name:"Pulse",dispName:"Pulse",unit:"bpm",color:"#FF0000",axisIndex:1,symbol:"square"},{name:"Heart",dispName:"Heart",unit:"bpm",color:"#FF0000",axisIndex:1,symbol:"diamond"},{name:"Resp",dispName:"Resp",unit:"/min",color:"#1A1A1A",axisIndex:2,symbol:"circle"},{name:"Bps",dispName:"SBP",unit:"mmHg",color:"#333333",axisIndex:3,symbol:"triangle-down"},{name:"Dbp",dispName:"DBP",unit:"mmHg",color:"#333334",axisIndex:3,symbol:"triangle"},{name:"MbpNum",dispName:"MBP",unit:"mmHg",color:"#009933",axisIndex:3,symbol:"diamond"},{name:"BpsArterial",dispName:"ASBP",unit:"mmHg",color:"#999999",axisIndex:3,symbol:"triangle-down"},{name:"Adbp",dispName:"ADBP",unit:"mmHg",color:"#999999",axisIndex:3,symbol:"triangle"},{name:"MapNum",dispName:"MAP",unit:"mmHg",color:"#FF9900",axisIndex:3,symbol:"circle"}];a.push({title:{text:"Temperature (°C)",style:{color:"#000000"}},min:35,max:42,tickInterval:1,lineColor:"#3366FF",lineWidth:2,gridLineColor:"#9A9A9A",tickColor:"#000000",tickWidth:5,opposite:false,labels:{formatter:function(){return this.value+"°"},style:{color:"#000000"}},plotLines:[{value:37,color:"Orange",dashStyle:"LongDash",width:3,label:{text:""}}]});a.push({title:{text:"bpm",style:{color:"#000000"}},min:40,max:180,tickInterval:20,lineColor:"#FF0000",tickColor:"#000000",lineWidth:2,tickWidth:5,opposite:false,labels:{style:{color:"#000000"}}});a.push({title:{text:"/min",style:{color:"#000000"}},min:0,max:70,tickInterval:10,lineColor:"#1A1A1A",tickColor:"#000000",lineWidth:2,tickWidth:5,opposite:false,labels:{style:{color:"#000000"}}});a.push({title:{text:"mmHg",style:{color:"#000000"}},min:0,max:350,tickInterval:50,lineColor:"#E60017",tickColor:"#000000",lineWidth:2,tickWidth:5,opposite:false,labels:{style:{color:"#000000"}}});var f=["Solid","ShortDash","ShortDot","ShortDashDot","ShortDashDotDot","Dot","Dash","LongDash","DashDot","LongDashDot","LongDashDotDot"];var j=["line","line","line"];var s=0;$(m).each(function(){var D=[];var z=0;var C=0;var D=[];var A=0;var y=0;Ext.getStore("sInpVitalSignDatas").each(function(N,K,E){var I=p(N.get(m[s].name));var M=N.data.CreDateTime;var F=M.getTime();h.min=(F<=h.min)?F:h.min;h.max=(F>=h.max)?F:h.max;if(I){var G="black";var L=I%k.length;L=Math.ceil(L);G="#"+k[L-0];if(y>=0&&(m[s].name=="Pulse"||m[s].name=="Heart")){var J=Ext.getStore("sInpVitalSignDatas").getAt(A).data.CreDateTime.getTime();var H=Ext.getStore("sInpVitalSignDatas").getAt(y).data.CreDateTime.getTime();if((J-H)>86400000){D.push({x:F,y:null})}J=null;delete J;H=null;delete H}y=A;D.push({x:F,y:I-0,unit:m[s].unit});D[D.length-1].color=m[s].color;G=null;delete G;L=null;delete L}A=A+1;I=null;delete I;M=null;delete M;F=null;delete F});z=0;C=0;var e=m[s].dispName;var B=-1;if(B==-1){B=m[s].axisIndex;if(D.length>0){x.push({name:e,yAxis:B,type:j[C],dashStyle:f[z],color:m[s].color,marker:{fillColor:null,lineWidth:(z==0&&C==0)?2:5,lineColor:null,symbol:m[s].symbol},data:D})}}s=s+1;D=null;delete D;z=null;delete z;C=null;delete C;B=null;delete B;A=null;delete A;y=null;delete y;e=null;delete e});s=null;delete s;r={credits:{enabled:false},title:{text:"Vital Sign"},subtitle:{text:(Ext.getStore("sInpVitalSignDatas").getCount()<=0)?"無資料":g.data.ChartNo,y:40},chart:{zoomType:"",height:$("#VS_InpMainPanel")[0].clientHeight-50,margin:[70,50,60,230],backgroundColor:"#eee"},rangeSelector:{buttons:[{type:"day",count:1,text:"1d"},{type:"day",count:3,text:"3d"},{type:"week",count:1,text:"1w"},{type:"week",count:3,text:"3w"},{type:"month",count:1,text:"1m"},{type:"all",text:"All"}],selected:2},plotOptions:{line:{dataLabels:{enabled:true,formatter:function(){return'<span style="color: black;"></span>'},useHTML:true,y:-3,style:{fontSize:"14pt"}}},column:{pointWidth:15},series:{}},tooltip:{animation:false,xDateFormat:'<span style="font-size: 13pt;">%Y-%m-%d %H:%M:%S</span>',shared:true,crosshairs:true,hideDelay:500,positioner:function(){return{x:($("#VS_InpMainPanel")[0].clientWidth-250),y:5}},shadow:false,pointFormat:'<span style="font-size: 12pt;"><span style="font-size: 12pt; color:{series.color};">{series.name}</span>: <span style=" font-size: 12pt; font-weight: bold;">{point.y}</span><span style=" font-size: 10pt;">  {point.unit}</span></span><br/>'},legend:{align:"center",verticalAlign:"bottom",y:15,floating:true,borderWidth:0},xAxis:{type:"datetime",min:h.min,max:(h.max+22100000),dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%y-%m-%d",month:"%Y/%B",year:"%Y"},startOnTick:false,endOnTick:false,minRange:3600000000,minorTickInterval:3600000000*4,gridLineWidth:1,lineColor:"#000",tickColor:"#000",labels:{style:{color:"#000",font:"11px Trebuchet MS, Verdana, sans-serif"}},title:{style:{color:"#333",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}}},yAxis:a,series:x};n.highcharts(r);n=null;d=null;b=null;a=null;x=null;w=null;h=null;r=null;k=null;m=null;f=null;j=null;o=null;delete o;l=null;delete l;delete n;delete d;delete b;delete a;delete x;delete w;delete h;delete r;delete k;delete m;delete f;delete j}catch(v){console.error(v);document.getElementById("_chartDiv").innerHTML="";$("#_chartDiv").html("")}p=null;delete p},CreateVitalSignInputPanel:function(g){if(Ext.isEmpty(g)){return false}var b=this;var a=function(e){if(!Ext.isEmpty(e)){b.down("#VS_QueryTodayBtn").fireEvent("tap",b.down("#VS_QueryTodayBtn"),null,null);b.down("#INPVitalGraphicBtn").fireEvent("tap",b.down("#INPVitalGraphicBtn"),null,null)}b=null;delete b};try{if(!Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){Ext.getCmp("_inpVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){var f=Ext.create("NisTRApp.view.INP_VitalSignInputPanel",{id:"_inpVSInputPanel",success:a,record:g});b.overlay=Ext.Viewport.add(f);f=null;delete f}b.overlay.show()}catch(d){console.log(d)}a=null;delete a;return}});Ext.define("NisTRApp.view.VitalSigns.OPD_VitalChart",{extend:Ext.Container,alias:"widget.OPD_VitalChart",config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"VitalChartHeadBar",items:[{xtype:"button",itemId:"VS_OPDVitalSignInputBtn",ui:"decline",width:"200px",iconCls:"add",text:"輸入本次生命徵象"},{xtype:"segmentedbutton",hidden:true,itemId:"VS_ChangeFnBtn",margin:"0 0 0 10",items:[{xtype:"button",itemId:"VS_GraphicBtn",width:"60px",text:"圖"},{xtype:"button",pressed:true,itemId:"VS_ValueBtn",ui:"confirm",width:"60px",text:"數值"}]},{xtype:"segmentedbutton",itemId:"VS_FnBtn",margin:"0 0 0 10",allowToggle:false,items:[{xtype:"button",itemId:"VS_15Btn",width:"90px",text:"近15筆"},{xtype:"button",itemId:"VS_30Btn",width:"90px",text:"近30筆"}]},{xtype:"panel",margin:"0 0 0 10",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"VS_OPDBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"VS_OPDEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"VS_QueryBtn",text:"查詢"}]},{xtype:"panel",height:"100%",itemId:"VS_OPDHistoryGridPanel",width:"100%"}],listeners:[{fn:"onVS_OPDVitalSignInputBtnTap",event:"tap",delegate:"#VS_OPDVitalSignInputBtn"},{fn:"onVS_GraphicBtnTap",event:"tap",delegate:"#VS_GraphicBtn"},{fn:"onVS_ValueBtnTap",event:"tap",delegate:"#VS_ValueBtn"},{fn:"onVS_15BtnTap",event:"tap",delegate:"#VS_15Btn"},{fn:"onVS_30BtnTap",event:"tap",delegate:"#VS_30Btn"},{fn:"onVS_QueryBtnTap",event:"tap",delegate:"#VS_QueryBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onVS_OPDVitalSignInputBtnTap:function(b,d,a){var f=this.getRecord();if(f!=null){this.CreateVitalSignInputPanel(f)}f=null;delete f},onVS_GraphicBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","")},onVS_ValueBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","")},onVS_15BtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.QueryOpdVital(15)},onVS_30BtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.QueryOpdVital(30)},onVS_QueryBtnTap:function(b,d,a){this.ButtonSelect(b,d,a);this.QueryOpdVital(-1,this.down("#VS_OPDBegDate").getValue(),this.down("#VS_OPDBegDate").getValue())},onContainerDestroy:function(a){if(Ext.getStore("sOpdVitalSignDatas")!=null){Ext.getStore("sOpdVitalSignDatas").removeAll();Ext.getStore("sOpdVitalSignDatas").destroy()}if(Ext.getCmp("OPDVitalSignGrid")!=null){Ext.getCmp("OPDVitalSignGrid").destroy()}this.removeAll(true,true)},onContainerPainted:function(b,a){if((this.down("#VS_15Btn").getUi()=="normal")&&(this.down("#VS_30Btn").getUi()=="normal")&&(this.down("#VS_QueryBtn").getUi()=="normal")){this.down("#VS_15Btn").fireEvent("tap",this.down("#VS_15Btn"),null,null)}},ButtonSelect:function(b,d,a){if(b.getItemId()!="VS_QueryBtn"){this.down("#VS_QueryBtn").setUi("normal");this.down("#VS_QueryBtn").setBadgeText("");NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","")}else{b.setUi("confirm");b.setBadgeText("");this.down("#VS_15Btn").setUi("normal");this.down("#VS_15Btn").setBadgeText("");this.down("#VS_30Btn").setUi("normal");this.down("#VS_30Btn").setBadgeText("")}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("OPD_VitalChart 病人資料錯誤");return false}if(Ext.getStore("sOpdVitalSignDatas")==null){Ext.create("Ext.data.Store",{storeId:"sOpdVitalSignDatas",clearOnPageLoad:false,model:"NisTRApp.model.mOPDVitalSignData",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Search/QueryOpdVitalSign.ashx",reader:{type:"json"}}})}var b=this;var a=Ext.getCmp("OPDVitalSignGrid");if(a==null){a=b.GenVitalSignGrid("OPDVitalSignGrid","門診歷次生命徵象資料");a.getTitleBar().hide();var d=Ext.getStore("sOpdVitalSignDatas");a.setStore(d);a.addListener("itemtap",b.ItemSingleTapVitalSign,a);this.down("#VS_OPDHistoryGridPanel").add(a);d=null;delete d}this.down("#VS_OPDBegDate").setValue(SYS_CONST.SysDate);this.down("#VS_OPDEndDate").setValue(SYS_CONST.SysDate);this.down("#VS_15Btn").setUi("normal");this.down("#VS_15Btn").setBadgeText("");this.down("#VS_30Btn").setUi("normal");this.down("#VS_30Btn").setBadgeText("");this.down("#VS_QueryBtn").setUi("normal");this.down("#VS_QueryBtn").setBadgeText("");a=null;delete a;b=null;delete b},GenVitalSignGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridcolumnresizing"}],columns:[{text:"Date",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:100,tpl:'<span style="color:blue; font-size: 14px">{CreDate}</span>',flex:1,dataIndex:"CreDate",editable:false,sortable:true},{text:"Time",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:80,tpl:'<span style="color:blue; font-size: 14px">{CreTime}</span>',flex:1,dataIndex:"CreTime",editable:false,sortable:true},{text:"Height",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Height}</span>',flex:1,width:80,dataIndex:"Height",editable:true,sortable:true},{text:"Weight",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Weight}</span>',flex:1,width:80,dataIndex:"Weight",editable:false,sortable:true},{text:"Temp.",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{TempStyle}">{Temp}</span>',flex:1,width:80,dataIndex:"Temp",editable:false,sortable:true},{text:"Pulse",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{PulseStyle}">{Pulse}</span>',flex:1,width:80,dataIndex:"Pulse",editable:false,sortable:true},{text:"Resp.",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{RespStyle}">{Resp} </span>',flex:1,width:80,dataIndex:"Resp",editable:false,sortable:true},{text:"SPO2",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Spo2} </span>',flex:1,width:80,dataIndex:"Resp",editable:false,sortable:true},{text:"SBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{BpsStyle}">{Bps} </span>',flex:1,width:80,editable:false,sortable:true},{text:"DBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Bpd} </span>',width:80,sortable:false,flex:1},{text:"MBP",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px"> {Mbp}</span>',width:80,sortable:false,flex:1},{text:"Pain",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="{PainStyle}">{Pain} </span>',width:60,sortable:false,flex:1},{text:"說明",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:blue; font-size: 14px">{Remark} </span>',width:80,sortable:false},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="{OpdvitalID}" src="'+SYS_CONST.ImgRoot+'Trash-can-icon.png" alt="Smiley face" height="35" width="35">',width:80,sortable:false}]})},QueryOpdVital:function(f,a,d){if(Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();var b=Ext.getStore("sOpdVitalSignDatas");if(b.isLoading()){return}b.getProxy().setExtraParams({ChartNo:e.data.ChartNo,RecordCnt:f,BegDate:a,EndDate:d});b.load();b=null;delete b;e=null;delete e},ItemSingleTapVitalSign:function(f,b,h,a,g,d){var f=this;if(g.event.target.nodeName=="IMG"){if(null==a.data.OpdvitalID){return false}else{Ext.Msg.confirm("注意","請確認是否刪除此筆記錄?",function(e){if(e==="yes"){Ext.Ajax.request({url:"../api/action/VitalSignDelete.ashx",scope:this,method:"POST",params:{OpdvitalID:a.data.OpdvitalID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(j){var k=f.getStore();if(k!=null){k.removeAll();k.load()}k=null;delete k},failure:function(){Ext.Msg.alert("存檔失敗");return false}})}else{return false}})}return false}g.preventDefault();f=null;delete f;return false},CreateVitalSignInputPanel:function(e){if(Ext.isEmpty(e)){return false}var d=this;var b=function(f){if(!Ext.isEmpty(f)){d.down("#VS_15Btn").fireEvent("tap",d.down("#VS_15Btn"),null,null)}d=null;delete d};if(!Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){Ext.getCmp("_opdVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){var a=Ext.create("NisTRApp.view.OPD_VitalSignInputPanel",{id:"_opdVSInputPanel",patInfo:e,success:b});d.overlay=Ext.Viewport.add(a);a=null;delete a}d.overlay.show();b=null;delete b;return}});Ext.define("NisTRApp.view.OPD_VitalSignInputPanel",{extend:Ext.Panel,alias:"widget.OPD_VitalSignInputPanel",config:{height:"380px",left:"25%",top:60,width:"600px",layout:{type:"fit"},modal:true,patInfo:{},success:{},items:[{xtype:"panel",itemId:"OPD_VitalSignMaintPanel"}],listeners:[{fn:"onPanelDestroy",event:"destroy"}]},onPanelDestroy:function(a){_vspanel=null;delete _vspanel;_vstoolbar=null;delete _vstoolbar;this.removeAll(true,true)},initialize:function(){this.callParent();var b=Ext.create("Ext.form.FieldSet",{width:"90%",centered:true,items:[{xtype:"datetimepickerfield",itemId:"VitalDate",name:"Vitaldate",label:"醫療日期",value:new Date(),width:"99%",labelWidth:"30%",autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Height",itemId:"Height",maxValue:300,autoCapitalize:true,placeHolder:"請輸入(cm)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Weight",itemId:"Weight",autoCapitalize:true,placeHolder:"請輸入(kg)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",itemId:"Temperature",label:"Temp.",maxValue:99,autoCapitalize:true,placeHolder:"請輸入(度)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Pulse",itemId:"Pulse",autoCapitalize:true,placeHolder:"請輸入(次)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Resp.",itemId:"Respiration",autoCapitalize:true,placeHolder:"請輸入(次)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"SpO2",itemId:"SpO2",autoCapitalize:true,placeHolder:"請輸入(%)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"SBP",itemId:"BPS",autoCapitalize:true,placeHolder:"請輸入(mmHg)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"DBP",itemId:"BPD",autoCapitalize:true,placeHolder:"請輸入(mmHg)"},{xtype:"selectfield",style:"width:50%;float:left;font-size:16px;",label:"疼痛指數",itemId:"Pain",autoCapitalize:true,placeHolder:"請選擇",options:[{text:"",value:""},{text:"Y",value:"Y"},{text:"N",value:"N"}],value:""},{labelWidth:"120px",xtype:"selectfield",itemId:"_tprRemark",label:"說明",placeHolder:"請輸入",options:[{text:"",value:""},{text:"拒絕",value:"拒絕"},{text:"病人未到",value:"病人未到"},{text:"無法測量",value:"無法測量"}],value:"",style:"width:50%;float:left;font-size:16px;"}]});var a=Ext.create("Ext.Toolbar",{docked:"bottom",xtype:"toolbar",items:[{xtype:"button",text:"取消",style:"width:20%",scope:this,right:"37%",ui:"confirm",hasDisabled:false,handler:function(d){if(this.getSuccess()){this.getSuccess()()}this.removeAll(true,true);this.destroy()}},{text:"資料儲存",style:"width:35%",itemId:"_vitalSignInputToolbarSave",xtype:"button",scope:this,right:"1%",ui:"confirm"}]});a.down("#_vitalSignInputToolbarSave").addListener("tap",function(h,j,k){var o=this.getPatInfo();var f=this.down("#Height").getValue();if(null!=f&&!REGEXP_CONST.Float.HEIGHT.test(f)){NisTRApp.view.Misc.MsgShow(REGEXP_CONST.Float.HEIGHT_STR,"提醒",2000);f=null;delete f;return}f=this.down("#Weight").getValue();if(null!=f&&!REGEXP_CONST.Float.WEIGHT.test(f)){NisTRApp.view.Misc.MsgShow(REGEXP_CONST.Float.WEIGHT_STR,"提醒",2000);f=null;delete f;return}f=null;delete f;var d="";if(this.down("#Temperature").getValue()!=null&&this.down("#Temperature").getValue()>=38){d+="體溫 ; "}if(this.down("#Pulse").getValue()!=null&&(this.down("#Pulse").getValue()>=120||this.down("#Pulse").getValue()<=60)){d+="脈搏 ; "}if(this.down("#Respiration").getValue()!=null&&(this.down("#Respiration").getValue()>=26||this.down("#Respiration").getValue()<=14)){d+="呼吸 ; "}if(this.down("#BPS").getValue()!=null&&(this.down("#BPS").getValue()>=160||this.down("#BPS").getValue()<=90)){d+="血壓 ; "}if(d!=""){d="下列數值異常，請再次確認並通知主治醫師\n"+d;Ext.Msg.show({title:"提示",message:d,wait:true});d=null;delete d}var l=this;l.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});var g=new Object();g.ChartNo=o.data.ChartNo;g.ChartSeq=o.data.ChartSeq;g.Temp=(this.down("#Temperature").getValue()==null?0:this.down("#Temperature").getValue());g.Pulse=(this.down("#Pulse").getValue()==null?0:this.down("#Pulse").getValue());g.Resp=(this.down("#Respiration").getValue()==null?0:this.down("#Respiration").getValue());g.Bps=(this.down("#BPS").getValue()==null?0:this.down("#BPS").getValue());g.Bpd=(this.down("#BPD").getValue()==null?0:this.down("#BPD").getValue());g.Spo2=(this.down("#SpO2").getValue()==null?0:this.down("#SpO2").getValue());g.Height=(this.down("#Height").getValue()==null?0:this.down("#Height").getValue());g.Weight=(this.down("#Weight").getValue()==null?0:this.down("#Weight").getValue());g.Remark=this.down("#_tprRemark").getValue();g.Pain=this.down("#Pain").getValue();g.CreDateTime=this.down("#VitalDate").getFormattedValue("Y-m-d H:i");g.UserID=NisTRApp.view.SysUtility.GetUserID();var m=JSON.stringify(g);var n=this.getSuccess();Ext.Ajax.request({url:"../api/action/VitalSignInput.ashx",scope:this,method:"POST",timeout:15000,params:{Json:m},success:function(e){if(l.getSuccess()){l.getSuccess()("Success")}l.setMasked(false);l.setHidden(true);Ext.callback(function(p){p.removeAll(true,true);p.destroy()},l,[l],200);l=null;delete l;n=null;delete n},failure:function(){l.setMasked(false);Ext.Msg.alert("存檔失敗");n=null;delete n}});m=null;delete m;g=null;delete g;o=null;delete o},this);b.down("#Height").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#Weight").focus()}},b.down("#Height"));b.down("#Weight").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#Temperature").focus()}},b.down("#Weight"));b.down("#Temperature").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#Pulse").focus()}},b.down("#Temperature"));b.down("#Pulse").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#Respiration").focus()}},b.down("#Pulse"));b.down("#Respiration").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#SpO2").focus()}},b.down("#Respiration"));b.down("#SpO2").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#BPS").focus()}},b.down("#SpO2"));b.down("#BPS").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#BPD").focus()}},b.down("#BPS"));b.down("#BPD").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#Pain").focus()}},b.down("#BPD"));b.down("#Pain").on("keyup",function(f,d){if(d.browserEvent.keyCode==13){b.down("#_tprRemark").focus()}},b.down("#Pain"));this.down("#OPD_VitalSignMaintPanel").add(b);this.down("#OPD_VitalSignMaintPanel").add(a);b.down("#VitalDate").setValue(new Date())}});Ext.define("NisTRApp.view.Nur.Cath",{extend:Ext.Container,alias:"widget.NurCath",config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NC_Main",layout:{type:"hbox"},items:[{xtype:"panel",height:"100%",itemId:"NC_MainPanel",width:"100%",layout:{type:"hbox"},items:[{xtype:"panel",itemId:"CathListHistory",width:"40%",items:[{xtype:"toolbar",docked:"top",itemId:"CathDetailToolBar",items:[{xtype:"button",itemId:"newCathBtn",ui:"confirm",width:"30%",text:"短期管路建置"},{xtype:"button",itemId:"nowCathBtn",ui:"confirm",width:"30%",text:"管路查詢與登錄作業"},{xtype:"button",itemId:"reloadCathBtn",ui:"confirm",width:"30%",text:"重新整理"}]},{xtype:"list",height:"100%",itemId:"CathHistoryList",width:"100%",disableSelection:false,itemTpl:["<div>",'<span style="font-weight:bolder;color:#6495ED;">{ProTitle}</span>','<span style="font-weight:bolder;color:#800080">{Site}</span>',"<br>上次追蹤日：{AddDate}","<br>下次更換日：{NextAddDate}","</div>"]}]},{xtype:"panel",itemId:"CathList",width:"60%",items:[{xtype:"toolbar",docked:"top",itemId:"CathDetailToolBar",items:[{xtype:"button",hidden:true,itemId:"addCathBtn",ui:"confirm",width:"30%",text:"追加"},{xtype:"button",hidden:true,itemId:"dcCathBtn",ui:"confirm",width:"30%",text:"結案"}]},{xtype:"panel",height:"100%",html:'<div id="CathFrame" style="height: 100%; width: 100%; line-height: 0; margin: 0; padding: 0; border: 0;"><iframe id="CathDetail"  width="100%" height="100%" frameborder="0" style="overflow-y: scroll !important; -webkit-overflow-scrolling: touch !important;"></iframe></div>',itemId:"CathDetail",style:"overflow: auto; -webkit-overflow-scrolling: touch;",width:"100%"}]}]}]}],listeners:[{fn:"onNewCathBtnTap",event:"tap",delegate:"#newCathBtn"},{fn:"onNowCathBtnTap",event:"tap",delegate:"#nowCathBtn"},{fn:"onReloadCathBtnTap",event:"tap",delegate:"#reloadCathBtn"},{fn:"onCathHistoryListItemTap",event:"itemtap",delegate:"#CathHistoryList"},{fn:"onAddCathBtnTap",event:"tap",delegate:"#addCathBtn"},{fn:"onDcCathBtnTap",event:"tap",delegate:"#dcCathBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onNewCathBtnTap:function(h,j,k){var m=this.getRecord();if(m==null){m=null;delete m;return}var g,b,d;if(m.data.Source.Type==1){g="0";b=m.data.Source.Name;d=(m.data.ChartSeq?m.data.ChartSeq:0)}else{if(m.data.Source.Type==2){g=m.data.InpNO;b=m.data.Source.Name;d=0}else{Ext.Msg.alert("NurCath 病人資料錯誤")}}var l=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment","XAV5BNJXE33UHP2BJO6VHYNULQ",NisTRApp.view.SysUtility.GetUserID(),m.data.ChartNo,d,"","","_ReloaCathdData","new",g,b);g=null;b=null;d=null;delete g;delete b;delete d;try{var a=Ext.getCmp("_opdCathFormPanel");if(!Ext.isEmpty(a)){Ext.isEmpty(a).destroy()}if(Ext.isEmpty(a)){a=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_opdCathFormPanel",record:m,url:l,divID:"CathFrameDIV"})}if(!Ext.isEmpty(a)){var f=this.down("#NC_MainPanel");a.setCaller(f);a.setCloseFn(function(e){e.setHidden(false)});this.down("#NC_Main").animateActiveItem(a,{type:"slide",direction:"right"});f.setHidden(true);a.show();f=null;delete f;a=null;delete a}a=null;delete a;m=null;delete m;l=null;delete l}catch(j){console.log(j)}},onNowCathBtnTap:function(b,d,f){if(Ext.isEmpty(this.getRecord())){return false}var l=this.getRecord();var a,h,k,j,g;a=NisTRApp.view.SysUtility.GetUserID("CathHistoryList itemTap");j=NisTRApp.view.SysUtility.GetExternalWeb();h=l.data.PatIdNo;k=j+"main/verify.asp?ltype=1&NewWindow=N&user_id="+a+"&PAT_IDNO="+h+"&web_id=NUR/NURMAIN_02.asp?PAT_IDNO="+h;k="NUR/NURMAIN_02.asp?LOG_USER_ID="+a+"&PAT_IDNO="+h;g=NisApp.view.NisPDFUtil.GetXAccessControl()+"/"+escape(k);NisTRApp.view.FormUtil.ResetContentDiv("CathFrame",this.down("#CathDetail"));NisTRApp.view.Misc.createResizeFrameContent($("#CathFrame"),g);$("#CathFrame").attr("src",g).attr("_src",g);this.down("#addCathBtn").setHidden(true);this.down("#dcCathBtn").setHidden(true);a=null;h=null;k=null;j=null;g=null;delete a;delete h;delete k;delete j;delete g},onReloadCathBtnTap:function(b,d,a){$("#CathFrame").attr("src","").attr("_src","");this.LoadPatientCatheter()},onCathHistoryListItemTap:function(b,f,g,d,h,j){if(Ext.isEmpty(this.getRecord())){return false}var o=this.getRecord();var a,l,n,m;a=NisTRApp.view.SysUtility.GetUserID("CathHistoryList itemTap");m=NisTRApp.view.SysUtility.GetExternalWeb();l=o.data.PatIdNo;n=m+"main/verify.asp?ltype=1&NewWindow=N&user_id="+a+"&PAT_IDNO="+l+"&web_id=NUR/NURTR_M.asp?Pro_No="+d.data.ProNo+"AAA38STATUS=QUERYAAA38Dept_Code="+d.data.DeptCode+"AAA38VER="+d.data.Ver+"AAA38CHART_NO="+o.data.ChartNo+"AAA38ACCESSNUM="+d.data.Accessnum;var k=m+"main/verify.asp?ltype=1&NewWindow=N&user_id="+a+"&PAT_IDNO="+l+"&web_id=NUR/NURTR_L.asp?Pro_No="+d.data.ProNo+"AAA38STATUS=QUERYAAA38Dept_Code="+d.data.DeptCode+"AAA38VER="+d.data.Ver+"AAA38CHART_NO="+o.data.ChartNo+"AAA38ACCESSNUM="+d.data.Accessnum;k="NUR/NURTR_L.asp?LOG_USER_ID="+a+"&Pro_No="+d.data.ProNo+"&STATUS=QUERY&Dept_Code="+d.data.DeptCode+"&VER="+d.data.Ver+"&CHART_NO="+o.data.ChartNo+"&ACCESSNUM="+d.data.Accessnum;k=NisApp.view.NisPDFUtil.GetXAccessControl()+"/"+escape(k);$("#CathFrame").attr("src",k).attr("_src",k);NisTRApp.view.FormUtil.ResetContentDiv("CathFrame",this.down("#CathDetail"));NisTRApp.view.Misc.createResizeFrameContent($("#CathFrame"),k);this.down("#addCathBtn").setHidden(false);this.down("#dcCathBtn").setHidden(false);a=null;l=null;n=null;m=null;k=null;delete a;delete l;delete n;delete m;delete k},onAddCathBtnTap:function(b,g,a){g.preventDefault();var f=$("#CathFrame").attr("_src").toString().replace(/NUR\/NURTR_L.asp/,"NUR/NURFORM_01.asp");var d=f.replace(/(STATUS%3D)QUERY/,"$1ADD");NisTRApp.view.FormUtil.ResetContentDiv("CathFrame",this.down("#CathDetail"));NisTRApp.view.Misc.createResizeFrameContent($("#CathFrame"),d);f=null;delete f;d=null;delete d;return false},onDcCathBtnTap:function(b,g,a){g.preventDefault();var f=$("#CathFrame").attr("_src").toString().replace(/NUR\/NURTR_L.asp/,"NUR/NURFORM_01.asp");var d=f.replace(/(STATUS%3D)QUERY/,"$1DC");NisTRApp.view.FormUtil.ResetContentDiv("CathFrame",this.down("#CathDetail"));NisTRApp.view.Misc.createResizeFrameContent($("#CathFrame"),d);f=null;delete f;d=null;delete d;return false},onContainerDestroy:function(a){NisTRApp.view.FormUtil.ResetContentDiv("CathFrame",this.down("#CathDetail"));if(Ext.getStore("sPatientCatheter")!=null){Ext.getStore("sPatientCatheter").removeAll();Ext.getStore("sPatientCatheter").destroy()}if(!Ext.isEmpty(Ext.getCmp("_opdCathFormPanel"))){Ext.getCmp("_opdCathFormPanel").destroy()}$("#CathFrame").attr("src","").attr("_src","");_ReloaCathdData=null;delete _ReloaCathdData;this.removeAll(true,true)},onContainerPainted:function(b,a){this.LoadPatientCatheter()},initialize:function(){this.callParent();_ReloaCathdData=function(){try{if(!Ext.isEmpty(Ext.getCmp("_opdCathFormPanel"))){Ext.getCmp("_opdCathFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NC_MainPanel")[0])){Ext.ComponentQuery.query("#NC_MainPanel")[0].show()}if(!Ext.isEmpty(Ext.getStore("sPatientCatheter"))){Ext.getStore("sPatientCatheter").removeAll();Ext.getStore("sPatientCatheter").load()}}catch(a){console.error("_ReloaCathdData",a)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("NurCath 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("NurCath 住院病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("NurCath 門診病人資料錯誤");return false}if(Ext.getStore("sPatientCatheter")==null){Ext.create("Ext.data.Store",{storeId:"sPatientCatheter",clearOnPageLoad:false,model:"NisTRApp.model.Patient.ActiveCatheterData",timeout:15000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Search/PatientCatheterList.ashx",reader:{type:"json"}}})}},LoadPatientCatheter:function(d){if(Ext.getStore("sPatientCatheter").isLoading()||Ext.isEmpty(this.getRecord())){return false}var b=this.getRecord();var a=Ext.getStore("sPatientCatheter");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNO});this.down("#CathHistoryList").setStore(a);a.load();NisTRApp.view.FormUtil.ResetContentDiv("CathFrame",this.down("#CathDetail"));this.down("#addCathBtn").setHidden(true);this.down("#dcCathBtn").setHidden(true);a=null;delete a;b=null;delete b;return false}});Ext.define("NisTRApp.view.NIS_FormPanel",{extend:Ext.Panel,config:{frameID:"nisFormFrame",divID:"NisFormContent",formId:"empty",height:"100%",width:"100%",url:{},callback:{},successFn:{},failedFn:{},caller:{},closeFn:{},loadedFn:{},items:[{xtype:"panel",height:"100%",html:'<div id="NisFormContent" style="width: 100% !important; height: 100% !important;"> </div>',itemId:"NisFormContentPanel",width:"100%"},{xtype:"toolbar",docked:"bottom",itemId:"NIS_FormToolbar",items:[{xtype:"button",itemId:"NIS_FormBackBtn",ui:"confirm-back",width:"200px",text:"關 閉"},{xtype:"button",itemId:"NIS_FormRefresh",left:"",right:"10px",ui:"decline",width:"200px",text:"重 新 整 理"}]}],listeners:[{fn:"onNIS_FormBackBtnTap",event:"tap",delegate:"#NIS_FormBackBtn"},{fn:"onNIS_FormRefreshTap",event:"tap",delegate:"#NIS_FormRefresh"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelShow",event:"show"}]},onNIS_FormBackBtnTap:function(d,f,b){var g=this.getCloseFn();var a=this.getCaller();g(a);this.destroy()},onNIS_FormRefreshTap:function(b,f,a){try{this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv(this.getDivID(),this.down("#NisFormContentPanel"),"scroll-wrapper");var d=this;NisTRApp.view.Misc.createFrameContent($("#"+this.getDivID()),this.getUrl(),this.getFrameID(),function(){if(!Ext.isEmpty(d)){d.setMasked(false);var e=d.getLoadedFn();if(!Ext.isEmpty(e)&&Ext.isFunction(e)){e(d.getDivID(),d.getFrameID(),d.getCaller())}e=null;delete e;d=null;delete d}Ext.Viewport.setMasked(false)})}catch(f){}},onPanelDestroy:function(a){NisTRApp.view.FormUtil.ResetContentDiv(this.getDivID(),this.down("#NisFormContentPanel"));me=null;delete me;if(!Ext.isEmpty(Ext.getCmp("timeCanvasPanel"))){Ext.getCmp("timeCanvasPanel").destroy()}console.log("NIS_FormPanel On Destroy");this.removeAll(true,true)},onPanelShow:function(a,b){console.log("NIS_FormPanel Connect To:",this.getUrl());this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv(this.getDivID(),this.down("#NisFormContentPanel"),"scroll-wrapper");var d=this;NisTRApp.view.Misc.createFrameContent($("#"+this.getDivID()),this.getUrl(),this.getFrameID(),function(){if(!Ext.isEmpty(d)){d.setMasked(false);var e=d.getLoadedFn();if(!Ext.isEmpty(e)&&Ext.isFunction(e)){e(d.getDivID(),d.getFrameID(),d.getCaller())}e=null;delete e;d=null;delete d}Ext.Viewport.setMasked(false)})},initialize:function(){this.callParent();if(Ext.isEmpty(this.getUrl())){Ext.Msg.alert("網址錯誤");return false}NisTRApp.view.FormUtil.ResetContentDiv(this.getDivID(),this.down("#NisFormContentPanel"),"scroll-wrapper");return;if(this.getFormId()=="480EEAC062364DAD945B48E95582914E"||this.getFormId()=="ILOD5H73Q2TULELXIGZBP6G264"){if(!Ext.isEmpty(Ext.getCmp("timeCanvasPanel"))){Ext.getCmp("timeCanvasPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("timeCanvasPanel"))){var a=Ext.create("NisTRApp.view.CanvasPanel",{id:"timeCanvasPanel",sigWidth:768,sigHeight:350,centered:false,maxHeight:"2.2em",right:"230px",width:"180px",label:"<div>小時鐘繪圖 (請 點 我)</div>",labelWidth:"99%"});this.down("#NIS_FormToolbar").add(a);a=null;delete a}}return},getFrameID:function(){return this.getDivID()+"innerFrame"}});Ext.define("NisTRApp.view.Nur.OPD_Assessment",{extend:Ext.Container,alias:"widget.NurOPD_Assessment",statics:{LoadActiveAccessmentRecord:function(b,e,f,d){if(Ext.getStore("sOpdAssessmentRecord").isLoading()||Ext.isEmpty(b)){return}var g=b;var a=Ext.getStore("sOpdAssessmentRecord");a.getProxy().setExtraParams({FunctionType:"Assessment",ChartNo:g.data.ChartNo,InpNo:"0",LimitMonth:"3",BegDate:e,EndDate:f,Discontinue:false});a.load({callback:function(j,h,k){},scope:d});a=null;delete a;g=null;delete g},LoadInactiveAccessmentRecord:function(b,e,f,d){if(Ext.getStore("sOpdInactiveAssessmentRecord").isLoading()||Ext.isEmpty(b)){return}var g=b;var a=Ext.getStore("sOpdInactiveAssessmentRecord");a.getProxy().setExtraParams({FunctionType:"Assessment",ChartNo:g.data.ChartNo,InpNo:"0",LimitMonth:"3",BegDate:e,EndDate:f,Discontinue:true});a.load({callback:function(j,h,k){},scope:d});a=null;delete a;g=null;delete g},OpenAssessmentForm:function(b){if(Ext.isEmpty(b)){Ext.Msg.alert("OPD_Assessment 表單網址錯誤");return}try{var d=Ext.getCmp("_opdAssessmentFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_opdAssessmentFormPanel",url:b,divID:"OpdAssessmentFrameDIV"})}if(!Ext.isEmpty(d)){var a=Ext.ComponentQuery.query("#NA_MainPanel")[0];d.setCaller(a);d.setCloseFn(function(e){e.setHidden(false)});Ext.ComponentQuery.query("#NA_Main")[0].animateActiveItem(d,{type:"slide",direction:"right"});a.setHidden(true);d.show();a=null;delete a}d=null;delete d;patInfo=null;delete patInfo;b=null;delete b}catch(f){console.log(f)}},LoadFormHistory:function(a,h,d,f,b){if(Ext.getStore("sOpdAssessmentHistory").isLoading()||Ext.isEmpty(a)){return}var g=a;var e=Ext.getStore("sOpdAssessmentHistory");e.removeAll();e.getProxy().setExtraParams({FunctionType:h,BegDate:d,EndDate:f,ChartNo:g.data.ChartNo,});e.load({callback:function(k,j,l){},scope:this});e=null;delete e;g=null;delete g}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NA_Main",maxWidth:"",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NA_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",height:"100%",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",itemId:"NA_NewAssessmentList",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的護理評估"}]},{xtype:"tabpanel",height:"100%",itemId:"NA_MainTabPanel",width:"80%",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"Active",height:"100%",itemId:"NA_OPD_ActiveGridPanel",width:"100%",items:[{xtype:"toolbar",docked:"top",itemId:"NNOA_ToolBar",items:[{xtype:"segmentedbutton",itemId:"NNOA_FnBtn",margin:"0 0 0 20",width:"30%",items:[{xtype:"button",hidden:true,itemId:"NNOA_AllBtn",width:"33%",text:"MyButton35"},{xtype:"button",itemId:"NNOA_OpdBtn",width:"50%",text:" 門 診 "},{xtype:"button",itemId:"NNOA_PreBtn",width:"50%",text:" 診 前 準 備"}]},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NNOA_ActBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NNOA_ActEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NNOA_ActRefresh",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}],listeners:[{fn:function(b,a){},event:"painted"}]},{xtype:"container",title:"Inactive",height:"100%",itemId:"NA_OPD_InactiveGridPanel",width:"100%",items:[{xtype:"toolbar",docked:"top",itemId:"NNOIA_ToolBar",items:[{xtype:"segmentedbutton",itemId:"NNOIA_FnBtn",margin:"0 0 0 20",width:"30%",items:[{xtype:"button",hidden:true,itemId:"NNOIA_AllBtn",width:"33%",text:"MyButton35"},{xtype:"button",itemId:"NNOIA_OpdBtn",width:"50%",text:" 門 診 "},{xtype:"button",itemId:"NNOIA_PreBtn",width:"50%",text:" 診 前 準 備"}]},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NNOIA_InactBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NNOIA_InactEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NNOIA_InactRefresh",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sOpdInactiveAssessmentRecord").getCount()<=0){NisTRApp.view.Nur.OPD_Assessment.LoadInactiveAccessmentRecord(this.getRecord(),this.down("#NNOIA_InactBegDate").getValue(),this.down("#NNOIA_InactEndDate").getValue(),this)}},event:"painted"}]},{xtype:"container",title:"評估歷程",height:"100%",itemId:"NA_OPD_AssessmentHistory",width:"100%",items:[{xtype:"list",height:"100%",itemId:"NNOA_History",width:"100%",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'<span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span>',"</div>","<br>",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[NisTRApp.view.DateUtil.FormDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>',"<br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Html} </pre></span>',"</div>",""],plugins:[{type:"pullrefresh"}]},{xtype:"toolbar",docked:"top",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NNOA_HistoryBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NNOA_HistoryEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NNOA_HistoryRefresg",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sOpdAssessmentHistory").getCount()<=0){NisTRApp.view.Nur.OPD_Assessment.LoadFormHistory(this.getRecord(),"Assessment",this.down("#NNOA_HistoryBegDate").getValue(),this.down("#NNOA_HistoryEndDate").getValue(),this)}},event:"painted"}]},{xtype:"container",title:"初診評估",height:"100%",itemId:"NA_OPD_InitialAssessment",width:"100%",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOA_InitialAssessment",disableSelection:false,emptyText:'<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>{Title}</div>"],plugins:[{type:"pullrefresh"}]}],listeners:[{fn:function(d,b){if(Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();if(Ext.getStore("sOpdInitialRecordList").getCount()<=0){var a=Ext.getStore("sOpdInitialRecordList");if(a.isLoading()){return}a.removeAll();a.getProxy().setExtraParams({ChartNo:e.data.ChartNo});a.load();a=null;delete a}e=null;delete e},event:"painted"}]}]}]}]}],listeners:[{fn:"onNA_NewAssessmentListLeafItemTap",event:"leafitemtap",delegate:"#NA_NewAssessmentList"},{fn:"onNNOA_AllBtnTap",event:"tap",delegate:"#NNOA_AllBtn"},{fn:"onNNOA_OpdBtnTap",event:"tap",delegate:"#NNOA_OpdBtn"},{fn:"onNNOA_PreBtnTap",event:"tap",delegate:"#NNOA_PreBtn"},{fn:"onNNOA_ActRefreshTap",event:"tap",delegate:"#NNOA_ActRefresh"},{fn:"onNA_OPD_ActiveGridPanelUpdatedata",event:"updatedata",delegate:"#NA_OPD_ActiveGridPanel"},{fn:"onNNOIA_AllBtnTap",event:"tap",delegate:"#NNOIA_AllBtn"},{fn:"onNNOIA_OpdBtnTap",event:"tap",delegate:"#NNOIA_OpdBtn"},{fn:"onNNOIA_PreBtnTap",event:"tap",delegate:"#NNOIA_PreBtn"},{fn:"onNNOIA_InactRefreshTap",event:"tap",delegate:"#NNOIA_InactRefresh"},{fn:"onNNOA_HistoryRefresgTap",event:"tap",delegate:"#NNOA_HistoryRefresg"},{fn:"onNNOA_InitialAssessmentItemTap",event:"itemtap",delegate:"#NNOA_InitialAssessment"},{fn:"onNA_MainPanelShow",event:"show",delegate:"#NA_MainPanel"},{fn:"onContainerDestroy",event:"destroy"}]},onNA_NewAssessmentListLeafItemTap:function(b,l,h,j,g,k,m){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var o=this.getRecord();var f,a,d;if(o.data.Source.Type==1){f="0";a=o.data.Source.Name;d=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){f=o.data.InpNO;a=o.data.Source.Name;d=0}else{Ext.Msg.alert("NurCath 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,d,"","","_ReloadAccessmentData","",f,a);NisTRApp.view.Nur.OPD_Assessment.OpenAssessmentForm(n);n=null;delete n;f=null;a=null;d=null;delete f;delete a;delete d},onNNOA_AllBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");if(!Ext.isEmpty(Ext.getStore("sOpdAssessmentRecord"))){Ext.getStore("sOpdAssessmentRecord").clearFilter()}},onNNOA_OpdBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");var a=Ext.getStore("sOpdAssessmentRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(""!=e.data.CategoryID&&"CULKIAYFAOBUNKGB4HM5ST5HZM"!=e.data.CategoryID&&"UDSM64KQDEGEXP6RWYV4AQ2NZA"!=e.data.CategoryID){return true}else{return false}},this)}a=null;delete a},onNNOA_PreBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");var a=Ext.getStore("sOpdAssessmentRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(""!=e.data.CategoryID&&"CULKIAYFAOBUNKGB4HM5ST5HZM"==e.data.CategoryID){return true}else{return false}},this)}a=null;delete a},onNNOA_ActRefreshTap:function(b,d,a){NisTRApp.view.Nur.OPD_Assessment.LoadActiveAccessmentRecord(this.getRecord(),this.down("#NNOA_ActBegDate").getValue(),this.down("#NNOA_ActEndDate").getValue(),this)},onNA_OPD_ActiveGridPanelUpdatedata:function(a,d,b){if(Ext.getStore("sOpdAssessmentRecord").getCount()<=0){NisTRApp.view.Nur.OPD_Assessment.LoadActiveAccessmentRecord(this.getRecord(),this.down("#NNOA_ActBegDate").getValue(),this.down("#NNOA_ActEndDate").getValue(),this)}},onNNOIA_AllBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");if(!Ext.isEmpty(Ext.getStore("sOpdInactiveAssessmentRecord"))){Ext.getStore("sOpdInactiveAssessmentRecord").clearFilter()}},onNNOIA_OpdBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");var a=Ext.getStore("sOpdInactiveAssessmentRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(""!=e.data.CategoryID&&"CULKIAYFAOBUNKGB4HM5ST5HZM"!=e.data.CategoryID&&"UDSM64KQDEGEXP6RWYV4AQ2NZA"!=e.data.CategoryID){return true}else{return false}},this)}a=null;delete a},onNNOIA_PreBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");var a=Ext.getStore("sOpdInactiveAssessmentRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(""!=e.data.CategoryID&&"CULKIAYFAOBUNKGB4HM5ST5HZM"==e.data.CategoryID){return true}else{return false}},this)}a=null;delete a},onNNOIA_InactRefreshTap:function(b,d,a){NisTRApp.view.Nur.OPD_Assessment.LoadInactiveAccessmentRecord(this.getRecord(),this.down("#NNOIA_InactBegDate").getValue(),this.down("#NNOIA_InactEndDate").getValue(),this)},onNNOA_HistoryRefresgTap:function(b,d,a){NisTRApp.view.Nur.OPD_Assessment.LoadFormHistory(this.getRecord(),"Assessment",this.down("#NNOA_HistoryBegDate").getValue(),this.down("#NNOA_HistoryEndDate").getValue(),this)},onNNOA_InitialAssessmentItemTap:function(b,f,g,d,h,j){if(Ext.isEmpty(this.getRecord())){return}var n=this.getRecord();if(d.data.Ordseq==1){var m=NisTRApp.view.FormUtil.AssessmentAddr("CRenderAssesment",d.data.FormId,NisTRApp.view.SysUtility.GetUserID(),n.data.ChartNo,(n.data.ChartSeq?n.data.ChartSeq:0),d.data.CategoryId,d.data.OpenRecordId,"_ReloadAccessmentData","","0","OPD");if(NisTRApp.view.SysUtility.IsProtalDevice()){NisTRApp.view.Misc.createPortalContent(m,_ReloadAccessmentData)}else{NisTRApp.view.Nur.OPD_Assessment.OpenAssessmentForm(m)}m=null;delete m}else{if(d.data.Ordseq==2){var a,k,m;a=NisTRApp.view.SysUtility.GetUserID();k=n.data.PatIdNo;if(null==a||""==a){a="003549"}m="http://edsweb.kfcc.intra/Evaluate/eva_search.aspx?userid="+a+"&pat_idno="+k;var l=document.createElement("a");l.href=m;if(NisTRApp.view.SysUtility.IsProtalDevice()){l.click()}else{window.open(m)}m=null;delete m;a=null;delete a;k=null;delete a}}n=null;delete k},onNA_MainPanelShow:function(a,b){if(!Ext.isEmpty(Ext.getCmp("_opdAssessmentFormPanel"))){Ext.getCmp("_opdAssessmentFormPanel").destroy()}},onContainerDestroy:function(a){if(Ext.getStore("sOpdAssessmentRecord")!=null){Ext.getStore("sOpdAssessmentRecord").removeAll();Ext.getStore("sOpdAssessmentRecord").destroy()}if(Ext.getStore("sOpdInactiveAssessmentRecord")!=null){Ext.getStore("sOpdInactiveAssessmentRecord").removeAll();Ext.getStore("sOpdInactiveAssessmentRecord").destroy()}if(Ext.getStore("sOpdAssessmentHistory")!=null){Ext.getStore("sOpdAssessmentHistory").removeAll();Ext.getStore("sOpdAssessmentHistory").destroy()}if(Ext.getStore("sOpdInitialRecordList")!=null){Ext.getStore("sOpdInitialRecordList").removeAll();Ext.getStore("sOpdInitialRecordList").destroy()}if(!Ext.isEmpty(Ext.getCmp("_opdAssessmentFormPanel"))){Ext.getCmp("_opdAssessmentFormPanel").destroy()}_ReloadAccessmentData=null;delete _ReloadAccessmentData;this.removeAll(true,true)},initialize:function(){this.callParent();_ReloadAccessmentData=function(f){try{if(!Ext.isEmpty(Ext.getStore("sOpdAssessmentRecord"))){Ext.getStore("sOpdAssessmentRecord").load()}if(!Ext.isEmpty(Ext.getStore("sOpdInactiveAssessmentRecord"))){Ext.getStore("sOpdInactiveAssessmentRecord").load()}if(null!=f&&undefined!=f&&"TempSave"==f){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_opdAssessmentFormPanel"))){Ext.getCmp("_opdAssessmentFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NA_MainPanel")[0])){Ext.ComponentQuery.query("#NA_MainPanel")[0].show()}}}catch(g){console.error("_ReloadAccessmentData",g)}};this.DateInitial();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("OPD_Assessment 病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("OPD_Assessment 門診病人資料錯誤");return false}if(this.getRecord().data.Source.Type==2){Ext.Msg.alert("OPD_Assessment 不支援住院病人");return false}if(Ext.isEmpty(Ext.getStore("sNewAssessmentRecord"))){Ext.create("Ext.data.TreeStore",{storeId:"sNewAssessmentRecord",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Assessment",Source:this.getRecord().data.Source.Name},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NA_NewAssessmentList").setStore(Ext.getStore("sNewAssessmentRecord"));if(Ext.getStore("sNewAssessmentRecord").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sOpdAssessmentRecord"))){Ext.create("Ext.data.Store",{storeId:"sOpdAssessmentRecord",autoLoad:false,model:"NisTRApp.model.Form.OpenRecord",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/OpenRecordV2.ashx",reader:{type:"json"}}})}var d=Ext.getCmp("OpdAssessmentGrid");if(Ext.isEmpty(d)){d=this.GenAssessmentGrid("OpdAssessmentGrid","","",true);d.getTitleBar().hide();var b=Ext.getStore("sOpdAssessmentRecord");d.setStore(b);d.addListener("itemtap",this.ItemSingleTapAccessmentGrid,d);this.down("#NA_OPD_ActiveGridPanel").add(d);b=null;delete b}d=null;delete d;this.down("#NA_OPD_ActiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sOpdInactiveAssessmentRecord"))){Ext.create("Ext.data.Store",{storeId:"sOpdInactiveAssessmentRecord",autoLoad:false,model:"NisTRApp.model.Form.OpenRecord",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/OpenRecordV2.ashx",reader:{type:"json"}}})}var e=Ext.getCmp("OpdInActiveAssessmentGrid");if(Ext.isEmpty(e)){e=this.GenAssessmentGrid("OpdInActiveAssessmentGrid","","",false);e.getTitleBar().hide();var a=Ext.getStore("sOpdInactiveAssessmentRecord");e.setStore(a);e.addListener("itemtap",this.ItemSingleTapAccessmentGrid,e);this.down("#NA_OPD_InactiveGridPanel").add(e);a=null;delete a}e=null;delete e;this.down("#NA_OPD_InactiveGridPanel").setRecord(this.getRecord());this.down("#NNOA_OpdBtn").fireEvent("tap",this.down("#NNOA_OpdBtn"),null,null);this.down("#NNOIA_OpdBtn").fireEvent("tap",this.down("#NNOIA_OpdBtn"),null,null);if(Ext.isEmpty(Ext.getStore("sOpdAssessmentHistory"))){Ext.create("Ext.data.Store",{storeId:"sOpdAssessmentHistory",autoLoad:false,model:"NisTRApp.model.EMR.UnsignForm",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/FormHistoryV2.ashx",reader:{type:"json"}}})}this.down("#NA_OPD_AssessmentHistory").setRecord(this.getRecord());this.down("#NNOA_History").setStore(Ext.getStore("sOpdAssessmentHistory"));if(Ext.isEmpty(Ext.getStore("sOpdInitialRecordList"))){Ext.create("Ext.data.Store",{storeId:"sOpdInitialRecordList",autoLoad:false,model:"NisTRApp.model.Form.InitialRecordItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/InitialRecordList.ashx",reader:{type:"json"}}})}this.down("#NA_OPD_InitialAssessment").setRecord(this.getRecord());this.down("#NNOA_InitialAssessment").setStore(Ext.getStore("sOpdInitialRecordList"))},LoadListItem:function(){if(Ext.getStore("sNewAssessmentRecord").isLoading()||Ext.isEmpty(this.getRecord())){return false}var b=this.getRecord();var a=Ext.getStore("sNewAssessmentRecord");a.removeAll();a.load();a=null;delete a;b=null;delete b;return false},GenAssessmentGrid:function(a,b,d,e){if(e==true){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing"},{type:"pullrefresh"}],columns:[{text:"評估項目",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:250,tpl:'<span style="color:{StyleColor}; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:true},{text:"副標題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:150,tpl:'<span style="color:blue; font-size: 10px">{SubTitle}</span>',flex:1,dataIndex:"SubTitle",editable:false,sortable:true},{text:"開始日期",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.StartDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true,hidden:false},{text:"掛號日期 / 序",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RegDate)]} ({ChartSeq})</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true,hidden:true},{text:"最後追蹤日",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.PlanLatestDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"PlanLatestDate",editable:false,sortable:true},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[this.status(values.Finished)]}</span>',{status:function(f){if(f==true){return"存檔"}else{return"暫存"}}}),flex:1,width:80,dataIndex:"Finished",editable:false,sortable:false},{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="AGEDIT_{KeyOne}" class="btn link-btn" style="font-size: 14px">評估單張</a>',flex:1,width:80,editable:false,sortable:false},{text:"瀏覽",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="AGHISTORY_{KeyOne}"  class="btn link-btn" style="font-size: 14px">評估歷程</a>',flex:1,width:80,editable:false,sortable:false,hidden:false},{text:"停用",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="AGSTOP_{KeyOne}" class="btn link-btn" style="font-size: 14px">停用</a>',flex:1,width:80,editable:false,sortable:false}]})}else{return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing",type:"pullrefresh"}],columns:[{text:"問題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:250,tpl:'<span style="color:{StyleColor}; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:true},{text:"副標題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:150,tpl:'<span style="color:blue; font-size: 10px">{SubTitle}</span>',flex:1,dataIndex:"SubTitle",editable:false,sortable:true},{text:"開始日期",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.StartDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true,hidden:false},{text:"掛號日期 / 序",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RegDate)]} ({ChartSeq})</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true,hidden:true},{text:"最後追蹤日",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.PlanLatestDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"PlanLatestDate",editable:false,sortable:true},{text:"停用人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:blue; font-size: 14px">{DiscontinueUserName}</span>',flex:1,width:80,dataIndex:"DiscontinueUserID",hidden:true,editable:false,sortable:true},{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="AIGEDIT_{KeyOne}" class="btn link-btn" style="font-size: 14px">評估單張</a>',flex:1,width:80,editable:false,sortable:false},{text:"瀏覽",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="AIGHISTORY_{KeyOne}" class="btn link-btn" style="font-size: 14px">評估歷程</a>',flex:1,width:80,editable:false,sortable:false,hidden:false},{text:"回復",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.RollBackStr(values.DiscontinueUserID)]}",{RollBackStr:function(f){return'<a id="AIGROLLBACK_{KeyOne}" class="btn link-btn" style="font-size: 14px">回復</a>'}}),flex:1,width:80,editable:false,sortable:false}]})}},ItemSingleTapAccessmentGrid:function(m,h,j,g,k,l){var f=function f(p){if(Ext.isEmpty(p)){return}var e=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment",p.data.FormID,NisTRApp.view.SysUtility.GetUserID(),p.data.ChartNo,(p.data.ChartSeq?p.data.ChartSeq:0),p.data.CategoryID,p.data.OpenRecordID,"_ReloadAccessmentData","","0","OPD");NisTRApp.view.Nur.OPD_Assessment.OpenAssessmentForm(e);e=null;delete e};var o=function o(p){if(Ext.isEmpty(p)){return}var e=NisTRApp.view.FormUtil.AssessmentAddr("CRenderAssesment",p.data.FormID,NisTRApp.view.SysUtility.GetUserID(),p.data.ChartNo,(p.data.ChartSeq?p.data.ChartSeq:0),p.data.CategoryID,p.data.OpenRecordID,"","","0","OPD");e=e+"&Count=3";NisTRApp.view.Nur.OPD_Assessment.OpenAssessmentForm(e);e=null;delete e};var b=function o(p,e){Ext.Msg.confirm("Confirm","是否確認停用此評估單?",function(r,s,q){if(r=="no"){return}else{if(r=="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/DistinueRecord.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OpenRecordID:p,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(u){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800);Ext.getStore("sOpdAssessmentRecord").load();Ext.getStore("sOpdInactiveAssessmentRecord").load()},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0)}})}}},this)};var a=function a(p,e){Ext.Msg.confirm("Confirm","確認active此評估單張?",function(r,s,q){if(r=="no"){return}else{if(r=="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/RecoverDistinueRecord.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OpenRecordID:p,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(u){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800);Ext.getStore("sOpdAssessmentRecord").load();Ext.getStore("sOpdInactiveAssessmentRecord").load()},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0)}})}}},this)};event.preventDefault();if(k.event.target.nodeName=="A"){var n=k.event.target.id.split("_");var d=g.data;if("AGEDIT"==n[0]||"AIGEDIT"==n[0]){f(g)}else{if("AGHISTORY"==n[0]||"AIGHISTORY"==n[0]){o(g)}else{if("AGSTOP"==n[0]){b(d.OpenRecordID,m)}else{if("AIGROLLBACK"==n[0]){a(d.OpenRecordID,m)}}}}}f=null;delete f;o=null;delete o;b=null;delete b;a=null;delete a;return false},DateInitial:function(){this.down("#NNOA_ActBegDate").setValue(NisTRApp.view.DateUtil.AppFirstYear());this.down("#NNOA_ActEndDate").setValue(new Date());this.down("#NNOIA_InactBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.down("#NNOIA_InactEndDate").setValue(new Date());this.down("#NNOA_HistoryBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.down("#NNOA_HistoryEndDate").setValue(new Date())}});Ext.define("NisTRApp.view.VitalSigns.MonitorCreatePanel",{extend:Ext.Panel,config:{centered:true,height:420,width:520,layout:{type:"vbox"},modal:true,monitorItem:{},caller:{},tprItem:{},successFn:{},items:[{xtype:"toolbar",docked:"top",itemId:"VSMCP_HeadBar",title:"Title"},{xtype:"panel",flex:1,itemId:"VSMCP_Main",layout:{type:"vbox"},items:[{xtype:"fieldset",itemId:"VSMCP_MainFieldSet"},{xtype:"toolbar",docked:"bottom",itemId:"VSMCP_FootBar",items:[{xtype:"button",itemId:"VSMCP_SaveBtn",left:"1px",ui:"decline",width:"47%",text:"資 料 儲 存"},{xtype:"button",itemId:"VSMCP_CancelBtn",right:"1px",ui:"confirm",width:"47%",text:"取 消"}]}]},{xtype:"panel",flex:1,hidden:true,itemId:"VSMCP_Form",layout:{type:"vbox"},items:[{xtype:"list",flex:1,itemId:"VSMCP_Monitorphraselist",ui:"round",mode:"MULTI",itemTpl:["<div>{name}</div>"]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",centered:true,itemId:"mybutton111",ui:"confirm",width:"90%",text:"帶 入 監 測 記 錄"}]}]}],listeners:[{fn:"onVSMCP_SaveBtnTap",event:"tap",delegate:"#VSMCP_SaveBtn"},{fn:"onVSMCP_CancelBtnTap",event:"tap",delegate:"#VSMCP_CancelBtn"},{fn:"onVSMCP_MainShow",event:"show",delegate:"#VSMCP_Main"},{fn:"onVSMCP_FormShow",event:"show",delegate:"#VSMCP_Form"},{fn:"onMybutton111Tap",event:"tap",delegate:"#mybutton111"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelShow",event:"show"}]},onVSMCP_SaveBtnTap:function(f,g,h){if(Ext.isEmpty(this.down("#VSMCP_MainFieldSet"))||Ext.isEmpty(this.getMonitorItem())||Ext.isEmpty(this.getRecord())){return false}var b=this.down("#VSMCP_MainFieldSet");if(Ext.isEmpty(b.down("#VSMCP_MonitorValue").getValue())&&Ext.isEmpty(b.down("#VSMCP_MonitorRemark").getValue())){NisTRApp.view.Misc.Alert("請輸入數值或紀錄!!",2000);return false}var j=b.down("#VSMCP_MonitorValue").getValue();var m=b.down("#VSMCP_MonitorRemark").getValue();var l=/^(-?\d+)(\.\d+)?$/;if(null!=j&&""!=j&&!l.test(j)){NisTRApp.view.Misc.Alert("數值欄位，請輸入數字",2000);return false}var a=this.getMonitorItem();var k=this.getRecord();var d=this.down("#VSMCP_MonitorDateTime").getValue();this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/MonitorInsert.ashx",scope:this,method:"POST",params:{ChartNo:k.data.ChartNo,InpNo:k.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),TprType:a.data.TprType,TprCode:a.data.TprCode,TprValue:j,Remark:m,InputDateTime:d,TprName:a.data.Name},success:function(e){this.setMasked(false);var n=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(n.Message,(n.Success?800:0));if(n.Success&&!Ext.isEmpty(this.getSuccessFn())&&Ext.isFunction(this.getSuccessFn())){this.getSuccessFn()(this.getCaller());this.destroy()}n=null;delete n},failure:function(){this.setMasked(false);Ext.Msg.alert("存檔失敗")}});j=null;delete j;m=null;delete m;l=null;delete l;tpr=null;delete tpr;a=null;delete a;k=null;delete k;d=null;delete d;b=null;delete b},onVSMCP_CancelBtnTap:function(b,d,a){this.destroy()},onVSMCP_MainShow:function(a,b){this.down("#VSMCP_Form").setHidden(true)},onVSMCP_FormShow:function(a,b){this.down("#VSMCP_Main").setHidden(true)},onMybutton111Tap:function(d,f,b){var g="";var a=this.down("#VSMCP_Monitorphraselist").getSelection();Ext.each(a,function(e){if(null!=e){g=g+e.data.name}});this.down("#VSMCP_MonitorRemark").setValue(g);g=null;delete null;a=null;delete null;this.down("#VSMCP_Main").setHidden(false)},onPanelDestroy:function(a){if(Ext.getStore("sVSMCPSystpr")!=null){Ext.getStore("sVSMCPSystpr").removeAll();Ext.getStore("sVSMCPSystpr").destroy()}if(Ext.getStore("storeOptions2")!=null){Ext.getStore("storeOptions2").removeAll();Ext.getStore("storeOptions2").destroy()}console.log("On Destroy:","MonitorCreatePanel");this.removeAll(true,true)},onPanelShow:function(b,d){var a=NisTRApp.view.SysUtility.tapEventName();$("#_monitorRemarkItem").unbind(a);var e=this;$("#_monitorRemarkItem").bind(a,function(){if(true==e.down("#VSMCP_Form").isHidden()){e.down("#VSMCP_Form").show()}else{e.down("#VSMCP_Form").hide()}});a=null;delete a;one=null;delete one},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getMonitorItem())||Ext.isEmpty(this.getMonitorItem().data.Name)){Ext.Msg.alert("MonitorCreatePanel 住院資料錯誤");return false}var b=this.getMonitorItem().data;this.down("#VSMCP_HeadBar").setTitle(b.Name);if(Ext.getStore("sVSMCPSystpr")==null){Ext.create("Ext.data.Store",{storeId:"sVSMCPSystpr",clearOnPageLoad:false,model:"NisTRApp.model.Sys.SystprEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QuerySysTpr.ashx",reader:{type:"json"}}})}if(Ext.data.ModelManager.getModel("Options")==null){Ext.define("Options",{extend:Ext.data.Model,config:{fields:[{name:"name",type:"string"},{name:"id",type:"int"}]}})}if(Ext.getStore("storeOptions2")==null){Ext.create("Ext.data.Store",{model:"Options",id:"storeOptions2"})}if(Ext.isEmpty(this.down("#VSMCP_MonitorDateTime"))){var a=Ext.create("Ext.ux.field.DateTimePicker",{itemId:"VSMCP_MonitorDateTime",name:"NoteDateTime",label:"醫療日期",value:new Date(),width:"99%",labelWidth:"30%",autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}});this.down("#VSMCP_MainFieldSet").add(a);a=null;delete a}var d=Ext.create("Ext.field.Text",{itemId:"VSMCP_MonitorValue",label:"數值 "+b.TprUnit,width:"99%",labelWidth:"30%",autoCapitalize:true,placeHolder:"請輸入(數字)",required:false,cleanIcon:false});this.down("#VSMCP_MainFieldSet").add(d);d=Ext.create("Ext.field.Text",{itemId:"VSMCP_MonitorRemark",label:'文字記錄<img src="../_/img/teach3.png" id="_monitorRemarkItem" style="width:25px;height:25px;"></img>',width:"99%",labelWidth:"30%",autoCapitalize:true,placeHolder:"請輸入",required:false,cleanIcon:false});this.down("#VSMCP_MainFieldSet").add(d);d=Ext.create("Ext.field.TextArea",{itemId:"VSMCP_MonitorDesc",label:"釋義",width:"99%",labelWidth:"30%",autoCapitalize:true,readOnly:true,maxRows:6,required:false,cleanIcon:false});this.down("#VSMCP_MainFieldSet").add(d);d=null;delete d;this.LoadTpr()},LoadTpr:function(){var b=Ext.getStore("sVSMCPSystpr");var a=this.getMonitorItem().data;b.getProxy().setExtraParams({TprCode:a.TprCode});this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});$("#_monitorRemarkItem").hide();b.load({callback:function(e,d,h){this.setMasked(false);if(!Ext.isEmpty(e)&&!Ext.isEmpty(e[0])&&!Ext.isEmpty(e[0].data)){this.setTprItem(e[0]);var g=e[0].data;this.down("#VSMCP_MonitorDesc").setValue(g.Explain);Ext.getStore("storeOptions2").removeAll();var f=0;var j=[];if(!Ext.isEmpty(g.PhraseList)){Ext.each(g.PhraseList,function(k){if(""!=k){j[f]=Ext.create("Options",{name:k,id:f});f=f+1}});if(j.length!=0){Ext.getStore("storeOptions2").setData(j)}this.down("#VSMCP_Monitorphraselist").setStore(Ext.getStore("storeOptions2"));$("#_monitorRemarkItem").show()}else{$("#_monitorRemarkItem").hide()}g=null;delete g;txt=null;delete txt;j=null;delete j;f=null;delete f}else{$("#_monitorRemarkItem").hide()}},scope:this});b=null;delete b;a=null;delete a}});Ext.define("NisTRApp.view.OPR_CareInfoPanel",{extend:Ext.Container,statics:{OpenCareAssessmentForm:function(a,b){if(Ext.isEmpty(a)){Ext.Msg.alert("OPR_CareInfoPanel 表單網址錯誤");return}try{var d=Ext.getCmp("_opdCareAssessmentFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_opdCareAssessmentFormPanel",centered:true,modal:true,url:a,height:NisTRApp.view.SysUtility.ClcHeight(90),width:NisTRApp.view.SysUtility.ClcWidth(95),divID:"OpdCareAssessmentFrameDIV"})}if(!Ext.isEmpty(d)){d.setCaller(b);d.setCloseFn(function(e){});b.overlay=Ext.Viewport.add(d);d.show()}d=null;delete d;a=null;delete a}catch(f){console.log(f)}}},config:{hiddenHeadBar:false,stopDistroyEvent:false,height:480,width:640,layout:{type:"vbox"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"OprCartInfoHeadBar",items:[{xtype:"label",html:"OPR_INFO",itemId:"OPRC_OprInfoLbl",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   手術日期.{OprmDate}  &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        Dr.{DrName} / {PatIdno} </span>","</td>","</tr>","</table>"]}]},{xtype:"formpanel",centered:false,height:"100%",itemId:"OprCareInfoFormPanel",width:"100%",items:[{xtype:"fieldset",itemId:"OPRC_PatFieldSet",title:"病人意願",items:[{xtype:"checkboxfield",html:"",itemId:"ContactYesCb",label:"願意接受電訪",name:"ContactYes"},{xtype:"checkboxfield",itemId:"ContactNoCb",label:"不方便聯絡",name:"ContactNo"},{xtype:"checkboxfield",itemId:"HppFlagCb",label:"立德病人",name:"HppFlag"},{xtype:"textfield",html:"",itemId:"ContactOtherTxt",label:'<div id="ContactOtherLabDiv">其他</div>',name:"ContactOther"}]},{xtype:"fieldset",itemId:"OPRC_ContactTelFieldSet",title:"聯絡電話",items:[{xtype:"textfield",itemId:"TelHomeTxt",label:"(宅)",name:"TelHome"},{xtype:"textfield",itemId:"TelMobileTxt",label:"(手機)",name:"TelMobile"},{xtype:"textfield",itemId:"TelOfficeTxt",label:"(公)",name:"TelOffice"}]},{xtype:"fieldset",itemId:"OPRC_ContactTimeFieldSet",title:"聯絡時段",items:[{xtype:"checkboxfield",itemId:"ContactTime1Cb",label:"10:00 - 11:00",name:"ContactTime1"},{xtype:"checkboxfield",itemId:"ContactTime2Cb",label:"14:00 - 15:00",name:"ContactTime2"},{xtype:"textfield",itemId:"ContactTimeOthersTxt",label:"其他",name:"ContactTimeOthers"}]},{xtype:"fieldset",itemId:"OPRC_ContactObjFieldSet",title:"連絡對象",items:[{xtype:"checkboxfield",itemId:"ContacterPatientCb",label:"病人本人",name:"ContacterPatient"},{xtype:"checkboxfield",itemId:"ContacterFamilyCb",label:"家屬",name:"ContacterFamily"},{xtype:"textfield",itemId:"ContacterFamilyRelationshipTxt",label:"家屬關係",name:"ContacterFamilyRelationship"},{xtype:"checkboxfield",itemId:"ContacterFriendCb",label:"朋友",name:"ContacterFriend"},{xtype:"textfield",hidden:true,itemId:"ContacterFriendNameTxt",label:"朋友姓名",name:"ContacterFriendName"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"OprCartInfoFotBar",items:[{xtype:"button",itemId:"OPRC_ADDMYPATIENT_Btn",text:"加入我的病人"},{xtype:"button",hidden:false,itemId:"OPRC_AddMyCarePatient",ui:"decline",width:"90px",iconCls:"add",text:"追蹤"},{xtype:"button",itemId:"OPRC_FinishMyCarePatient",ui:"confirm",width:"90px",iconCls:"favorites",text:"結案"},{xtype:"button",itemId:"OPRC_AddCareRecordBtn",ui:"confirm",width:"120px",iconCls:"add",text:"追蹤記錄"},{xtype:"button",centered:false,itemId:"OPRC_SaveMasterBtn",right:"95px",ui:"decline",width:"80px",text:"存 檔"},{xtype:"button",itemId:"OPRC_CloseMasterBtn",right:"5px",ui:"confirm",width:"80px",text:"關閉"}]}],listeners:[{fn:"onOPRC_ADDMYPATIENT_BtnTap",event:"tap",delegate:"#OPRC_ADDMYPATIENT_Btn"},{fn:"onOPRC_AddMyCarePatientTap",event:"tap",delegate:"#OPRC_AddMyCarePatient"},{fn:"onOPRC_FinishMyCarePatientTap",event:"tap",delegate:"#OPRC_FinishMyCarePatient"},{fn:"onOPRC_AddCareRecordBtnTap",event:"tap",delegate:"#OPRC_AddCareRecordBtn"},{fn:"onOPRC_SaveMasterBtnTap",event:"tap",delegate:"#OPRC_SaveMasterBtn"},{fn:"onOPRC_CloseMasterBtnTap",event:"tap",delegate:"#OPRC_CloseMasterBtn"},{fn:"onContainerHide",event:"hide"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"},{fn:"onContainerPainted",event:"painted"}]},onOPRC_ADDMYPATIENT_BtnTap:function(d,g,b){var a=this.getRecord();var f=this;f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/ModifyMyPatient.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprmstID:a.data.OprmstID,ChartNo:a.data.ChartNO,Flag:"ADD"},success:function(e){f.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h;f=null;delete f},failure:function(){f.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f}});a=null;delete a},onOPRC_AddMyCarePatientTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.OprmstID)){return}this.SaveContactData("Y")},onOPRC_FinishMyCarePatientTap:function(d,g,b){if(Ext.getStore("sOprContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.OprmstID)){return}var a=this.getRecord();var f=this;Ext.Msg.confirm("Confirm","是否確認追蹤結案? 病人:"+a.data.PatName,function(j,k,h){if(j=="no"){f=null;delete f;a=null;delete a;return}else{if(j=="yes"){var e={OprmstID:a.data.OprmstID,OprmDate:a.data.OprmDate,TelHome:f.down("#TelHomeTxt").getValue(),TelOffice:f.down("#TelOfficeTxt").getValue(),TelMobile:f.down("#TelMobileTxt").getValue(),ContactTime1:(f.down("#ContactTime1Cb").isChecked()?"10:00-11:00":""),ContactTime2:(f.down("#ContactTime2Cb").isChecked()?"14:00-15:00":""),ContactTimeOthers:f.down("#ContactTimeOthersTxt").getValue(),HppFlag:(f.down("#HppFlagCb").isChecked()?"Y":"N"),ContacterPatient:(f.down("#ContacterPatientCb").isChecked()?"Y":"N"),ContacterFamily:(f.down("#ContacterFamilyCb").isChecked()?"Y":"N"),ContacterFamilyRelationship:f.down("#ContacterFamilyRelationshipTxt").getValue(),ContacterFriend:(f.down("#ContacterFriendCb").isChecked()?"Y":"N"),ContacterFriendName:f.down("#ContacterFriendNameTxt").getValue(),ContactYes:(f.down("#ContactYesCb").isChecked()?"Y":"N"),ContactNo:(f.down("#ContactNoCb").isChecked()?"Y":"N"),ContactOther:f.down("#ContactOtherTxt").getValue(),CreUserID:"",CreUserName:"",CreDateTime:"",ModifyUserID:"",ModifyUserName:"",ModifyDateTime:""};f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OprCareFinished.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OprmstID:a.data.OprmstID,UserID:NisTRApp.view.SysUtility.GetUserID(),Json:btoa(encodeURIComponent(JSON.stringify(e)))},success:function(l){f.setMasked(false);var m=Ext.decode(l.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(m.Success){f.down("#OPRC_AddMyCarePatient").setHidden(true);f.down("#OPRC_FinishMyCarePatient").setHidden(true);f.down("#OPRC_AddCareRecordBtn").setHidden(true)}if(!Ext.isEmpty(f.getCaller())&&f.getCaller().xtype=="grid"){f.getCaller().getStore().load()}m=null;delete m;f=null;delete f;a=null;delete a},failure:function(){f.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f;a=null;delete a}})}}},this)},onOPRC_AddCareRecordBtnTap:function(h,k,g){if(Ext.getStore("sOprContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.OprmstID)){return}var b=this.getRecord();var f,j,d;if(b.data.Source.Type==1){f="0";j=b.data.Source.Name;d=(b.data.ChartSeq?b.data.ChartSeq:0)}else{if(b.data.Source.Type==2){f=b.data.InpNO;j=b.data.Source.Name;d=0}else{Ext.Msg.alert("NurCath 病人資料錯誤");return}}var a=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment","XYK3D63SYYIEPOJV2Y2ZXQQ4UU",NisTRApp.view.SysUtility.GetUserID(),b.data.ChartNo,d,"","","_ReloadCareAccessmentData","",f,j);NisTRApp.view.OPR_CareInfoPanel.OpenCareAssessmentForm(a,this);a=null;delete a;f=null;j=null;d=null;delete f;delete j;delete d;b=null;delete b},onOPRC_SaveMasterBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.OprmstID)){return}if(this.getRecord().data.Source.Type!=2){this.SaveContactData("Y")}else{Ext.Msg.confirm("Confirm","此為住院病人，是否追蹤存檔?",function(f,g,e){if(f=="no"){return}else{if(f=="yes"){this.SaveContactData("Y");return}}},this)}},onOPRC_CloseMasterBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onContainerHide:function(a,b){},onContainerDestroy:function(a){if(Ext.getStore("sOprContactData")!=null){Ext.getStore("sOprContactData").removeAll();Ext.getStore("sOprContactData").destroy()}if(Ext.getStore("sMedmedfTemp")!=null){Ext.getStore("sMedmedfTemp").removeAll();Ext.getStore("sMedmedfTemp").destroy()}_ReloadCareAccessmentData=null;delete _ReloadCareAccessmentData;console.log("on destroy :","Care Info Panel ");this.removeAll()},onContainerShow:function(b,d){if(Ext.getStore("sOprContactData").getCount()<=0){this.LoadContactData()}if(Ext.isEmpty($("#_oprDeCareItem")[0])){var e=$('<img src="../_/img/teach3.png" id="_oprDeCareItem" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:this,field:this.down("#ContactOtherTxt")},function(h){try{if(!Ext.isEmpty(Ext.getCmp("_inpOPRCloseReasonPanel"))){Ext.getCmp("_inpOPRCloseReasonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpOPRCloseReasonPanel"))){var f={top:(h.type=="touchstart"?h.originalEvent.touches[0].pageY:h.pageY),left:(h.type=="touchstart"?h.originalEvent.touches[0].pageX:h.pageX),};var g=Ext.create("NisTRApp.view.ReasonTempletePanel",{id:"_inpOPRCloseReasonPanel",height:320,width:320,top:f.top+25,left:f.left+35,caller:h.data.caller,field:h.data.field,store:Ext.getStore("sOprCloseReasonItem")});h.data.caller.overlay=Ext.Viewport.add(g);g=null;delete g;f=null;delete f}h.data.caller.overlay.show()}catch(h){console.log(h)}});e.appendTo($("#ContactOtherLabDiv"));e=null;delete e;a=null;delete a}},onContainerPainted:function(b,a){},initialize:function(){this.callParent();_ReloadCareAccessmentData=function(b){try{if(null!=b&&undefined!=b&&"TempSave"==b){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_opdCareAssessmentFormPanel"))){Ext.getCmp("_opdCareAssessmentFormPanel").destroy()}}}catch(d){console.error("_ReloadCareAccessmentData",d)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("OPR_CareInfoPanel 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.OprmstID)||(this.getRecord().data.OprmstID<=0)){Ext.Msg.alert("OPR_CareInfoPanel 病人資料錯誤");return false}if(Ext.data.ModelManager.getModel("Options")==null){Ext.define("Options",{extend:Ext.data.Model,config:{fields:[{name:"name",type:"string"},{name:"id",type:"int"}]}})}if(Ext.getStore("sOprCloseReasonItem")==null){Ext.create("Ext.data.Store",{storeId:"sOprCloseReasonItem",clearOnPageLoad:false,model:"Options",data:[{name:"病人願意",id:1},{name:"Remove port-A",id:2},{name:"膀胱鏡檢查",id:3},{name:"隔日住院或回診",id:4},{name:"病人不願意",id:5},{name:"當日化療住院",id:6}]})}var a=this.getRecord();this.down("#OPRC_OprInfoLbl").setRecord(a);this.down("#OPRC_AddMyCarePatient").setHidden(true);this.down("#OPRC_FinishMyCarePatient").setHidden(!(Ext.isEmpty(a.data.CareFlag)||a.data.CareFlag=="Y"||a.data.CareFlag=="N"));this.down("#OPRC_AddCareRecordBtn").setHidden(((!Ext.isEmpty(a.data.CareFlag)&&a.data.CareFlag!="Y"&&a.data.CareFlag!="N")?true:false));if(Ext.isEmpty(Ext.getStore("sOprContactData"))){Ext.create("Ext.data.Store",{storeId:"sOprContactData",autoLoad:false,model:"NisTRApp.model.OPR.ContactData",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprContactData.ashx",reader:{type:"jsonHtmlDecode"}}})}this.down("#OprCartInfoHeadBar").setHidden(this.getHiddenHeadBar());if(Ext.isEmpty(Ext.getStore("sMedmedf"))||Ext.getStore("sMedmedf").getCount()<=0){if(Ext.isEmpty(Ext.getStore("sMedmedfTemp"))){Ext.create("Ext.data.Store",{storeId:"sMedmedfTemp",autoLoad:false,model:"NisTRApp.model.Med.MedmedfEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryFullMedmedf.ashx",reader:{type:"json"}}})}}a=null;delete a},LoadContactData:function(){if(Ext.getStore("sOprContactData").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=function b(g,f){var h=Ext.getStore("sMedmedfTemp");h.getProxy().setExtraParams({ChartNo:f});h.load({callback:function(k,j,l){if(null!=k&&null!=k[0]){two=k[0];g.down("#TelHomeTxt").setValue(two.data.TelHome);g.down("#TelMobileTxt").setValue(two.data.TelMobile);g.down("#TelOfficeTxt").setValue(two.data.TelOffice);two=null;delete two}g=null;delete g},scope:g});h=null;delete h};var a=this.getRecord();var e=Ext.getStore("sOprContactData");e.getProxy().setExtraParams({ChartNO:a.data.ChartNo,OprmstID:a.data.OprmstID});this.down("#OprCareInfoFormPanel").reset();var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});e.load({callback:function(g,f,k){d.setMasked(false);if(null!=g&&null!=g[0]){d.down("#OprCareInfoFormPanel").setRecord(g[0]);var j=g[0].data;Ext.isEmpty(j.ContactTime1)?d.down("#ContactTime1Cb").uncheck():d.down("#ContactTime1Cb").check();Ext.isEmpty(j.ContactTime2)?d.down("#ContactTime2Cb").uncheck():d.down("#ContactTime2Cb").check();(Ext.isEmpty(j.HppFlag)||j.HppFlag=="N")?d.down("#HppFlagCb").uncheck():d.down("#HppFlagCb").check();(Ext.isEmpty(j.ContacterPatient)||j.ContacterPatient=="N")?d.down("#ContacterPatientCb").uncheck():d.down("#ContacterPatientCb").check();(Ext.isEmpty(j.ContacterFamily)||j.ContacterFamily=="N")?d.down("#ContacterFamilyCb").uncheck():d.down("#ContacterFamilyCb").check();(Ext.isEmpty(j.ContacterFriend)||j.ContacterFriend=="N")?d.down("#ContacterFriendCb").uncheck():d.down("#ContacterFriendCb").check();(Ext.isEmpty(j.ContactYes)||j.ContactYes=="N")?d.down("#ContactYesCb").uncheck():d.down("#ContactYesCb").check();(Ext.isEmpty(j.ContactNo)||j.ContactNo=="N")?d.down("#ContactNoCb").uncheck():d.down("#ContactNoCb").check()}if(Ext.isEmpty(d.down("#TelHomeTxt").getValue())&&Ext.isEmpty(d.down("#TelMobileTxt").getValue())&&Ext.isEmpty(d.down("#TelOfficeTxt").getValue())){if(!Ext.isEmpty(Ext.getStore("sMedmedf"))&&Ext.getStore("sMedmedf").getCount()>0){var h=Ext.getStore("sMedmedf").getAt(0);d.down("#TelHomeTxt").setValue(h.data.TelHome);d.down("#TelMobileTxt").setValue(h.data.TelMobile);d.down("#TelOfficeTxt").setValue(h.data.TelOffice)}else{b(d,a.data.ChartNo)}}b=null;delete b;d=null;delete d;a=null;delete a},scope:this});e=null;delete e},SaveContactData:function(b){if(Ext.getStore("sOprContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.OprmstID)){return}var a=this.getRecord();var d={OprmstID:a.data.OprmstID,OprmDate:a.data.OprmDate,TelHome:this.down("#TelHomeTxt").getValue(),TelOffice:this.down("#TelOfficeTxt").getValue(),TelMobile:this.down("#TelMobileTxt").getValue(),ContactTime1:(this.down("#ContactTime1Cb").isChecked()?"10:00-11:00":""),ContactTime2:(this.down("#ContactTime2Cb").isChecked()?"14:00-15:00":""),ContactTimeOthers:this.down("#ContactTimeOthersTxt").getValue(),HppFlag:(this.down("#HppFlagCb").isChecked()?"Y":"N"),ContacterPatient:(this.down("#ContacterPatientCb").isChecked()?"Y":"N"),ContacterFamily:(this.down("#ContacterFamilyCb").isChecked()?"Y":"N"),ContacterFamilyRelationship:this.down("#ContacterFamilyRelationshipTxt").getValue(),ContacterFriend:(this.down("#ContacterFriendCb").isChecked()?"Y":"N"),ContacterFriendName:this.down("#ContacterFriendNameTxt").getValue(),ContactYes:(this.down("#ContactYesCb").isChecked()?"Y":"N"),ContactNo:(this.down("#ContactNoCb").isChecked()?"Y":"N"),ContactOther:this.down("#ContactOtherTxt").getValue(),CreUserID:"",CreUserName:"",CreDateTime:"",ModifyUserID:"",ModifyUserName:"",ModifyDateTime:""};var e=this;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OprContactUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprmstID:a.data.OprmstID,CareFlag:(Ext.isEmpty(b)?"":b),Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(f){e.setMasked(false);var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(b=="Y"&&g.Success){e.down("#OPRC_AddMyCarePatient").setHidden(true);e.down("#OPRC_FinishMyCarePatient").setHidden(false);a.data.CareFlag="Y"}if(!Ext.isEmpty(e.getCaller())&&e.getCaller().xtype=="grid"){e.getCaller().getStore().load()}g=null;delete g;e=null;delete e;a=null;delete a},failure:function(){e.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);e=null;delete e;a=null;delete a}});d=null;delete d}});Ext.define("NisTRApp.view.PT_SettingPanel",{extend:Ext.Container,config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"PTS_MainPanel"}]},initialize:function(){this.callParent()}});Ext.define("NisTRApp.view.OPR_MPL_CareContainer",{extend:Ext.Container,config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"bottom",items:[{xtype:"datepickerfield",itemId:"OPR_MPL_CAREOprmDatePicker",width:"30%",label:"手術日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"OPR_MPL_RefreshBtn",right:"10px",ui:"decline",width:"50px",iconCls:"refresh",text:"MyButton87"}]},{xtype:"panel",itemId:"OPR_MPL_MainPanel"}],listeners:[{fn:"onOPR_MPL_CAREOprmDatePickerChange",event:"change",delegate:"#OPR_MPL_CAREOprmDatePicker"},{fn:"onOPR_MPL_RefreshBtnTap",event:"tap",delegate:"#OPR_MPL_RefreshBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onOPR_MPL_CAREOprmDatePickerChange:function(d,a,e,b){this.LoadMyPatientList(a)},onOPR_MPL_RefreshBtnTap:function(b,d,a){this.LoadMyPatientList(this.down("#OPR_MPL_CAREOprmDatePicker").getValue())},onContainerPainted:function(b,a){if(Ext.getStore("sOprMyPatients").getCount()<=0){this.LoadMyPatientList(this.down("#OPR_MPL_CAREOprmDatePicker").getValue())}},onContainerDestroy:function(a){if(Ext.getStore("sOprMyPatients")!=null){Ext.getStore("sOprMyPatients").removeAll();Ext.getStore("sOprMyPatients").destroy()}this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sOprMyPatients"))){Ext.create("Ext.data.Store",{storeId:"sOprMyPatients",clearOnPageLoad:false,model:"NisTRApp.model.OPR.OprmstvEntity",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprPatients.ashx",reader:{type:"json"}}})}var a=this;var d=Ext.getCmp("OPR_MyPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenOPRMyPatientGrid("OPR_MyPatGrid","術後追蹤病人清單",null,false);d.getTitleBar().hide();var b=Ext.getStore("sOprMyPatients");d.setStore(b);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapOPRGrid,d);this.down("#OPR_MPL_MainPanel").add(d);d=null;delete d}this.down("#OPR_MPL_CAREOprmDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadMyPatientList:function(b){if(Ext.getStore("sOprMyPatients").isLoading()){return}var a=Ext.getStore("sOprMyPatients");a.getProxy().setExtraParams({CareFlag:"Y",OprmDate:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a}});Ext.define("NisTRApp.view.OPR_MPL_FinishedCareContainer",{extend:Ext.Container,config:{height:"100%",width:"100%",items:[{xtype:"panel",height:"100%",itemId:"OPR_MPL_MainFinishedPanel",width:"100%",layout:{type:"fit"}},{xtype:"toolbar",docked:"bottom",items:[{xtype:"datepickerfield",itemId:"OPR_MPL_OprmDatePicker",width:"30%",label:"手術日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"OPR_MPL_RefreshFinishedBtn",right:"10px",ui:"decline",width:"60px",iconCls:"refresh"}]}],listeners:[{fn:"onOPR_MPL_OprmDatePickerChange",event:"change",delegate:"#OPR_MPL_OprmDatePicker"},{fn:"onOPR_MPL_RefreshFinishedBtnTap",event:"tap",delegate:"#OPR_MPL_RefreshFinishedBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onOPR_MPL_OprmDatePickerChange:function(d,a,e,b){this.LoadMyPatientList(a)},onOPR_MPL_RefreshFinishedBtnTap:function(b,d,a){this.LoadMyPatientList(this.down("#OPR_MPL_OprmDatePicker").getValue())},onContainerDestroy:function(a){if(Ext.getStore("sOprMyFinishedPatients")!=null){Ext.getStore("sOprMyFinishedPatients").removeAll();Ext.getStore("sOprMyFinishedPatients").destroy()}this.removeAll(true,true)},onContainerPainted:function(b,a){if(Ext.getStore("sOprMyFinishedPatients").getCount()<=0){this.LoadMyPatientList(this.down("#OPR_MPL_OprmDatePicker").getValue())}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sOprMyFinishedPatients"))){Ext.create("Ext.data.Store",{storeId:"sOprMyFinishedPatients",clearOnPageLoad:false,model:"NisTRApp.model.OPR.OprmstvEntity",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprPatients.ashx",reader:{type:"json"}}})}var a=this;var b=Ext.getCmp("OPR_MyFinishedPatGrid");if(b==null){b=NisTRApp.view.GridUtility.GenOPRMyPatientGrid("OPR_MyFinishedPatGrid","追蹤結案病人清單",null,true);b.getTitleBar().hide();var d=Ext.getStore("sOprMyFinishedPatients");b.setStore(d);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapOPRGrid,b);this.down("#OPR_MPL_MainFinishedPanel").add(b);b=null;delete b}this.down("#OPR_MPL_OprmDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadMyPatientList:function(a){if(Ext.getStore("sOprMyFinishedPatients").isLoading()){return}var b=Ext.getStore("sOprMyFinishedPatients");b.getProxy().setExtraParams({OprmDate:a,CareFlag:"Finished"});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.OPR_MPL_QueryPatientsContainer",{extend:Ext.Container,config:{height:"100%",width:"100%",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"searchfield",itemId:"OPR_MPL_PatIdField",width:"370px",label:"病人ID",maxLength:11,placeHolder:"請輸入病歷號或身分證號"},{xtype:"button",itemId:"OPR_MPL_PatQueryBtn",ui:"confirm",width:"100px",text:" 查 詢 "}]},{xtype:"panel",height:"100%",itemId:"OPR_MPL_QueryPatMainPanel",width:"100%"}],listeners:[{fn:"onOPR_MPL_PatQueryBtnTap",event:"tap",delegate:"#OPR_MPL_PatQueryBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onOPR_MPL_PatQueryBtnTap:function(b,d,a){if(Ext.isEmpty(this.down("#OPR_MPL_PatIdField").getValue())){NisTRApp.view.Misc.Alert("請輸入病人ID",800);if(Ext.getStore("sOprQueryPatients").isLoading()){return}Ext.getStore("sOprQueryPatients").removeAll();return}this.QueryOprPatients(this.down("#OPR_MPL_PatIdField").getValue())},onContainerPainted:function(b,a){this.down("#OPR_MPL_PatIdField").focus()},onContainerDestroy:function(a){if(Ext.getStore("sOprQueryPatients")!=null){Ext.getStore("sOprQueryPatients").removeAll();Ext.getStore("sOprQueryPatients").destroy()}this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sOprQueryPatients"))){Ext.create("Ext.data.Store",{storeId:"sOprQueryPatients",clearOnPageLoad:false,model:"NisTRApp.model.OPR.OprmstvEntity",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprPatients.ashx",reader:{type:"json"}}})}var b=this;var d=Ext.getCmp("OPR_QueryPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenOPRMyPatientGrid("OPR_QueryPatGrid","追蹤結案病人清單",null,true);d.getTitleBar().hide();var e=Ext.getStore("sOprQueryPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapOPRGrid,d);this.down("#OPR_MPL_QueryPatMainPanel").add(d);d=null;delete d}var a=this.down("#OPR_MPL_PatIdField");a.setValue("");a.addListener("keyup",function(f,h,g){if(h.event.keyCode==13){Ext.ComponentQuery.query("#OPR_MPL_PatQueryBtn")[0].fireEvent("tap")}},a);a=null;delete a;b=null;delete b},QueryOprPatients:function(a){if(Ext.getStore("sOprQueryPatients").isLoading()){return}var b=Ext.getStore("sOprQueryPatients");b.getProxy().setExtraParams({PatID:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.NHT_PatientSign",{extend:Ext.field.Text,alias:"widget.signaturefield",config:{sigWidth:350,sigHeight:150,label:"Field",component:{xtype:"field",type:"text",fastFocus:true}},initCanvas:function(){this.bMouseIsDown=false;oCanvas=this.actionOverlayCanvas.element.dom.firstChild;if(oCanvas){this.oCanvas=oCanvas;oCanvas.setAttribute("width",this.width);oCanvas.setAttribute("height",this.height);this.oCtx=oCanvas.getContext("2d");this.oCtx.fillStyle="#FFFFFF";this.oCtx.fillRect(0,0,this.width,this.height)}HTMLCanvasElement.prototype.relMouseCoords=this.relMouseCoords},openCanvasSheet:function(){this.actionOverlay.show()},relMouseCoords:function(h){var g=0;var f=0;var b=0;var a=0;var d=this;do{g+=d.offsetLeft;f+=d.offsetTop}while(d=d.offsetParent);b=h.pageX-g;a=h.pageY-f;return{x:b,y:a}},canvasTouchStart:function(a){this.bMouseIsDown=true;coords=this.actionOverlayCanvas.element.dom.firstChild.relMouseCoords(a);this.iLastX=coords.x;this.iLastY=coords.y},canvasTouchEnd:function(){this.bMouseIsDown=false;this.iLastX=-1;this.iLastY=-1},canvasTouchMove:function(b){if(this.bMouseIsDown){b.stopPropagation();coords=this.actionOverlayCanvas.element.dom.firstChild.relMouseCoords(b);var a=coords.x;var d=coords.y;this.oCtx.beginPath();this.oCtx.moveTo(this.iLastX,this.iLastY);this.oCtx.lineTo(a,d);this.oCtx.strokeStyle="rgba(0,0,0, 1)";this.oCtx.lineWidth=2;this.oCtx.stroke();this.oCtx.closePath();this.iLastX=a;this.iLastY=d}},saveCanvas:function(){var f=this.actionOverlayCanvas.element.dom.firstChild;var e=f.toDataURL();this.actionOverlay.hide();this.resetCanvas();this.setValue(e);var g=this;var d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAAFeCAYAAAAymnggAAAV";var b=[];$("input[name='SignCheck']").each(function(){var j=document.getElementById($(this).attr("id"));if(j.checked){b.push(j.value)}});if(b.length<=0){Ext.Msg.alert("請選擇簽署項目!");return}if((this.getValue()==null)||(this.getValue()=="")||(this.getValue().search(d)>-1)){NisTRApp.view.Misc.Alert("請簽名!",1000);return}var a=encodeURIComponent(this.getValue());if(b.length>0){var h=new Object();h.UserID=NisTRApp.view.SysUtility.GetUserID();h.PatientSignature=a;h.OpenRecordIDs=b;Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/PatientSignTech.ashx",useDefaultXhrHeader:false,scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),PatientSignature:a,OpenRecordIDs:b},success:function(j){Ext.Viewport.setMasked(false);if(!Ext.isEmpty(Ext.getStore("sHealthTeachRecord"))&&!Ext.getStore("sHealthTeachRecord").isLoading()){Ext.getStore("sHealthTeachRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInactiveHealthTeachRecord"))&&!Ext.getStore("sInactiveHealthTeachRecord").isLoading()){Ext.getStore("sInactiveHealthTeachRecord").load()}},failure:function(){g.setValue(null);Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert("簽署失敗!",0)}});h=null;delete h}a=null;delete a},setValue:function(a){this.getComponent().setHtml('<div style="display:none"><img src="'+a+'" width="'+this.width+'"  height="'+this.height+'" /></div>');this.fieldValue=a},getValue:function(){return this.fieldValue},resetCanvas:function(){canvas=this.actionOverlayCanvas.element.dom.firstChild;c=canvas.getContext("2d");c.clearRect(0,0,canvas.width,canvas.height);c.beginPath();if(null!=this.getParent()){this.getParent().show()}this.show()},JPEGEncoder:function(m){var o=this;var F=Math.round;var N=Math.floor;var h=new Array(64);var M=new Array(64);var T=new Array(64);var aa=new Array(64);var D;var j;var s;var W;var L=new Array(65535);var n=new Array(65535);var R=new Array(64);var U=new Array(64);var k=[];var E=0;var a=7;var G=new Array(64);var e=new Array(64);var X=new Array(64);var f=new Array(256);var H=new Array(2048);var C;var Q=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var g=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var b=[0,1,2,3,4,5,6,7,8,9,10,11];var B=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var v=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var ab=[0,1,2,3,4,5,6,7,8,9,10,11];var p=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var x=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function O(aj){var ai=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var ah=0;ah<64;ah++){var am=N((ai[ah]*aj+50)/100);if(am<1){am=1}else{if(am>255){am=255}}h[Q[ah]]=am}var ak=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var ag=0;ag<64;ag++){var al=N((ak[ag]*aj+50)/100);if(al<1){al=1}else{if(al>255){al=255}}M[Q[ag]]=al}var af=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var ae=0;for(var an=0;an<8;an++){for(var ad=0;ad<8;ad++){T[ae]=(1/(h[Q[ae]]*af[an]*af[ad]*8));aa[ae]=(1/(M[Q[ae]]*af[an]*af[ad]*8));ae++}}}function K(ah,ai){var ag=0;var aj=0;var af=new Array();for(var ad=1;ad<=16;ad++){for(var ae=1;ae<=ah[ad];ae++){af[ai[aj]]=[];af[ai[aj]][0]=ag;af[ai[aj]][1]=ad;aj++;ag++}ag*=2}return af}function Z(){D=K(g,b);j=K(A,ab);s=K(B,v);W=K(p,x)}function y(){var ae=1;var ag=2;for(var ad=1;ad<=15;ad++){for(var af=ae;af<ag;af++){n[32767+af]=ad;L[32767+af]=[];L[32767+af][1]=ad;L[32767+af][0]=af}for(var ah=-(ag-1);ah<=-ae;ah++){n[32767+ah]=ad;L[32767+ah]=[];L[32767+ah][1]=ad;L[32767+ah][0]=ag-1+ah}ae<<=1;ag<<=1}}function Y(){for(var ad=0;ad<256;ad++){H[ad]=19595*ad;H[(ad+256)>>0]=38470*ad;H[(ad+512)>>0]=7471*ad+32768;H[(ad+768)>>0]=-11059*ad;H[(ad+1024)>>0]=-21709*ad;H[(ad+1280)>>0]=32768*ad+8421375;H[(ad+1536)>>0]=-27439*ad;H[(ad+1792)>>0]=-5329*ad}}function ac(ae){var af=ae[0];var ad=ae[1]-1;while(ad>=0){if(af&(1<<ad)){E|=(1<<a)}ad--;a--;if(a<0){if(E==255){u(255);u(0)}else{u(E)}a=7;E=0}}}function u(ad){k.push(f[ad])}function J(ad){u((ad>>8)&255);u((ad)&255)}function P(a1,ay){var aP,aO,aN,aM,aL,aJ,aI,aG;var aS=0;var aU;const ax=8;const aq=64;for(aU=0;aU<ax;++aU){aP=a1[aS];aO=a1[aS+1];aN=a1[aS+2];aM=a1[aS+3];aL=a1[aS+4];aJ=a1[aS+5];aI=a1[aS+6];aG=a1[aS+7];var a2=aP+aG;var aR=aP-aG;var a0=aO+aI;var aT=aO-aI;var aZ=aN+aJ;var aV=aN-aJ;var aY=aM+aL;var aW=aM-aL;var av=a2+aY;var ar=a2-aY;var au=a0+aZ;var at=a0-aZ;a1[aS]=av+au;a1[aS+4]=av-au;var aD=(at+ar)*0.707106781;a1[aS+2]=ar+aD;a1[aS+6]=ar-aD;av=aW+aV;au=aV+aT;at=aT+aR;var az=(av-at)*0.382683433;var aC=0.5411961*av+az;var aA=1.306562965*at+az;var aB=au*0.707106781;var an=aR+aB;var am=aR-aB;a1[aS+5]=am+aC;a1[aS+3]=am-aC;a1[aS+1]=an+aA;a1[aS+7]=an-aA;aS+=8}aS=0;for(aU=0;aU<ax;++aU){aP=a1[aS];aO=a1[aS+8];aN=a1[aS+16];aM=a1[aS+24];aL=a1[aS+32];aJ=a1[aS+40];aI=a1[aS+48];aG=a1[aS+56];var ap=aP+aG;var aw=aP-aG;var ak=aO+aI;var aE=aO-aI;var ah=aN+aJ;var aH=aN-aJ;var ae=aM+aL;var aX=aM-aL;var ao=ap+ae;var ad=ap-ae;var aj=ak+ah;var ag=ak-ah;a1[aS]=ao+aj;a1[aS+32]=ao-aj;var al=(ag+ad)*0.707106781;a1[aS+16]=ad+al;a1[aS+48]=ad-al;ao=aX+aH;aj=aH+aE;ag=aE+aw;var aQ=(ao-ag)*0.382683433;var ai=0.5411961*ao+aQ;var a4=1.306562965*ag+aQ;var af=aj*0.707106781;var a3=aw+af;var aF=aw-af;a1[aS+40]=aF+ai;a1[aS+24]=aF-ai;a1[aS+8]=a3+a4;a1[aS+56]=a3-a4;aS++}var aK;for(aU=0;aU<aq;++aU){aK=a1[aU]*ay[aU];R[aU]=(aK>0)?((aK+0.5)|0):((aK-0.5)|0)}return R}function V(){J(65504);J(16);u(74);u(70);u(73);u(70);u(0);u(1);u(1);u(0);J(1);J(1);u(0);u(0)}function I(ae,ad){J(65472);J(17);u(8);J(ad);J(ae);u(3);u(1);u(17);u(0);u(2);u(17);u(1);u(3);u(17);u(1)}function w(){J(65499);J(132);u(0);for(var ae=0;ae<64;ae++){u(h[ae])}u(1);for(var ad=0;ad<64;ad++){u(M[ad])}}function r(){J(65476);J(418);u(0);for(var ah=0;ah<16;ah++){u(g[ah+1])}for(var ag=0;ag<=11;ag++){u(b[ag])}u(16);for(var af=0;af<16;af++){u(B[af+1])}for(var ae=0;ae<=161;ae++){u(v[ae])}u(1);for(var ad=0;ad<16;ad++){u(A[ad+1])}for(var ak=0;ak<=11;ak++){u(ab[ak])}u(17);for(var aj=0;aj<16;aj++){u(p[aj+1])}for(var ai=0;ai<=161;ai++){u(x[ai])}}function q(){J(65498);J(12);u(3);u(1);u(0);u(2);u(17);u(3);u(17);u(0);u(63);u(0)}function l(ah,ad,an,at,ar){var aj=ar[0];var af=ar[240];var ag;const au=16;const ak=63;const ai=64;var av=P(ah,ad);for(var ao=0;ao<ai;++ao){U[Q[ao]]=av[ao]}var aq=U[0]-an;an=U[0];if(aq==0){ac(at[0])}else{ag=32767+aq;ac(at[n[ag]]);ac(L[ag])}var ae=63;for(;(ae>0)&&(U[ae]==0);ae--){}if(ae==0){ac(aj);return an}var ap=1;var ax;while(ap<=ae){var am=ap;for(;(U[ap]==0)&&(ap<=ae);++ap){}var al=ap-am;if(al>=au){ax=al>>4;for(var aw=1;aw<=ax;++aw){ac(af)}al=al&15}ag=32767+U[ap];ac(ar[(al<<4)+n[ag]]);ac(L[ag]);ap++}if(ae!=ak){ac(aj)}return an}function z(){var ae=String.fromCharCode;for(var ad=0;ad<256;ad++){f[ad]=ae(ad)}}this.encode=function(ar,am){var ae=new Date().getTime();if(am){d(am)}k=new Array();E=0;a=7;J(65496);V();w();I(ar.width,ar.height);r();q();var an=0;var au=0;var aq=0;E=0;a=7;this.encode.displayName="_encode_";var az=ar.data;var aw=ar.width;var ap=ar.height;var av=aw*4;var ad=aw*3;var al,ak=0;var ao,ay,aA;var af,at,ah,aj,ai;while(ak<ap){al=0;while(al<av){af=av*ak+al;at=af;ah=-1;aj=0;for(ai=0;ai<64;ai++){aj=ai>>3;ah=(ai&7)*4;at=af+(aj*av)+ah;if(ak+aj>=ap){at-=(av*(ak+1+aj-ap))}if(al+ah>=av){at-=((al+ah)-av+4)}ao=az[at++];ay=az[at++];aA=az[at++];G[ai]=((H[ao]+H[(ay+256)>>0]+H[(aA+512)>>0])>>16)-128;e[ai]=((H[(ao+768)>>0]+H[(ay+1024)>>0]+H[(aA+1280)>>0])>>16)-128;X[ai]=((H[(ao+1280)>>0]+H[(ay+1536)>>0]+H[(aA+1792)>>0])>>16)-128}an=l(G,T,an,D,s);au=l(e,aa,au,j,W);aq=l(X,aa,aq,j,W);al+=32}ak+=8}if(a>=0){var ax=[];ax[1]=a+1;ax[0]=(1<<(a+1))-1;ac(ax)}J(65497);var ag="data:image/jpeg;base64,"+btoa(k.join(""));k=[];return ag};function d(ae){if(ae<=0){ae=1}if(ae>100){ae=100}if(C==ae){return}var ad=0;if(ae<50){ad=Math.floor(5000/ae)}else{ad=Math.floor(200-ae*2)}O(ad);C=ae}function S(){var ae=new Date().getTime();if(!m){m=50}z();Z();y();Y();d(m);var ad=new Date().getTime()-ae}S()},initialize:function(){this.callParent();this.width=this.getSigWidth();this.height=this.getSigHeight();Ext.define("ux.signature.Canvas",{extend:Ext.Component,xtype:"signaturefieldcanvas",template:[{reference:"canvas",tag:"canvas",classList:[Ext.baseCSSPrefix+"canvas"]}]});this.on("painted",this.initCanvas,this);this.element.on("tap",this.openCanvasSheet,this);this.actionOverlayCanvas=Ext.create("ux.signature.Canvas",{});this.resetButton=Ext.create("Ext.Button",{text:"清除",ui:"normal"});this.saveButton=Ext.create("Ext.Button",{text:"確定",ui:"confirm"});this.actionOverlay=Ext.create("Ext.Panel",{modal:true,hidden:true,hideOnMaskTap:true,showAnimation:{type:"popIn",duration:300,easing:"ease-out"},hideAnimation:{type:"popOut",duration:300,easing:"ease-out"},centered:true,items:[this.actionOverlayCanvas,{xtype:"toolbar",docked:"bottom",items:[{xtype:"spacer"},this.resetButton,this.saveButton,{xtype:"spacer"}]}]});Ext.Viewport.add(this.actionOverlay);this.actionOverlayCanvas.element.on("touchstart",this.canvasTouchStart,this);this.actionOverlayCanvas.element.on("touchend",this.canvasTouchEnd,this);this.actionOverlayCanvas.element.on("touchmove",this.canvasTouchMove,this);this.resetButton.element.on("tap",this.resetCanvas,this);this.saveButton.element.on("tap",this.saveCanvas,this);this.actionOverlayCanvas.setStyle("border:1px solid #000;height:"+this.height+"px;width:"+this.width+"px;margin-right:auto;margin-left:auto;margin-top:auto;margin-bottom:auto;");var a=HTMLCanvasElement.prototype.toDataURL;var b=new this.JPEGEncoder();HTMLCanvasElement.prototype.toDataURL=function(f){var e=a.apply(this,arguments);if(e.substr(0,6)=="data:,"){var d=b.encode(this.getContext("2d").getImageData(0,0,this.width,this.height),90);return d}else{return e}}}});Ext.define("NisTRApp.view.Nur.OPD_HealthTeach",{extend:Ext.Container,alias:"widget.NurOPD_Assessment",statics:{OpenHealthTeachForm:function(b){if(Ext.isEmpty(b)){Ext.Msg.alert("OPD_HealthTeach 表單網址錯誤");return}try{var d=Ext.getCmp("_opdHealthTeachFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_opdHealthTeachFormPanel",url:b,divID:"OpdHealthTeachFrameDIV"})}if(!Ext.isEmpty(d)){var a=Ext.ComponentQuery.query("#NHT_MainPanel")[0];d.setCaller(a);d.setCloseFn(function(e){e.setHidden(false)});Ext.ComponentQuery.query("#NHT_Main")[0].animateActiveItem(d,{type:"slide",direction:"right"});a.setHidden(true);d.show();a=null;delete a}d=null;delete d;patInfo=null;delete patInfo;b=null;delete b}catch(f){console.log(f)}},LoadActiveHealthTeachRecord:function(b,e,f,d){if(Ext.getStore("sHealthTeachRecord").isLoading()||Ext.isEmpty(b)){return}var g=b;var a=Ext.getStore("sHealthTeachRecord");a.getProxy().setExtraParams({FunctionType:"Teach",ChartNo:g.data.ChartNo,InpNo:"0",IncludeLastInpFlag:true,BegDate:e,EndDate:f,Discontinue:false,});a.load({callback:function(j,h,k){},scope:this});a=null;delete a;g=null;delete g},LoadInactiveHealthTeachRecord:function(a,d,f,b){if(Ext.getStore("sInactiveHealthTeachRecord").isLoading()||Ext.isEmpty(a)){return}var g=a;var e=Ext.getStore("sInactiveHealthTeachRecord");e.getProxy().setExtraParams({FunctionType:"Teach",ChartNo:g.data.ChartNo,InpNo:"0",LimitMonth:"3",IncludeLastInpFlag:true,BegDate:d,EndDate:f,Discontinue:true,});e.load({callback:function(j,h,k){},scope:this});e=null;delete e;g=null;delete g},ShowPatientHandwriting:function(f,e,b,a){var d=function d(h,k){var j=Ext.getCmp("_patientHandwritingPanel");if(!Ext.isEmpty(j)){j.destroy()}if(Ext.isEmpty(j)){j=Ext.create("Ext.Panel",{id:"_patientHandwritingPanel",html:"",centered:true,height:355,styleHtmlContent:true,width:770,hideOnMaskTap:true,modal:true,scrollable:"both"});j.addListener("show",function(m,l){},j);j.addListener("hide",function(m,l){this.destroy()},j);Ext.Viewport.add(j)}var g="<img src="+decodeURIComponent(k)+">";j.setHtml("");j.setHtml(g);j.show();g=null;delete g;j=null;delete j;k=null;delete k;h=null;delete h};Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD});Ext.Ajax.request({url:"../api/Form/PatientHandwriting.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{ChartNo:f,OpenRecordID:b,FormID:e},success:function(g){try{var j=Ext.decode(g.responseText);d(a,j.PatientSignature);d=null;delete d;j=null;delete j}catch(h){}Ext.Viewport.setMasked(false)},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert("病人簽名讀取錯誤!",0);d=null;delete d}})},LoadFormHistory:function(a,h,d,f,b){if(Ext.getStore("sNHTFormHistory").isLoading()||Ext.isEmpty(a)){return}var g=a;var e=Ext.getStore("sNHTFormHistory");e.removeAll();e.getProxy().setExtraParams({FunctionType:h,BegDate:d,EndDate:f,ChartNo:g.data.ChartNo,});e.load({callback:function(k,j,l){},scope:this});e=null;delete e;g=null;delete g}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NHT_Main",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NHT_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",height:"100%",itemId:"mypanel19",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",itemId:"NHT_NewHealthTeachList",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的衛教指導"}]},{xtype:"tabpanel",height:"100%",width:"80%",items:[{xtype:"container",title:"Active",itemId:"NTH_OPD_ActiveGridPanel",items:[{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",itemId:"NHTOA_FnBtn",margin:"0 0 0 20",width:"30%",items:[{xtype:"button",itemId:"NHTOA_OpdBtn",width:"50%",text:" 門 診 "},{xtype:"button",itemId:"NHTOA_InpBtn",width:"50%",text:" 住 院"}]},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NHTOA_ActBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NHTOA_ActEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NHTOA_ActRefresh",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}],listeners:[{fn:function(b,a){Ext.ComponentQuery.query("#NHT_PatientSignBar")[0].show()},event:"painted"}]},{xtype:"container",title:"Inactive",itemId:"NTH_OPD_InactiveGridPanel",listeners:[{fn:function(b,a){Ext.ComponentQuery.query("#NHT_PatientSignBar")[0].show();if(Ext.getStore("sInactiveHealthTeachRecord").getCount()<=0){NisTRApp.view.Nur.OPD_HealthTeach.LoadInactiveHealthTeachRecord(this.getRecord(),this.down("#NHTOIA_ActBegDate").getValue(),this.down("#NHTOIA_ActEndDate").getValue(),this)}},event:"painted"}],items:[{xtype:"toolbar",docked:"top",items:[{xtype:"segmentedbutton",itemId:"NHTOIA_FnBtn",margin:"0 0 0 20",width:"30%",items:[{xtype:"button",itemId:"NHTOIA_OpdBtn",width:"50%",text:" 門 診 "},{xtype:"button",itemId:"NHTOIA_InpBtn",width:"50%",text:" 住 院"}]},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NHTOIA_ActBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NHTOIA_ActEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NHTOIA_ActRefresh",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}]},{xtype:"container",title:"衛教歷程",height:"100%",itemId:"NHT_OPD_History",width:"100%",listeners:[{fn:function(b,a){Ext.ComponentQuery.query("#NHT_PatientSignBar")[0].hide();if(Ext.getStore("sNHTFormHistory").getCount()<=0){NisTRApp.view.Nur.OPD_HealthTeach.LoadFormHistory(this.getRecord(),"Teach",this.down("#NHTOA_HistoryBegDate").getValue(),this.down("#NHTOA_HistoryEndDate").getValue(),this)}},event:"painted"}],items:[{xtype:"toolbar",docked:"top",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NHTOA_HistoryBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NHTOA_HistoryEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NHTOA_HistoryRefresg",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]},{xtype:"list",height:"100%",itemId:"NHT_OPD_HistoryList",width:"100%",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'<span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span>',"</div>","<br>",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[NisTRApp.view.DateUtil.FormDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>',"<br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Html} </pre></span>',"</div>",""],plugins:[{type:"pullrefresh"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"NHT_PatientSignBar",items:[{xtype:"signaturefield",sigWidth:768,sigHeight:350,centered:false,docked:"bottom",maxHeight:"2.7em",width:"99%",label:"<div>簽 名 ( 請 點 我 )</div>",labelWidth:"99%"}]}]}]}]}],listeners:[{fn:"onNHT_NewHealthTeachListLeafItemTap",event:"leafitemtap",delegate:"#NHT_NewHealthTeachList"},{fn:"onNHTOA_OpdBtnTap",event:"tap",delegate:"#NHTOA_OpdBtn"},{fn:"onNHTOA_InpBtnTap",event:"tap",delegate:"#NHTOA_InpBtn"},{fn:"onNHTOA_ActRefreshTap",event:"tap",delegate:"#NHTOA_ActRefresh"},{fn:"onNTH_OPD_ActiveGridPanelUpdatedata",event:"updatedata",delegate:"#NTH_OPD_ActiveGridPanel"},{fn:"onNHTOIA_OpdBtnTap",event:"tap",delegate:"#NHTOIA_OpdBtn"},{fn:"onNHTOIA_InpBtnTap",event:"tap",delegate:"#NHTOIA_InpBtn"},{fn:"onNHTOIA_ActRefreshTap",event:"tap",delegate:"#NHTOIA_ActRefresh"},{fn:"onNHTOA_HistoryRefresgTap",event:"tap",delegate:"#NHTOA_HistoryRefresg"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onNHT_NewHealthTeachListLeafItemTap:function(b,l,h,j,g,k,m){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var o=this.getRecord();var f,a,d;if(o.data.Source.Type==1){f="0";a=o.data.Source.Name;d=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){f=o.data.InpNO;a=o.data.Source.Name;d=0}else{Ext.Msg.alert("NurCath 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.HealthTeachAddr("RenderTeach",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,d,"","","_ReloadHealthTeachData","new",f,a);NisTRApp.view.Nur.OPD_HealthTeach.OpenHealthTeachForm(n);n=null;delete n;f=null;a=null;d=null;delete f;delete a;delete d},onNHTOA_OpdBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");Ext.getCmp("NHTGRID_ACTIVE_SATRT_DATE").show();Ext.getCmp("NHTGRID_ACTIVE_REG_DATE").hide();var a=Ext.getStore("sHealthTeachRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(String.IsNull(e.data.InpNo)||"0"==e.data.InpNo){return true}else{return false}},this)}a=null;delete a},onNHTOA_InpBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");Ext.getCmp("NHTGRID_ACTIVE_SATRT_DATE").show();Ext.getCmp("NHTGRID_ACTIVE_REG_DATE").hide();var a=Ext.getStore("sHealthTeachRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(!String.IsNull(e.data.InpNo)&&"0"!=e.data.InpNo){return true}else{return false}},this)}a=null;delete a},onNHTOA_ActRefreshTap:function(b,d,a){NisTRApp.view.Nur.OPD_HealthTeach.LoadActiveHealthTeachRecord(this.getRecord(),this.down("#NHTOA_ActBegDate").getValue(),this.down("#NHTOA_ActEndDate").getValue(),this)},onNTH_OPD_ActiveGridPanelUpdatedata:function(a,d,b){NisTRApp.view.Nur.OPD_HealthTeach.LoadActiveHealthTeachRecord(this.getRecord(),this.down("#NHTOA_ActBegDate").getValue(),this.down("#NHTOA_ActEndDate").getValue(),this)},onNHTOIA_OpdBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");Ext.getCmp("NHTGRID_INACTIVE_SATRT_DATE").show();Ext.getCmp("NHTGRID_INACTIVE_REG_DATE").hide();var a=Ext.getStore("sInactiveHealthTeachRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(String.IsNull(e.data.InpNo)||"0"==e.data.InpNo){return true}else{return false}},this)}a=null;delete a},onNHTOIA_InpBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(d.getParent(),d,"confirm","normal","","");Ext.getCmp("NHTGRID_INACTIVE_SATRT_DATE").show();Ext.getCmp("NHTGRID_INACTIVE_REG_DATE").hide();var a=Ext.getStore("sInactiveHealthTeachRecord");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){if(!String.IsNull(e.data.InpNo)&&"0"!=e.data.InpNo){return true}else{return false}},this)}a=null;delete a},onNHTOIA_ActRefreshTap:function(b,d,a){NisTRApp.view.Nur.OPD_HealthTeach.LoadInactiveHealthTeachRecord(this.getRecord(),this.down("#NHTOIA_ActBegDate").getValue(),this.down("#NHTOIA_ActEndDate").getValue(),this)},onNHTOA_HistoryRefresgTap:function(b,d,a){NisTRApp.view.Nur.OPD_HealthTeach.LoadFormHistory(this.getRecord(),"Teach",this.down("#NHTOA_HistoryBegDate").getValue(),this.down("#NHTOA_HistoryEndDate").getValue(),this)},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sHealthTeachRecord"))){Ext.getStore("sHealthTeachRecord").removeAll();Ext.getStore("sHealthTeachRecord").destroy()}if(!Ext.isEmpty(Ext.getStore("sInactiveHealthTeachRecord"))){Ext.getStore("sInactiveHealthTeachRecord").removeAll();Ext.getStore("sInactiveHealthTeachRecord").destroy()}if(!Ext.isEmpty(Ext.getStore("sNHTFormHistory"))){Ext.getStore("sNHTFormHistory").removeAll();Ext.getStore("sNHTFormHistory").destroy()}if(!Ext.isEmpty(Ext.getCmp("_opdHealthTeachFormPanel"))){Ext.getCmp("_opdHealthTeachFormPanel").destroy()}_ReloadHealthTeachData=null;delete _ReloadHealthTeachData;this.removeAll(true,true)},onContainerShow:function(a,b){this.down("#NHT_PatientSignBar").setHidden(true);this.down("#NHT_PatientSignBar").setHidden(false);this.down("#NHT_PatientSignBar").show()},initialize:function(){this.callParent();_ReloadHealthTeachData=function(){try{if(!Ext.isEmpty(Ext.getStore("sHealthTeachRecord"))){Ext.getStore("sHealthTeachRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInactiveHealthTeachRecord"))){Ext.getStore("sInactiveHealthTeachRecord").load()}if(!Ext.isEmpty(Ext.getCmp("_opdHealthTeachFormPanel"))){Ext.getCmp("_opdHealthTeachFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NHT_MainPanel")[0])){Ext.ComponentQuery.query("#NHT_MainPanel")[0].show()}}catch(f){console.error("_ReloadHealthTeachData",f)}};this.DateInitial();this.down("#NHT_PatientSignBar").setHidden(true);this.down("#NHT_PatientSignBar").setHidden(false);this.down("#NHT_PatientSignBar").show();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("OPD_HealthTeach 病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("OPD_HealthTeach 門診病人資料錯誤");return false}if(this.getRecord().data.Source.Type==2){Ext.Msg.alert("OPD_HealthTeach 不支援住院病人");return false}if(Ext.isEmpty(Ext.getStore("sNewHealthTeachRecord"))){Ext.create("Ext.data.TreeStore",{storeId:"sNewHealthTeachRecord",autoLoad:true,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Teach"},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NHT_NewHealthTeachList").setStore(Ext.getStore("sNewHealthTeachRecord"));if(Ext.isEmpty(Ext.getStore("sHealthTeachRecord"))){Ext.create("Ext.data.Store",{storeId:"sHealthTeachRecord",autoLoad:false,model:"NisTRApp.model.Form.OpenRecord",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/OpenRecordV2.ashx",reader:{type:"json"}}})}var d=Ext.getCmp("OpdHealthTeachGrid");if(Ext.isEmpty(d)){d=this.GenHealthTeachGrid("OpdHealthTeachGrid","","",true);d.getTitleBar().hide();var a=Ext.getStore("sHealthTeachRecord");d.setStore(a);d.addListener("itemtap",this.ItemSingleTapHealthTeachGrid,d);this.down("#NTH_OPD_ActiveGridPanel").add(d);a=null;delete a}d=null;delete d;this.down("#NTH_OPD_ActiveGridPanel").setRecord(this.getRecord());this.down("#NHTOA_OpdBtn").fireEvent("tap",this.down("#NHTOA_OpdBtn"),null,null);if(Ext.isEmpty(Ext.getStore("sInactiveHealthTeachRecord"))){Ext.create("Ext.data.Store",{storeId:"sInactiveHealthTeachRecord",autoLoad:false,model:"NisTRApp.model.Form.OpenRecord",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/OpenRecordV2.ashx",reader:{type:"json"}}})}var d=Ext.getCmp("OpdInactiveHealthTeachGrid");if(Ext.isEmpty(d)){d=this.GenHealthTeachGrid("OpdInactiveHealthTeachGrid","","",false);d.getTitleBar().hide();var b=Ext.getStore("sInactiveHealthTeachRecord");d.setStore(b);d.addListener("itemtap",this.ItemSingleTapHealthTeachGrid,d);this.down("#NTH_OPD_InactiveGridPanel").add(d);b=null;delete b}d=null;delete d;this.down("#NTH_OPD_InactiveGridPanel").setRecord(this.getRecord());this.down("#NHTOIA_OpdBtn").fireEvent("tap",this.down("#NHTOIA_OpdBtn"),null,null);if(Ext.isEmpty(Ext.getStore("sNHTFormHistory"))){Ext.create("Ext.data.Store",{storeId:"sNHTFormHistory",autoLoad:false,model:"NisTRApp.model.EMR.UnsignForm",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/FormHistoryV2.ashx",reader:{type:"json"}}})}this.down("#NHT_OPD_History").setRecord(this.getRecord());this.down("#NHT_OPD_HistoryList").setStore(Ext.getStore("sNHTFormHistory"))},GenHealthTeachGrid:function(a,b,d,e){if(e==true){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing"},{type:"pullrefresh"}],columns:[{text:"衛教項目",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:250,tpl:'<span style="color:{StyleColor}; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:true},{text:"副標題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:150,tpl:'<span style="color:blue; font-size: 10px">{SubTitle}</span>',flex:1,dataIndex:"SubTitle",editable:false,sortable:true},{id:"NHTGRID_ACTIVE_SATRT_DATE",text:"開始日期",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.StartDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true},{id:"NHTGRID_ACTIVE_REG_DATE",text:"掛號日期 / 序",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RegDate)]} ({ChartSeq})</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[this.status(values.Discontinue, values.PlanLatestDate)]}</span>',{status:function(g,f){if(g==true){return"結案"}else{if(f.substring(0,10)!="1753-01-01"){return"待評值"}else{if(f.substring(0,10)=="1753-01-01"){return"未開始"}}}}}),flex:1,width:80,dataIndex:"Finished",editable:false,sortable:false},{text:"最後追蹤日",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.PlanLatestDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"PlanLatestDate",editable:false,sortable:true},{text:"瀏覽",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="NHTEDIT_PRVIEW_{KeyOne}" class="btn link-btn" style="font-size: 14px">評估單張</a>',flex:1,width:80,editable:false,sortable:false},{text:"病人簽名",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.signStatusStr(values.KeyOne, values.OpenRecordID, values.FormID, values.SignatureDate)]}",{signStatusStr:function(f,g,k,l){var h="NHTSIGN_"+f;var j='<INPUT id=ACTIVE_"'+h+'" value="'+g+'" name="SignCheck" TYPE="CHECKBOX" class="boolcheckbox">';if(l.substring(0,10)=="1753-01-01"||l.substring(0,10)=="0001-01-01"){}else{j='<a id="'+h+'" class="btn link-btn" style="font-size: 14px">'+NisTRApp.view.DateUtil.FormDateFormat(l)+"</a>"}return j}}),flex:1,width:140,editable:false,sortable:false}]})}else{return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing",type:"pullrefresh"}],columns:[{text:"衛教項目",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:250,tpl:'<span style="color:{StyleColor}; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:true},{text:"副標題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:150,tpl:'<span style="color:blue; font-size: 10px">{SubTitle}</span>',flex:1,dataIndex:"SubTitle",editable:false,sortable:true},{id:"NHTGRID_INACTIVE_SATRT_DATE",text:"開始日期",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.StartDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true},{id:"NHTGRID_INACTIVE_REG_DATE",text:"掛號日期 / 序",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RegDate)]} ({ChartSeq})</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true},{text:"狀態",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<span style="color:{StyleColor}; font-size: 14px">{[this.status(values.Discontinue, values.PlanLatestDate)]}</span>',{status:function(g,f){if(g==true){return"結案"}else{if(f.substring(0,10)!="1753-01-01"){return"待評值"}else{if(f.substring(0,10)=="1753-01-01"){return"未開始"}}}}}),flex:1,width:80,dataIndex:"Finished",editable:false,sortable:false},{text:"最後追蹤日",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.PlanLatestDate)]}</span>',align:"center",cls:"gridMediumFont",width:140,xtype:"templatecolumn",dataIndex:"PlanLatestDate",editable:false,sortable:true},{text:"停用人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:blue; font-size: 14px">{DiscontinueUserName}</span>',flex:1,width:80,dataIndex:"DiscontinueUserID",editable:false,sortable:true},{text:"瀏覽",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="NHTIEDIT_INPREVIEW_{KeyOne}" class="btn link-btn" style="font-size: 14px">評估單張</a>',flex:1,width:80,editable:false,sortable:false},{text:"病人簽名",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate","{[this.signStatusStr(values.KeyOne, values.OpenRecordID, values.FormID, values.SignatureDate)]}",{signStatusStr:function(f,g,k,l){var h="NHTISIGN_"+f;var j='<INPUT id=INACTIVE_"'+h+'" value="'+g+'" name="SignCheck" TYPE="CHECKBOX" class="boolcheckbox">';if(l.substring(0,10)=="1753-01-01"||l.substring(0,10)=="0001-01-01"){}else{j='<a id="'+h+'" class="btn link-btn" style="font-size: 14px">'+NisTRApp.view.DateUtil.FormDateFormat(l)+"</a>"}return j}}),flex:1,width:140,editable:false,sortable:false},{text:"取消結案",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="NHTIROLLBACK_{KeyOne}" class="btn link-btn" style="font-size: 14px">取消結案</a>',flex:1,width:80,editable:false,sortable:false}]})}},ItemSingleTapHealthTeachGrid:function(k,f,g,b,h,j){var d=function d(n){if(Ext.isEmpty(n)){return}var e=NisTRApp.view.FormUtil.HealthTeachAddr("RenderTeach",n.data.FormID,NisTRApp.view.SysUtility.GetUserID(),n.data.ChartNo,(n.data.ChartSeq?n.data.ChartSeq:0),n.data.CategoryID,n.data.OpenRecordID,"_ReloadHealthTeachData","",n.data.InpNo,(n.data.InpNo=="0"?"OPD":"INP"));NisTRApp.view.Nur.OPD_HealthTeach.OpenHealthTeachForm(e);e=null;delete e};var l=function l(n,e){Ext.Msg.confirm("Confirm","確定要取消結案?",function(p,q,o){if(p=="no"){return}else{if(p=="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/RecoverDistinueRecord.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{OpenRecordID:n,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(r){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800);if(!Ext.isEmpty(Ext.getStore("sHealthTeachRecord"))){Ext.getStore("sHealthTeachRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInactiveHealthTeachRecord"))){Ext.getStore("sInactiveHealthTeachRecord").load()}},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0)}})}}},this)};if(h.event.target.nodeName=="A"){var m=h.event.target.id.split("_");var a=b.data;if("NHTEDIT"==m[0]||"NHTIEDIT"==m[0]){d(b)}else{if("NHTSIGN"==m[0]||"NHTISIGN"==m[0]){NisTRApp.view.Nur.OPD_HealthTeach.ShowPatientHandwriting(a.ChartNo,a.FormID,a.OpenRecordID,k)}else{if("NHTIROLLBACK"==m[0]){l(a.OpenRecordID,k)}}}m=null;delete m;a=null;delete a;h.preventDefault()}d=null;delete d;l=null;delete l;return false},DateInitial:function(){this.down("#NHTOA_ActBegDate").setValue(NisTRApp.view.DateUtil.AppFirstYear());this.down("#NHTOA_ActEndDate").setValue(new Date());this.down("#NHTOIA_ActBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.down("#NHTOIA_ActEndDate").setValue(new Date());this.down("#NHTOA_HistoryBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.down("#NHTOA_HistoryEndDate").setValue(new Date())}});Ext.define("NisTRApp.view.Nur.OPD_Notes",{extend:Ext.Container,alias:"widget.NurOPD_Notes",statics:{LoadNursingNotesList:function(a,d,f,b){if(Ext.getStore("sNursingNotes").isLoading()||Ext.isEmpty(a)){return}var g=a;var e=Ext.getStore("sNursingNotes");e.removeAll();e.getProxy().setExtraParams({BegDate:d,EndDate:f,ChartNo:g.data.ChartNo});e.load({callback:function(j,h,k){},scope:this});e=null;delete e;g=null;delete g},LoadNursingNotesListInp:function(a,b){if(Ext.getStore("sNursingNotesInp").isLoading()||Ext.isEmpty(a)){return}var e=a;var d=Ext.getStore("sNursingNotesInp");d.removeAll();d.getProxy().setExtraParams({ChartNo:e.data.ChartNo});d.load({callback:function(g,f,h){},scope:this});d=null;delete d;e=null;delete e},LoadNotesTempRecord:function(a,d,b){if(Ext.getStore("sNotesTempRecord").isLoading()||Ext.isEmpty(a)||Ext.isEmpty(d)){return}var f=a;var e=Ext.getStore("sNotesTempRecord");e.removeAll();e.getProxy().setExtraParams({ChartNo:f.data.ChartNo,UserID:d});e.load({callback:function(h,g,j){},scope:this});e=null;delete e;f=null;delete f},LoadHealthProblemRecord:function(a,b){if(Ext.getStore("sHealthProblemRecord").isLoading()||Ext.isEmpty(a)){return}var e=a;var d=Ext.getStore("sHealthProblemRecord");d.removeAll();d.getProxy().setExtraParams({ChartNo:e.data.ChartNo,FunctionType:"Problem",InpNo:"0",LimitMonth:"3",IncludeLastInpFlag:true,Discontinue:false});d.load({callback:function(g,f,h){},scope:this});d=null;delete d;e=null;delete e}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NN_MAIN",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NN_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",height:"100%",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",height:"100%",itemId:"NNOTE_NewNotesList",width:"100%",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的護理記錄"}]},{xtype:"tabpanel",height:"100%",width:"100%",items:[{xtype:"container",title:"健康問題(住)",itemId:"NNOTE_HealthProblemPanel",layout:{type:"fit"},listeners:[{fn:function(b,a){if(Ext.getStore("sHealthProblemRecord").getCount()<=0){NisTRApp.view.Nur.OPD_Notes.LoadHealthProblemRecord(this.getRecord(),this)}},event:"painted"}]},{xtype:"container",title:"記錄歷程(門)",height:"100%",itemId:"NNOTE_OPDNursingNotePanel",width:"100%",layout:{type:"fit"},items:[{xtype:"list",height:"100%",itemId:"NNOTE_MainNursingNotesList",width:"100%",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'    <span class="posted" style="color:black;font-weight:bold;"> 【{Title}】</span> <span>日期 : {MedicalDateFormat}&nbsp;{MedicalTimeFormat} 人員:{UserName} </span>',"</div>","<br>",'<div style="font-size:medium;"> ','    <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{HtmlEncodeContent}</pre></span>',"    ","</div>","",""],plugins:[{type:"pullrefresh"}]},{xtype:"toolbar",docked:"top",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NNOTE_HistoryBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NNOTE_HistoryEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NNOTE_HistoryRefresg",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sNursingNotes").getCount()<=0){NisTRApp.view.Nur.OPD_Notes.LoadNursingNotesList(this.getRecord(),this.down("#NNOTE_HistoryBegDate").getValue(),this.down("#NNOTE_HistoryEndDate").getValue(),this)}},event:"painted"}]},{xtype:"container",title:"記錄歷程(住)",height:"100%",itemId:"NNOTE_INPNursingNotePanel",width:"100%",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOTE_MainNursingNotesListInp",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'    <span class="posted" style="color:black;font-weight:bold;"> 【{Title}】</span> <span>日期 : {MedicalDateFormat}&nbsp;{MedicalTimeFormat} 人員:{UserName} </span>',"</div>","",'<tpl if= "ValueMemo != &quot;&quot;"> ',"	<br>","    <div>",'    	<span >評值 : <span style="color:green;font-weight:bold;" > {ValueMemo} </span></span>',"    </div>    ","</tpl>","","<br>",'<div style="font-size:medium;"> ','    <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{HtmlEncodeContent}</pre></span>',"    ","</div>",""],plugins:[{type:"pullrefresh"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sNursingNotesInp").getCount()<=0){NisTRApp.view.Nur.OPD_Notes.LoadNursingNotesListInp(this.getRecord(),this)}},event:"painted"}]},{xtype:"container",title:"Note 暫存記錄",itemId:"NNOTE_TempNotePanel",listeners:[{fn:function(b,a){if(Ext.getStore("sNotesTempRecord").getCount()<=0){NisTRApp.view.Nur.OPD_Notes.LoadNotesTempRecord(this.getRecord(),NisTRApp.view.SysUtility.GetUserID(),this)}},event:"painted"}]}]}]}]}],listeners:[{fn:"onNNOTE_NewNotesListLeafItemTap",event:"leafitemtap",delegate:"#NNOTE_NewNotesList"},{fn:"onNNOTE_HistoryRefresgTap",event:"tap",delegate:"#NNOTE_HistoryRefresg"},{fn:"onContainerDestroy",event:"destroy"}]},onNNOTE_NewNotesListLeafItemTap:function(a,h,d,f,b,g,j){var k=this;try{if(!Ext.isEmpty(Ext.getCmp("_opdNotesEditPanel"))){Ext.getCmp("_opdNotesEditPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opdNotesEditPanel"))){var l=Ext.create("NisTRApp.view.Nur.OPD_NotesEditPanel",{id:"_opdNotesEditPanel",centered:true,modal:true,formRecord:b,record:k.getRecord(),successFn:_noteSaveSuccessFn,height:NisTRApp.view.SysUtility.ClcHeight(85),width:NisTRApp.view.SysUtility.ClcWidth(90)});k.overlay=Ext.Viewport.add(l);l=null;delete l}k.overlay.show();k=null;delete k}catch(g){console.log(g)}return},onNNOTE_HistoryRefresgTap:function(b,d,a){NisTRApp.view.Nur.OPD_Notes.LoadNursingNotesList(this.getRecord(),this.down("#NNOTE_HistoryBegDate").getValue(),this.down("#NNOTE_HistoryEndDate").getValue(),this)},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sNursingNotes"))){Ext.getStore("sNursingNotes").removeAll();Ext.getStore("sNursingNotes").destroy()}if(!Ext.isEmpty(Ext.getStore("sNursingNotesInp"))){Ext.getStore("sNursingNotesInp").removeAll();Ext.getStore("sNursingNotesInp").destroy()}if(!Ext.isEmpty(Ext.getStore("sNotesTempRecord"))){Ext.getStore("sNotesTempRecord").removeAll();Ext.getStore("sNotesTempRecord").destroy()}if(!Ext.isEmpty(Ext.getStore("sHealthProblemRecord"))){Ext.getStore("sHealthProblemRecord").removeAll();Ext.getStore("sHealthProblemRecord").destroy()}_noteSaveSuccessFn=null;delete _noteSaveSuccessFn;this.removeAll(true,true)},initialize:function(){this.callParent();_noteSaveSuccessFn=function(e){if(e&&!Ext.isEmpty(Ext.getStore("sNursingNotes"))){Ext.getStore("sNursingNotes").load()}if(!Ext.isEmpty(Ext.getStore("sNotesTempRecord"))&&Ext.getStore("sNotesTempRecord").getCount()>0){Ext.getStore("sNotesTempRecord").load()}};this.DateInitial();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("OPD_Notes 病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("OPD_Notes 門診病人資料錯誤");return false}if(this.getRecord().data.Source.Type==2){Ext.Msg.alert("OPD_Notes 不支援住院病人");return false}if(Ext.isEmpty(Ext.getStore("sNotetList"))){Ext.create("Ext.data.TreeStore",{storeId:"sNotetList",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Notes"},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NNOTE_NewNotesList").setStore(Ext.getStore("sNotetList"));if(Ext.getStore("sNotetList").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sNursingNotes"))){Ext.create("Ext.data.Store",{storeId:"sNursingNotes",autoLoad:false,model:"NisTRApp.model.Form.NursingNotes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/NursingNotesListV2.ashx",reader:{type:"json"}}})}this.down("#NNOTE_OPDNursingNotePanel").setRecord(this.getRecord());this.down("#NNOTE_MainNursingNotesList").setStore(Ext.getStore("sNursingNotes"));if(Ext.isEmpty(Ext.getStore("sNursingNotesInp"))){Ext.create("Ext.data.Store",{storeId:"sNursingNotesInp",autoLoad:false,model:"NisTRApp.model.Form.NursingNotes",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/NursingNotesListInp.ashx",reader:{type:"json"}}})}this.down("#NNOTE_INPNursingNotePanel").setRecord(this.getRecord());this.down("#NNOTE_MainNursingNotesListInp").setStore(Ext.getStore("sNursingNotesInp"));if(Ext.isEmpty(Ext.getStore("sHealthProblemRecord"))){Ext.create("Ext.data.Store",{storeId:"sHealthProblemRecord",autoLoad:false,model:"NisTRApp.model.Form.OpenRecord",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Problem"},url:SYS_CONST.ApiRoot+"Form/LastInpOpenRecord.ashx",reader:{type:"json"}}})}var a=Ext.getCmp("ActiveHealthProblenGrid");if(Ext.isEmpty(a)){a=this.GenActiveHealthProblenGrid("ActiveHealthProblenGrid","","");a.getTitleBar().hide();a.patient=this.getRecord();var b=Ext.getStore("sHealthProblemRecord");a.setStore(b);a.addListener("itemtap",this.ItemSingleTapTempSaveNoteGrid,a);this.down("#NNOTE_HealthProblemPanel").add(a);b=null;delete b}this.down("#NNOTE_HealthProblemPanel").setRecord(this.getRecord());a=null;delete a;if(Ext.isEmpty(Ext.getStore("sNotesTempRecord"))){Ext.create("Ext.data.Store",{storeId:"sNotesTempRecord",autoLoad:false,model:"NisTRApp.model.Note.NotesTempRecord",timeout:20000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/NotesTempRecord.ashx",reader:{type:"json"}}})}var a=Ext.getCmp("TempSaveNoteGrid");if(Ext.isEmpty(a)){a=this.GenTempSaveNoteGrid("TempSaveNoteGrid","","");a.getTitleBar().hide();a.patient=this.getRecord();var d=Ext.getStore("sNotesTempRecord");a.setStore(d);a.addListener("itemtap",this.ItemSingleTapTempSaveNoteGrid,a);this.down("#NNOTE_TempNotePanel").add(a);d=null;delete d}this.down("#NNOTE_TempNotePanel").setRecord(this.getRecord());a=null;delete a},DateInitial:function(){this.down("#NNOTE_HistoryBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.down("#NNOTE_HistoryEndDate").setValue(new Date())},GenTempSaveNoteGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},patient:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing"},{type:"pullrefresh"}],columns:[{text:"標題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(35),tpl:'<span style="color:Black; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:false},{text:"醫療日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(30),tpl:'<span style="color:Black; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.MedicalDate)]}</span>',flex:1,dataIndex:"MedicalDate",editable:false,sortable:false},{text:"瀏覽",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(15),tpl:'<a id="NNTEMPNOTEVIEW_{FormID}" class="btn link-btn" style="font-size: 16px">瀏覽</a>',flex:1,editable:false,sortable:false}],})},ItemSingleTapTempSaveNoteGrid:function(k,f,g,d,h,j){var b=function a(m,p,o){try{if(!Ext.isEmpty(Ext.getCmp("_opdNotesEditPanel"))){Ext.getCmp("_opdNotesEditPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opdNotesEditPanel"))){var n=Ext.create("NisTRApp.view.Nur.OPD_NotesEditPanel",{id:"_opdNotesEditPanel",centered:true,modal:true,formRecord:m,record:p,successFn:_noteSaveSuccessFn,height:NisTRApp.view.SysUtility.ClcHeight(85),width:NisTRApp.view.SysUtility.ClcWidth(90)});o.overlay=Ext.Viewport.add(n);n=null;delete n}o.overlay.show()}catch(q){console.log(q)}};h.preventDefault();if(h.event.target.nodeName=="A"){var l=h.event.target.id.split("_");if("NNTEMPNOTEVIEW"==l[0]){b(d,k.patient,k)}l=null;delete l}b=null;delete b;return false},GenActiveHealthProblenGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},patient:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing"},{type:"pullrefresh"}],columns:[{text:"系統別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(15),tpl:'<span style="color:Black; font-size: 14px">{CategoryTitle}</span>',flex:1,dataIndex:"CategoryTitle",editable:false,sortable:false},{text:"問題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(25),tpl:'<span style="color:Black; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:false},{text:"開始日期",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.StartDate)]}</span>',align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(15),xtype:"templatecolumn",dataIndex:"StartDate",editable:false,sortable:true},{text:"最後追蹤日",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.PlanLatestDate)]}</span>',align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(15),xtype:"templatecolumn",dataIndex:"DiscontinueDate",editable:false,sortable:true},{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(10),tpl:'<a id="NNTEMPNOTEVIEW_{KeyOne}" class="btn link-btn" style="font-size: 16px">記錄</a>',flex:1,editable:false,sortable:false}]})},LoadListItem:function(){if(Ext.getStore("sNotetList").isLoading()||Ext.isEmpty(this.getRecord())){return false}var a=Ext.getStore("sNotetList");a.removeAll();a.load();a=null;delete a;return false}});Ext.define("NisTRApp.view.Nur.OPD_NotesEditPanel",{extend:Ext.Container,alias:"widget.NurOPD_NotesEditPanel",statics:{LoadTempSaveNote:function(k,h,l,m,j,f,e,d){if(Ext.isEmpty(k)||Ext.isEmpty(l)){return}var g,a,b;if(l.data.Source.Type==1){g="0";a=l.data.Source.Name;b=(l.data.ChartSeq?l.data.ChartSeq:0)}else{if(l.data.Source.Type==2){g=l.data.InpNO;a=l.data.Source.Name;b=0}else{Ext.Msg.alert("NurAssessment 病人資料錯誤")}}if(!Ext.isEmpty(d)){d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD})}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/NursingNotes.ashx",scope:this,method:"POST",params:{FormID:k,ChartNo:l.data.ChartNo,UserID:h,InpNo:g,OpenRecordID:(!Ext.isEmpty(m))?m:""},success:function(n){var o=Ext.decode(n.responseText);if(Ext.isEmpty(o)){o=null;delete o;return}j.setValue("");j.setValue(o.MainMasterID);if(Ext.isEmpty(o.Notes.NotesID)){}else{f.setValue(o.Notes.Content);e.setValue(o.Notes.Title)}d.setMasked(false);o=null;delete o},failure:function(){d.setMasked(false)}});g=null;a=null;b=null;delete g;delete a;delete b},LoadNursingNotesList:function(a,e,f,d){if(Ext.getStore("sFormNursingNotes").isLoading()||Ext.isEmpty(a)){return}var g=a;var b=Ext.getStore("sFormNursingNotes");b.removeAll();b.getProxy().setExtraParams({BegDate:e,EndDate:f,ChartNo:g.data.ChartNo});b.load({callback:function(j,h,k){},scope:this});b=null;delete b;g=null;delete g}},config:{centered:false,height:"100%",width:"100%",layout:{type:"hbox"},modal:false,caller:{},formRecord:{},successFn:{},items:[{xtype:"tabpanel",height:"100%",itemId:"NNOTE_FormEditPanel",width:"50%",items:[{xtype:"container",title:"記錄",layout:{type:"fit"},items:[{xtype:"panel",height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"textfield",hidden:true,itemId:"NNOTE_NoteMainMasterID",label:"Field"},{xtype:"panel",itemId:"NNOTE_NoteDateTimePanel"},{xtype:"panel",items:[{xtype:"textfield",itemId:"NNOTE_NoteTitle",margin:"5 0 5 0",label:"Note",labelWidth:"20%",placeHolder:"請輸入"}]},{xtype:"panel",height:"100%",maxHeight:568,width:"100%",items:[{xtype:"textareafield",itemId:"NNOTE_NoteContent",width:"100%",label:"記錄內容",labelWidth:"20%",placeHolder:"請輸入護理記錄內容, 可利用右方範本進行帶入",maxRows:19}]}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",html:'<span style="color:White;"> 關 閉 </span>',itemId:"NNOTE_FormCancelBtn",ui:"confirm-back",width:"30%",text:"MyButton66"},{xtype:"button",html:'<span style="color:Black;"> 暫 存 </span>',itemId:"NNOTE_FormTempSaveBtn",ui:"confirm",width:"30%",text:"MyButton66"},{xtype:"button",html:'<span style="color:red;"> 存 檔 </span>',itemId:"NNOTE_FormSaveBtn",ui:"confirm",width:"30%",text:"MyButton66"}]}]}]},{xtype:"tabpanel",height:"100%",itemId:"NNOTE_FormInfoPanel",width:"50%",items:[{xtype:"container",title:"範本",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOTE_FormTemplateList",disableSelection:true,itemTpl:["<div>",'    <span style="color:Black;">',"        ",'        <pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Content}',"        </pre>","    </span>","</div>"]}]},{xtype:"container",title:"記錄歷程(門)",itemId:"NNOTE_ForNursingNotePanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOTE_FormNursingNotesList",itemTpl:["<div>",'    <span class="posted" style="color:black;font-weight:bold;"> 【{Title}】</span> <span>日期 : {MedicalDateFormat}&nbsp;{MedicalTimeFormat} 人員:{UserName} </span>',"</div>","<br>",'<div style="font-size:medium;"> ','<span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{HtmlEncodeContent} </pre></span>',"</div>",""]},{xtype:"toolbar",docked:"top",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"NNOTE_FormHistoryBegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"NNOTE_FormHistoryEndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"NNOTE_FormHistoryRefresg",margin:"0 0 0 20",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton42"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sFormNursingNotes").getCount()<=0){NisTRApp.view.Nur.OPD_NotesEditPanel.LoadNursingNotesList(this.getRecord(),this.down("#NNOTE_FormHistoryBegDate").getValue(),this.down("#NNOTE_FormHistoryEndDate").getValue(),this)}},event:"painted"}]}]}],listeners:[{fn:"onNNOTE_FormCancelBtnTap",event:"tap",delegate:"#NNOTE_FormCancelBtn"},{fn:"onNNOTE_FormTempSaveBtnTap",event:"tap",delegate:"#NNOTE_FormTempSaveBtn"},{fn:"onNNOTE_FormSaveBtnTap",event:"tap",delegate:"#NNOTE_FormSaveBtn"},{fn:"onNNOTE_FormTemplateListItemTap",event:"itemtap",delegate:"#NNOTE_FormTemplateList"},{fn:"onNNOTE_FormHistoryRefresgTap",event:"tap",delegate:"#NNOTE_FormHistoryRefresg"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"}]},onNNOTE_FormCancelBtnTap:function(b,d,a){this.destroy()},onNNOTE_FormTempSaveBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())){return}if(String.IsNull(this.down("#NNOTE_NoteContent").getValue())){NisTRApp.view.Misc.Alert("請輸入記錄內容",0);return}this.SaveNotes(this.getRecord(),this.getFormRecord(),false,this)},onNNOTE_FormSaveBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())){return}if(this.down("#NNOTE_NoteDateTime").getValue()>new Date()){NisTRApp.view.Misc.Alert("紀錄日期大於現在時間, 重填! ",0);return}if(String.IsNull(this.down("#NNOTE_NoteContent").getValue())){NisTRApp.view.Misc.Alert("請輸入記錄內容",0);return}this.SaveNotes(this.getRecord(),this.getFormRecord(),true,this)},onNNOTE_FormTemplateListItemTap:function(b,f,j,a,h,g){var d=this.down("#NNOTE_NoteContent").getValue();d=d+a.data.Content;this.down("#NNOTE_NoteContent").setValue(d);d=null;delete d},onNNOTE_FormHistoryRefresgTap:function(b,d,a){NisTRApp.view.Nur.OPD_NotesEditPanel.LoadNursingNotesList(this.getRecord(),this.down("#NNOTE_FormHistoryBegDate").getValue(),this.down("#NNOTE_FormHistoryEndDate").getValue(),this)},onContainerShow:function(b,d){if(Ext.isEmpty(this.getRecord())){return}var f=this.getRecord();this.down("#NNOTE_NoteMainMasterID").setValue("");this.down("#NNOTE_NoteTitle").setValue("");this.down("#NNOTE_NoteContent").setValue("");this.down("#NNOTE_NoteDateTime").setValue(new Date());this.down("#NNOTE_NoteTitle").reset();this.down("#NNOTE_NoteTitle").setLabel("Note");var a=this.getFormRecord();if(!Ext.isEmpty(a)){this.down("#NNOTE_NoteMainMasterID").setValue((!Ext.isEmpty(a.data.MainMasterID)?a.data.MainMasterID:""));this.down("#NNOTE_NoteTitle").setValue(a.data.text);if(a.data.formID=="IEG6CEODOFHUPDPJYBTYTVGALI"){this.down("#NNOTE_NoteTitle").setReadOnly(null)}else{this.down("#NNOTE_NoteTitle").setReadOnly(true)}}if(!Ext.isEmpty(a)){var e=Ext.getStore("sFrmTemplate");e.removeAll();e.getProxy().setExtraParams({FormID:a.data.FormID});e.load();e=null;delete e}if(!Ext.isEmpty(a)){NisTRApp.view.Nur.OPD_NotesEditPanel.LoadTempSaveNote(a.data.FormID,NisTRApp.view.SysUtility.getUserID(),f,(!Ext.isEmpty(a.data.OpenRecordId))?a.data.OpenRecordId:"",this.down("#NNOTE_NoteMainMasterID"),this.down("#NNOTE_NoteContent"),this.down("#NNOTE_NoteTitle"),this.down("#NNOTE_FormEditPanel"));a=null;delete a}},onContainerDestroy:function(a){Ext.Viewport.removeListener("resize",_resize_noteEditPaenl,this);_resize_noteEditPaenl=null;delete _resize_noteEditPaenl;if(!Ext.isEmpty(Ext.getStore("sFrmTemplate"))){Ext.getStore("sFrmTemplate").removeAll();Ext.getStore("sFrmTemplate").destroy()}if(!Ext.isEmpty(Ext.getStore("sFormNursingNotes"))){Ext.getStore("sFormNursingNotes").removeAll();Ext.getStore("sFormNursingNotes").destroy()}console.log("NurOPD_NotesEditPanel on destroy");this.removeAll(true,true)},initialize:function(){this.callParent();_resize_noteEditPaenl=function(e,d){this.setHeight(NisTRApp.view.SysUtility.ClcHeight(85));this.setWidth(NisTRApp.view.SysUtility.ClcWidth(90))};Ext.Viewport.addListener("resize",_resize_noteEditPaenl,this);if(Ext.isEmpty(this.down("#NNOTE_NoteDateTime"))){var a=Ext.create("Ext.ux.field.DateTimePicker",{itemId:"NNOTE_NoteDateTime",name:"NoteDateTime",label:"醫療日期",value:new Date(),width:"99%",labelWidth:"20%",autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}});this.down("#NNOTE_NoteDateTimePanel").add(a);a=null;delete a}if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("NurNote 病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("NurNote 病人資料錯誤");return false}var b=this.getFormRecord();if(!Ext.isEmpty(b)){if(Ext.isEmpty(Ext.getStore("sFrmTemplate"))){Ext.create("Ext.data.Store",{storeId:"sFrmTemplate",autoLoad:false,model:"NisTRApp.model.Form.FrmTemplateEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/Template.ashx",reader:{type:"json"}}})}this.down("#NNOTE_FormTemplateList").setStore(Ext.getStore("sFrmTemplate"))}if(Ext.isEmpty(Ext.getStore("sFormNursingNotes"))){Ext.create("Ext.data.Store",{storeId:"sFormNursingNotes",autoLoad:false,model:"NisTRApp.model.Form.NursingNotes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/NursingNotesListV2.ashx",reader:{type:"json"}}})}this.down("#NNOTE_ForNursingNotePanel").setRecord(this.getRecord());this.down("#NNOTE_FormNursingNotesList").setStore(Ext.getStore("sFormNursingNotes"));this.down("#NNOTE_NoteTitle").setValue("");this.down("#NNOTE_NoteContent").setValue("");this.down("#NNOTE_NoteDateTime").setValue(new Date());this.down("#NNOTE_NoteTitle").reset();this.down("#NNOTE_NoteTitle").setLabel("Note");this.down("#NNOTE_NoteMainMasterID").setValue((!Ext.isEmpty(b)&&!Ext.isEmpty(b.data.MainMasterID)?b.data.MainMasterID:""));this.down("#NNOTE_FormHistoryBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.down("#NNOTE_FormHistoryEndDate").setValue(new Date());b=null;delete b},SaveNotes:function(j,b,d,a){var g=this.down("#NNOTE_NoteDateTime").getFormattedValue("Y-m-d H:i");var e=this.down("#NNOTE_NoteContent").getValue();var f=this.down("#NNOTE_NoteTitle").getValue();var k=this.down("#NNOTE_NoteMainMasterID").getValue();var h={ChartNo:j.data.ChartNo,ChartSeq:(j.data.ChartSeq?j.data.ChartSeq:0),UserID:NisTRApp.view.SysUtility.GetUserID(),MainMasterID:k,FormID:b.data.FormID,MedicalDate:g,Html:"",Finished:d,Title:f,Content:e,Value:""};a.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/SaveNotesWithJson.ashx",scope:this,method:"POST",params:{Json:btoa(encodeURIComponent(JSON.stringify(h)))},success:function(l){NisTRApp.view.Misc.Alert("存檔成功",800);a.setMasked(false);if(d&&!Ext.isEmpty(Ext.getStore("sFormNursingNotes"))){Ext.getStore("sFormNursingNotes").load()}if(!Ext.isEmpty(a.getSuccessFn())){a.getSuccessFn()(d)}},failure:function(){NisTRApp.view.Misc.Alert("存檔失敗",0);a.setMasked(false)}});h=null;delete h;e=null;delete e;f=null;delete f;k=null;delete k;g=null;delete g;j=null;delete j;b=null;delete b}});Ext.define("NisTRApp.view.REG.RegHistory",{extend:Ext.Container,alias:"widget.REG_RegHistory",config:{height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"RegHistoryToolBar",items:[{xtype:"searchfield",itemId:"regHistoryId",width:"290px",label:"病人ID",placeHolder:"病歷號或身份證號"},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"REGHISTORY_BegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"REGHISTORY_EndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"REGHISTORY_RefreshBtn",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton89"}]},{xtype:"panel",itemId:"RegHistoryMainPanel"}],listeners:[{fn:"onREGHISTORY_RefreshBtnTap",event:"tap",delegate:"#REGHISTORY_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onREGHISTORY_RefreshBtnTap:function(b,g,a){if(Ext.getStore("sRegHistory").isLoading()||Ext.isEmpty(this.down("#regHistoryId").getValue())){return}var d=this.down("#regHistoryId").getValue();var f=Ext.getStore("sRegHistory");f.removeAll();f.getProxy().setExtraParams({ID:d,BegDate:this.down("#REGHISTORY_BegDate").getValue(),EndDate:this.down("#REGHISTORY_EndDate").getValue()});f.sort("RegDate");f.load({callback:function(h,e,j){},scope:this});f=null;delete f;d=null;delete d},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sRegHistory"))){Ext.getStore("sRegHistory").removeAll();Ext.getStore("sRegHistory").destroy()}this.removeAll()},onContainerShow:function(a,b){if(Ext.getStore("sRegHistory").getCount()<=0){this.down("#REGHISTORY_RefreshBtn").fireEvent("tap",this.down("#REGHISTORY_RefreshBtn"),null,null)}},initialize:function(){this.callParent();if(!Ext.isEmpty(this.getRecord())&&!Ext.isEmpty(this.getRecord().data)&&!Ext.isEmpty(this.getRecord().data.ChartNo)){this.down("#regHistoryId").setValue(this.getRecord().data.ChartNo)}this.down("#REGHISTORY_EndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));this.down("#REGHISTORY_BegDate").setValue(new Date());if(Ext.isEmpty(Ext.getStore("sRegHistory"))){Ext.create("Ext.data.Store",{storeId:"sRegHistory",autoLoad:false,model:"NisTRApp.model.Reg.RegHistoryData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryAllRegListDate.ashx",reader:{type:"json"}}})}var a=Ext.getCmp("RegHistoryGrid");if(Ext.isEmpty(a)){a=this.GenRegHistoryGrid("RegHistoryGrid","","");a.getTitleBar().hide();var b=Ext.getStore("sRegHistory");a.setStore(b);this.down("#RegHistoryMainPanel").add(a);b=null;delete b}a=null;delete a;this.down("#RegHistoryMainPanel").setRecord(this.getRecord())},GenRegHistoryGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">查無掛號資料.</div>',plugins:[{type:"gridcolumnresizing"}],columns:[{text:REG_CONST.RegDate,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",width:90,tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RegDate)]}</span>',flex:1,dataIndex:"RegDate",editable:false,sortable:true},{text:REG_CONST.DocNo,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{DocName} </span>',flex:1,width:90,dataIndex:"DocNo",editable:false,sortable:true},{text:"預約",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.DateUtil.FormatRegTime(values.NoteTime)]} </span>',flex:1,width:70,dataIndex:"NoteTime",editable:false,sortable:false},{text:"報到",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.DateUtil.FormatRegTime(values.ArrivalTime)]} </span>',flex:1,width:70,dataIndex:"ArrivalTime",editable:false,sortable:false},{text:"進診間",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.DateUtil.FormatRegTime(values.OrdInTime)]} </span>',flex:1,width:70,dataIndex:"OrdInTime",editable:false,sortable:false},{text:"出診間",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.DateUtil.FormatRegTime(values.OrdOutTime)]} </span>',flex:1,width:70,dataIndex:"OrdOutTime",editable:false,sortable:true},{text:"批價",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.DateUtil.FormatRegTime(values.AccTime)]} </span>',flex:1,width:70,dataIndex:"AccTime",editable:false,sortable:false},{text:REG_CONST.RegType,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{RegTypeName} </span>',flex:1,width:120,dataIndex:"RegTypeName",editable:false,sortable:true},{text:REG_CONST.ChartSeq,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{ChartSeq}</span>',flex:1,width:90,dataIndex:"ChartSeq",editable:false,sortable:true},{text:REG_CONST.HdeptCode,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{HdeptCode} </span>',flex:1,width:70,dataIndex:"HdeptCode",editable:false,sortable:true},{text:"診區",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{AreaName} </span>',flex:1,width:130,dataIndex:"AreaName",editable:false,sortable:false}]})}});Ext.define("NisTRApp.view.OPR.WorkList",{extend:Ext.Container,alias:"widget.OPR_WorkList",config:{stopDistroyEvent:false,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"list",itemId:"OPRWK_List",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無工作清單.</div>',itemTpl:Ext.create("Ext.XTemplate","<table >","<tr>",'<td id={ItemName} rowspan="1" align="left" width="220px">    {ItemName} </td>','<td width="10px" align="left">&nbsp;&nbsp;</td>  ',"    ",'<td rowspan="1" align="right" width="64px">',"    ",'     <img name="img" src={[this.FinishChk(values.IsFinished)]} style="width:40px;height:40px;">'," </td>",'<td rowspan="1" align="right" width="300px">',"    ","    <span>{DisplayMsg}</span>"," </td>    ","</tr>","     ","</table>","",{FinishChk:function(a){if(a){return"../_/img/FrmFinish.png"}else{return"../_/img/FrmAdd.png"}}})},{xtype:"toolbar",docked:"bottom",itemId:"OPRWK_Footbar",items:[{xtype:"button",itemId:"OPRWK_CloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"},{xtype:"button",itemId:"OPRWK_RefershBtn",ui:"decline",width:"20%",text:"重 新 整 理"}]}],listeners:[{fn:"onOPRWK_ListItemTap",event:"itemtap",delegate:"#OPRWK_List"},{fn:"onOPRWK_CloseBtnTap",event:"tap",delegate:"#OPRWK_CloseBtn"},{fn:"onOPRWK_RefershBtnTap",event:"tap",delegate:"#OPRWK_RefershBtn"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"}]},onOPRWK_ListItemTap:function(d,g,h,f,j,k){_opdWkFrmEdit_callback_event=function(n){try{if(!Ext.isEmpty(Ext.getStore("sOprWorkingList"))){Ext.getStore("sOprWorkingList").load()}if(null!=n&&undefined!=n&&"TempSave"==n){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_wklistFormPanel"))){Ext.getCmp("_wklistFormPanel").destroy()}}}catch(o){console.error("_opdWkFrmEdit_callback_event",o)}};var a=function a(o,n,p){if(Ext.getStore("sOprWorkingList").isLoading()||Ext.isEmpty(n)||Ext.isEmpty(n.data.OprmstID)||Ext.isEmpty(o)||Ext.isEmpty(o.data.ItemID)){return}var u=f.data.WorkType.split("_");if(Ext.isEmpty(u)||u.length<2){u=null;delete u;Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}var r,s,q;if(n.data.Source.Type==1){r="0";s=n.data.Source.Name;q=(n.data.ChartSeq?n.data.ChartSeq:0)}else{if(n.data.Source.Type==2){r=n.data.InpNO;s=n.data.Source.Name;q=0}else{Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}}if(u[1]=="RenderAssesment"){var e=NisTRApp.view.FormUtil.AssessmentAddr(u[1],o.data.ItemID,NisTRApp.view.SysUtility.GetUserID(),n.data.ChartNo,q,"","","_opdWkFrmEdit_callback_event","",r,s);NisTRApp.view.FormUtil.OpenWorkListForm(e,"_wklistFormPanel",p);e=null;delete e}else{if(u[1]=="RenderHeathTeach"){NisTRApp.view.TRUtility.OpenMainUI(n,SYS_CONST.PageDef.NurHealthTeach,p.getCaller());p.getCaller().destroy()}else{if(u[1]=="Notes"){NisTRApp.view.TRUtility.OpenMainUI(n,SYS_CONST.PageDef.NurNotes,p.getCaller());p.getCaller().destroy()}else{if(u[1]=="RenderPrepare"){NisTRApp.view.TRUtility.OpenMainUI(n,SYS_CONST.PageDef.NurPrepare,p.getCaller());p.getCaller().destroy()}}}}u=null;delete u;r=null;s=null;q=null;delete r;delete s;delete q;n=null;delete n};var b=function b(q,n){if(Ext.isEmpty(q)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){Ext.getCmp("_opdVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){var o=Ext.create("NisTRApp.view.OPD_VitalSignInputPanel",{id:"_opdVSInputPanel",patInfo:q,success:function(e){if(!Ext.isEmpty(Ext.getStore("sOprWorkingList"))){Ext.getStore("sOprWorkingList").load()}}});Ext.Viewport.add(o);o=null;delete o}o.show()}catch(p){console.log(p)}n=null;delete n;return};var l=this;if(j.event.target.nodeName=="IMG"){if(Ext.isEmpty(f.data.ItemID)||Ext.isEmpty(f.data.WorkType)){j.preventDefault();l=null;delete l;return false}var m=f.data.WorkType.split("_");if(m[0]=="FRM"){a(f,this.getRecord(),l)}else{if(m[0]=="VITALSIGN"&&this.getRecord().data.Source==SYS_CONST.PatSource.OPD){b(this.getRecord(),l)}else{if(m[0]=="VITALSIGN"&&this.getRecord().data.Source==SYS_CONST.PatSource.INP){NisTRApp.view.TRUtility.OpenMainUI(this.getRecord(),SYS_CONST.PageDef.VitalSigns,l.getCaller());l.getCaller().destroy()}else{if(m[0]=="CATH"){NisTRApp.view.TRUtility.OpenMainUI(this.getRecord(),SYS_CONST.PageDef.Cath,l.getCaller());l.getCaller().destroy()}}}}m=null;delete m}j.preventDefault();l=null;delete l;a=null;delete a;b=null;delete b;return false},onOPRWK_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onOPRWK_RefershBtnTap:function(b,d,a){this.LoadWorkList()},onContainerShow:function(a,b){if(Ext.getStore("sOprWorkingList").getCount()<=0){this.LoadWorkList()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sOprWorkingList"))){Ext.getStore("sOprWorkingList").removeAll();Ext.getStore("sOprWorkingList").destroy()}_opdWkFrmEdit_callback_event=null;delete _opdWkFrmEdit_callback_event;console.log("on destroy :","OPR.WorkList");this.removeAll()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("OPR_WorkList 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.OprmstID)){Ext.Msg.alert("OPR_WorkList 手術資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sOprWorkingList"))){Ext.create("Ext.data.Store",{storeId:"sOprWorkingList",autoLoad:false,model:"NisTRApp.model.mWorkingItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprWorkingItem.ashx",reader:{type:"json"}}})}this.down("#OPRWK_List").setStore(Ext.getStore("sOprWorkingList"))},LoadWorkList:function(){if(Ext.getStore("sOprWorkingList").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=this.getRecord();var b=Ext.getStore("sOprWorkingList");b.removeAll();b.getProxy().setExtraParams({ChartNO:a.data.ChartNo,OprmstID:a.data.OprmstID,Source:a.data.Source.Name});b.load();b=null;delete b}});Ext.define("NisTRApp.view.INP_VitalSignInputPanel",{extend:Ext.Panel,alias:"widget.INP_VitalSignInputPanel",config:{iDCNotifyFlag:"N",height:"400px",left:"",right:"3%",top:60,width:"750px",layout:{type:"fit"},modal:true,success:{},items:[{xtype:"panel",itemId:"INP_VitalSignMaintPanel"}],listeners:[{fn:"onPanelDestroy",event:"destroy"}]},onPanelDestroy:function(a){_vspanel=null;delete _vspanel;_vstoolbar=null;delete _vstoolbar;this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("INP_VitalChartInputPanel 住院資料錯誤");return false}try{var f=Ext.create("Ext.form.FieldSet",{width:"95%",centered:true,items:[{xtype:"datetimepickerfield",itemId:"VitalDate",name:"Vitaldate",label:"醫療日期",value:new Date(),width:"99%",labelWidth:"30%",autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}},{xtype:"numberfield",style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%",label:"Temperature",itemId:"Temperature",autoCapitalize:true,placeHolder:"請輸入(度)"},{xtype:"numberfield",itemId:"Pulse",name:"Pulse",label:"Pulse",placeHolder:"請輸入(次)",autoCapitalize:true,required:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%"},{xtype:"numberfield",itemId:"Heart",name:"Heart",label:"Heart Rate",placeHolder:"請輸入(次)",autoCapitalize:true,required:false,cleanIcon:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%",disabled:true},{xtype:"numberfield",itemId:"Respiration",name:"Respiration",label:"Respiration Rate",placeHolder:"請輸入(次)",autoCapitalize:true,required:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%"},{xtype:"numberfield",itemId:"SystolicBloodPressure",name:"SystolicBloodPressure",label:"Systolic Blood Pressure",placeHolder:"請輸入(mmHg)",autoCapitalize:true,required:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%"},{xtype:"numberfield",itemId:"DiastolicBloodPressure",name:"DiastolicBloodPressure",label:"Diastolic Blood Pressure",placeHolder:"請輸入(mmHg)",autoCapitalize:true,required:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%"},{xtype:"numberfield",itemId:"ArterialSystolicBloodPressure",name:"ArterialSystolicBloodPressure",label:"Arterial Systolic Blood Pressure",placeHolder:"請輸入(mmHg)",autoCapitalize:true,required:false,cleanIcon:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%",disabled:true},{xtype:"numberfield",itemId:"ArterialDiastolicBloodPressure",name:"ArterialDiastolicBloodPressure",label:"Arterial Diastolic Blood Pressure",placeHolder:"請輸入(mmHg)",autoCapitalize:true,required:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%",disabled:true},{xtype:"textfield",itemId:"PulseOxygenSaturation",label:"SPO2/用氧說明",placeHolder:"請輸入數值(%)",autoCapitalize:true,required:false,style:"float:left;font-size:16px;",width:"50%",labelWidth:"50%"},{xtype:"textfield",height:"2.8em",id:"PulseOxygenSaturationStr",itemId:"PulseOxygenSaturationStr",style:"float:left;font-size:16px;",width:"40%",labelWidth:"1px"},{xtype:"selectfield",id:"PulseOxygenSaturationOpt",itemId:"PulseOxygenSaturationOpt",height:"2.8em",labelWidth:"0px",width:"10%",options:[{text:"",value:""},{text:"測不到",value:"測不到"},{text:"AC mode  % FiO2 呼吸器",value:"AC mode  % FiO2 呼吸器"},{text:"PC mode  % FiO2 呼吸器",value:"PC mode  % FiO2 呼吸器"},{text:"PS mode  % FiO2 呼吸器",value:"PS mode  % FiO2 呼吸器"},{text:"Y-piece   %    L/min",value:"Y-piece   %    L/min"},{text:"Tr. collar  %  L/min",value:"Tr. collar  %  L/min"},{text:"BIPAP   L/min",value:"BIPAP   L/min"},{text:"Room air",value:"Room air"},{text:"鼻導管  L/min",value:"鼻導管  L/min"},{text:"Simple mask  L/min",value:"Simple mask  L/min"},{text:"Non-rebreathing mask  L/min",value:"Non-rebreathing mask  L/min"}],listeners:{change:function(h,g,e){if(g!=""){Ext.getCmp("PulseOxygenSaturationStr").setValue(g);Ext.getCmp("PulseOxygenSaturationOpt").setValue("")}}},style:"float:left;font-size:16px;"},{labelWidth:"30%",width:"100%",xtype:"multiselectfield",delimiter:",",mode:"MULTI",itemId:"_tprRemark",label:"說明",placeHolder:"請輸入",options:[{text:"",value:""},{text:"拒絕",value:"拒絕"},{text:"睡眠中",value:"睡眠中"},{text:"全部測不到",value:"全部測不到"},{text:"其餘測不到",value:"其餘測不到"},{text:"腋溫",value:"腋溫"},{text:"站立",value:"站立"},{text:"坐姿",value:"坐姿"},{text:"平躺",value:"平躺"},{text:"左手",value:"左手"},{text:"右手",value:"右手"},{text:"左腳",value:"左腳"},{text:"右腳",value:"右腳"}],value:"",style:"float:left;font-size:16px;"}]});var a=Ext.create("Ext.Toolbar",{docked:"bottom",xtype:"toolbar",items:[{xtype:"button",text:"ICU 模式",itemId:"_icuModeButton",style:"width:20%",scope:this,hasDisabled:false},{xtype:"button",text:"一般模式",itemId:"_ModeButton",style:"width:20%",scope:this,hasDisabled:false},{xtype:"button",text:"取消",style:"width:20%",scope:this,ui:"confirm",hasDisabled:false,handler:function(e){if(this.getSuccess()){this.getSuccess()()}this.removeAll(true,true);this.destroy()}},{text:"資料儲存",style:"width:35%",itemId:"_vitalSignInputToolbarSave",xtype:"button",scope:this,ui:"confirm"}]});a.down("#_ModeButton").addListener("tap",function(h,j,g){this.down("#Heart").disable();this.down("#ArterialSystolicBloodPressure").disable();this.down("#ArterialDiastolicBloodPressure").disable();this.down("#Pulse").enable();h.hasDisabled=false;this.down("#_icuModeButton").setBadgeText("");this.down("#_ModeButton").setBadgeText("On")},this);a.down("#_icuModeButton").addListener("tap",function(h,j,g){this.down("#Heart").enable();this.down("#ArterialSystolicBloodPressure").enable();this.down("#ArterialDiastolicBloodPressure").enable();this.down("#Pulse").enable();h.hasDisabled=true;this.down("#_icuModeButton").setBadgeText("On");this.down("#_ModeButton").setBadgeText("")},this);a.down("#_vitalSignInputToolbarSave").addListener("tap",function(j,m,h){var n=this.getRecord();var g=this.down("#PulseOxygenSaturation").getValue();var k=/^(-?\d+)(\.\d+)?$/;if(null!=g&&""!=g&&!k.test(g)){Ext.Msg.alert("SPO2/用氧說明，請輸入數值！");return}var l=this;l.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/VitalSignInsert.ashx",scope:this,method:"POST",timeout:15000,params:{T:this.down("#Temperature").getValue(),HR:this.down("#Heart").getValue(),PR:this.down("#Pulse").getValue(),RR:this.down("#Respiration").getValue(),SBP:this.down("#SystolicBloodPressure").getValue(),DBP:this.down("#DiastolicBloodPressure").getValue(),ASBP:this.down("#ArterialSystolicBloodPressure").getValue(),ADBP:this.down("#ArterialDiastolicBloodPressure").getValue(),ExeDateTime:this.down("#VitalDate").getFormattedValue("Y-m-d H:i:s"),UserID:NisTRApp.view.SysUtility.GetUserID(),ChartNo:n.data.ChartNo,InpNo:n.data.InpNo,Remark:this.down("#_tprRemark").getValue(),SPO2:this.down("#PulseOxygenSaturation").getValue(),SPO2MEMO:this.down("#PulseOxygenSaturationStr").getValue()},success:function(e){console.log(e);l.setMasked(false);var o=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(o.Message,(o.Success?800:0));if(o.Success){if(this.getSuccess()){this.getSuccess()("Success")}l.setHidden(true);Ext.callback(function(p){p.removeAll(true,true);p.destroy()},l,[l],200);l=null;delete l}o=null;delete o},failure:function(){l.setMasked(false);Ext.Msg.alert("存檔失敗")}});n=null;delete tempVar;g=null;delete g;k=null;delete k},this);f.down("#Temperature").on("blur",function(h,k,g){if(null!=h.getValue()&&h.getValue()>=38){var j=h.getValue();var l=this.getRecord();this.setMasked({xtype:"loadmask",message:"檢查通報資料..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"action/IdcIsNotify.ashx",scope:this,method:"POST",params:{InpNo:l.data.InpNo,ChartNo:l.data.ChartNo,ChartSeq:-1,Source:"INP"},success:function(n){var o=Ext.decode(n.responseText);this.setIDCNotifyFlag(o.IsNotify);if(o.IsNotify=="N"){try{if(!Ext.isEmpty(Ext.getCmp("_iDCNotifyPaenl"))){Ext.getCmp("_iDCNotifyPaenl").destroy()}if(Ext.isEmpty(Ext.getCmp("_iDCNotifyPaenl"))){var m=Ext.create("NisTRApp.view.IDCNotifyPaenl",{id:"_iDCNotifyPaenl",record:l,temperature:j});this.overlay=Ext.Viewport.add(m);m=null;delete m}this.overlay.show()}catch(p){console.log(p)}}this.setMasked(false);o=null;delete o;l=null;delete l;j=null;delete t},failure:function(){this.setMasked(false);l=null;delete l;j=null;delete t}})}else{return false}},this);f.down("#Temperature").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#Pulse").focus()}},f.down("#Temperature"));f.down("#Pulse").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){if(!f.down("#Heart").getDisabled()){f.down("#Heart").focus()}else{f.down("#Respiration").focus()}}},f.down("#Pulse"));f.down("#Heart").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#Respiration").focus()}},f.down("#Heart"));f.down("#Respiration").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#SystolicBloodPressure").focus()}},f.down("#Respiration"));f.down("#SystolicBloodPressure").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#DiastolicBloodPressure").focus()}},f.down("#SystolicBloodPressure"));f.down("#DiastolicBloodPressure").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){if(!f.down("#ArterialSystolicBloodPressure").getDisabled()){f.down("#ArterialSystolicBloodPressure").focus()}else{f.down("#_tprRemark").focus()}}},f.down("#DiastolicBloodPressure"));f.down("#ArterialSystolicBloodPressure").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#ArterialDiastolicBloodPressure").focus()}},f.down("#ArterialSystolicBloodPressure"));f.down("#ArterialDiastolicBloodPressure").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#_tprRemark").focus()}},f.down("#ArterialDiastolicBloodPressure"));f.down("#PulseOxygenSaturationStr").on("focus",function(h,g){f.down("#PulseOxygenSaturationOpt").focus()},f.down("#PulseOxygenSaturationStr"),{single:true});f.down("#PulseOxygenSaturation").on("keyup",function(h,g){if(g.browserEvent.keyCode==13){f.down("#PulseOxygenSaturationOpt").focus()}},f.down("#PulseOxygenSaturation"));this.down("#INP_VitalSignMaintPanel").add(f);this.down("#INP_VitalSignMaintPanel").add(a);var b="";if(!Ext.isEmpty(this.getRecord().data.NowBedNo)){b=this.getRecord().data.NowBedNo}else{try{b=this.getRecord().getIpbinp().data.NowBedNo}catch(d){b=""}}if(b.substring(0,1)=="2"){a.down("#_icuModeButton").fireEvent("tap",a.down("#_icuModeButton"),null,null)}else{a.down("#_ModeButton").fireEvent("tap",a.down("#_icuModeButton"),null,null)}f.down("#VitalDate").setValue(new Date());b=null;delete b}catch(d){console.log(d)}}});Ext.define("NisTRApp.view.IDCNotifyPaenl",{extend:Ext.Panel,alias:"widget.IDCNotifyPaenl",config:{temperature:-1,centered:true,height:200,width:324,layout:{type:"fit"},modal:true,successFn:{},closeFn:{},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"IDCN_TitleBar",items:[{xtype:"label",html:"發燒安全異常通報",itemId:"IDCPatInfoLbl",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   生日.{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age}) &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        身份證號. {PatIdno} </span>","</td>","</tr>","</table>"]}]},{xtype:"toolbar",docked:"bottom",itemId:"IDCN_FootBar",items:[{xtype:"button",itemId:"iDCCancelBtn",left:"2px",ui:"confirm",width:"45%",text:" 取 消 "},{xtype:"button",itemId:"iDCNotifyBtn",right:"2px",ui:"decline",width:"45%",text:" 通 報 "}]},{xtype:"panel",itemId:"IDC_MainPanel",scrollable:false,items:[{xtype:"numberfield",itemId:"iDCTemperature",label:"Temperature",labelWidth:"50%"},{xtype:"checkboxfield",itemId:"iDCCough",label:"咳嗽",labelWidth:"50%"}]}],listeners:[{fn:"onIDCCancelBtnTap",event:"tap",delegate:"#iDCCancelBtn"},{fn:"onIDCNotifyBtnTap",event:"tap",delegate:"#iDCNotifyBtn"},{fn:"onPanelDestroy",event:"destroy"}]},onIDCCancelBtnTap:function(b,d,a){if(!Ext.isEmpty(this.getCloseFn())&&Ext.isFunction(this.getCloseFn())){this.getCloseFn()()}this.destroy()},onIDCNotifyBtnTap:function(d,h,b){var f=this;var g=function g(m,n,e,l){m.setMasked({xtype:"loadmask",message:"正在通報..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"action/IdcNotify.ashx",scope:this,method:"POST",params:{ChartNo:n.data.ChartNo,InpNo:(n.data.Source.Type==2?n.data.InpNo:""),UserId:NisTRApp.view.SysUtility.GetUserID(),ChartSeq:(n.data.Source.Type==2?-1:n.data.ChartSeq),Source:n.data.Source.Name,BodyTemp:e,Cough:l},success:function(o){m.setMasked(false);m.destroy();m=null;delete m},failure:function(){Ext.Msg.alert("歐麥尬! 通報失敗!");m.setMasked(false);m=null;delete m}})};var j=this.getRecord();var k=this.down("#iDCCough").isChecked()==true?"Y":"N";var a=f.down("#iDCTemperature").getValue();if(null==a||""==a){Ext.Msg.alert("請填寫體溫!");f=null;delete f;j=null;delete j;k=null;delete k;a=null;delete a;return}if(a<38){Ext.Msg.confirm("Confirmation","體溫小於38度，是否通報?",function(l,e){if(l==="no"){return}else{if(l==="yes"){g(f,j,a,k)}}})}else{g(f,j,a,k)}j=null;delete j;k=null;delete k;a=null;delete a;g=null;delete g;if(!Ext.isEmpty(this.getSuccessFn())&&Ext.isFunction(this.getSuccessFn())){this.getSuccessFn()()}},onPanelDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("IDCNotify 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("IDCNotify 住院病人資料錯誤");return false}if((this.getRecord().data.Source.Type!=2)&&Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("IDCNotify 門診病人資料錯誤");return false}if(this.getTemperature()>=0){this.down("#iDCTemperature").setValue(this.getTemperature())}}});Ext.define("NisTRApp.view.Nur.INP_Assessment",{extend:Ext.Container,alias:"widget.NurINP_Assessment",statics:{OpenAssessmentForm:function(b,g){if(Ext.isEmpty(b)){Ext.Msg.alert("INP_Assessment 表單網址錯誤");return}try{var d=Ext.getCmp("_inpAssessmentFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_inpAssessmentFormPanel",url:b,divID:"InpAssessmentFrameDIV",formId:g})}if(!Ext.isEmpty(d)){var a=Ext.ComponentQuery.query("#NA_INP_MainPanel")[0];d.setCaller(a);d.setCloseFn(function(e){e.setHidden(false)});Ext.ComponentQuery.query("#NA_INP_Main")[0].animateActiveItem(d,{type:"slide",direction:"right"});a.setHidden(true);d.show();a=null;delete a}d=null;delete d;patInfo=null;delete patInfo;b=null;delete b}catch(f){console.log(f)}},NursingPlan:function(h,b,g){if(Ext.isEmpty(h.data.FormID)||Ext.isEmpty(g)){return}var e,f,d;if(g.data.Source.Type==1){e="0";f=g.data.Source.Name;d=(g.data.ChartSeq?g.data.ChartSeq:0)}else{if(g.data.Source.Type==2){e=g.data.InpNO;f=g.data.Source.Name;d=0}else{Ext.Msg.alert("NurAssessment 病人資料錯誤")}}var a=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment",h.data.FormID,NisTRApp.view.SysUtility.GetUserID(),g.data.ChartNo,d,h.data.CategoryID,h.data.OpenRecordID,"_ReloadInpAccessmentData","",e,f);NisTRApp.view.Nur.INP_Assessment.OpenAssessmentForm(a,h.data.FormID);a=null;delete a;e=null;f=null;d=null;delete e;delete f;delete d},DCProblem:function(d,a,b){if(Ext.isEmpty(d.data.FormID)||Ext.isEmpty(b)){return}Ext.Msg.confirm("注意","是否確認停用此評估單?",function(e){if(e==="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/DistinueRecord.ashx",scope:a,method:"POST",params:{OpenRecordID:d.data.OpenRecordID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(f){var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){if(!Ext.isEmpty(Ext.getStore("sInpAssessmentRecord"))){Ext.getStore("sInpAssessmentRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInpInactiveAssessmentRecord"))){Ext.getStore("sInpInactiveAssessmentRecord").load()}}g=null;delete g;return false},failure:function(){Ext.Msg.alert("存檔失敗");return false}},a)}else{return false}})},NursingPlanHistory:function(h,b,g){if(Ext.isEmpty(h.data.FormID)||Ext.isEmpty(g)){return}var e,f,d;if(g.data.Source.Type==1){e="0";f=g.data.Source.Name;d=(g.data.ChartSeq?g.data.ChartSeq:0)}else{if(g.data.Source.Type==2){e=g.data.InpNO;f=g.data.Source.Name;d=0}else{Ext.Msg.alert("NurAssessment 病人資料錯誤")}}var a=NisTRApp.view.FormUtil.AssessmentAddr("CRenderAssesment",h.data.FormID,NisTRApp.view.SysUtility.GetUserID(),g.data.ChartNo,d,h.data.CategoryID,h.data.OpenRecordID,"_ReloadInpAccessmentData","",e,f);NisTRApp.view.Nur.INP_Assessment.OpenAssessmentForm(a);a=null;delete a;e=null;f=null;d=null;delete e;delete f;delete d},LoadActiveAccessmentRecord:function(a,b){if(Ext.getStore("sInpAssessmentRecord").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sInpAssessmentRecord");d.getProxy().setExtraParams({FunctionType:"Assessment",ChartNo:a.data.ChartNo,InpNo:a.data.InpNo,Discontinue:false});d.load();d=null;delete d},RenderActTable:function(b,g){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#NA_INP_ActiveGridPanel"))){return false}e=function e(h,k,l,m){var j=Ext.getStore("sInpAssessmentRecord").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpAssessmentRecord").getAt(0).records().getAt(j),k,l)}j=null;delete j};var f=Ext.getStore("sInpAssessmentRecord");b.down("#NA_INP_ActiveGridPanel").setHtml("");if(f.getCount()>0){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.down("#NA_INP_ActiveGridPanel"))){b.down("#NA_INP_ActiveGridPanel").setHtml("");if(!Ext.isEmpty(f.getAt(0))){var d=b.down("#NA_INP_ActiveGridPanel").getTpl().apply(f.getAt(0).data);b.down("#NA_INP_ActiveGridPanel").setHtml(d);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='nursingplan']").bind(a,function(){e(this,b,g,NisTRApp.view.Nur.INP_Assessment.NursingPlan)});$("a[name='nursingplanhistory']").bind(a,function(){e(this,b,g,NisTRApp.view.Nur.INP_Assessment.NursingPlanHistory)});$("a[name='dcproblem']").bind(a,function(){e(this,b,g,NisTRApp.view.Nur.INP_Assessment.DCProblem)});$("#inpAccessmentActGridRefresh").bind(a,function(){NisTRApp.view.Nur.INP_Assessment.LoadActiveAccessmentRecord(b.getRecord(),b)});d=null;delete d;a=null;delete a}}}f=null;delete f},LoadInactiveAccessmentRecord:function(a,b){if(Ext.getStore("sInpInactiveAssessmentRecord").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sInpInactiveAssessmentRecord");d.getProxy().setExtraParams({FunctionType:"Assessment",ChartNo:a.data.ChartNo,InpNo:a.data.InpNo,Discontinue:true});d.load();d=null;delete d},RenderInactTable:function(b,f){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#NA_INP_InactiveGridPanel"))){return false}_callInaAssessFn=function e(h,k,l,m){var j=Ext.getStore("sInpInactiveAssessmentRecord").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpInactiveAssessmentRecord").getAt(0).records().getAt(j),k,l)}j=null;delete j};var g=Ext.getStore("sInpInactiveAssessmentRecord");b.down("#NA_INP_InactiveGridPanel").setHtml("");if(g.getCount()>0){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.down("#NA_INP_InactiveGridPanel"))){b.down("#NA_INP_InactiveGridPanel").setHtml("");if(!Ext.isEmpty(g.getAt(0))){var d=b.down("#NA_INP_InactiveGridPanel").getTpl().apply(g.getAt(0).data);b.down("#NA_INP_InactiveGridPanel").setHtml(d);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='inactivenursingplan']").bind(a,function(){_callInaAssessFn(this,b,f,NisTRApp.view.Nur.INP_Assessment.NursingPlan)});$("a[name='inactivenursingplanhistory']").bind(a,function(){_callInaAssessFn(this,b,f,NisTRApp.view.Nur.INP_Assessment.NursingPlanHistory)});$("a[name='deleUser']").bind(a,function(){_callInaAssessFn(this,b,f,NisTRApp.view.Nur.INP_Assessment.RecoverProblem)});$("#inpAccessmentInactGridRefresh").bind(a,function(){NisTRApp.view.Nur.INP_Assessment.LoadInactiveAccessmentRecord(b.getRecord(),b)});d=null;delete d;a=null;delete a}}}g=null;delete g},RecoverProblem:function(d,a,b){if(Ext.isEmpty(d.data.FormID)||Ext.isEmpty(b)){return}Ext.Msg.confirm("注意","確認active此評估單張?",function(e){if(e==="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/RecoverDistinueRecord.ashx",scope:a,method:"POST",params:{OpenRecordID:d.data.OpenRecordID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(f){var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){if(!Ext.isEmpty(Ext.getStore("sInpAssessmentRecord"))){Ext.getStore("sInpAssessmentRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInpInactiveAssessmentRecord"))){Ext.getStore("sInpInactiveAssessmentRecord").load()}}g=null;delete g;return false},failure:function(){Ext.Msg.alert("存檔失敗");return false}},a)}else{return false}})},LoadFormHistory:function(b,e,a){if(Ext.getStore("sInpAssessmentHistory").isLoading()||Ext.isEmpty(b)){return}var d=Ext.getStore("sInpAssessmentHistory");d.removeAll();d.getProxy().setExtraParams({FunctionType:a,InpNo:b.data.InpNo});d.loadPage(1,null,e);d=null;delete d}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NA_INP_Main",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NA_INP_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",height:"100%",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",itemId:"NA_INP_NewAssessmentList",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的護理評估"}]},{xtype:"tabpanel",itemId:"NA_INP_MainTabPanel",width:"80%",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"Active",itemId:"NA_INP_ActiveGridPanel",tpl:Ext.create("Ext.XTemplate",'<div id="_assessmentActive" class="globalList" >','<table id="_assessmentActiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="8" style="text-align:left">護 理 評 估 <span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpAccessmentActGridRefresh" type="button">重新整理</button></span></th>',"            ","        </tr>","        <tr>",'            <th width="20%">評估項目</th>','            <th width="10%">開始日期</th>','            <th width="8%">最後追蹤日</th>','            <th width="8%">狀態</th>','            <th width="8%">編輯</th>','            <th width="8%">瀏覽</th>','            <th width="8%">停用</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">','            <tpl if= "FormID != &quot;XAV5BNJXE33UHP2BJO6VHYNULQ&quot;"> ',"                <tr>","     ",'                    <td width="20%" align="center" >{Title} {[this.SubTitleStr(values)]}</td>','                    <td width="10%" align="center"> {[this.StartDateStr(values)]}</td>','                    <td width="8%"  align="center">{[this.PlanLatestDateStr(values)]}</td>','                    <td width="8%"  align="center">{[this.PlanStatusStr(values)]}</td>','                    <td width="8%" align="center"><a id="btnView" name="nursingplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">評估單張</a></td>','                    <td width="8%" align="center"><a id="btnView1" name="nursingplanhistory" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">評估歷程</a></td>','                    <td width="8%" align="center"><a id="btnView2" name="dcproblem" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">停用</a></td> ',"                </tr>","            ","           </tpl>  ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="20%">評估項目</th>','            <th width="10%">開始日期</th>','            <th width="8%">最後追蹤日</th>','            <th width="8%">狀態</th>','            <th width="8%">編輯</th>','            <th width="8%">瀏覽</th>','            <th width="8%">停用</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>","","",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},PlanLatestDateStr:function(a){if(a.PlanLatestDate.substring(0,10)=="1753-01-01"){return""}else{return a.PlanLatestDate.substring(0,16).replace("T","<br>")}},PlanStatusStr:function(a){if(a.Finished==true){return"存檔"}else{return"暫存"}}}),layout:{type:"fit"},scrollable:"vertical",listeners:[{fn:function(b,a){},event:"painted"}]},{xtype:"container",title:"Inactive",itemId:"NA_INP_InactiveGridPanel",tpl:Ext.create("Ext.XTemplate",'<div id="_assessmentInactive" class="globalList" >','<table id="_assessmentInactiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th  colspan="8" style="text-align:left">護 理 評 估 <span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpAccessmentInactGridRefresh" type="button">重新整理</button></span></th>',"        </tr>","        <tr>",'            <th width="25%">問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">結束日期</th>','            <th width="15%">編輯</th>','            <th width="15%">瀏覽</th>','            <th width="15%">回復停用</th>',"","        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">','            <tpl if= "FormID != &quot;XAV5BNJXE33UHP2BJO6VHYNULQ&quot;"> ',"                ","                ","                <tr>",'                    <td width="25%" align="center">{Title} {[this.SubTitleStr(values)]}</td>','                    <td width="15%" align="center">{[this.StartDateStr(values)]}</td>','                    <td width="15%" align="center">{[this.DiscontinueDateStr(values)]}</td>','                    <td width="15%" align="center"><a id="btnView" name="inactivenursingplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">評估單張</a></td>','                    <td width="15%" align="center"><a id="btnView1" name="inactivenursingplanhistory" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">評估歷程</a></td>','                    <td width="15%" align="center"><a id="btnView2" name="deleUser" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">回復</a></td>',"                </tr>","            ","           </tpl>  ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="25%">問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">結束日期</th>','            <th width="15%">編輯</th>','            <th width="15%">瀏覽</th>','            <th width="15%">回復停用</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>",""," ","","","      ",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},DiscontinueDateStr:function(a){if(a.DiscontinueDate.substring(0,10)=="1753-01-01"){return""}else{return(a.DiscontinueDate.substring(0,16).replace("T","<br>")+'&nbsp;&nbsp;<span style="color:blue;font-size:small;">'+a.DiscontinueUserName+"</span>")}}}),layout:{type:"fit"},scrollable:"vertical",listeners:[{fn:function(b,a){if(Ext.getStore("sInpInactiveAssessmentRecord").getCount()<=0){NisTRApp.view.Nur.INP_Assessment.LoadInactiveAccessmentRecord(this.getRecord(),this)}},event:"painted"}]},{xtype:"container",title:"評估歷程",itemId:"NA_INP_AssessmentHistory",layout:{type:"fit"},items:[{xtype:"list",itemId:"NA_INP_History",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:Ext.create("Ext.XTemplate","<div>",'<span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span>',"</div>","<br>",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[this.MedicalDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>',"<br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Html} </pre></span>',"</div>",{MedicalDateFormat:function(b){var a=b.toString();return a.substring(0,16).replace("T"," ")}}),plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_Assessment.LoadFormHistory(this.getRecord(),this,"Assessment")},event:"painted"}]},{xtype:"container",title:"初診評估",itemId:"NA_INP_InitialAssessment",layout:{type:"fit"},items:[{xtype:"list",itemId:"NAINP_InitialAssessment",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>{Title}</div>"],plugins:[{type:"pullrefresh"}]}],listeners:[{fn:function(b,a){if(Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();if(Ext.getStore("sInpInitialRecordList").getCount()<=0){var d=Ext.getStore("sInpInitialRecordList");if(d.isLoading()){return}d.removeAll();d.getProxy().setExtraParams({ChartNo:e.data.ChartNo});d.load();d=null;delete d}e=null;delete e},event:"painted"}]}]}]}]}],listeners:[{fn:"onNA_INP_NewAssessmentListLeafItemTap",event:"leafitemtap",delegate:"#NA_INP_NewAssessmentList"},{fn:"onNA_INP_ActiveGridPanelUpdatedata",event:"updatedata",delegate:"#NA_INP_ActiveGridPanel"},{fn:"onNAINP_InitialAssessmentItemTap",event:"itemtap",delegate:"#NAINP_InitialAssessment"},{fn:"onContainerDestroy",event:"destroy"}]},onNA_INP_NewAssessmentListLeafItemTap:function(b,l,h,j,g,k,m){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var o=this.getRecord();var f,a,d;if(o.data.Source.Type==1){f="0";a=o.data.Source.Name;d=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){f=o.data.InpNO;a=o.data.Source.Name;d=0}else{Ext.Msg.alert("NurAssessment 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,d,"","","_ReloadInpAccessmentData","",f,a);NisTRApp.view.Nur.INP_Assessment.OpenAssessmentForm(n,g.data.formID);n=null;delete n;f=null;a=null;d=null;delete f;delete a;delete d},onNA_INP_ActiveGridPanelUpdatedata:function(a,d,b){if(Ext.getStore("sInpAssessmentRecord").getCount()<=0){NisTRApp.view.Nur.INP_Assessment.LoadActiveAccessmentRecord(this.getRecord(),this)}},onNAINP_InitialAssessmentItemTap:function(b,f,g,d,h,j){if(Ext.isEmpty(this.getRecord())){return}var n=this.getRecord();if(d.data.Ordseq==1||d.data.Ordseq==3){var m=NisTRApp.view.FormUtil.AssessmentAddr("CRenderAssesment",d.data.FormId,NisTRApp.view.SysUtility.GetUserID(),n.data.ChartNo,n.data.ChartSeq,d.data.CategoryId,d.data.OpenRecordId,"_ReloadInpAccessmentData","",n.data.InpNo,"");if(NisTRApp.view.SysUtility.IsProtalDevice()){NisTRApp.view.Misc.createPortalContent(m,_ReloadInpAccessmentData)}else{NisTRApp.view.Nur.INP_Assessment.OpenAssessmentForm(m)}m=null;delete m}else{if(d.data.Ordseq==2){var a,k,m;a=NisTRApp.view.SysUtility.GetUserID();k=n.data.PatIdNo;if(null==a||""==a){a="003549"}m="http://edsweb.kfcc.intra/Evaluate/eva_search.aspx?userid="+a+"&pat_idno="+k;var l=document.createElement("a");l.href=m;if(NisTRApp.view.SysUtility.IsProtalDevice()){l.click()}else{window.open(m)}m=null;delete m;a=null;delete a;k=null;delete a}}n=null;delete k},onContainerDestroy:function(a){if(Ext.getStore("sInpAssessmentRecord")!=null){Ext.getStore("sInpAssessmentRecord").removeAll();Ext.getStore("sInpAssessmentRecord").destroy()}if(Ext.getStore("sInpInactiveAssessmentRecord")!=null){Ext.getStore("sInpInactiveAssessmentRecord").removeAll();Ext.getStore("sInpInactiveAssessmentRecord").destroy()}if(Ext.getStore("sInpAssessmentHistory")!=null){Ext.getStore("sInpAssessmentHistory").removeAll();Ext.getStore("sInpAssessmentHistory").destroy()}if(Ext.getStore("sInpInitialRecordList")!=null){Ext.getStore("sInpInitialRecordList").removeAll();Ext.getStore("sInpInitialRecordList").destroy()}if(!Ext.isEmpty(Ext.getCmp("_inpAssessmentFormPanel"))){Ext.getCmp("_inpAssessmentFormPanel").destroy()}_callAssessFn=null;delete _callAssessFn;_callInaAssessFn=null;delete _callInaAssessFn;_ReloadInpAccessmentData=null;delete _ReloadInpAccessmentData;console.log("On Destroy","Nur.INP_Assessment");this.removeAll(true,true)},initialize:function(){this.callParent();_ReloadInpAccessmentData=function(a){try{if(!Ext.isEmpty(Ext.getStore("sInpAssessmentRecord"))){Ext.getStore("sInpAssessmentRecord").load()}if(null!=a&&undefined!=a&&"TempSave"==a){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_inpAssessmentFormPanel"))){Ext.getCmp("_inpAssessmentFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NA_INP_MainPanel")[0])){Ext.ComponentQuery.query("#NA_INP_MainPanel")[0].show()}}}catch(b){console.error("_ReloadInpAccessmentData",b)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("INP_Asment 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("INP_Asment 住院病人資料錯誤");return false}if(this.getRecord().data.Source.Type!=2){Ext.Msg.alert("INP_Asment 不支援門診病人");return false}if(Ext.isEmpty(Ext.getStore("sNewInpAssessmentRecord"))){Ext.create("Ext.data.TreeStore",{storeId:"sNewInpAssessmentRecord",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Assessment",Source:this.getRecord().data.Source.Name},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NA_INP_NewAssessmentList").setStore(Ext.getStore("sNewInpAssessmentRecord"));if(Ext.getStore("sNewInpAssessmentRecord").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sInpAssessmentRecord"))){Ext.create("Ext.data.Store",{storeId:"sInpAssessmentRecord",model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sInpAssessmentRecord").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpAssessmentRecord").addListener("load",function(d,b,f,a,e){NisTRApp.view.Nur.INP_Assessment.RenderActTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NA_INP_ActiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInpInactiveAssessmentRecord"))){Ext.create("Ext.data.Store",{storeId:"sInpInactiveAssessmentRecord",model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sInpInactiveAssessmentRecord").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpInactiveAssessmentRecord").addListener("load",function(d,b,f,a,e){NisTRApp.view.Nur.INP_Assessment.RenderInactTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NA_INP_InactiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInpAssessmentHistory"))){Ext.create("Ext.data.Store",{storeId:"sInpAssessmentHistory",model:"NisTRApp.model.EMR.FormRecord",pageSize:5,clearOnPageLoad:false,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/PtFormHistory.ashx",reader:{type:"json",rootProperty:"MasterID"},sorters:{direction:"DESC",property:"MedicalDate"}}})}this.down("#NA_INP_AssessmentHistory").setRecord(this.getRecord());this.down("#NA_INP_History").setStore(Ext.getStore("sInpAssessmentHistory"));if(Ext.isEmpty(Ext.getStore("sInpInitialRecordList"))){Ext.create("Ext.data.Store",{storeId:"sInpInitialRecordList",autoLoad:false,model:"NisTRApp.model.Form.InitialRecordItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/InitialRecordList.ashx",reader:{type:"json"}}})}this.down("#NA_INP_InitialAssessment").setRecord(this.getRecord());this.down("#NAINP_InitialAssessment").setStore(Ext.getStore("sInpInitialRecordList"))},LoadListItem:function(){if(Ext.getStore("sNewInpAssessmentRecord").isLoading()||Ext.isEmpty(this.getRecord())){return false}var a=Ext.getStore("sNewInpAssessmentRecord");a.removeAll();a.load();a=null;delete a;return false}});Ext.define("NisTRApp.view.MgrUtil",{extend:Ext.Base,statics:{DrugTimeFormat:function(a,b){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b[0])){return String.format("{0}-{1}</br>{2}:00",b[0]["DrugInfo"+a].DrugTimeMap.MM,b[0]["DrugInfo"+a].DrugTimeMap.DD,b[0]["DrugInfo"+a].DrugTimeMap.TimeGroup)}return""},TextVal:function(a){if(!Ext.isEmpty(a)){return'"'+a+'"'}else{return""}},OrderEndColor:function(a){if(a.IsOrderEnd==true){return"#999"}else{if(a.ChmLevCode=="CHM"){return"#d2f7d2"}else{return""}}},OrddHtmlStrFormat:function(e,b,d){var a="";if(e.toString().length==0){a=b}else{if(e.indexOf("<BR>")>0&&e.substring(e.indexOf("<BR>")+4,1000).indexOf("<BR>")>0){a=e.substring(0,e.indexOf("<BR>")+(e.substring(e.indexOf("<BR>")+4,1000).indexOf("<BR>")+4))+"</Div><Div><img class='imgFullOrdd' src='../_/img/find.png' style='width:16px;height:16px;'></Div>"}else{a=e}}if(d.Route=="IVF"&&d.CodeNo.substring(0,1)=="B"&&(d.Frequency=="STAT"||d.Frequency=="OTO")&&d.Fluidcnt!=0&&d.BagCount!=0){a+='<span style="font-weight:bold;background-color:yellow;">'+d.Fluidcnt+"/"+d.BagCount+"</span>"}return a},BegDateTimeFormat:function(a,b){return'"'+String.format("{0}-{1}-{2} {3}:{4}",a.substr(0,4),a.substr(4,2),a.substr(6,2),(Ext.isEmpty(b)?"00":b.substr(0,2)),(Ext.isEmpty(b)?"00":b.substr(2,2)))+'"'},PreExeDateFormat:function(a){return a.substring(5,16).replace("T","<br>")},PrnAoFormat:function(a){if(a.IsActive==true&&a.MbdFlag!="Y"&&(a.IsChangeTime==false||(a.IsChangeTime==true&&a.DrugInfo1.DrugTimeMap.IsNeedMedication==false&&a.DrugInfo2.DrugTimeMap.IsNeedMedication==false&&a.DrugInfo3.DrugTimeMap.IsNeedMedication==false))&&(a.Frequency=="OTO"||a.IsAo==true||a.IsPrn==true||a.MajorClass=="01"||a.MajorClass=="02"||a.OrderType=="CH"||(a.IsBottle==true&&a.IsQD==true)||(a.IsIplusB==true&&a.IsAo==true))){return"<img  src='../_/img/blueClock.png' style='width:32px;height:32px;'>"}else{return""}},PrnAoClass:function(a){if(!Ext.isEmpty(NisTRApp.view.MgrUtil.PrnAoFormat(a))){return"action"}else{return""}},FreqTimeShiftFormat:function(a){if(a.IsActive==true&&a.MbdFlag!="Y"&&(a.IsChangeTime==true&&a.IsStat==false)){return'<img  src="../_/img/redDownload.png" style="width:32px;height:32px;">'}else{if(a.IsActive==true&&a.MbdFlag!="Y"&&(a.IsChangeTime==false&&a.IsStat==false)){return'<img  src="../_/img/blueDownload.png" style="width:32px;height:32px;">'}else{if(a.IsActive==false&&a.MbdFlag!="Y"&&a.IsOrderEnd==false){return'<span style="color:red; font-size:large;">預</span>'}else{return""}}}},FreqTimeClass:function(a){if(!Ext.isEmpty(NisTRApp.view.MgrUtil.FreqTimeShiftFormat(a))){return"freqTimeShift"}else{return""}},OverTimeFormat:function(a){if(a.IsActive==true&&a.MbdFlag!="Y"&&a.IsOverTime==true){return"<img id='Img' src='../_/img/redClock.png' style='width:32px;height:32px;' class='actionDelay'>"}else{return""}},OverTimeClass:function(a){if(a.IsActive==true&&a.MbdFlag!="Y"&&a.IsOverTime==true){return"action"}else{return""}},DrugOneFormat:function(b,a){var d=b["DrugInfo"+a].DrugTimeMap.YYYY+b["DrugInfo"+a].DrugTimeMap.MM+b["DrugInfo"+a].DrugTimeMap.DD+b["DrugInfo"+a].DrugTimeMap.TimeGroup+"00";if(b.IsActive==true&&b.MbdFlag!="Y"&&(true==b["DrugInfo"+a].HasDruglogs)){return"<input type='hidden' id='timeBlock' value='"+d+"'><img src='../_/img/checkBlue.png' style='width:32px;height:32px;'>"}else{if(b.IsActive==true&&b.MbdFlag!="Y"&&(true==b["DrugInfo"+a].DrugTimeMap.IsNeedMedication)){return"<input type='hidden' id='timeBlock' value='"+d+"'><img src='../_/img/blueClock.png' style='width:32px;height:32px;'>"}else{return""}}},DrugOneClass:function(b,a){if(b.IsActive==true&&b.MbdFlag!="Y"&&(true==b["DrugInfo"+a].HasDruglogs)){return"action"}else{if(b.IsActive==true&&b.MbdFlag!="Y"&&(true==b["DrugInfo"+a].DrugTimeMap.IsNeedMedication)){return"action"}else{return""}}},TimeBlock:function(b,a){return b["DrugInfo"+a].DrugTimeMap.YYYY+b["DrugInfo"+a].DrugTimeMap.MM+b["DrugInfo"+a].DrugTimeMap.DD+b["DrugInfo"+a].DrugTimeMap.TimeGroup+"00"},StatFormat:function(a){if(a.IsStat==true){return"<img src='../_/img/blueClock.png' style='width:32px;height:32px;'>"}else{return""}},StatClass:function(a){if(a.IsStat==true){return"action"}else{return""}},CanSetStopFormat:function(a){if(a.SeqNo==9998){return'<img src="../_/img/blueTrash.png" style="width:32px;height:32px;">'}else{return""}},CanSetStopClass:function(a){if(a.SeqNo==9998){return"nurseStop"}else{return""}},CanCallDrugFormat:function(a){if(a.NurseCallDrugFlag==true&&a.ErcarDrugListFlag==true){return'<img  src="../_/img/blueCross.png" style="width:32px;height:32px;" >'}else{if(a.NurseCallDrugFlag==true&&a.ErcarDrugListFlag==false){return'<img  src="../_/img/blueCross.png" style="width:32px;height:32px;" >'}else{if(a.NurseCallDrugFlag==false&&a.ErcarDrugListFlag==true){return'<img  src="../_/img/blueCross.png" style="width:32px;height:32px;" >'}else{return""}}}},CanCallDrugClass:function(a){if(!Ext.isEmpty(NisTRApp.view.MgrUtil.CanCallDrugFormat(a))){return"call"}else{return""}},ScheduleDateFormat:function(a){if(a.ScheDateTime.substring(0,10)!="1753-01-01"&&a.MbdFlag!="Y"){if(a.IsNurSchedule==true&&a.ScheTimeslot==""){return a.ScheDateTime.substring(5,16).replace("T","<br>")}else{if(a.IsNurSchedule==true&&a.ScheTimeslot!=""){return a.ScheDateTime.substring(5,10)+"</br>"+a.ScheTimeslot}}}else{if(a.MinorClass=="XR"&&a.MbdFlag!="Y"){return a.PreExamDateTime.substring(5,10)}}},Action:function(b,d,l,j,e){if(Ext.getStore("sActiveOrder").isLoading()||Ext.getStore("sActiveOrder").getCount()<=0){return}if($(e).attr("timeblock")==undefined||$(e).attr("timeblock")==null||$(e).attr("timeblock")==""){NisTRApp.view.Misc.Alert("給藥時段錯誤!",1000);return}if(($("#_orderOrderExecTable tr[isSelect='true']").length>0)&&!Ext.isEmpty(Ext.getCmp("CanMutiExe"))&&(Ext.getCmp("CanMutiExe").getValue()=="true")&&j.CodeNo.substring(0,1)!="O"&&j.CodeNo!="[SELF]"&&j.Route!="PO"){NisTRApp.view.Misc.Alert("口服藥品與其他藥品不可同時備藥!",1000);return}if(j.IsOP==true&&(j.CodeNo.substring(0,1)=="O"||j.Route=="[SELF]"||j.Route=="PO")&&!Ext.isEmpty(Ext.getCmp("CanMutiExe"))&&(Ext.getCmp("CanMutiExe").getValue()=="true")&&!Ext.isEmpty(Ext.getCmp("MGR_ORD_TimeBlock"))){if(Ext.getCmp("MGR_ORD_TimeBlock").getValue()==""){Ext.getCmp("MGR_ORD_TimeBlock").setValue($(e).attr("timeblock"))}else{if(Ext.getCmp("MGR_ORD_TimeBlock").getValue()!=$(e).attr("timeblock")&&$(e).parent("tr").attr("isSelect")!="true"){NisTRApp.view.Misc.Alert("無法備不同時段的藥品!",1000);return}}var g=$(e).parent("tr").children("td").length;var m='background-color:"";';if($(e).parent("tr").attr("isSelect")==undefined||$(e).parent("tr").attr("isSelect")!="true"){$(e).parent("tr").attr("isSelect","true");m="background-color:#F90;"}else{if($(e).parent("tr").attr("isSelect")=="true"){$(e).parent("tr").attr("isSelect","false");m='background-color:"";'}}for(var h=0;h<g;h++){if($($(e).parent("tr").children("td")[h]).css("display")!="none"){$($(e).parent("tr").children("td")[h]).attr("style",m)}}g=null;delete g;m=null;delete m;if($("#_orderOrderExecTable tr[isSelect='true']").length<=0){Ext.getCmp("MGR_ORD_TimeBlock").setValue("")}}else{if(j.IsEsam||j.IsEsam=="true"){var f=$("#_orderOrderExecTable tr[accessnum='"+j.Accessnum+"']");if(f.length>0){var k=Ext.getStore("sActiveOrder");var a=[];f.each(function(n,o){var n=k.getAt(0).orders().find("OrddRid",$(o).attr("orddrid"));if(n>=0){a.push(k.getAt(0).orders().getAt(n).raw)}});NisTRApp.view.MgrUtil.OpenOrdCheckPanel(a,d,l,$(e).attr("timeblock"));a=null;delete a;k=null;delete k}f=null;delete f}else{NisTRApp.view.MgrUtil.OpenOrdCheckPanel([j],d,l,$(e).attr("timeblock"))}}k=null;delete k},OpenOrdCheckPanel:function(e,d,f,b){var g=Ext.getCmp("_inpOrdCheckPanel");if(!Ext.isEmpty(g)){g.destroy()}if(Ext.isEmpty(g)){g=Ext.create("NisTRApp.view.Management.OrderCheckPanel",{id:"_inpOrdCheckPanel",record:f,exeOrders:e,timeBlock:b})}if(!Ext.isEmpty(g)){var a=Ext.ComponentQuery.query("#MGR_ORD_MainPanel")[0];g.setCaller(d);g.setCloseFn(function(j,k){var h=null;if(!Ext.isEmpty(k)&&k==true){h=j.down("#MGR_ORD_ExecuteRefBtn")}else{h=j.down("#MGR_ORD_HeadBarGroup").getActiveItem()}if(!Ext.isEmpty(h)){h.fireEvent("tap",h,null,null)}h=null;delete h;j.down("#MGR_ORD_MainPanel").setHidden(false)});Ext.ComponentQuery.query("#MGR_ORD_Main")[0].animateActiveItem(g,{type:"slide",direction:"right"});a.setHidden(true);g.show();a=null;delete a}g=null;delete g;f=null;delete f},FreqTimeShiftSetting:function(a,b){if(Ext.isEmpty(a)||Ext.isEmpty(b)){return false}var f=function(e){if(!Ext.isEmpty(e)&&Ext.isFunction(e.StaticLoadActiveOrd)){e.StaticLoadActiveOrd()}};try{if(!Ext.isEmpty(Ext.getCmp("_mgrFreqTimeSettingPanel"))){Ext.getCmp("_mgrFreqTimeSettingPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_mgrFreqTimeSettingPanel"))){var d=Ext.create("NisTRApp.view.Management.FreqTimeSettingPanel",{id:"_mgrFreqTimeSettingPanel",successFn:f,record:a,caller:b});b.overlay=Ext.Viewport.add(d);d=null;delete d}b.overlay.show()}catch(g){console.log(g)}f=null;delete f;return},NurseStop:function(a,b){if(Ext.isEmpty(a)||Ext.isEmpty(b)){return false}var d=function(e){if(!Ext.isEmpty(e)&&Ext.isFunction(e.StaticLoadActiveOrd)){e.StaticLoadActiveOrd()}e=null;delete e};Ext.Msg.confirm("Confirm","請確認是否停用此醫令?",function(f,g,e){if(f=="no"){d=null;delete d;return}else{if(f=="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/NursingOrderDC.ashx",useDefaultXhrHeader:false,method:"POST",scope:b,params:{InpNo:a.data.InpNo,OrddRid:a.data.OrddRid,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(h){var j=Ext.decode(h.responseText);NisTRApp.view.Misc.Alert(j.Message,(j.Success?800:0));if(j.Success&&Ext.isFunction(d)){d(b)}j=null;delete j;d=null;delete d;b=null;delete b;a=null;delete a},failure:function(){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b;a=null;delete a;d=null;delete d}})}}},b)},OverlayOrder:function(b,d,g){if(Ext.isEmpty(b)||Ext.isEmpty(d)||Ext.isEmpty(g)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_mgrOrderInfoPanel"))){Ext.getCmp("_mgrOrderInfoPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_mgrOrderInfoPanel"))){var a=Ext.create("NisTRApp.view.Management.OrderInfoPanel",{id:"_mgrOrderInfoPanel",record:b,patInfo:g,caller:d});d.overlay=Ext.Viewport.add(a);a=null;delete a}d.overlay.show()}catch(f){console.log(f)}return},CallDrug:function(a,b,d){if(Ext.isEmpty(a)||Ext.isEmpty(b)||Ext.isEmpty(d)){return false}b.setMasked({xtype:"loadmask",message:"Loading..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/Search/UDChecker.ashx",scope:this,method:"POST",params:{InpNo:a.data.InpNo,CodeNo:a.data.CodeNo},success:function(f){b.setMasked(false);var j=Ext.decode(f.responseText);if(undefined!=j.Success&&j.Success==true){try{if(!Ext.isEmpty(Ext.getCmp("_mgrCallDrugPanel"))){Ext.getCmp("_mgrCallDrugPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_mgrCallDrugPanel"))){var g=Ext.create("NisTRApp.view.Management.CallDrugPanel",{id:"_mgrCallDrugPanel",record:a,drugUnit:j.DrugUnit,caller:b});b.overlay=Ext.Viewport.add(g);g=null;delete g}b.overlay.show()}catch(h){console.log(h)}return}else{if(undefined!=j.Success&&j.Success==false){Ext.Msg.alert(j.Msg)}}},failure:function(){this.setMasked(false)}},b)},DoseFormat:function(b){var a="";if(b.OrderType=="CH"){a=""}else{a=b.NewDose}return'<div style="width:100%; height:100%; font-weight: bold; background-color:PaleGoldenrod; color:black;">'+a+"</div>"},DoseUnitFormat:function(a){if(a.OrderType=="CH"){return""}else{return a.NewDoseUnit}},LastDrugDateFormat:function(a){if(a.LastDrugDate.substring(0,10)!="1753-01-01"){return a.LastDrugDate.replace("T"," ")}else{return""}}},config:{}});Ext.define("NisTRApp.view.Management.OrderExcute",{extend:Ext.Container,alias:"widget.OrderExcute",statics:{RenderTable:function(d,j,g){_callMgrFn=function(o,l,m,n){var k=Ext.getStore("sActiveOrder").getAt(0).orders().find("OrddRid",$(o).parent("tr").attr("orddrid"));if(k>=0){n(Ext.getStore("sActiveOrder").getAt(0).orders().getAt(k),l,m,Ext.getStore("sActiveOrder").getAt(0).orders().getAt(k).raw,o)}k=null;delete k};if(Ext.getStore("sActiveOrder").isLoading()||Ext.isEmpty(j)){return}var b=Ext.getStore("sActiveOrder");d.down("#MGR_ORD_MainPanel").setHtml("");if(b.getCount()>0){d.down("#MGR_ORD_MainPanel").setHtml("");var f=d.down("#MGR_ORD_MainPanel").getTpl().apply(Ext.getStore("sActiveOrder").getAt(0).data);d.down("#MGR_ORD_MainPanel").setHtml(f);var h=d;var a=NisTRApp.view.SysUtility.tapEventName();$(".action").bind(a,function(){_callMgrFn(this,h,j,NisTRApp.view.MgrUtil.Action)});$(".freqTimeShift").bind(a,function(){_callMgrFn(this,h,j,NisTRApp.view.MgrUtil.FreqTimeShiftSetting)});$(".nurseStop").bind(a,function(){_callMgrFn(this,h,j,NisTRApp.view.MgrUtil.NurseStop)});$(".orderSpec").bind(a,function(){_callMgrFn(this,h,j,NisTRApp.view.MgrUtil.OverlayOrder)});$(".call").bind(a,function(){_callMgrFn(this,h,j,NisTRApp.view.MgrUtil.CallDrug)});if(!Ext.isEmpty(g)){g.fireEvent("tap",g,null,null)}else{if(!Ext.isEmpty(d)){d.down("#OrderAllBtn").fireEvent("tap",d.down("#OrderAllBtn"),null,null)}}f=null;delete f;a=null;delete a}var e=Ext.getStore("sActiveOrder").getAt(0).data;d.down("#OrderLabBtn").setBadgeText("");if(e.ScheCnt>0){d.down("#OrderLabBtn").setBadgeText(e.ScheCnt)}d.down("#OrderOutBtn").setHidden(e.MbdCnt<=0);d.down("#OrderCTBtn").setHidden(e.ChemoCnt<=0);d.down("#OrderPCABtn").setHidden(e.PcaCnt<=0);d.down("#OrderOpCTBtn").setHidden(e.OpChemoCnt<=0);d.down("#OrderLabBtn").setHidden(e.LabCnt<=0);d.down("#OrderAllBtn").setBadgeText((e.AllStatCnt>0?"stat":""));d.down("#OrderTreatBtn").setBadgeText((e.TreatStatCnt>0?"stat":""));d.down("#OrderLabBtn").setBadgeText((e.LabStatCnt>0?"stat":""));d.down("#OrderCTBtn").setBadgeText((e.ChemoStatCnt>0?"stat":""));d.down("#OrderOpCTBtn").setBadgeText((e.OpChemoStatCnt>0?"stat":""));d.down("#OrderPCABtn").setBadgeText((e.PcaStatCnt>0?"stat":""));d.down("#OrderDrugOralBtn").setBadgeText((e.DrugStatCnt>0?"stat":""));d.down("#OrderDrugBIBtn").setBadgeText((e.BIStatCnt>0?"stat":""));d=null;delete d;g=null;delete g;b=null;delete b;e=null;delete e}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"MGR_ORD_Main",layout:{type:"fit"},items:[{xtype:"panel",html:"",itemId:"MGR_ORD_MainPanel",tpl:["","",'<div id="_orderOrderExec" class="globalList" ><input type="hidden" id="_hiddenType"><input type="hidden" id="_hiddenOrddrid"><input type="hidden" id="_hiddenIsMulti"><input type="hidden" id="_hiddenMultiOrddrid"><input type="hidden" id="_hiddenMultiCodeNo"><input type="hidden" id="_hiddenOrddFullHtml"><input type="hidden" id="_hiddenMultiTimeBlock">','<table id="_orderOrderExecTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>",'        <tr class="FixedHeaderRow1">','            <th align="center" style="width: 6%; display: none;">分類</th>','            <th align="center" style="width:49%;">ACTIVE ORDER</th>','            <th align="center" style="width:5%">預定<br>日期</th>','            <th align="center" style="width: 5%; display: table-cell;" nowrap="">PRN<br>AO</th>','            <th align="center" style="width: 5%; display: table-cell;">設定<br>時段</th>','            <th align="center" style="width: 5%; display: table-cell;">逾期</th>','            <th align="center" style="width: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugTimeFormat(1,values.Orders)]}</th>','            <th align="center" style="width: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugTimeFormat(2,values.Orders)]}</th>','            <th align="center" style="width: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugTimeFormat(3,values.Orders)]}</th>','            <th style="width: 5%; display: table-cell;">Stat</th>','            <th style="width: 5%; display: none;">停用</th>','            <th style="width: 5%; display: table-cell;">叫藥</th>','            <th style="width: 5%; display: none;">排程<br>日期</th>','            <th style="width: 5%; display: none;">檢查單號</th>',"        </tr>","    </thead>","  ","    <tbody>","    ",'    <tpl for="Orders">',"		",'        <tr seqno="{SeqNo}" majorclass="{MajorClass}" chemo="{Chemo}" orddrid="{OrddRid}" begdate="{BegDate}" frequency="{Frequency}"  IsOP="{IsOP}" IsBottleInjection="{IsBottleInjection}"  activeorder={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]} orddtextstr={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]} codeno="{CodeNo}" isstat="{IsStat}" medflag="{MbdFlag}" accessnum="{Accessnum}" originalDrugTime="{OriginalDrugTime}" drugtime="{DrugTime}" ordertype="{OrderType}" dblchkflag="{DblchkFlag}">',"",'            <td align="center" style="width: 6%; display: none;">{MajorClassName}</td>','            <td align="left"   style="widtd:49%; background-color:{[NisTRApp.view.MgrUtil.OrderEndColor(values)]} !important;" id="orderHtml" title={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]}  class="orderSpec" begDateTime={[NisTRApp.view.MgrUtil.BegDateTimeFormat(values.BegDate,values.BegTime)]} begUser={CreUserName} >{[NisTRApp.view.MgrUtil.OrddHtmlStrFormat(values.OrddHtml,values.OrddTxt,values)]}</td>','            <td align="center" style="widtd:5%" nowrap=""><div title={CreUserName}>{[NisTRApp.view.MgrUtil.PreExeDateFormat(values.PreExamDateTime)]}</div></td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.PrnAoClass(values)]}" timeblock="PrnAo" style="widtd: 5%; display: table-cell;" nowrap="">{[NisTRApp.view.MgrUtil.PrnAoFormat(values)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.FreqTimeClass(values)]}"  style="widtd: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.FreqTimeShiftFormat(values)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.OverTimeClass(values)]}" timeblock="OverTime" style="widtd: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.OverTimeFormat(values)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.DrugOneClass(values,1)]}" timeblock="{[NisTRApp.view.MgrUtil.TimeBlock(values,1)]}" style="widtd: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugOneFormat(values,1)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.DrugOneClass(values,2)]}" timeblock="{[NisTRApp.view.MgrUtil.TimeBlock(values,2)]}" style="widtd: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugOneFormat(values,2)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.DrugOneClass(values,3)]}" timeblock="{[NisTRApp.view.MgrUtil.TimeBlock(values,3)]}" style="widtd: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugOneFormat(values,3)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.StatClass(values)]}"  timeblock="Stat" style="widtd: 5%; display: table-cell;" orddrid="{OrddRid}">{[NisTRApp.view.MgrUtil.StatFormat(values)]}</td>','            <td align="center" class=\'{[NisTRApp.view.MgrUtil.CanSetStopClass(values)]}\' style="widtd: 5%; display: none;"  orddrid="{OrddRid}"> {[NisTRApp.view.MgrUtil.CanSetStopFormat(values)]}</td>','            <td align="center" class="{[NisTRApp.view.MgrUtil.CanCallDrugClass(values)]}" style="widtd: 5%; display: table-cell;"  type="both" orddrid="{OrddRid}" codeno="{CodeNo}">{[NisTRApp.view.MgrUtil.CanCallDrugFormat(values)]}</td>','            <td style="widtd: 5%; display: none;">{[NisTRApp.view.MgrUtil.ScheduleDateFormat(values)]}</td>','            <td style="widtd: 5%; display: none;">{Accessnum}</td>',"         </tr>","        ","	</tpl>","        ","    </tbody>","    ","	<tfoot>",'        <tr class="FixedHeaderRow2">','            <th align="center" style="width: 6%; display: none;">分類</th>','            <th align="center" style="width:49%;">ACTIVE ORDER</th>','            <th align="center" style="width:5%">預定<br>日期</th>','            <th align="center" style="width: 5%; display: table-cell;" nowrap="">PRN<br>AO</th>','            <th align="center" style="width: 5%; display: table-cell;">設定<br>時段</th>','            <th align="center" style="width: 5%; display: table-cell;">逾期</th>','            <th align="center" style="width: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugTimeFormat(1,values.Orders)]}</th>','            <th align="center" style="width: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugTimeFormat(2,values.Orders)]}</th>','            <th align="center" style="width: 5%; display: table-cell;">{[NisTRApp.view.MgrUtil.DrugTimeFormat(3,values.Orders)]}</th>','            <th style="width: 5%; display: table-cell;">Stat</th>','            <th style="width: 5%; display: none;">停用</th>','            <th style="width: 5%; display: table-cell;">叫藥</th>','            <th style="width: 5%; display: none;">排程<br>日期</th>','            <th style="width: 5%; display: none;">檢查單號</th>',"        </tr>","    </tfoot>    ","","</table>","    ","</div>",""," "],scrollable:"vertical",items:[{xtype:"hiddenfield",id:"CanMutiExe",itemId:"",value:false},{xtype:"hiddenfield",id:"MGR_ORD_TimeBlock"},{xtype:"toolbar",docked:"bottom",itemId:"MGR_OrderExcuteFootBar",items:[{xtype:"button",itemId:"MGR_BeginCancelBtn",left:"1px",ui:"confirm-back",width:"47%",text:"取 消"},{xtype:"button",itemId:"MGR_BeginPrepareBtn",right:"1px",ui:"confirm-forward",width:"47%",text:"開 始 備 藥"}]}]}]},{xtype:"toolbar",docked:"top",itemId:"MGR_ORD_HeadBar",items:[{xtype:"panel",hidden:false,id:"MGR_ORD_HeadBarGroup",itemId:"MGR_ORD_HeadBarGroup",minHeight:"2.6em",width:"78%",layout:{type:"hbox"},items:[{xtype:"button",itemId:"OrderDrugBIBtn",width:"11%",text:"點滴/針劑"},{xtype:"button",itemId:"OrderDrugOralBtn",width:"11%",text:"口服/外用"},{xtype:"button",itemId:"OrderTreatBtn",width:"11%",text:"醫療指示"},{xtype:"button",itemId:"OrderLabBtn",width:"11%",text:"檢驗檢查"},{xtype:"button",itemId:"OrderAllBtn",width:"11%",text:"全部"},{xtype:"button",itemId:"OrderOutBtn",width:"11%",text:"出院用"},{xtype:"button",itemId:"OrderCTBtn",width:"11%",text:"化療"},{xtype:"button",itemId:"OrderOpCTBtn",width:"11%",text:"口服化療"},{xtype:"button",itemId:"OrderPCABtn",width:"11%",text:"PCA"}]},{xtype:"button",itemId:"MGR_ORD_ExecuteRefBtn",minHeight:"1.9em",right:"0.3%",ui:"decline",width:"15%",iconCls:"refresh",text:"重新整理"}]}],listeners:[{fn:"onMGR_ORD_MainUpdatedata",event:"updatedata",delegate:"#MGR_ORD_MainPanel"},{fn:"onMGR_BeginCancelBtnTap",event:"tap",delegate:"#MGR_BeginCancelBtn"},{fn:"onMGR_BeginPrepareBtnTap",event:"tap",delegate:"#MGR_BeginPrepareBtn"},{fn:"onOrderDrugBIBtnTap",event:"tap",delegate:"#OrderDrugBIBtn"},{fn:"onOrderDrugOralBtnTap",event:"tap",delegate:"#OrderDrugOralBtn"},{fn:"onOrderTreatBtnTap",event:"tap",delegate:"#OrderTreatBtn"},{fn:"onOrderLabBtnTap",event:"tap",delegate:"#OrderLabBtn"},{fn:"onOrderAllBtnTap",event:"tap",delegate:"#OrderAllBtn"},{fn:"onOrderOutBtnTap",event:"tap",delegate:"#OrderOutBtn"},{fn:"onOrderCTBtnTap",event:"tap",delegate:"#OrderCTBtn"},{fn:"onOrderOpCTBtnTap",event:"tap",delegate:"#OrderOpCTBtn"},{fn:"onOrderPCABtnTap",event:"tap",delegate:"#OrderPCABtn"},{fn:"onMGR_ORD_ExecuteRefBtnTap",event:"tap",delegate:"#MGR_ORD_ExecuteRefBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onMGR_ORD_MainUpdatedata:function(a,d,b){this.LoadActiveOrders(this.getRecord(),this,this.down("#OrderDrugBIBtn"))},onMGR_BeginCancelBtnTap:function(d,f,b){var a=this.down("#MGR_ORD_HeadBarGroup").getActiveItem();if(!Ext.isEmpty(a)){a.fireEvent("tap",a,null,null)}a=null;delete a},onMGR_BeginPrepareBtnTap:function(d,f,b){if(Ext.getStore("sActiveOrder").isLoading()||Ext.getStore("sActiveOrder").getCount()<=0){return}if($("#_orderOrderExecTable tr[isSelect='true']").length<=0){NisTRApp.view.Misc.Alert("您尚未選擇備藥藥品!",1000);return}if(Ext.getCmp("MGR_ORD_TimeBlock").getValue()==""){NisTRApp.view.Misc.Alert("給藥時段錯誤!",1000);return}var a=Ext.getStore("sActiveOrder");var g=[];$("#_orderOrderExecTable tr[isSelect='true']").each(function(e,h){var e=a.getAt(0).orders().find("OrddRid",$(h).attr("orddrid"));if(e>=0){g.push(a.getAt(0).orders().getAt(e).raw)}});NisTRApp.view.MgrUtil.OpenOrdCheckPanel(g,this,this.getRecord(),Ext.getCmp("MGR_ORD_TimeBlock").getValue());a=null;delete a;g=null;delete g},onOrderDrugBIBtnTap:function(b,d,a){this.ButtonSelect(b);if($("#_orderOrderExecTable th:eq(11)")!=null){$("#_orderOrderExecTable th:eq(11)").show();$("#_orderOrderExecTable tbody tr").each(function(){$(this).children("td:eq(11)").show();if($(this).attr("IsBottleInjection")=="true"){$(this).show()}else{$(this).hide()}});$("#_orderOrderExecTable tfoot tr th:eq(11)").show()}},onOrderDrugOralBtnTap:function(b,d,a){this.ButtonSelect(b);if($("#_orderOrderExecTable th:eq(11)")!=null){$("#_orderOrderExecTable th:eq(11)").show();$("#_orderOrderExecTable tbody tr").each(function(){$(this).children("td:eq(11)").show();if($(this).attr("IsOP")=="true"){$(this).show()}else{$(this).hide()}});$("#_orderOrderExecTable tfoot tr th:eq(11)").show()}if(!Ext.isEmpty(Ext.getCmp("CanMutiExe"))){Ext.getCmp("CanMutiExe").setValue(true)}},onOrderTreatBtnTap:function(b,d,a){this.ButtonSelect(b);if($("#_orderOrderExecTable th:eq(10)")!=null){$("#_orderOrderExecTable th:eq(10)").show();$("#_orderOrderExecTable tbody tr").each(function(){$(this).children("td:eq(10)").show();if($(this).attr("majorclass")!="0"||$(this).attr("ordertype")=="CH"||$(this).attr("ordertype")=="PC"||$(this).attr("medflag")=="Y"){$(this).hide()}else{$(this).show()}});$("#_orderOrderExecTable tfoot tr th:eq(10)").show()}},onOrderLabBtnTap:function(b,d,a){this.ButtonSelect(b);$("#_orderOrderExecTable th:eq(9)").hide();$("#_orderOrderExecTable tbody tr").each(function(){$(this).children("td:eq(9)").hide()});$("#_orderOrderExecTable tfoot tr th:eq(9)").hide();$("#_orderOrderExecTable th:eq(12)").show();$("#_orderOrderExecTable tbody tr").each(function(){$(this).children("td:eq(12)").show();if($(this).attr("majorclass")=="0"||$(this).attr("majorclass")=="00"||$(this).attr("ordertype")=="CH"||$(this).attr("ordertype")=="PC"||$(this).attr("medflag")=="Y"){$(this).hide()}else{$(this).show()}});$("#_orderOrderExecTable tfoot tr th:eq(12)").show();$("#_orderOrderExecTable th:eq(13)").show();$("#_orderOrderExecTable tbody tr").each(function(){$(this).children("td:eq(13)").show();if($(this).attr("majorclass")=="0"||$(this).attr("majorclass")=="00"||$(this).attr("ordertype")=="CH"||$(this).attr("ordertype")=="PC"||$(this).attr("medflag")=="Y"){$(this).hide()}else{$(this).show()}});$("#_orderOrderExecTable tfoot tr th:eq(13)").show()},onOrderAllBtnTap:function(b,d,a){this.ButtonSelect(b);$("#_orderOrderExecTable th:eq(0) ").show();$("#_orderOrderExecTable tbody tr ").each(function(){$(this).children("td:eq(0)").show()});$("#_orderOrderExecTable tbody tr").each(function(){if($(this).attr("ordertype")!="CH"&&$(this).attr("chemo")!="1"){$(this).show()}else{$(this).hide()}});$("#_orderOrderExecTable tfoot tr th:eq(0) ").show()},onOrderOutBtnTap:function(d,f,b){this.ButtonSelect(d);for(var a=3;a<10;a++){$("#_orderOrderExecTable th:eq("+a+") ").hide();$("#_orderOrderExecTable tbody tr ").each(function(){$(this).children("td:eq("+a+")").hide()});$("#_orderOrderExecTable tfoot tr th:eq("+a+") ").hide()}$("#_orderOrderExecTable tbody tr").each(function(){if($(this).attr("medflag")=="Y"){$(this).show()}else{$(this).hide()}})},onOrderCTBtnTap:function(b,d,a){this.ButtonSelect(b);$("#_orderOrderExecTable tbody tr").each(function(){if(($(this).attr("ordertype")=="CH")&&$(this).attr("medflag")!="Y"){$(this).show()}else{$(this).hide()}})},onOrderOpCTBtnTap:function(b,d,a){this.ButtonSelect(b);$("#_orderOrderExecTable tbody tr").each(function(){if(($(this).attr("ordertype")!="CH"&&$(this).attr("chemo")=="1")&&$(this).attr("medflag")!="Y"){$(this).show()}else{$(this).hide()}})},onOrderPCABtnTap:function(b,d,a){this.ButtonSelect(b);$("#_orderOrderExecTable tbody tr").each(function(){if($(this).attr("ordertype")=="PC"&&$(this).attr("medflag")!="Y"){$(this).show()}else{$(this).hide()}})},onMGR_ORD_ExecuteRefBtnTap:function(d,f,b){if(!Ext.isEmpty(Ext.getCmp("_inpOrdCheckPanel"))){Ext.getCmp("_inpOrdCheckPanel").destroy();this.down("#MGR_ORD_MainPanel").setHidden(false)}var a=this.down("#MGR_ORD_HeadBarGroup").getActiveItem();if(Ext.isEmpty(a)){this.LoadActiveOrders(this.getRecord(),this)}else{this.LoadActiveOrders(this.getRecord(),this,a)}},onContainerDestroy:function(a){if(Ext.getStore("sActiveOrder")!=null){Ext.getStore("sActiveOrder").removeAll();Ext.getStore("sActiveOrder").destroy()}me=null;delete me;patInfo=null;delete patInfo;_callMgrFn=null;delete _callMgrFn;console.log("On destroy :","Management.OrderExcute");this.removeAll(true,true)},onContainerShow:function(a,b){this.down("#MGR_ORD_Main").setRecord(this.getRecord())},initialize:function(){this.callParent();try{if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("MgrOrderExcute 住院資料錯誤");return false}}catch(a){Ext.Msg.alert("MgrOrderExcute 住院資料錯誤");return false}if(Ext.getStore("sActiveOrder")==null){Ext.create("Ext.data.Store",{storeId:"sActiveOrder",clearOnPageLoad:false,model:"NisTRApp.model.Management.ActiveOrds",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/QueryActiveOrders.ashx",reader:{type:"json"}}})}Ext.getStore("sActiveOrder").addListener("beforeload",function(d,b,e){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sActiveOrder").addListener("load",function(e,d,g,b,f){NisTRApp.view.Management.OrderExcute.RenderTable(this,this.getRecord(),this.down("#MGR_ORD_HeadBarGroup").getActiveItem());this.setMasked(false)},this);this.down("#MGR_ORD_MainPanel").setRecord(this.getRecord())},LoadActiveOrders:function(e,b,d){if(undefined!=d&&!Ext.isEmpty(d)){this.down("#MGR_ORD_HeadBarGroup").setActiveItem(d)}if(Ext.getStore("sActiveOrder").isLoading()||Ext.isEmpty(e)){return}var a=Ext.getStore("sActiveOrder");a.getProxy().setExtraParams({ChartNo:e.data.ChartNo,InpNo:e.data.InpNo});a.load({callback:function(g,f,h){},scope:this});a=null;delete a;e=null;delete e},ResetExeOrderTable:function(b){try{if(!Ext.isEmpty(Ext.getCmp("MGR_ORD_TimeBlock"))){Ext.getCmp("MGR_ORD_TimeBlock").setValue("")}if(!Ext.isEmpty(Ext.getCmp("CanMutiExe"))){Ext.getCmp("CanMutiExe").setValue(false)}$("#_hiddenMultiOrddrid").val("");$("#_hiddenMultiCodeNo").val("");$("#_orderOrderBillsTable").empty();$(".action").parent("tr").removeAttr("style");$(".action").parent("tr[isSelect]").children().removeAttr("style");$(".action").parent("tr").removeAttr("isSelect");if(null!=$("#_orderOrderExecTable")){var a="";$("#_orderOrderExecTable").show();$("#_orderOrderExecTable tr ").show();$("#_orderOrderExecTable th").show();$("#_orderOrderExecTable th:eq(0) ").hide();$("#_orderOrderExecTable th:eq(10) ").hide();$("#_orderOrderExecTable th:eq(11) ").hide();$("#_orderOrderExecTable th:eq(12) ").hide();$("#_orderOrderExecTable th:eq(13) ").hide();$("#_orderOrderExecTable tbody tr ").each(function(){$(this).children("td:eq(0)").hide();$(this).children("td:eq(10)").hide();$(this).children("td:eq(11)").hide();$(this).children("td:eq(12)").hide();$(this).children("td:eq(13)").hide();for(var e=1;e<10;e++){$(this).children("td:eq("+e+")").show()}});$("#_orderOrderExecTable tfoot tr th:eq(0) ").hide();$("#_orderOrderExecTable tfoot tr th:eq(10) ").hide();$("#_orderOrderExecTable tfoot tr th:eq(11) ").hide();$("#_orderOrderExecTable tfoot tr th:eq(12) ").hide();$("#_orderOrderExecTable tfoot tr th:eq(13) ").hide()}}catch(d){console.log(d)}},ButtonSelect:function(a){if(!Ext.isEmpty(Ext.getCmp("_inpOrdCheckPanel"))){Ext.getCmp("_inpOrdCheckPanel").destroy();this.down("#MGR_ORD_MainPanel").setHidden(false)}this.down("#MGR_OrderExcuteFootBar").setHidden(a.getItemId()!="OrderDrugOralBtn");inpOrdCheckPanel=null;delete inpOrdCheckPanel;NisTRApp.view.Misc.ButtonSelect(a.getParent(),a,"confirm-round","normal","","",false);a.getParent().setActiveItem(a);this.ResetExeOrderTable(a)},StaticLoadActiveOrd:function(){if(!Ext.isEmpty(this.down("#MGR_ORD_ExecuteRefBtn"))){this.down("#MGR_ORD_ExecuteRefBtn").fireEvent("tap",this.down("#MGR_ORD_ExecuteRefBtn"),null,null)}}});Ext.define("NisTRApp.view.Management.FreqTimeSettingPanel",{extend:Ext.Panel,alias:"widget.Mgr_FreqTimeSettingPanel",config:{centered:true,height:"600px",width:"300px",layout:{type:"fit"},modal:true,scrollable:false,successFn:{},caller:{},items:[{xtype:"toolbar",docked:"top",title:"給藥時間設定"},{xtype:"fieldset",itemId:"MgrFreqTime_MainPanel",scrollable:"vertical"},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"FTSP_CancelBtn",left:"1px",width:"45%",text:" 取 消"},{xtype:"button",itemId:"FTSP_SaveBtn",right:"1px",ui:"decline",width:"45%",text:" 存 檔 "}]}],listeners:[{fn:"onFTSP_CancelBtnTap",event:"tap",delegate:"#FTSP_CancelBtn"},{fn:"onFTSP_SaveBtnTap",event:"tap",delegate:"#FTSP_SaveBtn"},{fn:"onPanelDestroy",event:"destroy"}]},onFTSP_CancelBtnTap:function(b,d,a){this.destroy()},onFTSP_SaveBtnTap:function(g,j,k){if(Ext.isEmpty(this.getRecord())){return}_saveDrugTimeData=function d(o,p,e,n){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/OrderShitFreqUpdate.ashx",scope:this,method:"POST",params:{InpNo:o.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),OrddRid:o.data.OrddRid,ShiftDrugTime:p},success:function(q){var r=Ext.decode(q.responseText);NisTRApp.view.Misc.Alert(r.Message,(r.Success?800:0));if(r.Success&&Ext.isFunction(e)){e(n)}r=null;delete r;e=null;delete e;n=null;delete n;o=null;delete o;p=null;delete p},failure:function(){Ext.Msg.alert("存檔失敗")}})};var b="";var h=0;var a=this.getRecord();for(var f=0;f<24;f++){if(Ext.getCmp("_drugtime"+f).isChecked()){b+="1";h=h+1}else{b+="0"}}var m=0;for(var f=0;f<24;f++){if(a.data.OriginalDrugTime.substr(f,1)=="1"){m=m+1}}var l=this;if(m!=h&&m!=0){Ext.Msg.show({title:"提醒",message:"與給藥總數不符",scope:this,buttons:[{itemId:"no",id:"no",text:"取消"},{itemId:"yes",id:"yes",text:"確認"}],fn:function(e){if(e=="no"){b=null;delete b;a=null;delete a}else{if(e=="yes"){_saveDrugTimeData(a,b,l.getSuccessFn(),l.getCaller());b=null;delete b;a=null;delete a;l=null;delete l}}}})}else{_saveDrugTimeData(a,b,l.getSuccessFn(),l.getCaller());b=null;delete b;a=null;delete a;l=null;delete l}h=null;delete h;m=null;delete m},onPanelDestroy:function(a){_saveDrugTimeData=null;delete _saveDrugTimeData;this.removeAll()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("Mgr Order 資料錯誤");this.destroy();return false}var a=this.getRecord().data.DrugTime;for(i=0;i<24;i++){var b=Ext.create("Ext.field.Checkbox",{label:i+"點",id:"_drugtime"+i,checked:(a.substr(i,1)=="1")});this.down("#MgrFreqTime_MainPanel").add(b);b=null;delete b}a=null;delete a}});Ext.define("NisTRApp.view.Management.OrderInfoPanel",{extend:Ext.Panel,alias:"widget.Mgr_OrderInfoPanel",config:{centered:true,height:450,width:1010,hideOnMaskTap:true,layout:{type:"fit"},modal:true,caller:{},patInfo:{},items:[{xtype:"panel",html:'<div id="labTpntdContent" style="width: 100% !important; height: 100% !important;"> test</div>',itemId:"LabDeitalPanel",styleHtmlContent:true,scrollable:"vertical"},{xtype:"panel",hidden:true,html:'<div id="orddShtContent" style="width: 100% !important; height: 100% !important;"> test</div>',itemId:"orddShtPanel",styleHtmlContent:true,scrollable:"both"},{xtype:"panel",hidden:false,html:'<div id="OrddFullTextContent" style="width:100%;height:100%" ></div>',itemId:"orddDetail",styleHtmlContent:true,scrollable:"vertical"},{xtype:"toolbar",docked:"bottom",itemId:"ORDInfoToolBar",layout:{align:"end",pack:"end",type:"hbox"},items:[{xtype:"selectfield",itemId:"printLocation",width:"30%",label:"列印地點",displayField:"station",valueField:"id"},{xtype:"button",itemId:"drugPrientBtn",text:"藥 標 列 印"},{xtype:"button",itemId:"labBarcodePrintBtn",text:"檢查單/Barcode列印"},{xtype:"button",itemId:"shtPrintBtn",text:"列 印 表 單"},{xtype:"button",itemId:"shtViewBtn",text:"檢 附 表 單 資 訊"},{xtype:"button",itemId:"LabTpntdBtn",text:"TPN 明 細"},{xtype:"button",itemId:"LabCHMBtn",text:"化 療 明 細"}]}],listeners:[{fn:"onLabDeitalPanelShow",event:"show",delegate:"#LabDeitalPanel"},{fn:"onLabDeitalPanelHide",event:"hide",delegate:"#LabDeitalPanel"},{fn:"onOrddShtPanelShow",event:"show",delegate:"#orddShtPanel"},{fn:"onOrddShtPanelHide",event:"hide",delegate:"#orddShtPanel"},{fn:"onOrddDetailShow",event:"show",delegate:"#orddDetail"},{fn:"onDrugPrientBtnTap",event:"tap",delegate:"#drugPrientBtn"},{fn:"onLabBarcodePrintBtnTap",event:"tap",delegate:"#labBarcodePrintBtn"},{fn:"onShtPrintBtnTap",event:"tap",delegate:"#shtPrintBtn"},{fn:"onShtViewBtnTap",event:"tap",delegate:"#shtViewBtn"},{fn:"onLabTpntdBtnTap",event:"tap",delegate:"#LabTpntdBtn"},{fn:"onLabCHMBtnTap",event:"tap",delegate:"#LabCHMBtn"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelHide",event:"hide"},{fn:"onPanelShow",event:"show"}]},onLabDeitalPanelShow:function(a,b){this.getParent().down("#orddDetail").setHidden(true);this.getParent().down("#orddShtPanel").setHidden(true)},onLabDeitalPanelHide:function(a,b){NisTRApp.view.FormUtil.ResetContentDiv("labTpntdContent",this)},onOrddShtPanelShow:function(b,f){if(Ext.isEmpty(this.getRecord())){return}this.getParent().down("#orddDetail").setHidden(true);this.getParent().down("#LabDeitalPanel").setHidden(true);var e=this.getRecord();$("#orddShtContent").empty();var a=String.format("{0}/{1}.aspx",NisTRApp.view.FormUtil.FormServer(),"RenderOrddSht");if(NisTRApp.view.SysUtility.IsiDevice()){try{var g=this;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv("orddShtContent",this);a=a+"?OrddRid="+e.data.OrddRid+"&InpNo="+e.data.InpNo;NisTRApp.view.Misc.createFrameContent($("#orddShtContent"),a,"orddShtContentIframe",function(){g.setMasked(false);g=null;delete g;return})}catch(d){NisTRApp.view.FormUtil.ResetContentDiv("orddShtContent",this);g=null;delete g}}else{this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:a,useDefaultXhrHeader:false,scope:this,method:"GET",params:{OrddRid:e.data.OrddRid,InpNo:e.data.InpNo},success:function(h){console.log(h);$("#orddShtContent").html(h.responseText);this.setMasked(false)},failure:function(){this.setMasked(false)}},this)}e=null;delete e;a=null;delete a},onOrddShtPanelHide:function(a,b){$("#orddShtContent").empty();NisTRApp.view.FormUtil.ResetContentDiv("orddShtContent",this)},onOrddDetailShow:function(a,b){this.getParent().down("#orddShtPanel").setHidden(true);this.getParent().down("#LabDeitalPanel").setHidden(true)},onDrugPrientBtnTap:function(d,g,b){var a=this.getRecord();var f=this.down("#printLocation").getValue();this.setMasked({xtype:"loadmask",message:"Printing..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Barcode/DrugLabelPrint.ashx",scope:this,method:"POST",params:{Station:f,InpNo:a.data.InpNo,ChartNo:a.data.ChartNo,UserId:NisTRApp.view.SysUtility.GetUserID(),UserName:NisTRApp.view.SysUtility.GetUserName(),CodeNo:a.data.CodeNo,OrddRid:a.data.OrddRid,SeqNo:a.data.SeqNo,Accessnum:a.data.Accessnum},success:function(e){this.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h},failure:function(){Ext.Msg.alert("歐麥尬! 列印失敗!");this.setMasked(false)}},this);a=null;delete a;f=null;delete f},onLabBarcodePrintBtnTap:function(d,g,b){var a=this.getRecord();var f=this.down("#printLocation").getValue();Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Barcode/AccessPrint.ashx",scope:this,method:"POST",params:{Station:f,InpNo:a.data.InpNo,ChartNo:a.data.ChartNo,UserId:NisTRApp.view.SysUtility.GetUserID(),UserName:NisTRApp.view.SysUtility.GetUserName(),CodeNo:a.data.CodeNo,OrddRid:a.data.OrddRid,SeqNo:a.data.SeqNo,Accessnum:a.data.Accessnum},success:function(e){this.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h},failure:function(){Ext.Msg.alert("歐麥尬! 檢驗檢查單列印失敗!");this.setMasked(false)}},this);Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Barcode/BarcodePrint.ashx",scope:this,method:"POST",params:{Station:f,InpNo:a.data.InpNo,ChartNo:a.data.ChartNo,UserId:NisTRApp.view.SysUtility.GetUserID(),UserName:NisTRApp.view.SysUtility.GetUserName(),CodeNo:a.data.CodeNo,OrddRid:a.data.OrddRid,SeqNo:a.data.SeqNo,Accessnum:a.data.Accessnum},success:function(e){this.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h},failure:function(){Ext.Msg.alert("歐麥尬! Barcode列印失敗!");this.setMasked(false)}},this);a=null;delete a;f=null;delete f},onShtPrintBtnTap:function(d,g,b){if($("#orddShtContent").html()==null||$("#orddShtContent").html()==""){return}var a=this.getRecord();var f=this.down("#printLocation").getValue();this.setMasked({xtype:"loadmask",message:"Printing..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Barcode/OrddShtPrint.ashx",scope:this,method:"POST",params:{Station:f,InpNo:a.data.InpNo,ChartNo:a.data.ChartNo,UserId:NisTRApp.view.SysUtility.GetUserID(),UserName:NisTRApp.view.SysUtility.GetUserName(),CodeNo:a.data.CodeNo,OrddRid:a.data.OrddRid},success:function(e){this.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h},failure:function(){Ext.Msg.alert("歐麥尬! 列印失敗!");this.setMasked(false)}},this);a=null;delete a;f=null;delete f},onShtViewBtnTap:function(b,d,a){if(this.down("#orddShtPanel").isHidden()){this.down("#orddShtPanel").setHidden(false);b.setUi("confirm");b.setText("關 閉 檢 附 表 單");this.down("#shtPrintBtn").setHidden(false)}else{this.down("#orddDetail").setHidden(false);b.setUi("normal");b.setText("檢 附 表 單 資 訊");this.down("#shtPrintBtn").setHidden(true)}},onLabTpntdBtnTap:function(g,j,f){if(this.down("#LabDeitalPanel").isHidden()){this.down("#LabDeitalPanel").setHidden(false);g.setUi("confirm");g.setText("關 閉 明 細")}else{this.down("#orddDetail").setHidden(false);g.setUi("normal");g.setText("TPN 明 細")}try{var d=this.getRecord();var h=this;h.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv("labTpntdContent",this.down("#LabDeitalPanel"));var a="http://go.kfcc.intra/LAB/LAB_TPNTD.asp?CHART_NO="+d.data.ChartNo+"&BEG_DATE="+d.data.TpnBegDate+"&Formula="+d.data.Formula+"&LOG_USER_ID="+NisTRApp.view.SysUtility.GetUserID();NisTRApp.view.Misc.createFrameContent($("#labTpntdContent"),a,"labTpntdContentIframe",function(){h.setMasked(false);h=null;delete h;return});d=null;delete d;a=null;delete a}catch(b){NisTRApp.view.FormUtil.ResetContentDiv("labTpntdContent",this.down("#LabDeitalPanel"));h=null;delete h}},onLabCHMBtnTap:function(g,j,f){if(this.down("#LabDeitalPanel").isHidden()){this.down("#LabDeitalPanel").setHidden(false);g.setUi("confirm");g.setText("關 閉 明 細")}else{this.down("#orddDetail").setHidden(false);g.setUi("normal");g.setText("化 療 明 細")}try{var d=this.getRecord();var h=this;h.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv("labTpntdContent",this.down("#LabDeitalPanel"));var a="http://go.kfcc.intra/CHP/CHP001I_8.asp?CHART_NO="+d.data.ChartNo+"&CHART_SEQ=0&CHEMO_TYPE="+d.data.ProCode+"&CHEMO_NO="+d.data.ChmSeq+"&LOG_USER_ID="+NisTRApp.view.SysUtility.GetUserID()+"&SOURCE=1";NisTRApp.view.Misc.createFrameContent($("#labTpntdContent"),a,"labTpntdContentIframe",function(){h.setMasked(false);h=null;delete h;return});d=null;delete d;a=null;delete a}catch(b){NisTRApp.view.FormUtil.ResetContentDiv("labTpntdContent",this.down("#LabDeitalPanel"));h=null;delete h}},onPanelDestroy:function(a){if(Ext.getStore("sPrintLocation")!=null){Ext.getStore("sPrintLocation").removeAll();Ext.getStore("sPrintLocation").destroy()}if(Ext.getStore("sDruglogByOrddRid")!=null){Ext.getStore("sDruglogByOrddRid").removeAll();Ext.getStore("sDruglogByOrddRid").destroy()}if(Ext.getStore("sNurSchedule")!=null){Ext.getStore("sNurSchedule").removeAll();Ext.getStore("sNurSchedule").destroy()}console.log("On destroy :","Management.OrderInfoPanel");_loadDruglogSuccess=null;delete _loadDruglogSuccess;_loadScheduleSuccess=null;delete _loadScheduleSuccess;this.removeAll(true,true)},onPanelHide:function(a,b){this.destroy()},onPanelShow:function(d,g){var f=this.getRecord().data;var j=String.format("<div> <h4>預定日期:{0}  開單醫師:{1} {2}{3}</h4></div>",f.PreExamDateTime.replace("T"," "),f.CreUserName,(f.EndDateTime=="1753-01-01T00:00:00"?"":"結束日期 :"),(f.EndDateTime=="1753-01-01T00:00:00"?"":f.EndDateTime.replace("T"," ")));var e="";var b="";a=function a(k,n,l){if(!Ext.isEmpty(n)){e=n}var m='<div id="orddShtContent">'+j+b+'</br><div class="orderSpec">'+f.OrddHtml+"</div><BR>"+e+"</div>";l.down("#orddDetail").setHtml("");l.down("#orddDetail").setHtml(m);l.setMasked(false);m=null;delete m;b=null;delete b;e=null;delete e;f=null;delete f;j=null;delete j};h=function h(l,o,k,n,m){if(!Ext.isEmpty(o)){b="</br>"+o}m.LoadDrugLog(k,n,m,a)};this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});this.NurSchedule(f.OrddRid,f.ChartNo,this,h)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNo)||Ext.isEmpty(this.getPatInfo())||Ext.isEmpty(this.getPatInfo().getIpbinp())){Ext.Msg.alert("Mgr Order 資料錯誤");this.destroy();return false}if(Ext.isEmpty(Ext.getStore("sPrintLocation"))){Ext.create("Ext.data.Store",{storeId:"sPrintLocation",model:"NisTRApp.model.PrintLocation",data:[{station:"02A ICU",id:"02A"},{station:"02B ICU",id:"02B"},{station:"05A 五北A",id:"05A"},{station:"05B 五北B",id:"05B"},{station:"05C 五南C",id:"05C"},{station:"05D 五南D",id:"05D"},{station:"06A 六北A",id:"06A"},{station:"06B 六北B",id:"06B"},{station:"06C 六南C",id:"06C"},{station:"06D 六南D",id:"06D"},{station:"07A 外北A",id:"07A"},{station:"07B 外北B",id:"07B"},{station:"07D 四南",id:"07D"},{station:"開刀房",id:"OP1"},{station:"內視鏡B1",id:"SCOPY"},{station:"放診科SONO(B1)",id:"SONOB1"},{station:"放診科CT",id:"CT"},{station:"放診科SONO(1F)",id:"SONO1F"},{station:"放診科Angio",id:"ANGIO"},{station:"婦女門診",id:"WOMEN"},{station:"耳鼻喉科門診",id:"OHN"},{station:"開刀房恢復室",id:"OP2"},{station:"開刀房準備區",id:"OP3"},{station:"門診治療室",id:"OTR"},{station:"1F排檢櫃台",id:"SONO1100"},{station:"09A 資訊部",id:"09A"}]})}if(Ext.isEmpty(Ext.getStore("sDruglogByOrddRid"))){Ext.create("Ext.data.Store",{storeId:"sDruglogByOrddRid",clearOnPageLoad:false,model:"NisTRApp.model.ORD.DruglogEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/DruglogByOrddRid.ashx",reader:{type:"json"}}})}if(Ext.isEmpty(Ext.getStore("sNurSchedule"))){Ext.create("Ext.data.Store",{storeId:"sNurSchedule",clearOnPageLoad:false,model:"NisTRApp.model.mNurScheduleEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/GetNurSchedule.ashx",reader:{type:"json"}}})}this.down("#printLocation").setHidden(true);this.down("#labBarcodePrintBtn").setHidden(true);this.down("#LabCHMBtn").setHidden(true);this.down("#shtViewBtn").setHidden(true);this.down("#shtPrintBtn").setHidden(true);this.down("#drugPrientBtn").setHidden(true);this.down("#orddDetail").setHidden(false);this.down("#orddShtPanel").setHidden(true);this.down("#LabDeitalPanel").setHidden(true);this.down("#printLocation").setStore(Ext.getStore("sPrintLocation"));this.down("#printLocation").setValue(this.getPatInfo().getIpbinp().data.NowStationno);this.down("#printLocation").setHidden(false);var a=this.getRecord().data;this.down("#LabTpntdBtn").setHidden(Ext.isEmpty(a.Formula));if(a.MbdFlag!="Y"&&a.MajorClass=="00"){this.down("#drugPrientBtn").setHidden(false)}else{if(a.MbdFlag!="Y"&&a.MajorClass!="0"&&a.MajorClass!="00"){this.down("#labBarcodePrintBtn").setHidden(false)}}if(!(a.MajorClass!="0"||a.OrderType=="CH"||a.OrderType=="PC"&&a.MbdFlag!="Y")){this.down("#labBarcodePrintBtn").setHidden(false)}if(!Ext.isEmpty(a.ShtId)&&(a.MajorClass=="0"||a.MajorClass=="00")){this.down("#shtViewBtn").setHidden(false)}if("CH"==a.OrderType&&!Ext.isEmpty(a.ChmSeq)){this.down("#LabCHMBtn").setHidden(false)}a=null;delete a},LoadDrugLog:function(d,h,f,a){if(Ext.getStore("sDruglogByOrddRid").isLoading()||Ext.isEmpty(d)){if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(null,"",f)}a=null;delete a;return}var e=Ext.getStore("sDruglogByOrddRid");var b=new Date();var g=Ext.Date.add(b,Ext.Date.DAY,-3);e.getProxy().setExtraParams({ChartNo:h,OrddRid:d,StartDate:g,EndDate:b});e.load({callback:function(j,l,r){var q="";if(!Ext.isEmpty(j)&&!Ext.isEmpty(j[0])){q+='<table style="width:900px;"><tr>';for(var m in j){var p="";if(!Ext.isEmpty(j[m].data.DblchkName)){p="/"+j[m].data.DblchkName}var o=j[m].Notes();var n="";if(!Ext.isEmpty(o)){n='<table style="width:780px;font-size:11pt;margin:0 0 0 0;padding:0 0 0 0;"><thead><th style="width:90px">日期</th><th style="width:90px">時間</th><th style="width:70px">人員</th><th>備註內容</th><th style="width:60px">簽章</th></thead>';var s=false;o.each(function(y,u,x){s=true;var v=y.data;var w="";if(v.DssFlag=="N"){w='<td class="delremark" inpno="'+v.InpNO+'" chartno="'+v.ChartNO+'" chartseq="'+v.ChartSeq+'" progdate="'+v.ProgDate+'" progtime="'+v.ProgTime+'" ></td>'}else{w="<td></td>"}n+="<tr><td>"+v.ProgDate+"</td><td>"+v.ProgTime+"</td><td>"+v.UserName+"</td><td>"+v.ContentAT+"</td><td>"+v.DssFlag+"</td>"+w+"</tr>"});n+="</table>";if(!s){n=""}}var k=Ext.isEmpty(j[m].data.Remark)?"":j[m].data.Remark;if(m%1==0&&m>0){q+="</tr><tr>"}q+='<td><span style="color:black; font-size: 13pt">'+j[m].data.ExeDate.substr(4,2)+"-"+j[m].data.ExeDate.substr(6,2)+" "+j[m].data.ExeTime.substr(0,2)+":"+j[m].data.ExeTime.substr(2,2)+"&nbsp;&nbsp;"+j[m].data.UserName+p+'</span>&nbsp;&nbsp;<span style="color:blue; font-size: 11pt">'+k+"</span><br>"+n+"</td>";k=null;delete k}q+="</tr></table>"}if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(j,q,f)}q=null;delete q;a=null;delete a},scope:this});e=null;delete e;b=null;delete b;g=null;delete g},NurSchedule:function(b,f,e,a){if(Ext.getStore("sNurSchedule").isLoading()||Ext.isEmpty(b)){if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(null,"",b,e)}a=null;delete a;return}var d=Ext.getStore("sNurSchedule");d.getProxy().setExtraParams({ChartNo:f,OrddRid:b});d.load({callback:function(h,g,k){var j="";if(!Ext.isEmpty(h)&&!Ext.isEmpty(h[0])){if(h[0].data.ScheTimeSlot==null){j="排程時間:"+h[0].data.ScheDate+" "+(h[0].data.ScheTime==null?"":h[0].data.ScheTime)}else{j="排程:"+h[0].data.ScheDate+" "+h[0].data.ScheTimeSlot}j=j+" "+(h[0].data.ScheMemo==null?"":h[0].data.ScheMemo)}if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(h,j,b,f,e)}j=null;delete j;a=null;delete a},scope:this});d=null;delete d}});Ext.define("NisTRApp.view.Management.CallDrugPanel",{extend:Ext.Panel,alias:"widget.Mgr_CallDrugPanel",config:{drugUnit:"undefined",centered:true,height:290,width:480,layout:{type:"fit"},modal:true,items:[{xtype:"toolbar",docked:"top",title:"急救車/叫藥數量"},{xtype:"panel",itemId:"CALL_DRUG_MIAN",layout:{type:"fit"},items:[{xtype:"fieldset",scrollable:false,items:[{xtype:"numberfield",itemId:"calldrugCount",label:"藥品數量",labelWidth:"50%",value:1,maxValue:30,minValue:1,stepValue:1},{xtype:"radiofield",itemId:"nurseCallDrug",label:"叫藥",labelWidth:"50%",name:"radiotype",value:"叫藥"},{xtype:"radiofield",itemId:"erCarList",label:"急救車",labelWidth:"50%",name:"radiotype",value:"急救車"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"CallDrugFootBar",layout:{align:"start",pack:"end",type:"hbox"},items:[{xtype:"button",itemId:"CallDrugCancelBtn",left:"1px",width:"48%",text:"取 消"},{xtype:"button",itemId:"CallDrugBtn",right:"1px",width:"48%",text:"叫 藥"}]}],listeners:[{fn:"onCallDrugCancelBtnTap",event:"tap",delegate:"#CallDrugCancelBtn"},{fn:"onCallDrugBtnTap",event:"tap",delegate:"#CallDrugBtn"},{fn:"onPanelShow",event:"show"},{fn:"onPanelDestroy",event:"destroy"}]},onCallDrugCancelBtnTap:function(b,d,a){this.destroy()},onCallDrugBtnTap:function(f,g,d){if(this.down("#nurseCallDrug").getChecked()==false&&this.down("#erCarList").getChecked()==false){Ext.Msg.alert("請選擇急救車或叫藥!");return}var a;var b=this.getRecord();if(this.down("#nurseCallDrug").getChecked()){a="NC"}if(this.down("#erCarList").getChecked()){a="NM"}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/OrderCallDrug.ashx",scope:this,method:"POST",params:{ChartNo:b.data.ChartNo,InpNo:b.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),OrddRid:b.data.OrddRid,TotalQty:this.down("#calldrugCount").getValue(),OrderType:a},success:function(e){var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){this.destroy()}h=null;delete h},failure:function(){Ext.Msg.alert("叫藥失敗")}},this);b=null;delete b;a=null;delete a},onPanelShow:function(a,b){},onPanelDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("Mgr Order 資料錯誤");this.destroy();return false}if(!Ext.isEmpty(this.getDrugUnit())){var b='藥品數量 <span style="color:blue">單位</span><span style="color:red; font-size:12pt">('+this.getDrugUnit()+")</span>";this.down("#calldrugCount").setLabel(b);b=null;delete b}var a=this.getRecord();if(a.data.NurseCallDrugFlag==true&&a.data.ErcarDrugListFlag==true){this.down("#erCarList").enable();this.down("#nurseCallDrug").enable()}else{if(a.data.NurseCallDrugFlag==true&&a.data.ErcarDrugListFlag==false){this.down("#nurseCallDrug").enable();this.down("#nurseCallDrug").setChecked(true);this.down("#erCarList").disable()}else{if(a.data.NurseCallDrugFlag==false&&a.data.ErcarDrugListFlag==true){this.down("#erCarList").enable();this.down("#erCarList").setChecked(true);this.down("#nurseCallDrug").disable()}}}a=null;delete a}});Ext.define("NisTRApp.view.Nur.INP_HealthProblem",{extend:Ext.Container,alias:"widget.NurINP_HealthProblem",statics:{OpenProblemForm:function(b){if(Ext.isEmpty(b)){Ext.Msg.alert("INP_HP 表單網址錯誤");return}try{var d=Ext.getCmp("_inpProblemFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_inpProblemFormPanel",url:b,divID:"InpProblemFrameDIV"})}if(!Ext.isEmpty(d)){var a=Ext.ComponentQuery.query("#NINPHP_MainPanel")[0];d.setCaller(a);d.setCloseFn(function(e){e.setHidden(false)});Ext.ComponentQuery.query("#NINPHP_Main")[0].animateActiveItem(d,{type:"slide",direction:"right"});a.setHidden(true);d.show();a=null;delete a}d=null;delete d;b=null;delete b}catch(f){console.log(f)}},LoadActiveProblemRecord:function(a,b){if(Ext.getStore("sInpProblemRecord").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sInpProblemRecord");d.getProxy().setExtraParams({FunctionType:"Problem",ChartNo:a.data.ChartNo,InpNo:a.data.InpNo,Discontinue:false});d.load();d=null;delete d},RenderActTable:function(b,g){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#NINPHP_ActiveGridPanel"))){return false}f=function f(h,k,l,m){var j=Ext.getStore("sInpProblemRecord").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpProblemRecord").getAt(0).records().getAt(j),k,l)}j=null;delete j};var e=Ext.getStore("sInpProblemRecord");b.down("#NINPHP_ActiveGridPanel").setHtml("");if(e.getCount()>0){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.down("#NINPHP_ActiveGridPanel"))){b.down("#NINPHP_ActiveGridPanel").setHtml("");if(!Ext.isEmpty(e.getAt(0))){var d=b.down("#NINPHP_ActiveGridPanel").getTpl().apply(e.getAt(0).data);b.down("#NINPHP_ActiveGridPanel").setHtml(d);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='nurproblemplan']").bind(a,function(){f(this,b,g,NisTRApp.view.Nur.INP_HealthProblem.NursingPlan)});$("a[name='dcheathproblem']").bind(a,function(){f(this,b,g,NisTRApp.view.Nur.INP_HealthProblem.DCProblem)});$("#inpProblemActGridRefresh").bind(a,function(){NisTRApp.view.Nur.INP_HealthProblem.LoadActiveProblemRecord(b.getRecord(),b)});d=null;delete d;a=null;delete a}}}e=null;delete e},NursingPlan:function(h,b,g){if(Ext.isEmpty(h.data.FormID)||Ext.isEmpty(g)){return}var e,f,d;if(g.data.Source.Type==1){e="0";f=g.data.Source.Name;d=(g.data.ChartSeq?g.data.ChartSeq:0)}else{if(g.data.Source.Type==2){e=g.data.InpNO;f=g.data.Source.Name;d=0}else{Ext.Msg.alert("NurAssessment 病人資料錯誤")}}var a=NisTRApp.view.FormUtil.HealthProblemAddr("RenderProblem",h.data.FormID,NisTRApp.view.SysUtility.GetUserID(),g.data.ChartNo,d,h.data.CategoryID,h.data.OpenRecordID,"_ReloadHealthProblemData","",e,f);NisTRApp.view.Nur.INP_HealthProblem.OpenProblemForm(a);a=null;delete a;e=null;f=null;d=null;delete e;delete f;delete d},DCProblem:function(d,a,b){if(Ext.isEmpty(d.data.FormID)||Ext.isEmpty(b)){return}Ext.Msg.confirm("注意","是否確認停用此健康問題?",function(e){if(e==="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/DistinueRecord.ashx",scope:a,method:"POST",params:{OpenRecordID:d.data.OpenRecordID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(f){var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){if(!Ext.isEmpty(Ext.getStore("sInpProblemRecord"))){Ext.getStore("sInpProblemRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInpInactiveProblemRecord"))){Ext.getStore("sInpInactiveProblemRecord").load()}}g=null;delete g;return false},failure:function(){Ext.Msg.alert("存檔失敗");return false}},a)}else{return false}})},LoadInactiveProblemRecord:function(a,b){if(Ext.getStore("sInpInactiveProblemRecord").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sInpInactiveProblemRecord");d.getProxy().setExtraParams({FunctionType:"Problem",ChartNo:a.data.ChartNo,InpNo:a.data.InpNo,Discontinue:true});d.load();d=null;delete d},RenderInactTable:function(b,f){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#NINPHP_InactiveGridPanel"))){return false}_callInaProblemFn=function e(h,k,l,m){var j=Ext.getStore("sInpInactiveProblemRecord").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpInactiveProblemRecord").getAt(0).records().getAt(j),k,l)}j=null;delete j};var g=Ext.getStore("sInpInactiveProblemRecord");b.down("#NINPHP_InactiveGridPanel").setHtml("");if(g.getCount()>0){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.down("#NINPHP_InactiveGridPanel"))){b.down("#NINPHP_InactiveGridPanel").setHtml("");if(!Ext.isEmpty(g.getAt(0))){var d=b.down("#NINPHP_InactiveGridPanel").getTpl().apply(g.getAt(0).data);b.down("#NINPHP_InactiveGridPanel").setHtml(d);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='inactivnurproblemplan']").bind(a,function(){_callInaProblemFn(this,b,f,NisTRApp.view.Nur.INP_HealthProblem.NursingPlan)});$("a[name='inactivdcheathproblem']").bind(a,function(){_callInaProblemFn(this,b,f,NisTRApp.view.Nur.INP_HealthProblem.RecoverProblem)});$("#inpProblemInactGridRefresh").bind(a,function(){NisTRApp.view.Nur.INP_HealthProblem.LoadInactiveProblemRecord(b.getRecord(),b)});d=null;delete d;a=null;delete a}}}g=null;delete g},RecoverProblem:function(d,a,b){if(Ext.isEmpty(d.data.FormID)||Ext.isEmpty(b)){return}Ext.Msg.confirm("注意","確認active此健康問題?",function(e){if(e==="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/RecoverDistinueRecord.ashx",scope:a,method:"POST",params:{OpenRecordID:d.data.OpenRecordID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(f){var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){if(!Ext.isEmpty(Ext.getStore("sInpProblemRecord"))){Ext.getStore("sInpProblemRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInpInactiveProblemRecord"))){Ext.getStore("sInpInactiveProblemRecord").load()}}g=null;delete g;return false},failure:function(){Ext.Msg.alert("存檔失敗");return false}},a)}else{return false}})},LoadFormHistory:function(b,d,a){if(Ext.getStore("sInpProblemHistory").isLoading()||Ext.isEmpty(b)){return}var e=Ext.getStore("sInpProblemHistory");e.removeAll();e.getProxy().setExtraParams({FunctionType:a,InpNo:b.data.InpNo});e.loadPage(1,null,d);e=null;delete e}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NINPHP_Main",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NINPHP_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",itemId:"NINPHP_NewProblemList",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的健康問題"}]},{xtype:"tabpanel",itemId:"NINPHP_MainTabPanel",width:"80%",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"Active",itemId:"NINPHP_ActiveGridPanel",tpl:Ext.create("Ext.XTemplate","",'<div id="_probleemActive" class="globalList" >','<table id="_probleemActiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="8" style="text-align:left">健 康 問 題 <span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpProblemActGridRefresh" type="button">重新整理</button></span></th>',"            ","        </tr>","        <tr>",'            <th width="30%">問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">最後追蹤日</th>','            <th width="15%">編輯</th>','            <th width="15%">停用</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"        	<tr>",'     	       <td width="30%" align="center" >{Title} {[this.SubTitleStr(values)]}</td>','               <td width="15%" align="center"> {[this.StartDateStr(values)]}</td>','               <td width="15%"  align="center">{[this.PlanLatestDateStr(values)]}</td>','			   <td width="15%" align="center"><a id="btnView" name="nurproblemplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">護理計畫</a></td>           ','               <td width="15%" align="center"><a id="btnView1" name="dcheathproblem" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">停用</a></td>',"               ","            </tr>","        </tpl>        ","     ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="30%">問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">最後追蹤日</th>','            <th width="15%">編輯</th>','            <th width="15%">停用</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>","","            ",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},PlanLatestDateStr:function(a){if(a.PlanLatestDate.substring(0,10)=="1753-01-01"){return"未完成"}else{return a.PlanLatestDate.substring(0,16).replace("T","<br>")}}}),layout:{type:"fit"},scrollable:"vertical"},{xtype:"container",title:"Inactive",itemId:"NINPHP_InactiveGridPanel",tpl:Ext.create("Ext.XTemplate",'<div id="_probleemInactive" class="globalList" >','<table id="_probleemInactiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="8" style="text-align:left">健 康 問 題 <span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpProblemInactGridRefresh" type="button">重新整理</button></span></th>',"            ","        </tr>","        <tr>",'            <th width="30%">問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">結束日期</th>','            <th width="15%">瀏覽</th>','            <th width="15%">回復停用</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"        	<tr>",'     	       <td width="30%" align="center" >{Title} {[this.SubTitleStr(values)]}</td>','               <td width="15%" align="center"> {[this.StartDateStr(values)]}</td>','               <td width="15%"  align="center">{[this.DiscontinueDateStr(values)]}</td>','			   <td width="15%" align="center"><a id="btnView" name="inactivnurproblemplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">護理計畫</a></td>           ','               <td width="15%" align="center"><a id="btnView1" name="{[this.RecoverCalss(values)]}" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}" style="{[this.Problemstylestr(values)]}">回復</a></td>',"               ","            </tr>","        </tpl>        ","     ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="30%">問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">結束日期</th>','            <th width="15%">瀏覽</th>','            <th width="15%">回復停用</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>","",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},DiscontinueDateStr:function(a){if(a.DiscontinueDate.substring(0,10)=="1753-01-01"){return""}else{return(a.DiscontinueDate.substring(0,16).replace("T","<br>")+'&nbsp;&nbsp;<span style="color:blue;font-size:small;">'+a.DiscontinueUserName+"</span>")}},Problemstylestr:function(a){if(a.DiscontinueUserID==NisTRApp.view.SysUtility.GetUserID()){return""}else{return"color:#E6E6FA;"}},RecoverCalss:function(a){if(a.DiscontinueUserID==NisTRApp.view.SysUtility.GetUserID()){return"inactivdcheathproblem"}else{return"xxxx"}}}),layout:{type:"fit"},scrollable:"vertical",listeners:[{fn:function(b,a){if(Ext.getStore("sInpInactiveProblemRecord").getCount()<=0){NisTRApp.view.Nur.INP_HealthProblem.LoadInactiveProblemRecord(this.getRecord(),this)}},event:"painted"}]},{xtype:"container",title:"健康問題歷程",itemId:"NINPHP_HistoryPanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NINPHP_History",disableSelection:true,itemTpl:["<div>","    ",'    <span style="font-weight:bold;"></span> <span>【{Title}】 </span>',"    <br line-height:0.1px;>","    <br line-height:0.1px;>",'    <span style="font-weight:bold;"> 記錄日期 : </span> <span>{[NisTRApp.view.FormUtil.MedicalDateFormat(values.CreateDate)]}</span>',"","    <br line-height:0.1px;>",'    <tpl if= "Cause != &quot;&quot;"> ',"     ",'            <span style="font-weight:bold;"> 導因 : </span> <span> {Cause}</span>',"        ","        <br line-height:0.1px;>","    </tpl>","</div>","","<div>",'     <span style="font-weight:bold;"> 計畫 : </span> ',"    <br line-height:0.1px;>",'    <span style="font-weight:bold;color:#9400D3;"> {Plan}</span>',"</div>","","<br line-height:0.1px;>","",'<tpl if= "Tech != &quot;&quot;"> ',"    <div>",'        <span style="font-weight:bold;"> 衛教 : </span> ',"        <br line-height:0.1px;>",'        <span style="font-weight:bold;color:#008B8B;"> {Tech} </span>',"    </div>","	<br line-height:0.1px;>","</tpl>",""],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_HealthProblem.LoadFormHistory(this.getRecord(),this,"Problem")},event:"painted"}]}]}]}]}],listeners:[{fn:"onNINPHP_NewProblemListLeafItemTap",event:"leafitemtap",delegate:"#NINPHP_NewProblemList"},{fn:"onNINPHP_ActiveGridPanelUpdatedata",event:"updatedata",delegate:"#NINPHP_ActiveGridPanel"},{fn:"onContainerDestroy",event:"destroy"}]},onNINPHP_NewProblemListLeafItemTap:function(b,l,h,j,g,k,m){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var o=this.getRecord();var f,a,d;if(o.data.Source.Type==1){f="0";a=o.data.Source.Name;d=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){f=o.data.InpNO;a=o.data.Source.Name;d=0}else{Ext.Msg.alert("NurHP 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.HealthProblemAddr("RenderProblem",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,d,"","","_ReloadHealthProblemData","",f,a);NisTRApp.view.Nur.INP_HealthProblem.OpenProblemForm(n);n=null;delete n;f=null;a=null;d=null;delete f;delete a;delete d},onNINPHP_ActiveGridPanelUpdatedata:function(a,d,b){if(Ext.getStore("sInpProblemRecord").getCount()<=0){NisTRApp.view.Nur.INP_HealthProblem.LoadActiveProblemRecord(this.getRecord(),this)}},onContainerDestroy:function(a){if(Ext.getStore("sInpProblemRecord")!=null){Ext.getStore("sInpProblemRecord").removeAll();Ext.getStore("sInpProblemRecord").destroy()}if(Ext.getStore("sInpInactiveProblemRecord")!=null){Ext.getStore("sInpInactiveProblemRecord").removeAll();Ext.getStore("sInpInactiveProblemRecord").destroy()}if(Ext.getStore("sInpProblemHistory")!=null){Ext.getStore("sInpProblemHistory").removeAll();Ext.getStore("sInpProblemHistory").destroy()}if(!Ext.isEmpty(Ext.getCmp("_inpProblemFormPanel"))){Ext.getCmp("_inpProblemFormPanel").destroy()}_ReloadHealthProblemData=null;delete _ReloadHealthProblemData;_callProblemFn=null;delete _callProblemFn;_callInaProblemFn=null;delete _callInaProblemFn;console.log("On Destroy","Nur.INP_HealthProblem");this.removeAll(true,true)},initialize:function(){this.callParent();_ReloadHealthProblemData=function(a){try{if(!Ext.isEmpty(Ext.getStore("sInpProblemRecord"))){Ext.getStore("sInpProblemRecord").load()}if(!Ext.isEmpty(Ext.getCmp("_inpProblemFormPanel"))){Ext.getCmp("_inpProblemFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NINPHP_MainPanel")[0])){Ext.ComponentQuery.query("#NINPHP_MainPanel")[0].show()}}catch(b){console.error("_ReloadHealthProblemData",b)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("INP_HP 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("INP_HP 住院病人資料錯誤");return false}if(this.getRecord().data.Source.Type!=2){Ext.Msg.alert("INP_HP 不支援門診病人");return false}if(Ext.isEmpty(Ext.getStore("sNewInpHProblemRecord"))){Ext.create("Ext.data.TreeStore",{storeId:"sNewInpHProblemRecord",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Problem",Source:this.getRecord().data.Source.Name},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NINPHP_NewProblemList").setStore(Ext.getStore("sNewInpHProblemRecord"));if(Ext.getStore("sNewInpHProblemRecord").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sInpProblemRecord"))){Ext.create("Ext.data.Store",{storeId:"sInpProblemRecord",model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sInpProblemRecord").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpProblemRecord").addListener("load",function(d,b,f,a,e){NisTRApp.view.Nur.INP_HealthProblem.RenderActTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NINPHP_ActiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInpInactiveProblemRecord"))){Ext.create("Ext.data.Store",{storeId:"sInpInactiveProblemRecord",model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sInpInactiveProblemRecord").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpInactiveProblemRecord").addListener("load",function(d,b,f,a,e){NisTRApp.view.Nur.INP_HealthProblem.RenderInactTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NINPHP_InactiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInpProblemHistory"))){Ext.create("Ext.data.Store",{storeId:"sInpProblemHistory",model:"NisTRApp.model.Form.mNursingNotesHistory",pageSize:5,clearOnPageLoad:false,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/NursingNotesHistoryByPatV2.ashx",reader:{type:"json",rootProperty:"MainMasterID"}}})}this.down("#NINPHP_HistoryPanel").setRecord(this.getRecord());this.down("#NINPHP_History").setStore(Ext.getStore("sInpProblemHistory"))},LoadListItem:function(){if(Ext.getStore("sNewInpHProblemRecord").isLoading()||Ext.isEmpty(this.getRecord())){return false}var a=Ext.getStore("sNewInpHProblemRecord");a.removeAll();a.load();a=null;delete a;return false}});Ext.define("NisTRApp.view.Nur.INP_Notes",{extend:Ext.Container,alias:"widget.NurINP_Notes",statics:{LoadHealthProblemRecord:function(a,b){if(Ext.getStore("sInpNoteProblemList").isLoading()||Ext.isEmpty(a)){return}var e=a;var d=Ext.getStore("sInpNoteProblemList");d.removeAll();d.getProxy().setExtraParams({ChartNo:e.data.ChartNo,FunctionType:"Problem",InpNo:e.data.InpNo,Discontinue:false,Wrap:true,AllFlag:false});d.load({callback:function(g,f,h){},scope:this});d=null;delete d;e=null;delete e},RenderHealthProblemTable:function(b,g){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#NNINP_HealthProblemPanel"))){return false}_callNoteProblemFn=function f(h,k,l,m){var j=Ext.getStore("sInpNoteProblemList").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpNoteProblemList").getAt(0).records().getAt(j),k,l)}j=null;delete j};var e=Ext.getStore("sInpNoteProblemList");b.down("#NNINP_HealthProblemPanel").setHtml("");if(e.getCount()>0){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.down("#NNINP_HealthProblemPanel"))){b.down("#NNINP_HealthProblemPanel").setHtml("");if(!Ext.isEmpty(e.getAt(0))){var d=b.down("#NNINP_HealthProblemPanel").getTpl().apply(e.getAt(0).data);b.down("#NNINP_HealthProblemPanel").setHtml(d);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='nursinginpnotesplan']").bind(a,function(){_callNoteProblemFn(this,b,g,NisTRApp.view.Nur.INP_Notes.OpenNoteFormPlan)});$("#inpNoteHealthProblemActGridRefresh").bind(a,function(){NisTRApp.view.Nur.INP_Notes.LoadHealthProblemRecord(b.getRecord(),b)});d=null;delete d;a=null;delete a}}}e=null;delete e},LoadInpNursingNoteHistroy:function(b,d){if(Ext.getStore("sPtNoteListInp").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sPtNoteListInp");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNo,FunctionType:"Problem"});a.loadPage(1,null,d);a=null;delete a},LoadNotesTempRecord:function(a,e,d){if(Ext.getStore("sInpNotesTempRecord").isLoading()||Ext.isEmpty(a)||Ext.isEmpty(e)){return}var f=a;var b=Ext.getStore("sInpNotesTempRecord");b.removeAll();b.getProxy().setExtraParams({ChartNo:f.data.ChartNo,InpNo:f.data.InpNo,UserID:e});b.load({callback:function(h,g,j){},scope:this});b=null;delete b;f=null;delete f},OpenNoteFormPlan:function(g,a,f){try{if(!Ext.isEmpty(Ext.getCmp("_inpNotesEditPanel"))){Ext.getCmp("_inpNotesEditPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpNotesEditPanel"))){var d=Ext.create("NisTRApp.view.Nur.INP_NotesEditPanel",{id:"_inpNotesEditPanel",centered:true,modal:true,formRecord:g,record:f,caller:a,successFn:_inpNoteSaveSuccessFn,height:NisTRApp.view.SysUtility.ClcHeight(90),width:NisTRApp.view.SysUtility.ClcWidth(95)});a.overlay=Ext.Viewport.add(d);d=null;delete d}a.overlay.show();a=null;delete a}catch(b){console.log(b)}return}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",id:"NNINP_MAIN",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NNINP_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",height:"100%",itemId:"NNINP_NewNotesList",width:"100%",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的護理記錄"}]},{xtype:"tabpanel",width:"80%",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"健康問題護理記錄",itemId:"NNINP_HealthProblemPanel",tpl:Ext.create("Ext.XTemplate",'<div id="_noteActive" class="globalList" >','<table id="_noteActiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="8" style="text-align:left">護 理 記 錄 <span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpNoteHealthProblemActGridRefresh" type="button">重新整理</button></span></th>',"            ","        </tr>","        <tr>",'            <th width="30%">健康問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">最後記錄日</th>','            <th width="15%">狀態</th>','            <th width="15%">瀏覽</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"        	<tr>",'				<td width="30%" align="center" >{Title} {[this.SubTitleStr(values)]}</td>','               <td width="15%" align="center"> {[this.StartDateStr(values)]}</td>','               <td width="15%"  align="center">{[this.LastNotesDateStr(values)]}</td>','			   <td width="15%" align="center">{[this.LastNotesStatusStr(values)]}</td>           ','               <td width="15%" align="center"><a id="btnView1" name="nursinginpnotesplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">護理記錄</a></td>',"               ","     	       ","            </tr>","        </tpl>        ","     ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="30%">健康問題</th>','            <th width="15%">開始日期</th>','            <th width="15%">最後記錄日</th>','            <th width="15%">狀態</th>','            <th width="15%">瀏覽</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},LastNotesDateStr:function(a){if(a.LastNotesDate.substring(0,10)=="1753-01-01"){return""}else{return a.LastNotesDate.substring(0,16).replace("T","<br>")}},LastNotesStatusStr:function(a){if(a.Finished==true){return"存檔"}else{if(a.LastNotesDate!=""&&a.LastNotesDate!="1753-01-01T00:00:00"){return"暫存"}else{return""}}}}),scrollable:"vertical"},{xtype:"container",title:"記錄歷程",itemId:"NNOTE_INPNursingNotePanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOTE_MainInpNursingNotesHistroy",disableSelection:true,itemTpl:["<div>",'    <span class="posted" style="color:black;font-weight:bold;"> 【{Title}】</span> <span>日期 : {MedicalDateFormat}&nbsp;{MedicalTimeFormat} 人員:{UserName} </span>',"    ","</div>","","",'<tpl if= "ValueMemo != &quot;&quot;"> ',"	<br>","    <div>",'    	<span >評值 : <span style="color:green;font-weight:bold;" > {ValueMemo} </span></span>',"    </div>    ","</tpl>","","<br>",'<div style="font-size:medium;"> ','    <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{HtmlEncodeContent}</pre></span>',"    ","</div>"],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_Notes.LoadInpNursingNoteHistroy(this.getRecord(),this)},event:"painted"}]},{xtype:"container",title:"Note 暫存記錄",itemId:"NNOTE_InpTempNotePanel",layout:{type:"fit"},listeners:[{fn:function(b,a){if(Ext.getStore("sInpNotesTempRecord").getCount()<=0){NisTRApp.view.Nur.INP_Notes.LoadNotesTempRecord(this.getRecord(),NisTRApp.view.SysUtility.GetUserID(),this)}},event:"painted"}]}]}]}]}],listeners:[{fn:"onNNINP_NewNotesListLeafItemTap",event:"leafitemtap",delegate:"#NNINP_NewNotesList"},{fn:"onNNINP_HealthProblemPanelUpdatedata",event:"updatedata",delegate:"#NNINP_HealthProblemPanel"},{fn:"onContainerDestroy",event:"destroy"}]},onNNINP_NewNotesListLeafItemTap:function(j,f,b,h,a,g,d){NisTRApp.view.Nur.INP_Notes.OpenNoteFormPlan(a,this,this.getRecord());return},onNNINP_HealthProblemPanelUpdatedata:function(a,d,b){if(Ext.getStore("sInpNoteProblemList").getCount()<=0){NisTRApp.view.Nur.INP_Notes.LoadHealthProblemRecord(this.getRecord(),this)}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sInpNoteProblemList"))){Ext.getStore("sInpNoteProblemList").removeAll();Ext.getStore("sInpNoteProblemList").destroy()}if(!Ext.isEmpty(Ext.getStore("sPtNoteListInp"))){Ext.getStore("sPtNoteListInp").removeAll();Ext.getStore("sPtNoteListInp").destroy()}if(!Ext.isEmpty(Ext.getStore("sInpNotesTempRecord"))){Ext.getStore("sInpNotesTempRecord").removeAll();Ext.getStore("sInpNotesTempRecord").destroy()}_callNoteProblemFn=null;delete _callNoteProblemFn;_inpNoteSaveSuccessFn=null;delete _inpNoteSaveSuccessFn;this.removeAll(true,true)},initialize:function(){this.callParent();_inpNoteSaveSuccessFn=function(d){if(!Ext.isEmpty(Ext.getStore("sInpNoteProblemList"))){Ext.getStore("sInpNoteProblemList").load()}if(!Ext.isEmpty(Ext.getStore("sInpNotesTempRecord"))&&Ext.getStore("sInpNotesTempRecord").getCount()>0){Ext.getStore("sInpNotesTempRecord").load()}if(d&&!Ext.isEmpty(Ext.getStore("sPtNoteListInp"))&&Ext.getStore("sPtNoteListInp").getCount()>0){Ext.getStore("sPtNoteListInp").removeAll();Ext.getStore("sPtNoteListInp").loadPage(1,null,null)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("INP_Notes 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("INP_Notes 住院病人資料錯誤");return false}if(this.getRecord().data.Source.Type!=2){Ext.Msg.alert("INP_Notes 不支援門診病人");return false}if(Ext.isEmpty(Ext.getStore("sInpNotetList"))){Ext.create("Ext.data.TreeStore",{storeId:"sInpNotetList",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Notes",Source:"INP"},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NNINP_NewNotesList").setStore(Ext.getStore("sInpNotetList"));if(Ext.getStore("sInpNotetList").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sInpNoteProblemList"))){Ext.create("Ext.data.Store",{storeId:"sInpNoteProblemList",autoLoad:false,model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Problem",Discontinue:false,Wrap:true,AllFlag:false},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecordNursingNotes.ashx",reader:{type:"json"}}})}Ext.getStore("sInpNoteProblemList").addListener("beforeload",function(e,d,f){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpNoteProblemList").addListener("load",function(f,e,h,d,g){NisTRApp.view.Nur.INP_Notes.RenderHealthProblemTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NNINP_HealthProblemPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sPtNoteListInp"))){Ext.create("Ext.data.Store",{storeId:"sPtNoteListInp",autoLoad:false,pageSize:5,model:"NisTRApp.model.Form.NursingNotes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/NursingNotesListInp.ashx",reader:{type:"json"}}})}this.down("#NNOTE_INPNursingNotePanel").setRecord(this.getRecord());this.down("#NNOTE_MainInpNursingNotesHistroy").setStore(Ext.getStore("sPtNoteListInp"));if(Ext.isEmpty(Ext.getStore("sInpNotesTempRecord"))){Ext.create("Ext.data.Store",{storeId:"sInpNotesTempRecord",autoLoad:false,model:"NisTRApp.model.Note.NotesTempRecord",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/NotesTempRecord.ashx",reader:{type:"json"}}})}var b=Ext.getCmp("InpTempSaveNoteGrid");if(Ext.isEmpty(b)){b=this.GenTempSaveNoteGrid("InpTempSaveNoteGrid","","");b.getTitleBar().hide();b.patient=this.getRecord();var a=Ext.getStore("sInpNotesTempRecord");b.setStore(a);b.addListener("itemtap",this.ItemSingleTapTempSaveNoteGrid,b);this.down("#NNOTE_InpTempNotePanel").add(b);a=null;delete a}this.down("#NNOTE_InpTempNotePanel").setRecord(this.getRecord());b=null;delete b},LoadListItem:function(){if(Ext.getStore("sInpNotetList").isLoading()||Ext.isEmpty(this.getRecord())){return false}var a=Ext.getStore("sInpNotetList");a.removeAll();a.load();a=null;delete a;return false},GenTempSaveNoteGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},patient:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',plugins:[{type:"gridcolumnresizing"},{type:"pullrefresh"}],columns:[{text:"標題",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(35),tpl:'<span style="color:Black; font-size: 14px">{Title}</span>',flex:1,dataIndex:"Title",editable:false,sortable:false},{text:"醫療日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(30),tpl:'<span style="color:Black; font-size: 14px">{[NisTRApp.view.DateUtil.FormDateFormat(values.MedicalDate)]}</span>',flex:1,dataIndex:"MedicalDate",editable:false,sortable:false},{text:"瀏覽",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:NisTRApp.view.SysUtility.ClcWidth(15),tpl:'<a id="NNTEMPNOTEVIEW_{FormID}" class="btn link-btn" style="font-size: 16px">瀏覽</a>',flex:1,editable:false,sortable:false}],})},ItemSingleTapTempSaveNoteGrid:function(g,b,j,a,h,d){h.preventDefault();if(h.event.target.nodeName=="A"){var f=h.event.target.id.split("_");if("NNTEMPNOTEVIEW"==f[0]){NisTRApp.view.Nur.INP_Notes.OpenNoteFormPlan(a,g,g.patient)}f=null;delete f}_openNoteEdditForm=null;delete _openNoteEdditForm;return false}});Ext.define("NisTRApp.view.Nur.INP_NotesEditPanel",{extend:Ext.Container,alias:"widget.NurINP_NotesEditPanel",statics:{LoadHealthProblem:function(d,a){if(Ext.getStore("sInpNoteFormProblemList").isLoading()||Ext.isEmpty(d)){return}var b=Ext.getStore("sInpNoteFormProblemList");b.removeAll();b.getProxy().setExtraParams({ChartNo:d.data.ChartNo,FunctionType:"Problem",InpNo:d.data.InpNo,Discontinue:false,Wrap:false,AllFlag:true});if(!Ext.isEmpty(a)){a.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})}b.load({callback:function(g,f,j){if(!Ext.isEmpty(a)){a.setMasked(false)}var e=a.getFormRecord();if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.data.OpenRecordID)){a.down("#problemSelectTitle").setValue(e.data.OpenRecordID)}else{var h=Ext.create("NisTRApp.model.Form.OpenRecord",{Discontinue:false,Title:"請選擇",OpenRecordID:"NULLRECORD"});Ext.getStore("sInpNoteFormProblemList").addData(h);a.down("#problemSelectTitle").setValue("NULLRECORD");h=null;delete h}e=null;delete e;d=null;delete d},scope:a});b=null;delete b},LoadProblemHistory:function(d,e,b,f){if(Ext.getStore("sNoteFormProblemHistory").isLoading()||Ext.isEmpty(e)){return}var a=Ext.getStore("sNoteFormProblemHistory");a.removeAll();if(d!="NULLRECORD"){a.getProxy().setExtraParams({OpenRecordID:d,InpNo:e.data.InpNo});a.loadPage(1,{callback:function(h,g,j){},scope:b})}a=null;delete a;e=null;delete e},LoadProblemScoreData:function(b,e,a,f){if(Ext.getStore("sProblemScore").isLoading()||Ext.isEmpty(e)){return}var d=Ext.getStore("sProblemScore");d.removeAll();if(b!="NULLRECORD"){d.getProxy().setExtraParams({OpenRecordID:b,InpNo:e.data.InpNo,ChartNo:e.data.ChartNo});if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.down("#ProblemScoreChart"))){a.down("#ProblemScoreChart").setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})}d.load({callback:function(h,g,j){if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.down("#ProblemScoreChart"))){a.down("#ProblemScoreChart").setMasked(false)}NisTRApp.view.Nur.INP_NotesEditPanel.RenderLoadProblemScore(e,a)},scope:a})}d=null;delete d},RenderLoadProblemScore:function(p,a){if($("#_problemScoreChartDiv").highcharts()){$("#_problemScoreChartDiv").highcharts().destroy()}$("#_problemScoreChartDiv").html("");if(Ext.isEmpty(p)){return}if(Ext.getStore("sProblemScore").isLoading()){$("#_problemScoreChartDiv").html('<div style="width:auto; text-align:center; padding-top:15%; color:red; font-weight:bold;">資料讀取尚未完成.</div>');return}if(Ext.getStore("sProblemScore").getCount()<=0){$("#_problemScoreChartDiv").html('<div style="width:auto; text-align:center; padding-top:8%; color:red; font-weight:bold;">無資料.</div>');return}try{var f=$("#_problemScoreChartDiv");var h=Ext.getStore("sProblemScore");var m=Ext.getStore("sProblemScore").getAt(0);var l=m.data.MedicalDate;var o={min:new Date().getTime(),max:l.getTime()};var b=["護理評值"];var k=[];var g=[];Ext.getStore("sProblemScore").each(function(v,q,u){var r=v.data;var w=r.MedicalDate;var s=w.getTime();o.min=(s<=o.min)?s:o.min;o.max=(s>=o.max)?s:o.max;if(r.Value){var e="black";k.push({x:s,y:r.Value-0,ValueMemo:r.ValueMemo,dataLabels:{enabled:false,align:"left",format:'<span style="font-size: 10pt; color:black;">{point.ValueMemo}</span><br>',useHTML:true,style:{fontSize:"12pt"}}});k[k.length-1].color="black"}r=null;delete r;w=null;delete w;s=null;delete s});var n=b[0];if(k.length>0){g.push({name:n,yAxis:0,type:"line",color:"#0099FF",data:k})}n=null;delete n;var d=new Date(o.min);d.setHours(0);d.setMinutes(0);d.setSeconds(0);o.min=d.getTime();d=new Date(o.max);d.setHours(23);d.setMinutes(59);d.setSeconds(59);o.max=d.getTime();f.highcharts({chart:{type:"line",height:170,backgroundColor:"#eee"},title:{text:""},subtitle:{text:(h.length!=0)?"":"無資料"},tooltip:{xDateFormat:'<span style="font-size: 11pt;">%Y-%m-%d %H:%M:%S</span>',shared:true,crosshairs:true,pointFormat:'<span style="font-size: 10pt;"> <span style=" font-size: 10pt; font-weight: bold; color:blue;"> {point.ValueMemo}</span></span><br/>'},xAxis:{type:"datetime",min:o.min-3600000,max:o.max+3600000,dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%y-%B-%d",month:"%Y/%B",year:"%Y"},startOnTick:false,endOnTick:false,minRange:360000000000,minorTickInterval:360000000000*4,gridLineWidth:1,lineColor:"#000",tickColor:"#000",labels:{style:{color:"#000",font:"11px Trebuchet MS, Verdana, sans-serif"}},title:{style:{color:"#333",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}}},yAxis:{title:{text:""},min:0,max:4,tickInterval:1,lineColor:"#3366FF",gridLineColor:"#9A9A9A",tickWidth:8,opposite:false,labels:{formatter:function(){switch(this.value){case 0:valueString="潛在";break;case 1:valueString="變差";break;case 2:valueString="不變";break;case 3:valueString="改善中";break;case 4:valueString="改善";break;default:valueString=""}return valueString}}},plotOptions:{line:{}},series:g});f=null;delete f;h=null;delete h;m=null;delete m;l=null;delete l;o=null;delete o;b=null;delete b;k=null;delete k;g=null;delete g}catch(j){console.error(j);document.getElementById("_problemScoreChartDiv").innerHTML="";$("#_problemScoreChartDiv").html("")}},LoadTempSaveNote:function(l,h,m,n,k,f,e,j,d){if(Ext.isEmpty(l)||Ext.isEmpty(m)){return}var g,a,b;if(m.data.Source.Type==1){g="0";a=m.data.Source.Name;b=(m.data.ChartSeq?m.data.ChartSeq:0)}else{if(m.data.Source.Type==2){g=m.data.InpNO;a=m.data.Source.Name;b=0}else{Ext.Msg.alert("NurNote 病人資料錯誤")}}if(!Ext.isEmpty(d)){d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD})}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/NursingNotes.ashx",scope:this,method:"POST",params:{FormID:l,ChartNo:m.data.ChartNo,UserID:h,InpNo:g,OpenRecordID:(!Ext.isEmpty(n))?n:""},success:function(o){var p=Ext.decode(o.responseText);if(Ext.isEmpty(p)){p=null;delete p;return}k.setValue("");k.setValue(p.MainMasterID);if(Ext.isEmpty(p.Notes.NotesID)){}else{f.setValue(p.Notes.Content);e.setValue(p.Notes.Title);j.setValue(p.Notes.ValueMemo)}d.setMasked(false);p=null;delete p},failure:function(){d.setMasked(false)}});g=null;a=null;b=null;delete g;delete a;delete b},LoadInpNursingNoteHistroy:function(b){if(Ext.getStore("sPtNoteListInpForm").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sPtNoteListInpForm");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNo,FunctionType:"Problem"});a.loadPage(1,null,this);a=null;delete a},LoadWdisprogNote:function(d,a){if(Ext.getStore("sNoteWdisprognotes").isLoading()||Ext.isEmpty(d)){return}var b=Ext.getStore("sNoteWdisprognotes");b.removeAll();b.getProxy().setExtraParams({ChartNo:d.data.ChartNo,InpNo:d.data.InpNo});b.loadPage(1,{callback:function(f,e,g){},scope:a});b=null;delete b;d=null;delete d}},config:{centered:true,height:"90%",width:"90%",layout:{type:"hbox"},modal:true,caller:{},formRecord:{},successFn:{},items:[{xtype:"tabpanel",itemId:"NNINP_FormEditPanel",width:"50%",items:[{xtype:"container",title:"記錄",layout:{type:"fit"},items:[{xtype:"panel",height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"textfield",hidden:true,itemId:"NNINP_NoteMainMasterID",label:"Field"},{xtype:"panel",itemId:"NNINP_NoteDateTimePanel"},{xtype:"panel",items:[{xtype:"textfield",itemId:"NNINP_NoteTitle",margin:"5 0 5 0",label:"Note",labelWidth:"20%",placeHolder:"請輸入"}]},{xtype:"panel",hidden:true,itemId:"problemScorePanel",layout:{type:"vbox"},items:[{xtype:"panel",layout:{type:"hbox"},items:[{xtype:"button",html:"<span>潛在<br>問題</span>",itemId:"mybutton237",margin:"0px 6px 0px 3px",minHeight:"3.6em",ui:"action",width:"18%",text:"0分"},{xtype:"button",html:"<span>變差</spna>",itemId:"mybutton238",margin:"0px 6px 0px 3px",minHeight:"3.6em",ui:"action",width:"18%",text:"1分"},{xtype:"button",html:"<spna>不變</span>",itemId:"mybutton239",margin:"0px 6px 0px 3px",minHeight:"3.6em",ui:"action",width:"18%",text:"2分"},{xtype:"button",html:"<spna>改善中</span>",itemId:"mybutton240",margin:"0px 6px 0px 3px",minHeight:"3.6em",ui:"action",width:"18%",text:"3分"},{xtype:"button",html:"<spna>完全<br>改善</span>",itemId:"mybutton241",margin:"0px 6px 0px 3px",minHeight:"3.6em",ui:"action",width:"18%",text:"4分"}]},{xtype:"textfield",itemId:"problemScore",minHeight:"2.6em",label:"護理評值:",labelWidth:"50%",readOnly:true},{xtype:"togglefield",hidden:true,itemId:"problemCheckStop",minWidth:"2.6em",label:"停用此問題"}]},{xtype:"panel",height:"100%",maxHeight:360,width:"100%",items:[{xtype:"textareafield",itemId:"NNINP_NoteContent",width:"100%",label:"記錄內容",labelWidth:"20%",placeHolder:"請輸入護理記錄內容, 可利用右方範本進行帶入",maxRows:16}]}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",html:'<span style="color:White;"> 關 閉 </span>',itemId:"NNOTE_InpFormCancelBtn",ui:"confirm-back",width:"30%",text:"MyButton66"},{xtype:"button",html:'<span style="color:Black;"> 暫 存 </span>',itemId:"NNOTE_InpFormTempSaveBtn",ui:"confirm",width:"30%",text:"MyButton66"},{xtype:"button",html:'<span style="color:red;"> 存 檔 </span>',itemId:"NNOTE_InpFormSaveBtn",ui:"confirm",width:"30%",text:"MyButton66"}]}]}]},{xtype:"tabpanel",itemId:"NNINP_NoteFornFunctionPanel",width:"50%",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"範本",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNINP_FormTemplateList",disableSelection:true,itemTpl:["<div>",'    <span style="color:Black;">',"        ",'        <pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Content}',"        </pre>","    </span>","</div>"]}]},{xtype:"container",title:"健康問題",itemId:"NNINP_noteFornHealthPanel",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"top",items:[{xtype:"selectfield",itemId:"problemSelectTitle",width:"100%",label:"健康問題",labelWidth:"25%",displayField:"DisplayTitle",valueField:"OpenRecordID"}]},{xtype:"panel",height:"30%",html:'<div id="_problemScoreChartDiv" style="width: 99%; height: 140px;"></div></br>',itemId:"ProblemScoreChart",width:"100%",scrollable:"vertical"},{xtype:"panel",height:"69%",itemId:"ProblemHistoryPanelV1",width:"100%",layout:{type:"fit"},items:[{xtype:"list",itemId:"ProblemHistoryListV1",itemTpl:["<table>",'<tr align="left" width="100%">',"    ",'<td  rowspan="1" align="left" width="100%">','    <span style="font-weight:bold;"> 健康問題</span><br line-height:0.1px;>','    <span style="font-weight:bold;"> 	日期 : </span> {[NisTRApp.view.FormUtil.MedicalDateFormat(values.MedicalDate)]}  <br line-height:0.1px;>','    <span style="font-weight:bold;"> 	人員 : </span><span style="color:blue;">{UserName}</span><br line-height:0.1px;>',"    ","   ",'     <tpl if= "Cause != null && Cause != &quot;&quot;"> ','         <span style="font-weight:bold;"> 	導因 : </span> {Cause}',"         <br line-height:0.1px;>","     </tpl>   ","   ",'    <span style="font-weight:bold;"> 	計畫 : </span><span style="font-weight:bold;color:#9400D3;"><br line-height:0.1px;> {Plan}</span><br line-height:0.1px;>',"    ",'     <tpl if= "Tech != null && Tech != &quot;&quot;"> ',"         <br line-height:0.1px;>",'         <span style="font-weight:bold;"> 衛教 : </span>','         <span style="font-weight:bold;color:#008B8B;"><br line-height:0.1px;> {Tech} </span> <br line-height:0.1px;>',"     </tpl>  ","","</td>","    ","</tr>","      ",'    <tpl for="Notes">','        <tr align="left" width="100%">  ','         <td BGColor="Linen" align="left">  ','           <span  style="font-size:14pt; font-weight:bold;color:black;">護理記錄</span><br line-height:0.1px;>',"       ",'            <span style="font-weight:bold;">記錄者:  </span><span style="color:blue;">{NurseName}</span>  <span style="font-weight:bold;">評值:</span><span style="color:blue;">{ValueMemo}</span>',"    		<br line-height:0.1px;>",'             <span  style="font-size:14pt; font-weight:bold;color:black;">記錄日期: </span>{MedicalDateFormat}&nbsp;{MedicalTimeFormat}',"            <br line-height:0.1px;>",'            <span style="font-weight:bold;">記錄內容:  </span>',"            ",'            <tpl if= "Content != null && Content != &quot;&quot;">',"                <br line-height:0.1px;>",'                <span style="color:blue;">{Content}</span>',"            </tpl>     ","    		<br line-height:0.1px;><br line-height:0.1px;>","","        </td>","            ","      	 </tr>",'        <tr align="left" width="100%">',"            <td><br line-height:0.1px;></td>","        </tr>","    </tpl>","","","    ","</table>",""],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}]}]},{xtype:"container",title:"記錄歷程",itemId:"NNOTE_FormInpNursingNotesPanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOTE_FormInpNursingNotesHistroy",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'    <span class="posted" style="color:black;font-weight:bold;"> 【{Title}】</span> <span>日期 : {MedicalDateFormat}&nbsp;{MedicalTimeFormat} 人員:{UserName} </span>',"    ","</div>","","",'<tpl if= "ValueMemo != &quot;&quot;"> ',"	<br>","    <div>",'    	<span >評值 : <span style="color:green;font-weight:bold;" > {ValueMemo} </span></span>',"    </div>    ","</tpl>","","<br>",'<div style="font-size:medium;"> ','    <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{HtmlEncodeContent}</pre></span>',"    ","</div>"],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sPtNoteListInpForm").getCount()<=0){NisTRApp.view.Nur.INP_NotesEditPanel.LoadInpNursingNoteHistroy(this.getRecord())}},event:"painted"}]},{xtype:"container",title:"醫療記錄",itemId:"NNOTE_InpWdisprognotePanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NNOTE_InpWdisprognote",styleHtmlContent:true,disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<table>",'    <tr><td><pre style="width:410px; word-break: break-all; word-wrap: break-word;">{Note}</pre></td></tr>',"</table>","","      ",""],plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}],listeners:[{fn:function(b,a){if(Ext.getStore("sNoteWdisprognotes").getCount()<=0){NisTRApp.view.Nur.INP_NotesEditPanel.LoadWdisprogNote(this.getRecord(),this)}},event:"painted"}]}]}],listeners:[{fn:"onMybutton237Tap",event:"tap",delegate:"#mybutton237"},{fn:"onMybutton238Tap",event:"tap",delegate:"#mybutton238"},{fn:"onMybutton239Tap",event:"tap",delegate:"#mybutton239"},{fn:"onMybutton240Tap",event:"tap",delegate:"#mybutton240"},{fn:"onMybutton241Tap",event:"tap",delegate:"#mybutton241"},{fn:"onProblemCheckStopChange",event:"change",delegate:"#problemCheckStop"},{fn:"onNNOTE_InpFormCancelBtnTap",event:"tap",delegate:"#NNOTE_InpFormCancelBtn"},{fn:"onNNOTE_InpFormTempSaveBtnTap",event:"tap",delegate:"#NNOTE_InpFormTempSaveBtn"},{fn:"onNNOTE_InpFormSaveBtnTap",event:"tap",delegate:"#NNOTE_InpFormSaveBtn"},{fn:"onNNINP_FormTemplateListItemTap",event:"itemtap",delegate:"#NNINP_FormTemplateList"},{fn:"onProblemSelectTitleChange",event:"change",delegate:"#problemSelectTitle"},{fn:"onNNINP_noteFornHealthPanelUpdatedata",event:"updatedata",delegate:"#NNINP_noteFornHealthPanel"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onMybutton237Tap:function(b,d,a){this.down("#problemScore").setValue("潛在問題");this.down("#problemScore").setLabel("護理評值:");this.down("#problemCheckStop").setHidden(true);this.down("#problemCheckStop").setValue("0")},onMybutton238Tap:function(b,d,a){this.down("#problemScore").setValue("變差");this.down("#problemScore").setLabel("護理評值:");this.down("#problemCheckStop").setHidden(true);this.down("#problemCheckStop").setValue("0")},onMybutton239Tap:function(b,d,a){this.down("#problemScore").setValue("不變");this.down("#problemScore").setLabel("護理評值:");this.down("#problemCheckStop").setHidden(true);this.down("#problemCheckStop").setValue("0")},onMybutton240Tap:function(b,d,a){this.down("#problemScore").setValue("改善中");this.down("#problemScore").setLabel("護理評值:");this.down("#problemCheckStop").setHidden(true);this.down("#problemCheckStop").setValue("0")},onMybutton241Tap:function(b,d,a){this.down("#problemScore").setValue("完全改善");this.down("#problemScore").setLabel("護理評值:");this.down("#problemCheckStop").setHidden(false);this.down("#problemCheckStop").setValue("0")},onProblemCheckStopChange:function(f,d,a,b){if(d==1&&this.down("#NNINP_NoteContent").getValue().indexOf("停用此健康問題")<0){var e="停用此健康問題\r"+this.down("#NNINP_NoteContent").getValue();this.down("#NNINP_NoteContent").setValue(e)}},onNNOTE_InpFormCancelBtnTap:function(b,d,a){this.destroy()},onNNOTE_InpFormTempSaveBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())){return}if(this.down("#NNINP_NoteDateTime").getValue()>new Date()){NisTRApp.view.Misc.Alert("紀錄日期大於現在時間, 重填! ",0);return}if(!this.down("#problemScorePanel").isHidden()){if(this.down("#problemScore").getValue()==""){NisTRApp.view.Misc.Alert("請點選護理評值",0);return}if(this.down("#problemScore").getValue()=="變差"||this.down("#problemScore").getValue()=="不變"){if(this.down("#NNINP_NoteContent").getValue()==""){NisTRApp.view.Misc.Alert("請輸入記錄內容",0);return}}}else{if(String.IsNull(this.down("#NNINP_NoteContent").getValue())){NisTRApp.view.Misc.Alert("請輸入記錄內容",0);return}}this.SaveNotes(this.getRecord(),this.getFormRecord(),false,this)},onNNOTE_InpFormSaveBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())){return}if(this.down("#NNINP_NoteDateTime").getValue()>new Date()){NisTRApp.view.Misc.Alert("紀錄日期大於現在時間, 重填! ",0);return}if(!this.down("#problemScorePanel").isHidden()){if(this.down("#problemScore").getValue()==""){NisTRApp.view.Misc.Alert("請點選護理評值",0);return}if(this.down("#problemScore").getValue()=="變差"||this.down("#problemScore").getValue()=="不變"){if(this.down("#NNINP_NoteContent").getValue()==""){NisTRApp.view.Misc.Alert("請輸入記錄內容",0);return}}}else{if(String.IsNull(this.down("#NNINP_NoteContent").getValue())){NisTRApp.view.Misc.Alert("請輸入記錄內容",0);return}}this.SaveNotes(this.getRecord(),this.getFormRecord(),true,this)},onNNINP_FormTemplateListItemTap:function(b,f,j,a,h,g){var d=this.down("#NNINP_NoteContent").getValue();d=d+a.data.Content;this.down("#NNINP_NoteContent").setValue(d);d=null;delete d},onProblemSelectTitleChange:function(a,f,d,e){if(this.down("#NNINP_noteFornHealthPanel").isHidden()){return}NisTRApp.view.Nur.INP_NotesEditPanel.LoadProblemHistory(f,this.getRecord(),this);NisTRApp.view.Nur.INP_NotesEditPanel.LoadProblemScoreData(f,this.getRecord(),this);if(d=="NULLRECORD"&&Ext.getStore("sInpNoteFormProblemList").getCount()>0){var b=Ext.getStore("sInpNoteFormProblemList").find("OpenRecordID","NULLRECORD");if(b>=0){Ext.getStore("sInpNoteFormProblemList").removeAt(b)}b=null;delete b}if(f!="NULLRECORD"&&f!=d){var b=Ext.getStore("sInpNoteFormProblemList").find("OpenRecordID",f);if(b>=0){this.setFormRecord(Ext.getStore("sInpNoteFormProblemList").getAt(b));this.reset();this.initForm(this.getRecord(),this.getFormRecord(),this)}b=null;delete b}},onNNINP_noteFornHealthPanelUpdatedata:function(a,d,b){NisTRApp.view.Nur.INP_NotesEditPanel.LoadHealthProblem(this.getRecord(),this)},onContainerDestroy:function(a){Ext.Viewport.removeListener("resize",_resize_inpNoteEditPaenl,this);_resize_inpNoteEditPaenl=null;delete _resize_inpNoteEditPaenl;if(!Ext.isEmpty(Ext.getStore("sInpFrmTemplate"))){Ext.getStore("sInpFrmTemplate").removeAll();Ext.getStore("sInpFrmTemplate").destroy()}if(!Ext.isEmpty(Ext.getStore("sInpNoteFormProblemList"))){Ext.getStore("sInpNoteFormProblemList").removeAll();Ext.getStore("sInpNoteFormProblemList").destroy()}if(!Ext.isEmpty(Ext.getStore("sNoteFormProblemHistory"))){Ext.getStore("sNoteFormProblemHistory").removeAll();Ext.getStore("sNoteFormProblemHistory").destroy()}if(!Ext.isEmpty(Ext.getStore("sProblemScore"))){Ext.getStore("sProblemScore").removeAll();Ext.getStore("sProblemScore").destroy()}if(!Ext.isEmpty(Ext.getStore("sPtNoteListInpForm"))){Ext.getStore("sPtNoteListInpForm").removeAll();Ext.getStore("sPtNoteListInpForm").destroy()}if(!Ext.isEmpty(Ext.getStore("sNoteWdisprognotes"))){Ext.getStore("sNoteWdisprognotes").removeAll();Ext.getStore("sNoteWdisprognotes").destroy()}if($("#_problemScoreChartDiv").highcharts()){$("#_problemScoreChartDiv").highcharts().destroy()}$("#_problemScoreChartDiv").html("");console.log("NurINP_NotesEditPanel on destroy");this.removeAll(true,true)},onContainerShow:function(a,b){},initialize:function(){this.callParent();_resize_inpNoteEditPaenl=function(e,d){this.setHeight(NisTRApp.view.SysUtility.ClcHeight(85));this.setWidth(NisTRApp.view.SysUtility.ClcWidth(90))};Ext.Viewport.addListener("resize",_resize_inpNoteEditPaenl,this);if(Ext.isEmpty(this.down("#NNINP_NoteDateTime"))){var a=Ext.create("Ext.ux.field.DateTimePicker",{itemId:"NNINP_NoteDateTime",name:"NoteDateTime",label:"醫療日期",value:new Date(),width:"99%",labelWidth:"20%",autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}});this.down("#NNINP_NoteDateTimePanel").add(a);a=null;delete a}if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("NurNote 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("NurNote 住院病人資料錯誤");return false}var b=this.getFormRecord();if(Ext.isEmpty(Ext.getStore("sInpFrmTemplate"))){Ext.create("Ext.data.Store",{storeId:"sInpFrmTemplate",autoLoad:false,model:"NisTRApp.model.Form.FrmTemplateEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Form/Template.ashx",reader:{type:"json"}}})}this.down("#NNINP_FormTemplateList").setStore(Ext.getStore("sInpFrmTemplate"));if(Ext.isEmpty(Ext.getStore("sInpNoteFormProblemList"))){Ext.create("Ext.data.Store",{storeId:"sInpNoteFormProblemList",autoLoad:false,model:"NisTRApp.model.Form.OpenRecord",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Problem",Discontinue:false,Wrap:false,AllFlag:true},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecordNursingNotes.ashx",reader:{type:"json"}}})}this.down("#problemSelectTitle").setStore(Ext.getStore("sInpNoteFormProblemList"));this.down("#NNINP_noteFornHealthPanel").setRecord(this.getRecord());if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.data.OpenRecordID)){this.down("#NNINP_NoteFornFunctionPanel").setActiveItem(1)}if(Ext.isEmpty(Ext.getStore("sNoteFormProblemHistory"))){Ext.create("Ext.data.Store",{storeId:"sNoteFormProblemHistory",autoLoad:false,pageSize:1,clearOnPageLoad:false,model:"NisTRApp.model.Form.mNursingNotesHistory",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/NursingNotesHistory.ashx",reader:{type:"json",rootProperty:"MainMasterID"}}})}this.down("#ProblemHistoryListV1").setStore(Ext.getStore("sNoteFormProblemHistory"));if(Ext.isEmpty(Ext.getStore("sProblemScore"))){Ext.create("Ext.data.Store",{storeId:"sProblemScore",autoLoad:false,model:"NisTRApp.model.Form.NursingNotes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/NursingNotesListByQuestion.ashx",reader:{type:"json"}}})}if(Ext.isEmpty(Ext.getStore("sPtNoteListInpForm"))){Ext.create("Ext.data.Store",{storeId:"sPtNoteListInpForm",autoLoad:false,pageSize:5,model:"NisTRApp.model.Form.NursingNotes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/NursingNotesListInp.ashx",reader:{type:"json"}}})}this.down("#NNOTE_FormInpNursingNotesPanel").setRecord(this.getRecord());this.down("#NNOTE_FormInpNursingNotesHistroy").setStore(Ext.getStore("sPtNoteListInpForm"));this.reset();if(!(!Ext.isEmpty(b)&&!Ext.isEmpty(b.data.OpenRecordID))){this.initForm(this.getRecord(),this.getFormRecord(),this)}if(Ext.isEmpty(Ext.getStore("sNoteWdisprognotes"))){Ext.create("Ext.data.Store",{storeId:"sNoteWdisprognotes",autoLoad:false,pageSize:5,model:"NisTRApp.model.Note.WdisprognoteEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/ProgressNote.ashx",reader:{type:"json"}}})}this.down("#NNOTE_InpWdisprognotePanel").setRecord(this.getRecord());this.down("#NNOTE_InpWdisprognote").setStore(Ext.getStore("sNoteWdisprognotes"));b=null;delete b},reset:function(){var a=this.getFormRecord();this.down("#NNINP_NoteTitle").setValue("");this.down("#NNINP_NoteContent").setValue("");this.down("#NNINP_NoteDateTime").setValue(new Date());this.down("#NNINP_NoteTitle").reset();this.down("#NNINP_NoteTitle").setLabel("Note");this.down("#NNINP_NoteMainMasterID").setValue((!Ext.isEmpty(a)&&!Ext.isEmpty(a.data.MainMasterID)?a.data.MainMasterID:""));this.down("#problemCheckStop").setValue("0");this.down("#problemScorePanel").setHidden(true);this.down("#problemCheckStop").setHidden(true);this.down("#problemScore").setValue("");this.down("#problemScore").setLabel("護理評值:");a=null;delete a},initForm:function(e,a,b){if(Ext.isEmpty(e)||Ext.isEmpty(b)){return}b.down("#NNINP_NoteMainMasterID").setValue("");b.down("#NNINP_NoteTitle").setValue("");b.down("#NNINP_NoteContent").setValue("");b.down("#NNINP_NoteDateTime").setValue(new Date());b.down("#NNINP_NoteTitle").reset();b.down("#NNINP_NoteTitle").setLabel("Note");if(!Ext.isEmpty(a)){b.down("#NNINP_NoteMainMasterID").setValue((!Ext.isEmpty(a.data.MainMasterID)?a.data.MainMasterID:""));if(a.data.formID=="IEG6CEODOFHUPDPJYBTYTVGALI"){b.down("#NNINP_NoteTitle").setReadOnly(null)}else{b.down("#NNINP_NoteTitle").setReadOnly(true)}if(a.data.text=="空白"){b.down("#NNINP_NoteTitle").setValue("")}else{b.down("#NNINP_NoteTitle").setLabel("Note");b.down("#NNINP_NoteTitle").setValue(a.data.text)}}if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data.FormID)&&(Ext.getStore("sInpFrmTemplate").getCount()<=0||Ext.getStore("sInpFrmTemplate").getAt(0).data.FormID!=a.data.FormID)){NisTRApp.view.Nur.INP_NotesEditPanel.LoadTempSaveNote(a.data.FormID,NisTRApp.view.SysUtility.getUserID(),e,(!Ext.isEmpty(a.data.OpenRecordId))?a.data.OpenRecordId:"",b.down("#NNINP_NoteMainMasterID"),b.down("#NNINP_NoteContent"),b.down("#NNINP_NoteTitle"),b.down("#problemScore"),b.down("#NNINP_FormEditPanel"))}if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data.OpenRecordID)){this.down("#problemScorePanel").setHidden(false);this.down("#problemCheckStop").setHidden(true)}if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data.FormID)&&(Ext.getStore("sInpFrmTemplate").getCount()<=0||Ext.getStore("sInpFrmTemplate").getAt(0).data.FormID!=a.data.FormID)){var d=Ext.getStore("sInpFrmTemplate");d.removeAll();d.getProxy().setExtraParams({FormID:a.data.FormID});d.load();d=null;delete d}a=null;delete a},SaveNotes:function(j,b,d,a){var g=this.down("#NNINP_NoteDateTime").getFormattedValue("Y-m-d H:i");var e=this.down("#NNINP_NoteContent").getValue();var f=this.down("#NNINP_NoteTitle").getValue();var k=this.down("#NNINP_NoteMainMasterID").getValue();var l="";switch(this.down("#problemScore").getValue()){case"潛在問題":l=0;break;case"變差":l=1;break;case"不變":l=2;break;case"改善中":l=3;break;case"完全改善":l=4;break;default:l="";break}var h={ChartNo:j.data.ChartNo,ChartSeq:(j.data.ChartSeq?j.data.ChartSeq:0),InpNo:j.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),MainMasterID:k,FormID:b.data.FormID,MedicalDate:g,Html:"",Finished:d,Title:f,Content:e,Value:l};a.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/Form/SaveNotesWithJson.ashx",scope:this,method:"POST",params:{Json:btoa(encodeURIComponent(JSON.stringify(h)))},success:function(m){NisTRApp.view.Misc.Alert("存檔成功",800);a.setMasked(false);if(d&&!Ext.isEmpty(b.data.OpenRecordID)&&!Ext.isEmpty(Ext.getStore("sNoteFormProblemHistory"))){Ext.getStore("sNoteFormProblemHistory").load()}if(d&&!Ext.isEmpty(b.data.OpenRecordID)&&!Ext.isEmpty(Ext.getStore("sProblemScore"))){NisTRApp.view.Nur.INP_NotesEditPanel.LoadProblemScoreData(b.data.OpenRecordID,a.getRecord(),a)}if(d&&!Ext.isEmpty(Ext.getStore("sPtNoteListInpForm"))&&(Ext.getStore("sPtNoteListInpForm").getCount()>0)){NisTRApp.view.Nur.INP_NotesEditPanel.LoadInpNursingNoteHistroy(j)}if(d&&!Ext.isEmpty(b.data.OpenRecordID)&&!Ext.isEmpty(a.down("#problemCheckStop"))&&a.down("#problemCheckStop").getValue()==1){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/DistinueRecord.ashx",scope:this,method:"POST",params:{OpenRecordID:b.data.OpenRecordID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(n){NisTRApp.view.Misc.Alert("已停用此問題",800)},failure:function(){NisTRApp.view.Misc.Alert("已停失敗",0)}})}if(!Ext.isEmpty(a.getSuccessFn())){a.getSuccessFn()(d)}},failure:function(){NisTRApp.view.Misc.Alert("存檔失敗",0);a.setMasked(false)}},a);h=null;delete h;e=null;delete e;f=null;delete f;k=null;delete k;g=null;delete g;l=null;delete l},LoadInpNursingNoteHistroy:function(){}});Ext.define("NisTRApp.view.NHTINP_PatientSign",{extend:Ext.field.Text,alias:"widget.patientsignbar",config:{sigWidth:350,sigHeight:150,label:"Field",component:{xtype:"field",type:"text",fastFocus:true}},initCanvas:function(){this.bMouseIsDown=false;oCanvas=this.actionOverlayCanvas.element.dom.firstChild;if(oCanvas){this.oCanvas=oCanvas;oCanvas.setAttribute("width",this.width);oCanvas.setAttribute("height",this.height);this.oCtx=oCanvas.getContext("2d");this.oCtx.fillStyle="#FFFFFF";this.oCtx.fillRect(0,0,this.width,this.height)}HTMLCanvasElement.prototype.relMouseCoords=this.relMouseCoords},openCanvasSheet:function(){this.actionOverlay.show()},relMouseCoords:function(h){var g=0;var f=0;var b=0;var a=0;var d=this;do{g+=d.offsetLeft;f+=d.offsetTop}while(d=d.offsetParent);b=h.pageX-g;a=h.pageY-f;return{x:b,y:a}},canvasTouchStart:function(a){this.bMouseIsDown=true;coords=this.actionOverlayCanvas.element.dom.firstChild.relMouseCoords(a);this.iLastX=coords.x;this.iLastY=coords.y},canvasTouchEnd:function(){this.bMouseIsDown=false;this.iLastX=-1;this.iLastY=-1},canvasTouchMove:function(b){if(this.bMouseIsDown){b.stopPropagation();coords=this.actionOverlayCanvas.element.dom.firstChild.relMouseCoords(b);var a=coords.x;var d=coords.y;this.oCtx.beginPath();this.oCtx.moveTo(this.iLastX,this.iLastY);this.oCtx.lineTo(a,d);this.oCtx.strokeStyle="rgba(0,0,0, 1)";this.oCtx.lineWidth=2;this.oCtx.stroke();this.oCtx.closePath();this.iLastX=a;this.iLastY=d}},saveCanvas:function(){var f=this.actionOverlayCanvas.element.dom.firstChild;var e=f.toDataURL();this.actionOverlay.hide();this.resetCanvas();this.setValue(e);var g=this;var d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAwAAAAFeCAYAAAAymnggAAAV";var b=[];$("input[name='InpSignCheck']").each(function(){var j=document.getElementById($(this).attr("id"));if(j.checked){b.push(j.value)}});if(b.length<=0){Ext.Msg.alert("請選擇簽署項目!");return}if((this.getValue()==null)||(this.getValue()=="")||(this.getValue().search(d)>-1)){NisTRApp.view.Misc.Alert("請簽名!",1000);return}var a=encodeURIComponent(this.getValue());if(b.length>0){var h=new Object();h.UserID=NisTRApp.view.SysUtility.GetUserID();h.PatientSignature=a;h.OpenRecordIDs=b;Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Form/PatientSignTech.ashx",useDefaultXhrHeader:false,scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),PatientSignature:a,OpenRecordIDs:b},success:function(j){Ext.Viewport.setMasked(false);if(!Ext.isEmpty(Ext.getStore("sInpInactHealthTeach"))&&!Ext.getStore("sInpInactHealthTeach").isLoading()){Ext.getStore("sInpInactHealthTeach").load()}if(!Ext.isEmpty(Ext.getStore("sInpActHealthTeach"))&&!Ext.getStore("sInpActHealthTeach").isLoading()){Ext.getStore("sInpActHealthTeach").load()}},failure:function(){g.setValue(null);Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert("簽署失敗!",0)}});h=null;delete h}a=null;delete a},setValue:function(a){this.getComponent().setHtml('<div style="display:none"><img src="'+a+'" width="'+this.width+'"  height="'+this.height+'" /></div>');this.fieldValue=a},getValue:function(){return this.fieldValue},resetCanvas:function(){canvas=this.actionOverlayCanvas.element.dom.firstChild;c=canvas.getContext("2d");c.clearRect(0,0,canvas.width,canvas.height);c.beginPath();if(null!=this.getParent()){this.getParent().show()}this.show()},JPEGEncoder:function(m){var o=this;var F=Math.round;var N=Math.floor;var h=new Array(64);var M=new Array(64);var T=new Array(64);var aa=new Array(64);var D;var j;var s;var W;var L=new Array(65535);var n=new Array(65535);var R=new Array(64);var U=new Array(64);var k=[];var E=0;var a=7;var G=new Array(64);var e=new Array(64);var X=new Array(64);var f=new Array(256);var H=new Array(2048);var C;var Q=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var g=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var b=[0,1,2,3,4,5,6,7,8,9,10,11];var B=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var v=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var ab=[0,1,2,3,4,5,6,7,8,9,10,11];var p=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var x=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function O(aj){var ai=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var ah=0;ah<64;ah++){var am=N((ai[ah]*aj+50)/100);if(am<1){am=1}else{if(am>255){am=255}}h[Q[ah]]=am}var ak=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var ag=0;ag<64;ag++){var al=N((ak[ag]*aj+50)/100);if(al<1){al=1}else{if(al>255){al=255}}M[Q[ag]]=al}var af=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var ae=0;for(var an=0;an<8;an++){for(var ad=0;ad<8;ad++){T[ae]=(1/(h[Q[ae]]*af[an]*af[ad]*8));aa[ae]=(1/(M[Q[ae]]*af[an]*af[ad]*8));ae++}}}function K(ah,ai){var ag=0;var aj=0;var af=new Array();for(var ad=1;ad<=16;ad++){for(var ae=1;ae<=ah[ad];ae++){af[ai[aj]]=[];af[ai[aj]][0]=ag;af[ai[aj]][1]=ad;aj++;ag++}ag*=2}return af}function Z(){D=K(g,b);j=K(A,ab);s=K(B,v);W=K(p,x)}function y(){var ae=1;var ag=2;for(var ad=1;ad<=15;ad++){for(var af=ae;af<ag;af++){n[32767+af]=ad;L[32767+af]=[];L[32767+af][1]=ad;L[32767+af][0]=af}for(var ah=-(ag-1);ah<=-ae;ah++){n[32767+ah]=ad;L[32767+ah]=[];L[32767+ah][1]=ad;L[32767+ah][0]=ag-1+ah}ae<<=1;ag<<=1}}function Y(){for(var ad=0;ad<256;ad++){H[ad]=19595*ad;H[(ad+256)>>0]=38470*ad;H[(ad+512)>>0]=7471*ad+32768;H[(ad+768)>>0]=-11059*ad;H[(ad+1024)>>0]=-21709*ad;H[(ad+1280)>>0]=32768*ad+8421375;H[(ad+1536)>>0]=-27439*ad;H[(ad+1792)>>0]=-5329*ad}}function ac(ae){var af=ae[0];var ad=ae[1]-1;while(ad>=0){if(af&(1<<ad)){E|=(1<<a)}ad--;a--;if(a<0){if(E==255){u(255);u(0)}else{u(E)}a=7;E=0}}}function u(ad){k.push(f[ad])}function J(ad){u((ad>>8)&255);u((ad)&255)}function P(a1,ay){var aP,aO,aN,aM,aL,aJ,aI,aG;var aS=0;var aU;const ax=8;const aq=64;for(aU=0;aU<ax;++aU){aP=a1[aS];aO=a1[aS+1];aN=a1[aS+2];aM=a1[aS+3];aL=a1[aS+4];aJ=a1[aS+5];aI=a1[aS+6];aG=a1[aS+7];var a2=aP+aG;var aR=aP-aG;var a0=aO+aI;var aT=aO-aI;var aZ=aN+aJ;var aV=aN-aJ;var aY=aM+aL;var aW=aM-aL;var av=a2+aY;var ar=a2-aY;var au=a0+aZ;var at=a0-aZ;a1[aS]=av+au;a1[aS+4]=av-au;var aD=(at+ar)*0.707106781;a1[aS+2]=ar+aD;a1[aS+6]=ar-aD;av=aW+aV;au=aV+aT;at=aT+aR;var az=(av-at)*0.382683433;var aC=0.5411961*av+az;var aA=1.306562965*at+az;var aB=au*0.707106781;var an=aR+aB;var am=aR-aB;a1[aS+5]=am+aC;a1[aS+3]=am-aC;a1[aS+1]=an+aA;a1[aS+7]=an-aA;aS+=8}aS=0;for(aU=0;aU<ax;++aU){aP=a1[aS];aO=a1[aS+8];aN=a1[aS+16];aM=a1[aS+24];aL=a1[aS+32];aJ=a1[aS+40];aI=a1[aS+48];aG=a1[aS+56];var ap=aP+aG;var aw=aP-aG;var ak=aO+aI;var aE=aO-aI;var ah=aN+aJ;var aH=aN-aJ;var ae=aM+aL;var aX=aM-aL;var ao=ap+ae;var ad=ap-ae;var aj=ak+ah;var ag=ak-ah;a1[aS]=ao+aj;a1[aS+32]=ao-aj;var al=(ag+ad)*0.707106781;a1[aS+16]=ad+al;a1[aS+48]=ad-al;ao=aX+aH;aj=aH+aE;ag=aE+aw;var aQ=(ao-ag)*0.382683433;var ai=0.5411961*ao+aQ;var a4=1.306562965*ag+aQ;var af=aj*0.707106781;var a3=aw+af;var aF=aw-af;a1[aS+40]=aF+ai;a1[aS+24]=aF-ai;a1[aS+8]=a3+a4;a1[aS+56]=a3-a4;aS++}var aK;for(aU=0;aU<aq;++aU){aK=a1[aU]*ay[aU];R[aU]=(aK>0)?((aK+0.5)|0):((aK-0.5)|0)}return R}function V(){J(65504);J(16);u(74);u(70);u(73);u(70);u(0);u(1);u(1);u(0);J(1);J(1);u(0);u(0)}function I(ae,ad){J(65472);J(17);u(8);J(ad);J(ae);u(3);u(1);u(17);u(0);u(2);u(17);u(1);u(3);u(17);u(1)}function w(){J(65499);J(132);u(0);for(var ae=0;ae<64;ae++){u(h[ae])}u(1);for(var ad=0;ad<64;ad++){u(M[ad])}}function r(){J(65476);J(418);u(0);for(var ah=0;ah<16;ah++){u(g[ah+1])}for(var ag=0;ag<=11;ag++){u(b[ag])}u(16);for(var af=0;af<16;af++){u(B[af+1])}for(var ae=0;ae<=161;ae++){u(v[ae])}u(1);for(var ad=0;ad<16;ad++){u(A[ad+1])}for(var ak=0;ak<=11;ak++){u(ab[ak])}u(17);for(var aj=0;aj<16;aj++){u(p[aj+1])}for(var ai=0;ai<=161;ai++){u(x[ai])}}function q(){J(65498);J(12);u(3);u(1);u(0);u(2);u(17);u(3);u(17);u(0);u(63);u(0)}function l(ah,ad,an,at,ar){var aj=ar[0];var af=ar[240];var ag;const au=16;const ak=63;const ai=64;var av=P(ah,ad);for(var ao=0;ao<ai;++ao){U[Q[ao]]=av[ao]}var aq=U[0]-an;an=U[0];if(aq==0){ac(at[0])}else{ag=32767+aq;ac(at[n[ag]]);ac(L[ag])}var ae=63;for(;(ae>0)&&(U[ae]==0);ae--){}if(ae==0){ac(aj);return an}var ap=1;var ax;while(ap<=ae){var am=ap;for(;(U[ap]==0)&&(ap<=ae);++ap){}var al=ap-am;if(al>=au){ax=al>>4;for(var aw=1;aw<=ax;++aw){ac(af)}al=al&15}ag=32767+U[ap];ac(ar[(al<<4)+n[ag]]);ac(L[ag]);ap++}if(ae!=ak){ac(aj)}return an}function z(){var ae=String.fromCharCode;for(var ad=0;ad<256;ad++){f[ad]=ae(ad)}}this.encode=function(ar,am){var ae=new Date().getTime();if(am){d(am)}k=new Array();E=0;a=7;J(65496);V();w();I(ar.width,ar.height);r();q();var an=0;var au=0;var aq=0;E=0;a=7;this.encode.displayName="_encode_";var az=ar.data;var aw=ar.width;var ap=ar.height;var av=aw*4;var ad=aw*3;var al,ak=0;var ao,ay,aA;var af,at,ah,aj,ai;while(ak<ap){al=0;while(al<av){af=av*ak+al;at=af;ah=-1;aj=0;for(ai=0;ai<64;ai++){aj=ai>>3;ah=(ai&7)*4;at=af+(aj*av)+ah;if(ak+aj>=ap){at-=(av*(ak+1+aj-ap))}if(al+ah>=av){at-=((al+ah)-av+4)}ao=az[at++];ay=az[at++];aA=az[at++];G[ai]=((H[ao]+H[(ay+256)>>0]+H[(aA+512)>>0])>>16)-128;e[ai]=((H[(ao+768)>>0]+H[(ay+1024)>>0]+H[(aA+1280)>>0])>>16)-128;X[ai]=((H[(ao+1280)>>0]+H[(ay+1536)>>0]+H[(aA+1792)>>0])>>16)-128}an=l(G,T,an,D,s);au=l(e,aa,au,j,W);aq=l(X,aa,aq,j,W);al+=32}ak+=8}if(a>=0){var ax=[];ax[1]=a+1;ax[0]=(1<<(a+1))-1;ac(ax)}J(65497);var ag="data:image/jpeg;base64,"+btoa(k.join(""));k=[];return ag};function d(ae){if(ae<=0){ae=1}if(ae>100){ae=100}if(C==ae){return}var ad=0;if(ae<50){ad=Math.floor(5000/ae)}else{ad=Math.floor(200-ae*2)}O(ad);C=ae}function S(){var ae=new Date().getTime();if(!m){m=50}z();Z();y();Y();d(m);var ad=new Date().getTime()-ae}S()},initialize:function(){this.callParent();this.width=this.getSigWidth();this.height=this.getSigHeight();Ext.define("ux.signature.Canvas",{extend:Ext.Component,xtype:"signaturefieldcanvas",template:[{reference:"canvas",tag:"canvas",classList:[Ext.baseCSSPrefix+"canvas"]}]});this.on("painted",this.initCanvas,this);this.element.on("tap",this.openCanvasSheet,this);this.actionOverlayCanvas=Ext.create("ux.signature.Canvas",{});this.resetButton=Ext.create("Ext.Button",{text:"清除",ui:"normal"});this.saveButton=Ext.create("Ext.Button",{text:"確定",ui:"confirm"});this.actionOverlay=Ext.create("Ext.Panel",{modal:true,hidden:true,hideOnMaskTap:true,showAnimation:{type:"popIn",duration:300,easing:"ease-out"},hideAnimation:{type:"popOut",duration:300,easing:"ease-out"},centered:true,items:[this.actionOverlayCanvas,{xtype:"toolbar",docked:"bottom",items:[{xtype:"spacer"},this.resetButton,this.saveButton,{xtype:"spacer"}]}]});Ext.Viewport.add(this.actionOverlay);this.actionOverlayCanvas.element.on("touchstart",this.canvasTouchStart,this);this.actionOverlayCanvas.element.on("touchend",this.canvasTouchEnd,this);this.actionOverlayCanvas.element.on("touchmove",this.canvasTouchMove,this);this.resetButton.element.on("tap",this.resetCanvas,this);this.saveButton.element.on("tap",this.saveCanvas,this);this.actionOverlayCanvas.setStyle("border:1px solid #000;height:"+this.height+"px;width:"+this.width+"px;margin-right:auto;margin-left:auto;margin-top:auto;margin-bottom:auto;");var a=HTMLCanvasElement.prototype.toDataURL;var b=new this.JPEGEncoder();HTMLCanvasElement.prototype.toDataURL=function(f){var e=a.apply(this,arguments);if(e.substr(0,6)=="data:,"){var d=b.encode(this.getContext("2d").getImageData(0,0,this.width,this.height),90);return d}else{return e}}}});Ext.define("NisTRApp.view.Nur.INP_HealthTeach",{extend:Ext.Container,alias:"widget.NurINP_HealthTeach",statics:{OpenHealthTeachForm:function(b){if(Ext.isEmpty(b)){Ext.Msg.alert("INP_HealthTeach 表單網址錯誤");return}try{var d=Ext.getCmp("_inpHealthTeachFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_inpHealthTeachFormPanel",url:b,divID:"InpHealthTeachFrameDIV"})}if(!Ext.isEmpty(d)){var a=Ext.ComponentQuery.query("#NHTINP_MainPanel")[0];d.setCaller(a);d.setCloseFn(function(e){e.setHidden(false)});Ext.ComponentQuery.query("#NHTINP_Main")[0].animateActiveItem(d,{type:"slide",direction:"right"});a.setHidden(true);d.show();a=null;delete a}d=null;delete d;patInfo=null;delete patInfo;b=null;delete b}catch(f){console.log(f)}},LoadActHealthTeachRecord:function(d,b){if(Ext.getStore("sInpActHealthTeach").isLoading()||Ext.isEmpty(d)){return}var a=Ext.getStore("sInpActHealthTeach");a.getProxy().setExtraParams({FunctionType:"Teach",ChartNo:d.data.ChartNo,InpNo:d.data.InpNo,Discontinue:false});a.load();a=null;delete a},RenderActTable:function(d,g){if(Ext.isEmpty(d)||Ext.isEmpty(d.down("#NHTINP_INP_ActiveGridPanel"))){return false}f=function f(h,k,l,m){var j=Ext.getStore("sInpActHealthTeach").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpActHealthTeach").getAt(0).records().getAt(j),k,l)}j=null;delete j};var a=Ext.getStore("sInpActHealthTeach");d.down("#NHTINP_INP_ActiveGridPanel").setHtml("");if(a.getCount()>0){if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.down("#NHTINP_INP_ActiveGridPanel"))){d.down("#NHTINP_INP_ActiveGridPanel").setHtml("");if(!Ext.isEmpty(a.getAt(0))){var e=d.down("#NHTINP_INP_ActiveGridPanel").getTpl().apply(a.getAt(0).data);d.down("#NHTINP_INP_ActiveGridPanel").setHtml(e);var b=NisTRApp.view.SysUtility.tapEventName();$("a[name='nursingHealthTeachActplan']").bind(b,function(){f(this,d,g,NisTRApp.view.Nur.INP_HealthTeach.NursingPlan)});$("a[name='signatureDateActive']").bind(b,function(){f(this,d,g,NisTRApp.view.Nur.INP_HealthTeach.PatientHandwriting)});$("#inpHealthTeachActGridRefresh").bind(b,function(){NisTRApp.view.Nur.INP_HealthTeach.LoadActHealthTeachRecord(d.getRecord(),d)});e=null;delete e;b=null;delete b}}}a=null;delete a},PatientHandwriting:function(e,a,d){var b=function b(g,j){var h=Ext.getCmp("_patientHandwritingPanel");if(!Ext.isEmpty(h)){h.destroy()}if(Ext.isEmpty(h)){h=Ext.create("Ext.Panel",{id:"_patientHandwritingPanel",html:"",centered:true,height:355,styleHtmlContent:true,width:770,hideOnMaskTap:true,modal:true,scrollable:"both"});h.addListener("show",function(l,k){},h);h.addListener("hide",function(l,k){this.destroy()},h);Ext.Viewport.add(h)}var f="<img src="+decodeURIComponent(j)+">";h.setHtml("");h.setHtml(f);h.show();f=null;delete f;h=null;delete h;j=null;delete j;g=null;delete g};Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD});Ext.Ajax.request({url:"../api/Form/PatientHandwriting.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{ChartNo:d.data.ChartNo,OpenRecordID:e.data.OpenRecordID,FormID:e.data.FormID},success:function(f){try{var h=Ext.decode(f.responseText);b(a,h.PatientSignature);b=null;delete b;h=null;delete h}catch(g){}Ext.Viewport.setMasked(false)},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert("病人簽名讀取錯誤!",0);b=null;delete b}})},NursingPlan:function(h,b,g){if(Ext.isEmpty(h.data.FormID)||Ext.isEmpty(g)){return}var e,f,d;if(g.data.Source.Type==1){e="0";f=g.data.Source.Name;d=(g.data.ChartSeq?g.data.ChartSeq:0)}else{if(g.data.Source.Type==2){e=g.data.InpNO;f=g.data.Source.Name;d=0}else{Ext.Msg.alert("NurINP 病人資料錯誤")}}var a=NisTRApp.view.FormUtil.HealthTeachAddr("RenderTeach",h.data.FormID,NisTRApp.view.SysUtility.GetUserID(),g.data.ChartNo,d,h.data.CategoryID,h.data.OpenRecordID,"_ReloadInpHealthTeachData","",e,f);NisTRApp.view.Nur.INP_HealthTeach.OpenHealthTeachForm(a);a=null;delete a;e=null;f=null;d=null;delete e;delete f;delete d},LoadInactHealthTeachRecord:function(d,b){if(Ext.getStore("sInpInactHealthTeach").isLoading()||Ext.isEmpty(d)){return}var a=Ext.getStore("sInpInactHealthTeach");a.getProxy().setExtraParams({FunctionType:"Teach",ChartNo:d.data.ChartNo,InpNo:d.data.InpNo,Discontinue:true});a.load();a=null;delete a},RenderInactTable:function(d,g){if(Ext.isEmpty(d)||Ext.isEmpty(d.down("#NHTINP_INP_InactiveGridPanel"))){return false}f=function f(h,k,l,m){var j=Ext.getStore("sInpInactHealthTeach").getAt(0).records().find("OpenRecordID",$(h).attr("openrecordid"));if(j>=0){m(Ext.getStore("sInpInactHealthTeach").getAt(0).records().getAt(j),k,l)}j=null;delete j};var b=Ext.getStore("sInpInactHealthTeach");d.down("#NHTINP_INP_InactiveGridPanel").setHtml("");if(b.getCount()>0){if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.down("#NHTINP_INP_InactiveGridPanel"))){d.down("#NHTINP_INP_InactiveGridPanel").setHtml("");if(!Ext.isEmpty(b.getAt(0))){var e=d.down("#NHTINP_INP_InactiveGridPanel").getTpl().apply(b.getAt(0).data);d.down("#NHTINP_INP_InactiveGridPanel").setHtml(e);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='nursingHealthTeachInactplan']").bind(a,function(){f(this,d,g,NisTRApp.view.Nur.INP_HealthTeach.NursingPlan)});$("a[name='signatureDateInactive']").bind(a,function(){f(this,d,g,NisTRApp.view.Nur.INP_HealthTeach.PatientHandwriting)});$("#inpHealthTeachInactGridRefresh").bind(a,function(){NisTRApp.view.Nur.INP_HealthTeach.LoadInactHealthTeachRecord(d.getRecord(),d)});$("a[name='RecoverDiscontinue']").bind(a,function(){f(this,d,g,NisTRApp.view.Nur.INP_HealthTeach.RecoverDiscontinue)});e=null;delete e;a=null;delete a}}}sInpActHealthTeach=null;delete sInpActHealthTeach},RecoverDiscontinue:function(d,a,b){Ext.Msg.confirm("注意","確定要取消結案?",function(e){if(e==="yes"){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/Form/RecoverDistinueRecord.ashx",scope:a,method:"POST",params:{OpenRecordID:d.data.OpenRecordID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(f){var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){if(!Ext.isEmpty(Ext.getStore("sInpInactHealthTeach"))){Ext.getStore("sInpInactHealthTeach").load()}if(!Ext.isEmpty(Ext.getStore("sInpActHealthTeach"))){Ext.getStore("sInpActHealthTeach").load()}}g=null;delete g;return false},failure:function(){Ext.Msg.alert("存檔失敗")}})}else{return false}})},LoadFormHistory:function(d,b,a){if(Ext.getStore("sInpHealthTeachHistory").isLoading()||Ext.isEmpty(d)){return}var e=Ext.getStore("sInpHealthTeachHistory");e.removeAll();e.getProxy().setExtraParams({FunctionType:a,InpNo:d.data.InpNo});e.loadPage(1,null,b);e=null;delete e}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NHTINP_Main",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NHTINP_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",width:"20%",layout:{type:"fit"},items:[{xtype:"nestedlist",itemId:"NHTINP_NewHealthTeachList",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"新的衛教指導"}]},{xtype:"tabpanel",width:"80%",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"Active",itemId:"NHTINP_INP_ActiveGridPanel",tpl:Ext.create("Ext.XTemplate","",'<div id="_healthTeachActive" class="globalList" >','<table id="_healthTeachActiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="8" style="text-align:left">衛 教 指 導<span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpHealthTeachActGridRefresh" type="button">重新整理</button></span></th>',"            ","        </tr>","        <tr>",'            <th width="25%">衛教項目</th>','            <th width="15%">開始日期</th>','            <th width="15%">狀態</th>','            <th width="15%">最後追蹤日</th>','            <th width="15%">瀏覽</th>','            <th width="15%">病人簽名</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"	        <tr>",'    	        <td width="25%" align="center" >{Title} {[this.SubTitleStr(values)]}</td>','                <td width="15%" align="center"> {[this.StartDateStr(values)]}</td>','                <td width="15%" align="center">{[this.PlanStatusStr(values)]}</td>','                <td width="15%" align="center">{[this.PlanLatestDateStr(values)]}</td>','                <td width="15%" align="center"><a id="btnView" name="nursingHealthTeachActplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">評估單張</a></td>','                <td width="15%" align="center">{[this.SignStatusStr(values)]}</td>',"              ","            </tr>","       </tpl>        ","      ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="25%">衛教項目</th>','            <th width="15%">開始日期</th>','            <th width="15%">狀態</th>','            <th width="15%">最後追蹤日</th>','            <th width="15%">瀏覽</th>','            <th width="15%">病人簽名</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>","",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},PlanStatusStr:function(a){if(a.Discontinue==true){return"結案"}else{if(a.PlanLatestDate.substring(0,10)!="1753-01-01"){return"待評值"}else{if(a.PlanLatestDate.substring(0,10)=="1753-01-01"){return"未開始"}}}},PlanLatestDateStr:function(a){if(a.PlanLatestDate.substring(0,10)=="1753-01-01"){return""}else{return a.PlanLatestDate.substring(0,16).replace("T","<br>")}},SignStatusStr:function(d){var a="NHTINPACTSIGN_"+d.OpenRecordID;var b='<INPUT id=ACTIVE_"'+a+'" value="'+d.OpenRecordID+'" name="InpSignCheck" TYPE="CHECKBOX" class="boolcheckbox">';if(d.SignatureDate.substring(0,10)=="1753-01-01"||d.SignatureDate.substring(0,10)=="0001-01-01"){}else{b='<a id="'+a+'" class="btn link-btn" name="signatureDateActive" openrecordid="'+d.OpenRecordID+'"style="font-size: 14px">'+NisTRApp.view.DateUtil.FormDateFormat(d.SignatureDate)+"</a>"}return b}}),scrollable:"vertical",listeners:[{fn:function(b,a){Ext.ComponentQuery.query("#NHTINP_PatientSignBar")[0].show()},event:"painted"}]},{xtype:"container",title:"Inactive",itemId:"NHTINP_INP_InactiveGridPanel",tpl:Ext.create("Ext.XTemplate","",'<div id="_healthTeachInactive" class="globalList" >','<table id="_healthTeachInactiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="8" style="text-align:left">衛 教 指 導<span>&nbsp;&nbsp;&nbsp;&nbsp;<button id="inpHealthTeachInactGridRefresh" type="button">重新整理</button></span></th>',"            ","        </tr>","        <tr>",'            <th width="25%">衛教項目</th>','            <th width="12.5%">開始日期</th>','            <th width="12.5%">狀態</th>','            <th width="12.5%">最後追蹤日</th>','            <th width="12.5%">瀏覽</th>','            <th width="12.5%">病人簽名</th>','            <th width="12.5%">取消結案</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"	        <tr>",'    	        <td width="25%" align="center" >{Title} {[this.SubTitleStr(values)]}</td>','                <td width="12.5%" align="center"> {[this.StartDateStr(values)]}</td>','                <td width="12.5%" align="center">{[this.PlanStatusStr(values)]}</td>','                <td width="12.5%" align="center">{[this.PlanLatestDateStr(values)]}</td>','                <td width="12.5%" align="center"><a id="btnView" name="nursingHealthTeachInactplan" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">評估單張</a></td>','                <td width="12.5%" align="center">{[this.SignStatusStr(values)]}</td>','                <td width="12.5%" align="center"><a id="btnView1" name="RecoverDiscontinue" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">取消結案</a></td>',"              ","            </tr>","       </tpl>        ","      ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="25%">衛教項目</th>','            <th width="12.5%">開始日期</th>','            <th width="12.5%">狀態</th>','            <th width="12.5%">最後追蹤日</th>','            <th width="12.5%">瀏覽</th>','            <th width="12.5%">病人簽名</th>','            <th width="12.5%">取消結案</th>',"        </tr>      ","    </tfoot>    ","","</table>","    ","</div>",{SubTitleStr:function(a){if(Ext.isEmpty(a.SubTitle)){return""}else{return'<br><span style="color:blue;font-size:small;">'+a.SubTitle+"</span>"}},StartDateStr:function(a){if(a.StartDate.substring(0,10)=="1753-01-01"){return""}else{return a.StartDate.substring(0,16).replace("T","<br>")}},PlanStatusStr:function(a){if(a.Discontinue==true){return"結案"}else{if(a.PlanLatestDate.substring(0,10)!="1753-01-01"){return"待評值"}else{if(a.PlanLatestDate.substring(0,10)=="1753-01-01"){return"未開始"}}}},PlanLatestDateStr:function(a){if(a.PlanLatestDate.substring(0,10)=="1753-01-01"){return""}else{return a.PlanLatestDate.substring(0,16).replace("T","<br>")}},SignStatusStr:function(d){var a="NHTINPINACTSIGN_"+d.OpenRecordID;var b='<INPUT id=INACTIVE_"'+a+'" value="'+d.OpenRecordID+'" name="InpSignCheck" TYPE="CHECKBOX" class="boolcheckbox">';if(d.SignatureDate.substring(0,10)=="1753-01-01"||d.SignatureDate.substring(0,10)=="0001-01-01"){}else{b='<a id="'+a+'" class="btn link-btn" name="signatureDateInactive" openrecordid="'+d.OpenRecordID+'"style="font-size: 14px">'+NisTRApp.view.DateUtil.FormDateFormat(d.SignatureDate)+"</a>"}return b}}),scrollable:"vertical",listeners:[{fn:function(b,a){Ext.ComponentQuery.query("#NHTINP_PatientSignBar")[0].show();if(Ext.getStore("sInpInactHealthTeach").getCount()<=0){NisTRApp.view.Nur.INP_HealthTeach.LoadInactHealthTeachRecord(this.getRecord(),this)}},event:"painted"}]},{xtype:"container",title:"衛教歷程",itemId:"NHTINP_HistoryPanel",layout:{type:"fit"},listeners:[{fn:function(b,a){Ext.ComponentQuery.query("#NHTINP_PatientSignBar")[0].hide();NisTRApp.view.Nur.INP_HealthTeach.LoadFormHistory(this.getRecord(),this,"Teach")},event:"painted"}],items:[{xtype:"list",itemId:"NHTINP_History",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:Ext.create("Ext.XTemplate","","","<div > ",'<span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span> ',"     ","</div>","<br>"," ",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[this.MedicalDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>'," <br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre>{Html} </pre></span>',"","<div>","",{MedicalDateFormat:function(b){var a=b.toString();return a.substring(0,16).replace("T"," ")}}),plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"NHTINP_PatientSignBar",items:[{xtype:"patientsignbar",sigWidth:768,sigHeight:350,centered:false,docked:"bottom",maxHeight:"2.7em",width:"99%",label:"<div>簽 名 ( 請 點 我 )</div>",labelWidth:"99%"}]}]}]}]}],listeners:[{fn:"onNHTINP_NewHealthTeachListLeafItemTap",event:"leafitemtap",delegate:"#NHTINP_NewHealthTeachList"},{fn:"onNHTINP_INP_ActiveGridPanelUpdatedata",event:"updatedata",delegate:"#NHTINP_INP_ActiveGridPanel"},{fn:"onContainerDestroy",event:"destroy"}]},onNHTINP_NewHealthTeachListLeafItemTap:function(b,l,h,j,g,k,m){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var o=this.getRecord();var f,a,d;if(o.data.Source.Type==1){f="0";a=o.data.Source.Name;d=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){f=o.data.InpNO;a=o.data.Source.Name;d=0}else{Ext.Msg.alert("HealthTeachData 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.HealthTeachAddr("RenderTeach",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,d,"","","_ReloadInpHealthTeachData","new",f,a);NisTRApp.view.Nur.INP_HealthTeach.OpenHealthTeachForm(n);n=null;delete n;f=null;a=null;d=null;delete f;delete a;delete d},onNHTINP_INP_ActiveGridPanelUpdatedata:function(a,d,b){if(Ext.getStore("sInpActHealthTeach").getCount()<=0){NisTRApp.view.Nur.INP_HealthTeach.LoadActHealthTeachRecord(this.getRecord(),this)}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sInpActHealthTeach"))){Ext.getStore("sInpActHealthTeach").removeAll();Ext.getStore("sInpActHealthTeach").destroy()}if(!Ext.isEmpty(Ext.getStore("sInpInactHealthTeach"))){Ext.getStore("sInpInactHealthTeach").removeAll();Ext.getStore("sInpInactHealthTeach").destroy()}if(!Ext.isEmpty(Ext.getStore("sInpHealthTeachHistory"))){Ext.getStore("sInpHealthTeachHistory").removeAll();Ext.getStore("sInpHealthTeachHistory").destroy()}if(!Ext.isEmpty(Ext.getCmp("_inpHealthTeachFormPanel"))){Ext.getCmp("_inpHealthTeachFormPanel").destroy()}_ReloadInpHealthTeachData=null;delete _ReloadInpHealthTeachData;_callNHTINP_ActFn=null;delete _callNHTINP_ActFn;_callNHTINP_InactFn=null;delete _callNHTINP_InactFn;console.log("On Destroy :","Nur Health Teach");this.removeAll(true,true)},initialize:function(){_ReloadInpHealthTeachData=function(){try{if(!Ext.isEmpty(Ext.getStore("sInpInactHealthTeach"))){Ext.getStore("sInpInactHealthTeach").load()}if(!Ext.isEmpty(Ext.getStore("sInpActHealthTeach"))){Ext.getStore("sInpActHealthTeach").load()}if(!Ext.isEmpty(Ext.getCmp("_inpHealthTeachFormPanel"))){Ext.getCmp("_inpHealthTeachFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NHTINP_MainPanel")[0])){Ext.ComponentQuery.query("#NHTINP_MainPanel")[0].show()}}catch(a){console.error("_ReloadInpHealthTeachData",a)}};this.callParent();this.down("#NHTINP_PatientSignBar").setHidden(true);this.down("#NHTINP_PatientSignBar").setHidden(false);this.down("#NHTINP_PatientSignBar").show();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("INP_HealthTeach 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("INP_HealthTeach 住院病人資料錯誤");return false}if(this.getRecord().data.Source.Type!=2){Ext.Msg.alert("OPD_HealthTeach 不支援門診病人");return false}if(Ext.isEmpty(Ext.getStore("sNewInpHealthTeachRecord"))){Ext.create("Ext.data.TreeStore",{storeId:"sNewInpHealthTeachRecord",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Teach",Source:this.getRecord().data.Source.Name},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NHTINP_NewHealthTeachList").setStore(Ext.getStore("sNewInpHealthTeachRecord"));if(Ext.getStore("sNewInpHealthTeachRecord").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sInpActHealthTeach"))){Ext.create("Ext.data.Store",{storeId:"sInpActHealthTeach",model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sInpActHealthTeach").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpActHealthTeach").addListener("load",function(d,b,f,a,e){NisTRApp.view.Nur.INP_HealthTeach.RenderActTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NHTINP_INP_ActiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInpInactHealthTeach"))){Ext.create("Ext.data.Store",{storeId:"sInpInactHealthTeach",model:"NisTRApp.model.Form.OpenRecords",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sInpInactHealthTeach").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpInactHealthTeach").addListener("load",function(d,b,f,a,e){NisTRApp.view.Nur.INP_HealthTeach.RenderInactTable(this,this.getRecord());this.setMasked(false)},this);this.down("#NHTINP_INP_InactiveGridPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInpHealthTeachHistory"))){Ext.create("Ext.data.Store",{storeId:"sInpHealthTeachHistory",model:"NisTRApp.model.EMR.FormRecord",pageSize:5,clearOnPageLoad:false,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/PtFormHistory.ashx",reader:{type:"json",rootProperty:"MasterID"},sorters:{direction:"DESC",property:"MedicalDate"}}})}this.down("#NHTINP_HistoryPanel").setRecord(this.getRecord());this.down("#NHTINP_History").setStore(Ext.getStore("sInpHealthTeachHistory"))},LoadListItem:function(){if(Ext.getStore("sNewInpHealthTeachRecord").isLoading()||Ext.isEmpty(this.getRecord())){return false}var a=Ext.getStore("sNewInpHealthTeachRecord");a.removeAll();a.load();a=null;delete a;return false}});Ext.define("NisTRApp.view.Nur.INP_Prepare",{extend:Ext.Container,alias:"widget.NurINP_Prepare",statics:{OpenPrepareForm:function(b){if(Ext.isEmpty(b)){Ext.Msg.alert("INP_Prepare 表單網址錯誤");return}try{var d=Ext.getCmp("_inpPrepareFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_inpPrepareFormPanel",url:b,divID:"InpPrepareFrameDIV"})}if(!Ext.isEmpty(d)){var a=Ext.ComponentQuery.query("#NPINP_MainPanel")[0];d.setCaller(a);d.setCloseFn(function(e){e.setHidden(false)});Ext.ComponentQuery.query("#NPINP_Main")[0].animateActiveItem(d,{type:"slide",direction:"right"});a.setHidden(true);d.show();a=null;delete a}d=null;delete d;patInfo=null;delete patInfo;b=null;delete b}catch(f){console.log(f)}},LoadSchedulePrepareList:function(b){if(Ext.getStore("sSchedulePrepareList").isLoading()||Ext.isEmpty(b)){return false}var a=Ext.getStore("sSchedulePrepareList");a.removeAll();a.getProxy().setExtraParams({InpNo:b.data.InpNo});a.load();a=null;delete a;return false},LoadPrepareRecord:function(d,a){if(Ext.getStore("sPrepareRecord").isLoading()||Ext.isEmpty(d)){return false}var b=Ext.getStore("sPrepareRecord");b.removeAll();b.getProxy().setExtraParams({FunctionType:"Prepare",ChartNo:d.data.ChartNo,InpNo:d.data.InpNo,Discontinue:false},a);b.load();b=null;delete b;return false},LoadInactivePrepareRecord:function(d,b){if(Ext.getStore("sInactivePrepareRecord").isLoading()||Ext.isEmpty(d)){return false}var a=Ext.getStore("sInactivePrepareRecord");a.removeAll();a.getProxy().setExtraParams({FunctionType:"Prepare",ChartNo:d.data.ChartNo,InpNo:d.data.InpNo,Discontinue:true},b);a.load();a=null;delete a;return false},DeleteForm:function(b,a){try{if(!Ext.isEmpty(a)){a.setMasked({xtype:"loadmask",message:"Please Wait!"})}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/PrepareFormDelete.ashx",scope:this,method:"POST",params:{OpenRecordID:b},success:function(e){if(!Ext.isEmpty(a)){a.setMasked(false)}var f=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(f.Message,(f.Success?800:0));if(f.Success){if(!Ext.isEmpty(Ext.getStore("sPrepareRecord"))&&!Ext.getStore("sPrepareRecord").isLoading()){Ext.getStore("sPrepareRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInactivePrepareRecord"))&&!Ext.getStore("sInactivePrepareRecord").isLoading()){Ext.getStore("sInactivePrepareRecord").load()}if(!Ext.isEmpty(Ext.getStore("sSchedulePrepareList"))&&!Ext.getStore("sSchedulePrepareList").isLoading()){Ext.getStore("sSchedulePrepareList").load()}}f=null;delete f;return false},failure:function(){Ext.Viewport.setMasked(false);Ext.Msg.alert("表單刪除失敗!")}})}catch(d){console.log(d)}},LoadPrepareHistory:function(a,b){if(Ext.getStore("sPrepareHistoryList").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sPrepareHistoryList");d.removeAll();d.getProxy().setExtraParams({FunctionType:"Prepare",InpNo:a.data.InpNo});d.load();d=null;delete d}},config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NPINP_Main",layout:{type:"fit"},items:[{xtype:"panel",itemId:"NPINP_MainPanel",layout:{type:"hbox"},items:[{xtype:"panel",itemId:"NPINP_MainInnerPanel",width:"20%",layout:{type:"vbox"},items:[{xtype:"panel",height:"60%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",html:'<div style="text-align: center;">   <span  style="color: White; font-weight: bolder; font-size: 20pt;">排程清單 </span></div>'},{xtype:"list",itemId:"NP_INP_SchedulePrepareList",disableSelection:false,itemTpl:['<div><font face="Courier New,Comic Sams MS">{PexeDate} {CodeName}</font></div>'],grouped:true,plugins:[{type:"pullrefresh"}]}]},{xtype:"panel",height:"40%",width:"100%",layout:{type:"fit"},items:[{xtype:"nestedlist",itemId:"NP_INP_NewPrepareList",backButton:{ui:"confirm-back",hidden:true},backText:"回上層目錄",title:"緊急口頭排程準備單"}]}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_Prepare.LoadSchedulePrepareList(this.getRecord())},event:"painted"}]},{xtype:"tabpanel",itemId:"NPINP_MainTabPanel",width:"80%",items:[{xtype:"container",title:"準備清單",itemId:"NPINP_PreaprePanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NPINP_PreapreList",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:Ext.create("Ext.XTemplate","<table>","<tr>",'<td  rowspan="1" align="left" width="22%">',"    ",'    <span style="font-size: 14pt; font-weight: bold; color:Black;">{Title}</span>',"    <br line-height:0.1px;>",'    <span style="font-size: 8pt; font-weight: bold; color:blue;">起始日: {[this.DateFormat(values.StartDate)]}</span>',"	<br line-height:0.1px;>",'    <span style="font-size: 8pt; font-weight: bold; color:red;">最後修改日: {[this.DateFormat(values.PlanLatestDate)]}</span>',"</td>",'<td BGColor="Linen" align="left" width="40%">',"    <table>","    	<tr>",'        	<td align="left" width="90%">','           		<span style="font-weight:bold; font-size: 11pt;">{PrepareTitle}</span>',"            </td>",'            <td align="right" width="10%">','                <img id="BIND" name="img" src="../_/img/modify.png" style="width:40px;height:40px;">',"            </td>            ","        </tr>","  ","   	</table>    ","","</td>","    ",' <td align="right">','     	<img id="VIEW" name="img" src="../_/img/notes.png" style="width:50px;height:50px;">'," </td>    "," ",' <td align="right">','     	<img id="DEL" name="img" src="../_/img/delete.jpg" style="width:25px;height:25px;">'," </td>","    ","</tr>","    ","</table>",{TransferSubtitle:function(b,a){if(a==""){return b}else{return a}},DateFormat:function(a){if(""!=a&&a.substring(0,10)!="1753-01-01"){return a.substring(0,10)+" "+a.substring(11,16)}else{return""}}})}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_Prepare.LoadPrepareRecord(this.getRecord(),this)},event:"painted"}]},{xtype:"container",title:"確認清單",itemId:"NPINP_MadeSurePanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"NPINP_MadeSureList",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:Ext.create("Ext.XTemplate","","<table>","<tr>",'<td  rowspan="1" align="left" width="22%">',"    ",'    <span style="font-size: 14pt; font-weight: bold; color:Black;">{Title}</span>',"    <br line-height:0.1px;>",'    <span style="font-size: 8pt; font-weight: bold; color:blue;">起始日: {[this.DateFormat(values.StartDate)]}</span>',"	<br line-height:0.1px;>",'    <span style="font-size: 8pt; font-weight: bold; color:red;">最後修改日: {[this.DateFormat(values.PlanLatestDate)]}</span>',"</td>",'<td BGColor="Linen" align="left" width="40%">',"    <table>","    	<tr>",'        	<td align="left" width="90%">','           		<span style="font-weight:bold; font-size: 11pt;">{[this.ConfirmStatus(values.FinalConfirmUserName,values.PrepareTitle)]}</span>',"            </td>","            ",'             <tpl if= "FinalConfirmUserName == &quot;&quot;"> ','                <td align="right" width="10%">','                    <img id="BIND" name="img" src="../_/img/modify.png" style="width:40px;height:40px;">',"                </td> ","            </tpl>","        </tr>","  ","   	</table>    ","","</td>","    ","    ",' <td align="right">','     	<img id="VIEW" name="img" src="../_/img/notes.png" style="width:50px;height:50px;">'," </td>","    ","    ",' <tpl if= "FinalConfirmUserName == &quot;&quot;">    ','    <td align="right">','     	<img id="DEL" name="img" src="../_/img/delete.jpg" style="width:25px;height:25px;">'," 	</td>"," </tpl>","        ","     ","</tr>","    ","</table>",{ConfirmStatus:function(a,b){if(a!=""){return'【已確認】<span style="color:green"> '+b+"</span>"}else{return'【待確認】<span style="color:blue"> '+b+" </span>"}},DateFormat:function(a){if(""!=a&&a.substring(0,10)!="1753-01-01"){return a.substring(0,10)+" "+a.substring(11,16)}else{return""}}})}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_Prepare.LoadInactivePrepareRecord(this.getRecord(),this)},event:"painted"}]},{xtype:"container",title:"準備單歷程",itemId:"NPINP_PrepareHistory",layout:{type:"fit"},items:[{xtype:"list",itemId:"NPINP_PrepareHistoryList",itemTpl:Ext.create("Ext.XTemplate","<div > ",'    <span class="posted" style="color:black;"> 標題 : {Title}-{SubTitle}</span>      ',"</div>","<br>",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[this.MedicalDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>'," <br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Html} </pre></span>',"<div>","",{MedicalDateFormat:function(b){var a=b.toString();return a.substring(0,16).replace("T"," ")}})}],listeners:[{fn:function(b,a){NisTRApp.view.Nur.INP_Prepare.LoadPrepareHistory(this.getRecord(),this,"Prepare")},event:"painted"}]}]}]}]}],listeners:[{fn:"onNP_INP_SchedulePrepareListItemTap",event:"itemtap",delegate:"#NP_INP_SchedulePrepareList"},{fn:"onNP_INP_NewPrepareListLeafItemTap",event:"leafitemtap",delegate:"#NP_INP_NewPrepareList"},{fn:"onNPINP_PreapreListItemTap",event:"itemtap",delegate:"#NPINP_PreapreList"},{fn:"onNPINP_MadeSureListItemTap",event:"itemtap",delegate:"#NPINP_MadeSureList"},{fn:"onContainerDestroy",event:"destroy"}]},onNP_INP_SchedulePrepareListItemTap:function(f,h,j,g,k,l){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var n=this.getRecord();var d,a,b;if(n.data.Source.Type==1){d="0";a=n.data.Source.Name;b=(n.data.ChartSeq?n.data.ChartSeq:0)}else{if(n.data.Source.Type==2){d=n.data.InpNO;a=n.data.Source.Name;b=0}else{Ext.Msg.alert("NurPrepare 病人資料錯誤")}}var m=NisTRApp.view.FormUtil.PrepareAddr("RenderPrepareV2",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),n.data.ChartNo,b,"","","_ReloadInpPrepareData","new",d,a,g.data.RefID,g.data.SubTitleForPrepare,g.data.Source);NisTRApp.view.Nur.INP_Prepare.OpenPrepareForm(m);m=null;delete m;d=null;a=null;b=null;delete d;delete a;delete b},onNP_INP_NewPrepareListLeafItemTap:function(b,l,h,j,g,k,m){if(Ext.isEmpty(g.data.formID)||Ext.isEmpty(this.getRecord())){return}var o=this.getRecord();var f,a,d;if(o.data.Source.Type==1){f="0";a=o.data.Source.Name;d=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){f=o.data.InpNO;a=o.data.Source.Name;d=0}else{Ext.Msg.alert("NurPrepare 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.PrepareAddr("RenderPrepareV2",g.data.formID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,d,"","","_ReloadInpPrepareData","new",f,a,"","","");NisTRApp.view.Nur.INP_Prepare.OpenPrepareForm(n);n=null;delete n;f=null;a=null;d=null;delete f;delete a;delete d},onNPINP_PreapreListItemTap:function(f,h,j,g,k,l){var q=this.getRecord();var m=this;if(k.event.target.nodeName=="IMG"){var p=k.event.target.id;if(null==p){p=null;delete p;return false}if("DEL"==p){Ext.Msg.confirm("請確認","是否確認刪除此張表單及所有書寫歷程?",function(e){if(e==="yes"){NisTRApp.view.Nur.INP_Prepare.DeleteForm(g.data.OpenRecordID,m)}else{return false}q=null;delete q;m=null;delete m});k.preventDefault();return false}else{if("VIEW"==p){if(Ext.isEmpty(g.data.FormID)||Ext.isEmpty(q)){return}var d,a,b;if(q.data.Source.Type==1){d="0";a=q.data.Source.Name;b=(q.data.ChartSeq?q.data.ChartSeq:0)}else{if(q.data.Source.Type==2){d=q.data.InpNO;a=q.data.Source.Name;b=0}else{Ext.Msg.alert("NurPrepare 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.PrepareAddr("RenderPrepareV2",g.data.FormID,NisTRApp.view.SysUtility.GetUserID(),q.data.ChartNo,b,g.data.CategoryID,g.data.OpenRecordID,"_ReloadInpPrepareData","",d,a,g.data.PrepareRefID,g.data.SubTitle,g.data.PrepareSource);n=n+"&ConfirmMode=true";NisTRApp.view.Nur.INP_Prepare.OpenPrepareForm(n);n=null;delete n;d=null;a=null;b=null;delete d;delete a;delete b;q=null;delete q;m=null;delete m}else{if("BIND"==p){if(!Ext.isEmpty(Ext.getCmp("_nurPrepareMappingPanel"))){Ext.getCmp("_nurPrepareMappingPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_nurPrepareMappingPanel"))){var o=Ext.create("NisTRApp.view.Nur.PrepareMapping",{id:"_nurPrepareMappingPanel",record:g,patInfo:q});m.overlay=Ext.Viewport.add(o);m.overlay.show();o=null;delete o}q=null;delete q;m=null;delete m}}}p=null;delete p}k.preventDefault()},onNPINP_MadeSureListItemTap:function(f,h,j,g,k,l){var q=this.getRecord();var m=this;if(k.event.target.nodeName=="IMG"){var p=k.event.target.id;if(null==p){p=null;delete p;return false}if("DEL"==p){Ext.Msg.confirm("請確認","是否確認刪除此張表單及所有書寫歷程?",function(e){if(e==="yes"){NisTRApp.view.Nur.INP_Prepare.DeleteForm(g.data.OpenRecordID,m)}else{return false}q=null;delete q;m=null;delete m});k.preventDefault();return false}else{if("VIEW"==p){if(Ext.isEmpty(g.data.FormID)||Ext.isEmpty(q)){return}var d,a,b;if(q.data.Source.Type==1){d="0";a=q.data.Source.Name;b=(q.data.ChartSeq?q.data.ChartSeq:0)}else{if(q.data.Source.Type==2){d=q.data.InpNO;a=q.data.Source.Name;b=0}else{Ext.Msg.alert("NurPrepare 病人資料錯誤")}}var n=NisTRApp.view.FormUtil.PrepareAddr("RenderPrepareV2",g.data.FormID,NisTRApp.view.SysUtility.GetUserID(),q.data.ChartNo,b,g.data.CategoryID,g.data.OpenRecordID,"_ReloadInpPrepareData","",d,a,g.data.PrepareRefID,g.data.SubTitle,g.data.PrepareSource);n=n+"&ConfirmMode=true";NisTRApp.view.Nur.INP_Prepare.OpenPrepareForm(n);n=null;delete n;d=null;a=null;b=null;delete d;delete a;delete b;q=null;delete q;m=null;delete m}else{if("BIND"==p){if(!Ext.isEmpty(Ext.getCmp("_nurPrepareMappingPanel"))){Ext.getCmp("_nurPrepareMappingPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_nurPrepareMappingPanel"))){var o=Ext.create("NisTRApp.view.Nur.PrepareMapping",{id:"_nurPrepareMappingPanel",record:g,patInfo:q});m.overlay=Ext.Viewport.add(o);m.overlay.show();o=null;delete o}q=null;delete q;m=null;delete m}}}p=null;delete p}k.preventDefault()},onContainerDestroy:function(a){if(Ext.getStore("sSchedulePrepareList")!=null){Ext.getStore("sSchedulePrepareList").removeAll();Ext.getStore("sSchedulePrepareList").destroy()}if(Ext.getStore("sPrepareRecord")!=null){Ext.getStore("sPrepareRecord").removeAll();Ext.getStore("sPrepareRecord").destroy()}if(Ext.getStore("sInactivePrepareRecord")!=null){Ext.getStore("sInactivePrepareRecord").removeAll();Ext.getStore("sInactivePrepareRecord").destroy()}if(Ext.getStore("sPrepareHistoryList")!=null){Ext.getStore("sPrepareHistoryList").removeAll();Ext.getStore("sPrepareHistoryList").destroy()}if(!Ext.isEmpty(Ext.getCmp("_inpPrepareFormPanel"))){Ext.getCmp("_inpPrepareFormPanel").destroy()}_ReloadInpPrepareData=null;delete _ReloadInpPrepareData;console.log("On Destroy","Nur.INP_Prepare");this.removeAll(true,true)},initialize:function(){this.callParent();_ReloadInpPrepareData=function(a){try{if(!Ext.isEmpty(Ext.getStore("sPrepareRecord"))&&!Ext.getStore("sPrepareRecord").isLoading()){Ext.getStore("sPrepareRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInactivePrepareRecord"))&&!Ext.getStore("sInactivePrepareRecord").isLoading()){Ext.getStore("sInactivePrepareRecord").load()}if(!Ext.isEmpty(Ext.getStore("sSchedulePrepareList"))&&!Ext.getStore("sSchedulePrepareList").isLoading()){Ext.getStore("sSchedulePrepareList").load()}if(!Ext.isEmpty(Ext.getCmp("_inpPrepareFormPanel"))){Ext.getCmp("_inpPrepareFormPanel").destroy()}if(!Ext.isEmpty(Ext.ComponentQuery.query("#NPINP_MainPanel")[0])){Ext.ComponentQuery.query("#NPINP_MainPanel")[0].show()}return}catch(b){console.error("_ReloadInpPrepareData",b)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("INP_Prepare 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("INP_Prepare 住院病人資料錯誤");return false}if(this.getRecord().data.Source.Type!=2){Ext.Msg.alert("INP_Prepare 不支援門診病人");return false}if(Ext.isEmpty(Ext.getStore("sNewInpPrepareRecord"))){Ext.create("Ext.data.TreeStore",{storeId:"sNewInpPrepareRecord",autoLoad:false,model:"NisTRApp.model.Form.ListItem",defaultRootProperty:"items",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{FunctionType:"Prepare",Source:this.getRecord().data.Source.Name},url:SYS_CONST.ApiRoot+"Form/NewRecordNestedList.ashx",reader:{type:"json"}}})}this.down("#NP_INP_NewPrepareList").setStore(Ext.getStore("sNewInpPrepareRecord"));if(Ext.getStore("sNewInpPrepareRecord").getCount()<=0){this.LoadListItem()}if(Ext.isEmpty(Ext.getStore("sSchedulePrepareList"))){Ext.create("Ext.data.Store",{storeId:"sSchedulePrepareList",model:"NisTRApp.model.Form.PrepareNewList",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/PrepareScheduleList.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){var a;switch(b.get("Type")){case"OP":a="手術前準備";break;case"ENDO":a="內視鏡準備";break;case"RT":a="放診科準備";break;case"NM":a="核醫科準備";break;default:a="其他"}return a}},filters:{filterFn:function(a){return !a.data.IsBind}}})}this.down("#NP_INP_SchedulePrepareList").setStore(Ext.getStore("sSchedulePrepareList"));this.down("#NPINP_MainInnerPanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sPrepareRecord"))){Ext.create("Ext.data.Store",{storeId:"sPrepareRecord",model:"NisTRApp.model.Form.PrepareOpenRecord",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecordPrepare.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){var a;switch(b.get("Title")){case"內視鏡準備":a="內視鏡準備";break;case"手術前準備":a="手術前準備";break;case"放診科準備":a="放診科準備";break;case"核醫科準備":a="核醫科準備";break;default:a="其他"}return a}},filters:{filterFn:function(a){return a.get("Discontinue")==false}}})}Ext.getStore("sPrepareRecord").addListener("load",function(d,b,h,a,f){var g=this.down("#NPINP_MainTabPanel");g.getTabBar().getAt(0).setBadgeText("");g.getTabBar().getAt(1).setBadgeText("");if(null!=b&&b.length>0){for(var e=0;e<b.length;e++){if(b[e].data.Discontinue==false){g.getTabBar().getAt(0).setBadgeText("New")}else{if(b[e].data.Discontinue==true&&b[e].data.FinalConfirmUserName==""){g.getTabBar().getAt(1).setBadgeText("New")}}}}g=null;delete g},this);this.down("#NPINP_PreapreList").setStore(Ext.getStore("sPrepareRecord"));this.down("#NPINP_PreaprePanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sInactivePrepareRecord"))){Ext.create("Ext.data.Store",{storeId:"sInactivePrepareRecord",model:"NisTRApp.model.Form.PrepareOpenRecord",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/OpenRecordPrepare.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){var a;switch(b.get("Title")){case"內視鏡準備":a="內視鏡準備";break;case"手術前準備":a="手術前準備";break;case"放診科準備":a="放診科準備";break;case"核醫科準備":a="核醫科準備";break;default:a="其他"}return a}},filters:{filterFn:function(a){return a.get("Discontinue")==true}}})}Ext.getStore("sInactivePrepareRecord").addListener("load",function(d,b,h,a,f){var g=this.down("#NPINP_MainTabPanel");g.getTabBar().getAt(0).setBadgeText("");g.getTabBar().getAt(1).setBadgeText("");if(null!=b&&b.length>0){for(var e=0;e<b.length;e++){if(b[e].data.Discontinue==false){g.getTabBar().getAt(0).setBadgeText("New")}else{if(b[e].data.Discontinue==true&&b[e].data.FinalConfirmUserName==""){g.getTabBar().getAt(1).setBadgeText("New")}}}}g=null;delete g},this);this.down("#NPINP_MadeSureList").setStore(Ext.getStore("sInactivePrepareRecord"));this.down("#NPINP_MadeSurePanel").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sPrepareHistoryList"))){Ext.create("Ext.data.Store",{storeId:"sPrepareHistoryList",model:"NisTRApp.model.Form.PrepareHistory",clearOnPageLoad:false,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/PrepareHistoryV2.ashx",reader:{type:"json"}}})}this.down("#NPINP_PrepareHistory").setRecord(this.getRecord());this.down("#NPINP_PrepareHistoryList").setStore(Ext.getStore("sPrepareHistoryList"))},LoadListItem:function(){if(Ext.getStore("sNewInpPrepareRecord").isLoading()||Ext.isEmpty(this.getRecord())){return false}var a=Ext.getStore("sNewInpPrepareRecord");a.removeAll();a.load();a=null;delete a;return false}});Ext.define("NisTRApp.view.Nur.PrepareMapping",{extend:Ext.Panel,alias:"widget.NurPrepareMapping",config:{centered:true,height:480,style:"background-color: Black;",width:600,layout:{type:"vbox"},modal:true,patInfo:{},items:[{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"NMP_CancelBtn",left:"1px",ui:"confirm",width:"48%",text:"取 消"},{xtype:"button",itemId:"NMP_SaveBtn",right:"1px",ui:"decline",width:"48%",text:"存 檔"}]},{xtype:"panel",height:"80px",itemId:"NMP_Main",tpl:Ext.create("Ext.XTemplate",'<table bgcolor="PaleGreen" width="100%" height="80px">',"<tr>",'<td  rowspan="1" align="left" width="25%">',"    ",'    <span style="font-size: 14pt; font-weight: bold; color:Black;">{Title}</span>',"    ","</td>","  ",'<td  align="left" width="44%">','    <span style="font-size: 10pt; font-weight: bold; color:blue;">起始日: {[this.DateFormat(values.StartDate)]}</span>',"	<br line-height:0.1px;>",'     <span style="font-size: 10pt; font-weight: bold; color:red;">最後修改日: {[this.DateFormat(values.PlanLatestDate)]}</span> '," </td>  "," ","","</tr>","    ","</table>",{DateFormat:function(a){if(""!=a&&a.substring(0,10)!="1753-01-01"){return a.substring(0,10)+" "+a.substring(11,16)}else{return""}}}),layout:{type:"fit"},modal:true},{xtype:"panel",patInfo:{},height:"340px",itemId:"NMP_Body",layout:{type:"fit"},modal:true,items:[{xtype:"list",itemId:"NMP_MapList",disableSelection:true,itemTpl:["<div>","    {PexeDate} {CodeName}",'     <span style="color:blue">&nbsp;&nbsp;&nbsp;&nbsp;關連&nbsp;&nbsp;</span>',"","        ",'    <tpl if= "IsSelect == &quot;checked&quot;">    ','        <img  id={KeyOne} src= "../_/img/checkbox-icon.png" alt="Smiley face" height="16" width="16">',"    </tpl>","        ",'    <tpl if= "IsSelect != &quot;checked&quot;">    ','        <img id={KeyOne} src= "../_/img/unchecked-checkbox-icon.png" alt="Smiley face" height="16" width="16">',"    </tpl> "," </div>"]}],listeners:[{fn:function(b,a){if(Ext.getStore("sPrepareSelectList").isLoading()||Ext.isEmpty(this.getRecord())){return false}var d=Ext.getStore("sPrepareSelectList");d.removeAll();d.getProxy().setExtraParams({InpNo:this.patInfo.data.InpNo,OpenRecordID:this.getRecord().data.OpenRecordID});d.load();d=null;delete d;return false},event:"painted"}]}],listeners:[{fn:"onNMP_CancelBtnTap",event:"tap",delegate:"#NMP_CancelBtn"},{fn:"onNMP_SaveBtnTap",event:"tap",delegate:"#NMP_SaveBtn"},{fn:"onNMP_MapListItemTap",event:"itemtap",delegate:"#NMP_MapList"}]},onNMP_CancelBtnTap:function(b,d,a){this.destroy()},onNMP_SaveBtnTap:function(h,j,k){var g="";var a="";var b=-1;var l=this;try{g=this.getRecord().data.OpenRecordID;var d=Ext.getStore("sPrepareSelectList");d.each(function(e){if(e.data.IsSelect=="checked"){a=e.data.Source;b=e.data.RefID}});d=null;delete d}catch(f){Ext.Msg.alert("存檔錯誤");return}try{l.setMasked({xtype:"loadmask",message:"Please Wait!"});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/Form/SetNurMapping.ashx",scope:this,method:"POST",params:{OpenRecordID:g,RefID:b,Source:a},success:function(e){l.setMasked(false);var m=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(m.Success){if(!Ext.isEmpty(Ext.getStore("sPrepareRecord"))&&!Ext.getStore("sPrepareRecord").isLoading()){Ext.getStore("sPrepareRecord").load()}if(!Ext.isEmpty(Ext.getStore("sInactivePrepareRecord"))&&!Ext.getStore("sInactivePrepareRecord").isLoading()){Ext.getStore("sInactivePrepareRecord").load()}if(!Ext.isEmpty(Ext.getStore("sSchedulePrepareList"))&&!Ext.getStore("sSchedulePrepareList").isLoading()){Ext.getStore("sSchedulePrepareList").load()}}g=null;delete g;a=null;delete a;b=null;delete b;l=null;delete l;if(m.Success){m=null;delete m;this.destroy()}m=null;delete m;return false},failure:function(){l.setMasked(false);g=null;delete g;a=null;delete a;b=null;delete b;l=null;delete l;Ext.Msg.alert("存檔失敗!");return false}},l)}catch(f){Ext.Msg.alert("存檔錯誤2");l.setMasked(false);g=null;delete g;a=null;delete a;b=null;delete b;l=null;delete l;return false}},onNMP_MapListItemTap:function(b,d,j,a,h,g){var f=a.data.KeyOne;var k=Ext.getStore("sPrepareSelectList");k.each(function(l){if(l.get("KeyOne")==f){var e=Ext.fly(a.data.KeyOne);if(null!=l.data.IsSelect&&""!=l.data.IsSelect){l.data.IsSelect="";e.dom.src="../_/img/unchecked-checkbox-icon.png"}else{l.data.IsSelect="checked";e.dom.src="../_/img/checkbox-icon.png"}e=null;delete e}else{var e=Ext.fly(l.data.KeyOne);l.data.IsSelect="";e.dom.src="../_/img/unchecked-checkbox-icon.png";e=null;delete e}});return},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.OpenRecordID)||Ext.isEmpty(this.getPatInfo())||Ext.isEmpty(this.getPatInfo().data.InpNo)){Ext.Msg.alert("資料錯誤");return false}this.down("#NMP_Main").setRecord(this.getRecord());if(Ext.isEmpty(Ext.getStore("sPrepareSelectList"))){Ext.create("Ext.data.Store",{storeId:"sPrepareSelectList",model:"NisTRApp.model.Form.PrepareNewList",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Form/PrepareScheduleList.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){var a;switch(b.get("Type")){case"OP":a="手術前準備";break;case"ENDO":a="內視鏡準備";break;case"RT":a="放診科準備";break;case"NM":a="核醫科準備";break;default:a="其他"}return a}},filters:{filterFn:function(a){return(!a.data.IsBind||a.data.IsSelect=="checked")}}})}this.down("#NMP_MapList").setStore(Ext.getStore("sPrepareSelectList"));this.down("#NMP_Body").setRecord(this.getRecord());this.down("#NMP_Body").patInfo=this.getPatInfo()}});Ext.define("NisTRApp.view.Nur.CathCreatePanel",{extend:Ext.Container,alias:"widget.NurCathCreatePanel",statics:{BindSigleSelectFn:function(d){try{var a=d.items;if(null!=a){a.each(function(g,e,f){if(g.xtype=="checkboxfield"){g.addListener("change",function(h,l,j,k){NisTRApp.view.Misc.CheckBoxSingleSelect(h.getParent(),h,l)},d)}})}a=null;delete a}catch(b){}}},config:{hiddenHeadBar:false,stopDistroyEvent:false,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"NCCP_HeadBar",items:[{xtype:"label",html:"OPR_INFO",itemId:"NCCP_InfoLbl",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   手術日期.{OprmDate}  &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        Dr.{DrName} / {PatIdno} </span>","</td>","</tr>","</table>"]}]},{xtype:"panel",height:"100%",html:'<div id="CathPortAFrame" style="height: 100%; width: 100%; line-height: 0; margin: 0; padding: 0; border: 0;"><iframe id="CathPortADetail"  width="100%" height="100%" frameborder="0" style="overflow-y: scroll !important; -webkit-overflow-scrolling: touch !important;"></iframe></div>',itemId:"NCCP_ContentPanel",style:"overflow: auto; -webkit-overflow-scrolling: touch;",width:"100%"},{xtype:"formpanel",hidden:true,items:[{xtype:"fieldset",itemId:"NCCP_CreatedPlace",width:"70%",title:"建置地點",items:[{xtype:"checkboxfield",itemId:"mycheckbox9",label:"院內建置",labelWidth:"80%",checked:true},{xtype:"checkboxfield",itemId:"mycheckbox10",label:"院外建置",labelWidth:"80%"}]},{xtype:"fieldset",itemId:"NCCP_CreatedDesc",width:"70%",title:"廠牌/輸注座施打直徑/管內徑/管外徑：",items:[{xtype:"checkboxfield",itemId:"mycheckbox12",label:"Deltec大座粗管　輸注座/11.4mm, 內徑/1.6mm, 外徑/7.8Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Deltec大座細管　輸注座/11.4mm, 內徑/1.0mm, 外徑/5.8Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Deltec小座粗管　輸注座/9.5mm, 內徑/1.6mm, 外徑/7.8Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Deltec小座細管　輸注座/9.5mm, 內徑/1.0mm, 外徑/5.8Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Bard 6.6Fr.　輸注座/10.8mm, 內徑/1.0mm, 外徑/6.6Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Bard 7.0Fr.　輸注座/10.8mm, 內徑/1.3mm, 外徑/7.0Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Bard 8.0Fr.　輸注座/12.5mm, 內徑/1.5mm, 外徑/8.0Fr.",labelWidth:"80%"},{xtype:"checkboxfield",label:"Bard 6 Fr 輸液座 23x28mm 內徑/1.3mm 外徑/2.0 mm",labelWidth:"80%"},{xtype:"checkboxfield",label:"Bard 8 Fr 輸液座 23x28mm 內徑/1.6mm 外徑/2.6 mm",labelWidth:"80%"},{xtype:"checkboxfield",itemId:"mycheckbox25",label:"其他",labelWidth:"80%"},{xtype:"textfield",hidden:true,itemId:"CreatedDescOtherTxt",labelWidth:"1px",placeHolder:"請輸入"}]},{xtype:"fieldset",itemId:"NCCP_CathType",width:"70%",title:"管路類別",items:[{xtype:"checkboxfield",label:"Open End",labelWidth:"80%"},{xtype:"checkboxfield",label:"Close End",labelWidth:"80%"}]},{xtype:"fieldset",itemId:"NCCP_CathPoint",width:"70%",title:"導管尖端位置",items:[{xtype:"checkboxfield",label:"SVC",labelWidth:"80%"},{xtype:"checkboxfield",label:"Subclavian Vein",labelWidth:"80%"},{xtype:"checkboxfield",label:"其他",labelWidth:"80%"},{xtype:"textfield",labelWidth:"1px",placeHolder:"請輸入"}]},{xtype:"fieldset",itemId:"NCCP_InputPart",width:"70%",title:"植入部位",items:[{xtype:"checkboxfield",label:"Cephalic Vein",labelWidth:"80%"},{xtype:"checkboxfield",label:"Jugular Vein",labelWidth:"80%"},{xtype:"checkboxfield",label:"其他",labelWidth:"80%"},{xtype:"textfield",labelWidth:"1px",placeHolder:"請輸入"}]},{xtype:"fieldset",itemId:"NCCP_InputSide",width:"70%",title:"植入側",items:[{xtype:"checkboxfield",label:"左側",labelWidth:"80%"},{xtype:"checkboxfield",label:"右側",labelWidth:"80%"},{xtype:"checkboxfield",label:"其他",labelWidth:"80%"},{xtype:"textfield",labelWidth:"1px",placeHolder:"請輸入"}]},{xtype:"fieldset",itemId:"NCCP_RemoveReason",width:"70%",title:"移除原因",items:[{xtype:"checkboxfield",label:"無",labelWidth:"80%"},{xtype:"checkboxfield",label:" 結束治療",labelWidth:"80%"},{xtype:"checkboxfield",label:"(疑似)感染",labelWidth:"80%"},{xtype:"checkboxfield",label:"病人要求",labelWidth:"80%"},{xtype:"checkboxfield",label:"滑脫",labelWidth:"80%"},{xtype:"checkboxfield",label:"位移",labelWidth:"80%"},{xtype:"checkboxfield",label:" 斷裂",labelWidth:"80%"},{xtype:"checkboxfield",label:"(疑似)阻塞",labelWidth:"80%"},{xtype:"checkboxfield",label:"其他",labelWidth:"80%"},{xtype:"textfield",labelWidth:"1px",placeHolder:"請輸入"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"NCCP_FootBar",items:[{xtype:"button",hidden:true,itemId:"NCCP_CreatePortABtn",left:"1px",ui:"decline",width:"20%",text:"建 立 PortA"},{xtype:"button",itemId:"NCCP_CloseBtn",right:"1px",ui:"confirm",width:"20%",text:"關 閉"}]}],listeners:[{fn:"onMycheckbox12Change",event:"change",delegate:"#mycheckbox12"},{fn:"onMycheckbox25Change",event:"change",delegate:"#mycheckbox25"},{fn:"onNCCP_CloseBtnTap",event:"tap",delegate:"#NCCP_CloseBtn"},{fn:"onContainerShow",event:"show"}]},onMycheckbox12Change:function(a,e,b,d){},onMycheckbox25Change:function(a,e,b,d){this.down("#CreatedDescOtherTxt").setHidden(!e)},onNCCP_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onContainerShow:function(g,d){if(Ext.isEmpty(this.getRecord())){return false}var k=this.getRecord();var a,f,j,h,e,b;a=NisTRApp.view.SysUtility.GetUserID("CathHistoryList itemTap");h=NisTRApp.view.SysUtility.GetExternalWeb();f=k.data.PatIdno;b=k.data.ChartNo;j="NUR/NURFORM_ADMIN.asp?PRO_NO=PORT&DEPT_CODE=1300&VER=1&STATUS=NEW&LOG_USER_ID="+a+"&PAT_IDNO="+f+"&CHART_NO="+b;e=NisApp.view.NisPDFUtil.GetXAccessControl()+"/"+escape(j);NisTRApp.view.FormUtil.ResetContentDiv("CathPortAFrame",this.down("#NCCP_ContentPanel"));NisTRApp.view.Misc.createResizeFrameContent($("#CathPortAFrame"),e);$("#CathPortAFrame").attr("src",e).attr("_src",e);a=null;f=null;j=null;h=null;e=null;b=null;delete a;delete f;delete j;delete h;delete e;delete b},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("NurCathCreatePanel 病人資料錯誤");return false}var a=this.getRecord();this.down("#NCCP_InfoLbl").setRecord(a);NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_CreatedPlace"));NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_CreatedDesc"));NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_CathType"));NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_CathPoint"));NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_InputPart"));NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_InputSide"));NisTRApp.view.Nur.CathCreatePanel.BindSigleSelectFn(this.down("#NCCP_RemoveReason"));this.down("#NCCP_HeadBar").setHidden(this.getHiddenHeadBar());a=null;delete a}});Ext.define("NisTRApp.view.Management.OrderCheckPanel",{extend:Ext.Panel,statics:{LoadDrugBasicInfo:function(b){if(Ext.getStore("sDrugBasicInfo").isLoading()||Ext.isEmpty(b)){return}var d=Ext.getStore("sDrugBasicInfo");d.removeAll();var e="";if(Ext.isArray(b)&&b.length>0){for(var a=0;a<=b.length-1;a++){if(a==0){e=b[a]}else{e=e+","+b[a]}}}else{if(Ext.isString(b)){e=b}}d.getProxy().setExtraParams({codeno:e});d.load({callback:function(g,f,h){},scope:this});d=null;delete d;e=null;delete e;b=null;delete b},RenderOrderBillTable:function(e){if(Ext.getStore("sOrderBill").isLoading()||Ext.isEmpty(e)){return}var d=Ext.getStore("sOrderBill");e.down("#MOCP_OrderInerBillsPanel").setHtml("");e.down("#MOCP_OrderOrderBillsPanel").setHidden(false);if(d.getCount()>0){e.down("#MOCP_OrderInerBillsPanel").setHtml("");var g=[];d.each(function(k,h,j){g.push(k.raw)});var b={Orders:g};if(!Ext.isEmpty(b)){e.down("#MOCP_OrderInerBillsPanel").setHtml("");var f=e.down("#MOCP_OrderInerBillsPanel").getTpl().apply(b);e.down("#MOCP_OrderInerBillsPanel").setHtml(f);f=null;delete f;var a=NisTRApp.view.SysUtility.tapEventName();$(".execBillRow").bind(a,function(){if($(this).parent("tr").children().first().find(":checkbox").attr("checked")==undefined){$(this).parent("tr").children().first().find(":checkbox").attr("checked","checked");$(this).parent("tr").children().first().find(":checkbox").prop("checked",true)}else{if($(this).parent("tr").children().first().find(":checkbox").attr("checked")=="checked"){$(this).parent("tr").children().first().find(":checkbox").attr("checked",false);$(this).parent("tr").children().first().find(":checkbox").prop("checked",false)}}});$(".bill").bind(a,function(){if($(this).attr("checked")==undefined){$(this).attr("checked","checked");$(this).prop("checked",true)}else{if($(this).attr("checked")=="checked"){$(this).attr("checked",false);$(this).prop("checked",false)}}});$("#ordBillSelectAll").unbind(a);$("#ordBillSelectAll").bind(a,function(){if($(".bill").attr("checked")==undefined){$(".bill").attr("checked","checked");$(".bill").prop("checked",true)}});$("#ordBillUnSelectAll").unbind(a);$("#ordBillUnSelectAll").bind(a,function(){$(".bill").attr("checked",false);$(".bill").prop("checked",false)})}g=null;delete g;b=null;delete b}else{}if(d.getCount()==1){if($(".bill").attr("checked")==undefined){$(".bill").attr("checked","checked");$(".bill").prop("checked",true)}}d=null;delete d},GroupByOrddrid:function(b){var d="";var e="";b.forEach(function a(g,f,h){if(f==0&&(g.IsEsam||g.IsEsam=="true")){e=g.Accessnum;d=g.OrddRid}else{if(g.IsEsam||g.IsEsam=="true"){if(e.indexOf(g.Accessnum)==-1){d=d+"_"+g.OrddRid}e=e+"_"+g.Accessnum}else{if(f==0){d=g.OrddRid}else{d=d+"_"+g.OrddRid}}}});e=null;delete e;return d}},config:{timeBlock:"undefined",height:"100%",width:"100%",layout:{type:"fit"},exeOrders:[],caller:{},closeFn:{},items:[{xtype:"toolbar",docked:"top",itemId:"MOCP_SelectTimeSection",ui:"light"},{xtype:"panel",docked:"top",hidden:true,itemId:"MOCP_txtExePanel",maxHeight:"2.9em",layout:{type:"fit"},items:[{xtype:"textfield",itemId:"MOCP_TxtExeContent",label:'執行記錄<img src="../_/img/teach3.png" id="_imgExeContent" style="width:30px;height:25px;"/>',labelWidth:"20%",placeHolder:"請輸入"}]},{xtype:"panel",itemId:"MOCP_MainPanel",layout:{type:"vbox"},modal:false,scrollable:false,items:[{xtype:"panel",flex:1,itemId:"MOCP_OrderOrderPanel",tpl:["","","",'<div id="_orderOrderCheck" class="globalList">','<table id="_orderCheckTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        ","       ",'    	<tr class="FixedHeaderRow1">','            <th align="center" style="width: 10%;">Start Date</th>','            <th align="center" style="width:59%;">ACTIVE ORDER</th>','            <th align="center" style="width:7%;">頻次</th>','            <th align="center" style="width:7%;">每次量</th>','            <th align="center" style="width:7%;">單位</th>','            <th style="width:10%;">最近執行</th>',"        </tr>","    </thead>","  ","    <tbody>","    ",'    <tpl for="Orders">',"		",'        <tr seqno="{SeqNo}" majorclass="{MajorClass}" orddrid="{OrddRid}" accessnum="{Accessnum}" begdate="{BegDate}"  IsOP="{IsOP}" IsBottleInjection="{IsBottleInjection}"  activeorder={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]} orddtextstr={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]} codeno="{CodeNo}" isstat="{IsStat}" medflag="{MbdFlag}" ordertype="{OrderType}" dblchkflag="{DblchkFlag}">','            <td style="width:10%;" orddrid="{OrddRid}" accessnum="{Accessnum}">{BegDate}</td>','            <td style="width:59%;" class="orderSpec" title="{[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]}">{[NisTRApp.view.MgrUtil.OrddHtmlStrFormat(values.OrddHtml,values.OrddTxt,values)]}</td>','            <td align="center" style="width:7%;">{Frequency}</td>','            <td align="center" style="width:7%;">{[NisTRApp.view.MgrUtil.DoseFormat(values)]}</td>','            <td align="center" style="width:7%;">{[NisTRApp.view.MgrUtil.DoseUnitFormat(values)]}</td>','            <td style="width:10%;">{[NisTRApp.view.MgrUtil.LastDrugDateFormat(values)]}</td>',"           ","         </tr>","        ","	</tpl>","        ","    </tbody>","    ","","</table>","    ","</div>",""],layout:{type:"fit"},scrollable:"vertical"},{xtype:"panel",flex:1.5,itemId:"MOCP_OrderOrderSpec",layout:{type:"vbox"},items:[{xtype:"panel",flex:1,height:"100%",hidden:true,itemId:"MOCP_OrderOrderDrugInfoPanel",layout:{type:"vbox"},scrollable:true,items:[{xtype:"label",docked:"top",height:"2.1em",html:'<div id="_orderOrderPic" class="globalList" ><table id="_orderOrderPicTable" style="width:100%"><thead><th>備藥資訊</th></thead></div>'},{xtype:"list",flex:1,height:"",itemId:"MOCP_DrugInfoList",disableSelection:true,itemTpl:["","<table >","	<tr>",'        <td rowspan="3" align="left" width="130px">',"            ",'            <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;">','            	<img src="{ImgUrl}"  style="height:120px;width:120px; cursor:hand; vertical-align:middle;">',"            </span>","        </td>","    </tr>","    <tr>","        ",'        <td align="left" >','        	<span style="font-weight: bold;color:black; font-size: 14px;">代碼 : {CodeNO}</span>',"            <br>",'            <span style="font-weight:bold; color:black;font-size: 14px;">學名 : {DrugName}</span>',"            <br>",'            <span style="font-weight:bold; color:black;font-size: 14px;">商品名 : {CodeName}</span> ',"        </td>","    </tr>","    ","    ","    <tr>","        ",'        <td align="left" >','        	<span style="font-weight:red; color:green;font-size: 14px;">注意事項 : </span>','             <tpl if= "FallRisk == &quot;Y&quot;">','				<span style="color:red;font-size: 14px;">本藥為易引起跌倒藥物</span> ',"            </tpl>","            <br>",'            <tpl for="NBItems">',"                ",'                <span style="font-weight:bold; color:black;font-size: 14px;">{Dscr}</span> ',"                <br>","        ","            </tpl>","        </td>","    </tr> ","	   ","","    ","","</table>"]}]},{xtype:"panel",flex:1,height:"100%",hidden:false,itemId:"MOCP_OrderOrderClc",layout:{type:"hbox"},items:[{xtype:"panel",flex:1,itemId:"MOCP_OrderOrderBillsPanel",layout:{type:"vbox"},items:[{xtype:"label",html:'<div class="globalList" ><table style="width:100%"><thead> 			<th id="ordBillSelectAll" style="width:15%"><button type="button">全選</button></th> 			<th id="ordBillUnSelectAll" style="width:15%"><button type="button">取消</button> 			</th> <th style="width:70%">請勾選計價帳務</th></thead></div>'},{xtype:"panel",flex:1,html:"",itemId:"MOCP_OrderInerBillsPanel",tpl:Ext.create("Ext.XTemplate",'<div id="_orderOrderBills" class="globalList" >','<table id="_orderOrderBillsTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"  ","    <tbody>","    ",'    <tpl for="Orders">',"		",'        <tr seqno="{SeqNo}" majorclass="{MajorClass}" chemo="{Chemo}" orddrid="{OrddRid}" begdate="{BegDate}" frequency="{Frequency}"  IsOP="{IsOP}" IsBottleInjection="{IsBottleInjection}"  activeorder={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]} orddtextstr={[NisTRApp.view.MgrUtil.TextVal(values.OrddTxt)]} codeno="{CodeNo}" isstat="{IsStat}" medflag="{MbdFlag}" accessnum="{Accessnum}" originalDrugTime="{OriginalDrugTime}" drugtime="{DrugTime}" ordertype="{OrderType}" dblchkflag="{DblchkFlag}">',"","           <td >{[this.ChkBox(values)]}</td>",'            <td class="execBillRow"> {CodeNO} {CodeName} </td>',"            <td> {[this.InputControl(values)]}</td>","         </tr>","        ","	</tpl>","        ","    </tbody>"," ","</table>","    ","</div>",{ChkBox:function(a){return String.format('<input id="chk{0}" type="checkbox" value="{1}" class="bill" />',a.CodeNO,a.CodeNO)},InputControl:function(a){if(a.NeedInput=="Y"){return String.format('計量 : <input type="text" style="width:60px; border:1px solid red;"  id="fieldTotalQty{0}" class="inputTotalQty" onKeypress="if(event.keyCode < 48 || event.keyCode > 57) event.returnValue = false;" />',a.CodeNO)}else{return""}}}),scrollable:"vertical"}]},{xtype:"panel",flex:1,hidden:false,itemId:"MOCP_OrderOrderMonitorPanel",layout:{type:"vbox"},items:[{xtype:"label",html:'<div  class="globalList" ><table  style="width:100%"><thead><th >請勾選計價帳務</th></thead></div>',itemId:"MOCP_OrderOrderMonitorLabel"},{xtype:"panel",flex:1,itemId:"MOCP_OrderOrderMonitorMain",items:[{xtype:"fieldset",itemId:"monitorfield",items:[{xtype:"numberfield",itemId:"orderMonitorValue",label:"數值",labelWidth:"15%",placeHolder:"請填寫(數字)"},{xtype:"textfield",itemId:"orderMonitorRemark",label:'記錄<img src="../_/img/teach3.png" id="_OpenMonitorItem" style="width:30px;height:30px;"></img>',labelWidth:"15%",placeHolder:"請點選"},{xtype:"textareafield",itemId:"orderMonitorExplain",label:"釋義",labelWidth:"15%",readOnly:true,maxRows:7}]}]},{xtype:"panel",flex:1,hidden:true,itemId:"MOCP_OrderOrderMonitorForm",layout:{type:"fit"},items:[{xtype:"list",itemId:"MOCP_Monitorphraselist",mode:"MULTI",itemTpl:["<div>{name}</div>"]},{xtype:"toolbar",docked:"bottom",ui:"light",items:[{xtype:"button",centered:true,itemId:"mybutton196",ui:"confirm",width:"90%",text:"帶 入 監 測 記 錄"}]}]}]}]}]},{xtype:"toolbar",cls:"orderExePanel-dbcheck-toolbar",docked:"bottom",hidden:true,itemId:"MOCP_OrderDoubleConfirmBar",showAnimation:{type:"slide",direction:"up"},items:[{xtype:"panel",id:"MOCP_OrdDCLogin",itemId:"MOCP_OrdDCLogin",width:"100%",layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"MOCP_DoubleConfirmId",width:"48%",label:"覆核人員帳號",labelWidth:"25%",placeHolder:"請輸入帳號"},{xtype:"passwordfield",itemId:"MOCP_DoubleConfirmPw",width:"48%",label:"覆核人員密碼",labelWidth:"25%",placeHolder:"請輸入密碼"}]},{xtype:"panel",hidden:true,id:"MOCP_OrdDCInfo",itemId:"MOCP_OrdDCInfo",width:"100%",layout:{type:"hbox"},items:[{xtype:"textfield",itemId:"MOCP_DoubleConfirmNo",width:"48%",label:"編號",labelWidth:"25%",readOnly:true},{xtype:"textfield",itemId:"MOCP_DoubleConfirmName",width:"47%",label:"姓名",labelWidth:"25%",readOnly:true}]}]}]},{xtype:"toolbar",docked:"bottom",hidden:true,itemId:"OrderExcuteCheckFootBar",items:[{xtype:"button",itemId:"MOCP_ExeCancelBtn",left:"1px",ui:"confirm-back",width:"47%",text:"取 消"},{xtype:"button",itemId:"MOCP_StepExeBtn",right:"1px",ui:"confirm-forward",width:"47%",text:"備 藥 完 成"}]},{xtype:"toolbar",docked:"bottom",hidden:true,itemId:"OrderExcuteDoFootBar",items:[{xtype:"button",itemId:"MOCP_ExecancelBtn",left:"1px",ui:"confirm-back",width:"47%",text:"返 回"},{xtype:"button",hidden:false,itemId:"MOCP_ExedoBtn",right:"1px",ui:"confirm-forward",width:"47%",text:"給 藥 存 檔"}]},{xtype:"toolbar",docked:"bottom",hidden:true,itemId:"OrderExcuteDoTreatFootBar",items:[{xtype:"button",itemId:"MOCP_TreatcancelBtn",left:"1px",ui:"confirm-back",width:"47%",text:"取 消"},{xtype:"button",itemId:"MOCP_TreatExedoBtn",right:"1px",ui:"confirm-forward",width:"47%",text:"存 檔"}]},{xtype:"panel",docked:"bottom",height:118,hidden:true,itemId:"MOCP_divExePanel",showAnimation:{type:"slide",direction:"up"},layout:{type:"vbox"},modal:false,items:[{xtype:"label",html:'<div id="_mocpDivExeTxt" class="globalList" ><table style="width:100%"><thead><th>給藥紀錄</th></thead></div>',width:"20%"},{xtype:"panel",flex:1,itemId:"MOCP_orderOralType",layout:{type:"hbox"},items:[{xtype:"button",html:"術前使用",itemId:"mybutton137",style:"width:120px;height:25px;margin: 3px;",text:"術前使用"},{xtype:"button",html:"術中使用",itemId:"mybutton138",style:"width:120px;height:25px;margin: 3px;",text:"術中使用"},{xtype:"button",itemId:"mybutton139",style:"width:120px;height:25px;margin: 3px;",text:"Hold"},{xtype:"button",itemId:"mybutton140",style:"width:120px;height:25px;margin: 3px;",text:"拒用"},{xtype:"button",itemId:"mybutton142",style:"width:120px;height:25px;margin: 3px;",text:"請假帶回"},{xtype:"button",itemId:"mybutton141",style:"width:120px;height:25px;margin: 3px;",text:"病人指定"}]},{xtype:"panel",flex:1,itemId:"MOCP_orderBIType",layout:{type:"hbox"},items:[{xtype:"button",itemId:"orderBIType1",style:"width:100px;height:25px;margin: 1px;",text:"續接"},{xtype:"button",itemId:"orderBIType2",style:"width:100px;height:25px;margin: 1px;",text:"調整劑量"},{xtype:"button",itemId:"orderBIType3",style:"width:160px;height:25px;margin: 1px;",text:"續接並調整劑量"},{xtype:"button",itemId:"orderBIType4",style:"width:100px;height:25px;margin: 1px;",text:"c.c./hr"},{xtype:"button",itemId:"orderBIType5",style:"width:110px;height:25px;margin: 1px;",text:"mg/kg/hr"},{xtype:"button",itemId:"orderBIType6",style:"width:130px;height:25px;margin: 1px;",text:"mcg/kg/min"},{xtype:"button",itemId:"orderBIType7",style:"width:100px;height:25px;margin: 1px;",text:"unit/min"},{xtype:"button",itemId:"orderBIType8",style:"width:100px;height:25px;margin: 1px;",text:"mcg/min"},{xtype:"button",itemId:"orderBIType9",style:"width:100px;height:25px;margin: 1px;",text:"mg/hr"}]}]}],listeners:[{fn:"onMOCP_OrderOrderMonitorMainShow",event:"show",delegate:"#MOCP_OrderOrderMonitorMain"},{fn:"onMybutton196Tap",event:"tap",delegate:"#mybutton196"},{fn:"onMOCP_OrderOrderMonitorFormShow",event:"show",delegate:"#MOCP_OrderOrderMonitorForm"},{fn:"onMOCP_OrdDCLoginShow",event:"show",delegate:"#MOCP_OrdDCLogin"},{fn:"onMOCP_OrdDCInfoShow",event:"show",delegate:"#MOCP_OrdDCInfo"},{fn:"onMOCP_ExeCancelBtnTap",event:"tap",delegate:"#MOCP_ExeCancelBtn"},{fn:"onMOCP_StepExeBtnTap",event:"tap",delegate:"#MOCP_StepExeBtn"},{fn:"onOrderExcuteCheckFootBarShow",event:"show",delegate:"#OrderExcuteCheckFootBar"},{fn:"onMOCP_ExecancelBtnTap",event:"tap",delegate:"#MOCP_ExecancelBtn"},{fn:"onMOCP_ExedoBtnTap",event:"tap",delegate:"#MOCP_ExedoBtn"},{fn:"onOrderExcuteDoFootBarShow",event:"show",delegate:"#OrderExcuteDoFootBar"},{fn:"onMOCP_TreatcancelBtnTap",event:"tap",delegate:"#MOCP_TreatcancelBtn"},{fn:"onMOCP_TreatExedoBtnTap",event:"tap",delegate:"#MOCP_TreatExedoBtn"},{fn:"onMybutton137Tap",event:"tap",delegate:"#mybutton137"},{fn:"onMybutton138Tap",event:"tap",delegate:"#mybutton138"},{fn:"onMybutton139Tap",event:"tap",delegate:"#mybutton139"},{fn:"onMybutton140Tap",event:"tap",delegate:"#mybutton140"},{fn:"onMybutton142Tap",event:"tap",delegate:"#mybutton142"},{fn:"onMybutton141Tap",event:"tap",delegate:"#mybutton141"},{fn:"onOrderBIType1Tap",event:"tap",delegate:"#orderBIType1"},{fn:"onOrderBIType2Tap",event:"tap",delegate:"#orderBIType2"},{fn:"onOrderBIType3Tap",event:"tap",delegate:"#orderBIType3"},{fn:"onOrderBIType4Tap",event:"tap",delegate:"#orderBIType4"},{fn:"onOrderBIType5Tap",event:"tap",delegate:"#orderBIType5"},{fn:"onOrderBIType6Tap",event:"tap",delegate:"#orderBIType6"},{fn:"onOrderBIType7Tap",event:"tap",delegate:"#orderBIType7"},{fn:"onOrderBIType8Tap",event:"tap",delegate:"#orderBIType8"},{fn:"onOrderBIType9Tap",event:"tap",delegate:"#orderBIType9"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelPainted",event:"painted"},{fn:"onPanelShow",event:"show"}]},onMOCP_OrderOrderMonitorMainShow:function(a,b){this.down("#MOCP_OrderOrderMonitorForm").setHidden(true)},onMybutton196Tap:function(d,f,b){var g="";var a=this.down("#MOCP_Monitorphraselist").getSelection();Ext.each(a,function(e){if(null!=e){g=g+e.data.name}});this.down("#orderMonitorRemark").setValue(g);g=null;delete null;a=null;delete null;this.down("#MOCP_OrderOrderMonitorMain").setHidden(false)},onMOCP_OrderOrderMonitorFormShow:function(a,b){this.down("#MOCP_OrderOrderMonitorMain").setHidden(true)},onMOCP_OrdDCLoginShow:function(a,b){Ext.getCmp("MOCP_OrdDCInfo").setHidden(true)},onMOCP_OrdDCInfoShow:function(a,b){Ext.getCmp("MOCP_OrdDCLogin").setHidden(true)},onMOCP_ExeCancelBtnTap:function(b,d,a){this.ClosePanel(false)},onMOCP_StepExeBtnTap:function(b,f,a){if(!this.down("#MOCP_OrderDoubleConfirmBar").isHidden()){var d=this;if(null==this.down("#MOCP_DoubleConfirmId").getValue()||""==this.down("#MOCP_DoubleConfirmId").getValue()){NisTRApp.view.Misc.Alert("請輸入覆核人員帳號!",2000);return}if(null==this.down("#MOCP_DoubleConfirmPw").getValue()||""==this.down("#MOCP_DoubleConfirmPw").getValue()){NisTRApp.view.Misc.Alert("請輸入覆核人員密碼!",2000);return}d.setMasked({xtype:"loadmask",message:"驗證中...."});NisTRApp.view.SysUtility.KfccAuthentication(this.down("#MOCP_DoubleConfirmId").getValue(),this.down("#MOCP_DoubleConfirmPw").getValue(),function(e){d.setMasked(false);d.down("#MOCP_DoubleConfirmId").setValue("");d.down("#MOCP_DoubleConfirmPw").setValue("");d.down("#MOCP_DoubleConfirmNo").setValue(e.data.UserID);d.down("#MOCP_DoubleConfirmName").setValue(e.data.UserName);d.down("#MOCP_OrdDCInfo").show();d.down("#MOCP_txtExePanel").setHidden(false);d.down("#OrderExcuteDoFootBar").setHidden(false);d=null;delete d},function(e){d.setMasked(false);Ext.Msg.alert(e);d=null;delete d;return})}else{this.down("#MOCP_txtExePanel").setHidden(false);this.down("#OrderExcuteDoFootBar").setHidden(false)}},onOrderExcuteCheckFootBarShow:function(a,b){this.down("#OrderExcuteDoFootBar").setHidden(true)},onMOCP_ExecancelBtnTap:function(b,d,a){this.down("#MOCP_txtExePanel").setHidden(true);this.down("#MOCP_divExePanel").setHidden(true);this.down("#MOCP_TxtExeContent").setValue("");this.down("#OrderExcuteCheckFootBar").setHidden(false);this.down("#MOCP_DoubleConfirmNo").setValue("");this.down("#MOCP_DoubleConfirmName").setValue("");if(!this.down("#MOCP_OrderDoubleConfirmBar").isHidden()){this.down("#MOCP_OrdDCLogin").setHidden(false)}},onMOCP_ExedoBtnTap:function(f,g,h){if(Ext.isEmpty(this.down("#MOCP_OrderExeTime").getValue())){NisTRApp.view.Misc.Alert("醫療執行時間不得為空值!",1200);return}var j=this.down("#MOCP_OrderExeDate").getValue();var n=this.down("#MOCP_OrderExeTime").getValue();var b=new Date(j.getFullYear(),j.getMonth(),j.getDate(),n.getHours(),n.getMinutes(),0);if(b>new Date()){NisTRApp.view.Misc.Alert("醫療執行日期時間不得大於現在，請確認醫療執行日期時間!",1200);return}if(parseInt(Math.abs(b-new Date())/1000/60/60/24)>30){NisTRApp.view.Misc.Alert("醫療執行日期時間不得小於30天前，請確認醫療執行日期時間!",1200);return}j=null;delete j;n=null;delete n;b=null;delete b;var m=this.getRecord();var a="";if(this.getTimeBlock()=="OverTime"||this.getTimeBlock()=="PrnAo"||this.getTimeBlock()=="Stat"){a=""}else{a=this.getTimeBlock()}var l=NisTRApp.view.Management.OrderCheckPanel.GroupByOrddrid(this.getExeOrders());var k=this;Ext.Viewport.setMasked({xtype:"loadmask",message:"Saving..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/OrderStatusUpdate.ashx",scope:this,method:"POST",params:{InpNo:m.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),OrddRid:l,codeStrList:"",TimeBlock:a,DruglogRemark:this.down("#MOCP_TxtExeContent").getValue(),ExeDate:this.down("#MOCP_OrderExeDate").getFormattedValue(),ExeTime:this.down("#MOCP_OrderExeTime").getFormattedValue("Hi"),DblchkID:this.down("#MOCP_DoubleConfirmNo").getValue()},success:function(d){Ext.Viewport.setMasked(false);var e=Ext.decode(d.responseText);NisTRApp.view.Misc.Alert(e.Message,(e.Success?800:0));if(e.Success){k.ClosePanel(true)}e=null;delete e;k=null;delete k},failure:function(){Ext.Viewport.setMasked(false);Ext.Msg.alert(" 存檔失敗 ");k=null;delete k}});a=null;delete a;m=null;delete m;l=null;delete l},onOrderExcuteDoFootBarShow:function(a,b){this.down("#OrderExcuteCheckFootBar").setHidden(true);this.down("#MOCP_divExePanel").setHidden(false)},onMOCP_TreatcancelBtnTap:function(b,d,a){this.ClosePanel(false)},onMOCP_TreatExedoBtnTap:function(b,g,h){if(Ext.isEmpty(this.down("#MOCP_OrderExeTime").getValue())){NisTRApp.view.Misc.Alert("醫療執行時間不得為空值!",1200);return}var j=this.down("#MOCP_OrderExeDate").getValue();var p=this.down("#MOCP_OrderExeTime").getValue();var a=new Date(j.getFullYear(),j.getMonth(),j.getDate(),p.getHours(),p.getMinutes(),0);if(a>new Date()){NisTRApp.view.Misc.Alert("醫療執行日期時間不得大於現在，請確認醫療執行日期時間!",1200);return}if(parseInt(Math.abs(a-new Date())/1000/60/60/24)>30){NisTRApp.view.Misc.Alert("醫療執行日期時間不得小於30天前，請確認醫療執行日期時間!",1200);return}j=null;delete j;p=null;delete p;a=null;delete a;var o=this.getRecord();var m=function m(r){var e=[];var d=[];var q="N";$(".bill").each(function(){var x=document.getElementById($(this).attr("id"));if(x.checked){e.push($(this).attr("value"));if($("#fieldTotalQty"+$(this).attr("value")).val()==undefined){d.push("1")}else{if($("#fieldTotalQty"+$(this).attr("value")).val()==null||$("#fieldTotalQty"+$(this).attr("value")).val()==""){q="Y";Ext.Msg.alert("請填寫計價帳務數量 ! ")}else{if($("#fieldTotalQty"+$(this).attr("value")).val()=="0"){q="Y";Ext.Msg.alert('計價帳務數量不得為"0" ! ')}else{d.push($("#fieldTotalQty"+$(this).attr("value")).val())}}}}x=null;delete cd});if(q=="Y"){e=null;delete e;d=null;delete d;q=null;delete q;return}var w=r.getRecord();var s="";if(r.getTimeBlock()=="OverTime"||r.getTimeBlock()=="PrnAo"||r.getTimeBlock()=="Stat"){s=""}else{s=r.getTimeBlock()}var u=NisTRApp.view.Management.OrderCheckPanel.GroupByOrddrid(r.getExeOrders());var v=w.getIpbinp();Ext.Viewport.setMasked({xtype:"loadmask",message:"Saving..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/OrderStatusUpdate.ashx",scope:r,method:"POST",params:{InpNo:w.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),OrddRid:u,codeStrList:e.toString(),NowBedNo:v.data.NowBedno,TimeBlock:s,DruglogRemark:r.down("#MOCP_TxtExeContent").getValue(),ExeDate:r.down("#MOCP_OrderExeDate").getFormattedValue(),ExeTime:r.down("#MOCP_OrderExeTime").getFormattedValue("Hi"),BillTotalQty:d.toString(),DblchkID:r.down("#MOCP_DoubleConfirmNo").getValue()},success:function(x){Ext.Viewport.setMasked(false);var y=Ext.decode(x.responseText);NisTRApp.view.Misc.Alert(y.Message,(y.Success?800:0));if(y.Success){r.ClosePanel(true)}y=null;delete y;r=null;delete r},failure:function(){Ext.Viewport.setMasked(false);Ext.Msg.alert(" 存檔失敗 ");r=null;delete r}});v=null;delete v;w=null;delete w;u=null;delete u;s=null;delete s;e=null;delete e;d=null;delete d;q=null;delete q};var l=function l(e){var d=e.down("#MOCP_OrderOrderMonitorPanel");if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.getRecord())){if(!Ext.isEmpty(d.down("#orderMonitorValue").getValue())||!Ext.isEmpty(d.down("#orderMonitorRemark").getValue())){var q=d.down("#orderMonitorValue").getValue();var u=d.down("#orderMonitorRemark").getValue();d.setMasked({xtype:"loadmask",message:"Saveing..."});var s=e.getRecord();var r=d.getRecord();Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/OrderExecuteMonitorInsert.ashx",scope:e,method:"POST",params:{ChartNo:s.data.ChartNo,InpNo:s.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),TprType:r.data.TprType,TprCode:r.data.TprCode,TprValue:q,Remark:u,InputDate:e.down("#MOCP_OrderExeDate").getFormattedValue(),InputTime:e.down("#MOCP_OrderExeTime").getFormattedValue(),TprName:""},success:function(v){d.setMasked(false);var w=Ext.decode(v.responseText);NisTRApp.view.Misc.Alert(w.Message,(w.Success?800:0));w=null;delete w;e=null;delete e;d=null;delete d},failure:function(){d.setMasked(false);Ext.Msg.alert("存檔失敗");d=null;delete d;e=null;delete e}});q=null;delete q;u=null;delete u;s=null;delete s;r=null;delete r}}else{d=null;delete d;e=null;delete e}};var k=this;if(!this.down("#MOCP_OrderDoubleConfirmBar").isHidden()){if(null==this.down("#MOCP_DoubleConfirmId").getValue()||""==this.down("#MOCP_DoubleConfirmId").getValue()){NisTRApp.view.Misc.Alert("請輸入覆核人員帳號!",2000);return}if(null==this.down("#MOCP_DoubleConfirmPw").getValue()||""==this.down("#MOCP_DoubleConfirmPw").getValue()){NisTRApp.view.Misc.Alert("請輸入覆核人員密碼!",2000);return}k.setMasked({xtype:"loadmask",message:"驗證中...."});NisTRApp.view.SysUtility.KfccAuthentication(this.down("#MOCP_DoubleConfirmId").getValue(),this.down("#MOCP_DoubleConfirmPw").getValue(),function(d){k.setMasked(false);k.down("#MOCP_DoubleConfirmId").setValue("");k.down("#MOCP_DoubleConfirmPw").setValue("");k.down("#MOCP_DoubleConfirmNo").setValue(d.data.UserID);k.down("#MOCP_DoubleConfirmName").setValue(d.data.UserName);m(k);l(k);k=null;delete k;m=null;delete m;l=null;delete l},function(d){k.setMasked(false);Ext.Msg.alert(d);k=null;delete k;m=null;delete m;l=null;delete l;return})}else{var f=0;var n=0;$(".bill").each(function(){var d=document.getElementById($(this).attr("id"));if(d.checked){n=n+1}f=f+1});if(f>0&&n<1){Ext.Msg.confirm("未勾選計價項目！","是否存檔?",function(e,q,d){if(e=="no"){return}else{if(e=="yes"){m(this);l(this);k=null;delete k;m=null;delete m;l=null;delete l}}},this)}else{m(this);l(this);k=null;delete k;m=null;delete m;l=null;delete l}}},onMybutton137Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onMybutton138Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onMybutton139Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onMybutton140Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onMybutton142Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onMybutton141Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onOrderBIType1Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onOrderBIType2Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onOrderBIType3Tap:function(b,d,a){this.down("#MOCP_TxtExeContent").setValue(b.getText())},onOrderBIType4Tap:function(d,f,b){var a=this.down("#MOCP_TxtExeContent").getValue();this.down("#MOCP_TxtExeContent").setValue(a+d.getText());a=null;delete a},onOrderBIType5Tap:function(d,f,b){var a=this.down("#MOCP_TxtExeContent").getValue();this.down("#MOCP_TxtExeContent").setValue(a+d.getText());a=null;delete a},onOrderBIType6Tap:function(d,f,b){var a=this.down("#MOCP_TxtExeContent").getValue();this.down("#MOCP_TxtExeContent").setValue(a+d.getText());a=null;delete a},onOrderBIType7Tap:function(d,f,b){var a=this.down("#MOCP_TxtExeContent").getValue();this.down("#MOCP_TxtExeContent").setValue(a+d.getText());a=null;delete a},onOrderBIType8Tap:function(d,f,b){var a=this.down("#MOCP_TxtExeContent").getValue();this.down("#MOCP_TxtExeContent").setValue(a+d.getText());a=null;delete a},onOrderBIType9Tap:function(d,f,b){var a=this.down("#MOCP_TxtExeContent").getValue();this.down("#MOCP_TxtExeContent").setValue(a+d.getText());a=null;delete a},onPanelDestroy:function(a){if(Ext.getStore("sDrugBasicInfo")!=null){Ext.getStore("sDrugBasicInfo").removeAll();Ext.getStore("sDrugBasicInfo").destroy()}if(Ext.getStore("sOrderBill")!=null){Ext.getStore("sOrderBill").removeAll();Ext.getStore("sOrderBill").destroy()}if(Ext.getStore("sSystpr")!=null){Ext.getStore("sSystpr").removeAll();Ext.getStore("sSystpr").destroy()}if(Ext.getStore("storeOptions1")!=null){Ext.getStore("storeOptions1").removeAll();Ext.getStore("storeOptions1").destroy()}console.log("On destroy :","Management.OrderCheckPanel");this.removeAll(true,true)},onPanelPainted:function(b,a){},onPanelShow:function(b,e){var a=NisTRApp.view.SysUtility.tapEventName();$("#_imgExeContent").unbind(a);var f=this;$("#_imgExeContent").bind(a,function(){if(true==f.down("#MOCP_divExePanel").isHidden()){f.down("#MOCP_divExePanel").show()}else{f.down("#MOCP_divExePanel").hide()}});$("#_mocpDivExeTxt").unbind(a);$("#_mocpDivExeTxt").bind(a,function(){f.down("#MOCP_divExePanel").hide()});$("#_OpenMonitorItem").unbind(a);$("#_OpenMonitorItem").bind(a,function(){f.down("#MOCP_OrderOrderMonitorForm").setHidden(false)});var d=this.getExeOrders()[0];if((d.MajorClass!="0"||d.OrderType=="CH"||d.OrderType=="PC"||d.MedFlag=="Y")){$("#_imgExeContent").show()}else{$("#_imgExeContent").hide()}a=null;delete a;d=null;delete d},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("MgrOrderExcute 住院資料錯誤");return false}if(Ext.isEmpty(this.getExeOrders())||!Ext.isArray(this.getExeOrders())||this.getExeOrders().length<=0){Ext.Msg.alert("請選擇醫屬");return false}if(Ext.isEmpty(this.getTimeBlock()||this.getTimeBlock()=="undefined")){Ext.Msg.alert("給藥時段錯誤");return false}if(Ext.getStore("sOrderBill")==null){Ext.create("Ext.data.Store",{storeId:"sOrderBill",clearOnPageLoad:false,model:"NisTRApp.model.Sys.SystreatdEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/OrderExecBills.ashx",reader:{type:"json"}}})}if(Ext.getStore("sSystpr")==null){Ext.create("Ext.data.Store",{storeId:"sSystpr",clearOnPageLoad:false,model:"NisTRApp.model.Sys.SystprEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/QueryOrderTprItem.ashx",reader:{type:"json"}}})}if(Ext.data.ModelManager.getModel("Options")==null){Ext.define("Options",{extend:Ext.data.Model,config:{fields:[{name:"name",type:"string"},{name:"id",type:"int"}]}})}if(Ext.getStore("storeOptions1")==null){Ext.create("Ext.data.Store",{model:"Options",id:"storeOptions1"})}this.initialExeData();var g=[];var d=false;this.getExeOrders().forEach(function b(j,h,k){g.push(j);if(j.DblchkFlag=="Y"){d=true}});this.down("#MOCP_OrderDoubleConfirmBar").setHidden(!d);var a={ChartNo:this.getRecord().data.ChartNo,InpNO:this.getRecord().data.InpNO,Orders:g};if(!Ext.isEmpty(a)){this.down("#MOCP_OrderOrderPanel").setHtml("");var f=this.down("#MOCP_OrderOrderPanel").getTpl().apply(a);this.down("#MOCP_OrderOrderPanel").setHtml(f);f=null;delete f}g=null;delete g;a=null;delete a;d=null;delete d;this.down("#MOCP_txtExePanel").setHidden(true);this.down("#MOCP_OrderOrderDrugInfoPanel").setHidden(true);this.down("#MOCP_OrderOrderClc").setHidden(true);this.down("#MOCP_OrderOrderSpec").setHidden(true);this.down("#OrderExcuteCheckFootBar").setHidden(true);this.down("#OrderExcuteDoFootBar").setHidden(true);this.down("#OrderExcuteDoTreatFootBar").setHidden(true);var e=this.getExeOrders()[0];if(e.MajorClass=="00"){this.down("#OrderExcuteCheckFootBar").setHidden(false);this.initialDrugBasicInfo();this.down("#MOCP_OrderOrderDrugInfoPanel").setHidden(false);this.down("#MOCP_OrderOrderSpec").setHidden(false);this.initialDivExePanel(e.CodeNo)}else{if(e.IsEsam||e.IsEsam=="true"){this.down("#OrderExcuteDoTreatFootBar").setHidden(false)}else{if(e.MajorClass=="0"){this.down("#MOCP_txtExePanel").setHidden(false);this.down("#OrderExcuteDoTreatFootBar").setHidden(false);this.initialOrderBill(e.CodeNo);this.initialMonitorExplain(e.CodeNo);this.down("#MOCP_OrderOrderClc").setHidden(false);this.down("#MOCP_OrderOrderSpec").setHidden(false)}}}e=null;delete e},initialExeData:function(){var a=Ext.create("Ext.field.DatePicker",{itemId:"MOCP_OrderExeDate",width:"30%",labelWidth:"40%",label:"醫囑執行日期",value:new Date(),placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}});this.down("#MOCP_SelectTimeSection").add(a);a=Ext.create("Ext.ux.field.TimePicker",{itemId:"MOCP_OrderExeTime",width:"30%",labelWidth:"30%",label:"執行時間",value:new Date(),destroyPickerOnHide:false,defaultTime:"8:00",clearIcon:false,placeHolder:"請輸入",ui:"select",picker:{useTitles:true,startHour:0,endHour:23,minuteIncrement:5,slotOrder:["hour","minute"],doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}},component:{useMask:true}});if(this.getTimeBlock()=="OverTime"){a.setValue(null)}this.down("#MOCP_SelectTimeSection").add(a);a=Ext.create("Ext.field.Text",{disabled:false,readOnly:true,itemId:"MOCP_TxtTimeBlock",width:"30%",label:"執行時段",placeHolder:"系統預設"});if(this.getTimeBlock()=="OverTime"){a.setValue("")}else{if(this.getTimeBlock()=="PrnAo"||this.getTimeBlock()=="Stat"){a.setValue("")}else{a.setValue((this.getTimeBlock().substring(8,10)+":"+this.getTimeBlock().substring(10,12)))}}this.down("#MOCP_SelectTimeSection").add(a);a=Ext.create("Ext.field.Hidden",{xtype:"hiddenfield",itemId:"MOCP_HiddenTimeBlock"});this.down("#MOCP_SelectTimeSection").add(a);a=Ext.create("Ext.field.Hidden",{xtype:"hiddenfield",itemId:"MOCP_HiddenFieldIsDelay"});this.down("#MOCP_SelectTimeSection").add(a);a=null;delete a},initialDrugBasicInfo:function(){if(Ext.isEmpty(Ext.getStore("sDrugBasicInfo"))){Ext.create("Ext.data.Store",{storeId:"sDrugBasicInfo",clearOnPageLoad:false,model:"NisTRApp.model.Sys.SysstdEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/DrugBasicInfo.ashx",reader:{type:"json"}}})}this.down("#MOCP_DrugInfoList").setStore(Ext.getStore("sDrugBasicInfo"));if(!Ext.isEmpty(this.getExeOrders())&&this.getExeOrders().length==1){if(this.getExeOrders()[0].MajorClass=="00"){NisTRApp.view.Management.OrderCheckPanel.LoadDrugBasicInfo(this.getExeOrders()[0].CodeNo)}}else{if(!Ext.isEmpty(this.getExeOrders())&&this.getExeOrders().length>0){if(this.getExeOrders()[0].MajorClass=="00"){var b=[];this.getExeOrders().forEach(function a(e,d,f){b.push(e.CodeNo)});NisTRApp.view.Management.OrderCheckPanel.LoadDrugBasicInfo(b);b=null;delete b}}}},initialDivExePanel:function(a){},initialOrderBill:function(b){if(Ext.getStore("sOrderBill").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sOrderBill");a.removeAll();a.getProxy().setExtraParams({TRCode:b});a.load({callback:function(e,d,f){NisTRApp.view.Management.OrderCheckPanel.RenderOrderBillTable(this)},scope:this});a=null;delete a},ClosePanel:function(a){if(!Ext.isEmpty(this.getCloseFn())&&Ext.isFunction(this.getCloseFn())){this.getCloseFn()(this.getCaller(),a)}this.setHidden(true);Ext.callback(function(b){b.destroy()},this,[this],200)},initialMonitorExplain:function(d){if(Ext.getStore("sSystpr").isLoading()){return}var a=this.down("#MOCP_OrderOrderMonitorPanel");a.setRecord(null);a.setHidden(false);var b=Ext.getStore("sSystpr");b.getProxy().setExtraParams({TprCode:d});if(!Ext.isEmpty(a)){a.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})}b.load({callback:function(g,f,k){if(!Ext.isEmpty(a)){a.setMasked(false)}if(!Ext.isEmpty(g)&&!Ext.isEmpty(g[0])&&!Ext.isEmpty(g[0].data)){a.setRecord(g[0]);var j=g[0].data;var e='<div  class="globalList" ><table  style="width:100%"><thead><th >'+j.TprName+"</th></thead></div>";a.down("#MOCP_OrderOrderMonitorLabel").setHtml(e);a.down("#orderMonitorExplain").setValue(j.Explain);Ext.getStore("storeOptions1").removeAll();var h=0;var l=[];if(!Ext.isEmpty(j.PhraseList)){Ext.each(j.PhraseList,function(m){if(""!=m){l[h]=Ext.create("Options",{name:m,id:h});h=h+1}});if(l.length!=0){Ext.getStore("storeOptions1").setData(l)}a.down("#MOCP_Monitorphraselist").setStore(Ext.getStore("storeOptions1"))}j=null;delete j;e=null;delete e;l=null;delete l;h=null;delete h}else{a.setHidden(true)}a=null;delete a},scope:this});b=null;delete b;d=null;delete d}});Ext.define("NisTRApp.view.Management.NursingOrder",{extend:Ext.Container,alias:"widget.NursingOrder",config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"list",itemId:"NursingOrderList",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>","<span>{TRName}</span>",'    <img src="../_/img/redCross.png" style="height:30px;width:30px;float:right;" trcode="{TRCode}" class="addNursingOrder" name="{TRName}"/>',"</div>"]}],listeners:[{fn:"onNursingOrderListItemTap",event:"itemtap",delegate:"#NursingOrderList"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onNursingOrderListItemTap:function(b,d,h,a,g,f){this.AddNursingOrder(this.getRecord(),a,this)},onContainerPainted:function(b,a){if(Ext.getStore("sNursingOrder").getCount()<=0){this.LoabNursingOrders()}},onContainerDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("NursingOrder 住院資料錯誤");return false}if(Ext.getStore("sNursingOrder")==null){Ext.create("Ext.data.Store",{storeId:"sNursingOrder",model:"NisTRApp.model.Sys.SystreatmEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/NursingOrderList.ashx",reader:{type:"json"}}})}this.down("#NursingOrderList").setStore(Ext.getStore("sNursingOrder"))},LoabNursingOrders:function(){if(Ext.getStore("sNursingOrder").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=Ext.getStore("sNursingOrder");a.removeAll();a.load({callback:function(d,b,e){},scope:this});a=null;delete a},AddNursingOrder:function(g,b,a){if(Ext.isEmpty(g)||Ext.isEmpty(b)||Ext.isEmpty(a)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_inpMgrNursingOrderCreatPanel"))){Ext.getCmp("_inpMgrNursingOrderCreatPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpMgrNursingOrderCreatPanel"))){var f=Ext.create("NisTRApp.view.Management.NursingOrderCreatPanel",{id:"_inpMgrNursingOrderCreatPanel",caller:a,record:g,nsOrder:b});a.overlay=Ext.Viewport.add(f);f=null;delete f}a.overlay.show()}catch(d){console.log(d)}return}});Ext.define("NisTRApp.view.Management.NursingOrderCreatPanel",{extend:Ext.Panel,config:{centered:true,height:"250px",width:"480px",layout:{type:"fit"},modal:true,caller:{},nsOrder:{},items:[{xtype:"toolbar",docked:"top",itemId:"MNOCP_HeadBar",title:"TRName"},{xtype:"fieldset",itemId:"MNOCP_FieldSet",items:[{xtype:"selectfield",itemId:"MNOCP_Selectfreq",label:"瓶次",labelWidth:"15%"},{xtype:"textfield",itemId:"MNOCP_NursingOrderRemark",label:"備註",labelWidth:"15%",autoCapitalize:true,placeHolder:"請輸入"}]},{xtype:"toolbar",docked:"bottom",itemId:"MNOCP_FootBar",items:[{xtype:"button",itemId:"MNOCP_SaveBtn",left:"1px",ui:"decline",width:"48%",text:"資 料 儲 存"},{xtype:"button",itemId:"MNOCP_CancelBtn",right:"1px",ui:"confirm",width:"48%",text:"取 消"}]}],listeners:[{fn:"onMNOCP_SaveBtnTap",event:"tap",delegate:"#MNOCP_SaveBtn"},{fn:"onMNOCP_CancelBtnTap",event:"tap",delegate:"#MNOCP_CancelBtn"},{fn:"onPanelDestroy",event:"destroy"}]},onMNOCP_SaveBtnTap:function(d,f,b){if(Ext.isEmpty(this.getRecord())){return}var g=this.getRecord();var a=this.getNsOrder().data;this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/Action/NursingOrderInsert.ashx",scope:this,method:"POST",params:{InpNo:g.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),TRCode:a.TRCode,Frequency:this.down("#MNOCP_Selectfreq").getValue(),Remark:this.down("#MNOCP_NursingOrderRemark").getValue()},success:function(e){this.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){this.destroy()}h=null;delete h},failure:function(){Ext.Msg.alert("存檔失敗");this.setMasked(false)}});a=null;delete a;g=null;delete g},onMNOCP_CancelBtnTap:function(b,d,a){this.destroy()},onPanelDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getNsOrder())||Ext.isEmpty(this.getNsOrder().data.TRName)){Ext.Msg.alert("NursingOrder 住院資料錯誤");return false}var a=this.getNsOrder().data;this.down("#MNOCP_HeadBar").setTitle(a.TRName);this.down("#MNOCP_Selectfreq").setOptions([{text:"QD",value:"QD"},{text:"BID",value:"BID"},{text:"QID",value:"QID"},{text:"Q2H",value:"Q2H"},{text:"Q8H",value:"Q8H"},{text:"QD",value:"QD"},{text:"QOD",value:"QOD"},{text:"Q3D",value:"Q3D"},{text:"QW",value:"QW"},{text:"STAT",value:"STAT"},{text:"AO",value:"AO"}]);this.down("#MNOCP_Selectfreq").setValue(a.Frequency);a=null;delete a}});Ext.define("NisTRApp.view.VitalSigns.MonitorView",{extend:Ext.Container,alias:"widget.VitalSignsMonitorView",statics:{RenderDailyMonitorTable:function(e,l,d){if(Ext.getStore("sVsTprDailyData").isLoading()||Ext.isEmpty(l)){return}var g=Ext.getStore("sVsTprDailyData");e.down("#VSMV_DailyMonitorPanel").setHtml("");if(g.getCount()>0){e.down("#VSMV_DailyMonitorPanel").setHtml("");var h="";var b=$('<div id="_vitalSignsDailyMonitor" class="globalList"></div>');$('<asp:HiddenField ID="hdf_id" runat="server" />').appendTo(b);$('<asp:HiddenField ID="hdf_TprCode" runat="server" />').appendTo(b);var a=$('<table id="_vitalSignsDailyMonitorTable" style="width:100%" ></table>');var j;j="<thead><tr >";j+='<th style="width:300px">項目</th>';j+="<th >Daily</th>";j+="<th >07</th>";j+="<th >08</th>";j+="<th >09</th>";j+="<th >10</th>";j+="<th >11</th>";j+="<th >12</th>";j+="<th >13</th>";j+="<th >14</th>";j+="<th >15</th>";j+="<th >16</th>";j+="<th >17</th>";j+="<th >18</th>";j+="<th >19</th>";j+="<th >20</th>";j+="<th >21</th>";j+="<th >22</th>";j+="<th >23</th>";j+="<th >00</th>";j+="<th >01</th>";j+="<th >02</th>";j+="<th >03</th>";j+="<th >04</th>";j+="<th >05</th>";j+="<th >06</th>";j+="</tr></thead>";a.append(j);a.append("<tbody>");var k;k="<tr >";k+='<th style="width:300px">項目</th>';k+="<th >Daily</th>";k+="<th >07</th>";k+="<th >08</th>";k+="<th >09</th>";k+="<th >10</th>";k+="<th >11</th>";k+="<th >12</th>";k+="<th >13</th>";k+="<th >14</th>";k+="<th >15</th>";k+="<th >16</th>";k+="<th >17</th>";k+="<th >18</th>";k+="<th >19</th>";k+="<th >20</th>";k+="<th >21</th>";k+="<th >22</th>";k+="<th >23</th>";k+="<th >00</th>";k+="<th >01</th>";k+="<th >02</th>";k+="<th >03</th>";k+="<th >04</th>";k+="<th >05</th>";k+="<th >06</th>";k+="</tr>";var f;g.each(function(v,s,m){var r=v.raw;var p="";var q=0;if(f!=undefined&f!=r.TypeMajorName){a.append(k)}v.raw.infos.forEach(function n(z,x,A){var y=z;var w="";if(r.Name=="Balance"||r.Name=="Output"||r.Name=="Intake"||r.Name=="Grand Total"||r.Name=="Hourly Total"){w=y.StringValue}else{if(y.StringValue.trim().length>4){w='<span style="color:#800080;">'+y.StringValue.substr(0,4)+"</span>"}else{w=y.StringValue}}p+='<td style="width:3.5%" onclick="if(this.title.trim().length > 4){NisTRApp.view.Misc.Alert(this.title,1500);}" title="'+y.StringValue+'">'+w+"</td>";q=q+1;w=null;delete w;y=null;delete y});var u="";f=r.TypeMajorName;switch(r.TypeMajorName){case"Monitor":u="color:MidnightBlue;";break;case"Intake":u="color:MidnightBlue";break;case"IntakeIV":u="color:MidnightBlue;";break;case"Output":u="color:MidnightBlue;";break;default:}var o="";if(r.Name=="Balance"||r.Name=="Output"||r.Name=="Intake"||r.Name=="Grand Total"||r.Name=="Hourly Total"){o=r.Daily;a.append('<tr style="color: Maroon;background-color: #C0C0C0;font-weight: bolder;"><td style="width:250px;">'+r.Name+'</td><td style="width:3.5%;color:green;font-weight:bolder" title="'+o+'">'+o+"</td>"+p+"</tr>")}else{if(r.Daily==0){o=""}else{o=r.Daily}a.append('<tr><td style="width:250px;font-weight: bolder;'+u+'" class="title"   name="'+r.TprType+"@"+r.Name+"@"+r.TprCode+"@00@"+r.Phrase+"@"+r.TprUnit+'"  type="button" onclick="if(this.title.trim().length > 24){{NisTRApp.view.Misc.Alert(this.title,1500);}}" title="'+r.Name+" "+(r.SelfCode==null?"":r.SelfCode)+'">'+(r.Name+" "+(r.SelfCode==null?"":r.SelfCode)).substr(0,25)+'</td><td style="width:3.5%;color:green;font-weight:bolder" title="'+o+'">'+o+"</td>"+p+"</tr>")}o=null;delete o;u=null;delete u;p=null;delete p;r=null;delete r;q=null;delete q});a.append("</tbody>");a.appendTo(b);e.down("#VSMV_DailyMonitorPanel").setHtml(b[0].outerHTML);h=null;delete h;eventName=null;delete eventName;a=null;delete a;f=null;delete f;j=null;delete j;k=null;delete k;b=null;delete b}else{e.down("#VSMV_DailyMonitorPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無資料.</div>')}e=null;delete e;d=null;delete d;g=null;delete g;one=null;delete one},RenderWeeklyMonitorTable:function(f,k,e){if(Ext.getStore("sVsTprWeeklyData").isLoading()||Ext.isEmpty(k)){return}var j=Ext.getStore("sVsTprWeeklyData");f.down("#VSMV_WeeklyMonitorPanel").setHtml("");if(j.getCount()>0){f.down("#VSMV_WeeklyMonitorPanel").setHtml("");var g="";var d=$('<div id="_vitalSignsWeeklyMonitor" class="globalList"></div>');var a=$('<table id="_vitalSignsWeeklyMonitorTable" style="width:100%" ></table>');var h;var b;h="<thead><tr >";h+='<th style="width:2%;">項目/日期</th>';b='<tfoot><tr ><th style="width:2%;">項目/日期</th>';j.each(function(y,r,l){var o=y.raw;if(r==0){var z=0;y.infos().each(function m(B,A,D){var C=B.data;h+="<th >"+C.MM+"-"+C.DD+" ("+C.DayOfWeekStr+") </th>";b+="<th >"+C.MM+"-"+C.DD+" ("+C.DayOfWeekStr+")</th>";z=z++;if(z==7){C=null;delete C;return true}});h+="</tr></thead>";b+="</tr></tfoot>";a.append(h);a.append("<tbody>");z=null;delete z}var x="";var w="";var v="";var u="";var s="";var q="";var p="";var n=0;o.infos.forEach(function m(C,B,E){var D=C;for(var A=0;A<D.StringValues.length;A++){if(n==0){x+=D.StringValues[A]+"</br>"}if(n==1){w+=D.StringValues[A]+"</br>"}if(n==2){v+=D.StringValues[A]+"</br>"}if(n==3){u+=D.StringValues[A]+"</br>"}if(n==4){s+=D.StringValues[A]+"</br>"}if(n==5){q+=D.StringValues[A]+"</br>"}if(n==6){p+=D.StringValues[A]+"</br>"}}n=n+1;D=null;delete D});a.append('<tr ><td style="width:12%;font-weight: bolder;">'+o.Name+'</td><td style="width:11%;">'+x+'</td><td style="width:11%;">'+w+'</td><td style="width:11%;">'+v+'</td><td style="width:11%;">'+u+'</td><td style="width:11%;">'+s+'</td><td style="width:11%;">'+q+'</td><td style="width:11%;">'+p+"</td></tr>");x=null;delete x;w=null;delete w;v=null;delete u;s=null;delete s;q=null;delete q;p=null;delete p;tdContent=null;delete tdContent;o=null;delete o;n=null;delete n});a.append("</tbody>");a.append(b);a.appendTo(d);f.down("#VSMV_WeeklyMonitorPanel").setHtml(d[0].outerHTML);h=null;delete h;b=null;delete b;g=null;delete g;a=null;delete a;d=null;delete d}else{f.down("#VSMV_WeeklyMonitorPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無資料.</div>')}f=null;delete f;e=null;delete e;sVsTprDailyData=null;delete sVsTprDailyData;one=null;delete one}},config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"top",itemId:"VSMV_HeadBar",items:[{xtype:"panel",margin:"0 0 0 10",width:"420px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",disabled:true,itemId:"VSMV_INPBegDate",width:"55%",label:"起日",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",disabled:true,itemId:"VSMV_INPEndDate",width:"45%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"panel",itemId:"VSMV_DateFnBar",layout:{type:"hbox"},items:[{xtype:"button",itemId:"VSMV_WeeklyBtn",margin:"5 5 5 15 ",width:"90px",text:"當 週"},{xtype:"button",itemId:"VSMV_DailyBtn",margin:"5 5 5 5",ui:"confirm-round",width:"90px",text:"當 日"}]},{xtype:"button",itemId:"VSMV_RefreshBtn",right:"1px",ui:"decline",width:"150px",iconCls:"refresh",text:"重新整理"}]},{xtype:"panel",flex:1,itemId:"VSMV_DailyMonitorPanel",scrollable:"vertical"},{xtype:"panel",flex:1,hidden:true,itemId:"VSMV_WeeklyMonitorPanel",scrollable:"vertical"},{xtype:"toolbar",docked:"bottom",itemId:"VSMV_FootBar",items:[{xtype:"button",itemId:"VSMV_TimeBackBtn",left:"1px",ui:"confirm-back",width:"48%",text:"前一日"},{xtype:"button",itemId:"VSMV_TimeForwardBtn",right:"1px",ui:"confirm-forward",width:"48%",text:"後一日"}]}],listeners:[{fn:"onVSMV_WeeklyBtnTap",event:"tap",delegate:"#VSMV_WeeklyBtn"},{fn:"onVSMV_DailyBtnTap",event:"tap",delegate:"#VSMV_DailyBtn"},{fn:"onVSMV_RefreshBtnTap",event:"tap",delegate:"#VSMV_RefreshBtn"},{fn:"onVSMV_DailyMonitorPanelShow",event:"show",delegate:"#VSMV_DailyMonitorPanel"},{fn:"onVSMV_WeeklyMonitorPanelShow",event:"show",delegate:"#VSMV_WeeklyMonitorPanel"},{fn:"onVSMV_TimeBackBtnTap",event:"tap",delegate:"#VSMV_TimeBackBtn"},{fn:"onVSMV_TimeForwardBtnTap",event:"tap",delegate:"#VSMV_TimeForwardBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onVSMV_WeeklyBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#VSMV_DateFnBar"),b,"confirm-round","normal","","");this.down("#VSMV_WeeklyMonitorPanel").setHidden(false);this.down("#VSMV_INPBegDate").setValue(Ext.Date.add(NisTRApp.view.DateUtil.GetWeekFirstDay(),Ext.Date.DAY,1));this.down("#VSMV_INPEndDate").setValue(NisTRApp.view.DateUtil.GetWeekLastDay());this.down("#VSMV_TimeBackBtn").setText("前一周");this.down("#VSMV_TimeForwardBtn").setText("後一周");this.LoadWeeklyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())},onVSMV_DailyBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#VSMV_DateFnBar"),b,"confirm-round","normal","","");this.down("#VSMV_DailyMonitorPanel").setHidden(false);this.down("#VSMV_INPBegDate").setValue(SYS_CONST.SysDate);this.down("#VSMV_INPEndDate").setValue(SYS_CONST.SysDate);this.down("#VSMV_TimeBackBtn").setText("前一日");this.down("#VSMV_TimeForwardBtn").setText("後一日");this.LoadDailyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())},onVSMV_RefreshBtnTap:function(b,d,a){if("confirm-round"==this.down("#VSMV_WeeklyBtn").getUi()){this.LoadWeeklyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())}else{this.LoadDailyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())}},onVSMV_DailyMonitorPanelShow:function(a,b){this.down("#VSMV_WeeklyMonitorPanel").setHidden(true)},onVSMV_WeeklyMonitorPanelShow:function(a,b){this.down("#VSMV_DailyMonitorPanel").setHidden(true)},onVSMV_TimeBackBtnTap:function(b,f,a){var d=-1;if("confirm-round"==this.down("#VSMV_WeeklyBtn").getUi()){d=-7}this.down("#VSMV_INPBegDate").setValue(Ext.Date.add(this.down("#VSMV_INPBegDate").getValue(),Ext.Date.DAY,d));this.down("#VSMV_INPEndDate").setValue(Ext.Date.add(this.down("#VSMV_INPEndDate").getValue(),Ext.Date.DAY,d));if(d==-1){this.LoadDailyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())}else{if(d==-7){this.LoadWeeklyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())}}},onVSMV_TimeForwardBtnTap:function(b,f,a){var d=1;if("confirm-round"==this.down("#VSMV_WeeklyBtn").getUi()){d=7}this.down("#VSMV_INPBegDate").setValue(Ext.Date.add(this.down("#VSMV_INPBegDate").getValue(),Ext.Date.DAY,d));this.down("#VSMV_INPEndDate").setValue(Ext.Date.add(this.down("#VSMV_INPEndDate").getValue(),Ext.Date.DAY,d));if(d==1){this.LoadDailyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())}else{if(d==7){this.LoadWeeklyMonitorData(this.down("#VSMV_INPBegDate").getValue(),this.down("#VSMV_INPEndDate").getValue())}}},onContainerDestroy:function(a){if(Ext.getStore("sVsTprDailyData")!=null){Ext.getStore("sVsTprDailyData").removeAll();Ext.getStore("sVsTprDailyData").destroy()}if(Ext.getStore("sVsTprWeeklyData")!=null){Ext.getStore("sVsTprWeeklyData").removeAll();Ext.getStore("sVsTprWeeklyData").destroy()}console.log("On Destroy:","VitalSignsMonitorView");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.down("#VSMV_DailyBtn").fireEvent("tap",this.down("#VSMV_DailyBtn"),null,null)}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("INP_VitalChart 住院資料錯誤");return false}this.DateInitial();this.setInitialFlag(true);if(Ext.isEmpty(Ext.getStore("sVsTprDailyData"))){Ext.create("Ext.data.Store",{storeId:"sVsTprDailyData",clearOnPageLoad:false,model:"NisTRApp.model.VitalSigns.TprDailyData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/DailyMonitor.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){var a=b.get("TprMajor")+"‧"+b.get("TypeMajorName");switch(b.get("TypeMajorName")){case"Monitor":a="<span style='color:#EFEFEF;'>1‧</span>"+b.get("TypeMajorName");break;case"IntakeIV":a="<span style='color:#EFEFEF;'>3‧</span>"+b.get("TypeMajorName");break;case"Intake":a="<span style='color:#EFEFEF;'>4‧</span>"+b.get("TypeMajorName");break;case"Output":a="<span style='color:#EFEFEF;'>5‧</span>"+b.get("TypeMajorName");break;default:if(b.get("Name")=="Intake"||b.get("Name")=="Output"||b.get("Name")=="Balance"){var a="<span style='color:#EFEFEF;'>2‧Total I/O</span>"}break}return a}},sorters:{sorterFn:function(d,b){var a=-1;a=(d.data.TprMajor>b.data.TprMajor)?1:(d.data.TprMajor==b.data.dataTprMajor?0:-1);if(d.data.TprMajor==b.data.TprMajor){a=0}if(d.data.TprMajor>b.data.TprMajor){a=1}if(d.data.TprMajor<b.data.TprMajor){a=-1}if(a==0){if(((d.data.Name=="Output")||(d.data.Name=="Intake")||(d.data.Name=="Balance"))&&((b.data.Name=="Output")||(b.data.Name=="Intake")||(b.data.Name=="Balance"))){a=b.data.GrpSeq.localeCompare(d.data.GrpSeq)}else{a=d.data.GrpSeq.localeCompare(b.data.GrpSeq)}}if(a==0){a=(d.data.TprSeq>b.data.TprSeq)?1:(d.data.TprSeq==b.data.TprSeq?0:-1)}return a}}})}Ext.getStore("sVsTprDailyData").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sVsTprDailyData").addListener("load",function(d,b,f,a,e){NisTRApp.view.VitalSigns.MonitorView.RenderDailyMonitorTable(this,this.getRecord(),this.down("#VSMV_DateFnBar").getActiveItem());this.setMasked(false)},this);this.down("#VSMV_DailyMonitorPanel").setRecord(this.getRecord());this.down("#VSMV_DailyMonitorPanel").setHidden(false);if(Ext.isEmpty(Ext.getStore("sVsTprWeeklyData"))){Ext.create("Ext.data.Store",{storeId:"sVsTprWeeklyData",clearOnPageLoad:false,model:"NisTRApp.model.VitalSigns.TprWeeklyData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/WeeklyMonitor.ashx",reader:{type:"json"}}})}Ext.getStore("sVsTprWeeklyData").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sVsTprWeeklyData").addListener("load",function(d,b,f,a,e){NisTRApp.view.VitalSigns.MonitorView.RenderWeeklyMonitorTable(this,this.getRecord(),this.down("#VSMV_DateFnBar").getActiveItem());this.setMasked(false)},this);this.down("#VSMV_WeeklyMonitorPanel").setRecord(this.getRecord());this.down("#VSMV_WeeklyMonitorPanel").setHidden(true)},DateInitial:function(){var b=this.getRecord().getIpbinp();if(!Ext.isEmpty(b.data.OutDate)&&!Ext.isEmpty(b.data.InDate)){var a=NisTRApp.view.DateUtil.StrToDateTime(b.data.InDate);this.down("#VSMV_INPBegDate").setValue(a);this.down("#VSMV_INPEndDate").setValue(a);a=null;delete a}else{this.down("#VSMV_INPBegDate").setValue(SYS_CONST.SysDate);this.down("#VSMV_INPEndDate").setValue(SYS_CONST.SysDate)}b=null;delete b},LoadDailyMonitorData:function(d,b){if(Ext.isEmpty(this.getRecord())){return}if(Ext.getStore("sVsTprDailyData").isLoading()){return}var e=this.getRecord();var a=Ext.getStore("sVsTprDailyData");a.removeAll();a.getProxy().setExtraParams({ChartNo:e.data.ChartNo,InpNo:e.data.InpNo,BegDate:d,EndDate:b});a.load();a=null;delete a;e=null;delete e},LoadWeeklyMonitorData:function(d,a){if(Ext.isEmpty(this.getRecord())){return}if(Ext.getStore("sVsTprWeeklyData").isLoading()){return}var e=this.getRecord();var b=Ext.getStore("sVsTprWeeklyData");b.removeAll();b.getProxy().setExtraParams({ChartNo:e.data.ChartNo,InpNo:e.data.InpNo,BegDate:d,EndDate:a});b.load();b=null;delete b;e=null;delete e}});Ext.define("NisTRApp.view.VitalSigns.MonitorInput",{extend:Ext.Container,alias:"widget.VitalSignsMonitorInput",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"panel",flex:1,itemId:"VSMI_Main",layout:{type:"fit"},items:[{xtype:"list",itemId:"VSMI_MonitorItemList",ui:"round",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無Monitor資料.</div>',itemTpl:Ext.create("Ext.XTemplate",'<tpl if="Name == &quot;Hourly Total&quot;||Name == &quot;Grand Total&quot;||Name == &quot;Intake&quot;||Name == &quot;Output&quot;||Name == &quot;Balance&quot;"> ',"    ",'    <div style="color:{[this.DivColor(values.TypeMajorName, values.Name)]};" >','        {[this.SubStr(values.Name, 0, 80)]}     /    <span style="color:blue;">【 {[this.LastInfo(values)]}】 </span> ',"     </div>","</tpl>","",'<tpl if="Name != &quot;Hourly Total&quot;&&Name != &quot;Grand Total&quot;&&Name != &quot;Intake&quot;&&Name != &quot;Output&quot;&&Name != &quot;Balance&quot;"> ','    <div style="color:{[this.DivColor(values.TypeMajorName, values.Name)]};" > {[this.SubStr(values.Name, 0, 80)]}    ','        <img src="../_/img/teach3.png" style="height:35px;width:35px;"/>    ','        <span style="color:blue;">【 {[this.LastInfo(values)]} 】</span> ',"      </div>","</tpl>","",{DivColor:function(b,a){switch(b){case"Intake":result="#6495ED";break;case"IntakeIV":result="red";break;case"Monitor":result="#800080";break;case"Output":result="gray";break;default:if(a=="Intake"||a=="Output"||a=="Balance"){result="#800080"}break}if(a!="Hourly Total"&&a!="Grand Total"){result="black"}return result},SubStr:function(b,d,a){return b.substr(d,a)},LastInfo:function(e){var b=e.infos;var d="";for(var a=0;a<b.length;a++){if(null!=b[a].StringValue&&""!=b[a].StringValue){d=b[a].StringValue+'  <span style="color:red;font-size:small;">'+b[a].HH+":"+b[a].MI+" </span> "}}b=null;delete b;return d}}),grouped:true}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"segmentedbutton",width:"50%",items:[{xtype:"button",flex:1,pressed:true,itemId:"ListAllBtn",ui:"confirm-round",text:"All"},{xtype:"button",flex:1,itemId:"ListMonitorBtn",text:"Monitor"},{xtype:"button",flex:1,itemId:"ListIntakeBtn",text:"Intake"},{xtype:"button",flex:1,itemId:"ListOutputBtn",text:"Output"}]},{xtype:"button",itemId:"VSMI_RefreshBtn",right:"1px",ui:"decline",width:"120px",iconCls:"refresh",text:"重新整理"},{xtype:"button",hidden:true,itemId:"VSMI_DefaultMonitorBtn",right:"125px",ui:"confirm",width:"120px",text:"新增預設監測"}]}],listeners:[{fn:"onVSMI_MonitorItemListItemTap",event:"itemtap",delegate:"#VSMI_MonitorItemList"},{fn:"onListAllBtnTap",event:"tap",delegate:"#ListAllBtn"},{fn:"onListMonitorBtnTap",event:"tap",delegate:"#ListMonitorBtn"},{fn:"onListIntakeBtnTap",event:"tap",delegate:"#ListIntakeBtn"},{fn:"onListOutputBtnTap",event:"tap",delegate:"#ListOutputBtn"},{fn:"onVSMI_RefreshBtnTap",event:"tap",delegate:"#VSMI_RefreshBtn"},{fn:"onVSMI_DefaultMonitorBtnTap",event:"tap",delegate:"#VSMI_DefaultMonitorBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onVSMI_MonitorItemListItemTap:function(a,d,f,b,g,h){if(Ext.isEmpty(this.getRecord())||b.data.IsClcItem){return false}var j=this;var k=function(e){if(!Ext.isEmpty(Ext.getStore("sVSMITprDailyData"))){Ext.getStore("sVSMITprDailyData").load()}};var l=this.getRecord();if(!Ext.isEmpty(Ext.getCmp("_inpVSMonitorCreatePanel"))){Ext.getCmp("_inpVSMonitorCreatePanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpVSMonitorCreatePanel"))){var m=Ext.create("NisTRApp.view.VitalSigns.MonitorCreatePanel",{id:"_inpVSMonitorCreatePanel",record:l,successFn:k,monitorItem:b,caller:j});j.overlay=Ext.Viewport.add(m);m=null;delete m}j.overlay.show();k=null;delete k;j=null;delete j;return},onListAllBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");Ext.getStore("sVSMITprDailyData").clearFilter()},onListMonitorBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");Ext.getStore("sVSMITprDailyData").filter("TypeMajorName","Monitor")},onListIntakeBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");Ext.getStore("sVSMITprDailyData").filter("TypeMajorName","Intake")},onListOutputBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");Ext.getStore("sVSMITprDailyData").filter("TypeMajorName","Output")},onVSMI_RefreshBtnTap:function(b,d,a){this.LoadMonitorItem()},onVSMI_DefaultMonitorBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())){return false}var f=this.getRecord();this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/MonitorInsertDefault.ashx",scope:this,method:"POST",params:{ChartNo:f.data.ChartNo,InpNo:f.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(e){this.setMasked(false);var g=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){this.LoadMonitorItem()}g=null;delete g},failure:function(){this.setMasked(false);Ext.Msg.alert("存檔失敗")}});f=null;delete f},onContainerDestroy:function(a){if(Ext.getStore("sVSMITprDailyData")!=null){Ext.getStore("sVSMITprDailyData").removeAll();Ext.getStore("sVSMITprDailyData").destroy()}console.log("On Destroy:","MonitorInput");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadMonitorItem()}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("INP_MonitorInput 住院資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sVSMITprDailyData"))){Ext.create("Ext.data.Store",{storeId:"sVSMITprDailyData",clearOnPageLoad:false,model:"NisTRApp.model.VitalSigns.TprDailyData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/DailyMonitor.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){var a=b.get("TprMajor")+"‧"+b.get("TypeMajorName");switch(b.get("TypeMajorName")){case"Monitor":a="<span style='color:#EFEFEF;'>1‧</span>"+b.get("TypeMajorName");break;case"IntakeIV":a="<span style='color:#EFEFEF;'>3‧</span>"+b.get("TypeMajorName");break;case"Intake":a="<span style='color:#EFEFEF;'>4‧</span>"+b.get("TypeMajorName");break;case"Output":a="<span style='color:#EFEFEF;'>5‧</span>"+b.get("TypeMajorName");break;default:if(b.get("Name")=="Intake"||b.get("Name")=="Output"||b.get("Name")=="Balance"){var a="<span style='color:#EFEFEF;'>2‧Total I/O</span>"}break}return a}},sorters:{sorterFn:function(d,b){var a=-1;a=(d.data.TprMajor>b.data.TprMajor)?1:(d.data.TprMajor==b.data.dataTprMajor?0:-1);if(d.data.TprMajor==b.data.TprMajor){a=0}if(d.data.TprMajor>b.data.TprMajor){a=1}if(d.data.TprMajor<b.data.TprMajor){a=-1}if(a==0){if(((d.data.Name=="Output")||(d.data.Name=="Intake")||(d.data.Name=="Balance"))&&((b.data.Name=="Output")||(b.data.Name=="Intake")||(b.data.Name=="Balance"))){a=b.data.GrpSeq.localeCompare(d.data.GrpSeq)}else{a=d.data.GrpSeq.localeCompare(b.data.GrpSeq)}}if(a==0){a=(d.data.TprSeq>b.data.TprSeq)?1:(d.data.TprSeq==b.data.TprSeq?0:-1)}return a}}})}this.down("#VSMI_MonitorItemList").setStore(Ext.getStore("sVSMITprDailyData"))},LoadMonitorItem:function(){if(Ext.isEmpty(this.getRecord())){return}if(Ext.getStore("sVSMITprDailyData").isLoading()){return}var d=this.getRecord();var b=Ext.getStore("sVSMITprDailyData");b.removeAll();var a=new Date();if(a.getHours()>=0&&a.getHours()<=6){a=Ext.Date.add(a,Ext.Date.DAY,-1)}b.getProxy().setExtraParams({ChartNo:d.data.ChartNo,InpNo:d.data.InpNo,BegDate:a,EndDate:a});b.load({callback:function(f,e,g){if(Ext.isEmpty(f)||f.length<=0){this.down("#VSMI_DefaultMonitorBtn").setHidden(false)}else{this.down("#VSMI_DefaultMonitorBtn").setHidden(true)}},scope:this});b=null;delete b;a=null;delete a;d=null;delete d}});Ext.define("NisTRApp.view.VitalSigns.MonitorListSetting",{extend:Ext.Container,alias:"widget.VitalSignsMonitorListSetting",statics:{LoadCreMonitorList:function(b){if(Ext.isEmpty(b)){return}if(Ext.isEmpty(Ext.getStore("sVsNewItemMonitors"))||Ext.getStore("sVsNewItemMonitors").isLoading()){return}var a=Ext.getStore("sVsNewItemMonitors");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNo});a.load();a=null;delete a;b=null;delete b},LoadExistMonitorList:function(b){if(Ext.isEmpty(b)){return}if(Ext.isEmpty(Ext.getStore("sVsExistingMonitors"))||Ext.getStore("sVsExistingMonitors").isLoading()){return}var a=Ext.getStore("sVsExistingMonitors");a.removeAll();a.getProxy().setExtraParams({InpNo:b.data.InpNo});a.load();a=null;delete a;b=null;delete b}},config:{height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"panel",initialFlag:true,flex:1,itemId:"VSMLS_CreMonitorPanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"VSMLS_CreMonitorList",disableSelection:true,itemTpl:["<div>",'<span style="color:black;"> {TprName}</span>',"</div>"],grouped:true}],listeners:[{fn:function(b,a){if(this.initialFlag){this.initialFlag=false;NisTRApp.view.VitalSigns.MonitorListSetting.LoadCreMonitorList(this.getRecord())}},event:"painted"}]},{xtype:"panel",initialFlag:true,flex:1,itemId:"VSMLS_DelMonitorPanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"VSMLS_DelMonitorList",disableSelection:true,itemTpl:["","<div>",'<span style="color:black;"> {TprName} </span>','    <img src="../_/img/Trash-can-icon.png" alt="Smiley face" style="height:30px;width:30px;float:right;" class="deleteitem" id="{MonitorID}"/>',"</div>"]}],listeners:[{fn:function(b,a){if(this.initialFlag){this.initialFlag=false;NisTRApp.view.VitalSigns.MonitorListSetting.LoadExistMonitorList(this.getRecord())}},event:"painted"}]},{xtype:"toolbar",docked:"bottom",layout:{align:"center",pack:"center",type:"hbox"},items:[{xtype:"segmentedbutton",width:"60%",items:[{xtype:"button",flex:1,itemId:"VSMLS_CreMonitorBtn",ui:"confirm",text:"新 增 Monitor"},{xtype:"button",flex:1,itemId:"VSMLS_DelMonitorBtn",text:"刪 除 Monitor"}]},{xtype:"button",itemId:"VSMLS_RefreshBtn",right:"1px",ui:"decline",width:"15%",iconCls:"refresh",text:"重新整理"}]}],listeners:[{fn:"onVSMLS_CreMonitorListItemTap",event:"itemtap",delegate:"#VSMLS_CreMonitorList"},{fn:"onVSMLS_CreMonitorPanelShow",event:"show",delegate:"#VSMLS_CreMonitorPanel"},{fn:"onVSMLS_DelMonitorListItemTap",event:"itemtap",delegate:"#VSMLS_DelMonitorList"},{fn:"onVSMLS_DelMonitorPanelShow",event:"show",delegate:"#VSMLS_DelMonitorPanel"},{fn:"onVSMLS_CreMonitorBtnTap",event:"tap",delegate:"#VSMLS_CreMonitorBtn"},{fn:"onVSMLS_DelMonitorBtnTap",event:"tap",delegate:"#VSMLS_DelMonitorBtn"},{fn:"onVSMLS_RefreshBtnTap",event:"tap",delegate:"#VSMLS_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"}]},onVSMLS_CreMonitorListItemTap:function(a,d,f,b,g,h){if(Ext.isEmpty(this.getRecord())){return false}var j=this;var k=function(e){if(!Ext.isEmpty(Ext.getStore("sVsExistingMonitors"))){Ext.getStore("sVsExistingMonitors").load()}};var l=this.getRecord();if(!Ext.isEmpty(Ext.getCmp("_inpVSMonitorItemCreate"))){Ext.getCmp("_inpVSMonitorItemCreate").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpVSMonitorItemCreate"))){var m=Ext.create("NisTRApp.view.VitalSigns.MonitorItemCreate",{id:"_inpVSMonitorItemCreate",record:l,successFn:k,monitorItem:b,caller:j});j.overlay=Ext.Viewport.add(m);m=null;delete m}j.overlay.show();k=null;delete k;j=null;delete j;return},onVSMLS_CreMonitorPanelShow:function(a,b){this.down("#VSMLS_DelMonitorPanel").setHidden(true)},onVSMLS_DelMonitorListItemTap:function(b,d,j,a,h,f){var g=this;var k=this.getRecord();if(h.event.target.nodeName=="IMG"){Ext.Msg.confirm("Confirm","是否停用此項目:"+a.data.TprName,function(l,m,e){if(l=="no"){return}else{if(l=="yes"){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/MonitorItemDelete.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{InpNo:k.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),OrddRid:a.data.OrddRid,MonitorID:a.data.MonitorID},success:function(n){this.setMasked(false);var o=Ext.decode(n.responseText);NisTRApp.view.Misc.Alert(o.Message,(o.Success?800:0));if(o.Success){if(!Ext.isEmpty(Ext.getStore("sVsExistingMonitors"))){Ext.getStore("sVsExistingMonitors").load()}}o=null;delete o;k=null;delete k},failure:function(){this.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);k=null;delete k}})}}},this);h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}g=null;delete g},onVSMLS_DelMonitorPanelShow:function(a,b){this.down("#VSMLS_CreMonitorPanel").setHidden(true)},onVSMLS_CreMonitorBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");this.down("#VSMLS_CreMonitorPanel").setHidden(false)},onVSMLS_DelMonitorBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm","normal","","");this.down("#VSMLS_DelMonitorPanel").setHidden(false)},onVSMLS_RefreshBtnTap:function(b,d,a){NisTRApp.view.VitalSigns.MonitorListSetting.LoadCreMonitorList(this.getRecord());NisTRApp.view.VitalSigns.MonitorListSetting.LoadExistMonitorList(this.getRecord())},onContainerDestroy:function(a){if(Ext.getStore("sVsNewItemMonitors")!=null){Ext.getStore("sVsNewItemMonitors").removeAll();Ext.getStore("sVsNewItemMonitors").destroy()}if(Ext.getStore("sVsExistingMonitors")!=null){Ext.getStore("sVsExistingMonitors").removeAll();Ext.getStore("sVsExistingMonitors").destroy()}console.log("On Destroy:","MonitorListSetting");this.removeAll(true,true)},initialize:function(){this.callParent();this.down("#VSMLS_CreMonitorPanel").setHidden(false);if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("INP_MonitorListSetting 住院資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sVsNewItemMonitors"))){Ext.create("Ext.data.Store",{storeId:"sVsNewItemMonitors",clearOnPageLoad:false,model:"NisTRApp.model.VitalSigns.OptionTprItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/MonitorAddList.ashx",reader:{type:"json"}},grouper:{groupFn:function(a){return a.get("TprMajorStr")}},filters:{filterFn:function(a){return["In","IV","Mon","Out"].some(function(b){return b==a.get("TprMajorName1")})}}})}this.down("#VSMLS_CreMonitorPanel").setRecord(this.getRecord());this.down("#VSMLS_CreMonitorPanel").initialFlag=true;this.down("#VSMLS_CreMonitorList").setStore(Ext.getStore("sVsNewItemMonitors"));if(Ext.isEmpty(Ext.getStore("sVsExistingMonitors"))){Ext.create("Ext.data.Store",{storeId:"sVsExistingMonitors",clearOnPageLoad:false,model:"NisTRApp.model.Ipo.IpomonitorEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/MonitorList.ashx",reader:{type:"json"}},grouper:{groupFn:function(a){return a.get("TprMajorStr")}}})}this.down("#VSMLS_DelMonitorPanel").setRecord(this.getRecord());this.down("#VSMLS_DelMonitorPanel").initialFlag=true;this.down("#VSMLS_DelMonitorList").setStore(Ext.getStore("sVsExistingMonitors"))}});Ext.define("NisTRApp.view.VitalSigns.MonitorItemCreate",{extend:Ext.Panel,config:{centered:true,height:540,width:600,layout:{type:"vbox"},modal:true,monitorItem:{},caller:{},successFn:{},items:[{xtype:"toolbar",docked:"top",itemId:"VSMIC_HeadBar",title:"Title"},{xtype:"panel",flex:1.2,layout:{type:"vbox"},items:[{xtype:"textareafield",flex:2,itemId:"VSMIC_SelfName",margin:"5 5 5 5",label:"名稱",labelWidth:"20%",placeHolder:"請輸入"},{xtype:"textfield",flex:1,hidden:false,itemId:"VSMIC_SelfClass",margin:"5 5 5 5",padding:"",label:"自定分類",labelWidth:"20%",placeHolder:"請輸入或點選下方清單"}]},{xtype:"panel",flex:0.1,html:'<div  class="globalList" ><table  style="width:100%"><thead><th ></th></thead></div>',itemId:"VSMIC_Spacer",style:"background-color:Black; color:lightblue;",ui:"dark",hideOnMaskTap:false,modal:false},{xtype:"panel",flex:2.3,hidden:false,itemId:"VSMIC_DrainOptionPanel",hideOnMaskTap:false,layout:{type:"hbox"},items:[{xtype:"list",flex:1,itemId:"MonitorItemListA",itemTpl:["<div>",'<span style="color:black;"> {ParValue}&nbsp;&nbsp;</span>          ',"</div>"]},{xtype:"list",flex:1,itemId:"MonitorItemListB",itemTpl:["<div>",'<span style="color:black;"> {ParValue}&nbsp;&nbsp;</span>          ',"</div>"]},{xtype:"list",flex:1,itemId:"MonitorItemListC",itemTpl:["<div>",'<span style="color:black;"> {ParValue}&nbsp;&nbsp;</span>          ',"</div>"]}]},{xtype:"toolbar",docked:"bottom",itemId:"VSMIC_FootBar",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"VSMIC_SaveBtn",ui:"decline",width:"47%",text:"資 料 儲 存"},{xtype:"button",itemId:"VSMIC_CancleBtn",ui:"confirm",width:"47%",text:"取 消"}]}],listeners:[{fn:"onMonitorItemListAItemTap",event:"itemtap",delegate:"#MonitorItemListA"},{fn:"onMonitorItemListBItemTap",event:"itemtap",delegate:"#MonitorItemListB"},{fn:"onMonitorItemListCItemTap",event:"itemtap",delegate:"#MonitorItemListC"},{fn:"onVSMIC_SaveBtnTap",event:"tap",delegate:"#VSMIC_SaveBtn"},{fn:"onVSMIC_CancleBtnTap",event:"tap",delegate:"#VSMIC_CancleBtn"},{fn:"onPanelDestroy",event:"destroy"}]},onMonitorItemListAItemTap:function(b,f,j,a,h,g){var d=this.down("#VSMIC_SelfClass");if(!Ext.isEmpty(d)){var k=d.getValue();d.setValue(k+" "+a.data.ParValue);k=null;delete k}d=null;delete d},onMonitorItemListBItemTap:function(b,f,j,a,h,g){var d=this.down("#VSMIC_SelfClass");if(!Ext.isEmpty(d)){var k=d.getValue();d.setValue(k+" "+a.data.ParValue);k=null;delete k}d=null;delete d},onMonitorItemListCItemTap:function(b,f,j,a,h,g){var d=this.down("#VSMIC_SelfClass");if(!Ext.isEmpty(d)){var k=d.getValue();d.setValue(k+" "+a.data.ParValue);k=null;delete k}d=null;delete d},onVSMIC_SaveBtnTap:function(b,d,a){this.SaveMonitorItem()},onVSMIC_CancleBtnTap:function(b,d,a){this.destroy()},onPanelDestroy:function(a){if(Ext.getStore("sMonitorItemAll")!=null){Ext.getStore("sMonitorItemAll").removeAll();Ext.getStore("sMonitorItemAll").destroy()}console.log("On Destroy:","MonitorItemCreate");this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getMonitorItem())||Ext.isEmpty(this.getMonitorItem().data.TprName)){Ext.Msg.alert("MonitorCreatePanel 住院資料錯誤");return false}var a=this.getMonitorItem().data;this.setHeight((a.TprName=="Drain"?540:270));this.down("#VSMIC_DrainOptionPanel").setHidden(!(a.TprName=="Drain"));this.down("#VSMIC_SelfName").setValue(a.TprName);this.down("#VSMIC_SelfName").setReadOnly((a.TprMajor!="IV"));this.down("#VSMIC_SelfClass").setHidden(!(a.TprName=="Drain"));this.down("#VSMIC_HeadBar").setTitle(a.TprName);this.down("#VSMIC_Spacer").setHidden(!(a.TprName=="Drain"));(a.TprName=="Drain")?this.InitialDrainOptionPanel():""},InitialDrainOptionPanel:function(){if(Ext.isEmpty(Ext.getStore("sMonitorItemAll"))){Ext.create("Ext.data.Store",{storeId:"sMonitorItemAll",clearOnPageLoad:false,model:"NisTRApp.model.Sys.SysparamEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/MonitorListSetting.ashx",reader:{type:"json"}},sorters:{property:"SeqNO"}})}this.down("#VSMIC_DrainOptionPanel").setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.getStore("sMonitorItemAll").load({callback:function(d,b,h){this.down("#VSMIC_DrainOptionPanel").setMasked(false);if(!Ext.isEmpty(d)&&!Ext.isEmpty(d[0])&&!Ext.isEmpty(d[0].data)){var g=[];var f=[];var e=[];d.forEach(function a(k,j,l){if(k.raw.ParDesc=="A"){g.push(k.raw)}if(k.raw.ParDesc=="B"){f.push(k.raw)}if(k.raw.ParDesc=="C"){e.push(k.raw)}});this.down("#MonitorItemListA").setData(g);this.down("#MonitorItemListB").setData(f);this.down("#MonitorItemListC").setData(e);g=null;delete g;f=null;delete f;e=null;delete e}},scope:this})},SaveMonitorItem:function(){if(Ext.isEmpty(this.getMonitorItem())||Ext.isEmpty(this.getRecord())){return false}if(Ext.isEmpty(this.down("#VSMIC_SelfName").getValue())){NisTRApp.view.Misc.Alert("請輸入名稱",0);return false}var e=this.getRecord();var d=this.getMonitorItem();var a=this.down("#VSMIC_SelfName").getValue();var b=(d.data.TprName=="Drain"?this.down("#VSMIC_SelfClass").getValue():"");this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.SAVE});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/MonitorItemInsert.ashx",scope:this,method:"POST",params:{ChartNo:e.data.ChartNo,InpNo:e.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),TprType:d.data.TprType,TprCode:d.data.TprCode,OrddRid:d.data.OrddRid,SelfCodeStr:b,ReNameStr:a,TprMajor:d.data.TprMajor,TprSeq:d.data.TprSeq},success:function(f){this.setMasked(false);var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success&&!Ext.isEmpty(this.getSuccessFn())&&Ext.isFunction(this.getSuccessFn())){this.getSuccessFn()(this.getCaller());this.destroy()}g=null;delete g},failure:function(){this.setMasked(false);Ext.Msg.alert("存檔失敗")}});e=null;delete e;d=null;delete d;a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.WorkList.EMR",{extend:Ext.Container,alias:"widget.WL_EMR",statics:{LoadInpUnsignedFormPatList:function(b){if(Ext.getStore("sInpUnsignedFormPatList").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sInpUnsignedFormPatList");a.removeAll();a.getProxy().setExtraParams({UserID:b});if(!Ext.isEmpty(Ext.getStore("sInpUnsignedFormDataList"))){Ext.getStore("sInpUnsignedFormDataList").removeAll()}a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b},LoadInpUnsignedFormDataList:function(a,b){if(Ext.getStore("sInpUnsignedFormDataList").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sInpUnsignedFormDataList");d.removeAll();d.getProxy().setExtraParams({UserID:a,InpNo:b});d.load({callback:function(f,e,g){},scope:this});d=null;delete d;a=null;delete a;b=null;delete b},LoadOpdUnsignedFormPatList:function(b){if(Ext.getStore("sOpdUnsignedFormPatList").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sOpdUnsignedFormPatList");a.removeAll();a.getProxy().setExtraParams({UserID:b});if(!Ext.isEmpty(Ext.getStore("sOpdUnsignedFormDataList"))){Ext.getStore("sOpdUnsignedFormDataList").removeAll()}a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b},LoadOpdUnsignedFormDataList:function(a,b){if(Ext.getStore("sOpdUnsignedFormDataList").isLoading()||Ext.isEmpty(a)){return}var d=Ext.getStore("sOpdUnsignedFormDataList");d.removeAll();d.getProxy().setExtraParams({UserID:a,ChartNo:b});d.load({callback:function(f,e,g){},scope:this});d=null;delete d;a=null;delete a;b=null;delete b},LoadInpUnsignedExeRecPatList:function(b){if(Ext.getStore("sInpUnsignedExeRecPatList").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sInpUnsignedExeRecPatList");a.removeAll();a.getProxy().setExtraParams({UserID:b});if(!Ext.isEmpty(Ext.getStore("sInpUnsignedExeRecDataList"))){Ext.getStore("sInpUnsignedExeRecDataList").removeAll()}a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b},LoadInpUnsignedExeRecDataList:function(b,d){if(Ext.getStore("sInpUnsignedExeRecDataList").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sInpUnsignedExeRecDataList");a.removeAll();a.getProxy().setExtraParams({UserID:b,InpNo:d});a.load({callback:function(f,e,g){},scope:this});a=null;delete a;b=null;delete b;d=null;delete d},LoadInpUnFinialPrepareDataList:function(b){if(Ext.getStore("sInpUnFinailPrepareDataList").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sInpUnFinailPrepareDataList");a.removeAll();a.getProxy().setExtraParams({UserID:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b},SignInpFormData:function(d,b,a,e){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"EMR/INP/SignForm.ashx",scope:b,method:"POST",params:{UserID:d,InpNo:(Ext.isEmpty(e)?"":e)},success:function(f){var g=Ext.decode(f.responseText);if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(g.Success,g.Message,b)}g=null;delete g},failure:function(){if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(false,"",b)}return false}},b)},SignInpExeRecData:function(d,b,a,e){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"EMR/INP/SingExcutionRecordByUser.ashx",scope:b,method:"POST",params:{UserID:d,InpNo:(Ext.isEmpty(e)?"":e)},success:function(f){var g=Ext.decode(f.responseText);if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(g.Success,g.Message,b)}g=null;delete g},failure:function(){if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(false,"",b)}return false}},b)},SignOpdFormData:function(d,b,a,e){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"EMR/SignForm.ashx",scope:b,method:"POST",params:{UserID:d,ChartNo:(Ext.isEmpty(e)?"":e)},success:function(f){var g=Ext.decode(f.responseText);if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(g.Success,g.Message,b)}g=null;delete g},failure:function(){if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(false,"",b)}return false}},b)},DeleteOpdFormData:function(e,d,b,a){if(Ext.isEmpty(e)||Ext.isEmpty(d)){return}Ext.Msg.confirm("Confirm","是否刪除該筆記錄?",function(g,h,f){if(g=="no"){return}else{if(g=="yes"){b.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"EMR/DeleteUnsignedFormRecord.ashx",useDefaultXhrHeader:false,method:"POST",scope:b,params:{MasterID:d,UserID:e},success:function(j){b.setMasked(false);var k=Ext.decode(j.responseText);if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(k.Success,k.Message,b)}k=null;delete k},failure:function(){b.setMasked(false);if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(false,"",b)}return false}})}}},b)}},config:{layout:{type:"vbox"},items:[{xtype:"tabpanel",flex:1,itemId:"WL_EMR_TabPanel",layout:{animation:false,type:"card"},items:[{xtype:"container",title:"住院護理記錄",itemId:"WLEMR_INP_FORM",layout:{type:"hbox"},items:[{xtype:"panel",itemId:"WLEMR_INP_FORM_PAT_PANEL",width:"20%",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_INP_FORM_PAT_LIST",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待確認名單.</div>',itemTpl:["<div>{PatName} </div>",'<div style="font-size:small;"> <span style="color:blue;"> 筆數:</span> <span style="color:red;">{Cnt}</span></div>']}]},{xtype:"panel",itemId:"WLEMR_INP_FORM_DATA_PANEL",width:"80%",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_INP_FORM_DATA_LIST",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待確認資料.</div>',itemTpl:["","","<div > ",'<span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span> ',"     ","</div>","<br>"," ",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[NisTRApp.view.FormUtil.MedicalDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>',"    <br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre>{Html} </pre></span>',"","<div>",""],grouped:true}]}],listeners:[{fn:function(b,a){NisTRApp.view.WorkList.EMR.LoadInpUnsignedFormPatList(NisTRApp.view.SysUtility.GetUserID())},event:"painted"}]},{xtype:"container",title:"門診護理記錄",itemId:"WLEMR_OPD_FORM",layout:{type:"hbox"},items:[{xtype:"panel",itemId:"WLEMR_OPD_FORM_PAT_PANEL",width:"20%",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_OPD_FORM_PAT_LIST",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待確認名單.</div>',itemTpl:["<div>{PatName} </div>",'<div style="font-size:small;"> <span style="color:blue;"> 筆數:</span> <span style="color:red;">{Cnt}</span>',"</div>","",""]}]},{xtype:"panel",itemId:"WLEMR_OPD_FORM_DATA_PANEL",width:"80%",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_OPD_FORM_DATA_LIST",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待確認資料.</div>',itemTpl:["  ","       ","<table >","	<tr>",'	<td align="" width="90px">','        <img id="OPD_FORM_DELETE_{MasterID}" name="img" src="../_/img/delete.jpg" style="width:40px;height:40px;">',"","    </td>         ",'	<td align="left" width="540px">',"        <div > ",'        <span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span> ',"             ","        </div>","        <br>","        ",'        <div style="font-size:small;"> ','        <span style="color:black;">執行時間: </span> <span style="color:red;">{[NisTRApp.view.FormUtil.MedicalDateFormat(values.MedicalDate)]}</span>','        <span style="color:black;">  {UserName}</span>',"            <br>    ","        <br>    ",'        <span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;">{Html}</span>',"        ","        </div>","    ","    ","	</td>","","	</tr>","      ","</table>"],grouped:true}]}],listeners:[{fn:function(b,a){NisTRApp.view.WorkList.EMR.LoadOpdUnsignedFormPatList(NisTRApp.view.SysUtility.GetUserID())},event:"painted"}]},{xtype:"container",title:"醫囑執行記錄",itemId:"WLEMR_INP_EXEREC",layout:{type:"hbox"},items:[{xtype:"panel",itemId:"WLEMR_INP_EXEREC_PAT_PANEL",width:"20%",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_INP_EXEREC_PAT_LIST",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待確認名單.</div>',itemTpl:["<div>{PatName} </div>",'<div style="font-size:small;"> <span style="color:blue;"> 筆數:</span> <span style="color:red;">{Cnt}</span></div>']}]},{xtype:"panel",itemId:"WLEMR_INP_EXEREC_DATA_PANEL",width:"80%",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_INP_EXEREC_DATA_LIST",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無待確認資料.</div>',itemTpl:["<div > ",'<span class="posted" style="color:black;"> 名稱 : {PAR_VALUE}&nbsp;</span> ',"     ","</div>",'<div style="font-size:small;"> ','<span style="color: black;">醫囑: </span>  <span style="color:blue;">{ORDD_TXT} </span>',"<br>",'<span style="color:black;">醫囑執行時間: </span> <span style="color:red;">{DATE_TIME}</span>',"<br>",'<span style="color:black;">狀態： </span> <span style="color:green;">{STATUS}</span>      ',"<br>","",'<span style="color:black;">開單醫師: </span> <span style="color:red;">{USER_ID}  {USER_NAME}</span>     ',"<br>",'<span style="color:black;">附註時間: </span> <span style="color:green;">{ContentDateTime} </span>     ',"<br>",'<span style="color:black;">附註內容: </span> <span style="color:blue;">{ContentStr} </span>  ',"<div>",""],grouped:true}]}],listeners:[{fn:function(b,a){NisTRApp.view.WorkList.EMR.LoadInpUnsignedExeRecPatList(NisTRApp.view.SysUtility.GetUserID())},event:"painted"}]},{xtype:"container",title:"準備單未確認",itemId:"WL_EMR_Prepare",layout:{type:"fit"},items:[{xtype:"list",itemId:"WLEMR_INP_PREPARE_DATA_LIST",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無未確認資料.</div>',itemTpl:Ext.create("Ext.XTemplate","   ","<table >","	<tr>",'	<td align="left" width="10%">','        <img id="PREPARE_CONNECT_{InpNo}" name="img" src="../_/img/modify.png" style="width:40px;height:40px;">',"    </td>         ",'	<td align="left" width="90%">',"        <div > ",'        <span class="posted" style="color:black;"> 標題 : {Record}&nbsp;</span> ',"        </div>","        <br>","         ",'        <div style="font-size:medium;"> ',"         ",'        <span style="color:black;">病歷號: </span> <span style="color:blue;">{ChartNo}</span>',"        <br> <br>  ",'        <span style="color:black;">病人姓名: </span> <span style="color:blue;">{PatName}</span>',"        <br> <br>    ",'         <span style="color:black;">排程日期: </span> <span style="color:red;">{PrepareDate}</span>',"        <br><br>     ",'        <span style="color: black;">狀態: &nbsp;&nbsp;</span>  <span style="color:blue;">{[this.status(values.OutDate)]}</span>',"        ","        </div>","    ","    ","	</td>","","	</tr>","      ","</table>",{status:function(a){if(null==a||""==a){return"住院中"}else{return"出院 ("+a+")"}}})}]}],tabBar:{docked:"top"}},{xtype:"toolbar",docked:"bottom",itemId:"WL_EMR_FootBar",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"WL_EMR_ConfirmBtn",ui:"confirm",width:"50%",text:"確 認"}]}],listeners:[{fn:"onWLEMR_INP_FORM_PAT_LISTItemTap",event:"itemtap",delegate:"#WLEMR_INP_FORM_PAT_LIST"},{fn:"onWLEMR_OPD_FORM_PAT_LISTItemTap",event:"itemtap",delegate:"#WLEMR_OPD_FORM_PAT_LIST"},{fn:"onWLEMR_OPD_FORM_DATA_LISTItemTap",event:"itemtap",delegate:"#WLEMR_OPD_FORM_DATA_LIST"},{fn:"onWLEMR_INP_EXEREC_PAT_LISTItemTap",event:"itemtap",delegate:"#WLEMR_INP_EXEREC_PAT_LIST"},{fn:"onWLEMR_INP_PREPARE_DATA_LISTItemTap",event:"itemtap",delegate:"#WLEMR_INP_PREPARE_DATA_LIST"},{fn:"onWL_EMR_PrepareActivate",event:"activate",delegate:"#WL_EMR_Prepare"},{fn:"onWL_EMR_ConfirmBtnTap",event:"tap",delegate:"#WL_EMR_ConfirmBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerActivate",event:"activate"}]},onWLEMR_INP_FORM_PAT_LISTItemTap:function(b,d,h,a,g,f){NisTRApp.view.WorkList.EMR.LoadInpUnsignedFormDataList(NisTRApp.view.SysUtility.GetUserID(),a.data.InpNo)},onWLEMR_OPD_FORM_PAT_LISTItemTap:function(b,d,h,a,g,f){NisTRApp.view.WorkList.EMR.LoadOpdUnsignedFormDataList(NisTRApp.view.SysUtility.GetUserID(),a.data.ChartNo)},onWLEMR_OPD_FORM_DATA_LISTItemTap:function(b,d,j,a,h,f){var g=function g(l,k,e){NisTRApp.view.Misc.Alert((l?"刪除成功":"刪除失敗"));if(l){NisTRApp.view.WorkList.EMR.LoadOpdUnsignedFormPatList(NisTRApp.view.SysUtility.GetUserID())}};if(h.event.target.nodeName=="IMG"){NisTRApp.view.WorkList.EMR.DeleteOpdFormData(NisTRApp.view.SysUtility.GetUserID(),a.data.MasterID,this,g);h.preventDefault()}g=null;delete g},onWLEMR_INP_EXEREC_PAT_LISTItemTap:function(b,d,h,a,g,f){NisTRApp.view.WorkList.EMR.LoadInpUnsignedExeRecDataList(NisTRApp.view.SysUtility.GetUserID(),a.data.InpNo)},onWLEMR_INP_PREPARE_DATA_LISTItemTap:function(b,d,h,a,g,f){if(g.event.target.nodeName=="IMG"){NisTRApp.view.TRUtility.OpenMainUI(a,SYS_CONST.PageDef.NurPrepare,this);g.preventDefault()}},onWL_EMR_PrepareActivate:function(e,b,a,d){NisTRApp.view.WorkList.EMR.LoadInpUnFinialPrepareDataList(NisTRApp.view.SysUtility.GetUserID())},onWL_EMR_ConfirmBtnTap:function(f,h,d){a=function a(l,k,e){e.setMasked(false);console.log("3.WorkLisr EMR SIGN :","門診護理表單確認 :",(l?"成功":"失敗"));NisTRApp.view.Misc.Alert((l?"EMR確認成功":"EMR確認失敗"));e.down("#WL_EMR_TabPanel").setActiveItem(3)};j=function j(l,k,e){e.setMasked(false);console.log("2.WorkLisr EMR SIGN :","執行記錄確認 :",(l?"成功":"失敗"));if(!l){NisTRApp.view.Misc.Alert((l?"執行記錄確認成功":"執行記錄確認失敗"))}e.setMasked({xtype:"loadmask",message:"門診護理表單確認中...."});NisTRApp.view.WorkList.EMR.SignOpdFormData(NisTRApp.view.SysUtility.GetUserID(),e,a)};b=function b(l,k,e){e.setMasked(false);console.log("1.WorkLisr EMR SIGN :","住院護理表單確認 :",(l?"成功":"失敗"));if(!l){NisTRApp.view.Misc.Alert((l?"住院護理表單確認成功":"住院護理表單確認失敗"))}e.setMasked({xtype:"loadmask",message:"執行記錄確認中...."});NisTRApp.view.WorkList.EMR.SignInpExeRecData(NisTRApp.view.SysUtility.GetUserID(),e,j)};var g=this;Ext.Msg.confirm("Confirmation","執行EMR確認?",function(k,e){if(k==="yes"){g.setMasked({xtype:"loadmask",message:"住院護理表單確認中...."});NisTRApp.view.WorkList.EMR.SignInpFormData(NisTRApp.view.SysUtility.GetUserID(),g,b)}else{if(k==="no"){return}}})},onContainerDestroy:function(a){if(Ext.getStore("sInpUnsignedFormPatList")!=null){Ext.getStore("sInpUnsignedFormPatList").removeAll();Ext.getStore("sInpUnsignedFormPatList").destroy()}if(Ext.getStore("sInpUnsignedFormDataList")!=null){Ext.getStore("sInpUnsignedFormDataList").removeAll();Ext.getStore("sInpUnsignedFormDataList").destroy()}if(Ext.getStore("sOpdUnsignedFormPatList")!=null){Ext.getStore("sOpdUnsignedFormPatList").removeAll();Ext.getStore("sOpdUnsignedFormPatList").destroy()}if(Ext.getStore("sOpdUnsignedFormDataList")!=null){Ext.getStore("sOpdUnsignedFormDataList").removeAll();Ext.getStore("sOpdUnsignedFormDataList").destroy()}if(Ext.getStore("sInpUnsignedExeRecDataList")!=null){Ext.getStore("sInpUnsignedExeRecDataList").removeAll();Ext.getStore("sInpUnsignedExeRecDataList").destroy()}if(Ext.getStore("sInpUnsignedExeRecPatList")!=null){Ext.getStore("sInpUnsignedExeRecPatList").removeAll();Ext.getStore("sInpUnsignedExeRecPatList").destroy()}if(Ext.getStore("sInpUnFinailPrepareDataList")!=null){Ext.getStore("sInpUnFinailPrepareDataList").removeAll();Ext.getStore("sInpUnFinailPrepareDataList").destroy()}me=null;delete me;_signInpFormData=null;delete _signInpFormData;_signInpExeRecData=null;delete _signInpExeRecData;_signOpdFormData=null;delete _signOpdFormData;console.log("On Destroy :","WorkList.EMR");this.removeAll(true,true)},onContainerActivate:function(e,b,a,d){this.down("#WL_EMR_TabPanel").getTabBar().down('[title="準備單未確認"]').setBadgeText("");this.QueryPrepareUnFinalQty(NisTRApp.view.SysUtility.GetUserID(),this.down("#WL_EMR_TabPanel").getTabBar().down('[title="準備單未確認"]'))},initialize:function(){this.callParent();if(Ext.isEmpty(NisTRApp.view.SysUtility.GetUserInfo())||Ext.isEmpty(NisTRApp.view.SysUtility.GetUserInfo().data.UserID)){Ext.Msg.alert("使用者資料錯誤，請先登入系統");return false}if(Ext.getStore("sInpUnsignedFormDataList")==null){Ext.create("Ext.data.Store",{storeId:"sInpUnsignedFormDataList",clearOnPageLoad:false,model:"NisTRApp.model.EMR.UnsignForm",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/INP/UnsignedForm.ashx",reader:{type:"json"}},grouper:{groupFn:function(a){return a.data.InpNO+" "+a.data.PatName+" "+a.data.FunctionTypeName}},sorters:{direction:"DESC",property:"MedicalDate"}})}this.down("#WLEMR_INP_FORM_DATA_LIST").setStore(Ext.getStore("sInpUnsignedFormDataList"));if(Ext.getStore("sInpUnsignedFormPatList")==null){Ext.create("Ext.data.Store",{storeId:"sInpUnsignedFormPatList",clearOnPageLoad:false,model:"NisTRApp.model.Form.UnsignedFormPatData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/INP/UnsignedFormPatList.ashx",reader:{type:"json"}}})}this.down("#WLEMR_INP_FORM_PAT_LIST").setStore(Ext.getStore("sInpUnsignedFormPatList"));this.down("#WLEMR_INP_FORM").setRecord(NisTRApp.view.SysUtility.GetUserInfo());if(Ext.getStore("sOpdUnsignedFormDataList")==null){Ext.create("Ext.data.Store",{storeId:"sOpdUnsignedFormDataList",clearOnPageLoad:false,model:"NisTRApp.model.EMR.UnsignForm",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/OPD/UnsignedForm.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){try{return b.data.ChartNo+" 序:"+b.data.ChartSeq+" "+b.data.PatName+" "+b.data.FunctionTypeName}catch(a){return""}}},sorters:{direction:"DESC",property:"MedicalDate"}})}this.down("#WLEMR_OPD_FORM_DATA_LIST").setStore(Ext.getStore("sOpdUnsignedFormDataList"));if(Ext.getStore("sOpdUnsignedFormPatList")==null){Ext.create("Ext.data.Store",{storeId:"sOpdUnsignedFormPatList",clearOnPageLoad:false,model:"NisTRApp.model.Form.UnsignedFormPatData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/OPD/UnsignedFormPatList.ashx",reader:{type:"json"}}})}this.down("#WLEMR_OPD_FORM_PAT_LIST").setStore(Ext.getStore("sOpdUnsignedFormPatList"));this.down("#WLEMR_OPD_FORM").setRecord(NisTRApp.view.SysUtility.GetUserInfo());if(Ext.getStore("sInpUnsignedExeRecDataList")==null){Ext.create("Ext.data.Store",{storeId:"sInpUnsignedExeRecDataList",clearOnPageLoad:false,model:"NisTRApp.model.EMR.UnsignedExcutionRecord",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/INP/UnsignedExcutionRecord.ashx",reader:{type:"json"}},grouper:{groupFn:function(a){return a.data.CHART_NO+" "+a.data.PAT_NAME+" "+a.data.TYPE_NAME}}})}this.down("#WLEMR_INP_EXEREC_DATA_LIST").setStore(Ext.getStore("sInpUnsignedExeRecDataList"));if(Ext.getStore("sInpUnsignedExeRecPatList")==null){Ext.create("Ext.data.Store",{storeId:"sInpUnsignedExeRecPatList",clearOnPageLoad:false,model:"NisTRApp.model.Form.UnsignedFormPatData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/INP/UnsignedExcutionRecordPatList.ashx",reader:{type:"json"}}})}this.down("#WLEMR_INP_EXEREC_PAT_LIST").setStore(Ext.getStore("sInpUnsignedExeRecPatList"));this.down("#WLEMR_INP_EXEREC").setRecord(NisTRApp.view.SysUtility.GetUserInfo());if(Ext.getStore("sInpUnFinailPrepareDataList")==null){Ext.create("Ext.data.Store",{storeId:"sInpUnFinailPrepareDataList",clearOnPageLoad:false,model:"NisTRApp.model.EMR.UnFinailPrepareFrmData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"EMR/INP/UnFinialPrepareFrm.ashx",reader:{type:"json"}}})}this.down("#WLEMR_INP_PREPARE_DATA_LIST").setStore(Ext.getStore("sInpUnFinailPrepareDataList"))},QueryPrepareUnFinalQty:function(a,b){var d={url:SYS_CONST.ApiRoot+"EMR/INP/UnFinialPrepareQty.ashx",scope:this,method:"POST",params:{UserID:a},success:function(e){var f=Ext.decode(e.responseText);if(f.UnFinialQty>0){if(!Ext.isEmpty(b)){b.setBadgeText("未確認")}}},failure:function(){}};if(Ext.Ajax.isLoading(d)){console.log("QueryPrepareUnFinalQty is loading");d=null;delete d;return false}Ext.Ajax.request(d);d=null;delete d}});Ext.define("NisTRApp.view.Management.Druglog",{extend:Ext.Container,statics:{LoadDrugLog:function(e,d,b){if(Ext.getStore("sOrderDruglog").isLoading()||Ext.isEmpty(e)){return}var a=Ext.getStore("sOrderDruglog");a.removeAll();a.getProxy().setExtraParams({chartNo:e.data.ChartNo,inpNo:e.data.InpNo,type:"drug",sd:d,ed:b});a.load();a=null;delete a},RenderDrugLog:function(f,o,b){if(Ext.getStore("sOrderDruglog").isLoading()||Ext.isEmpty(o)||Ext.isEmpty(f.down("#MOD_DrugLogPanel"))){return}var j=Ext.getStore("sOrderDruglog");f.down("#MOD_DrugLogPanel").setHtml("");var n=false;var d=false;var g=false;if(j.getCount()>0){f.down("#MOD_DrugLogPanel").setHtml("");var h="";var e=$('<div id="_orderDruglog" class="globalList"></div><input type="hidden" id="_logType"/>');var a=$('<table id="_orderDruglogTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" ></table>');var l='<thead><th style="width:40px">開單日期</th><th style="width:40px">停用日期</th><th style="width:140px">醫囑</th><th colspan=5 style="width:160px">記錄</th></thead>';a.append(l);a.append("<tbody>");j.each(function(C,s,q){var y=C.raw;var I="";var G="";var F="";var E="";var D="";var z="";var B="";var H="";var p="";var r="";var w="";var A=0;var x="",u="";C.DrugLogDatas().each(function(J){var L=J.data;if(L.ContentAt==""){w='<span orddrid="'+L.OrddRid+'" procdate="'+L.ProcDate+'" proctime="'+L.ProcTime+'" class="exerecDrug" exerecord="'+L.Record.replace("\n","<br/>")+'">'+L.Record.replace("\n","<br/>").substr(0,20)+"<br/></span>"}else{w='<span orddrid="'+L.OrddRid+'" procdate="'+L.ProcDate+'" proctime="'+L.ProcTime+'" class="exerecDrug" style="font-weight: bolder; width:100%; height:100%" exerecord="'+L.Record.replace("\n","<br/>")+'">'+L.Record.replace("\n","<br/>").substr(0,20)+"<br/></span>"}var K=L.Record+"\n";if(A%5==0){I+=w;z+=K}if(A%5==1){G+=w;B+=K}if(A%5==2){F+=w;H+=K}if(A%5==3){E+=w;p+=K}if(A%5==4){D+=w;r+=K}A=A+1;L=null;delete L;K=null;delete K});if(y.OrddHtml.toString().length==0){u=y.OrddTxt;x=""}else{if(y.OrddHtml.indexOf("<BR>")&&y.OrddHtml.substring(y.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")>0){u=y.OrddHtml.substring(0,y.OrddHtml.indexOf("<BR>")+(y.OrddHtml.substring(y.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")+4))+"<img src='../_/img/find.png' style='width:16px;height:16px;'>";x="<pre style='font-weight:bold;'>"+y.OrddTxt+"</pre>"}else{u=y.OrddHtml;x=""}}var v="DRUG";if("CH"==y.OrderType){v="CH";n=true}else{if("1"==y.Chemo&&"CH"!=y.OrderType){v="OPCH";d=true}else{if("PC"==y.OrderType){v="PC";g=true}}}a.append('<tr OrderType="'+v+'"><td>'+y.AplDateStr.replace("\n","<br>")+"</td><td>"+y.DcDateStr.replace("\n","<br/>")+'</td><td title="'+x+'"  class="orderSpec" >'+u+'</td><td style="width:5%;height:5%;" title="'+z+'"  >'+I+'</td><td style="width:5%;height:5%;" title="'+B+'" >'+G+'</td><td style="width:5%;height:5%;" title="'+H+'" >'+F+'</td><td style="width:5%;height:5%;" title="'+p+'" >'+E+'</td><td style="width:5%;height:5%;" title="'+r+'" >'+D+"</td></tr>");y=null;delete y;A=null;delete A;x=null;delete x;u=null;delete u;v=null;delete v;I=null;delete I;G=null;delete G;F=null;delete F;E=null;delete E;D=null;delete D;z=null;delete z;B=null;delete B;H=null;delete H;p=null;delete p;r=null;delete r;w=null;delete w});a.append("</tbody>");a.appendTo(e);f.down("#MOD_DrugLogPanel").setHtml(e[0].outerHTML);var m=f;var k=NisTRApp.view.SysUtility.tapEventName();$(".exerecDrug").bind(k,function(){var p="ORDD_RID="+$(this).attr("orddrid")+";PROC_DATE="+$(this).attr("procdate")+";PROC_TIME="+$(this).attr("proctime").substring(0,4)+";";NisTRApp.view.Management.Druglog.GetLogRemark(p,$(this).attr("orddrid"),"Drug",$(this).attr("procdate"),$(this).attr("proctime"),$(this).attr("exerecord"),m,m.getRecord());p=null;delete p});if(!Ext.isEmpty(b)){b.fireEvent("tap",b,null,null)}else{if(!Ext.isEmpty(f)){f.down("#MDL_ExeDrugBtn").fireEvent("tap",f.down("#MDL_ExeDrugBtn"),null,null)}}h=null;delete h;a=null;delete a;l=null;delete l;e=null;delete e;k=null;delete k}else{f.down("#MOD_DrugLogPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無藥品執行記錄.</div>')}f.down("#MDL_ExeChemoBtn").setHidden(!n);f.down("#MDL_ExeOpChemoBtn").setHidden(!d);f.down("#MDL_ExePCABtn").setHidden(!g);f=null;delete f;n=null;delete d;d=null;delete d;g=null;delete g;j=null;delete j},LoadInsLog:function(e,d,a){if(Ext.getStore("sOrderInslog").isLoading()||Ext.isEmpty(e)){return}var b=Ext.getStore("sOrderInslog");b.removeAll();b.getProxy().setExtraParams({chartNo:e.data.ChartNo,inpNo:e.data.InpNo,type:"ins",sd:d,ed:a});b.load();b=null;delete b},RenderInsLog:function(f,l,b){if(Ext.getStore("sOrderInslog").isLoading()||Ext.isEmpty(l)||Ext.isEmpty(f.down("#MOD_InsLogPanel"))){return}var e=Ext.getStore("sOrderInslog");f.down("#MOD_InsLogPanel").setHtml("");if(e.getCount()>0){f.down("#MOD_InsLogPanel").setHtml("");var g="";var d=$('<div id="_orderDruglogIns" class="globalList"></div><input type="hidden" id="_logType"/>');var a=$('<table id="_orderDruglogInsTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" ></table>');var j='<thead><th style="width:10%">開單日期</th><th style="width:7%">接收日期<br/>停用日期</th><th>醫囑</th><th colspan=5>記錄</th></thead>';a.append(j);a.append("<tbody>");e.each(function(D,p,n){var z=D.raw;var w="";var v="";var u="";var s="";var r="";var x="";var C="";var E="";var m="";var o="";var B="";var y,q="";var A=0;D.DrugLogDatas().each(function(G){var H=G.data;if(H.ContentAt==""){B='<span orddrid="'+H.OrddRid+'" procdate="'+H.ProcDate+'" proctime="'+H.ProcTime+'" class="exerecIns" exerecord="'+H.Record.replace("\n","<br/>")+'">'+H.Record.replace("\n","<br/>").substr(0,20)+"<br/></span>"}else{B='<span orddrid="'+H.OrddRid+'" procdate="'+H.ProcDate+'" proctime="'+H.ProcTime+'" class="exerecIns" exerecord="'+H.Record.replace("\n","<br/>")+'" style="font-weight: bolder">'+H.Record.replace("\n","<br/>").substr(0,20)+"<br/></span>"}var F=H.Record+"\n";if(A%5==0){w+=B;x+=F}if(A%5==1){v+=B;C+=F}if(A%5==2){u+=B;E+=F}if(A%5==3){s+=B;m+=F}if(A%5==4){r+=B;o+=F}A=A+1;F=null;delete F;H=null;delete H});if(z.OrddHtml.toString().length==0){q=z.OrddTxt;y=""}else{if(z.OrddHtml.indexOf("<BR>")&&z.OrddHtml.substring(z.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")>0){q=z.OrddHtml.substring(0,z.OrddHtml.indexOf("<BR>")+(z.OrddHtml.substring(z.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")+4))+"<img src='../_/img/find.png' style='width:16px;height:16px;'>";y="<pre style='font-weight:bold;'>"+z.OrddTxt+"</pre>"}else{q=z.OrddHtml;y=""}}a.append('<tr><td style="width:10%">'+z.AplDateStr.replace("\n","<br/>")+'</td><td style="width:10%">'+z.ReceverDateStr.replace("\n","<br/>")+"<br/>"+z.DcDateStr+'</td><td style="width:20%" class="orderSpec" title="'+y+'">'+q+'</td><td style="width:5%;height:5%;" title="'+x+'">'+w+'</td><td style="width:5%;height:5%;" title="'+C+'">'+v+'</td><td style="width:5%;height:5%;" title="'+E+'">'+u+'</td><td style="width:5%;height:5%;" title="'+m+'">'+s+'</td><td style="width:5%;height:5%;" title="'+o+'">'+r+"</td></tr>");z=null;delete z;A=null;delete A;y=null;delete y;q=null;delete q;w=null;delete w;v=null;delete v;u=null;delete u;s=null;delete s;r=null;delete r;x=null;delete x;C=null;delete C;E=null;delete E;m=null;delete m;o=null;delete o});a.append("</tbody>");a.appendTo(d);f.down("#MOD_InsLogPanel").setHtml(d[0].outerHTML);var k=f;var h=NisTRApp.view.SysUtility.tapEventName();$(".exerecIns").bind(h,function(){var m="ORDD_RID="+$(this).attr("orddrid")+";PROC_DATE="+$(this).attr("procdate")+";PROC_TIME="+$(this).attr("proctime").substring(0,4)+";";NisTRApp.view.Management.Druglog.GetLogRemark(m,$(this).attr("orddrid"),"Ins",$(this).attr("procdate"),$(this).attr("proctime"),$(this).attr("exerecord"),k,k.getRecord());m=null;delete m});g=null;delete g;a=null;delete a;j=null;delete j;d=null;delete d;h=null;delete h}else{f.down("#MOD_InsLogPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無醫囑執行記錄.</div>')}f=null;delete f;e=null;delete e},LoadLabLog:function(d,b,a){if(Ext.getStore("sOrderLablog").isLoading()||Ext.isEmpty(d)){return}var e=Ext.getStore("sOrderLablog");e.removeAll();e.getProxy().setExtraParams({chartNo:d.data.ChartNo,inpNo:d.data.InpNo,type:"lab",sd:b,ed:a});e.load();e=null;delete e},RenderLabLog:function(e,l,b){if(Ext.getStore("sOrderLablog").isLoading()||Ext.isEmpty(l)||Ext.isEmpty(e.down("#MOD_LabLogPanel"))){return}var j=Ext.getStore("sOrderLablog");e.down("#MOD_LabLogPanel").setHtml("");if(j.getCount()>0){e.down("#MOD_LabLogPanel").setHtml("");var f="";var d=$('<div id="_orderDruglogLab" class="globalList"></div><input type="hidden" id="_logType"/>');var a=$('<table id="_orderDruglogLabTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" ></table>');var h='<thead><th style="width:100px">開單日期<br/>預訂日期</th><th style="width:60px">處方醫師</th><th style="width:200px">醫囑</th><th style="width:90px">接收</th><th style="width:90px">執行</th><th style="width:90px">單號</th><th style="width:100px">檢體送出<br/>檢體送達</th><th style="width:100px">收件單位<br/>收件日期</th><th style="width:100px">停用日期</th><th style="width:100px">執行備註</th><th style="width:20px">附註</th></thead>';a.append(h);a.append("<tbody>");j.each(function(r,o,q){var p=r.raw;var n,m="";var s="";if(!Ext.isEmpty(p.ContentAt)&&!Ext.isEmpty(p.ContentAt.trim())){s='style="font-weight: bolder"'}if(p.OrddHtml.toString().length==0){m=p.OrddTxt;n=""}else{if(p.OrddHtml.indexOf("<BR>")&&p.OrddHtml.substring(p.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")>0){m=p.OrddHtml.substring(0,p.OrddHtml.indexOf("<BR>")+(p.OrddHtml.substring(p.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")+4))+"<img src='../_/img/find.png' style='width:16px;height:16px;'>";n="<pre style='font-weight:bold;'>"+p.OrddTxt+"</pre>"}else{m=p.OrddHtml;n=""}}a.append("<tr ><td>"+p.OrderDesc+"</td><td>"+p.CreName+'</td><td title="'+n+'"  class="orderSpec">'+m+"</td><td>"+p.CheckDate.replace("\n","<br/>")+'</td><td class="exerecLab" orddrid="'+p.OrddRid+'" procdate="'+p.ProcDate+'" proctime="'+p.ProcTime+'"    exerecord="'+p.ExeDate.replace("\n","<br/>")+'"><span '+s+">"+p.ExeDate.replace("\n","<br/>")+"</span></td><td>"+p.Accessnum+"</td><td>"+p.SendArrDate+"</td><td>"+p.TrgExeDate+"</td><td>"+p.StopDesc+"</td><td>"+p.Remark+"</td><td></td></tr>");p=null;delete p;n=null;delete n;m=null;delete m;s=null;delete s});a.append("</tbody>");a.appendTo(d);e.down("#MOD_LabLogPanel").setHtml(d[0].outerHTML);var k=e;var g=NisTRApp.view.SysUtility.tapEventName();$(".exerecLab").bind(g,function(){var m="ORDD_RID="+$(this).attr("orddrid")+";PROC_DATE="+$(this).attr("procdate")+";PROC_TIME="+$(this).attr("proctime").substring(0,4)+";";NisTRApp.view.Management.Druglog.GetLogRemark(m,$(this).attr("orddrid"),"Lab",$(this).attr("procdate"),$(this).attr("proctime"),$(this).attr("exerecord"),k,k.getRecord());m=null;delete m});f=null;delete f;a=null;delete a;h=null;delete h;d=null;delete d;g=null;delete g}else{e.down("#MOD_LabLogPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無檢驗檢查執行記錄.</div>')}e=null;delete e;sOrderInslog=null;delete sOrderInslog},LoadPcaLog:function(d,b,a){if(Ext.getStore("sOrderPcalog").isLoading()||Ext.isEmpty(d)){return}var e=Ext.getStore("sOrderPcalog");e.removeAll();e.getProxy().setExtraParams({chartNo:d.data.ChartNo,inpNo:d.data.InpNo,type:"pca",sd:b,ed:a});e.load();e=null;delete e},RenderPcaLog:function(b,h,e){if(Ext.getStore("sOrderPcalog").isLoading()||Ext.isEmpty(h)||Ext.isEmpty(b.down("#MOD_PcaLogPanel"))){return}var j=Ext.getStore("sOrderPcalog");b.down("#MOD_PcaLogPanel").setHtml("");if(j.getCount()>0){b.down("#MOD_PcaLogPanel").setHtml("");var d="";var g=$('<div id="_orderPCAlog" class="globalList"></div>');var f=$('<table id="_orderPCAlogTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" ></table>');var a='<thead><th style="width:40px">開單日期</th><th style="width:40px">停用日期</th><th style="width:150px">醫囑</th><th colspan=5 style="width:150px">記錄</th></thead>';f.append(a);f.append("<tbody>");j.each(function(x,n,l){var s=x.raw;var D="";var B="";var A="";var z="";var y="";var u="";var w="";var C="";var k="";var m="";var q="";var v=0;var r="",o="";x.DrugLogDatas().each(function(E){var G=E.data;if(x.ContentAt==""){q='<span orddrid="'+G.OrddRid+'" procdate="'+G.ProcDate+'" proctime="'+G.ProcTime+'" class="exerecDrug" exerecord="'+G.Record.replace("\n","<br/>")+'">'+G.Record.replace("\n","<br/>").substr(0,20)+"<br/></span>"}else{q='<span orddrid="'+G.OrddRid+'" procdate="'+G.ProcDate+'" proctime="'+G.ProcTime+'" class="exerecDrug" style="font-weight: bolder" exerecord="'+G.Record.replace("\n","<br/>")+'">'+G.Record.replace("\n","<br/>").substr(0,20)+"<br/></span>"}var F=G.Record+"\n";if(v%5==0){D+=q;u+=F}if(v%5==1){B+=q;w+=F}if(v%5==2){A+=q;C+=F}if(v%5==3){z+=q;k+=F}if(v%5==4){y+=q;m+=F}v=v+1;G=null;delete G;F=null;delete F});if(s.OrddHtml.toString().length==0){o=s.OrddTxt;r=""}else{if(s.OrddHtml.indexOf("<BR>")&&s.OrddHtml.substring(s.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")>0){o=s.OrddHtml.substring(0,s.OrddHtml.indexOf("<BR>")+(s.OrddHtml.substring(s.OrddHtml.indexOf("<BR>")+4,1000).indexOf("<BR>")+4))+"<img src='../_/img/find.png' style='width:16px;height:16px;'>";r="<pre style='font-weight:bold;'>"+s.OrddTxt+"</pre>"}else{o=s.OrddHtml;r=""}}var p="PCA";f.append('<tr OrderType="'+p+'"><td>'+s.AplDateStr.replace("\n","<br>")+"</td><td>"+s.DcDateStr.replace("\n","<br/>")+'</td><td title="'+r+'"  class="orderSpec" >'+o+'</td><td style="width:5%;height:5%;" title="'+u+'"  >'+D+'</td><td style="width:5%;height:5%;" title="'+w+'" >'+B+'</td><td style="width:5%;height:5%;" title="'+C+'" >'+A+'</td><td style="width:5%;height:5%;" title="'+k+'" >'+z+'</td><td style="width:5%;height:5%;" title="'+m+'" >'+y+"</td></tr>");s=null;delete s;v=null;delete v;r=null;delete r;o=null;delete o;p=null;delete p;D=null;delete D;B=null;delete B;A=null;delete A;z=null;delete z;y=null;delete y;u=null;delete u;w=null;delete w;C=null;delete C;k=null;delete k;m=null;delete m;q=null;delete q});f.append("</tbody>");f.appendTo(g);b.down("#MOD_PcaLogPanel").setHtml(g[0].outerHTML);d=null;delete d;f=null;delete f;a=null;delete a;g=null;delete g}else{b.down("#MOD_PcaLogPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:40%; color:red; font-weight:bold;">無PCA執行記錄.</div>')}b=null;delete b;j=null;delete j},GetLogRemark:function(p,d,m,g,h,f,b,o){if(Ext.isEmpty(o)){return false}var l=b;var k=function n(e){if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.LoadLogById)&&Ext.isFunction(e.LoadLogById)&&!Ext.isEmpty(e.down("#MOD_Main"))){e.LoadLogById(e.down("#MOD_Main").getActiveItem().getItemId(),e.down("#MOD_Main").getActiveItem())}};try{if(!Ext.isEmpty(Ext.getCmp("_inpMgrWdisNotePanel"))){Ext.getCmp("_inpMgrWdisNotePanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpMgrWdisNotePanel"))){var a=Ext.create("NisTRApp.view.Management.WdisNotePanel",{id:"_inpMgrWdisNotePanel",successFn:k,record:o,caller:b,drugLog:{ProblemStr:p,OrddRid:d,Type:m,ProcDate:g,ProcTime:h,ExeRecord:f}});l.overlay=Ext.Viewport.add(a);_inpMgrWdisNotePanel=null;delete _inpMgrWdisNotePanel}l.overlay.show()}catch(j){console.log(j)}k=null;delete k;return}},config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"MDL_HeadBar",items:[{xtype:"segmentedbutton",itemId:"MDL_SelectBar",width:"45%",items:[{xtype:"button",flex:1,itemId:"MDL_ExeDrugBtn",ui:"confirm",text:"藥 品"},{xtype:"button",flex:1,itemId:"MDL_ExeLabBtn",text:"檢驗/檢查"},{xtype:"button",flex:1,itemId:"MDL_ExeInsBtn",text:"醫療指示"},{xtype:"button",flex:1,hidden:true,itemId:"MDL_ExeChemoBtn",text:"化 療"},{xtype:"button",flex:1,hidden:true,itemId:"MDL_ExeOpChemoBtn",text:"口服化療"},{xtype:"button",flex:1,hidden:true,itemId:"MDL_ExePCABtn",text:"PCA"}]},{xtype:"panel",margin:"0 0 0 10",width:"330px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"MDL_BegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"MDL_EndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"panel",itemId:"MDL_FnBar",layout:{type:"hbox"},items:[{xtype:"button",itemId:"MDL_QueryBtn",width:"60px",text:"查詢"},{xtype:"button",itemId:"MDL_WeeklyBtn",width:"60px",text:"本週"},{xtype:"button",itemId:"MDL_TodayBtn",ui:"confirm-round",width:"60px",text:"本日"}]}]},{xtype:"panel",actPanel:"MOD_DrugLogPanel",itemId:"MOD_Main",layout:{type:"fit"},items:[{xtype:"panel",initialFalg:true,html:"drug",itemId:"MOD_DrugLogPanel",scrollable:"vertical"},{xtype:"panel",initialFalg:true,hidden:true,html:"lab",itemId:"MOD_LabLogPanel",scrollable:"vertical"},{xtype:"panel",initialFalg:true,hidden:true,html:"ins",itemId:"MOD_InsLogPanel",scrollable:"vertical"},{xtype:"panel",initialFlag:true,html:"pca",itemId:"MOD_PcaLogPanel",scrollable:"vertical"}]},{xtype:"toolbar",docked:"bottom",itemId:"MDL_FootBar",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"MDL_TimeBackBtn",ui:"confirm-back",width:"47%",text:"前一日"},{xtype:"button",itemId:"MDL_TimeForwardBtn",ui:"confirm-forward",width:"47%",text:"後一日"}]}],listeners:[{fn:"onMDL_ExeDrugBtnTap",event:"tap",delegate:"#MDL_ExeDrugBtn"},{fn:"onMDL_ExeLabBtnTap",event:"tap",delegate:"#MDL_ExeLabBtn"},{fn:"onMDL_ExeInsBtnTap",event:"tap",delegate:"#MDL_ExeInsBtn"},{fn:"onMDL_ExeChemoBtnTap",event:"tap",delegate:"#MDL_ExeChemoBtn"},{fn:"onMDL_ExeOpChemoBtnTap",event:"tap",delegate:"#MDL_ExeOpChemoBtn"},{fn:"onMDL_ExePCABtnTap",event:"tap",delegate:"#MDL_ExePCABtn"},{fn:"onMDL_QueryBtnTap",event:"tap",delegate:"#MDL_QueryBtn"},{fn:"onMDL_WeeklyBtnTap",event:"tap",delegate:"#MDL_WeeklyBtn"},{fn:"onMDL_TodayBtnTap",event:"tap",delegate:"#MDL_TodayBtn"},{fn:"onMDL_TimeBackBtnTap",event:"tap",delegate:"#MDL_TimeBackBtn"},{fn:"onMDL_TimeForwardBtnTap",event:"tap",delegate:"#MDL_TimeForwardBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onMDL_ExeDrugBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");b.getParent().setActiveItem(b);this.setMDLMainActive("MOD_DrugLogPanel");if(this.down("#MOD_DrugLogPanel").initialFlag&&!this.getInitialFlag()){this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())}if($("#_orderDruglogTable")!=null){$("#_orderDruglogTable tbody tr").each(function(){if($(this).attr("OrderType")=="DRUG"){$(this).show()}else{$(this).hide()}})}},onMDL_ExeLabBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");b.getParent().setActiveItem(b);this.setMDLMainActive("MOD_LabLogPanel");if(this.down("#MOD_LabLogPanel").initialFlag&&!this.getInitialFlag()){this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())}},onMDL_ExeInsBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");b.getParent().setActiveItem(b);this.setMDLMainActive("MOD_InsLogPanel");if(this.down("#MOD_InsLogPanel").initialFlag&&!this.getInitialFlag()){this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())}},onMDL_ExeChemoBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");b.getParent().setActiveItem(b);this.setMDLMainActive("MOD_DrugLogPanel");if(this.down("#MOD_DrugLogPanel").initialFlag&&!this.getInitialFlag()){this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())}if($("#_orderDruglogTable")!=null){$("#_orderDruglogTable tbody tr").each(function(){if($(this).attr("OrderType")=="CH"){$(this).show()}else{$(this).hide()}})}},onMDL_ExeOpChemoBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");b.getParent().setActiveItem(b);this.setMDLMainActive("MOD_DrugLogPanel");if(this.down("#MOD_DrugLogPanel").initialFlag&&!this.getInitialFlag()){this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())}if($("#_orderDruglogTable")!=null){$("#_orderDruglogTable tbody tr").each(function(){if($(this).attr("OrderType")=="OPCH"){$(this).show()}else{$(this).hide()}})}},onMDL_ExePCABtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");b.getParent().setActiveItem(b);this.setMDLMainActive("MOD_DrugLogPanel");if(this.down("#MOD_DrugLogPanel").initialFlag&&!this.getInitialFlag()){this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())}if($("#_orderDruglogTable")!=null){$("#_orderDruglogTable tbody tr").each(function(){if($(this).attr("OrderType")=="PC"){$(this).show()}else{$(this).hide()}})}},onMDL_QueryBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");this.down("#MDL_FootBar").setHidden(true);this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())},onMDL_WeeklyBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");this.down("#MDL_BegDate").setValue(NisTRApp.view.DateUtil.GetWeekFirstDay());this.down("#MDL_EndDate").setValue(NisTRApp.view.DateUtil.GetWeekLastDay());this.down("#MDL_TimeBackBtn").setText("前一周");this.down("#MDL_TimeForwardBtn").setText("後一周");this.down("#MDL_FootBar").setHidden(false);this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())},onMDL_TodayBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(b.getParent(),b,"confirm-round","","");this.down("#MDL_BegDate").setValue(SYS_CONST.SysDate);this.down("#MDL_EndDate").setValue(SYS_CONST.SysDate);this.down("#MDL_TimeBackBtn").setText("前一日");this.down("#MDL_TimeForwardBtn").setText("後一日");this.down("#MDL_FootBar").setHidden(false);this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())},onMDL_TimeBackBtnTap:function(b,f,a){var d=-1;if("confirm-round"==this.down("#MDL_WeeklyBtn").getUi()){d=-7}this.down("#MDL_BegDate").setValue(Ext.Date.add(this.down("#MDL_BegDate").getValue(),Ext.Date.DAY,d));this.down("#MDL_EndDate").setValue(Ext.Date.add(this.down("#MDL_EndDate").getValue(),Ext.Date.DAY,d));this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())},onMDL_TimeForwardBtnTap:function(b,f,a){var d=1;if("confirm-round"==this.down("#MDL_WeeklyBtn").getUi()){d=7}this.down("#MDL_BegDate").setValue(Ext.Date.add(this.down("#MDL_BegDate").getValue(),Ext.Date.DAY,d));this.down("#MDL_EndDate").setValue(Ext.Date.add(this.down("#MDL_EndDate").getValue(),Ext.Date.DAY,d));this.LoadLogById(this.down("#MOD_Main").getActiveItem().getItemId(),this.down("#MOD_Main").getActiveItem())},onContainerDestroy:function(a){if(Ext.getStore("sOrderDruglog")!=null){Ext.getStore("sOrderDruglog").removeAll();Ext.getStore("sOrderDruglog").destroy()}if(Ext.getStore("sOrderInslog")!=null){Ext.getStore("sOrderInslog").removeAll();Ext.getStore("sOrderInslog").destroy()}if(Ext.getStore("sOrderLablog")!=null){Ext.getStore("sOrderLablog").removeAll();Ext.getStore("sOrderLablog").destroy()}if(Ext.getStore("sOrderPcalog")!=null){Ext.getStore("sOrderPcalog").removeAll();Ext.getStore("sOrderPcalog").destroy()}me=null;delete me;this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.down("#MDL_TodayBtn").fireEvent("tap",this.down("#MDL_TodayBtn"),null,null)}},setMDLMainActive:function(b){if(!Ext.isEmpty(this.down("#MOD_Main"))&&!Ext.isEmpty(b)){var a=this.down("#MOD_Main");try{var d=this.down("#MOD_Main").query(".panel");if(null!=d){d.forEach(function(h,f,g){if(h.xtype=="panel"){if(h.getItemId()==b){h.setHidden(false);a.setActiveItem(h)}else{h.setHidden(true)}}})}d=null;delete d}catch(e){console.log(e)}a=null;delete a}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("OrderHistory 住院資料錯誤");return false}this.DateInitial();this.resetInitialFlag();if(Ext.getStore("sOrderDruglog")==null){Ext.create("Ext.data.Store",{storeId:"sOrderDruglog",model:"NisTRApp.model.Patient.DrugLogGroup",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/Druglog.ashx",reader:{type:"json"}}})}Ext.getStore("sOrderDruglog").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sOrderDruglog").addListener("load",function(d,b,f,a,e){NisTRApp.view.Management.Druglog.RenderDrugLog(this,this.getRecord(),this.down("#MDL_SelectBar").getActiveItem());this.setMasked(false)},this);if(Ext.getStore("sOrderInslog")==null){Ext.create("Ext.data.Store",{storeId:"sOrderInslog",model:"NisTRApp.model.Patient.DrugLogGroup",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/Druglog.ashx",reader:{type:"json"}}})}Ext.getStore("sOrderInslog").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sOrderInslog").addListener("load",function(d,b,f,a,e){NisTRApp.view.Management.Druglog.RenderInsLog(this,this.getRecord());this.setMasked(false)},this);if(Ext.getStore("sOrderLablog")==null){Ext.create("Ext.data.Store",{storeId:"sOrderLablog",model:"NisTRApp.model.Patient.DrugLogGroup",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/Druglog.ashx",reader:{type:"json"}}})}Ext.getStore("sOrderLablog").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sOrderLablog").addListener("load",function(d,b,f,a,e){NisTRApp.view.Management.Druglog.RenderLabLog(this,this.getRecord());this.setMasked(false)},this);this.down("#MDL_SelectBar").setActiveItem(0);this.down("#MDL_SelectBar").getActiveItem().fireEvent("tap",this.down("#MDL_SelectBar").getActiveItem(),null,null)},DateInitial:function(){var b=this.getRecord().getIpbinp();if(!Ext.isEmpty(b.data.OutDate)&&!Ext.isEmpty(b.data.InDate)){var a=NisTRApp.view.DateUtil.StrToDateTime(b.data.InDate);this.down("#MDL_BegDate").setValue(a);this.down("#MDL_EndDate").setValue(a);a=null;delete a}else{this.down("#MDL_BegDate").setValue(SYS_CONST.SysDate);this.down("#MDL_EndDate").setValue(SYS_CONST.SysDate)}b=null;delete b},resetInitialFlag:function(){if(!Ext.isEmpty(this.down("#MOD_DrugLogPanel"))){this.down("#MOD_DrugLogPanel").initialFlag=true}if(!Ext.isEmpty(this.down("#MOD_LabLogPanel"))){this.down("#MOD_LabLogPanel").initialFlag=true}if(!Ext.isEmpty(this.down("#MOD_InsLogPanel"))){this.down("#MOD_InsLogPanel").initialFlag=true}if(!Ext.isEmpty(this.down("#MOD_PcaLogPanel"))){this.down("#MOD_PcaLogPanel").initialFlag=true}},LoadLogById:function(b,a){this.resetInitialFlag();a.initialFlag=false;if(b=="MOD_DrugLogPanel"){NisTRApp.view.Management.Druglog.LoadDrugLog(this.getRecord(),this.down("#MDL_BegDate").getFormattedValue("Y/m/d 00:00"),this.down("#MDL_EndDate").getFormattedValue("Y/m/d 23:59"))}else{if(b=="MOD_LabLogPanel"){NisTRApp.view.Management.Druglog.LoadLabLog(this.getRecord(),this.down("#MDL_BegDate").getFormattedValue("Y/m/d 00:00"),this.down("#MDL_EndDate").getFormattedValue("Y/m/d 23:59"))}else{if(b=="MOD_InsLogPanel"){NisTRApp.view.Management.Druglog.LoadInsLog(this.getRecord(),this.down("#MDL_BegDate").getFormattedValue("Y/m/d 00:00"),this.down("#MDL_EndDate").getFormattedValue("Y/m/d 23:59"))}else{if(b=="MOD_PcaLogPanel"){NisTRApp.view.Management.Druglog.LoadPcaLog(this.getRecord(),this.down("#MDL_BegDate").getFormattedValue("Y/m/d 00:00"),this.down("#MDL_EndDate").getFormattedValue("Y/m/d 23:59"))}}}}}});Ext.define("NisTRApp.view.Profile.Summary",{extend:Ext.Container,alias:"widget.PtSummary",config:{height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"panel",flex:1,itemId:"PTS_Main",layout:{type:"fit"},items:[{xtype:"formpanel",itemId:"PTS_InpInfoFormPanel",scrollable:false,items:[{xtype:"textfield",itemId:"PTS_INDate",margin:"5 5 0 5",label:"入院日期",labelWidth:"120px",name:"INDate",readOnly:true},{xtype:"textfield",itemId:"PTS_MainIcdh",margin:"0 5 0 5",label:'主診斷<img src="../_/img/teach3.png" id="_profileDxItem" style="width:30px;height:30px;"></img>',labelWidth:"120px",name:"MainIcdh",placeHolder:"請輸入"},{xtype:"textfield",itemId:"PTS_PastHistory",margin:"0 5 0 5",label:'過去病史<img src="../_/img/teach3.png" id="_profilePhItem" style="width:30px;height:30px;"></img>',labelWidth:"120px",name:"PastHistory",placeHolder:"請輸入"},{xtype:"textfield",itemId:"PTS_ReasonSummary",margin:"0 5 0 5",label:"住院目的",labelWidth:"120px",name:"ReasonSummary",placeHolder:"請輸入"},{xtype:"selectfield",itemId:"PTS_NursingClass",margin:"0 5 0 5",label:"護理分類",labelWidth:"120px",name:"NursingClass",placeHolder:"--請選擇--",displayField:"ItemName",valueField:"ItemID"}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",centered:true,itemId:"PTS_SaveBtn",ui:"confirm",width:"50%",text:"病人基本資料存檔"}]}]},{xtype:"panel",flex:1,itemId:"PTS_Form",layout:{type:"vbox"},items:[{xtype:"panel",flex:1,hidden:true,itemId:"PTS_InpHistoryPanel"}]}],listeners:[{fn:"onPTS_SaveBtnTap",event:"tap",delegate:"#PTS_SaveBtn"},{fn:"onPTS_MainUpdatedata",event:"updatedata",delegate:"#PTS_Main"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onPTS_SaveBtnTap:function(b,f,g){if(Ext.isEmpty(this.getRecord())){return false}var h=this;var l=this.getRecord();var j=h.down("#PTS_MainIcdh").getValue();var d=h.down("#PTS_PastHistory").getValue();var k=h.down("#PTS_NursingClass").getValue();var a=h.down("#PTS_ReasonSummary").getValue();console.log(j,d,k,a);h.setMasked({xtype:"loadmask",message:"Updateing..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"INP/action/ProfileUpdate.ashx",scope:this,method:"POST",params:{InpNo:l.data.InpNo,ChartNo:l.data.ChartNo,DiagContent:encodeURIComponent(j),PasthistoryContent:encodeURIComponent(d),Nurclass:k,IpbReason:encodeURIComponent(a),UserID:NisTRApp.view.SysUtility.GetUserID(),UpdatePage:1},success:function(e){h.setMasked(false);var m=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(m.Success){if(!Ext.isEmpty(Ext.getStore("sPatNurDatm"))&&!Ext.getStore("sPatNurDatm").isLoading()){Ext.getStore("sPatNurDatm").load()}}m=null;delete m;h=null;delete h},failure:function(){h.setMasked(false);NisTRApp.view.Misc.Alert("存檔失敗",0);h=null;delete h}},this);l=null;delete l;j=null;delete j;d=null;delete d;k=null;delete k;a=null;delete a},onPTS_MainUpdatedata:function(a,d,b){this.LoadNurdatm(this.getRecord(),this)},onContainerDestroy:function(a){if(Ext.getStore("sPatNurDatm")!=null){Ext.getStore("sPatNurDatm").removeAll();Ext.getStore("sPatNurDatm").destroy()}me=null;delete me;this.removeAll(true,true)},onContainerPainted:function(d,b){var a=NisTRApp.view.SysUtility.tapEventName();$("#_profileDxItem").unbind(a);$("#_profileDxItem").bind(a,{caller:this,field:this.down("#PTS_MainIcdh"),msg:"oop"},function(h){var f=$(this).position();try{if(!Ext.isEmpty(Ext.getCmp("_inpProfileDxItemPanel"))){Ext.getCmp("_inpProfileDxItemPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpProfileDxItemPanel"))){var g=Ext.create("NisTRApp.view.Profile.ProfileDxItemPanel",{id:"_inpProfileDxItemPanel",height:320,width:320,top:f.top+140,left:f.left+140,caller:h.data.caller,field:h.data.field});h.data.caller.overlay=Ext.Viewport.add(g);g=null;delete g}h.data.caller.overlay.show()}catch(h){console.log(h)}f=null;delete f});$("#_profilePhItem").unbind(a);$("#_profilePhItem").bind(a,{caller:this,field:this.down("#PTS_PastHistory")},function(h){var f=$(this).position();try{if(!Ext.isEmpty(Ext.getCmp("_inpPastHistoryItemPanel"))){Ext.getCmp("_inpPastHistoryItemPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpPastHistoryItemPanel"))){var g=Ext.create("NisTRApp.view.Profile.PastHistoryItemPanel",{id:"_inpPastHistoryItemPanel",height:320,width:320,top:f.top+140,left:f.left+140,caller:h.data.caller,field:h.data.field});h.data.caller.overlay=Ext.Viewport.add(g);g=null;delete g}h.data.caller.overlay.show()}catch(h){console.log(h)}f=null;delete f});a=null;delete a},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("ProfileSummary 住院資料錯誤");return false}if(Ext.getStore("sPatNurDatm")==null){Ext.create("Ext.data.Store",{storeId:"sPatNurDatm",clearOnPageLoad:false,model:"NisTRApp.model.NUR.NurdatmEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"INP/Search/QueryNurdatm.ashx",reader:{type:"json"}}})}if(Ext.getStore("sNurClassOptions")==null){Ext.create("Ext.data.Store",{storeId:"sNurClassOptions",clearOnPageLoad:false,autoLoad:false,model:"NisTRApp.model.Nur.NurrefEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{NurMajor:"NURCLASS"},url:SYS_CONST.ApiRoot+"INP/Search/NurrefOptions.ashx",reader:{type:"json"}}})}this.down("#PTS_NursingClass").setStore(Ext.getStore("sNurClassOptions"));if(Ext.getStore("sNurClassOptions").getCount()<=0){if(!Ext.getStore("sNurClassOptions").isLoading()){Ext.getStore("sNurClassOptions").load()}}Ext.getStore("sPatNurDatm").addListener("beforeload",function(b,a,d){this.down("#PTS_Main").setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sPatNurDatm").addListener("load",function(d,b,f,a,e){if(!Ext.isEmpty(this.RenderNurdatm)&&Ext.isFunction(this.RenderNurdatm)){this.RenderNurdatm(this,this.getRecord())}this.down("#PTS_Main").setMasked(false)},this);this.down("#PTS_Main").setRecord(this.getRecord())},LoadNurdatm:function(b){if(Ext.getStore("sPatNurDatm").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sPatNurDatm");if(!Ext.isEmpty(this.down("#PTS_InpInfoFormPanel"))){this.down("#PTS_InpInfoFormPanel").reset()}this.down("#PTS_InpInfoFormPanel").setRecord(b.getIpbinp());a.removeAll();a.getProxy().setExtraParams({InpNo:b.data.InpNo});a.load();a=null;delete a},RenderNurdatm:function(b,h){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#PTS_InpInfoFormPanel"))){return false}if(!Ext.isEmpty(b.down("#PTS_InpInfoFormPanel"))){b.down("#PTS_InpInfoFormPanel").reset()}var g=Ext.getStore("sPatNurDatm");var f=b.down("#PTS_InpInfoFormPanel");var e=h.getIpbinp();if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.data.INDate)&&!Ext.isEmpty(f.down("#PTS_INDate"))){f.down("#PTS_INDate").setValue(e.data.INDate)}if(!Ext.isEmpty(e)&&!Ext.isEmpty(f.down("#PTS_MainIcdh"))){var a=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}{9}",e.data.IcdhCodeName1==""?"":e.data.IcdhCodeName1+";",e.data.IcdhCodeName2==""?"":e.data.IcdhCodeName2+";",e.data.IcdhCodeName3==""?"":e.data.IcdhCodeName3+";",e.data.IcdhCodeName4==""?"":e.data.IcdhCodeName4+";",e.data.IcdhCodeName5==""?"":e.data.IcdhCodeName5+";",e.data.IcdhCodeName6==""?"":e.data.IcdhCodeName6+";",e.data.IcdhCodeName7==""?"":e.data.IcdhCodeName7+";",e.data.IcdhCodeName8==""?"":e.data.IcdhCodeName8+";",e.data.IcdhCodeName9==""?"":e.data.IcdhCodeName9+";",e.data.IcdhCodeName10==""?"":inpdata.IcdhCodeName10+";");f.down("#PTS_MainIcdh").setValue(a);a=null;delete a}if(g.getCount()>0){if(!Ext.isEmpty(g.getAt(0))){var d=g.getAt(0).data;if(!Ext.isEmpty(d.IpbReason)&&!Ext.isEmpty(f.down("#PTS_ReasonSummary"))){f.down("#PTS_ReasonSummary").setValue(decodeURIComponent(d.IpbReason))}if(!Ext.isEmpty(d.Pasthistory)&&!Ext.isEmpty(f.down("#PTS_PastHistory"))){f.down("#PTS_PastHistory").setValue(decodeURIComponent(d.Pasthistory))}if(!Ext.isEmpty(d.Nurclass)&&!Ext.isEmpty(f.down("#PTS_NursingClass"))){f.down("#PTS_NursingClass").setValue(decodeURIComponent(d.Nurclass))}if(!Ext.isEmpty(d.Nurdiag)&&!Ext.isEmpty(f.down("#PTS_MainIcdh"))){f.down("#PTS_MainIcdh").setValue(decodeURIComponent(d.Nurdiag))}d=null;delete d}}e=null;delete e;g=null;delete g;f=null;delete f}});Ext.define("NisTRApp.view.Profile.ProfileDxItemPanel",{extend:Ext.Panel,config:{height:320,width:320,hideOnMaskTap:true,layout:{type:"fit"},modal:true,caller:{},field:{},items:[{xtype:"list",itemId:"ItemList",disableSelection:true,itemTpl:["<Div>{ItemName}</Div>",""],grouped:true}],listeners:[{fn:"onItemListItemTap",event:"itemtap",delegate:"#ItemList"},{fn:"onPanelHide",event:"hide"},{fn:"onPanelDestroy",event:"destroy"}]},onItemListItemTap:function(b,f,k,a,j,g){if(!Ext.isEmpty(this.getField())){var h=this.getField();var d=h.getValue();if(Ext.isEmpty(d)){h.setValue(a.data.ItemName)}else{h.setValue(d+"; "+a.data.ItemName)}h=null;delete h;d=null;delete d}},onPanelHide:function(a,b){this.destroy()},onPanelDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.getStore("sNurDiagOptions")==null){Ext.create("Ext.data.Store",{storeId:"sNurDiagOptions",clearOnPageLoad:false,autoLoad:true,model:"NisTRApp.model.Nur.NurrefEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{NurMajor:"DIAG"},url:SYS_CONST.ApiRoot+"INP/Search/NurrefOptions.ashx",reader:{type:"json"}},grouper:{groupFn:function(a){return a.get("NurMinorInt")+" - "+a.get("MinorName")}},sorters:{property:"NurMinorInt"},filters:{filterFn:function(a){if(null==a.data.NurMajor||"DIAG"!=a.data.NurMajor){return false}else{if(null==a.data.MinorName||""==a.data.MinorName){return false}else{if(null==a.data.NurMinor){return false}else{return true}}}}}})}this.down("#ItemList").setStore(Ext.getStore("sNurDiagOptions"));if(Ext.getStore("sNurDiagOptions").getCount()<=0){if(!Ext.getStore("sNurDiagOptions").isLoading()){Ext.getStore("sNurDiagOptions").load()}}}});Ext.define("NisTRApp.view.Management.WdisNotePanel",{extend:Ext.Panel,statics:{LoadWdisProgNotes:function(d,b){if(Ext.getStore("sDruglogRemark").isLoading()||Ext.isEmpty(d)){return}var a=Ext.getStore("sDruglogRemark");a.removeAll();a.getProxy().setExtraParams({ChartNo:d.data.ChartNo,InpNo:d.data.InpNo,ProblemStr:b.ProblemStr});a.load();a=null;delete a},RenderWdisProgNotes:function(e,l,f){if(Ext.getStore("sDruglogRemark").isLoading()||Ext.isEmpty(l)||Ext.isEmpty(f)||Ext.isEmpty(e.down("#MWNP_GridPanel"))){return}var b=Ext.getStore("sDruglogRemark");e.down("#MWNP_GridPanel").setHtml("");if(b.getCount()>0){e.down("#MWNP_GridPanel").setHtml("");var g="";var d=$('<div id="_drugLogRemarkList" class="globalList"></div><input type="hidden" id="_drugLogRemarkInfo" value="'+f.OrddRid+'" problem="'+f.ProblemStr+'" procDate="'+f.ProcDate+'" procTime="'+f.ProcTime+'"  />');var a=$('<table id="_drugLogRemarkListTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >');var j='<thead><th style="width:90px">日期</th><th style="width:90px">時間</th><th style="width:70px">人員</th><th>備註內容</th><th style="width:60px">簽章</th><th style="width:60px">刪除</th></thead>';a.append(j);a.append("<tbody>");b.each(function(q,m,p){var n=q.raw;var o="";if(n.DssFlag=="N"){o='<td class="delremark" inpno="'+n.InpNO+'" chartno="'+n.ChartNO+'" chartseq="'+n.ChartSeq+'" progdate="'+n.ProgDate+'" progtime="'+n.ProgTime+'" ><img  src="../_/img/Trash-can-icon.png" style="width:28px;height:28px;" ></td>'}else{o="<td></td>"}a.append("<tr><td>"+n.ProgDate+"</td><td>"+n.ProgTime+"</td><td>"+n.UserName+"</td><td>"+n.ContentAT+"</td><td>"+n.DssFlag+"</td>"+o+"</tr>");n=null;delete n;o=null;delete o});a.append("</tbody>");a.appendTo(d);e.down("#MWNP_GridPanel").setHtml(d[0].outerHTML);var k=e;var h=NisTRApp.view.SysUtility.tapEventName();$(".delremark").bind(h,function(){NisTRApp.view.Management.WdisNotePanel.DelWdisNote($(this).attr("inpno"),$(this).attr("chartno"),$(this).attr("chartseq"),$(this).attr("progdate"),$(this).attr("progtime"),k)});g=null;delete g;a=null;delete a;j=null;delete j;d=null;delete d;h=null;delete h}else{e.down("#MWNP_GridPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無執行記錄備註.</div>')}e=null;delete e;sOrderInslog=null;delete sOrderInslog},DelWdisNote:function(f,h,a,g,b,d,e){if(!Ext.isEmpty(d)){d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/DruglogRemarkDelete.ashx",scope:this,method:"POST",params:{InpNo:f,ChartNo:h,ChartSeq:a,ProgDate:g,ProgTime:b},success:function(j){d.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){if(!Ext.isEmpty(Ext.getStore("sDruglogRemark"))){Ext.getStore("sDruglogRemark").load()}if(!Ext.isEmpty(d.getSuccessFn())&&Ext.isFunction(d.getSuccessFn())){d.getSuccessFn()(d.getCaller())}}k=null;delete k},failure:function(){d.setMasked(false);Ext.Msg.alert("存檔失敗")}})}},config:{initialFlag:true,centered:true,height:400,width:580,layout:{type:"vbox"},modal:true,caller:{},successFn:{},drugLog:{},items:[{xtype:"toolbar",docked:"top",itemId:"MWNP_HeadBar",title:"記錄"},{xtype:"panel",flex:0.2,centered:false,html:"<span> 記錄人員</span>",itemId:"MWNP_TitlePanel"},{xtype:"panel",flex:1,itemId:"MWNP_GridPanel",layout:{type:"fit"},scrollable:"vertical"},{xtype:"panel",flex:0.2,itemId:"MWNP_InputPanel",layout:{type:"fit"},items:[{xtype:"textfield",itemId:"MWNP_NoteField",label:"記錄說明",labelWidth:"100px",autoCapitalize:true,placeHolder:"請輸入"}]},{xtype:"toolbar",docked:"bottom",itemId:"MWNP_FootBar",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"MWNP_SaveBtn",ui:"decline",width:"47%",text:"資料存檔"},{xtype:"button",itemId:"MWNP_CancelBtn",ui:"confirm",width:"47%",text:"取消"}]}],listeners:[{fn:"onMWNP_SaveBtnTap",event:"tap",delegate:"#MWNP_SaveBtn"},{fn:"onMWNP_CancelBtnTap",event:"tap",delegate:"#MWNP_CancelBtn"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelPainted",event:"painted"}]},onMWNP_SaveBtnTap:function(b,d,a){if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getDrugLog())||Ext.isEmpty(this.getDrugLog().ProblemStr)||Ext.isEmpty(this.getDrugLog().OrddRid)){Ext.Msg.alert("WdisNotePanel 住院資料錯誤");return false}if(Ext.isEmpty(this.down("#MWNP_NoteField").getValue())){NisTRApp.view.Misc.Alert("請輸入記錄內容!",1200);return false}var g=this.getDrugLog();var f=this.getRecord();if(!Ext.isEmpty(this)){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})}Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/action/DruglogRemarkInsert.ashx",scope:this,method:"POST",params:{InpNo:f.data.InpNo,UserID:NisTRApp.view.SysUtility.GetUserID(),OrddRid:g.OrddRid,Problem:g.ProblemStr,ProcDate:g.ProcDate,ProcTime:g.ProcTime,ContentAT:this.down("#MWNP_NoteField").getValue()},success:function(e){this.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){if(!Ext.isEmpty(Ext.getStore("sDruglogRemark"))){Ext.getStore("sDruglogRemark").load()}if(!Ext.isEmpty(this.getSuccessFn())&&Ext.isFunction(this.getSuccessFn())){this.getSuccessFn()(this.getCaller())}this.destroy()}h=null;delete h},failure:function(){this.setMasked(false);Ext.Msg.alert("存檔失敗")}});g=null;delete g;f=null;delete f},onMWNP_CancelBtnTap:function(b,d,a){this.destroy()},onPanelDestroy:function(a){if(Ext.getStore("sDruglogRemark")!=null){Ext.getStore("sDruglogRemark").removeAll();Ext.getStore("sDruglogRemark").destroy()}me=null;delete me;this.removeAll(true,true)},onPanelPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);NisTRApp.view.Management.WdisNotePanel.LoadWdisProgNotes(this.getRecord(),this.getDrugLog())}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getDrugLog())||Ext.isEmpty(this.getDrugLog().ProblemStr)||Ext.isEmpty(this.getDrugLog().OrddRid)){Ext.Msg.alert("WdisNotePanel 住院資料錯誤");return false}this.down("#MWNP_TitlePanel").setHtml('<div style="text-align:center; margin:7px auto;"><span style="font-bold;">'+this.getDrugLog().ExeRecord.replace("<br>"," ")+"</span><div>");if(Ext.getStore("sDruglogRemark")==null){Ext.create("Ext.data.Store",{storeId:"sDruglogRemark",model:"NisTRApp.model.Note.WdisprognoteEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/DruglogRemark.ashx",reader:{type:"json"}}})}Ext.getStore("sDruglogRemark").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sDruglogRemark").addListener("load",function(d,b,f,a,e){NisTRApp.view.Management.WdisNotePanel.RenderWdisProgNotes(this,this.getRecord(),this.getDrugLog());this.setMasked(false)},this)}});Ext.define("NisTRApp.view.Profile.Shift",{extend:Ext.Container,alias:"widget.PtShift",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"vbox"},items:[{xtype:"panel",flex:1,itemId:"PtShift_Main",scrollable:"vertical",items:[{xtype:"fieldset",itemId:"PtShift_HighRiskPanel",width:"50%",layout:{type:"hbox"},title:"高風險",items:[{xtype:"checkboxfield",flex:1,itemId:"PtShift_RiskFall",margin:"0 10 0 0",label:"跌倒",labelWidth:"50%"},{xtype:"checkboxfield",flex:1,itemId:"PtShift_RiskBeddore",margin:"0 10 0 0 ",label:"壓瘡",labelWidth:"50%"},{xtype:"checkboxfield",flex:1,itemId:"PtShift_RiskCath",margin:"0 5 0 0 ",label:"管路",labelWidth:"50%"}]},{xtype:"fieldset",layout:{type:"hbox"},items:[{xtype:"datepickerfield",flex:1,itemId:"PtShift_OpDate",label:"手術日期",labelWidth:"200px",value:{year:2015,month:4,day:30},placeHolder:"請選擇",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"PtShift_OpDateCancelBtn",margin:"5 5 5 5",ui:"plain"},{xtype:"datepickerfield",flex:1,itemId:"PtShift_ReOpDate",label:"再手術日期",labelWidth:"200px",value:{year:2015,month:4,day:30},placeHolder:"請選擇",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"PtShift_ReOpDateCancelBtn",margin:"5 5 5 5",ui:"plain"}]},{xtype:"fieldset",items:[{xtype:"textareafield",itemId:"PtShift_OpTreate",label:"術式",labelWidth:"150px",placeHolder:"請輸入",maxRows:6}]},{xtype:"fieldset",height:"1100px",items:[{xtype:"panel",layout:{type:"hbox"},items:[{xtype:"datepickerfield",flex:1,itemId:"PtShift_BmtDate",label:"BMT日期",labelWidth:"200px",value:{year:2015,month:4,day:30},placeHolder:"請選擇",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"PtShift_BmtDateCancelBtn",margin:"5 5 5 5",ui:"plain"}]},{xtype:"textfield",itemId:"PtShift_EmrInfo",label:"聯絡人/電話",labelWidth:"150px",placeHolder:"請輸入"},{xtype:"textfield",hidden:true,itemId:"PtShift_ShiftUserId",label:"交班人員",labelWidth:"150px",placeHolder:"系統預設",readOnly:true},{xtype:"textareafield",itemId:"PtShift_NurMemo",label:"交班事項",labelWidth:"150px",placeHolder:"請輸入",maxRows:42}]}]},{xtype:"toolbar",docked:"bottom",layout:{pack:"center",type:"hbox"},items:[{xtype:"button",itemId:"PtShift_Btn",ui:"confirm",width:"50%",text:"交 班 作 業 存 檔"}]}],listeners:[{fn:"onPtShift_OpDateCancelBtnTap",event:"tap",delegate:"#PtShift_OpDateCancelBtn"},{fn:"onPtShift_ReOpDateCancelBtnTap",event:"tap",delegate:"#PtShift_ReOpDateCancelBtn"},{fn:"onPtShift_BmtDateCancelBtnTap",event:"tap",delegate:"#PtShift_BmtDateCancelBtn"},{fn:"onPtShift_BtnTap",event:"tap",delegate:"#PtShift_Btn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onPtShift_OpDateCancelBtnTap:function(b,d,a){try{this.down("#PtShift_OpDate").setValue("")}catch(d){console.log(d)}},onPtShift_ReOpDateCancelBtnTap:function(b,d,a){try{this.down("#PtShift_ReOpDate").setValue("")}catch(d){console.log(d)}},onPtShift_BmtDateCancelBtnTap:function(b,d,a){try{this.down("#PtShift_BmtDate").setValue("")}catch(d){console.log(d)}},onPtShift_BtnTap:function(h,j,k){if(Ext.isEmpty(this.getRecord())){return false}var l=this;var q=this.getRecord();var a=l.down("#PtShift_RiskFall").isChecked()==true?"Y":"N";var f=l.down("#PtShift_RiskBeddore").isChecked()==true?"Y":"N";var b=l.down("#PtShift_RiskCath").isChecked()==true?"Y":"N";var o=l.down("#PtShift_OpDate").getFormattedValue("Ymd");var g=l.down("#PtShift_ReOpDate").getFormattedValue("Ymd");var d=l.down("#PtShift_BmtDate").getFormattedValue("Ymd");var m=encodeURIComponent(l.down("#PtShift_OpTreate").getValue());var p=encodeURIComponent(l.down("#PtShift_EmrInfo").getValue());var n=encodeURIComponent(l.down("#PtShift_NurMemo").getValue());l.setMasked({xtype:"loadmask",message:"Updateing..."});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"INP/action/ProfileUpdate.ashx",scope:this,method:"POST",params:{InpNo:q.data.InpNo,ChartNo:q.data.ChartNo,UserID:NisTRApp.view.SysUtility.GetUserID(),UpdatePage:2,RiskFall:a,RiskBedSore:f,RiskCath:b,OpDate:o,ReOpDate:g,BmtDate:d,OpTreat:m,EmrInfo:p,Memo:n},success:function(e){l.setMasked(false);var r=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(r.Message,(r.Success?800:0));if(r.Success){if(!Ext.isEmpty(Ext.getStore("sShiftPatNurDatm"))&&!Ext.getStore("sShiftPatNurDatm").isLoading()){Ext.getStore("sShiftPatNurDatm").load()}}r=null;delete r;l=null;delete l},failure:function(){l.setMasked(false);NisTRApp.view.Misc.Alert("存檔失敗",0);l=null;delete l}},this);q=null;delete q;a=null;delete a;f=null;delete f;b=null;delete b;o=null;delete o;g=null;delete g;d=null;delete d;m=null;delete m;p=null;delete p;n=null;delete n},onContainerDestroy:function(a){if(Ext.getStore("sShiftPatNurDatm")!=null){Ext.getStore("sShiftPatNurDatm").removeAll();Ext.getStore("sShiftPatNurDatm").destroy()}this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadNurdatm(this.getRecord(),this)}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().getIpbinp())){Ext.Msg.alert("PtShift 住院資料錯誤");return false}if(Ext.getStore("sShiftPatNurDatm")==null){Ext.create("Ext.data.Store",{storeId:"sShiftPatNurDatm",clearOnPageLoad:false,model:"NisTRApp.model.NUR.NurdatmEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"INP/Search/QueryNurdatm.ashx",reader:{type:"json"}}})}this.ResetPrfilePanel();Ext.getStore("sShiftPatNurDatm").addListener("beforeload",function(b,a,d){this.down("#PtShift_Main").setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sShiftPatNurDatm").addListener("load",function(d,b,f,a,e){if(!Ext.isEmpty(this.RenderNurdatm)&&Ext.isFunction(this.RenderNurdatm)){this.RenderNurdatm(this,this.getRecord())}this.down("#PtShift_Main").setMasked(false)},this);this.down("#PtShift_Main").setRecord(this.getRecord())},LoadNurdatm:function(b){if(Ext.getStore("sShiftPatNurDatm").isLoading()||Ext.isEmpty(b)){return}var a=Ext.getStore("sShiftPatNurDatm");a.removeAll();a.getProxy().setExtraParams({InpNo:b.data.InpNo});a.load();a=null;delete a},ResetPrfilePanel:function(){try{this.down("#PtShift_RiskFall").uncheck();this.down("#PtShift_RiskBeddore").uncheck();this.down("#PtShift_RiskCath").uncheck();this.down("#PtShift_BmtDate").setLabel("BMT日期");this.down("#PtShift_ReOpDate").setLabel("再手術日期");this.down("#PtShift_OpDate").setLabel("手術日期");this.down("#PtShift_OpDate").setValue("");this.down("#PtShift_OpTreate").setValue("");this.down("#PtShift_ReOpDate").setValue("");this.down("#PtShift_BmtDate").setValue("");this.down("#PtShift_EmrInfo").setValue("");this.down("#PtShift_NurMemo").setValue("");this.down("#PtShift_ShiftUserId").setValue("")}catch(a){console.log(a)}},RenderNurdatm:function(a,h){if(Ext.isEmpty(a)||Ext.isEmpty(a.down("#PtShift_Main"))){return false}a.ResetPrfilePanel();var f=Ext.getStore("sShiftPatNurDatm");var g=a.down("#PtShift_Main");if(f.getCount()>0){if(!Ext.isEmpty(f.getAt(0))){var b=f.getAt(0).data;if(b.RiskFall=="Y"){g.down("#PtShift_RiskFall").check()}else{g.down("#PtShift_RiskFall").uncheck()}if(b.RiskBedSore=="Y"){g.down("#PtShift_RiskBeddore").check()}else{g.down("#PtShift_RiskBeddore").uncheck()}if(b.RiskCath=="Y"){g.down("#PtShift_RiskCath").check()}else{g.down("#PtShift_RiskCath").uncheck()}var d=NisTRApp.view.DateUtil.GetOpCount(b.OpDate);var j=NisTRApp.view.DateUtil.GetOpCount(b.ReOpDate);var e=NisTRApp.view.DateUtil.GetOpCount(b.BmtDate);g.down("#PtShift_OpDate").setValue(b.OpDateTime);if(!Ext.isEmpty(d)){g.down("#PtShift_OpDate").setLabel("手術日期 (Day "+d+")")}else{g.down("#PtShift_OpDate").setLabel("手術日期")}if(!Ext.isEmpty(b.OpTreat)&&"null"!=b.OpTreat){g.down("#PtShift_OpTreate").setValue(decodeURIComponent(b.OpTreat))}if(Ext.isEmpty(b.OpDate)){if(!Ext.isEmpty(a.LoadPgvOprm)&&Ext.isFunction(a.LoadPgvOprm)){a.LoadPgvOprm(h,h.getIpbinp(),a)}}g.down("#PtShift_ReOpDate").setValue(b.ReOpDateTime);if(""!=j){g.down("#PtShift_ReOpDate").setLabel("再手術日期 (Day "+j+")")}else{g.down("#PtShift_ReOpDate").setLabel("再手術日期")}if(""!=e){g.down("#PtShift_BmtDate").setLabel("BMT日期 (Day "+e+")")}else{g.down("#PtShift_BmtDate").setLabel("BMT日期")}g.down("#PtShift_BmtDate").setValue(b.BmtDateTime);g.down("#PtShift_EmrInfo").setValue(b.EmrInfo);if(!Ext.isEmpty(b.Memo)&&"null"!=b.Memo){g.down("#PtShift_NurMemo").setValue(decodeURIComponent(b.Memo))}b=null;delete b;d=null;delete d;j=null;delete j;e=null;delete e}}else{if(!Ext.isEmpty(a.LoadPgvOprm)&&Ext.isFunction(a.LoadPgvOprm)){a.LoadPgvOprm(h,h.getIpbinp(),a)}}f=null;delete f;g=null;delete g},LoadPgvOprm:function(f,b,a){if(Ext.isEmpty(f)||Ext.isEmpty(b)||Ext.isEmpty(a)||Ext.getStore("sShiftPatNurDatm").isLoading()){return false}try{Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/search/QueryOprmst.ashx",scope:a,method:"POST",params:{OprmDate:b.data.INDate,ChartNo:f.data.ChartNo},success:function(g){try{if(!Ext.isEmpty(g)&&!Ext.isEmpty(g.responseText)){var l=Ext.decode(g.responseText);if(!Ext.isEmpty(l.OprmDate)){var e=l.OprmDate;var m=new Date(parseInt(e.substr(0,4),10),parseInt(e.substr(4,2),10)-1,parseInt(e.substr(6,2),10));var j=NisTRApp.view.DateUtil.GetOpCount(l.OprmDate);a.down("#PtShift_OpDate").setValue(m);if(!Ext.isEmpty(j)){a.down("#PtShift_OpDate").setLabel("手術日期 (Day"+j+")")}else{a.down("#PtShift_OpDate").setLabel("手術日期")}var k="";if(!Ext.isEmpty(l.BefOperName1)){k=k+l.BefOperName1+"\r\n"}if(!Ext.isEmpty(l.BefOperName2)){k=k+l.BefOperName2+"\r\n"}k=k+l.BefOper_1;a.down("#PtShift_OpTreate").setValue(k);k=null;delete k;e=null;delete e;j=null;delete j;m=null;delete m}l=null;delete l}}catch(h){console.log(d)}},failure:function(e){console.log(e)}})}catch(d){console.log(d)}}});Ext.define("NisTRApp.view.WorkList.OPR.MyPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"WLOMP_MianPanel"},{xtype:"toolbar",docked:"top",items:[{xtype:"textfield",itemId:"WLOMP_UserId",width:260,label:"員工編號"},{xtype:"button",itemId:"WLOMP_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]}],listeners:[{fn:"onWLOMP_QueryBtnTap",event:"tap",delegate:"#WLOMP_QueryBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onWLOMP_QueryBtnTap:function(b,d,a){this.LoadMyPatients(this.down("#WLOMP_UserId").getValue())},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadMyPatients(this.down("#WLOMP_UserId").getValue())}},onContainerDestroy:function(a){if(Ext.getStore("sOprOnlyMyPatients")!=null){Ext.getStore("sOprOnlyMyPatients").removeAll();Ext.getStore("sOprOnlyMyPatients").destroy()}this.removeAll(true,true)},initialize:function(){this.callParent();this.down("#WLOMP_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());if(Ext.isEmpty(Ext.getStore("sOprOnlyMyPatients"))){Ext.create("Ext.data.Store",{storeId:"sOprOnlyMyPatients",clearOnPageLoad:false,model:"NisTRApp.model.OPR.OprmstvEntity",timeout:30000,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprPatients.ashx",reader:{type:"json"}}})}var a=this;var d=Ext.getCmp("OPR_MyPatients");if(d==null){d=NisTRApp.view.GridUtility.GenOPRMyPatientGrid("OPR_MyPatients","我的手術病人",null,true);d.getTitleBar().hide();var b=Ext.create("Ext.grid.column.Template",{text:"刪除",align:"center",cls:"gridMediumFont",itemId:"delMyPatient",tpl:Ext.create("Ext.XTemplate",'<img id="{[this.imgId(values.UserID)]}_IMG_{KeyOne}" src="{[this.imgPath(values.UserID)]}" alt="Smiley face" height="50"" width="50"">',{imgPath:function(f){if(!String.IsNull(f)&&(f==NisTRApp.view.SysUtility.GetUserID())){return"../_/img/Error.png"}else{return"../_/img/empty.png"}},imgId:function(f){if(!String.IsNull(f)&&(f==NisTRApp.view.SysUtility.GetUserID())){return"OPRDELMYPATIENT"}else{return"XXXXX"}}}),width:70,hidden:false,sortable:false,flex:1});d.setColumns([b]);var e=Ext.getStore("sOprOnlyMyPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapOPRGrid,d);this.down("#WLOMP_MianPanel").add(d);d=null;delete d;b=null;delete b}a=null;delete a},LoadMyPatients:function(a){if(Ext.getStore("sOprOnlyMyPatients").isLoading()){return}Ext.getStore("sOprOnlyMyPatients").removeAll();if(Ext.isEmpty(a)){return}var b=Ext.getStore("sOprOnlyMyPatients");b.getProxy().setExtraParams({UserID:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.IPD.InpInformationPanel",{extend:Ext.Panel,config:{height:"100%",width:"100%",layout:{type:"vbox"},scrollable:false,items:[{xtype:"formpanel",flex:1.6,layout:{type:"fit"},scrollable:false,items:[{xtype:"fieldset",itemId:"IPDINPPATINFO_PatInfoPanel",layout:{align:"start",type:"hbox"},scrollable:"vertical",items:[{xtype:"panel",flex:1,items:[{xtype:"textfield",id:"IPDINPPATINFO_PatName",label:"病人姓名",labelWidth:"102px",name:"PatName",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_PatIdNo",label:"身分證號",labelWidth:"102px",name:"PatIdNo",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_INDate",label:"入院日期",labelWidth:"102px",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_NowBedno",label:"目前床位",labelWidth:"102px",name:"NowBedno",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_OpDate",label:"手術日期",labelWidth:"102px",name:"OpDate",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_ICUDate",label:"ICU日期",labelWidth:"102px",name:"ICUDate",readOnly:true}]},{xtype:"panel",flex:1,items:[{xtype:"textfield",itemId:"IPDINPPATINFO_Birthday",label:"生日",labelWidth:"102px",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_ChartNo",label:"病歷流水號",labelWidth:"102px",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_NowDocName",label:"主治醫師",labelWidth:"102px",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_InpNo",label:"住院號",labelWidth:"102px",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_ReOpDate",label:"再手術日期",labelWidth:"102px",readOnly:true},{xtype:"textfield",itemId:"IPDINPPATINFO_BmtDate",label:"BMT日期",labelWidth:"102px",readOnly:true}]}]}]},{xtype:"panel",flex:1,itemId:"IPDINPPATINFO_HighRiskPanel",layout:{type:"fit"},scrollable:"vertical"}],listeners:[{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelShow",event:"show"},{fn:"onPanelHide",event:"hide"}]},onPanelDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sPatInformation"))){Ext.getStore("sPatInformation").removeAll();Ext.getStore("sPatInformation").destroy()}if(!Ext.isEmpty(Ext.getStore("sInpInfoPatNurDatm"))){Ext.getStore("sInpInfoPatNurDatm").removeAll();Ext.getStore("sInpInfoPatNurDatm").destroy()}this.removeAll()},onPanelShow:function(a,b){if(Ext.getStore("sPatInformation").getCount()<=0){this.LoadPatInformation();this.LoadNurDatm()}},onPanelHide:function(a,b){},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)||Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("IPBD_Notes 病人資料錯誤");return}if(Ext.isEmpty(Ext.getStore("sPatInformation"))){Ext.create("Ext.data.Store",{storeId:"sPatInformation",autoLoad:false,model:"NisTRApp.model.InpPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/QueryInpPatient.ashx",reader:{type:"json"}}})}Ext.getStore("sPatInformation").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sPatInformation").addListener("load",function(d,b,f,a,e){this.RenderInfo(this,this.getRecord(),"sPatInformation");this.setMasked(false)},this);if(Ext.getStore("sInpInfoPatNurDatm")==null){Ext.create("Ext.data.Store",{storeId:"sInpInfoPatNurDatm",clearOnPageLoad:false,model:"NisTRApp.model.NUR.NurdatmEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"INP/Search/QueryNurdatm.ashx",reader:{type:"json"}}})}Ext.getStore("sInpInfoPatNurDatm").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpInfoPatNurDatm").addListener("load",function(d,b,f,a,e){this.RenderInfo(this,this.getRecord(),"sInpInfoPatNurDatm");this.setMasked(false)},this)},LoadPatInformation:function(){if(Ext.getStore("sPatInformation").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sPatInformation");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNo});a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b},LoadNurDatm:function(){if(Ext.getStore("sInpInfoPatNurDatm").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sInpInfoPatNurDatm");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.data.ChartNo,InpNo:b.data.InpNo});a.load({callback:function(e,d,f){},scope:this});a=null;delete a;b=null;delete b},RenderInfo:function(A,h,e){if(Ext.isEmpty(A)||Ext.isEmpty(A.down("#IPDINPPATINFO_PatInfoPanel"))){return false}var k=A.down("#IPDINPPATINFO_PatInfoPanel");if(e=="sPatInformation"){A.down("#IPDINPPATINFO_HighRiskPanel").setHtml("");k.down("#IPDINPPATINFO_PatName").setValue("");k.down("#IPDINPPATINFO_PatIdNo").setValue("");k.down("#IPDINPPATINFO_INDate").setValue("");k.down("#IPDINPPATINFO_NowBedno").setValue("");k.down("#IPDINPPATINFO_ICUDate").setValue("");k.down("#IPDINPPATINFO_Birthday").setValue("");k.down("#IPDINPPATINFO_ChartNo").setValue("");k.down("#IPDINPPATINFO_NowDocName").setValue("");k.down("#IPDINPPATINFO_InpNo").setValue("");var q=Ext.getStore("sPatInformation");if(q.getCount()>0){if(!Ext.isEmpty(A)&&!Ext.isEmpty(A.down("#IPDINPPATINFO_PatInfoPanel"))){if(!Ext.isEmpty(q.getAt(0))){var p,C,g,u;var z=q.getAt(0).data;var d=q.getAt(0).getIpbinp().data;C=NisTRApp.view.DateUtil.GetDayCount(d.INDate);if(""!=C){p=d.INDate+" (day "+C+")"}else{p=""}u=(d.NowStationno=="02A"?NisTRApp.view.DateUtil.GetDayCount(d.TurnInDate):"");if(""!=u){g=d.TurnInDate+" (day "+u+")"}else{g=""}k.down("#IPDINPPATINFO_PatName").setValue(z.PatName);k.down("#IPDINPPATINFO_PatIdNo").setValue(z.PatIdNo);k.down("#IPDINPPATINFO_INDate").setValue(p);k.down("#IPDINPPATINFO_NowBedno").setValue(d.NowStationno+"-"+d.NowBedno);k.down("#IPDINPPATINFO_ICUDate").setValue(g);k.down("#IPDINPPATINFO_Birthday").setValue(z.Birthday+" ("+z.Age+")");k.down("#IPDINPPATINFO_ChartNo").setValue(z.ChartNo);k.down("#IPDINPPATINFO_NowDocName").setValue("Dr."+d.NowDocName1+" / "+d.NowDocName2);k.down("#IPDINPPATINFO_InpNo").setValue(z.InpNo);p=null;delete p;C=null;delete C;g=null;delete g;u=null;delete u;d=null;delete d;var m="";var s="",w="",b="",r="";var a=q.getAt(0).Hemdatvs().data.items;if(a){for(var B=0;B<a.length;B++){var l=a[B].data;switch(l.SourceName){case"診斷":if(z.Risk!=""){s+="<tr><th>診斷</th><td>"+l.CreName+"</td><td>&nbsp;"+l.CreDate+"&nbsp;</td><td>&nbsp;"+l.Report+"&nbsp;</td></tr>"}highRiskFlag="color:white;";break;case"過敏":if(z.IsAllergy==true){w+="<tr><th>過敏</th><td>"+l.CreUser+"</td><td>&nbsp;"+l.CreDate+"&nbsp;</td><td>&nbsp;"+l.Report+"&nbsp;</td></tr>"}break;case"感染":if(z.IcdType!=""){b+="<tr><th>感染</th><td colspan=3>&nbsp;"+l.Report+"&nbsp;</td></tr>"}break;case"自傷史":if(z.Suicide!=""){r+="<tr><th>自傷</th><td colspan=3>&nbsp;"+l.Report+"&nbsp;</td></tr>"}break;default:break}l=null;delete l}}m+='<div class="globalList"><table style="width:100%;margin:0 0 0 0;padding:0 0 0 0;"><thead><tr><th colspan=4>病人高風險註記內容</th></thead>';m+="<tbody>";m+=w;m+=r;m+=b;m+=s;m+="</tbody></table>";m+="</div>";A.down("#IPDINPPATINFO_HighRiskPanel").setHtml(m);z=null;delete z;a=null;delete a;m=null;delete m;s=null;delete s;w=null;delete w;b=null;delete b;r=null;delete r}}}q=null;delete q}else{if(e=="sInpInfoPatNurDatm"){k.down("#IPDINPPATINFO_OpDate").setValue("");k.down("#IPDINPPATINFO_ReOpDate").setValue("");k.down("#IPDINPPATINFO_BmtDate").setValue("");var y=Ext.getStore("sInpInfoPatNurDatm");if(y.getCount()>0){if(!Ext.isEmpty(A)&&!Ext.isEmpty(A.down("#IPDINPPATINFO_PatInfoPanel"))){if(!Ext.isEmpty(y.getAt(0))){var x,v,f,n,o,D;var z=y.getAt(0).data;x=NisTRApp.view.DateUtil.GetOpCount(z.OpDate);if(""!=x){n=(z.OpDate+" (day "+x+")")}else{n=""}v=NisTRApp.view.DateUtil.GetOpCount(z.ReOpDate);if(""!=v){o=(z.ReOpDate+" (day "+v+")")}else{o=""}f=NisTRApp.view.DateUtil.GetOpCount(z.BmtDate);if(""!=f){D=(z.BmtDate+" (day "+f+")")}else{D=""}k.down("#IPDINPPATINFO_OpDate").setValue(n);k.down("#IPDINPPATINFO_ReOpDate").setValue(o);k.down("#IPDINPPATINFO_BmtDate").setValue(D);x=null;delete x;v=null;delete v;f=null;delete f;n=null;delete n;o=null;delete o;D=null;delete D}}}y=null;delete y}}k=null;delete k}});Ext.define("NisTRApp.view.WorkList.ENDO",{extend:Ext.Container,alias:"widget.WL_ENDO",config:{layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"WL_ENDO_TabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){console.log("On Destroy :","WorkList.ENDO");this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.down("#_endoInPatientList"))){var b=Ext.create("NisTRApp.view.WorkList.ENDO.InPatientList",{id:"_endoInPatientList",itemId:"_endoInPatientList",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"內視鏡清單"});this.down("#WL_ENDO_TabPanel").add(b);b=null;delete b;var d=Ext.create("NisTRApp.view.WorkList.EDNO.CareContainer",{id:"_endoCareContainer",itemId:"_endoCareContainer",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"追蹤病人"});this.down("#WL_ENDO_TabPanel").add(d);d=null;delete d;var e=Ext.create("NisTRApp.view.WorkList.ENDO.ObservedPatient",{id:"_endoObservedPatient",itemId:"_endoObservedPatient",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"留觀病人"});this.down("#WL_ENDO_TabPanel").add(e);e=null;delete e;var a=Ext.create("NisTRApp.view.WorkList.IPB.InPatients",{id:"_endoIPBInPatients",itemId:"_endoIPBInPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"住院病人"});this.down("#WL_ENDO_TabPanel").add(a);a=null;delete a}}});Ext.define("NisTRApp.view.Sys.SysInfoPanel",{extend:Ext.Panel,statics:{onCheckboxChange:function(a,e,b,d){}},config:{centered:true,height:320,width:480,hideOnMaskTap:true,layout:{type:"fit"},modal:true,items:[{xtype:"tabpanel",itemId:"SYSINFO_MainTab",tabBar:{docked:"bottom"},items:[{xtype:"panel",title:"首頁",iconCls:"settings",itemId:"SYSINFO_DefaultPagePanel",layout:{type:"vbox"},items:[{xtype:"fieldset",flex:1,itemId:"SYSINFO_DefaultPageSet",scrollable:"vertical",title:'首頁設定<img src="../_/img/save01.png" id="_sysDefaultPageSaveImg" style="width:30px;height:30px;"/>'}]},{xtype:"panel",title:"系統資訊",iconCls:"info"}]}],listeners:[{fn:"onPanelHide",event:"hide"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelPainted",event:"painted"}]},onPanelHide:function(a,b){this.destroy()},onPanelDestroy:function(a){console.log("On Destroy :","Sys.SysInfoPanel");this.removeAll(true,true)},onPanelPainted:function(d,b){var a=NisTRApp.view.SysUtility.tapEventName();$("#_sysDefaultPageSaveImg").unbind(a);$("#_sysDefaultPageSaveImg").bind(a,{caller:this,fieldSet:this.down("#SYSINFO_DefaultPageSet")},function(g){try{if(!Ext.isEmpty(g.data.fieldSet)){var f=g.data.fieldSet.items;if(null!=f){f.each(function(j,e,h){if(j.xtype=="checkboxfield"&&j.isChecked()){NisTRApp.view.UserConfig.SaveUserConfig(NisTRApp.view.SysUtility.GetUserID(),"SYSControl","DEFAULT_PAGE",j.getValue(),g.data.caller,function(k){NisTRApp.view.Misc.Alert((k?"設定成功":"設定失敗"),(k?900:0))})}})}f=null;delete f}}catch(g){console.log(g)}});a=null;delete a},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.UserID)||(this.getRecord().data.UserID!=NisTRApp.view.SysUtility.GetUserID())){Ext.Msg.alert("使用者資料錯誤");return false}var a=NisTRApp.view.UserConfig.GetDefaultPage();for(var d in SYS_CONST.FunctionType){if(SYS_CONST.FunctionType[d].IsFunction){var b=Ext.create("Ext.field.Checkbox",{name:d,label:SYS_CONST.FunctionType[d].Description,value:SYS_CONST.FunctionType[d],checked:(a.Name==d?true:false)});b.addListener("change",NisTRApp.view.Sys.SysInfoPanel.onCheckboxChange,b);this.down("#SYSINFO_DefaultPageSet").add(b);b=null;delete b}}NisTRApp.view.Misc.SigleSelectFn(this.down("#SYSINFO_DefaultPageSet"));a=null;delete a}});Ext.define("NisTRApp.view.WorkList.RIS",{extend:Ext.Container,alias:"widget.WL_RIS",config:{layout:{type:"fit"},items:[{xtype:"tabpanel",hidden:false,itemId:"WL_RIS_TabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){if(Ext.getStore("sRisPatients")!=null){Ext.getStore("sRisPatients").removeAll();Ext.getStore("sRisPatients").destroy()}if(Ext.getStore("sEXAMROOM_B1")!=null){Ext.getStore("sEXAMROOM_B1").removeAll();Ext.getStore("sEXAMROOM_B1").destroy()}if(Ext.getStore("sModQueue")!=null){Ext.getStore("sModQueue").removeAll();Ext.getStore("sModQueue").destroy()}console.log("On Destroy :","WorkList.RIS");this.removeAll(true,true)},initialize:function(){this.callParent();this.initialModel();if(Ext.getStore("sEXAMROOM_B1")==null){Ext.create("Ext.data.Store",{storeId:"sEXAMROOM_B1",model:"RisRoom",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{PreExamDate:new Date()},url:SYS_CONST.ApiRoot+"RIS/search/QueryActRoom.ashx",reader:{type:"json"}}})}if(Ext.getStore("sModQueue")==null){Ext.create("Ext.data.Store",{storeId:"sModQueue",model:"ModQueue",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{PreExamDate:new Date()},url:SYS_CONST.ApiRoot+"RIS/search/QueryActModQueue.ashx",reader:{type:"json"}}})}if(Ext.getStore("sRisPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.RIS.SchuleData",storeId:"sRisPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryRisPatients.ashx",reader:{type:"json"}}})}this.setMasked({xtype:"loadmask",message:"拼命載入中，請稍候..."});Ext.getStore("sEXAMROOM_B1").load({callback:function(b,a,d){Ext.getStore("sModQueue").load({callback:function(g,f,k){if(Ext.isEmpty(this.down("#_risPatientListB1"))){var j=Ext.create("NisTRApp.view.WorkList.RIS.PatientList_B1",{id:"_risPatientListB1",itemId:"_risPatientListB1",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"放診清單"});this.down("#WL_RIS_TabPanel").add(j);j=null;delete j}if(Ext.isEmpty(this.down("#_risContactPatient"))){var h=Ext.create("NisTRApp.view.WorkList.RIS.ContactPatient",{id:"_risContactPatient",itemId:"_risContactPatient",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"追蹤病人"});this.down("#WL_RIS_TabPanel").add(h);h=null;delete h}if(Ext.isEmpty(this.down("#_risObservedPatient"))){var e=Ext.create("NisTRApp.view.WorkList.RIS.ObservedPatient",{id:"_risObservedPatient",itemId:"_risObservedPatient",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"留觀病人"});this.down("#WL_RIS_TabPanel").add(e);e=null;delete e}this.setMasked(false)},scope:this})},scope:this})},initialModel:function(){if(Ext.data.ModelManager.getModel("ModQueue")==null){Ext.define("ModQueue",{extend:Ext.data.Model,config:{fields:[{name:"ModQueueID",type:"string"},{name:"ModQueueName",type:"string"},{name:"ModTypeID",type:"string"},{name:"RoomID",type:"string"},{name:"ModQueueLocation",type:"string"},{name:"Aliases",type:"string"}]}})}if(Ext.data.ModelManager.getModel("RisRoom")==null){Ext.define("RisRoom",{extend:Ext.data.Model,config:{fields:[{name:"RoomName",type:"string"},{name:"RoomIndex",type:"string"}]}})}}});Ext.define("NisTRApp.view.OuterLink.ENDO.OprForm",{extend:Ext.Container,statics:{RenderFrmTable:function(e,l){if(Ext.getStore("sFrmTData").isLoading()||Ext.isEmpty(e)){return}var k=Ext.getStore("sFrmTData");e.down("#ENDOOF_DataPanel").setHtml("");if(k.getCount()>0){var f=k.getAt(0);e.down("#ENDOOF_DataPanel").setHtml("");var g="";var d=$('<div id="_endoFrmData" class="globalList"></div>');$('<asp:HiddenField ID="hdf_id" runat="server" />').appendTo(d);$('<asp:HiddenField ID="hdf_TprCode" runat="server" />').appendTo(d);var h=300;var m=(f.raw.tHeard.length+1)*h;var a=$('<table id="_endoFrmDataTable" style="width:'+m+'px" ></table>');var j;j=String.format('<thead><tr><th colspan="{0}" style=" font-size:24px"><div  style="float:left;">【病人姓名：{3}】 {1}{2}</div></th></tr>',f.raw.tHeard.length+1,f.data.Title,(Ext.isEmpty(f.data.SubTitle)?"":("</br></br>"+f.data.SubTitle)),f.data.PatName);j+='<tr> <th style="width:200px">項目</th>';f.raw.tHeard.forEach(function b(o,n,p){j+=String.format('<th  style="width:{0}px">{1}</br>{2}</th>',h,o.MedicalDate.substring(0,16).replace("T"," "),o.UserName)});j+="</tr></thead>";a.append(j);a.append("<tbody>");f.raw.tRows.forEach(function b(s,q,u){var n='<td style="width:200px;font-weight: bolder; background-color: LightYellow;">'+NisTRApp.view.Misc.htmlDecode(s.Title)+"</td>";var r="";var p=1;s.Cells.forEach(function o(v,w,x){r+=String.format('<td style="width:{1}px; background-color:{2};">{0}</td>',NisTRApp.view.Misc.htmlDecode(v.Value),h,(p%2==0?"LightCyan ":""));p=p+1});a.append("<tr>"+n+r+"</tr>");n=null;delete n;r=null;delete r;p=null;delete p});a.append("</tbody>");a.appendTo(d);e.down("#ENDOOF_DataPanel").setHtml(d[0].outerHTML);g=null;delete g;a=null;delete a;j=null;delete j;h=null;delete h;m=null;delete m;d=null;delete d;f=null;delete f}else{e.down("#ENDOOF_DataPanel").setHtml('<div style="width:auto; text-align:center; padding-bottom:50%; color:red; font-weight:bold;">無資料.</div>')}e=null;delete e;k=null;delete k;one=null;delete one}},config:{height:"100%",width:"100%",layout:{type:"fit"},urlInfo:{},items:[{xtype:"toolbar",docked:"top",height:55,itemId:"ENDOOF_TitleBar",items:[{xtype:"button",html:"<h1> User Info </h1>",itemId:"ENDOOF_UsetInfoBtn",right:"10px",width:"150px",iconCls:"user",text:"MyButton2"},{xtype:"label",html:"Patient Name",itemId:"ENDOOF_PtNameLbl",left:"30px",tpl:Ext.create("Ext.XTemplate","<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="110px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="280px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"    {BirthdayStr} ({Age}) {BloodType} &nbsp;","</span>",'<span style="font-weight: bold;color:red; font-size: 13px;">',"    {[this.IsMutiBloodStr(values.IsMutiBlood)]}&nbsp;","</span>",' <br style="line-height:0.1;">   ','<span style="font-weight: bold;color:#ff66ff; font-size: 13px;">',"    病歷號. {ChartNo}","</span>","</td>","</tr>","</table>","","","","",{IsMutiBloodStr:function(b){var a="";if(b==true){a="(多)"}return a}})}]},{xtype:"panel",itemId:"ENDOOF_Main",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"top",itemId:"ENDOOF_FnBar",items:[{xtype:"selectfield",itemId:"ENDOOF_SelectField",width:"300px",label:"護理評估",displayField:"Title",valueField:"FormID"},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"400px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"ENDOOF_BegDate",width:"55%",label:"日期",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2012,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"ENDOOF_EndDate",width:"45%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"ENDOOF_RefreshBtn",ui:"decline",width:"90px",iconCls:"refresh",text:"查詢"}]},{xtype:"panel",flex:1,itemId:"ENDOOF_DataPanel",scrollable:"both"}]}],listeners:[{fn:"onENDOOF_UsetInfoBtnTap",event:"tap",delegate:"#ENDOOF_UsetInfoBtn"},{fn:"onENDOOF_RefreshBtnTap",event:"tap",delegate:"#ENDOOF_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"}]},onENDOOF_UsetInfoBtnTap:function(b,d,a){var f=String.format("員工編號：{0} </br> 員工姓名：{1} </br>",this.getRecord().data.UserID,this.getRecord().data.UserName);NisTRApp.view.Misc.MsgShow(f,"",5000);f=null;delete f},onENDOOF_RefreshBtnTap:function(b,d,a){this.LoadData(this.down("#ENDOOF_SelectField").getValue())},onContainerDestroy:function(a){if(Ext.getStore("sFrmTData")!=null){Ext.getStore("sFrmTData").removeAll();Ext.getStore("sFrmTData").destroy()}if(Ext.getStore("sFrmForm_9527")!=null){Ext.getStore("sFrmForm_9527").removeAll();Ext.getStore("sFrmForm_9527").destroy()}console.log("On Destroy:","ENDO.OprForm");this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.isEmpty(this.getUrlInfo())||Ext.isEmpty(this.getUrlInfo().ChartNo)||Ext.isEmpty(this.getUrlInfo().formid)||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.UserID)){Ext.Msg.alert("連結資料錯誤");throw"連結資料錯誤";return false}if(Ext.isEmpty(Ext.getStore("sMedPatient"))){Ext.create("Ext.data.Store",{storeId:"sMedPatient",clearOnPageLoad:false,model:"NisTRApp.model.Reg.RegPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{ChartNo:this.getUrlInfo().ChartNo},url:SYS_CONST.ApiRoot+"Search/QueryMedPatient.ashx",reader:{type:"json"}}})}Ext.getStore("sMedPatient").addListener("load",function(h,g,k,f,j){this.down("#ENDOOF_PtNameLbl").setRecord(g[0])},this);this.LoadPatData(this.getUrlInfo().ChartNo);if(Ext.data.ModelManager.getModel("mFrmForm_9527")==null){Ext.define("mFrmForm_9527",{extend:Ext.data.Model,config:{fields:[{name:"OpenRecordID",type:"string"},{name:"Title",type:"string"},{name:"FunctionType",type:"string"},{name:"FormID",type:"string"},{name:"OrderNO",type:"string"}]}})}if(Ext.isEmpty(Ext.getStore("sFrmForm_9527"))){Ext.create("Ext.data.Store",{storeId:"sFrmForm_9527",clearOnPageLoad:false,model:"mFrmForm_9527",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{ChartNo:this.getUrlInfo().ChartNo,FunctionType:"Assessment"},url:SYS_CONST.ApiRoot+"Form/FrmFormByPatient.ashx",reader:{type:"json"}}})}this.down("#ENDOOF_SelectField").setStore(Ext.getStore("sFrmForm_9527"));this.down("#ENDOOF_UsetInfoBtn").setText(this.getRecord().data.UserName);var b=new Date();if(!Ext.isEmpty(this.getUrlInfo().bdate)){b=NisTRApp.view.DateUtil.StrToDateTime(this.getUrlInfo().bdate)}var a=new Date();if(!Ext.isEmpty(this.getUrlInfo().edate)){a=NisTRApp.view.DateUtil.StrToDateTime(this.getUrlInfo().edate)}var e=this.getUrlInfo().ChartNo;var d=this.getUrlInfo().formid;this.down("#ENDOOF_BegDate").setValue(b);this.down("#ENDOOF_EndDate").setValue(a);if(Ext.data.ModelManager.getModel("mFrmTHeader")==null){Ext.define("mFrmTHeader",{extend:Ext.data.Model,config:{fields:[{name:"OpenRecordID",type:"string"},{name:"MasterID",type:"string"},{name:"Title",type:"string"},{name:"SubTitle",type:"string"},{name:"FormID",type:"string"},{name:"EditionID",type:"string"},{name:"ChartNO",type:"string"},{name:"InpNO",type:"string"},{name:"UserID",type:"string"},{name:"UserName",type:"string"},{name:"ChartSeq",type:"int"},{name:"MedicalDate",type:"date"},{name:"CreateDate",type:"date"}]}})}if(Ext.data.ModelManager.getModel("mFrmTCell")==null){Ext.define("mFrmTCell",{extend:Ext.data.Model,config:{fields:[{name:"LifeSystemID",type:"string"},{name:"MasterID",type:"string"},{name:"Value",type:"string"}]}})}if(Ext.data.ModelManager.getModel("mFrmTRow")==null){Ext.define("mFrmTRow",{extend:Ext.data.Model,config:{fields:[{name:"LifeSystemID",type:"string"},{name:"OrderNO",type:"int"},{name:"Title",type:"string"}],hasMany:{associatedName:"Cells",associationKey:"Cells",model:"mFrmTCell",name:"Cells"}}})}if(Ext.data.ModelManager.getModel("mFrmTTable")==null){Ext.define("mFrmTTable",{extend:Ext.data.Model,config:{fields:[{name:"Title",type:"string"},{name:"PatName",type:"string"}],hasMany:{associatedName:"tHeard",associationKey:"tHeard",model:"mFrmTHeader",name:"tHeard"},hasMany:{associatedName:"tRows",associationKey:"tRows",model:"mFrmTRow",name:"tRows"}}})}if(Ext.isEmpty(Ext.getStore("sFrmTData"))){Ext.create("Ext.data.Store",{storeId:"sFrmTData",clearOnPageLoad:false,model:"mFrmTTable",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{ChartNo:e,BegDate:b,EndDate:a,FormID:d},url:SYS_CONST.ApiRoot+"Form/Frm_FormRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sFrmTData").addListener("beforeload",function(g,f,h){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sFrmTData").addListener("load",function(h,g,k,f,j){NisTRApp.view.OuterLink.ENDO.OprForm.RenderFrmTable(this);this.setMasked(false)},this);Ext.getStore("sFrmForm_9527").addListener("load",function(h,g,k,f,j){this.down("#ENDOOF_SelectField").setValue(this.getUrlInfo().formid);this.LoadData(this.getUrlInfo().formid)},this);Ext.getStore("sFrmForm_9527").load();e=null;delete e;d=null;delete d;b=null;delete b;a=null;delete a},LoadPatData:function(d){if(Ext.isEmpty(this.getUrlInfo())){return}if(Ext.isEmpty(this.getUrlInfo().ChartNo)){return}if(Ext.getStore("sMedPatient").isLoading()){return}var b=this.getUrlInfo();var a=Ext.getStore("sMedPatient");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.ChartNo});a.load();a=null;delete a;b=null;delete b},LoadData:function(d){if(Ext.isEmpty(this.getUrlInfo())){return}if(Ext.isEmpty(this.getUrlInfo().ChartNo)||Ext.isEmpty(this.getUrlInfo().formid)){return}if(Ext.getStore("sFrmTData").isLoading()){return}var b=this.getUrlInfo();var a=Ext.getStore("sFrmTData");a.removeAll();a.getProxy().setExtraParams({ChartNo:b.ChartNo,BegDate:this.down("#ENDOOF_BegDate").getValue(),EndDate:this.down("#ENDOOF_EndDate").getValue(),FormID:d});a.load();a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.WorkList.RIS.PatientList_B1",{extend:Ext.Container,alias:"widget.RIS_PatientList_B1",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onRIS_RoomsFieldsChange",event:"change",delegate:"#RIS_RoomsFields"},{fn:"onWL_RIS_BI_ModQueueListChange",event:"change",delegate:"#WL_RIS_BI_ModQueueList"},{fn:"onRIS_B1_PreexamDatePickerChange",event:"change",delegate:"#RIS_B1_PreexamDatePicker"},{fn:"onRIS_B1_AllBtnTap",event:"tap",delegate:"#RIS_B1_AllBtn"},{fn:"onRIS_B1_NoArrBtnTap",event:"tap",delegate:"#RIS_B1_NoArrBtn"},{fn:"onRIS_B1_ArrBtnTap",event:"tap",delegate:"#RIS_B1_ArrBtn"},{fn:"onRIS_B1_CheckInBtnTap",event:"tap",delegate:"#RIS_B1_CheckInBtn"},{fn:"onRIS_B1_CheckOutBtnTap",event:"tap",delegate:"#RIS_B1_CheckOutBtn"},{fn:"onRIS_B1_ObservedBtnTap",event:"tap",delegate:"#RIS_B1_ObservedBtn"},{fn:"onRIS_B1_CancelStatusBtnTap",event:"tap",delegate:"#RIS_B1_CancelStatusBtn"},{fn:"onRIS_B1_IDFilterFocus",event:"focus",delegate:"#RIS_B1_IDFilter"},{fn:"onRIS_B1_IDFilterKeyup",event:"keyup",delegate:"#RIS_B1_IDFilter"},{fn:"onRIS_B1_IDFilterClearicontap",event:"clearicontap",delegate:"#RIS_B1_IDFilter"},{fn:"onRIS_B1_RefreshBtnTap",event:"tap",delegate:"#RIS_B1_RefreshBtn"}],items:[{xtype:"toolbar",docked:"top",itemId:"WL_RIS_Head_ToolBar",items:[{xtype:"selectfield",itemId:"RIS_RoomsFields",width:320,label:"報到櫃檯",displayField:"RoomName",valueField:"RoomIndex"},{xtype:"selectfield",hidden:false,itemId:"WL_RIS_BI_ModQueueList",width:320,label:"檢查室",labelWidth:"25%",displayField:"Aliases",valueField:"ModQueueID"}]},{xtype:"panel",itemId:"RIS_IPL_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"WL_RIS_B1_ToolBar",items:[{xtype:"datepickerfield",itemId:"RIS_B1_PreexamDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"segmentedbutton",itemId:"RIS_B1_FnBtn",width:"48%",items:[{xtype:"button",flex:1,itemId:"RIS_B1_AllBtn",text:"全部"},{xtype:"button",flex:1,itemId:"RIS_B1_NoArrBtn",text:"未報到"},{xtype:"button",flex:1,itemId:"RIS_B1_ArrBtn",text:"已報到"},{xtype:"button",flex:1,itemId:"RIS_B1_CheckInBtn",text:"檢查中"},{xtype:"button",flex:1.5,itemId:"RIS_B1_CheckOutBtn",text:"檢查結束"},{xtype:"button",flex:1,itemId:"RIS_B1_ObservedBtn",text:"留觀區"},{xtype:"button",flex:1,itemId:"RIS_B1_CancelStatusBtn",text:"取消"}]},{xtype:"searchfield",itemId:"RIS_B1_IDFilter",width:"22%",label:"ID",labelWidth:"15%",placeHolder:"病歷號或身分證號"},{xtype:"button",itemId:"RIS_B1_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"}]}]},onContainerDestroy:function(a){console.log("On Destroy :","RIS_PatientList_B1");this.removeAll(true,true)},onRIS_RoomsFieldsChange:function(a,f,d,e){var b=Ext.getStore("sModQueue");b.clearFilter();b.filter(new Ext.util.Filter({filterFn:function(g){return(g.data.RoomID==f)}}));b=null;delete b},onWL_RIS_BI_ModQueueListChange:function(a,e,b,d){if(e){this.setInitialFlag(false);if(e.indexOf("OTHER")>=0){this.LoadPatientList(this.down("#RIS_B1_PreexamDatePicker").getValue(),this.down("#RIS_RoomsFields").getValue(),"OTHER")}else{this.LoadPatientList(this.down("#RIS_B1_PreexamDatePicker").getValue(),this.down("#RIS_RoomsFields").getValue(),e)}}},onRIS_B1_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()&&a){Ext.getStore("sEXAMROOM_B1").removeAll();Ext.getStore("sModQueue").removeAll();Ext.getStore("sEXAMROOM_B1").getProxy().setExtraParams({PreExamDate:a});Ext.getStore("sModQueue").getProxy().setExtraParams({PreExamDate:a});this.setMasked({xtype:"loadmask",message:"拼命載入中，請稍候..."});Ext.getStore("sEXAMROOM_B1").load({callback:function(g,f,h){Ext.getStore("sModQueue").load({callback:function(k,j,l){this.LoadPatientList(a,this.down("#RIS_RoomsFields").getValue(),this.down("#WL_RIS_BI_ModQueueList").getValue());this.setMasked(false)},scope:this})},scope:this})}},onRIS_B1_AllBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.CancelFlag!="Y")},this)}d=null;delete d},onRIS_B1_NoArrBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.CancelFlag!="Y")&&(e.data.ExamStatus<30)},this)}d=null;delete d},onRIS_B1_ArrBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.CancelFlag!="Y")&&(e.data.ExamStatus==30)},this)}d=null;delete d},onRIS_B1_CheckInBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.CancelFlag!="Y")&&((e.data.ExamStatus>30)&&(e.data.ExamStatus<40))},this)}d=null;delete d},onRIS_B1_CheckOutBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.CancelFlag!="Y")&&(e.data.ExamStatus>=40)},this)}d=null;delete d},onRIS_B1_ObservedBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.ClosedReason=="留觀")},this)}d=null;delete d},onRIS_B1_CancelStatusBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#RIS_B1_FnBtn"),b,"confirm-round","normal","","");var d=Ext.getStore("sRisPatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.CancelFlag=="Y")},this)}d=null;delete d},onRIS_B1_IDFilterFocus:function(b,d,a){this.down("#RIS_B1_AllBtn").fireEvent("tap",this.down("#RIS_B1_AllBtn"),null,null)},onRIS_B1_IDFilterKeyup:function(b,d,a){var f=Ext.getStore("sRisPatients");if(b.getValue()==""){f.clearFilter(true);f.filter("","");return}else{if(d.browserEvent.keyCode==8){f.clearFilter(true);f.filter("","")}f.filterBy(function(e,h){var g=String(b.getValue()).toLowerCase();if(e.get("PatIdno").toLowerCase().indexOf(g)>-1||e.get("ChartNO").toLowerCase().indexOf(g)>-1){return true}return false})}f=null;delete f},onRIS_B1_IDFilterClearicontap:function(b,d,a){Ext.getStore("sRisPatients").clearFilter(true);Ext.getStore("sRisPatients").filter("","")},onRIS_B1_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#RIS_B1_PreexamDatePicker").getValue(),this.down("#RIS_RoomsFields").getValue(),this.down("#WL_RIS_BI_ModQueueList").getValue())},initialize:function(){this.callParent();this.down("#RIS_B1_PreexamDatePicker").setValue(new Date());this.down("#RIS_RoomsFields").setStore(Ext.getStore("sEXAMROOM_B1"));this.down("#RIS_RoomsFields").setValue("001");this.down("#WL_RIS_BI_ModQueueList").setStore(Ext.getStore("sModQueue"));var a=this;var d=Ext.getCmp("RIS_PatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenRISPatientGrid("RIS_PatGrid","RIS排程清單",null,false);d.initialFlag=true;d.getTitleBar().hide();var e=Ext.getStore("sRisPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapRISGrid,d);this.down("#RIS_IPL_MainPanel").add(d);d.addListener("painted",NisTRApp.view.UserConfig.onPainted_RisInPatGrid,d);var b=d.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_RisInPatGrid,d);d=null;delete d;e=null;delete e}a=null;delete a;Ext.getStore("sRisPatients").addListener("load",function(h,g,k,f,j){NisTRApp.view.GridUtility.onChangeRISClosedSelect("RIS_PatGrid")},this);this.down("#RIS_B1_AllBtn").fireEvent("tap",this.down("#RIS_B1_AllBtn"),null,null)},LoadPatientList:function(b,e,a){if(a.indexOf("OTHER")>=0){a="OTHER"}if(Ext.getStore("sRisPatients").isLoading()){return}var d=Ext.getStore("sRisPatients");d.getProxy().setExtraParams({PreExamDate:b,PreExamRoom:e,PreExamQueue:a});d.load();d=null;delete d}});Ext.define("NisTRApp.view.REG.ScheduleHistory",{extend:Ext.Container,config:{height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"ScheduleHistoryToolBar",items:[{xtype:"searchfield",itemId:"schHistoryId",width:"290px",label:"病人ID",placeHolder:"病歷號"},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"SCHHISTORY_BegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"SCHHISTORY_EndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"SCHHISTORY_RefreshBtn",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton89"}]},{xtype:"panel",itemId:"SchHistoryMainPanel"}],listeners:[{fn:"onSCHHISTORY_RefreshBtnTap",event:"tap",delegate:"#SCHHISTORY_RefreshBtn"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"}]},onSCHHISTORY_RefreshBtnTap:function(b,g,a){if(Ext.getStore("sSchHistory").isLoading()||Ext.isEmpty(this.down("#schHistoryId").getValue())){return}var d=this.down("#schHistoryId").getValue();var f=Ext.getStore("sSchHistory");f.removeAll();f.getProxy().setExtraParams({ChartNo:d,BegDate:this.down("#SCHHISTORY_BegDate").getValue(),EndDate:this.down("#SCHHISTORY_EndDate").getValue()});f.load({callback:function(h,e,j){},scope:this});f=null;delete f;d=null;delete d},onContainerShow:function(a,b){if(Ext.getStore("sSchHistory").getCount()<=0){this.down("#SCHHISTORY_RefreshBtn").fireEvent("tap",this.down("#SCHHISTORY_RefreshBtn"),null,null)}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sSchHistory"))){Ext.getStore("sSchHistory").removeAll();Ext.getStore("sSchHistory").destroy()}this.removeAll()},initialize:function(){this.callParent();if(!Ext.isEmpty(this.getRecord())&&!Ext.isEmpty(this.getRecord().data)&&!Ext.isEmpty(this.getRecord().data.ChartNo)){this.down("#schHistoryId").setValue(this.getRecord().data.ChartNo)}this.down("#SCHHISTORY_EndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));this.down("#SCHHISTORY_BegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-6));if(Ext.isEmpty(Ext.getStore("sSchHistory"))){Ext.create("Ext.data.Store",{storeId:"sSchHistory",autoLoad:false,model:"NisTRApp.model.Ris.RisLabSchData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryRisLabSchData.ashx",reader:{type:"json"}}})}var a=Ext.getCmp("SchHistoryGrid");if(Ext.isEmpty(a)){a=this.GenSchHistoryGrid("SchHistoryGrid","","");a.getTitleBar().hide();var b=Ext.getStore("sSchHistory");a.setStore(b);this.down("#SchHistoryMainPanel").add(a);b=null;delete b}a=null;delete a;this.down("#SchHistoryMainPanel").setRecord(this.getRecord())},GenSchHistoryGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">查無排檢資料.</div>',plugins:[{type:"gridcolumnresizing"}],columns:[{text:"檢查名稱",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{Examcname}</span>',flex:1,width:200,dataIndex:"Examcname",editable:false,sortable:true},{text:"預定檢查日",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Preexamdate)]}</span>',flex:1,width:90,dataIndex:"Preexamdate",editable:false,sortable:true},{text:"預定檢查時間",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{Preexamtime}</span>',flex:1,width:90,dataIndex:"Preexamtime",editable:false,sortable:true},{text:"實際檢查日",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Realexamtxdateend)]}</span>',flex:1,width:90,dataIndex:"Realexamtxdateend",editable:false,sortable:true},{text:"開單醫師",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{Reqdoctcname}</span>',flex:1,width:90,dataIndex:"Reqdoctcname",editable:false,sortable:true},{text:"報告狀態",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{Examstatus}</span>',flex:1,width:120,dataIndex:"Examstatus",editable:false,sortable:true},{text:"申請單號",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",width:130,tpl:'<span style="color:{StyleColor}; font-size: 12px">{Reqno}</span>',flex:1,dataIndex:"Reqno",editable:false,sortable:true},{text:"手工單號",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{Manualno}</span>',flex:1,width:130,dataIndex:"Manualno",editable:false,sortable:true},{text:"批價日期",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Reqdate)]}</span>',flex:1,width:90,dataIndex:"ReqDate",editable:false,sortable:true},{text:"檢查代碼",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{Examid}</span>',flex:1,width:100,dataIndex:"Examid",editable:false,sortable:true}]})}});Ext.define("NisTRApp.view.HrmView",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"HrmViewToolBar",items:[{xtype:"searchfield",itemId:"hrmViewId",width:"290px",label:"病人ID",placeHolder:"病歷號"},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"HRMVIEW_RefreshBtn",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton89"}]},{xtype:"list",itemId:"RSP_HighRiskList",ui:"round",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:30%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'    <span style="font-size: 14pt; font-weight: bold; color:blue;">建檔日期:</span>','     <span style="font-size: 12pt; font-weight: bold; color:Black;" >{[NisTRApp.view.TRUtility.BirthdayFormat(values.CreDate)]}</span>','    <br style="line-height:0.1;">','    <span style="font-size: 14pt; font-weight: bold; color:blue;">內容:</span>','    <span style="font-size: 12pt; font-weight: bold; color:black;">{Report}</span>',"    ","</div>"],grouped:true}],listeners:[{fn:"onHRMVIEW_RefreshBtnTap",event:"tap",delegate:"#HRMVIEW_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onHRMVIEW_RefreshBtnTap:function(b,g,a){if(Ext.getStore("sHemdatv").isLoading()||Ext.isEmpty(this.down("#hrmViewId").getValue())){return}var d=this.down("#hrmViewId").getValue();var f=Ext.getStore("sHemdatv");f.removeAll();f.getProxy().setExtraParams({ChartNo:d});f.load({callback:function(h,e,j){},scope:this});f=null;delete f;d=null;delete d},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sHemdatv"))){Ext.getStore("sHemdatv").removeAll();Ext.getStore("sHemdatv").destroy()}this.removeAll()},onContainerShow:function(a,b){if(this.getInitialFlag()){this.setInitialFlag(false);this.down("#HRMVIEW_RefreshBtn").fireEvent("tap",this.down("#HRMVIEW_RefreshBtn"),null,null)}},initialize:function(){this.callParent();if(!Ext.isEmpty(this.getRecord())&&!Ext.isEmpty(this.getRecord().data)&&!Ext.isEmpty(this.getRecord().data.ChartNo)){this.down("#hrmViewId").setValue(this.getRecord().data.ChartNo)}if(Ext.isEmpty(Ext.getStore("sHemdatv"))){Ext.create("Ext.data.Store",{storeId:"sHemdatv",autoLoad:false,model:"NisTRApp.model.mHemdatv",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryHemdatvs.ashx",reader:{type:"json"}},grouper:{groupFn:function(a){return a.data.SourceName}}})}this.down("#RSP_HighRiskList").setStore(Ext.getStore("sHemdatv"))}});Ext.define("NisTRApp.view.WorkList.RIS.ContactPatient",{extend:Ext.Container,alias:"widget.RIS_ContactPatient",config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"RISCP_MainTabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerActivate",event:"activate"},{fn:"onContainerDestroy",event:"destroy"}]},onContainerActivate:function(h,d,b,e){if(Ext.isEmpty(this.down("#_risMPLCareContainer"))){var j=Ext.create("NisTRApp.view.WorkList.RIS.CareContainer",{id:"_risMPLCareContainer",itemId:"_risMPLCareContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"追蹤病人"});this.down("#RISCP_MainTabPanel").add(j);j=null;delete j}else{this.down("#_risMPLCareContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_risMPLCareFinishedContainer"))){var f=Ext.create("NisTRApp.view.WorkList.RIS.CareFinishedContainer",{id:"_risMPLCareFinishedContainer",itemId:"_risMPLCareFinishedContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"結案病人"});this.down("#RISCP_MainTabPanel").add(f);f=null;delete f}else{this.down("#_risMPLCareFinishedContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_risRLRISMYCareContainer"))){var a=Ext.create("NisTRApp.view.WorkList.RIS.MyCarePatientsContainer",{id:"_risRLRISMYCareContainer",itemId:"_risRLRISMYCareContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"我的病人"});this.down("#RISCP_MainTabPanel").add(a);a=null;delete a}else{this.down("#_risRLRISMYCareContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_risRLRISQueryContainer"))){var g=Ext.create("NisTRApp.view.WorkList.RIS.QueryPatientsContainer",{id:"_risRLRISQueryContainer",itemId:"_risRLRISQueryContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"排程查詢"});this.down("#RISCP_MainTabPanel").add(g);g=null;delete g}else{this.down("#_risRLRISQueryContainer").setRecord(this.getRecord())}},onContainerDestroy:function(a){console.log("On Destroy :","RIS.ContactPatient");this.removeAll(true,true)}});Ext.define("NisTRApp.view.RIS_ContactPanel",{extend:Ext.Container,statics:{OpenCareAssessmentForm:function(a,b){if(Ext.isEmpty(a)){Ext.Msg.alert("RIS_CareInfoPanel 表單網址錯誤");return}try{var d=Ext.getCmp("_risCareAssessmentFormPanel");if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_risCareAssessmentFormPanel",centered:true,modal:true,url:a,height:NisTRApp.view.SysUtility.ClcHeight(90),width:NisTRApp.view.SysUtility.ClcWidth(95),divID:"RisCareAssessmentFrameDIV"})}if(!Ext.isEmpty(d)){d.setCaller(b);d.setCloseFn(function(e){});b.overlay=Ext.Viewport.add(d);d.show()}d=null;delete d;a=null;delete a}catch(f){console.log(f)}}},config:{hiddenHeadBar:false,stopDistroyEvent:false,height:480,width:640,layout:{type:"fit"},caller:{},items:[{xtype:"formpanel",itemId:"RISContactFormPanel",items:[{xtype:"fieldset",itemId:"RISC_ContactTelFieldSet",title:"聯絡電話",items:[{xtype:"textfield",itemId:"TelHomeTxt",label:"(宅)",name:"TelHome"},{xtype:"textfield",itemId:"TelMobileTxt",label:"(手機)",name:"TelMobile"},{xtype:"textfield",itemId:"TelOfficeTxt",label:"(公)",name:"TelOffice"}]},{xtype:"fieldset",itemId:"RISC_ContactTimeFieldSet",title:"聯絡時段",items:[{xtype:"checkboxfield",itemId:"ContactTime1Cb",label:"上午",name:"ContactTime1"},{xtype:"checkboxfield",itemId:"ContactTime2Cb",label:"下午",name:"ContactTime2"},{xtype:"textfield",itemId:"ContactTimeOthersTxt",label:"其他",name:"ContactTimeOthers"}]},{xtype:"fieldset",itemId:"RISC_PatFieldSet",title:"病人意願",items:[{xtype:"checkboxfield",html:"",itemId:"ContactYesCb",label:"願意接受電訪",name:"ContactYes"},{xtype:"checkboxfield",itemId:"ContactNoCb",label:"不方便聯絡",name:"ContactNo"},{xtype:"checkboxfield",itemId:"HppFlagCb",label:"立德病人",name:"HppFlag"},{xtype:"textfield",html:"",itemId:"ContactOtherTxt",label:'<div id="ContactOtherLabDiv">其他</div>',name:"ContactOther"}]},{xtype:"fieldset",itemId:"RISC_ContactObjFieldSet",title:"連絡對象",items:[{xtype:"checkboxfield",itemId:"ContacterPatientCb",label:"病人本人",name:"ContacterPatient"},{xtype:"checkboxfield",itemId:"ContacterFamilyCb",label:"家屬",name:"ContacterFamily"},{xtype:"textfield",itemId:"ContacterFamilyRelationshipTxt",label:"家屬關係",name:"ContacterFamilyRelationship"},{xtype:"checkboxfield",itemId:"ContacterFriendCb",label:"朋友",name:"ContacterFriend"},{xtype:"textfield",hidden:true,itemId:"ContacterFriendNameTxt",label:"朋友姓名",name:"ContacterFriendName"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"RISContactFootBar",items:[{xtype:"button",itemId:"RISC_ADDMYPATIENT_Btn",text:"加入我的病人"},{xtype:"button",itemId:"RISC_FinishContactPatient",ui:"confirm",width:"90px",iconCls:"favorites",text:"結案"},{xtype:"button",hidden:false,itemId:"RISC_CancelContactPatient",ui:"decline",text:"取消追蹤"},{xtype:"button",centered:false,itemId:"RISC_SaveMasterBtn",right:"95px",ui:"decline",width:"80px",text:"存 檔"},{xtype:"button",itemId:"RISC_CloseMasterBtn",right:"5px",ui:"confirm",width:"80px",text:"關閉"},{xtype:"button",itemId:"RSIC_AddCareRecordBtn",ui:"confirm",width:"120px",iconCls:"add",text:"追蹤記錄"}]}],listeners:[{fn:"onRISC_ADDMYPATIENT_BtnTap",event:"tap",delegate:"#RISC_ADDMYPATIENT_Btn"},{fn:"onRISC_FinishContactPatientTap",event:"tap",delegate:"#RISC_FinishContactPatient"},{fn:"onRISC_CancelContactPatientTap",event:"tap",delegate:"#RISC_CancelContactPatient"},{fn:"onRISC_SaveMasterBtnTap",event:"tap",delegate:"#RISC_SaveMasterBtn"},{fn:"onRISC_CloseMasterBtnTap",event:"tap",delegate:"#RISC_CloseMasterBtn"},{fn:"onRSIC_AddCareRecordBtnTap",event:"tap",delegate:"#RSIC_AddCareRecordBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onRISC_ADDMYPATIENT_BtnTap:function(d,g,b){var a=this.getRecord();var f=this;f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/ModifyMyPatient.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,ChartNo:a.data.ChartNO,Flag:"ADD"},success:function(e){f.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h;f=null;delete f},failure:function(){f.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f}});a=null;delete a},onRISC_FinishContactPatientTap:function(d,g,b){if(Ext.getStore("sRisContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){return}var a=this.getRecord();var f=this;Ext.Msg.confirm("Confirm","是否確認追蹤結案? 病人:"+a.data.PatName,function(j,k,h){if(j=="no"){f=null;delete f;a=null;delete a;return}else{if(j=="yes"){var e={ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,TelHome:this.down("#TelHomeTxt").getValue(),TelOffice:this.down("#TelOfficeTxt").getValue(),TelMobile:this.down("#TelMobileTxt").getValue(),ContactTime1:(this.down("#ContactTime1Cb").isChecked()?"上午":""),ContactTime2:(this.down("#ContactTime2Cb").isChecked()?"下午":""),ContactTimeOthers:this.down("#ContactTimeOthersTxt").getValue(),HppFlag:(this.down("#HppFlagCb").isChecked()?"Y":"N"),ContacterPatient:(this.down("#ContacterPatientCb").isChecked()?"Y":"N"),ContacterFamily:(this.down("#ContacterFamilyCb").isChecked()?"Y":"N"),ContacterFamilyRelationship:this.down("#ContacterFamilyRelationshipTxt").getValue(),ContacterFriend:(this.down("#ContacterFriendCb").isChecked()?"Y":"N"),ContacterFriendName:this.down("#ContacterFriendNameTxt").getValue(),ContactYes:(this.down("#ContactYesCb").isChecked()?"Y":"N"),ContactNo:(this.down("#ContactNoCb").isChecked()?"Y":"N"),ContactOther:this.down("#ContactOtherTxt").getValue(),CreUserID:"",CreUserName:"",CreDateTime:"",ModifyUserID:"",ModifyUserName:"",ModifyDateTime:""};f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/RisContactFinished.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,UserID:NisTRApp.view.SysUtility.GetUserID(),Json:btoa(encodeURIComponent(JSON.stringify(e)))},success:function(l){f.setMasked(false);var m=Ext.decode(l.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(m.Success){f.down("#RISC_FinishContactPatient").setHidden(true);f.down("#RISC_CancelContactPatient").setHidden(false)}if(!Ext.isEmpty(f.getCaller())&&f.getCaller().xtype=="grid"){f.getCaller().getStore().load()}m=null;delete m;f=null;delete f;a=null;delete a},failure:function(){f.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f;a=null;delete a}})}}},this)},onRISC_CancelContactPatientTap:function(d,g,b){if(Ext.getStore("sRisContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){return}var a=this.getRecord();var f=this;Ext.Msg.confirm("Confirm","是否取消追蹤? 病人:"+a.data.PatName,function(h,j,e){if(h=="no"){f=null;delete f;a=null;delete a;return}else{if(h=="yes"){f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/RisContactCancel.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(k){f.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){f.down("#RISC_FinishContactPatient").setHidden(false);f.down("#RISC_CancelContactPatient").setHidden(true)}if(!Ext.isEmpty(f.getCaller())&&f.getCaller().xtype=="grid"){f.getCaller().getStore().load()}l=null;delete l;f=null;delete f;a=null;delete a},failure:function(){f.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);f=null;delete f;a=null;delete a}})}}},this)},onRISC_SaveMasterBtnTap:function(b,d,a){if(Ext.getStore("sRisContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){return}this.SaveContactData("Y")},onRISC_CloseMasterBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onRSIC_AddCareRecordBtnTap:function(h,k,g){if(Ext.getStore("sRisContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){return}var b=this.getRecord();var f,j,d;if(b.data.Source.Type==1){f="0";j=b.data.Source.Name;d=(b.data.ChartSeq?b.data.ChartSeq:0)}else{if(b.data.Source.Type==2){f=b.data.InpNO;j=b.data.Source.Name;d=0}else{Ext.Msg.alert("NurCath 病人資料錯誤");return}}var a=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment","G62LNG43CM6ULI76KIVG6H3WPE",NisTRApp.view.SysUtility.GetUserID(),b.data.ChartNo,d,"","","_ReloadRisCareAccessmentData","",f,j);NisTRApp.view.RIS_ContactPanel.OpenCareAssessmentForm(a,this);a=null;delete a;f=null;j=null;d=null;delete f;delete j;delete d;b=null;delete b},onContainerDestroy:function(a){if(Ext.getStore("sRisContactData")!=null){Ext.getStore("sRisContactData").removeAll();Ext.getStore("sRisContactData").destroy()}_ReloadRisCareAccessmentData=null;delete _ReloadRisCareAccessmentData;console.log("on destroy :","RIS Contact Panel ");this.removeAll()},onContainerShow:function(a,b){if(Ext.getStore("sRisContactData").getCount()<=0){this.LoadContactData()}},initialize:function(){this.callParent();_ReloadRisCareAccessmentData=function(b){try{if(null!=b&&undefined!=b&&"TempSave"==b){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_risCareAssessmentFormPanel"))){Ext.getCmp("_risCareAssessmentFormPanel").destroy()}}}catch(d){console.error("_ReloadRisCareAccessmentData",d)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("RIS_Contact 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){Ext.Msg.alert("RIS_Contact 病人資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sRisContactData"))){Ext.create("Ext.data.Store",{storeId:"sRisContactData",autoLoad:false,model:"NisTRApp.model.RIS.ContactData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryRisContactData.ashx",reader:{type:"jsonHtmlDecode"}}})}var a=this.getRecord();this.down("#RISC_FinishContactPatient").setHidden(!(Ext.isEmpty(a.data.CareFlag)||a.data.CareFlag=="Y"||a.data.CareFlag=="N"));this.down("#RISC_CancelContactPatient").setHidden(!(!Ext.isEmpty(a.data.CareFlag)&&a.data.CareFlag!="N"));a=null;delete a},LoadContactData:function(){if(Ext.getStore("sRisContactData").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=this.getRecord();var d=Ext.getStore("sRisContactData");d.getProxy().setExtraParams({ChartNO:a.data.ChartNO,ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO});this.down("#RISContactFormPanel").reset();var b=this;b.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});d.load({callback:function(f,e,h){b.setMasked(false);if(null!=f&&null!=f[0]){b.down("#RISContactFormPanel").setRecord(f[0]);var g=f[0].data;Ext.isEmpty(g.ContactTime1)?b.down("#ContactTime1Cb").uncheck():b.down("#ContactTime1Cb").check();Ext.isEmpty(g.ContactTime2)?b.down("#ContactTime2Cb").uncheck():b.down("#ContactTime2Cb").check();(Ext.isEmpty(g.HppFlag)||g.HppFlag=="N")?b.down("#HppFlagCb").uncheck():b.down("#HppFlagCb").check();(Ext.isEmpty(g.ContacterPatient)||g.ContacterPatient=="N")?b.down("#ContacterPatientCb").uncheck():b.down("#ContacterPatientCb").check();(Ext.isEmpty(g.ContacterFamily)||g.ContacterFamily=="N")?b.down("#ContacterFamilyCb").uncheck():b.down("#ContacterFamilyCb").check();(Ext.isEmpty(g.ContacterFriend)||g.ContacterFriend=="N")?b.down("#ContacterFriendCb").uncheck():b.down("#ContacterFriendCb").check();(Ext.isEmpty(g.ContactYes)||g.ContactYes=="N")?b.down("#ContactYesCb").uncheck():b.down("#ContactYesCb").check();(Ext.isEmpty(g.ContactNo)||g.ContactNo=="N")?b.down("#ContactNoCb").uncheck():b.down("#ContactNoCb").check()}b=null;delete b;a=null;delete a},scope:this});d=null;delete d;a=null;delete a},SaveContactData:function(b){if(Ext.getStore("sRisContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){return}var a=this.getRecord();var d={ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,TelHome:this.down("#TelHomeTxt").getValue(),TelOffice:this.down("#TelOfficeTxt").getValue(),TelMobile:this.down("#TelMobileTxt").getValue(),ContactTime1:(this.down("#ContactTime1Cb").isChecked()?"上午":""),ContactTime2:(this.down("#ContactTime2Cb").isChecked()?"下午":""),ContactTimeOthers:this.down("#ContactTimeOthersTxt").getValue(),HppFlag:(this.down("#HppFlagCb").isChecked()?"Y":"N"),ContacterPatient:(this.down("#ContacterPatientCb").isChecked()?"Y":"N"),ContacterFamily:(this.down("#ContacterFamilyCb").isChecked()?"Y":"N"),ContacterFamilyRelationship:this.down("#ContacterFamilyRelationshipTxt").getValue(),ContacterFriend:(this.down("#ContacterFriendCb").isChecked()?"Y":"N"),ContacterFriendName:this.down("#ContacterFriendNameTxt").getValue(),ContactYes:(this.down("#ContactYesCb").isChecked()?"Y":"N"),ContactNo:(this.down("#ContactNoCb").isChecked()?"Y":"N"),ContactOther:this.down("#ContactOtherTxt").getValue(),CreUserID:"",CreUserName:"",CreDateTime:"",ModifyUserID:"",ModifyUserName:"",ModifyDateTime:""};var e=this;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"RIS/action/RisContactUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,CareFlag:(Ext.isEmpty(b)?"":b),Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(f){e.setMasked(false);var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(b=="Y"&&g.Success){e.down("#RISC_CancelContactPatient").setHidden(false);a.data.CareFlag="Y"}if(!Ext.isEmpty(e.getCaller())&&e.getCaller().xtype=="grid"){e.getCaller().getStore().load()}g=null;delete g;e=null;delete e;a=null;delete a},failure:function(){e.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);e=null;delete e;a=null;delete a}});d=null;delete d}});Ext.define("NisTRApp.view.WorkList.RIS.CareContainer",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"RIS_RISCC_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"RIS_RISCC_ToolBar",items:[{xtype:"datepickerfield",itemId:"RIS_RISCC_PreexamDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"RIS_RISCC_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"},{xtype:"button",itemId:"RIS_RISCC_PrevDayBtn",ui:"confirm-back",width:"90px",text:"前一日"},{xtype:"button",itemId:"RIS_RISCC_TodayBtn",width:"70px",text:"今日"},{xtype:"button",itemId:"RIS_RISCC_NextDayBtn",ui:"confirm-forward",width:"90px",text:"後一日"}]}],listeners:[{fn:"onRIS_RISCC_PreexamDatePickerChange",event:"change",delegate:"#RIS_RISCC_PreexamDatePicker"},{fn:"onRIS_RISCC_RefreshBtnTap",event:"tap",delegate:"#RIS_RISCC_RefreshBtn"},{fn:"onRIS_RISCC_PrevDayBtnTap",event:"tap",delegate:"#RIS_RISCC_PrevDayBtn"},{fn:"onRIS_RISCC_TodayBtnTap",event:"tap",delegate:"#RIS_RISCC_TodayBtn"},{fn:"onRIS_RISCC_NextDayBtnTap",event:"tap",delegate:"#RIS_RISCC_NextDayBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRIS_RISCC_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(a,"Y")}},onRIS_RISCC_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#RIS_RISCC_PreexamDatePicker").getValue(),"Y")},onRIS_RISCC_PrevDayBtnTap:function(b,d,a){this.down("#RIS_RISCC_PreexamDatePicker").setValue(Ext.Date.add(this.down("#RIS_RISCC_PreexamDatePicker").getValue(),Ext.Date.DAY,-1))},onRIS_RISCC_TodayBtnTap:function(b,d,a){this.down("#RIS_RISCC_PreexamDatePicker").setValue(new Date())},onRIS_RISCC_NextDayBtnTap:function(b,d,a){this.down("#RIS_RISCC_PreexamDatePicker").setValue(Ext.Date.add(this.down("#RIS_RISCC_PreexamDatePicker").getValue(),Ext.Date.DAY,1))},onContainerDestroy:function(a){if(Ext.getStore("sRisContactPatients")!=null){Ext.getStore("sRisContactPatients").removeAll();Ext.getStore("sRisContactPatients").destroy()}console.log("On Destroy :","RIS.CareContainer");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadPatientList(this.down("#RIS_RISCC_PreexamDatePicker").getValue(),"Y")}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sRisContactPatients"))){Ext.create("Ext.data.Store",{storeId:"sRisContactPatients",model:"NisTRApp.model.RIS.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryContactPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sRisContactPatients").addListener("load",function(g,f,j,e,h){NisTRApp.view.GridUtility.onChangeRISClosedSelect("RIS_ContactPatGrid")},this);var a=this;var b=Ext.getCmp("RIS_ContactPatGrid");if(b==null){b=NisTRApp.view.GridUtility.GenRISPatientGrid("RIS_ContactPatGrid","RIS排程清單",null,false);b.getTitleBar().hide();var d=Ext.getStore("sRisContactPatients");b.setStore(d);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapRISGrid,b);this.down("#RIS_RISCC_MainPanel").add(b);b=null;delete b;d=null;delete d}this.down("#RIS_RISCC_PreexamDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadPatientList:function(b,a){if(Ext.getStore("sRisContactPatients").isLoading()){return}var d=Ext.getStore("sRisContactPatients");d.getProxy().setExtraParams({CareFlag:a,PreExamDate:b});d.load({callback:function(f,e,g){},scope:this});d=null;delete d}});Ext.define("NisTRApp.view.WorkList.RIS.CareFinishedContainer",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"RIS_RISCCF_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"RIS_RISCCF_ToolBar",items:[{xtype:"datepickerfield",itemId:"RIS_RISCCF_PreexamDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"RIS_RISCCF_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"}]}],listeners:[{fn:"onRIS_RISCCF_PreexamDatePickerChange",event:"change",delegate:"#RIS_RISCCF_PreexamDatePicker"},{fn:"onRIS_RISCCF_RefreshBtnTap",event:"tap",delegate:"#RIS_RISCCF_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRIS_RISCCF_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(a)}},onRIS_RISCCF_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#RIS_RISCCF_PreexamDatePicker").getValue())},onContainerDestroy:function(a){if(Ext.getStore("sRisContactFinishedPatients")!=null){Ext.getStore("sRisContactFinishedPatients").removeAll();Ext.getStore("sRisContactFinishedPatients").destroy()}console.log("On Destroy :","RIS.CareFinishedContainer");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadPatientList(this.down("#RIS_RISCCF_PreexamDatePicker").getValue())}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sRisContactFinishedPatients"))){Ext.create("Ext.data.Store",{storeId:"sRisContactFinishedPatients",model:"NisTRApp.model.RIS.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryContactPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sRisContactFinishedPatients").addListener("load",function(g,f,j,e,h){NisTRApp.view.GridUtility.onChangeRISClosedSelect("RIS_ContactFinishedPatGrid")},this);var a=this;var d=Ext.getCmp("RIS_ContactFinishedPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenRISPatientGrid("RIS_ContactFinishedPatGrid","RIS排程清單",null,false);d.getTitleBar().hide();var b=Ext.getStore("sRisContactFinishedPatients");d.setStore(b);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapRISGrid,d);this.down("#RIS_RISCCF_MainPanel").add(d);d=null;delete d;b=null;delete b}this.down("#RIS_RISCCF_PreexamDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadPatientList:function(a){if(Ext.getStore("sRisContactFinishedPatients").isLoading()){return}var b=Ext.getStore("sRisContactFinishedPatients");b.getProxy().setExtraParams({CareFlag:"finished",PreExamDate:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.RIS.WorkList",{extend:Ext.Container,alias:"widget.RIS_WorkList",config:{stopDistroyEvent:false,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"list",itemId:"RISWK_List",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無工作清單.</div>',itemTpl:Ext.create("Ext.XTemplate","<table >","<tr>",'<td id={ItemName} rowspan="1" align="left" width="220px">    {ItemName} </td>','<td width="10px" align="left">&nbsp;&nbsp;</td>  ',"    ",'<td rowspan="1" align="right" width="64px">',"    ",'     <img name="img" src={[this.FinishChk(values.IsFinished)]} style="width:40px;height:40px;">'," </td>",'<td rowspan="1" align="right" width="300px">',"    ","    <span>{DisplayMsg}</span>"," </td>    ","</tr>","     ","</table>","",{FinishChk:function(a){if(a){return"../_/img/FrmFinish.png"}else{return"../_/img/FrmAdd.png"}}})},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"RISWK_CloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"},{xtype:"button",itemId:"RISWK_RefershBtn",ui:"decline",width:"20%",text:"重 新 整 理"}]}],listeners:[{fn:"onRISWK_ListItemTap",event:"itemtap",delegate:"#RISWK_List"},{fn:"onRISWK_CloseBtnTap",event:"tap",delegate:"#RISWK_CloseBtn"},{fn:"onRISWK_RefershBtnTap",event:"tap",delegate:"#RISWK_RefershBtn"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"}]},onRISWK_ListItemTap:function(f,h,j,g,k,l){_risWkFrmEdit_callback_event=function(o){try{if(!Ext.isEmpty(Ext.getStore("sRisWorkingList"))){Ext.getStore("sRisWorkingList").load()}if(null!=o&&undefined!=o&&"TempSave"==o){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_wklistFormPanel"))){Ext.getCmp("_wklistFormPanel").destroy()}}}catch(p){console.error("_risWkFrmEdit_callback_event",p)}};var b=function b(p,o,q){if(Ext.getStore("sRisWorkingList").isLoading()||Ext.isEmpty(o)||Ext.isEmpty(o.data.ReqNO)||Ext.isEmpty(o.data.ItemNO)||Ext.isEmpty(p)||Ext.isEmpty(p.data.ItemID)){return}var v=g.data.WorkType.split("_");if(Ext.isEmpty(v)||v.length<2){v=null;delete v;Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}var s,u,r;if(o.data.Source.Type==1){s="0";u=o.data.Source.Name;r=(o.data.ChartSeq?o.data.ChartSeq:0)}else{if(o.data.Source.Type==2){s=o.data.InpNO;u=o.data.Source.Name;r=0}else{Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}}if(v[1]=="RenderAssesment"){var e=NisTRApp.view.FormUtil.AssessmentAddr(v[1],p.data.ItemID,NisTRApp.view.SysUtility.GetUserID(),o.data.ChartNo,r,"","","_risWkFrmEdit_callback_event","",s,u);NisTRApp.view.FormUtil.OpenWorkListForm(e,"_wklistFormPanel",q);e=null;delete e}else{if(v[1]=="RenderHeathTeach"){NisTRApp.view.TRUtility.OpenMainUI(o,SYS_CONST.PageDef.NurHealthTeach,q.getCaller());q.getCaller().destroy()}else{if(v[1]=="Notes"){NisTRApp.view.TRUtility.OpenMainUI(o,SYS_CONST.PageDef.NurNotes,q.getCaller());q.getCaller().destroy()}else{if(v[1]=="RenderPrepare"){NisTRApp.view.TRUtility.OpenMainUI(o,SYS_CONST.PageDef.NurPrepare,q.getCaller());q.getCaller().destroy()}}}}v=null;delete v;s=null;u=null;r=null;delete s;delete u;delete r;o=null;delete o};var d=function d(r,o){if(Ext.isEmpty(r)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){Ext.getCmp("_opdVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){var p=Ext.create("NisTRApp.view.OPD_VitalSignInputPanel",{id:"_opdVSInputPanel",patInfo:r,record:r,success:function(e){if(!Ext.isEmpty(Ext.getStore("sRisWorkingList"))){Ext.getStore("sRisWorkingList").load()}}});o.overlay=Ext.Viewport.add(p);p=null;delete p}o.overlay.show()}catch(q){console.log(q)}o=null;delete o;return};var a=function a(r,o){if(Ext.isEmpty(r)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){Ext.getCmp("_inpVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){var q=Ext.create("NisTRApp.view.INP_VitalSignInputPanel",{id:"_inpVSInputPanel",patInfo:r,record:r,success:function(e){if(!Ext.isEmpty(Ext.getStore("sRisWorkingList"))){Ext.getStore("sRisWorkingList").load()}}});o.overlay=Ext.Viewport.add(q);q=null;delete q}o.overlay.show()}catch(p){console.log(p)}o=null;delete o;return};var m=this;if(k.event.target.nodeName=="IMG"){if(Ext.isEmpty(g.data.ItemID)||Ext.isEmpty(g.data.WorkType)){k.preventDefault();m=null;delete m;return false}var n=g.data.WorkType.split("_");if(n[0]=="FRM"){b(g,this.getRecord(),m)}else{if(n[0]=="VITALSIGN"&&this.getRecord().data.Source==SYS_CONST.PatSource.OPD){d(this.getRecord(),m)}else{if(n[0]=="VITALSIGN"&&this.getRecord().data.Source==SYS_CONST.PatSource.INP){a(this.getRecord(),m)}else{if(n[0]=="CATH"){NisTRApp.view.TRUtility.OpenMainUI(this.getRecord(),SYS_CONST.PageDef.Cath,m.getCaller());m.getCaller().destroy()}}}}n=null;delete n}k.preventDefault();m=null;delete m;b=null;delete b;d=null;delete d;a=null;delete a;return false},onRISWK_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onRISWK_RefershBtnTap:function(b,d,a){this.LoadWorkList()},onContainerShow:function(a,b){if(Ext.getStore("sRisWorkingList").getCount()<=0){this.LoadWorkList()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sRisWorkingList"))){Ext.getStore("sRisWorkingList").removeAll();Ext.getStore("sRisWorkingList").destroy()}_risWkFrmEdit_callback_event=null;delete _risWkFrmEdit_callback_event;console.log("on destroy :","RIS.WorkList");this.removeAll()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)){Ext.Msg.alert("RIS_WorkList 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.ReqNO)||Ext.isEmpty(this.getRecord().data.ItemNO)){Ext.Msg.alert("RIS_WorkList 手術資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sRisWorkingList"))){Ext.create("Ext.data.Store",{storeId:"sRisWorkingList",autoLoad:false,model:"NisTRApp.model.mWorkingItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryRisWorkingItem.ashx",reader:{type:"json"}}})}this.down("#RISWK_List").setStore(Ext.getStore("sRisWorkingList"))},LoadWorkList:function(){if(Ext.getStore("sRisWorkingList").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=this.getRecord();var b=Ext.getStore("sRisWorkingList");b.removeAll();b.getProxy().setExtraParams({ChartNO:a.data.ChartNo,ReqNO:a.data.ReqNO,ItemNO:a.data.ItemNO,Source:a.data.Source.Name});b.load();b=null;delete b}});Ext.define("NisTRApp.view.WorkList.RIS.MyCarePatientsContainer",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",items:[{xtype:"textfield",itemId:"WLRISMP_UserId",width:260,label:"員工編號"},{xtype:"button",itemId:"WLRISMP_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"panel",itemId:"WLRISMP_MianPanel"}],listeners:[{fn:"onWLRISMP_QueryBtnTap",event:"tap",delegate:"#WLRISMP_QueryBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onWLRISMP_QueryBtnTap:function(b,d,a){this.LoadMyPatients(this.down("#WLRISMP_UserId").getValue())},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadMyPatients(this.down("#WLRISMP_UserId").getValue())}},onContainerDestroy:function(a){if(Ext.getStore("sRisOnlyMyPatients")!=null){Ext.getStore("sRisOnlyMyPatients").removeAll();Ext.getStore("sRisOnlyMyPatients").destroy()}this.removeAll(true,true)},initialize:function(){this.callParent();this.down("#WLRISMP_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());if(Ext.isEmpty(Ext.getStore("sRisOnlyMyPatients"))){Ext.create("Ext.data.Store",{storeId:"sRisOnlyMyPatients",clearOnPageLoad:false,model:"NisTRApp.model.RIS.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryRisMyPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sRisOnlyMyPatients").addListener("load",function(h,g,k,f,j){NisTRApp.view.GridUtility.onChangeRISClosedSelect("RIS_MyPatients")},this);var a=this;var d=Ext.getCmp("RIS_MyPatients");if(d==null){d=NisTRApp.view.GridUtility.GenRISPatientGrid("RIS_MyPatients","我的放診病人",null,true);d.getTitleBar().hide();var b=Ext.create("Ext.grid.column.Template",{text:"刪除",align:"center",cls:"gridMediumFont",itemId:"delMyPatient",tpl:Ext.create("Ext.XTemplate",'<img id="{[this.imgId(values.MyPatUserID)]}_IMG_{KeyOne}" src="{[this.imgPath(values.MyPatUserID)]}" alt="Smiley face" height="50"" width="50"">',{imgPath:function(f){if(!String.IsNull(f)&&(f==NisTRApp.view.SysUtility.GetUserID())){return"../_/img/Error.png"}else{return"../_/img/empty.png"}},imgId:function(f){if(!String.IsNull(f)&&(f==NisTRApp.view.SysUtility.GetUserID())){return"RISDELMYPATIENT"}else{return"XXXXX"}}}),width:70,hidden:false,sortable:false,flex:1});d.setColumns([b]);var e=Ext.getStore("sRisOnlyMyPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapRISGrid,d);this.down("#WLRISMP_MianPanel").add(d);d=null;delete d;b=null;delete b}a=null;delete a},LoadMyPatients:function(a){if(Ext.getStore("sRisOnlyMyPatients").isLoading()){return}Ext.getStore("sRisOnlyMyPatients").removeAll();if(Ext.isEmpty(a)){return}var b=Ext.getStore("sRisOnlyMyPatients");b.getProxy().setExtraParams({UserID:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.WorkList.RIS.QueryPatientsContainer",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",items:[{xtype:"textfield",itemId:"WLRISQP_PatId",width:260,label:"病人ID",placeHolder:"病歷號或身分證號"},{xtype:"button",itemId:"WLRISQP_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"panel",itemId:"WLRISQP_MianPanel"}],listeners:[{fn:"onWLRISQP_QueryBtnTap",event:"tap",delegate:"#WLRISQP_QueryBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onWLRISQP_QueryBtnTap:function(b,d,a){this.LoadMyPatients(this.down("#WLRISQP_PatId").getValue())},onContainerPainted:function(b,a){this.down("#WLRISQP_PatId").focus();if(this.getInitialFlag()){this.setInitialFlag(false)}},onContainerDestroy:function(a){if(Ext.getStore("sRisQueryPatients")!=null){Ext.getStore("sRisQueryPatients").removeAll();Ext.getStore("sRisQueryPatients").destroy()}this.removeAll(true,true)},onContainerShow:function(a,b){},initialize:function(){this.callParent();this.down("#WLRISQP_PatId").setValue("");if(Ext.isEmpty(Ext.getStore("sRisQueryPatients"))){Ext.create("Ext.data.Store",{storeId:"sRisQueryPatients",clearOnPageLoad:false,model:"NisTRApp.model.RIS.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryRisMyPatients.ashx",reader:{type:"json"}}})}var a=this;var d=Ext.getCmp("RIS_QueryPatients");if(d==null){d=NisTRApp.view.GridUtility.GenRISPatientGrid("RIS_QueryPatients","放診病人查詢",null,true);d.getTitleBar().hide();d.down("#RisPreExamDate").setHidden(false);var e=Ext.getStore("sRisQueryPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapRISGrid,d);this.down("#WLRISQP_MianPanel").add(d);d=null;delete d}a=null;delete a;var b=this.down("#WLRISQP_PatId");b.setValue("");b.addListener("keyup",function(f,h,g){if(h.event.keyCode==13){Ext.ComponentQuery.query("#WLRISQP_QueryBtn")[0].fireEvent("tap")}},b);b=null;delete b},LoadMyPatients:function(b){if(Ext.getStore("sRisQueryPatients").isLoading()){return}Ext.getStore("sRisQueryPatients").removeAll();if(Ext.isEmpty(b)){return}var a=Ext.getStore("sRisQueryPatients");a.getProxy().setExtraParams({PatID:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a}});Ext.define("NisTRApp.view.WorkList.RIS.ObservedPatient",{extend:Ext.Container,alias:"widget.RIS_ObservedPatient",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"RIS_OBP_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"RIS_OBP_ToolBar",items:[{xtype:"datepickerfield",itemId:"RIS_OBP_PreexamDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"RIS_OBP_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"},{xtype:"button",itemId:"RIS_OBP_PrevDayBtn",ui:"confirm-back",width:"90px",text:"前一日"},{xtype:"button",itemId:"RIS_OBP_TodayBtn",width:"70px",text:"今日"},{xtype:"button",itemId:"RIS_OBP_NextDayBtn",ui:"confirm-forward",width:"90px",text:"後一日"}]}],listeners:[{fn:"onRIS_OBP_PreexamDatePickerChange",event:"change",delegate:"#RIS_OBP_PreexamDatePicker"},{fn:"onRIS_OBP_RefreshBtnTap",event:"tap",delegate:"#RIS_OBP_RefreshBtn"},{fn:"onRIS_OBP_PrevDayBtnTap",event:"tap",delegate:"#RIS_OBP_PrevDayBtn"},{fn:"onRIS_OBP_TodayBtnTap",event:"tap",delegate:"#RIS_OBP_TodayBtn"},{fn:"onRIS_OBP_NextDayBtnTap",event:"tap",delegate:"#RIS_OBP_NextDayBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRIS_OBP_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(a)}},onRIS_OBP_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#RIS_OBP_PreexamDatePicker").getValue())},onRIS_OBP_PrevDayBtnTap:function(b,d,a){this.down("#RIS_OBP_PreexamDatePicker").setValue(Ext.Date.add(this.down("#RIS_OBP_PreexamDatePicker").getValue(),Ext.Date.DAY,-1))},onRIS_OBP_TodayBtnTap:function(b,d,a){this.down("#RIS_OBP_PreexamDatePicker").setValue(new Date())},onRIS_OBP_NextDayBtnTap:function(b,d,a){this.down("#RIS_OBP_PreexamDatePicker").setValue(Ext.Date.add(this.down("#RIS_OBP_PreexamDatePicker").getValue(),Ext.Date.DAY,1))},onContainerDestroy:function(a){if(Ext.getStore("sRisObservedPatients")!=null){Ext.getStore("sRisObservedPatients").removeAll();Ext.getStore("sRisObservedPatients").destroy()}console.log("On Destroy :","RIS.ObservedPatient");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadPatientList(this.down("#RIS_OBP_PreexamDatePicker").getValue())}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sRisObservedPatients"))){Ext.create("Ext.data.Store",{storeId:"sRisObservedPatients",model:"NisTRApp.model.RIS.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"RIS/search/QueryRisObservedPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sRisObservedPatients").addListener("load",function(g,f,j,e,h){NisTRApp.view.GridUtility.onChangeRISClosedSelect("RIS_ObservedPatGrid")},this);var a=this;var b=Ext.getCmp("RIS_ObservedPatGrid");if(b==null){b=NisTRApp.view.GridUtility.GenRISPatientGrid("RIS_ObservedPatGrid","RIS排程清單",null,false);b.getTitleBar().hide();var d=Ext.getStore("sRisObservedPatients");b.setStore(d);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapRISGrid,b);this.down("#RIS_OBP_MainPanel").add(b);b=null;delete b;d=null;delete d}this.down("#RIS_OBP_PreexamDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadPatientList:function(a){if(Ext.getStore("sRisObservedPatients").isLoading()){return}var b=Ext.getStore("sRisObservedPatients");b.getProxy().setExtraParams({PreExamDate:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.WorkList.WB",{extend:Ext.Container,alias:"widget.WL_WB",config:{height:"100%",width:"100%",listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){console.log("On Destroy :","WorkList.WB");this.removeAll(true,true)}});Ext.define("NisTRApp.view.VitalSigns.INP_PainScort",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"VSIPS_Main",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"top",itemId:"VSIPS_FnBar",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"400px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"VSIPS_BegDate",width:"55%",label:"日期",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2012,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"VSIPS_EndDate",width:"45%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"VSIPS_RefreshBtn",ui:"decline",width:"90px",iconCls:"refresh",text:"查詢"},{xtype:"button",itemId:"VSIPS_INPPreBtn",ui:"confirm-back",width:"90px",text:"前七天"},{xtype:"button",itemId:"VSIPS_INPNextBtn",ui:"confirm-forward",width:"90px",text:"後七天"}]},{xtype:"panel",flex:0.9,hidden:false,itemId:"VSISP_Content",layout:{type:"fit"},items:[{xtype:"list",itemId:"VSIVP_ContentList",ui:"round",disableSelection:false,emptyText:'<div style="width:auto; text-align:center; padding-top:5%; color:red; font-weight:bold;">無疼痛評估記錄.</div>',itemTpl:["","",'<tpl if= "OpenRecordID != null && OpenRecordID != &quot;&quot;">',"","<table>",'<tr align="left" width="100%">',"    ",'    <td   BGColor="PaleTurquoise" rowspan="1" align="left" width="100%">','        <span style="font-weight:bold;color:black;"> 標題 : </span><span style="color:blue;">{Title}&nbsp;-&nbsp;{SubTitle}</span><br line-height:0.1px;>',"    	<br line-height:0.1px;>","    </td>","    ","</tr>","      ",'    <tpl for="values">','        <tr align="left" width="100%">  ','         <td BGColor="Linen" align="left">  ','			<span  style="font-size:14pt; font-weight:bold;color:black;">記錄日期: </span><span style="color:blue;">{MedicalDateFormat}&nbsp;&nbsp;{MedicalTimeFormat}</span>&nbsp;&nbsp;','             <span style="font-weight:bold;color:black;">記錄者:  </span><span style="color:blue;">{NurseName}</span><br line-height:0.1px;>','             <span style="font-weight:bold;color:black;">評值:</span>&nbsp;<span style="color:blue;">{Value}</span>',"    		<br line-height:0.1px;>",'            <span style="font-weight:bold;color:black;">記錄內容:  </span>',"            ",'            <tpl if= "Html != null && Html != &quot;&quot;">',"                <br line-height:0.1px;>",'                <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Html} </pre></span>',"            </tpl>     ","    		<br line-height:0.1px;><br line-height:0.1px;>","","       	 </td>","            ","      	</tr>",'         <tr align="left" width="100%">',"            <td><br line-height:0.1px;></td>","        </tr>","        ","    </tpl>","","","    ","</table>",""," </tpl>"]}]},{xtype:"panel",flex:1.1,html:'<div id="_painScortDiv" style="height:400px !important; width: 100% !important;"><p>initial</p></div>',id:"VSISP_Graphic",itemId:"VSISP_Graphic"}]}],listeners:[{fn:"onVSIPS_RefreshBtnTap",event:"tap",delegate:"#VSIPS_RefreshBtn"},{fn:"onVSIPS_INPPreBtnTap",event:"tap",delegate:"#VSIPS_INPPreBtn"},{fn:"onVSIPS_INPNextBtnTap",event:"tap",delegate:"#VSIPS_INPNextBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onVSIPS_RefreshBtnTap:function(b,d,a){this.LoadData()},onVSIPS_INPPreBtnTap:function(b,d,a){this.down("#VSIPS_BegDate").setValue(Ext.Date.add(this.down("#VSIPS_BegDate").getValue(),Ext.Date.DAY,-7));this.down("#VSIPS_EndDate").setValue(Ext.Date.add(this.down("#VSIPS_EndDate").getValue(),Ext.Date.DAY,-7));this.LoadData()},onVSIPS_INPNextBtnTap:function(b,d,a){this.down("#VSIPS_BegDate").setValue(Ext.Date.add(this.down("#VSIPS_BegDate").getValue(),Ext.Date.DAY,7));this.down("#VSIPS_EndDate").setValue(Ext.Date.add(this.down("#VSIPS_EndDate").getValue(),Ext.Date.DAY,7));this.LoadData()},onContainerDestroy:function(a){if(Ext.getStore("sInpPainScortDatas")!=null){Ext.getStore("sInpPainScortDatas").removeAll();Ext.getStore("sInpPainScortDatas").destroy()}if($("#_painScortDiv").highcharts()){$("#_painScortDiv").highcharts().destroy()}$("#_painScortDiv").html("");console.log("On Destroy:","INP_PainScort");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadData()}},RenderPainGraphic:function(b){if($("#_painScortDiv").highcharts()){$("#_painScortDiv").highcharts().destroy()}$("#_painScortDiv").html("");if(Ext.getStore("sInpPainScortDatas").isLoading()){$("#_painScortDiv").html('<div style="width:auto; text-align:center; padding-top:15%; color:red; font-weight:bold;">資料讀取尚未完成.</div>');return}if(Ext.getStore("sInpPainScortDatas").getCount()<=0){$("#_painScortDiv").html('<div style="width:auto; text-align:center; padding-top:15%; color:red; font-weight:bold;">無疼痛評估記錄.</div>');return}try{var d=[];var h=[];var k=new Date("1753-01-01T00:00:00");k.setTime(k.getTime()+(k.getTimezoneOffset()*60*1000));var l={min:new Date().getTime(),max:k.getTime()};var g;var a=["99E6FF","33CCFF","3DF500","00C230","F5B800","FFCC33","FF8533","FF6600","E65C00","E60017","FF0000"];var f=$("#_painScortDiv");var m=Ext.getStore("sInpPainScortDatas");m.each(function(y,s,o){var x=["Solid","ShortDash","ShortDot","ShortDashDot","ShortDashDotDot","Dot","Dash","LongDash","DashDot","LongDashDot","LongDashDotDot"];var p=0;var u=["line","column","line"];var q=0;var v=[];var r=y.raw;y.raw.values.forEach(function n(D,A,E){var C=new Date(D.MedicalDate);var B=C.getTime();l.min=(B<=l.min)?B:l.min;l.max=(B>=l.max)?B:l.max;if(D.Value){var z="black";if(D.Value<=10){z="#"+a[D.Value-0]}v.push({x:B,y:D.Value-0,unit:D.Unit});if(D.Unit.length==0){v[v.length-1].color=z}}});switch(r.Type){case"line":p=0;q=0;break;case"dot":p=2;q=2;break;case"bar":p=0;q=1;break}var w=r.SubTitle||r.Title;var e=-1;$(d).each(function(z,A){if(this.title.text==w){e=z}});if(e==-1){d.push({title:{text:w},min:0,lineColor:"#1A1A1A",tickColor:"#000000",lineWidth:1,opposite:false,labels:{style:{color:"#000000"}}});if(r.Type.toLowerCase()=="line"){d[d.length-1].max=11}e=d.length-1;v=v.sort(function(A,z){if(A.x>z.x){return 1}if(A.x<z.x){return -1}return 0});h.push({name:w,OpenRecordID:r.OpenRecordID,yAxis:e,type:u[q],dashStyle:x[p],marker:{fillColor:null,lineWidth:(p==0&&q==0)?0:5,lineColor:null},data:v});if(q==1){h[h.length-1].color="darkblue"}if(q==2){h[h.length-1].lineWidth=0;h[h.length-1].color="red";h[h.length-1].marker={fillColor:"red",lineColor:"red",lineWidth:3,symbol:"diamond"}}}else{$(h).each(function(){if(this.name==w&&this.yAxis==e){var z=this.data;$(v).each(function(){z.push(this)});z=z.sort(function(B,A){if(B.x>A.x){return 1}if(B.x<A.x){return -1}return 0});this.data=z}})}r=null;delete r;x=null;delete x;p=null;delete p;u=null;delete u;q=null;delete q;v=null;delete v});var g={chart:{zoomType:"",height:$("#VSISP_Graphic")[0].clientHeight-10,margin:[null,null,60,null],backgroundColor:"#eee"},credits:{enabled:false},title:{text:null},subtitle:{text:null},rangeSelector:{buttons:[{type:"day",count:1,text:"1d"},{type:"day",count:3,text:"3d"},{type:"week",count:1,text:"1w"},{type:"week",count:3,text:"3w"},{type:"month",count:1,text:"1m"},{type:"all",text:"All"}],selected:2},tooltip:{xDateFormat:'<span style="font-size: 11pt;">%Y-%m-%d %H:%M:%S</span>',shared:true,crosshairs:true,pointFormat:'<span style="font-size: 12pt;"><span style="font-size: 12pt; color:{series.color};">{series.name}</span>: <span style=" font-size: 12pt; font-weight: bold;">{point.y} {point.unit}</span></span><br/>'},plotOptions:{line:{dataLabels:{enabled:true,formatter:function(){if(this.point.unit.length==0){return'<span style="color: #'+a[this.y]+';">'+this.y+"</span>"}else{return}},useHTML:true,y:-3,style:{fontSize:"12pt"}},events:{hide:function(o){var n=Ext.getStore("sInpPainScortDatas");var p=function(e){return !(e.data.OpenRecordID==o.target.options.OpenRecordID)};n.filter(new Ext.util.Filter({id:o.target.options.OpenRecordID,filterFn:p}));n=null;delete n;p=null;delete p},show:function(q){var p=Ext.getStore("sInpPainScortDatas");var o=p.getFilters();p.clearFilter();if(null!=o){for(var n=0;n<o.length;n++){if(o[n].getId()!=q.target.options.OpenRecordID){p.filter(o[n])}o[n]=null}}o.length=0;o=null;delete o;p=null;delete p},}},column:{pointWidth:15},series:{}},legend:{align:"center",verticalAlign:"bottom",y:10,floating:true,borderWidth:0},xAxis:{type:"datetime",min:l.min,max:l.max,dateTimeLabelFormats:{millisecond:"%H:%M:%S.%L",second:"%H:%M:%S",minute:"%H:%M",hour:"%H:%M",day:"%y-%m-%d",month:"%Y/%B",year:"%Y"},startOnTick:true,endOnTick:true,minRange:36000000,minorTickInterval:36000000*4,gridLineWidth:1,lineColor:"#000",tickColor:"#000",labels:{style:{color:"#000",font:"11px Trebuchet MS, Verdana, sans-serif"}},title:{style:{color:"#333",fontWeight:"bold",fontSize:"12px",fontFamily:"Trebuchet MS, Verdana, sans-serif"}}},yAxis:d,series:h};f.highcharts(g);d=null;delete d;h=null;delete h;k=null;delete k;l=null;delete l;g=null;delete g;f=null;delete f;m=null;delete m}catch(j){console.error(j);document.getElementById("_painScortDiv").innerHTML="";$("#_painScortDiv").html("")}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)||Ext.isEmpty(this.getRecord().raw.Ipbinp)){Ext.Msg.alert("INP_PainScore 住院資料錯誤");return false}var b=this.getRecord().getIpbinp();if(!Ext.isEmpty(b.data.OutDate)&&!Ext.isEmpty(b.data.InDate)){var a=NisTRApp.view.DateUtil.StrToDateTime(b.data.InDate);var d=Ext.Date.add(a,Ext.Date.DAY,7);this.down("#VSIPS_BegDate").setValue(a);this.down("#VSIPS_EndDate").setValue(d);a=null;delete a;d=null;delete d}else{this.down("#VSIPS_BegDate").setValue(NisTRApp.view.DateUtil.GetWeekFirstDay());this.down("#VSIPS_EndDate").setValue(NisTRApp.view.DateUtil.GetWeekLastDay())}if(Ext.data.ModelManager.getModel("mPainScortValue")==null){Ext.define("mPainScortValue",{extend:Ext.data.Model,config:{fields:[{name:"MasterID",type:"string"},{name:"MedicalDate",type:"date"},{name:"Value",type:"string"},{name:"Html",type:"string"},{name:"NurseName",type:"string"},{name:"MedicalDateFormat",type:"string"},{name:"MedicalTimeFormat",type:"string"}]}})}if(Ext.data.ModelManager.getModel("mPainScortData")==null){Ext.define("mPainScortData",{extend:Ext.data.Model,config:{fields:[{name:"Discontinue",type:"string"},{name:"DiscontinueDate",type:"date"},{name:"OpenRecordID",type:"string"},{name:"SubTitle",type:"string"},{name:"Title",type:"string"},{name:"Type",type:"string"}],hasMany:[{associatedName:"values",associationKey:"values",foreignKey:"values",primaryKey:"MasterID",model:"mPainScortValue",name:"values"}]}})}if(Ext.isEmpty(Ext.getStore("sInpPainScortDatas"))){Ext.create("Ext.data.Store",{storeId:"sInpPainScortDatas",clearOnPageLoad:false,model:"mPainScortData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},extraParams:{InpNo:this.getRecord().data.InpNO},url:SYS_CONST.ApiRoot+"Form/PainScoreList.ashx",reader:{type:"json"}}})}Ext.getStore("sInpPainScortDatas").addListener("beforeload",function(f,e,g){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sInpPainScortDatas").addListener("load",function(g,f,j,e,h){this.RenderPainGraphic(this);this.setMasked(false)},this);this.down("#VSIVP_ContentList").setStore(Ext.getStore("sInpPainScortDatas"))},LoadData:function(){if(Ext.isEmpty(this.getRecord())){return}if(Ext.getStore("sInpPainScortDatas").isLoading()){return}var b=this.getRecord();var a=Ext.getStore("sInpPainScortDatas");a.removeAll();a.clearFilter();a.getProxy().setExtraParams({InpNo:this.getRecord().data.InpNO,BegDate:this.down("#VSIPS_BegDate").getFormattedValue("Ymd"),EndDate:this.down("#VSIPS_EndDate").getFormattedValue("Ymd")});a.load();a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.OUT_LINK_INP_PatInfoBar",{extend:Ext.Toolbar,alias:"widget.OUT_LINK_INP_PatInfoBar",config:{docked:"top",height:55,inpPatient:{},userInfo:{},items:[{xtype:"label",html:"Patient Name",itemId:"PP_PtNameLbl",left:"30px",tpl:Ext.create("Ext.XTemplate","<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="110px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="280px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"    {BirthdayStr} ({Age}) {BloodType} &nbsp;","</span>",'<span style="font-weight: bold;color:red; font-size: 13px;">',"    {[this.IsMutiBloodStr(values.IsMutiBlood)]}&nbsp;","</span>",'<span style="font-weight: bold;color:#ff66ff; font-size: 13px;">',"   ","</span>",'    <br style="line-height:0.1;">','    <tpl for="Ipbinp">','    <span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        Dr.{NowDocName1} / {NowDocName2} </span>",'    <span style="font-weight:bold; color:Linen;font-size: 13px;">',"         {NowStationno}-{NowBedNo}</span>","    </tpl>","</td>","</tr>","</table>","","","","",{IsMutiBloodStr:function(b){var a="";if(b==true){a="(多)"}return a}})},{xtype:"button",html:"<h1>Notes</h1>",itemId:"PP_PatNotesBtn",right:"10px",top:"4px",width:"130px",iconCls:"user",text:"MyButton18"}]},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)){this.down("#PP_PtNameLbl").setRecord(null)}var f=this.getRecord();this.down("#PP_PtNameLbl").setRecord(f);var b="",g="",v="",l="",u="",q="",a="";var m="",o="",e="",k="",p="",n="";var j="round",h="round",d="round",r="round",s="round";b="color:white;";g="color:white;";v="color:white;";l="color:white;";u="color:white;";if(f.data.Risk=="N"){b="color:grey;";j="round"}else{j="decline-round"}if(f.data.Allergy==0){g="";h="confirm-round"}else{if(f.data.Allergy==1){h="decline-round"}else{h="round"}}if(f.data.IcdType==""){v="color:grey;";d="round"}else{d="decline-round"}if(f.data.Suicide==""){l="color:grey;";r="round"}else{r="decline-round"}if(f.data.Dnr==""){u="color:grey;";s="round"}else{s="decline-round"}this.down("#PP_PatNotesBtn").setHtml("");this.down("#PP_PatNotesBtn").setHtml("<h1>"+this.getUserInfo().data.UserName+"</h1>");b=null;delete b;g=null;delete g;v=null;delete v;l=null;delete l;u=null;delete u;f=null;delete f}});Ext.define("NisTRApp.view.WorkList.ENDO.InPatientList",{extend:Ext.Container,alias:"widget.ENDO_InPatientList",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"WL_ENDO_Head_ToolBar",items:[{xtype:"selectfield",itemId:"ENDO_OPL_ExamFloor",width:300,label:"檢查地點",labelWidth:"35%",options:[{text:"B1內視鏡清單",value:"B1"},{text:"3F內視鏡清單",value:"3F"},{text:"Others",value:"others"}]},{xtype:"selectfield",itemId:"ENDO_OPL_ExamRoom",label:"檢查室",options:[{text:"ALL",value:"ALL"},{text:"R1",value:"R1"},{text:"R2",value:"R2"},{text:"R3",value:"R3"}]},{xtype:"segmentedbutton",itemId:"ENDO_IPL_NOON_FnBtn",width:"35%",items:[{xtype:"button",flex:1,itemId:"ENDO_IPLNOON_AllBtn",text:"全部"},{xtype:"button",flex:1,itemId:"ENDO_IPLNOON_NoArrBtn",text:"上午"},{xtype:"button",flex:1,itemId:"ENDO_IPLNOON_ArrBtn",text:"下午"}]}]},{xtype:"panel",itemId:"ENDO_IPL_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"WL_ENDO_Foot_ToolBar",items:[{xtype:"datepickerfield",itemId:"ENDO_IPL_SchedDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"segmentedbutton",itemId:"ENDO_IPL_FnBtn",width:"55%",items:[{xtype:"button",flex:1,itemId:"ENDO_IPL_AllBtn",text:"全部"},{xtype:"button",flex:1,itemId:"ENDO_IPL_NoArrBtn",text:"未報到"},{xtype:"button",flex:1,itemId:"ENDO_IPL_ArrBtn",text:"已報到"},{xtype:"button",flex:1,itemId:"ENDO_IPL_PrepareBtn",text:"準備中"},{xtype:"button",flex:1,itemId:"ENDO_IPL_CheckInBtn",text:"檢查中"},{xtype:"button",flex:1.3,hidden:true,itemId:"ENDO_IPL_CheckOutBtn",text:"檢查完成"},{xtype:"button",flex:1,itemId:"ENDO_IPL_RecoveBtn",text:"恢復中"},{xtype:"button",flex:1.3,itemId:"ENDO_IPL_LeaveBtn",text:"病人離開"}]},{xtype:"button",itemId:"ENDO_IPL_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"},{xtype:"searchfield",itemId:"ENDO_IPL_SearchField",width:"15%",labelWidth:0,placeHolder:"病人ID"}]}],listeners:[{fn:"onENDO_OPL_ExamFloorChange",event:"change",delegate:"#ENDO_OPL_ExamFloor"},{fn:"onENDO_OPL_ExamRoomChange",event:"change",delegate:"#ENDO_OPL_ExamRoom"},{fn:"onENDO_IPLNOON_AllBtnTap",event:"tap",delegate:"#ENDO_IPLNOON_AllBtn"},{fn:"onENDO_IPLNOON_NoArrBtnTap",event:"tap",delegate:"#ENDO_IPLNOON_NoArrBtn"},{fn:"onENDO_IPLNOON_ArrBtnTap",event:"tap",delegate:"#ENDO_IPLNOON_ArrBtn"},{fn:"onENDO_IPL_SchedDatePickerChange",event:"change",delegate:"#ENDO_IPL_SchedDatePicker"},{fn:"onENDO_IPL_AllBtnTap",event:"tap",delegate:"#ENDO_IPL_AllBtn"},{fn:"onENDO_IPL_NoArrBtnTap",event:"tap",delegate:"#ENDO_IPL_NoArrBtn"},{fn:"onENDO_IPL_ArrBtnTap",event:"tap",delegate:"#ENDO_IPL_ArrBtn"},{fn:"onENDO_IPL_PrepareBtnTap",event:"tap",delegate:"#ENDO_IPL_PrepareBtn"},{fn:"onENDO_IPL_CheckInBtnTap",event:"tap",delegate:"#ENDO_IPL_CheckInBtn"},{fn:"onENDO_IPL_CheckOutBtnTap",event:"tap",delegate:"#ENDO_IPL_CheckOutBtn"},{fn:"onENDO_IPL_RecoveBtnTap",event:"tap",delegate:"#ENDO_IPL_RecoveBtn"},{fn:"onENDO_IPL_LeaveBtnTap",event:"tap",delegate:"#ENDO_IPL_LeaveBtn"},{fn:"onENDO_IPL_RefreshBtnTap",event:"tap",delegate:"#ENDO_IPL_RefreshBtn"},{fn:"onENDO_IPL_SearchFieldFocus",event:"focus",delegate:"#ENDO_IPL_SearchField"},{fn:"onENDO_IPL_SearchFieldKeyup",event:"keyup",delegate:"#ENDO_IPL_SearchField"},{fn:"onENDO_IPL_SearchFieldCenteredChange",event:"centeredchange",delegate:"#ENDO_IPL_SearchField"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onENDO_OPL_ExamFloorChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#ENDO_IPL_SchedDatePicker").getValue(),this.down("#ENDO_OPL_ExamFloor").getValue(),this.down("#ENDO_OPL_ExamRoom").getValue())}},onENDO_OPL_ExamRoomChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#ENDO_IPL_SchedDatePicker").getValue(),this.down("#ENDO_OPL_ExamFloor").getValue(),this.down("#ENDO_OPL_ExamRoom").getValue())}},onENDO_IPLNOON_AllBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_NOON_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPLNOON_StatusFilter",function(e){return true})},onENDO_IPLNOON_NoArrBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_NOON_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPLNOON_StatusFilter",function(e){return(e.data.AMPM=="AM")})},onENDO_IPLNOON_ArrBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_NOON_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPLNOON_StatusFilter",function(e){return(e.data.AMPM=="PM")})},onENDO_IPL_SchedDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#ENDO_IPL_SchedDatePicker").getValue(),this.down("#ENDO_OPL_ExamFloor").getValue(),this.down("#ENDO_OPL_ExamRoom").getValue())}},onENDO_IPL_AllBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return true})},onENDO_IPL_NoArrBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="NA")})},onENDO_IPL_ArrBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="A")})},onENDO_IPL_PrepareBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="P")})},onENDO_IPL_CheckInBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="ES")})},onENDO_IPL_CheckOutBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="EE")})},onENDO_IPL_RecoveBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="R"||e.data.ExamStatusFlag=="O")})},onENDO_IPL_LeaveBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_IPL_FnBtn"),b,"confirm-round","normal","","");this.SetInPatientFilter("ENDO_IPL_StatusFilter",function(e){return(e.data.ExamStatusFlag=="F")})},onENDO_IPL_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#ENDO_IPL_SchedDatePicker").getValue(),this.down("#ENDO_OPL_ExamFloor").getValue(),this.down("#ENDO_OPL_ExamRoom").getValue())},onENDO_IPL_SearchFieldFocus:function(b,d,a){this.down("#ENDO_IPL_AllBtn").fireEvent("tap",this.down("#ENDO_IPL_AllBtn"),null,null);this.down("#ENDO_IPLNOON_AllBtn").fireEvent("tap",this.down("#ENDO_IPLNOON_AllBtn"),null,null)},onENDO_IPL_SearchFieldKeyup:function(b,d,a){var f=Ext.getStore("sEndoInPatients");if(b.getValue()==""){f.clearFilter(true);f.filter("","");return}else{if(d.browserEvent.keyCode==8){f.clearFilter(true);f.filter("","")}f.filterBy(function(e,h){var g=String(b.getValue()).toLowerCase();if(e.get("PatIdno").toLowerCase().indexOf(g)>-1||e.get("ChartNO").toLowerCase().indexOf(g)>-1){return true}return false})}f=null;delete f},onENDO_IPL_SearchFieldCenteredChange:function(b,e,a,d){Ext.getStore("sEndoInPatients").clearFilter(true);Ext.getStore("sEndoInPatients").filter("","")},onContainerDestroy:function(a){if(Ext.getStore("sEndoInPatients")!=null){Ext.getStore("sEndoInPatients").removeAll();Ext.getStore("sEndoInPatients").destroy()}this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPatientList(this.down("#ENDO_IPL_SchedDatePicker").getValue(),this.down("#ENDO_OPL_ExamFloor").getValue(),this.down("#ENDO_OPL_ExamRoom").getValue());this.setInitialFlag(false)}},initialize:function(){this.callParent();if(Ext.getStore("sEndoInPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.ENDO.SchuleData",storeId:"sEndoInPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoPatients.ashx",reader:{type:"json"}}})}this.down("#ENDO_IPL_SchedDatePicker").setValue(new Date());var a=this;var e=Ext.getCmp("ENDO_InPatGrid");if(e==null){e=NisTRApp.view.GridUtility.GenENDOInPatientGrid("ENDO_InPatGrid","ENDO排程清單",null,false);e.initialFlag=true;e.getTitleBar().hide();var d=Ext.getStore("sEndoInPatients");e.setStore(d);e.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapENDOGrid,e);this.down("#ENDO_IPL_MainPanel").add(e);e.addListener("painted",NisTRApp.view.UserConfig.onPainted_EndoInPatGrid,e);var b=e.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_EndoInPatGrid,e);e=null;delete e;d=null;delete d}Ext.getStore("sEndoInPatients").addListener("load",function(h,g,k,f,j){NisTRApp.view.GridUtility.onChangeENDOLeaveSelect("ENDO_InPatGrid");NisTRApp.view.GridUtility.onChangeENDOObsRoomSelect("ENDO_InPatGrid")},this);a=null;delete a;this.down("#ENDO_IPL_AllBtn").fireEvent("tap",this.down("#ENDO_IPL_AllBtn"),null,null);this.down("#ENDO_IPLNOON_AllBtn").fireEvent("tap",this.down("#ENDO_IPLNOON_AllBtn"),null,null)},LoadPatientList:function(d,e,b){if(Ext.getStore("sEndoInPatients").isLoading()){return}var a=Ext.getStore("sEndoInPatients");a.getProxy().setExtraParams({SchedDate:d,ExamFloor:e,ExamRoom:b});a.load();a=null;delete a},SetInPatientFilter:function(d,e){var b=Ext.getStore("sEndoInPatients");var f=b.getFilters();b.clearFilter();if(null!=f){for(var a=0;a<f.length;a++){if(f[a].getId()!=d){b.filter(f[a])}f[a]=null}}b.filter(new Ext.util.Filter({id:d,filterFn:e}));f.length=0;f=null;delete f;b=null;delete b}});Ext.define("NisTRApp.view.ENDO.WorkList",{extend:Ext.Container,alias:"widget.ENDO_WorkList",statics:{initialModelStore:function(){if(Ext.data.ModelManager.getModel("EndoObvBedOptions")==null){Ext.define("EndoObvBedOptions",{extend:Ext.data.Model,config:{fields:[{name:"obvfloor",type:"string"},{name:"obvroom",type:"string"},{name:"text",type:"string"},{name:"value",type:"string"}]}})}if(Ext.getStore("sEndoObvRooms")==null){Ext.create("Ext.data.Store",{storeId:"sEndoObvRooms",clearOnPageLoad:false,model:"EndoObvBedOptions",data:[{obvfloor:"B1",obvroom:"NA",text:"請選擇",value:"NA-NA"},{obvfloor:"B1",obvroom:"R1",text:"B1-R1",value:"B1-R1"},{obvfloor:"B1",obvroom:"R2",text:"B1-R2",value:"B1-R2"},{obvfloor:"B1",obvroom:"R3",text:"B1-R3",value:"B1-R3"},{obvfloor:"B1",obvroom:"R4",text:"B1-R4",value:"B1-R4"},{obvfloor:"B1",obvroom:"R5",text:"B1-R5",value:"B1-R5"},{obvfloor:"B1",obvroom:"R6",text:"B1-R6",value:"B1-R6"},{obvfloor:"B1",obvroom:"R7",text:"B1-R7",value:"B1-R7"},{obvfloor:"B1",obvroom:"C1",text:"B1-C1",value:"B1-C1"},{obvfloor:"B1",obvroom:"C2",text:"B1-C2",value:"B1-C2"},{obvfloor:"B1",obvroom:"C3",text:"B1-C3",value:"B1-C3"},{obvfloor:"3F",obvroom:"NA",text:"請選擇",value:"NA-NA"},{obvfloor:"3F",obvroom:"R1",text:"3F-R1",value:"3F-R1"},{obvfloor:"3F",obvroom:"R2",text:"3F-R2",value:"3F-R2"},{obvfloor:"3F",obvroom:"R3",text:"3F-R3",value:"3F-R3"},{obvfloor:"3F",obvroom:"R4",text:"3F-R4",value:"3F-R4"},{obvfloor:"3F",obvroom:"R5",text:"3F-R5",value:"3F-R5"},{obvfloor:"3F",obvroom:"R6",text:"3F-R6",value:"3F-R6"},{obvfloor:"3F",obvroom:"R7",text:"3F-R7",value:"3F-R7"},{obvfloor:"3F",obvroom:"R8",text:"3F-R8",value:"3F-R8"},{obvfloor:"3F",obvroom:"R9",text:"3F-R9",value:"3F-R9"},{obvfloor:"3F",obvroom:"R10",text:"3F-R10",value:"3F-R10"}]})}}},config:{stopDistroyEvent:false,initialFlag:true,modifyFlag:false,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"panel",itemId:"ENDOWK_MainPanel",width:"100%",layout:{type:"hbox"},items:[{xtype:"list",flex:1,itemId:"ENDOWK_List",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無工作清單.</div>',itemTpl:Ext.create("Ext.XTemplate","<table >","<tr>",'<td id={ItemName} rowspan="1" align="left" width="220px">    {ItemName} </td>','<td width="10px" align="left">&nbsp;&nbsp;</td>  ',"    ",'<td rowspan="1" align="right" width="64px">',"    ",'     <img name="img" src={[this.FinishChk(values.IsFinished)]} style="width:40px;height:40px;">'," </td>",'<td rowspan="1" align="right" width="300px">',"    ","    <span>{DisplayMsg}</span>"," </td>    ","</tr>","     ","</table>","",{FinishChk:function(a){if(a){return"../_/img/FrmFinish.png"}else{return"../_/img/FrmAdd.png"}}})},{xtype:"formpanel",flex:1,itemId:"ENDOPS_MainPanel",width:"",items:[{xtype:"fieldset",itemId:"ENDOPS_MainSet",items:[{xtype:"textfield",itemId:"AccSwTxt",label:"Field",labelWidth:"99%"},{xtype:"checkboxfield",disabled:false,hidden:true,itemId:"AccSwChk",label:"已報到 (08:37:49)",labelWidth:"60%",name:"AccSw",checked:true},{xtype:"checkboxfield",itemId:"PrepareSwChk",label:"準備中 (10:39:41)",labelWidth:"60%",name:"PrepareSw",checked:true},{xtype:"textfield",hidden:true,itemId:"ExamStartTxt",label:"Field",labelWidth:"99%"},{xtype:"checkboxfield",disabled:false,hidden:false,itemId:"ExamStartChk",label:"檢查中 (11:00:03)",labelWidth:"60%",name:"ExamStart",checked:true},{xtype:"textfield",itemId:"ExamFinishedTxt",label:"Field",labelWidth:"99%"},{xtype:"checkboxfield",itemId:"RecoverSwChk",label:"恢復中",labelWidth:"60%",name:"RecoverSw"},{xtype:"checkboxfield",disabled:false,hidden:true,itemId:"ExamFinishedChk",label:"檢查完成",labelWidth:"60%",name:"ExamFinished"},{xtype:"checkboxfield",itemId:"FinishedSwChk",label:"病人離開",labelWidth:"60%",name:"FinishedSw"}]}]}]},{xtype:"toolbar",docked:"bottom",itemId:"ENDOWK_FootBar",items:[{xtype:"button",itemId:"ENDOWK_CloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"},{xtype:"button",itemId:"ENDOWK_RefershBtn",ui:"decline",width:"20%",text:"重 新 整 理"},{xtype:"selectfield",itemId:"ENDOWK_obvRoomSelectField",width:"25%",label:"留觀床位",labelWidth:"35%"},{xtype:"label",html:'<div> 	<table> 		<tr> 			<td> 				<span id="ENDOWK_FINISH_SPAN" patkey="" style="padding-right:10px;">已完成</span>  			</td> 			<td> 				<img id="ENDOWK_FINISH_IMG" patkey="" check="N" src="../_/img/unchecked-checkbox-icon.png" alt="Smiley face" height="35" width="35"> 			</td>  			<td> 				<span id="ENDOWK_UNDO_SPAN"  patkey="" style="padding-right:10px; padding-left:45px;">病人未作</span>  			</td> 			<td> 				<img id="ENDOWK_UNDO_IMG" patkey="" check="N" src="../_/img/unchecked-checkbox-icon.png" alt="Smiley face" height="35" width="35"> 			</td>  		</tr> 	</table>  </div>',itemId:"ENDOWK_PAT_LBL"}]}],listeners:[{fn:"onENDOWK_ListItemTap",event:"itemtap",delegate:"#ENDOWK_List"},{fn:"onAccSwChkChange",event:"change",delegate:"#AccSwChk"},{fn:"onPrepareSwChkChange",event:"change",delegate:"#PrepareSwChk"},{fn:"onExamStartChkChange",event:"change",delegate:"#ExamStartChk"},{fn:"onRecoverSwChkChange",event:"change",delegate:"#RecoverSwChk"},{fn:"onExamFinishedChkChange",event:"change",delegate:"#ExamFinishedChk"},{fn:"onFinishedSwChkChange",event:"change",delegate:"#FinishedSwChk"},{fn:"onENDOWK_CloseBtnTap",event:"tap",delegate:"#ENDOWK_CloseBtn"},{fn:"onENDOWK_RefershBtnTap",event:"tap",delegate:"#ENDOWK_RefershBtn"},{fn:"onENDOWK_obvRoomSelectFieldChange",event:"change",delegate:"#ENDOWK_obvRoomSelectField"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"}]},onENDOWK_ListItemTap:function(f,h,j,g,k,l){_endoWkFrmEdit_callback_event=function(o){try{if(!Ext.isEmpty(Ext.getStore("sEndoWorkingList"))){Ext.getStore("sEndoWorkingList").load()}if(null!=o&&undefined!=o&&"TempSave"==o){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_wklistFormPanel"))){Ext.getCmp("_wklistFormPanel").destroy()}}}catch(p){console.error("_endoWkFrmEdit_callback_event",p)}};var b=function b(o,v,p){if(Ext.getStore("sEndoWorkingList").isLoading()||Ext.isEmpty(v)||Ext.isEmpty(v.data.GroupID)||Ext.isEmpty(v.data.GroupID<0)||Ext.isEmpty(o)||Ext.isEmpty(o.data.ItemID)){return}var u=g.data.WorkType.split("_");if(Ext.isEmpty(u)||u.length<2){u=null;delete u;Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}var r,s,q;if(v.data.Source.Type==1){r="0";s=v.data.Source.Name;q=(v.data.ChartSeq?v.data.ChartSeq:0)}else{if(v.data.Source.Type==2){r=v.data.InpNO;s=v.data.Source.Name;q=0}else{Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}}if(u[1]=="RenderAssesment"){var e=NisTRApp.view.FormUtil.AssessmentAddr(u[1],o.data.ItemID,NisTRApp.view.SysUtility.GetUserID(),v.data.ChartNo,q,"","","_endoWkFrmEdit_callback_event","",r,s);NisTRApp.view.FormUtil.OpenWorkListForm(e,"_wklistFormPanel",p);e=null;delete e}else{if(u[1]=="RenderHeathTeach"){NisTRApp.view.TRUtility.OpenMainUI(v,SYS_CONST.PageDef.NurHealthTeach,p.getCaller());p.getCaller().destroy()}else{if(u[1]=="Notes"){NisTRApp.view.TRUtility.OpenMainUI(v,SYS_CONST.PageDef.NurNotes,p.getCaller());p.getCaller().destroy()}else{if(u[1]=="RenderPrepare"){NisTRApp.view.TRUtility.OpenMainUI(v,SYS_CONST.PageDef.NurPrepare,p.getCaller());p.getCaller().destroy()}}}}u=null;delete u;r=null;s=null;q=null;delete r;delete s;delete q;v=null;delete v};var d=function d(r,o){if(Ext.isEmpty(r)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){Ext.getCmp("_opdVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_opdVSInputPanel"))){var p=Ext.create("NisTRApp.view.OPD_VitalSignInputPanel",{id:"_opdVSInputPanel",patInfo:r,record:r,success:function(e){if(!Ext.isEmpty(Ext.getStore("sEndoWorkingList"))){Ext.getStore("sEndoWorkingList").load()}}});Ext.Viewport.add(p);p=null;delete p}p.show()}catch(q){console.log(q)}o=null;delete o;return};var a=function a(r,o){if(Ext.isEmpty(r)){return false}try{if(!Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){Ext.getCmp("_inpVSInputPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_inpVSInputPanel"))){var q=Ext.create("NisTRApp.view.INP_VitalSignInputPanel",{id:"_inpVSInputPanel",patInfo:r,record:r,success:function(e){if(!Ext.isEmpty(Ext.getStore("sEndoWorkingList"))){Ext.getStore("sEndoWorkingList").load()}}});Ext.Viewport.add(q);q=null;delete q}q.show()}catch(p){console.log(p)}o=null;delete o;return};var m=this;if(k.event.target.nodeName=="IMG"){if(Ext.isEmpty(g.data.ItemID)||Ext.isEmpty(g.data.WorkType)){k.preventDefault();m=null;delete m;return false}var n=g.data.WorkType.split("_");if(n[0]=="FRM"){b(g,this.getRecord(),m)}else{if(n[0]=="VITALSIGN"&&this.getRecord().data.Source==SYS_CONST.PatSource.OPD){d(this.getRecord(),m)}else{if(n[0]=="VITALSIGN"&&this.getRecord().data.Source==SYS_CONST.PatSource.INP){a(this.getRecord(),m)}else{if(n[0]=="CATH"){NisTRApp.view.TRUtility.OpenMainUI(this.getRecord(),SYS_CONST.PageDef.Cath,m.getCaller());m.getCaller().destroy()}}}}n=null;delete n}k.preventDefault();m=null;delete m;b=null;delete b;d=null;delete d;a=null;delete a;return false},onAccSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.AccDate)&&f==true){Ext.Msg.confirm("Confirm","報到? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateAccFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){console.log(99969,NisTRApp.view.DateUtil.GetSysTimeStr());b.data.AccDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.AccTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.AccMan=NisTRApp.view.SysUtility.GetUserID();b.data.AccSw="A";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.AccDate)&&f==false){Ext.Msg.confirm("Confirm","取消報到? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateAccFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.AccDate="";b.data.AccTime="";b.data.AccMan="";b.data.AccSw="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onPrepareSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.PrepareDate)&&f==true){Ext.Msg.confirm("Confirm","準備中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdatePrepareFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.PrepareDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.PrepareTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.PrepareUser=NisTRApp.view.SysUtility.GetUserID();b.data.PrepareSw="P";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.PrepareDate)&&f==false){Ext.Msg.confirm("Confirm","取消準備? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdatePrepareFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.PrepareDate="";b.data.PrepareTime="";b.data.PrepareUser="";b.data.PrepareSw="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onExamStartChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(!String.IsNull(b.data.ExamendDate)){NisTRApp.view.Misc.Alert("此筆檢查已完成，請先取消檢查完成",0);b=null;delete b;this.Reflush();return}if(String.IsNull(b.data.ExamstartDate)&&f==true){Ext.Msg.confirm("Confirm","檢查中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamStartFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamstartDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.ExamstartTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.ExamFlag="S";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.ExamstartDate)&&f==false){Ext.Msg.confirm("Confirm","取消檢查? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamStartFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamstartDate="";b.data.ExamstartTime="";b.data.ExamFlag="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onRecoverSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.RecoverDate)&&f==true){Ext.Msg.confirm("Confirm","恢復中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateRecoverFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.RecoverDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.RecoverTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.RecoverUser=NisTRApp.view.SysUtility.GetUserID();b.data.RecoverFlag="R";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.RecoverDate)&&f==false){Ext.Msg.confirm("Confirm","取消恢復中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateRecoverFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.RecoverDate="";b.data.RecoverTime="";b.data.RecoverUser="";b.data.RecoverFlag="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onExamFinishedChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.ExamstartDate)){NisTRApp.view.Misc.Alert("此筆檢查尚未開始",0);b=null;delete b;this.Reflush();return}if(String.IsNull(b.data.ExamendDate)&&f==true){Ext.Msg.confirm("Confirm","檢查中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamEndFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamendDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.ExamendTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.ExamFlag="E";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.ExamendDate)&&f==false){Ext.Msg.confirm("Confirm","取消檢查? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamEndFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamendDate="";b.data.ExamednTime="";b.data.ExamFlag="S";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onFinishedSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.FinishDate)&&f==true){Ext.Msg.confirm("Confirm","病人離開? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateFinishedFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.FinishDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.FinishTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.FinishUser=NisTRApp.view.SysUtility.GetUserID();b.data.FinishFlag="F";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.FinishDate)&&f==false){Ext.Msg.confirm("Confirm","取消離開? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateFinishedFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.FinishDate="";b.data.FinishTime="";b.data.FinishUser="";b.data.FinishFlag="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onENDOWK_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onENDOWK_RefershBtnTap:function(b,d,a){this.LoadWorkList()},onENDOWK_obvRoomSelectFieldChange:function(d,b,a,g){if(this.getInitialFlag()){return}var f=this.getRecord();var h="";var j="";var k=b.split("-");h=k[0];j=k[1];var e="";if(h=="NA"){e="取消留觀床位? 病人:"+f.data.PatName}else{e="床位?"+b+" 病人:"+f.data.PatName}Ext.Msg.confirm("Confirm",e,function(m,n,l){if(m=="no"){this.setInitialFlag(true);this.down("#ENDOWK_obvRoomSelectField").setValue(a);this.setInitialFlag(false);f=null;delete f;h=null;delete f;j=null;delete j;e=null;delete e;k=null;delete k;return}else{if(m=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateObservedInfo.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{GroupID:f.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),ObFloor:h,ObRoom:j},success:function(o){Ext.Viewport.setMasked(false);var p=Ext.decode(o.responseText);NisTRApp.view.Misc.Alert(p.Message,(p.Success?800:0));if(p.Success){this.setModifyFlag(true)}else{this.setInitialFlag(true);this.down("#ENDOWK_obvRoomSelectField").setValue(a);this.setInitialFlag(false)}p=null;delete p;f=null;delete f;h=null;delete f;j=null;delete j;p=null;delete p;k=null;delete k},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);this.setInitialFlag(true);this.down("#ENDOWK_obvRoomSelectField").setValue(a);this.setInitialFlag(false);f=null;delete f;h=null;delete f;j=null;delete j;e=null;delete e;k=null;delete k}})}}},this)},onContainerShow:function(b,d){if(Ext.getStore("sEndoWorkingList").getCount()<=0){this.LoadWorkList()}var a=NisTRApp.view.SysUtility.tapEventName();if(undefined!=$("#ENDOWK_FINISH_IMG")&&null!=$("#ENDOWK_FINISH_IMG")){$("#ENDOWK_FINISH_IMG").attr("patkey",this.getRecord().data.KeyOne);$("#ENDOWK_FINISH_IMG").attr("check",Ext.isEmpty(this.getRecord().data.WkFinishedDate)?"N":"Y");$("#ENDOWK_FINISH_IMG").attr("src",Ext.isEmpty(this.getRecord().data.WkFinishedDate)?"../_/img/unchecked-checkbox-icon.png":"../_/img/checkbox-icon.png");$("#ENDOWK_FINISH_IMG").unbind(a);$("#ENDOWK_FINISH_IMG").bind(a,[this],function(f){var h=f.data[0];var j=$(this).attr("patkey").split("_");if(null==j||j.length<=1||null==h){return false}var g=$(this);var k=(g.attr("check")=="N")?"工作完成?":"取消工作完成?";Ext.Msg.confirm("Confirm",k,function(m,n,l){if(m=="no"){k=null;delete k;g=null;delete g;j=null;delete j;h=null;delete h;return}else{if(m=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateWkFinished.ashx",useDefaultXhrHeader:false,method:"POST",scope:h,params:{GroupID:j[1],UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:(g.attr("check")=="N"?"Y":"N")},success:function(o){Ext.Viewport.setMasked(false);var p=Ext.decode(o.responseText);NisTRApp.view.Misc.Alert(p.Message,(p.Success?800:0));if(p.Success){h.setModifyFlag(true);if(g.attr("check")=="N"){h.getRecord().data.WkFinishedDate="Y";g.attr("check","Y");g.attr("src","../_/img/checkbox-icon.png")}else{h.getRecord().data.WkFinishedDate="";g.attr("check","N");g.attr("src","../_/img/unchecked-checkbox-icon.png")}}p=null;delete p;g=null;delete g;j=null;delete j;h=null;delete h},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);g=null;delete g;j=null;delete j;h=null;delete h}})}}},this)})}if(undefined!=$("#ENDOWK_UNDO_IMG")&&null!=$("#ENDOWK_UNDO_IMG")){$("#ENDOWK_UNDO_IMG").attr("patkey",this.getRecord().data.KeyOne);$("#ENDOWK_UNDO_IMG").unbind(a);var e=this;$("#ENDOWK_UNDO_IMG").bind(a,function(){var f=$(this);if(f.attr("check")=="false"){f.attr("check",true);f.attr("src","../_/img/checkbox-icon.png")}else{f.attr("check",false);f.attr("src","../_/img/unchecked-checkbox-icon.png")}f=null;delete f})}if(undefined!=$("#ENDOWK_UNDO_IMG")&&null!=$("#ENDOWK_UNDO_IMG")){$("#ENDOWK_UNDO_IMG").attr("patkey",this.getRecord().data.KeyOne);$("#ENDOWK_UNDO_IMG").attr("check",(Ext.isEmpty(this.getRecord().data.RejectFlag)||this.getRecord().data.RejectFlag=="N")?"N":"Y");$("#ENDOWK_UNDO_IMG").attr("src",(Ext.isEmpty(this.getRecord().data.RejectFlag)||this.getRecord().data.RejectFlag=="N")?"../_/img/unchecked-checkbox-icon.png":"../_/img/checkbox-icon.png");$("#ENDOWK_UNDO_IMG").unbind(a);$("#ENDOWK_UNDO_IMG").bind(a,[this],function(f){var h=f.data[0];var j=$(this).attr("patkey").split("_");if(null==j||j.length<=1||null==h){return false}var g=$(this);var k=(g.attr("check")=="N")?"病人未作?":"取消病人未作?";Ext.Msg.confirm("Confirm",k,function(m,n,l){if(m=="no"){k=null;delete k;g=null;delete g;j=null;delete j;h=null;delete h;return}else{if(m=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateRejectFlag.ashx",useDefaultXhrHeader:false,method:"POST",scope:h,params:{GroupID:j[1],UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:(g.attr("check")=="N"?"Y":"N")},success:function(o){Ext.Viewport.setMasked(false);var p=Ext.decode(o.responseText);NisTRApp.view.Misc.Alert(p.Message,(p.Success?800:0));if(p.Success){h.setModifyFlag(true);if(g.attr("check")=="N"){h.getRecord().data.RejectFlag="Y";g.attr("check","Y");g.attr("src","../_/img/checkbox-icon.png")}else{h.getRecord().data.RejectFlag="N";g.attr("check","N");g.attr("src","../_/img/unchecked-checkbox-icon.png")}}p=null;delete p;g=null;delete g;j=null;delete j;h=null;delete h},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);g=null;delete g;j=null;delete j;h=null;delete h}})}}},this)})}a=null;delete a},onContainerDestroy:function(a){if(this.getModifyFlag()==true&&!Ext.isEmpty(this.getCaller())&&!Ext.isEmpty(this.getCaller().getCaller())&&this.getCaller().getCaller().xtype=="grid"&&!this.getCaller().getCaller().getStore().isLoading()){this.getCaller().getCaller().getStore().load()}if(!Ext.isEmpty(Ext.getStore("sEndoWorkingList"))){Ext.getStore("sEndoWorkingList").removeAll();Ext.getStore("sEndoWorkingList").destroy()}if(!Ext.isEmpty(Ext.getStore("sEndoObvRooms"))){Ext.getStore("sEndoObvRooms").removeAll();Ext.getStore("sEndoObvRooms").destroy()}_endoWkFrmEdit_callback_event=null;delete _endoWkFrmEdit_callback_event;console.log("on destroy :","Endo.WorkList");this.removeAll()},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)){Ext.Msg.alert("ENDO_WorkList 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<0){Ext.Msg.alert("ENDO_WorkList 病人資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sEndoWorkingList"))){Ext.create("Ext.data.Store",{storeId:"sEndoWorkingList",autoLoad:false,model:"NisTRApp.model.mWorkingItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoWorkingItem.ashx",reader:{type:"json"}}})}this.down("#ENDOWK_List").setStore(Ext.getStore("sEndoWorkingList"));NisTRApp.view.ENDO.WorkList.initialModelStore();var a=this.getRecord().data.ExamFloor;if(!Ext.isEmpty(Ext.getStore("sEndoObvRooms"))){Ext.getStore("sEndoObvRooms").clearFilter();Ext.getStore("sEndoObvRooms").filterBy(function(d,e){return(d.data.obvfloor==a)},this)}this.down("#ENDOWK_obvRoomSelectField").setStore(Ext.getStore("sEndoObvRooms"));var b="NA-NA";b=Ext.isEmpty(this.getRecord().data.ObservedFloor)?"NA-NA":(this.getRecord().data.ObservedFloor+"-"+this.getRecord().data.ObservedRoom);this.down("#ENDOWK_obvRoomSelectField").setValue(b);this.Reflush();this.setModifyFlag(false);this.setInitialFlag(false);b=null;delete b},LoadWorkList:function(){if(Ext.getStore("sEndoWorkingList").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sEndoWorkingList");a.removeAll();a.getProxy().setExtraParams({ChartNO:b.data.ChartNO,GroupID:b.data.GroupID,Source:b.data.Source.Name});a.load({callback:function(e,d,f){},scope:this});a=null;delete a},Reflush:function(){this.setInitialFlag(true);var a=this.getRecord();this.down("#AccSwChk").uncheck();this.down("#PrepareSwChk").uncheck();this.down("#ExamStartChk").uncheck();this.down("#RecoverSwChk").uncheck();this.down("#ExamFinishedChk").uncheck();this.down("#FinishedSwChk").uncheck();this.down("#AccSwTxt").setLabel((Ext.isEmpty(a.data.AccDate))?"已報到":("已報到 ("+a.data.AccDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.AccTime)+")"));this.down("#AccSwChk").setLabel((Ext.isEmpty(a.data.AccDate))?"已報到":("已報到 ("+a.data.AccDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.AccTime)+")"));if(!Ext.isEmpty(a.data.AccDate)){this.down("#AccSwChk").check()}this.down("#PrepareSwChk").setLabel((Ext.isEmpty(a.data.PrepareDate))?"準備中":("準備中 ("+a.data.PrepareDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.PrepareTime)+")"));if(!Ext.isEmpty(a.data.PrepareDate)){this.down("#PrepareSwChk").check()}this.down("#ExamStartTxt").setLabel((Ext.isEmpty(a.data.ExamstartDate))?"檢查中":("檢查中 ("+a.data.ExamstartDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamstartTime)+")"));this.down("#ExamStartChk").setLabel((Ext.isEmpty(a.data.ExamstartDate))?"檢查中":("檢查中 ("+a.data.ExamstartDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamstartTime)+")"));if(!Ext.isEmpty(a.data.ExamstartDate)){this.down("#ExamStartChk").check()}this.down("#RecoverSwChk").setLabel((Ext.isEmpty(a.data.RecoverDate))?"恢復中":("恢復中 ("+a.data.RecoverDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.RecoverTime)+")"));if(!Ext.isEmpty(a.data.RecoverDate)){this.down("#RecoverSwChk").check()}this.down("#ExamFinishedTxt").setLabel((Ext.isEmpty(a.data.ExamendDate))?"檢查完成":("檢查完成 ("+a.data.ExamendDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamendTime)+")"));this.down("#ExamFinishedChk").setLabel((Ext.isEmpty(a.data.ExamendDate))?"檢查完成":("檢查完成 ("+a.data.ExamendDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamendTime)+")"));if(!Ext.isEmpty(a.data.ExamendDate)){this.down("#ExamFinishedChk").check()}this.down("#FinishedSwChk").setLabel((Ext.isEmpty(a.data.FinishDate))?"病人離開":("病人離開 ("+a.data.FinishDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.FinishTime)+")"));if(!Ext.isEmpty(a.data.FinishDate)){this.down("#FinishedSwChk").check()}a=null;delete a;this.setInitialFlag(false)}});Ext.define("NisTRApp.view.WorkList.EDNO.CareContainer",{extend:Ext.Container,config:{layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"ENDOCP_MainTabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerActivate",event:"activate"},{fn:"onContainerDestroy",event:"destroy"}]},onContainerActivate:function(f,b,a,d){if(Ext.isEmpty(this.down("#_endoMPLCareContainer"))){var g=Ext.create("NisTRApp.view.WorkList.EDNO.CarePatients",{id:"_endoMPLCareContainer",itemId:"_endoMPLCareContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"追蹤病人"});this.down("#ENDOCP_MainTabPanel").add(g);g=null;delete g}else{this.down("#_endoMPLCareContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_endoMPLCareFinishedContainer"))){var j=Ext.create("NisTRApp.view.WorkList.EDNO.CareFinishedPatients",{id:"_endoMPLCareFinishedContainer",itemId:"_endoMPLCareFinishedContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"結案病人"});this.down("#ENDOCP_MainTabPanel").add(j);j=null;delete j}else{this.down("#_endoMPLCareFinishedContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_endoMYPTSContainer"))){var e=Ext.create("NisTRApp.view.WorkList.ENDO.MyPatients",{id:"_endoMYPTSContainer",itemId:"_endoMYPTSContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"我的病人"});this.down("#ENDOCP_MainTabPanel").add(e);e=null;delete e}else{this.down("#_endoMYPTSContainer").setRecord(this.getRecord())}if(Ext.isEmpty(this.down("#_endoQUERYPTSContainer"))){var h=Ext.create("NisTRApp.view.WorkList.ENDO.QueryPatient",{id:"_endoQUERYPTSContainer",itemId:"_endoQUERYPTSContainer",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"排程查詢"});this.down("#ENDOCP_MainTabPanel").add(h);h=null;delete h}else{this.down("#_endoQUERYPTSContainer").setRecord(this.getRecord())}},onContainerDestroy:function(a){console.log("On Destroy :","ENDO.ContactPatient");this.removeAll(true,true)}});Ext.define("NisTRApp.view.ENDO.PatientStatus",{extend:Ext.Container,config:{stopDistroyEvent:true,hiddenHeadBar:false,initialFlag:true,modifyFlag:true,height:400,width:568,layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"ENDOPS_HeadBar"},{xtype:"formpanel",itemId:"ENDOPS_MainPanel",items:[{xtype:"fieldset",itemId:"ENDOPS_MainSet",items:[{xtype:"textfield",itemId:"AccSwTxt",label:"Field",labelWidth:"99%"},{xtype:"checkboxfield",disabled:false,hidden:true,itemId:"AccSwChk",label:"已報到 (08:37:49)",labelWidth:"60%",name:"AccSw",checked:true},{xtype:"checkboxfield",itemId:"PrepareSwChk",label:"準備中 (10:39:41)",labelWidth:"60%",name:"PrepareSw",checked:true},{xtype:"textfield",itemId:"ExamStartTxt",label:"Field",labelWidth:"99%"},{xtype:"checkboxfield",disabled:false,hidden:true,itemId:"ExamStartChk",label:"檢查中 (11:00:03)",labelWidth:"60%",name:"ExamStart",checked:true},{xtype:"textfield",itemId:"ExamFinishedTxt",label:"Field",labelWidth:"99%"},{xtype:"checkboxfield",itemId:"RecoverSwChk",label:"恢復中",labelWidth:"60%",name:"RecoverSw"},{xtype:"checkboxfield",disabled:false,hidden:true,itemId:"ExamFinishedChk",label:"檢查完成",labelWidth:"60%",name:"ExamFinished"},{xtype:"checkboxfield",itemId:"FinishedSwChk",label:"病人離開",labelWidth:"60%",name:"FinishedSw"}]}]}],listeners:[{fn:"onAccSwChkChange",event:"change",delegate:"#AccSwChk"},{fn:"onPrepareSwChkChange",event:"change",delegate:"#PrepareSwChk"},{fn:"onExamStartChkChange",event:"change",delegate:"#ExamStartChk"},{fn:"onRecoverSwChkChange",event:"change",delegate:"#RecoverSwChk"},{fn:"onExamFinishedChkChange",event:"change",delegate:"#ExamFinishedChk"},{fn:"onFinishedSwChkChange",event:"change",delegate:"#FinishedSwChk"},{fn:"onContainerDestroy",event:"destroy"}]},onAccSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.AccDate)&&f==true){Ext.Msg.confirm("Confirm","報到? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateAccFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){console.log(99969,NisTRApp.view.DateUtil.GetSysTimeStr());b.data.AccDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.AccTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.AccMan=NisTRApp.view.SysUtility.GetUserID();b.data.AccSw="A";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.AccDate)&&f==false){Ext.Msg.confirm("Confirm","取消報到? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateAccFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.AccDate="";b.data.AccTime="";b.data.AccMan="";b.data.AccSw="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onPrepareSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.PrepareDate)&&f==true){Ext.Msg.confirm("Confirm","準備中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdatePrepareFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.PrepareDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.PrepareTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.PrepareUser=NisTRApp.view.SysUtility.GetUserID();b.data.PrepareSw="P";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.PrepareDate)&&f==false){Ext.Msg.confirm("Confirm","取消準備? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdatePrepareFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.PrepareDate="";b.data.PrepareTime="";b.data.PrepareUser="";b.data.PrepareSw="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onExamStartChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(!String.IsNull(b.data.ExamendDate)){NisTRApp.view.Misc.Alert("此筆檢查已完成，請先取消檢查完成",0);b=null;delete b;this.Reflush();return}if(String.IsNull(b.data.ExamstartDate)&&f==true){Ext.Msg.confirm("Confirm","檢查中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamStartFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamstartDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.ExamstartTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.ExamFlag="S";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.ExamstartDate)&&f==false){Ext.Msg.confirm("Confirm","取消檢查? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamStartFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamstartDate="";b.data.ExamstartTime="";b.data.ExamFlag="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onRecoverSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.RecoverDate)&&f==true){Ext.Msg.confirm("Confirm","恢復中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateRecoverFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.RecoverDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.RecoverTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.RecoverUser=NisTRApp.view.SysUtility.GetUserID();b.data.RecoverFlag="R";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.RecoverDate)&&f==false){Ext.Msg.confirm("Confirm","取消恢復中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateRecoverFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.RecoverDate="";b.data.RecoverTime="";b.data.RecoverUser="";b.data.RecoverFlag="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onExamFinishedChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.ExamstartDate)){NisTRApp.view.Misc.Alert("此筆檢查尚未開始",0);b=null;delete b;this.Reflush();return}if(String.IsNull(b.data.ExamendDate)&&f==true){Ext.Msg.confirm("Confirm","檢查中? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamEndFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamendDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.ExamendTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.ExamFlag="E";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.ExamendDate)&&f==false){Ext.Msg.confirm("Confirm","取消檢查? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateExamEndFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.ExamendDate="";b.data.ExamednTime="";b.data.ExamFlag="S";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onFinishedSwChkChange:function(a,f,d,e){if(this.getInitialFlag()){return}var b=this.getRecord();if(String.IsNull(b.data.FinishDate)&&f==true){Ext.Msg.confirm("Confirm","病人離該? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateFinishedFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"ON"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.FinishDate=NisTRApp.view.DateUtil.GetSysDateStr();b.data.FinishTime=NisTRApp.view.DateUtil.GetSysTimeStr();b.data.FinishUser=NisTRApp.view.SysUtility.GetUserID();b.data.FinishFlag="F";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}else{if(!String.IsNull(b.data.FinishDate)&&f==false){Ext.Msg.confirm("Confirm","取消離開? 病人:"+b.data.PatName,function(h,j,g){if(h=="no"){this.Reflush();return}else{if(h=="yes"){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateFinishedFlag.ashx",method:"POST",scope:this,params:{GroupID:b.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Flag:"OFF"},success:function(k){Ext.Viewport.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){b.data.FinishDate="";b.data.FinishTime="";b.data.FinishUser="";b.data.FinishFlag="N";this.Reflush();this.setModifyFlag(true)}l=null;delete l;b=null;delete b},failure:function(){Ext.Viewport.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);b=null;delete b}})}}},this)}}return},onContainerDestroy:function(a){if(this.getModifyFlag()==true&&!Ext.isEmpty(this.getCaller())&&this.getCaller().xtype=="grid"&&!this.getCaller().getStore().isLoading()){this.getCaller().getStore().load()}console.log("on destroy :","ENDO.PatientStatus");this.removeAll()},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)){Ext.Msg.alert("1ENDO_WorkList 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<0){Ext.Msg.alert("2ENDO_WorkList 病人資料錯誤");return false}if(this.getHiddenHeadBar()){this.down("#ENDOPS_HeadBar").setHidden(true)}this.Reflush();this.setModifyFlag(false);this.setInitialFlag(false)},Reflush:function(){this.setInitialFlag(true);var a=this.getRecord();this.down("#AccSwChk").uncheck();this.down("#PrepareSwChk").uncheck();this.down("#ExamStartChk").uncheck();this.down("#RecoverSwChk").uncheck();this.down("#ExamFinishedChk").uncheck();this.down("#FinishedSwChk").uncheck();this.down("#AccSwTxt").setLabel((Ext.isEmpty(a.data.AccDate))?"已報到":("已報到 ("+a.data.AccDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.AccTime)+")"));this.down("#AccSwChk").setLabel((Ext.isEmpty(a.data.AccDate))?"已報到":("已報到 ("+a.data.AccDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.AccTime)+")"));if(!Ext.isEmpty(a.data.AccDate)){this.down("#AccSwChk").check()}this.down("#PrepareSwChk").setLabel((Ext.isEmpty(a.data.PrepareDate))?"準備中":("準備中 ("+a.data.PrepareDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.PrepareTime)+")"));if(!Ext.isEmpty(a.data.PrepareDate)){this.down("#PrepareSwChk").check()}this.down("#ExamStartTxt").setLabel((Ext.isEmpty(a.data.ExamstartDate))?"檢查中":("檢查中 ("+a.data.ExamstartDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamstartTime)+")"));this.down("#ExamStartChk").setLabel((Ext.isEmpty(a.data.ExamstartDate))?"檢查中":("檢查中 ("+a.data.ExamstartDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamstartTime)+")"));if(!Ext.isEmpty(a.data.ExamstartDate)){this.down("#ExamStartChk").check()}this.down("#RecoverSwChk").setLabel((Ext.isEmpty(a.data.RecoverDate))?"恢復中":("恢復中 ("+a.data.RecoverDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.RecoverTime)+")"));if(!Ext.isEmpty(a.data.RecoverDate)){this.down("#RecoverSwChk").check()}this.down("#ExamFinishedTxt").setLabel((Ext.isEmpty(a.data.ExamendDate))?"檢查完成":("檢查完成 ("+a.data.ExamendDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamendTime)+")"));this.down("#ExamFinishedChk").setLabel((Ext.isEmpty(a.data.ExamendDate))?"檢查完成":("檢查完成 ("+a.data.ExamendDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.ExamendTime)+")"));if(!Ext.isEmpty(a.data.ExamendDate)){this.down("#ExamFinishedChk").check()}this.down("#FinishedSwChk").setLabel((Ext.isEmpty(a.data.FinishDate))?"病人離開":("病人離開 ("+a.data.FinishDate+" "+NisTRApp.view.DateUtil.FormatRegTime(a.data.FinishTime)+")"));if(!Ext.isEmpty(a.data.FinishDate)){this.down("#FinishedSwChk").check()}a=null;delete a;this.setInitialFlag(false)}});Ext.define("NisTRApp.view.WorkList.ENDO.ObservedPatient",{extend:Ext.Container,alias:"widget.ENDO_ObservedPatient",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"ENDO_OBP_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"ENDO_OBP_ToolBar",items:[{xtype:"datepickerfield",itemId:"ENDO_OBP_PreexamDatePicker",width:"20%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"selectfield",itemId:"ENDO_OBP_ExamFloor",width:"20%",label:"地點",options:[{text:"ALL",value:"ALL"},{text:"B1內視鏡清單",value:"B1"},{text:"3F內視鏡清單",value:"3F"}]},{xtype:"button",itemId:"ENDO_OBP_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"},{xtype:"button",itemId:"ENDO_OBP_PrevDayBtn",ui:"confirm-back",width:"65px",text:"前一日"},{xtype:"button",itemId:"ENDO_OBP_TodayBtn",width:"65px",text:"今日"},{xtype:"button",itemId:"ENDO_OBP_NextDayBtn",ui:"confirm-forward",width:"65px",text:"後一日"},{xtype:"segmentedbutton",itemId:"ENDO_OBP_FnBtn",width:"29%",items:[{xtype:"button",flex:1,itemId:"ENDO_OBP_AllBtn",text:"全部"},{xtype:"button",flex:1.3,itemId:"ENDO_OBP_CheckInBtn",text:"檢查中"},{xtype:"button",flex:1,itemId:"ENDO_OBP_RecoveBtn",text:"恢復中"},{xtype:"button",flex:1.3,itemId:"ENDO_OBP_LeaveBtn",text:"病人離開"}]}]}],listeners:[{fn:"onENDO_OBP_PreexamDatePickerChange",event:"change",delegate:"#ENDO_OBP_PreexamDatePicker"},{fn:"onENDO_OBP_ExamFloorChange",event:"change",delegate:"#ENDO_OBP_ExamFloor"},{fn:"onENDO_OBP_RefreshBtnTap",event:"tap",delegate:"#ENDO_OBP_RefreshBtn"},{fn:"onENDO_OBP_PrevDayBtnTap",event:"tap",delegate:"#ENDO_OBP_PrevDayBtn"},{fn:"onENDO_OBP_TodayBtnTap",event:"tap",delegate:"#ENDO_OBP_TodayBtn"},{fn:"onENDO_OBP_NextDayBtnTap",event:"tap",delegate:"#ENDO_OBP_NextDayBtn"},{fn:"onENDO_OBP_AllBtnTap",event:"tap",delegate:"#ENDO_OBP_AllBtn"},{fn:"onENDO_OBP_CheckInBtnTap",event:"tap",delegate:"#ENDO_OBP_CheckInBtn"},{fn:"onENDO_OBP_RecoveBtnTap",event:"tap",delegate:"#ENDO_OBP_RecoveBtn"},{fn:"onENDO_OBP_LeaveBtnTap",event:"tap",delegate:"#ENDO_OBP_LeaveBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onENDO_OBP_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#ENDO_OBP_PreexamDatePicker").getValue(),this.down("#ENDO_OBP_ExamFloor").getValue())}},onENDO_OBP_ExamFloorChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#ENDO_OBP_PreexamDatePicker").getValue(),this.down("#ENDO_OBP_ExamFloor").getValue())}},onENDO_OBP_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#ENDO_OBP_PreexamDatePicker").getValue(),this.down("#ENDO_OBP_ExamFloor").getValue())},onENDO_OBP_PrevDayBtnTap:function(b,d,a){this.down("#ENDO_OBP_PreexamDatePicker").setValue(Ext.Date.add(this.down("#ENDO_OBP_PreexamDatePicker").getValue(),Ext.Date.DAY,-1))},onENDO_OBP_TodayBtnTap:function(b,d,a){this.down("#ENDO_OBP_PreexamDatePicker").setValue(new Date())},onENDO_OBP_NextDayBtnTap:function(b,d,a){this.down("#ENDO_OBP_PreexamDatePicker").setValue(Ext.Date.add(this.down("#ENDO_OBP_PreexamDatePicker").getValue(),Ext.Date.DAY,1))},onENDO_OBP_AllBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_OBP_FnBtn"),d,"confirm-round","normal","","");var a=Ext.getStore("sEndoObservedPatients");if(!Ext.isEmpty(a)){a.clearFilter()}a=null;delete a},onENDO_OBP_CheckInBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_OBP_FnBtn"),d,"confirm-round","normal","","");var a=Ext.getStore("sEndoObservedPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.ExamStatusFlag=="ES")},this)}a=null;delete a},onENDO_OBP_RecoveBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_OBP_FnBtn"),d,"confirm-round","normal","","");var a=Ext.getStore("sEndoObservedPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.ExamStatusFlag=="R"||e.data.ExamStatusFlag=="O")},this)}a=null;delete a},onENDO_OBP_LeaveBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#ENDO_OBP_FnBtn"),d,"confirm-round","normal","","");var a=Ext.getStore("sEndoObservedPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.ExamStatusFlag=="F")},this)}a=null;delete a},onContainerDestroy:function(a){if(Ext.getStore("sEndoObservedPatients")!=null){Ext.getStore("sEndoObservedPatients").removeAll();Ext.getStore("sEndoObservedPatients").destroy()}console.log("On Destroy :","ENDO.ObservedPatient");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadPatientList(this.down("#ENDO_OBP_PreexamDatePicker").getValue())}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sEndoObservedPatients"))){Ext.create("Ext.data.Store",{storeId:"sEndoObservedPatients",model:"NisTRApp.model.ENDO.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryNeedObservedPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sEndoObservedPatients").addListener("load",function(g,f,j,e,h){NisTRApp.view.GridUtility.onChangeENDOLeaveSelect("ENDO_ObservedPatGrid");NisTRApp.view.GridUtility.onChangeENDOObsRoomSelect("ENDO_ObservedPatGrid")},this);var b=this;var d=Ext.getCmp("ENDO_ObservedPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenENDOInPatientGrid("ENDO_ObservedPatGrid","ENDO留觀病人清單",null,false);d.getTitleBar().hide();var a=Ext.getStore("sEndoObservedPatients");d.setStore(a);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapENDOGrid,d);this.down("#ENDO_OBP_MainPanel").add(d);d=null;delete d;a=null;delete a}this.down("#ENDO_OBP_PreexamDatePicker").setValue(SYS_CONST.SysDate);this.down("#ENDO_OBP_RecoveBtn").fireEvent("tap",this.down("#ENDO_OBP_RecoveBtn"),null,null);b=null;delete b},LoadPatientList:function(b,d){if(Ext.getStore("sEndoObservedPatients").isLoading()){return}var a=Ext.getStore("sEndoObservedPatients");a.getProxy().setExtraParams({SchedDate:b,ExamFloor:d});a.load({callback:function(f,e,g){},scope:this});a=null;delete a}});Ext.define("NisTRApp.view.WorkList.EDNO.CarePatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"ENDO_ENDOCC_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"ENDO_ENDOCC_ToolBar",items:[{xtype:"datepickerfield",itemId:"ENDO_ENDOCC_PreexamDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"ENDO_ENDOCC_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"},{xtype:"button",itemId:"ENDO_ENDOCC_PrevDayBtn",ui:"confirm-back",width:"90px",text:"前一日"},{xtype:"button",itemId:"ENDO_ENDOCC_TodayBtn",width:"70px",text:"今日"},{xtype:"button",itemId:"ENDO_ENDOCC_NextDayBtn",ui:"confirm-forward",width:"90px",text:"後一日"}]}],listeners:[{fn:"onENDO_ENDOCC_PreexamDatePickerChange",event:"change",delegate:"#ENDO_ENDOCC_PreexamDatePicker"},{fn:"onENDO_ENDOCC_RefreshBtnTap",event:"tap",delegate:"#ENDO_ENDOCC_RefreshBtn"},{fn:"onENDO_ENDOCC_PrevDayBtnTap",event:"tap",delegate:"#ENDO_ENDOCC_PrevDayBtn"},{fn:"onENDO_ENDOCC_TodayBtnTap",event:"tap",delegate:"#ENDO_ENDOCC_TodayBtn"},{fn:"onENDO_ENDOCC_NextDayBtnTap",event:"tap",delegate:"#ENDO_ENDOCC_NextDayBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onENDO_ENDOCC_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(a,"Y")}},onENDO_ENDOCC_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#ENDO_ENDOCC_PreexamDatePicker").getValue(),"Y")},onENDO_ENDOCC_PrevDayBtnTap:function(b,d,a){this.down("#ENDO_ENDOCC_PreexamDatePicker").setValue(Ext.Date.add(this.down("#ENDO_ENDOCC_PreexamDatePicker").getValue(),Ext.Date.DAY,-1))},onENDO_ENDOCC_TodayBtnTap:function(b,d,a){this.down("#ENDO_ENDOCC_PreexamDatePicker").setValue(new Date())},onENDO_ENDOCC_NextDayBtnTap:function(b,d,a){this.down("#ENDO_ENDOCC_PreexamDatePicker").setValue(Ext.Date.add(this.down("#ENDO_ENDOCC_PreexamDatePicker").getValue(),Ext.Date.DAY,1))},onContainerDestroy:function(a){if(Ext.getStore("sEndoContactPatients")!=null){Ext.getStore("sEndoContactPatients").removeAll();Ext.getStore("sEndoContactPatients").destroy()}console.log("On Destroy :","ENDO.CarePatients");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadPatientList(this.down("#ENDO_ENDOCC_PreexamDatePicker").getValue(),"Y")}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sEndoContactPatients"))){Ext.create("Ext.data.Store",{storeId:"sEndoContactPatients",model:"NisTRApp.model.ENDO.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoContactPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sEndoContactPatients").addListener("load",function(g,f,j,e,h){NisTRApp.view.GridUtility.onChangeENDOLeaveSelect("ENDO_ContactPatGrid");NisTRApp.view.GridUtility.onChangeENDOObsRoomSelect("ENDO_ContactPatGrid")},this);var a=this;var d=Ext.getCmp("ENDO_ContactPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenENDOInPatientGrid("ENDO_ContactPatGrid","ENDO排程清單",null,false);d.getTitleBar().hide();var b=Ext.getStore("sEndoContactPatients");d.setStore(b);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapENDOGrid,d);this.down("#ENDO_ENDOCC_MainPanel").add(d);d=null;delete d;b=null;delete b}this.down("#ENDO_ENDOCC_PreexamDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadPatientList:function(d,a){if(Ext.getStore("sEndoContactPatients").isLoading()){return}var b=Ext.getStore("sEndoContactPatients");b.getProxy().setExtraParams({CareFlag:a,SchedDate:d});b.load({callback:function(f,e,g){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.WorkList.EDNO.CareFinishedPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"ENDO_ENDOCCF_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"ENDO_ENDOCC_ToolBar",items:[{xtype:"datepickerfield",itemId:"ENDO_ENDOCCF_PreexamDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"ENDO_ENDOCC_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"},{xtype:"button",itemId:"ENDO_ENDOCCF_PrevDayBtn",ui:"confirm-back",width:"90px",text:"前一日"},{xtype:"button",itemId:"ENDO_ENDOCCF_TodayBtn",width:"70px",text:"今日"},{xtype:"button",itemId:"ENDO_ENDOCCF_NextDayBtn",ui:"confirm-forward",width:"90px",text:"後一日"}]}],listeners:[{fn:"onENDO_ENDOCCF_PreexamDatePickerChange",event:"change",delegate:"#ENDO_ENDOCCF_PreexamDatePicker"},{fn:"onENDO_ENDOCC_RefreshBtnTap",event:"tap",delegate:"#ENDO_ENDOCC_RefreshBtn"},{fn:"onENDO_ENDOCCF_PrevDayBtnTap",event:"tap",delegate:"#ENDO_ENDOCCF_PrevDayBtn"},{fn:"onENDO_ENDOCCF_TodayBtnTap",event:"tap",delegate:"#ENDO_ENDOCCF_TodayBtn"},{fn:"onENDO_ENDOCCF_NextDayBtnTap",event:"tap",delegate:"#ENDO_ENDOCCF_NextDayBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onENDO_ENDOCCF_PreexamDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(a)}},onENDO_ENDOCC_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#ENDO_ENDOCCF_PreexamDatePicker").getValue())},onENDO_ENDOCCF_PrevDayBtnTap:function(b,d,a){this.down("#ENDO_ENDOCCF_PreexamDatePicker").setValue(Ext.Date.add(this.down("#ENDO_ENDOCCF_PreexamDatePicker").getValue(),Ext.Date.DAY,-1))},onENDO_ENDOCCF_TodayBtnTap:function(b,d,a){this.down("#ENDO_ENDOCCF_PreexamDatePicker").setValue(new Date())},onENDO_ENDOCCF_NextDayBtnTap:function(b,d,a){this.down("#ENDO_ENDOCCF_PreexamDatePicker").setValue(Ext.Date.add(this.down("#ENDO_ENDOCCF_PreexamDatePicker").getValue(),Ext.Date.DAY,1))},onContainerDestroy:function(a){if(Ext.getStore("sEndoCareFinishedPatients")!=null){Ext.getStore("sEndoCareFinishedPatients").removeAll();Ext.getStore("sEndoCareFinishedPatients").destroy()}console.log("On Destroy :","Endo.CareFinishedContainer");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadPatientList(this.down("#ENDO_ENDOCCF_PreexamDatePicker").getValue())}},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sEndoCareFinishedPatients"))){Ext.create("Ext.data.Store",{storeId:"sEndoCareFinishedPatients",model:"NisTRApp.model.ENDO.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoContactPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sEndoCareFinishedPatients").addListener("load",function(g,f,j,e,h){NisTRApp.view.GridUtility.onChangeENDOLeaveSelect("ENDO_CareFinishedPatGrid");NisTRApp.view.GridUtility.onChangeENDOObsRoomSelect("ENDO_CareFinishedPatGrid")},this);var a=this;var b=Ext.getCmp("ENDO_CareFinishedPatGrid");if(b==null){b=NisTRApp.view.GridUtility.GenENDOInPatientGrid("ENDO_CareFinishedPatGrid","ENDO排程清單",null,false);b.getTitleBar().hide();var d=Ext.getStore("sEndoCareFinishedPatients");b.setStore(d);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapENDOGrid,b);this.down("#ENDO_ENDOCCF_MainPanel").add(b);b=null;delete b;d=null;delete d}this.down("#ENDO_ENDOCCF_PreexamDatePicker").setValue(SYS_CONST.SysDate);a=null;delete a},LoadPatientList:function(a){if(Ext.getStore("sEndoCareFinishedPatients").isLoading()){return}var b=Ext.getStore("sEndoCareFinishedPatients");b.getProxy().setExtraParams({CareFlag:"finished",SchedDate:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.WorkList.ENDO.MyPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",items:[{xtype:"textfield",itemId:"WLENDOMP_UserId",width:260,label:"員工編號"},{xtype:"button",itemId:"WLENDOMP_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"panel",itemId:"WLENDOMP_MianPanel"}],listeners:[{fn:"onWLENDOMP_QueryBtnTap",event:"tap",delegate:"#WLENDOMP_QueryBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onWLENDOMP_QueryBtnTap:function(b,d,a){this.LoadMyPatients(this.down("#WLENDOMP_UserId").getValue())},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadMyPatients(this.down("#WLENDOMP_UserId").getValue())}},onContainerDestroy:function(a){if(Ext.getStore("sEndoOnlyMyPatients")!=null){Ext.getStore("sEndoOnlyMyPatients").removeAll();Ext.getStore("sEndoOnlyMyPatients").destroy()}this.removeAll(true,true)},initialize:function(){this.callParent();this.down("#WLENDOMP_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());if(Ext.isEmpty(Ext.getStore("sEndoOnlyMyPatients"))){Ext.create("Ext.data.Store",{storeId:"sEndoOnlyMyPatients",clearOnPageLoad:false,model:"NisTRApp.model.ENDO.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoMyPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sEndoOnlyMyPatients").addListener("load",function(h,g,k,f,j){NisTRApp.view.GridUtility.onChangeENDOLeaveSelect("ENDO_MyPatients");NisTRApp.view.GridUtility.onChangeENDOObsRoomSelect("ENDO_MyPatients")},this);var b=this;var e=Ext.getCmp("ENDO_MyPatients");if(e==null){e=NisTRApp.view.GridUtility.GenENDOInPatientGrid("ENDO_MyPatients","我的內視鏡病人",null,true);e.getTitleBar().hide();var d=Ext.create("Ext.grid.column.Template",{text:"刪除",align:"center",cls:"gridMediumFont",itemId:"delMyPatient",tpl:Ext.create("Ext.XTemplate",'<img id="{[this.imgId(values.MyPatUserID)]}_IMG_{KeyOne}" src="{[this.imgPath(values.MyPatUserID)]}" alt="Smiley face" height="50"" width="50"">',{imgPath:function(f){if(!String.IsNull(f)&&(f==NisTRApp.view.SysUtility.GetUserID())){return"../_/img/Error.png"}else{return"../_/img/empty.png"}},imgId:function(f){if(!String.IsNull(f)&&(f==NisTRApp.view.SysUtility.GetUserID())){return"ENDODELMYPATIENT"}else{return"XXXXX"}}}),width:70,hidden:false,sortable:false,flex:1});e.setColumns([d]);var a=Ext.getStore("sEndoOnlyMyPatients");e.setStore(a);e.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapENDOGrid,e);this.down("#WLENDOMP_MianPanel").add(e);e=null;delete e;d=null;delete d}b=null;delete b},LoadMyPatients:function(b){if(Ext.getStore("sEndoOnlyMyPatients").isLoading()){return}Ext.getStore("sEndoOnlyMyPatients").removeAll();if(Ext.isEmpty(b)){return}var a=Ext.getStore("sEndoOnlyMyPatients");a.getProxy().setExtraParams({UserID:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a}});Ext.define("NisTRApp.view.ENDO_ContactPanel",{extend:Ext.Container,statics:{OpenCareAssessmentForm:function(b,d){if(Ext.isEmpty(b)){Ext.Msg.alert("Endo_CareInfoPanel 表單網址錯誤");return}try{var a=Ext.getCmp("_endoCareAssessmentFormPanel");if(!Ext.isEmpty(a)){a.destroy()}if(Ext.isEmpty(a)){a=Ext.create("NisTRApp.view.NIS_FormPanel",{id:"_endoCareAssessmentFormPanel",centered:true,modal:true,url:b,height:NisTRApp.view.SysUtility.ClcHeight(90),width:NisTRApp.view.SysUtility.ClcWidth(95),divID:"EndoCareAssessmentFrameDIV"})}if(!Ext.isEmpty(a)){a.setCaller(d);a.setCloseFn(function(e){});d.overlay=Ext.Viewport.add(a);a.show()}a=null;delete a;b=null;delete b}catch(f){console.log(f)}}},config:{hiddenHeadBar:false,stopDistroyEvent:false,height:480,width:640,layout:{type:"fit"},caller:{},items:[{xtype:"formpanel",itemId:"ENDOContactFormPanel",items:[{xtype:"fieldset",itemId:"RISC_ContactReasonFieldSet",title:"追蹤原因",items:[{xtype:"textfield",itemId:"ContacterReasonTxt",label:'<div id="EndoCareReasonDiv"></div>',labelWidth:"90px",name:"ContacterReason",placeHolder:"請輸入"}]},{xtype:"fieldset",itemId:"RISC_ContactTelFieldSet",title:"聯絡電話",items:[{xtype:"textfield",itemId:"TelHomeTxt",label:"(宅)",name:"TelHome"},{xtype:"textfield",itemId:"TelMobileTxt",label:"(手機)",name:"TelMobile"},{xtype:"textfield",itemId:"TelOfficeTxt",label:"(公)",name:"TelOffice"}]},{xtype:"fieldset",itemId:"RISC_ContactObjFieldSet",title:"連絡對象",items:[{xtype:"checkboxfield",itemId:"ContacterPatientCb",label:"病人本人",name:"ContacterPatient"},{xtype:"checkboxfield",itemId:"ContacterFamilyCb",label:"家屬",name:"ContacterFamily"},{xtype:"textfield",itemId:"ContacterFamilyRelationshipTxt",label:"家屬關係",name:"ContacterFamilyRelationship"},{xtype:"checkboxfield",itemId:"ContacterFriendCb",label:"朋友",name:"ContacterFriend"},{xtype:"textfield",hidden:true,itemId:"ContacterFriendNameTxt",label:"朋友姓名",name:"ContacterFriendName"}]},{xtype:"fieldset",hidden:true,itemId:"RISC_ContactTimeFieldSet",title:"聯絡時段",items:[{xtype:"checkboxfield",itemId:"ContactTime1Cb",label:"上午",name:"ContactTime1"},{xtype:"checkboxfield",itemId:"ContactTime2Cb",label:"下午",name:"ContactTime2"},{xtype:"textfield",itemId:"ContactTimeOthersTxt",label:"其他",name:"ContactTimeOthers"}]},{xtype:"fieldset",hidden:true,itemId:"RISC_PatFieldSet",title:"病人意願",items:[{xtype:"checkboxfield",html:"",itemId:"ContactYesCb",label:"願意接受電訪",name:"ContactYes"},{xtype:"checkboxfield",itemId:"ContactNoCb",label:"不方便聯絡",name:"ContactNo"},{xtype:"checkboxfield",itemId:"HppFlagCb",label:"立德病人",name:"HppFlag"},{xtype:"textfield",html:"",itemId:"ContactOtherTxt",label:'<div id="ContactOtherLabDiv">其他</div>',name:"ContactOther"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"ENDOContactFootBar",items:[{xtype:"button",itemId:"ENDOC_ADDMYPATIENT_Btn",text:"加入我的病人"},{xtype:"button",itemId:"ENDOC_FinishContactPatient",ui:"confirm",width:"90px",iconCls:"favorites",text:"結案"},{xtype:"button",hidden:false,itemId:"ENDOC_CancelContactPatient",ui:"decline",text:"取消追蹤"},{xtype:"button",centered:false,itemId:"ENDOC_SaveMasterBtn",right:"95px",ui:"decline",width:"80px",text:"存 檔"},{xtype:"button",itemId:"ENDOC_CloseMasterBtn",right:"5px",ui:"confirm",width:"80px",text:"關閉"},{xtype:"button",itemId:"ENDOC_AddCareRecordBtn",ui:"confirm",width:"120px",iconCls:"add",text:"追蹤記錄"}]}],listeners:[{fn:"onENDOC_ADDMYPATIENT_BtnTap",event:"tap",delegate:"#ENDOC_ADDMYPATIENT_Btn"},{fn:"onENDOC_FinishContactPatientTap",event:"tap",delegate:"#ENDOC_FinishContactPatient"},{fn:"onENDOC_CancelContactPatientTap",event:"tap",delegate:"#ENDOC_CancelContactPatient"},{fn:"onENDOC_SaveMasterBtnTap",event:"tap",delegate:"#ENDOC_SaveMasterBtn"},{fn:"onENDOC_CloseMasterBtnTap",event:"tap",delegate:"#ENDOC_CloseMasterBtn"},{fn:"onENDOC_AddCareRecordBtnTap",event:"tap",delegate:"#ENDOC_AddCareRecordBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onENDOC_ADDMYPATIENT_BtnTap:function(b,f,a){var g=this.getRecord();var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/ModifyMyPatient.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),GroupID:g.data.GroupID,ChartNo:g.data.ChartNO,Flag:"ADD"},success:function(e){d.setMasked(false);var h=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));h=null;delete h;d=null;delete d;g=null;delete g},failure:function(){d.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);g=null;delete g;d=null;delete d}});g=null;delete g},onENDOC_FinishContactPatientTap:function(b,f,a){if(Ext.getStore("sEndoContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<=0){return}var g=this.getRecord();var d=this;Ext.Msg.confirm("Confirm","是否確認追蹤結案? 病人:"+g.data.PatName,function(j,k,h){if(j=="no"){d=null;delete d;g=null;delete g;return}else{if(j=="yes"){var e={GroupID:g.data.GroupID,ContacterReason:this.down("#ContacterReasonTxt").getValue(),TelHome:this.down("#TelHomeTxt").getValue(),TelOffice:this.down("#TelOfficeTxt").getValue(),TelMobile:this.down("#TelMobileTxt").getValue(),ContactTime1:(this.down("#ContactTime1Cb").isChecked()?"上午":""),ContactTime2:(this.down("#ContactTime2Cb").isChecked()?"下午":""),ContactTimeOthers:this.down("#ContactTimeOthersTxt").getValue(),HppFlag:(this.down("#HppFlagCb").isChecked()?"Y":"N"),ContacterPatient:(this.down("#ContacterPatientCb").isChecked()?"Y":"N"),ContacterFamily:(this.down("#ContacterFamilyCb").isChecked()?"Y":"N"),ContacterFamilyRelationship:this.down("#ContacterFamilyRelationshipTxt").getValue(),ContacterFriend:(this.down("#ContacterFriendCb").isChecked()?"Y":"N"),ContacterFriendName:this.down("#ContacterFriendNameTxt").getValue(),ContactYes:(this.down("#ContactYesCb").isChecked()?"Y":"N"),ContactNo:(this.down("#ContactNoCb").isChecked()?"Y":"N"),ContactOther:this.down("#ContactOtherTxt").getValue(),CreUserID:"",CreUserName:"",CreDateTime:"",ModifyUserID:"",ModifyUserName:"",ModifyDateTime:""};d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/EndoContactFinished.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{GroupID:g.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID(),Json:btoa(encodeURIComponent(JSON.stringify(e)))},success:function(l){d.setMasked(false);var m=Ext.decode(l.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(m.Success){d.down("#ENDOC_FinishContactPatient").setHidden(true);d.down("#ENDOC_CancelContactPatient").setHidden(false)}if(!Ext.isEmpty(d.getCaller())&&d.getCaller().xtype=="grid"){d.getCaller().getStore().load()}m=null;delete m;d=null;delete d;g=null;delete g},failure:function(){d.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);d=null;delete d;g=null;delete g}})}}},this)},onENDOC_CancelContactPatientTap:function(b,f,a){if(Ext.getStore("sEndoContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<=0){return}var g=this.getRecord();var d=this;Ext.Msg.confirm("Confirm","是否取消追蹤? 病人:"+g.data.PatName,function(h,j,e){if(h=="no"){d=null;delete d;risInfo=null;delete risInfo;return}else{if(h=="yes"){d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/EndoContactCancel.ashx",useDefaultXhrHeader:false,method:"POST",scope:this,params:{GroupID:g.data.GroupID,UserID:NisTRApp.view.SysUtility.GetUserID()},success:function(k){d.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){d.down("#ENDOC_FinishContactPatient").setHidden(false);d.down("#ENDOC_CancelContactPatient").setHidden(true)}if(!Ext.isEmpty(d.getCaller())&&d.getCaller().xtype=="grid"){d.getCaller().getStore().load()}l=null;delete l;d=null;delete d;g=null;delete g},failure:function(){d.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);d=null;delete d;g=null;delete g}})}}},this)},onENDOC_SaveMasterBtnTap:function(b,d,a){if(Ext.getStore("sEndoContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<=0){return}this.SaveContactData("Y")},onENDOC_CloseMasterBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onENDOC_AddCareRecordBtnTap:function(g,j,f){if(Ext.getStore("sEndoContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<=0){return}var k=this.getRecord();var d,h,b;if(k.data.Source.Type==1){d="0";h=k.data.Source.Name;b=(k.data.ChartSeq?k.data.ChartSeq:0)}else{if(k.data.Source.Type==2){d=k.data.InpNO;h=k.data.Source.Name;b=0}else{Ext.Msg.alert("NurCath 病人資料錯誤");return}}var a=NisTRApp.view.FormUtil.AssessmentAddr("RenderAssesment","RLSZ27N7JLKUBPD2NYB5MT3TMA",NisTRApp.view.SysUtility.GetUserID(),k.data.ChartNo,b,"","","_ReloadEndoCareAccessmentData","",d,h);NisTRApp.view.ENDO_ContactPanel.OpenCareAssessmentForm(a,this);a=null;delete a;d=null;h=null;b=null;delete d;delete h;delete b;k=null;delete k},onContainerDestroy:function(a){if(Ext.getStore("sEndoContactData")!=null){Ext.getStore("sEndoContactData").removeAll();Ext.getStore("sEndoContactData").destroy()}_ReloadEndoCareAccessmentData=null;delete _ReloadEndoCareAccessmentData;console.log("on destroy :","ENDO Contact Panel ");this.removeAll()},onContainerShow:function(b,d){if(Ext.getStore("sEndoContactData").getCount()<=0){this.LoadContactData()}if(Ext.isEmpty($("#_endoCareReasonItem")[0])){var e=$('<img src="../_/img/teach3.png" id="_endoCareReasonItem" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:this,field:this.down("#ContacterReasonTxt")},function(h){try{if(!Ext.isEmpty(Ext.getCmp("_endoCareReasonPanel"))){Ext.getCmp("_endoCareReasonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_endoCareReasonPanel"))){var f={top:(h.type=="touchstart"?h.originalEvent.touches[0].pageY:h.pageY),left:(h.type=="touchstart"?h.originalEvent.touches[0].pageX:h.pageX),};var g=Ext.create("NisTRApp.view.ReasonTempletePanel",{id:"_endoCareReasonPanel",height:320,width:320,top:f.top+25,left:f.left+35,caller:h.data.caller,field:h.data.field,store:Ext.getStore("sEndoCareReasonItem")});h.data.caller.overlay=Ext.Viewport.add(g);g=null;delete g;f=null;delete f}h.data.caller.overlay.show()}catch(h){console.log(h)}});e.appendTo($("#EndoCareReasonDiv"));e=null;delete e;a=null;delete a}},initialize:function(){this.callParent();_ReloadEndoCareAccessmentData=function(b){try{if(null!=b&&undefined!=b&&"TempSave"==b){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_endoCareAssessmentFormPanel"))){Ext.getCmp("_endoCareAssessmentFormPanel").destroy()}}}catch(d){console.error("_ReloadEndoCareAccessmentData",d)}};if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("Endo_Contact 病人資料錯誤");return false}if(Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<0){Ext.Msg.alert("Endo_Contact 病人資料錯誤");return false}if(Ext.data.ModelManager.getModel("Options")==null){Ext.define("Options",{extend:Ext.data.Model,config:{fields:[{name:"name",type:"string"},{name:"id",type:"int"}]}})}if(Ext.getStore("sEndoCareReasonItem")==null){Ext.create("Ext.data.Store",{storeId:"sEndoCareReasonItem",clearOnPageLoad:false,model:"Options",data:[{name:"胃鏡瘜肉切除術",id:1},{name:"食道靜脈瘤硬化治療",id:2},{name:"胃靜脈瘤硬化治療",id:3},{name:"上消化道內視鏡止血法",id:4},{name:"食道氣球擴張術",id:5},{name:"EVL",id:6},{name:"大腸鏡瘜肉切除術",id:7},{name:"經大腸鏡結腸止血術",id:8},{name:"支氣管細針抽吸",id:9},{name:"支氣管狹窄氣球擴張",id:10},{name:"經支氣管鏡電燒術",id:11},{name:"ERCP",id:12},{name:"EPT併截石術",id:13},{name:"經內視鏡括約肌切開術",id:14},{name:"RFA內視鏡食道射頻燒灼術",id:15},{name:"經內視鏡十二指腸括約肌氣球成形術",id:16},{name:"經直腸攝護腺超音波切片",id:17},{name:"止血",id:18},{name:"醫囑",id:19}]})}if(Ext.isEmpty(Ext.getStore("sEndoContactData"))){Ext.create("Ext.data.Store",{storeId:"sEndoContactData",autoLoad:false,model:"NisTRApp.model.ENDO.ContactData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoContactData.ashx",reader:{type:"jsonHtmlDecode"}}})}var a=this.getRecord();this.down("#ENDOC_FinishContactPatient").setHidden(!(Ext.isEmpty(a.data.CareFlag)||a.data.CareFlag=="Y"||a.data.CareFlag=="N"));this.down("#ENDOC_CancelContactPatient").setHidden(!(!Ext.isEmpty(a.data.CareFlag)&&a.data.CareFlag!="N"));a=null;delete a},LoadContactData:function(){if(Ext.getStore("sEndoContactData").isLoading()||Ext.isEmpty(this.getRecord())){return}var d=this.getRecord();var b=Ext.getStore("sEndoContactData");b.getProxy().setExtraParams({ChartNO:d.data.ChartNO,GroupID:d.data.GroupID});this.down("#ENDOContactFormPanel").reset();var a=this;a.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});b.load({callback:function(f,e,h){a.setMasked(false);if(null!=f&&null!=f[0]){a.down("#ENDOContactFormPanel").setRecord(f[0]);var g=f[0].data;Ext.isEmpty(g.ContactTime1)?a.down("#ContactTime1Cb").uncheck():a.down("#ContactTime1Cb").check();Ext.isEmpty(g.ContactTime2)?a.down("#ContactTime2Cb").uncheck():a.down("#ContactTime2Cb").check();(Ext.isEmpty(g.HppFlag)||g.HppFlag=="N")?a.down("#HppFlagCb").uncheck():a.down("#HppFlagCb").check();(Ext.isEmpty(g.ContacterPatient)||g.ContacterPatient=="N")?a.down("#ContacterPatientCb").uncheck():a.down("#ContacterPatientCb").check();(Ext.isEmpty(g.ContacterFamily)||g.ContacterFamily=="N")?a.down("#ContacterFamilyCb").uncheck():a.down("#ContacterFamilyCb").check();(Ext.isEmpty(g.ContacterFriend)||g.ContacterFriend=="N")?a.down("#ContacterFriendCb").uncheck():a.down("#ContacterFriendCb").check();(Ext.isEmpty(g.ContactYes)||g.ContactYes=="N")?a.down("#ContactYesCb").uncheck():a.down("#ContactYesCb").check();(Ext.isEmpty(g.ContactNo)||g.ContactNo=="N")?a.down("#ContactNoCb").uncheck():a.down("#ContactNoCb").check()}a=null;delete a;risInfo=null;delete risInfo},scope:this});b=null;delete b;d=null;delete d},SaveContactData:function(a){if(Ext.getStore("sEndoContactData").isLoading()||Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<=0){return}var e=this.getRecord();var b={GroupID:e.data.GroupID,ContacterReason:this.down("#ContacterReasonTxt").getValue(),TelHome:this.down("#TelHomeTxt").getValue(),TelOffice:this.down("#TelOfficeTxt").getValue(),TelMobile:this.down("#TelMobileTxt").getValue(),ContactTime1:(this.down("#ContactTime1Cb").isChecked()?"上午":""),ContactTime2:(this.down("#ContactTime2Cb").isChecked()?"下午":""),ContactTimeOthers:this.down("#ContactTimeOthersTxt").getValue(),HppFlag:(this.down("#HppFlagCb").isChecked()?"Y":"N"),ContacterPatient:(this.down("#ContacterPatientCb").isChecked()?"Y":"N"),ContacterFamily:(this.down("#ContacterFamilyCb").isChecked()?"Y":"N"),ContacterFamilyRelationship:this.down("#ContacterFamilyRelationshipTxt").getValue(),ContacterFriend:(this.down("#ContacterFriendCb").isChecked()?"Y":"N"),ContacterFriendName:this.down("#ContacterFriendNameTxt").getValue(),ContactYes:(this.down("#ContactYesCb").isChecked()?"Y":"N"),ContactNo:(this.down("#ContactNoCb").isChecked()?"Y":"N"),ContactOther:this.down("#ContactOtherTxt").getValue(),CreUserID:"",CreUserName:"",CreDateTime:"",ModifyUserID:"",ModifyUserName:"",ModifyDateTime:""};var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"ENDO/action/UpdateEndoContactData.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),GroupID:e.data.GroupID,CareFlag:(Ext.isEmpty(a)?"":a),Json:btoa(encodeURIComponent(JSON.stringify(b)))},success:function(f){d.setMasked(false);var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(a=="Y"&&g.Success){d.down("#ENDOC_CancelContactPatient").setHidden(false);e.data.CareFlag="Y"}if(!Ext.isEmpty(d.getCaller())&&d.getCaller().xtype=="grid"){d.getCaller().getStore().load()}g=null;delete g;d=null;delete d;e=null;delete e},failure:function(){d.setMasked(false);NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.FAILURE,0);d=null;delete d;e=null;delete e}});b=null;delete b}});Ext.define("NisTRApp.view.WorkList.ENDO.QueryPatient",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",items:[{xtype:"textfield",itemId:"WLENDOQP_PatId",width:260,label:"病人ID",placeHolder:"病歷號或身分證號"},{xtype:"button",itemId:"WLENDOQP_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"panel",itemId:"WLENDOQP_MianPanel"}],listeners:[{fn:"onWLENDOQP_QueryBtnTap",event:"tap",delegate:"#WLENDOQP_QueryBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onWLENDOQP_QueryBtnTap:function(b,d,a){this.LoadMyPatients(this.down("#WLENDOQP_PatId").getValue())},onContainerPainted:function(b,a){this.down("#WLENDOQP_PatId").focus();if(this.getInitialFlag()){this.setInitialFlag(false)}},onContainerDestroy:function(a){if(Ext.getStore("sEndoQueryPatients")!=null){Ext.getStore("sEndoQueryPatients").removeAll();Ext.getStore("sEndoQueryPatients").destroy()}this.removeAll(true,true)},onContainerShow:function(a,b){},initialize:function(){this.callParent();this.down("#WLENDOQP_PatId").setValue("");if(Ext.isEmpty(Ext.getStore("sEndoQueryPatients"))){Ext.create("Ext.data.Store",{storeId:"sEndoQueryPatients",clearOnPageLoad:false,model:"NisTRApp.model.ENDO.SchuleData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoMyPatients.ashx",reader:{type:"json"}}})}Ext.getStore("sEndoQueryPatients").addListener("load",function(h,g,k,f,j){NisTRApp.view.GridUtility.onChangeENDOLeaveSelect("ENDO_QueryPatients");NisTRApp.view.GridUtility.onChangeENDOObsRoomSelect("ENDO_QueryPatients")},this);var b=this;var e=Ext.getCmp("ENDO_QueryPatients");if(e==null){e=NisTRApp.view.GridUtility.GenENDOInPatientGrid("ENDO_QueryPatients","內視鏡病人查詢",null,true);e.getTitleBar().hide();var a=Ext.getStore("sEndoQueryPatients");e.setStore(a);e.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapENDOGrid,e);this.down("#WLENDOQP_MianPanel").add(e);e=null;delete e}b=null;delete b;var d=this.down("#WLENDOQP_PatId");d.setValue("");d.addListener("keyup",function(f,h,g){if(h.event.keyCode==13){Ext.ComponentQuery.query("#WLENDOQP_QueryBtn")[0].fireEvent("tap")}},d);d=null;delete d},LoadMyPatients:function(b){if(Ext.getStore("sEndoQueryPatients").isLoading()){return}Ext.getStore("sEndoQueryPatients").removeAll();if(Ext.isEmpty(b)){return}var a=Ext.getStore("sEndoQueryPatients");a.getProxy().setExtraParams({PatID:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a}});Ext.define("NisTRApp.view.WorkList.IPB.InPatients",{extend:Ext.Container,alias:"widget.WL_IPB_INPATIENTS",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"WL_IPB_IPL_Head_ToolBar",items:[{xtype:"selectfield",itemId:"WL_IPB_IPL_Station",width:300,label:"護理站",displayField:"StationName",valueField:"DeptCode"}]},{xtype:"panel",itemId:"IPB_IPL_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"WL_IPB_IPL_Foot_ToolBar",items:[{xtype:"segmentedbutton",itemId:"IPB_IPL_FnBtn",width:"70%",items:[{xtype:"button",flex:1,itemId:"IPB_IPL_AllBtn",text:"ALL"},{xtype:"button",flex:1,itemId:"IPB_IPL_NewOrdBtn",text:"新醫囑"},{xtype:"button",flex:1,itemId:"IPB_IPL_StatBtn",text:"Stat"},{xtype:"button",flex:1,itemId:"IPB_IPL_OverTimeBtn",text:"逾時"},{xtype:"button",flex:1,itemId:"IPB_IPL_NeedDrugBtn",text:"給藥"},{xtype:"button",flex:1,itemId:"IPB_IPL_ChemoBtn",text:"化療"},{xtype:"button",flex:1,itemId:"IPB_IPL_PCABtn",text:"PCA"}]},{xtype:"button",itemId:"IPB_IPL_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"}]}],listeners:[{fn:"onWL_IPB_IPL_StationChange",event:"change",delegate:"#WL_IPB_IPL_Station"},{fn:"onIPB_IPL_AllBtnTap",event:"tap",delegate:"#IPB_IPL_AllBtn"},{fn:"onIPB_IPL_NewOrdBtnTap",event:"tap",delegate:"#IPB_IPL_NewOrdBtn"},{fn:"onIPB_IPL_StatBtnTap",event:"tap",delegate:"#IPB_IPL_StatBtn"},{fn:"onIPB_IPL_OverTimeBtnTap",event:"tap",delegate:"#IPB_IPL_OverTimeBtn"},{fn:"onIPB_IPL_NeedDrugBtnTap",event:"tap",delegate:"#IPB_IPL_NeedDrugBtn"},{fn:"onIPB_IPL_ChemoBtnTap",event:"tap",delegate:"#IPB_IPL_ChemoBtn"},{fn:"onIPB_IPL_PCABtnTap",event:"tap",delegate:"#IPB_IPL_PCABtn"},{fn:"onIPB_IPL_RefreshBtnTap",event:"tap",delegate:"#IPB_IPL_RefreshBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onWL_IPB_IPL_StationChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#WL_IPB_IPL_Station").getValue())}},onIPB_IPL_AllBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter()}a=null;delete a},onIPB_IPL_NewOrdBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.NewOrdCnt>0)},this)}a=null;delete a},onIPB_IPL_StatBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.StatOrderCount>0)},this)}a=null;delete a},onIPB_IPL_OverTimeBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.OverTimeCount>0)},this)}a=null;delete a},onIPB_IPL_NeedDrugBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.NeedDrugCount>0)},this)}a=null;delete a},onIPB_IPL_ChemoBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.ChemoCount>0)},this)}a=null;delete a},onIPB_IPL_PCABtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#IPB_IPL_FnBtn"),d,"confirm-round","normal","","",false);var a=Ext.getStore("sIpbInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.PCACount>0)},this)}a=null;delete a},onIPB_IPL_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#WL_IPB_IPL_Station").getValue())},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPatientList(this.down("#WL_IPB_IPL_Station").getValue());this.setInitialFlag(false)}},onContainerDestroy:function(a){this.setInitialFlag(true);if(Ext.getStore("sIpbStationInfo")!=null){Ext.getStore("sIpbStationInfo").removeAll();Ext.getStore("sIpbStationInfo").destroy()}if(Ext.getStore("sIpbInPatients")!=null){Ext.getStore("sIpbInPatients").removeAll();Ext.getStore("sIpbInPatients").destroy()}console.log("On Destroy :","IPB_InPatient");this.removeAll(true,true)},initialize:function(){this.callParent();this.initialStore();Ext.getStore("sIpbStationInfo").addListener("beforeload",function(b,a,e){Ext.getStore("sIpbInPatients").removeAll();var d=Ext.getCmp("IPB_InPatGrid");if(!Ext.isEmpty(d)){d.removeAll(true,true);d.destroy();d=null}if(d==null){this.down("#IPB_IPL_NewOrdBtn").setBadgeText("");this.down("#IPB_IPL_StatBtn").setBadgeText("");this.down("#IPB_IPL_OverTimeBtn").setBadgeText("");this.down("#IPB_IPL_NeedDrugBtn").setBadgeText("");this.down("#IPB_IPL_ChemoBtn").setBadgeText("");this.down("#IPB_IPL_PCABtn").setBadgeText("");d=NisTRApp.view.GridUtility.GenIPBInPatientGrid("IPB_InPatGrid","住院病人清單",null,false);d.initialFlag=true;d.getTitleBar().hide();d.setStore(Ext.getStore("sIpbInPatients"));d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapIPBGrid,d);this.down("#IPB_IPL_MainPanel").add(d);d=null;delete d}this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1,indicator:false})},this);Ext.getStore("sIpbStationInfo").addListener("load",function(d,b,g,a,f){if(!Ext.isEmpty(b)&&b.length>0){var e=b[0].data;this.down("#IPB_IPL_NewOrdBtn").setBadgeText(e.NewOrdCnt>0?e.NewOrdCnt:"");this.down("#IPB_IPL_StatBtn").setBadgeText(e.StatCnt>0?e.StatCnt:"");this.down("#IPB_IPL_OverTimeBtn").setBadgeText(e.OverTimeCnt>0?e.OverTimeCnt:"");this.down("#IPB_IPL_NeedDrugBtn").setBadgeText(e.NeedDrugCnt>0?e.NeedDrugCnt:"");this.down("#IPB_IPL_ChemoBtn").setBadgeText(e.ChemoCnt>0?e.ChemoCnt:"");this.down("#IPB_IPL_PCABtn").setBadgeText(e.PcaCnt>0?e.PcaCnt:"");e=null;delete e}this.setMasked(false)},this);Ext.getStore("sIpbStationInfo").addListener("refresh",function(b,e,d){var a=Ext.getStore("sIpbInPatients");a.removeAll();if(!Ext.isEmpty(b.getAt(0))&&!Ext.isEmpty(b.getAt(0).Patients())){a.add(b.getAt(0).Patients().data.items)}a.sync();a=null;delete a},this);myThis=null;delete myThis;this.down("#IPB_IPL_AllBtn").fireEvent("tap",this.down("#IPB_IPL_AllBtn"),null,null)},initialStore:function(){this.down("#WL_IPB_IPL_Station").setStore(Ext.getStore("sWorkStationList2"));if(Ext.getStore("sIpbStationInfo")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.IPB.mStationInfo",storeId:"sIpbStationInfo",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:60000,url:SYS_CONST.ApiRoot+"Inp/Search/InPatientList.ashx",reader:{type:"json"}}})}if(Ext.getStore("sIpbInPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.IPB.mPatientData",storeId:"sIpbInPatients"})}},LoadPatientList:function(b){var a={DeptCode:b,UserID:NisTRApp.view.SysUtility.GetUserID()};NisTRApp.view.Misc.LoadData("sIpbStationInfo",a,false);a=null;delete a}});Ext.define("NisTRApp.view.ENDO.SchdHistory",{extend:Ext.Container,alias:"widget.ENDO_SchdHistory",config:{height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",docked:"top",itemId:"ENDOHistoryToolBar",items:[{xtype:"searchfield",itemId:"ENDOHistoryId",width:"290px",label:"病人ID",placeHolder:"病歷號或身份證號"},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"ENDOHISTORY_BegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"ENDOHISTORY_EndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",html:"<h1>重整/查詢</h1>",itemId:"ENDOHISTORY_RefreshBtn",ui:"decline-round",width:"15%",iconCls:"refresh",text:"MyButton89"}]},{xtype:"panel",itemId:"ENDOHistoryMainPanel"}],listeners:[{fn:"onENDOHISTORY_RefreshBtnTap",event:"tap",delegate:"#ENDOHISTORY_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onENDOHISTORY_RefreshBtnTap:function(d,g,b){if(Ext.getStore("sENDOHistory").isLoading()||Ext.isEmpty(this.down("#ENDOHistoryId").getValue())){return}var f=this.down("#ENDOHistoryId").getValue();var a=Ext.getStore("sENDOHistory");a.removeAll();a.getProxy().setExtraParams({ChartNO:f,BegDate:this.down("#ENDOHISTORY_BegDate").getValue(),EndDate:this.down("#ENDOHISTORY_EndDate").getValue()});a.load({callback:function(h,e,j){},scope:this});a=null;delete a;f=null;delete f},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sENDOHistory"))){Ext.getStore("sENDOHistory").removeAll();Ext.getStore("sENDOHistory").destroy()}console.log("on destroy :","ENDO_SCHED_HX");this.removeAll()},onContainerShow:function(a,b){if(Ext.getStore("sENDOHistory").getCount()<=0){this.down("#ENDOHISTORY_RefreshBtn").fireEvent("tap",this.down("#ENDOHISTORY_RefreshBtn"),null,null)}},initialize:function(){this.callParent();if(!Ext.isEmpty(this.getRecord())&&!Ext.isEmpty(this.getRecord().data)&&!Ext.isEmpty(this.getRecord().data.ChartNo)){this.down("#ENDOHistoryId").setValue(this.getRecord().data.ChartNo)}this.down("#ENDOHISTORY_EndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));this.down("#ENDOHISTORY_BegDate").setValue(new Date());if(Ext.isEmpty(Ext.getStore("sENDOHistory"))){Ext.create("Ext.data.Store",{storeId:"sENDOHistory",autoLoad:false,model:"NisTRApp.model.ENDO.HdhisexchangeEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoHxSchdData.ashx",reader:{type:"json"}}})}var b=Ext.getCmp("sENDOHistory");if(Ext.isEmpty(b)){b=this.GenENDOHistoryGrid("EndoHistoryGrid","","");b.getTitleBar().hide();var a=Ext.getStore("sENDOHistory");b.setStore(a);this.down("#ENDOHistoryMainPanel").add(b);a=null;delete a}b=null;delete b;this.down("#ENDOHistoryMainPanel").setRecord(this.getRecord())},GenENDOHistoryGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">查無排檢資料.</div>',plugins:[{type:"gridcolumnresizing"}],columns:[{text:"排程日期",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",width:90,tpl:'<span style="color:{StyleColor}; font-size: 12px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.SchdDate)]}</span>',flex:1,dataIndex:"SchdDate",editable:false,sortable:true},{text:"排程時間",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{SchdTime} </span>',flex:1,width:90,dataIndex:"DocNo",editable:false,sortable:true},{text:"醫令名稱",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{CodeName}</span>',flex:1,width:300,dataIndex:"CodeName",editable:false,sortable:false},{text:"檢查醫師",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{RequestMan} </span>',flex:1,width:90,dataIndex:"ArrivalTime",editable:false,sortable:false}]})}});Ext.define("NisTRApp.view.ReasonTempletePanel",{extend:Ext.Panel,config:{separation:";",height:320,width:320,hideOnMaskTap:true,layout:{type:"fit"},modal:true,field:{},caller:{},store:{},items:[{xtype:"list",itemId:"ItemList",itemTpl:["<Div>{name}</Div>"]}],listeners:[{fn:"onItemListItemTap",event:"itemtap",delegate:"#ItemList"},{fn:"onPanelHide",event:"hide"},{fn:"onPanelDestroy",event:"destroy"}]},onItemListItemTap:function(b,f,k,a,j,g){if(!Ext.isEmpty(this.getField())){var h=this.getField();var d=h.getValue();if(Ext.isEmpty(d)){h.setValue(a.data.name)}else{h.setValue(d+this.getSeparation()+a.data.name)}h=null;delete h;d=null;delete d}},onPanelHide:function(a,b){this.destroy()},onPanelDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(!Ext.isEmpty(this.getStore())){this.down("#ItemList").setStore(this.getStore())}}});Ext.define("NisTRApp.view.ENDO.SechdDetails",{extend:Ext.Container,alias:"widget.ENDO_SechdDetails",config:{stopDistroyEvent:true,hiddenHeadBar:true,centered:false,height:480,width:760,hideOnMaskTap:false,layout:{type:"fit"},modal:false,caller:{},items:[{xtype:"panel",itemId:"ENDO_SDS_MainPanel"}],listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"}]},onContainerDestroy:function(b){var a=Ext.getCmp("ENDO_HxSheetGrid");if(!Ext.isEmpty(a)){a.removeAll(true,true);a.destroy()}a=null;delete a;if(Ext.getStore("sEndoHxSheet")!=null){Ext.getStore("sEndoHxSheet").removeAll();Ext.getStore("sEndoHxSheet").destroy()}console.log("On Destroy :","ENDO_SechdDetails");this.removeAll()},onContainerShow:function(a,b){if(Ext.getStore("sEndoHxSheet").getCount()<=0){this.LoadData(this.getRecord().data.ChartNO,this.getRecord().data.GroupID)}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)){Ext.Msg.alert("ENDO_SechdDetails 病人資料錯誤");this.destroy();return false}if(Ext.isEmpty(this.getRecord().data.GroupID)||this.getRecord().data.GroupID<=0){Ext.Msg.alert("ENDO_SechdDetails 內視鏡資料錯誤");this.destroy();return false}var b=this.getRecord();if(Ext.getStore("sEndoHxSheet")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.ENDO.EndohxsheetEntity",storeId:"sEndoHxSheet",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"ENDO/search/QueryEndoHxSheet.ashx",reader:{type:"json"}}})}var a=this;var d=Ext.getCmp("ENDO_HxSheetGrid");if(!Ext.isEmpty(d)){d.removeAll(true,true);d.destroy();d=null}if(d==null){d=NisTRApp.view.GridUtility.GenENDOHxSheetGrid("ENDO_HxSheetGrid","ENDO排程清單",null,false);d.initialFlag=true;d.getTitleBar().hide();var e=Ext.getStore("sEndoHxSheet");d.setStore(e);this.down("#ENDO_SDS_MainPanel").add(d);d=null;delete d;e=null;delete e}b=null;delete b},LoadData:function(b,a){if(Ext.getStore("sEndoHxSheet").isLoading()){return}var d=Ext.getStore("sEndoHxSheet");d.getProxy().setExtraParams({ChartNO:b,GroupID:a});d.load();d=null;delete d}});Ext.define("NisTRApp.view.OPR_RPT_ANTIMTRANSLOG",{extend:Ext.Container,config:{initialFlag:true,html:"text456",layout:{type:"fit"},items:[{xtype:"panel",itemId:"OPR_RPTANTIM_MainPanel"},{xtype:"toolbar",docked:"bottom",itemId:"ANTIM_ToolBar",items:[{xtype:"datepickerfield",itemId:"OPR_RPT_ANTIMTRANSDatePicker",width:"30%",label:"手術日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"OPR_RPT_ANTIMTRANS_RefreshFinishedBtn",right:"10px",ui:"decline",width:"60px",iconCls:"refresh"}]}],listeners:[{fn:"onOPR_RPT_ANTIMTRANSDatePickerChange",event:"change",delegate:"#OPR_RPT_ANTIMTRANSDatePicker"},{fn:"onOPR_RPT_ANTIMTRANS_RefreshFinishedBtnTap",event:"tap",delegate:"#OPR_RPT_ANTIMTRANS_RefreshFinishedBtn"},{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onOPR_RPT_ANTIMTRANSDatePickerChange:function(d,a,e,b){this.LoadData(a)},onOPR_RPT_ANTIMTRANS_RefreshFinishedBtnTap:function(b,d,a){this.LoadData(this.down("#OPR_RPT_ANTIMTRANSDatePicker").getValue())},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadData(new Date())}},onContainerDestroy:function(a){if(Ext.getStore("sOprAntimTransLog")!=null){Ext.getStore("sOprAntimTransLog").removeAll();Ext.getStore("sOprAntimTransLog").destroy()}this.removeAll(true,true)},GenAntimLogGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",plugins:[{type:"gridviewoptions"},{type:"gridcolumnresizing"}],columns:[{text:REG_CONST.Sex,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:50,tpl:'<img id="OPRSEX_SEX_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{SexStr}.png" alt="Smiley face" height="45" width="45">',flex:1,hidden:false,editable:false,sortable:false,dataIndex:"Sex"},{text:REG_CONST.ChartNo,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRPTMED_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{ChartNO}</a>',flex:1,width:90,hidden:false,editable:false,sortable:true,dataIndex:"ChartNO"},{text:REG_CONST.Name,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:' <a id="OPRPTWORKLIST_PTNAME_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{PatName}</a>',flex:1,width:90,hidden:false,editable:false,sortable:true},{text:"手術日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OprmDate)]}</span>',flex:1,width:100,hidden:false,editable:false,sortable:true,dataIndex:"OprmDate"},{text:REG_CONST.Birthday,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age})</span>',flex:1,width:120,hidden:false,editable:false,sortable:true,dataIndex:"Birthday"},{text:"來源",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{KindName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false,dataIndex:"KindName"},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{DrName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false,dataIndex:"DrName"},{text:"*術前診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAG_SPAN",values.BefDiag_1, "14px", 12, values.CareStyleColor, "OPRPTBEFDIAG_IMG","handPoint.png","25","25" )]}'),flex:1,width:120,hidden:false,editable:false,sortable:false,dataIndex:"BefDiag_1"},{text:"術前診斷1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAGNAME_SPAN",values.BefDiagName1, "14px", 14, values.CareStyleColor, "OPRPTBEFDIAGNAME_IMG","handPoint.png","25","25" )]}'),width:140,hidden:false,sortable:false,flex:1,dataIndex:"BefDiagName1"},{text:"*預定術式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<div id="OPRPTBEFOPR_DIV_{KeyOne}; width:98%;height:98%; margin: 1px 1px 1px 1px;">{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPR_SPAN",values.BefOper_1, "14px", 16, values.CareStyleColor, "OPRPTBEFOPR_IMG","handPoint.png","25","25" )]}</div>'),flex:1,width:140,hidden:false,editable:false,sortable:false,dataIndex:"BefOper_1"},{text:"預定主術1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME_SPAN",values.BefOperName1, "14px", 16, values.CareStyleColor, "OPRPTBEFOPRNAME_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1,dataIndex:"BefOperName1"},{text:"預定主術2",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME2_SPAN",values.BefOperName2, "14px", 16, values.CareStyleColor, "OPRPTBEFOPRNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1,dataIndex:"BefOperName2"},{text:"手術室護理記錄",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{FrmTitle1}</span>',flex:1,width:150,hidden:false,editable:false,sortable:false,dataIndex:"FrmTitle1"},{text:"恢復室護理照護記錄",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{CareStyleColor}; font-size: 14px">{FrmTitle2}</span>',flex:1,width:150,hidden:false,editable:false,sortable:false,dataIndex:"FrmTitle2"},{text:"備註",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<a id="OPENOPR009M_CHARTNO_{KeyOne}" class="link-btn" style="font-size: 14px"; color:{CareStyleColor};>{Msg}</a>',flex:1,width:250,hidden:false,editable:false,sortable:false,dataIndex:"Msg"}]})},initialize:function(){this.callParent();if(Ext.data.ModelManager.getModel("OprAntimTransLogEntity")==null){Ext.define("OprAntimTransLogEntity",{extend:NisTRApp.model.OPR.OprmstvEntity,config:{fields:[{name:"Msg",type:"string"},{name:"Status",type:"string"},{name:"FrmTitle1",type:"string"},{name:"FrmTitle2",type:"string"},{name:"FrmOpen1",type:"string"},{name:"FrmOpen2",type:"string"},{name:"FrmMast1",type:"string"},{name:"FrmMast2",type:"string"}]}})}if(Ext.isEmpty(Ext.getStore("sOprAntimTransLog"))){Ext.create("Ext.data.Store",{storeId:"sOprAntimTransLog",model:"OprAntimTransLogEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprAntimTransLog.ashx",reader:{type:"json"}}})}var a=this;var d=Ext.getCmp("OPR_ANTINGrid");if(d==null){d=this.GenAntimLogGrid("OPR_ANTINGrid","",null);d.getTitleBar().hide();var b=Ext.getStore("sOprAntimTransLog");d.setStore(b);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapOPRGrid,d);this.down("#OPR_RPTANTIM_MainPanel").add(d);d=null;delete d;b=null;delete b}this.down("#OPR_RPT_ANTIMTRANSDatePicker").setValue(new Date());a=null;delete a},LoadData:function(a){if(Ext.getStore("sOprAntimTransLog").isLoading()){return}var b=Ext.getStore("sOprAntimTransLog");b.getProxy().setExtraParams({OprmDate:a});b.load({callback:function(e,d,f){},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.OPR_OPR009M",{extend:Ext.Panel,config:{height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"OPR009M_Main",layout:{animation:false,type:"card"},items:[{xtype:"panel",title:"手術時間",itemId:"OPR009M_MainPanel",scrollable:"vertical",items:[{xtype:"toolbar",docked:"bottom",itemId:"OPR009M_FootBar",items:[{xtype:"button",itemId:"OPR009M_ColseBtn",right:"10px",ui:"confirm",width:"90px",text:"關閉"},{xtype:"button",itemId:"OPR009M_SaveBtn",left:"10px",ui:"decline",width:"90px",text:"存檔"}]}]},{xtype:"panel",title:"抗生素",itemId:"OPR009M_ANTID",layout:{type:"hbox"},items:[{xtype:"panel",itemId:"OPR009M_AntiInfoPanel",width:"60%",layout:{type:"card"},scrollable:false,items:[{xtype:"panel",docked:"top",height:"50%",itemId:"OPR009M_AntidPanel"},{xtype:"panel",docked:"bottom",height:"50%",itemId:"OPR009M_AntidTempPanel",items:[{xtype:"label",height:"2.0em",html:'<div  class="globalList" ><table  style="width:100%"><thead><th >住院護理給藥記錄</th></thead></div>'}]}]},{xtype:"formpanel",cls:"mediumfont",itemId:"OPR009M_AntiCreatePanel",width:"40%",items:[{xtype:"label",height:"2.0em",html:'<div  class="globalList" ><table  style="width:100%"><thead><th >新增抗生素</th></thead></div>'},{xtype:"fieldset",title:"院內碼",items:[{xtype:"selectfield",itemId:"OPR009M_AntiCode",label:"醫令",displayField:"DrugName",valueField:"CodeNO"},{xtype:"label",height:"2.0em",html:"",itemId:"OPR009M_AntiCodeTxt"}]},{xtype:"fieldset",itemId:"OPR009M_AntiDetialSet",items:[{xtype:"numberfield",itemId:"OPR009M_AntiBaseDose",label:"劑量",placeHolder:"請輸入整數"},{xtype:"selectfield",itemId:"OPR009M_AntiUnit",label:"單位",displayField:"MolUnit",valueField:"MolUnit"},{xtype:"selectfield",itemId:"OPR009M_AntiFreq",label:"頻次",displayField:"DisplayField",valueField:"FreqCode"},{xtype:"selectfield",itemId:"OPR009M_AntiRoute",label:"服法",displayField:"DisplayField",valueField:"Route"}]},{xtype:"toolbar",docked:"bottom",itemId:"OPR009M_AntiFootBar",items:[{xtype:"button",centered:false,itemId:"OPR009M_AntiCloseBtn",left:"5px",ui:"confirm",width:"45%",text:"關閉"},{xtype:"button",centered:false,itemId:"OPR009M_AntidCreateBtn",left:"",right:"5px",ui:"decline",width:"45%",text:"存檔"}]}]}]}]},{xtype:"toolbar",cls:"commonPanel-toolbar",docked:"top",items:[{xtype:"label",html:"Common_INFO",itemId:"CommonInfoLbl",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   生日.{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age}) &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        身份證號. {PatIdno} </span>","</td>","","</tr>","</table>"]}]}],listeners:[{fn:"onOPR009M_ColseBtnTap",event:"tap",delegate:"#OPR009M_ColseBtn"},{fn:"onOPR009M_SaveBtnTap",event:"tap",delegate:"#OPR009M_SaveBtn"},{fn:"onOPR009M_AntiCodeChange",event:"change",delegate:"#OPR009M_AntiCode"},{fn:"onOPR009M_AntiCloseBtnTap",event:"tap",delegate:"#OPR009M_AntiCloseBtn"},{fn:"onOPR009M_AntidCreateBtnTap",event:"tap",delegate:"#OPR009M_AntidCreateBtn"},{fn:"onOPR009M_ANTIDShow",event:"show",delegate:"#OPR009M_ANTID"},{fn:"onPanelDestroy",event:"destroy"}]},onOPR009M_ColseBtnTap:function(b,f,a){this.setHidden(true);var d=this;setTimeout(function(){d.destroy()},200)},onOPR009M_SaveBtnTap:function(b,d,a){this.SaveOprTime()},onOPR009M_AntiCodeChange:function(a,h,e,g){this.down("#OPR009M_AntiCodeTxt").setHtml('<div class="globalList" ><table  style="width:100%"><thead><th >'+h+"</th></thead></div>");var b=a.getStore();if(!Ext.isEmpty(b)){var d=b.find("CodeNO",h);var f=b.getAt(d);if(!Ext.isEmpty(f)){this.down("#OPR009M_AntiFreq").setValue(Ext.isEmpty(f.data.Frequency)?null:f.data.Frequency);this.down("#OPR009M_AntiRoute").setValue(Ext.isEmpty(f.data.Route)?null:f.data.Route);this.down("#OPR009M_AntiUnit").setValue(Ext.isEmpty(f.data.MolUnit)?null:f.data.MolUnit);this.down("#OPR009M_AntiBaseDose").setValue(Ext.isEmpty(f.data.BaseDose)?null:f.data.BaseDose)}}},onOPR009M_AntiCloseBtnTap:function(b,f,a){this.setHidden(true);var d=this;setTimeout(function(){d.destroy()},200)},onOPR009M_AntidCreateBtnTap:function(d,f,g){var h=this.down("#OPR009M_AntiCode").getValue();if(Ext.isEmpty(h)){NisTRApp.view.Misc.Alert("請選擇醫令碼",800);return}var j=this.down("#OPR009M_AntiBaseDose").getValue();if(Ext.isEmpty(j)){NisTRApp.view.Misc.Alert("請輸入劑量",800);return}var k=this.down("#OPR009M_AntiUnit").getValue();if(Ext.isEmpty(k)){NisTRApp.view.Misc.Alert("請選擇單位",800);return}var a=this.down("#OPR009M_AntiFreq").getValue();if(Ext.isEmpty(a)){NisTRApp.view.Misc.Alert("請選擇頻次",800);return}var l=this.down("#OPR009M_AntiRoute").getValue();if(Ext.isEmpty(l)){NisTRApp.view.Misc.Alert("請選擇服法",800);return}var b=this.down("#AntiExeDateTime").getFormattedValue("Ymd");if(Ext.isEmpty(b)){NisTRApp.view.Misc.Alert("請輸入執行日期",800);return}this.CreateAntid()},onOPR009M_ANTIDShow:function(a,b){if(Ext.getStore("sOprAntidData").getCount()<=0){this.LoadAntidData(this.getRecord().data.OprmstID)}if(Ext.getStore("sOprAntidTempData").getCount()<=0){this.LoadAntidTempData(this.getRecord().data.OprmstID)}},onPanelDestroy:function(b){if(Ext.getStore("sOprAntimData")!=null){Ext.getStore("sOprAntimData").removeAll();Ext.getStore("sOprAntimData").destroy()}if(Ext.getStore("sAntiCodes")!=null){Ext.getStore("sAntiCodes").removeAll();Ext.getStore("sAntiCodes").destroy()}if(Ext.getStore("sOprAntidData")!=null){Ext.getStore("sOprAntidData").removeAll();Ext.getStore("sOprAntidData").destroy()}if(Ext.getStore("sOprAntidTempData")!=null){Ext.getStore("sOprAntidTempData").removeAll();Ext.getStore("sOprAntidTempData").destroy()}try{this.removeAll(true,true)}catch(a){this.removeAll(true,true)}},CreateDateTimePanel:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",centered:false,});var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function e(g,h,f){this.timeField.setValue(null)};var a=this.CreatDateField("EnterDateTime","EnterDateTime","進入手術房日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("EnterDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("EnterDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("AnsDateTime","AnsDateTime","麻醉開始日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("AnsDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("AnsDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("AnsOkDateTime","AnsOkDateTime","麻醉完成日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("AnsOkDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("AnsOkDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("ReadyDateTime","ReadyDateTime","手術準備完成日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("ReadyDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("ReadyDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("ArrivalDateTime","ArrivalDateTime","主治醫師到達日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("ArrivalDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("ArrivalDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("StartDateTime","StartDateTime","實際下刀日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("StartDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("StartDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("EndDateTime","EndDateTime","手術結束日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("EndDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("EndDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("CloseDateTime","CloseDateTime","送出日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("CloseDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("CloseDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("InRecoveryDateTime","InRecoveryDateTime","進恢復室日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("InRecoveryDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("InRecoveryDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=this.CreatDateField("OutRecoveryDateTime","OutRecoveryDateTime","出恢復室日期","45%","69%",null);b.add(a);b.add(this.CreateCloseBtn("OutRecoveryDateTimeSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("OutRecoveryDateTimeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));e=null;delete e;d=null;delete d;a=null;delete a;return b},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)||Ext.isEmpty(this.getRecord().data.OprmstID)){Ext.Msg.alert("病人資料錯誤");return false}var d=this.getRecord();this.initialStore();this.down("#CommonInfoLbl").setRecord(this.getRecord());this.down("#OPR009M_AntiFreq").setStore(Ext.getStore("sAntiFreqs"));this.down("#OPR009M_AntiRoute").setStore(Ext.getStore("sAntiRoutes"));this.down("#OPR009M_AntiCode").setStore(Ext.getStore("sAntiCodes"));this.down("#OPR009M_AntiUnit").setStore(Ext.getStore("sAntiCodes"));Ext.getStore("sAntiCodes").getProxy().setExtraParams({OprmDate:d.data.OprmDate});setTimeout(function(){Ext.getStore("sAntiCodes").load()},1000);try{this.down("#OPR009M_MainPanel").add(this.CreateDateTimePanel());this.down("#OPR009M_MainPanel").add(this.CreateAnsPanel());this.down("#OPR009M_MainPanel").add(this.CreateOprPartPanel());this.down("#OPR009M_MainPanel").add(this.CreateDrSOprPartPanel());this.down("#OPR009M_MainPanel").add(this.CreateIsDelayPanel());this.down("#OPR009M_MainPanel").add(this.CreateAntiUseField());this.down("#OPR009M_AntiDetialSet").add(this.CreatDateField("AntiExeDateTime","AntiExeDateTime","執行時間","30%","99%",new Date()));var b=this;var f=Ext.getCmp("OPR_ANTIDGrid");if(!Ext.isEmpty(f)){f.destroy();f=null}if(f==null){f=this.GenAntidGrid("OPR_ANTIDGrid","",null);f.getTitleBar().hide();var h=Ext.getStore("sOprAntidData");f.setStore(h);this.down("#OPR009M_AntidPanel").add(f);f=null;delete f;h=null;delete h}var f=Ext.getCmp("OPR_ANTIDTempGrid");if(!Ext.isEmpty(f)){f.destroy();f=null}if(f==null){f=this.GenAntidTempGrid("OPR_ANTIDTempGrid","",null);f.getTitleBar().hide();var a=Ext.getStore("sOprAntidTempData");f.setStore(a);this.down("#OPR009M_AntidTempPanel").add(f);f=null;delete f;a=null;delete a}this.LoadData(this.getRecord().data.OprmstID)}catch(g){console.log(g)}d=null;delete d},CreatDateField:function(g,d,e,b,a,f){return Ext.create("Ext.form.DateTimePicker",{itemId:g,name:d,label:e,value:f,labelWidth:b,autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",style:"float:left;font-size:16px;",width:a,picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}})},CreateCloseBtn:function(f,b,e,a){var d=Ext.create("Ext.Button",{html:b,itemId:f,margin:"5 5 5 5",ui:"plain",style:"float:left;font-size:16px;",timeField:e}).addListener("tap",a);d.timeField=e;return d},LoadData:function(b){if(Ext.getStore("sOprAntimData").isLoading()){return}this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});var a=Ext.getStore("sOprAntimData");a.getProxy().setExtraParams({OprmstID:b});a.load({callback:function(g,f,j){this.setMasked(false);if(!Ext.isEmpty(g)&&g.length>0){var e=new Date(1900,1,1,0,0,0).getTime();var h=g[0];var d=h.data.EnterDateTime.getTime();this.down("#EnterDateTime").setValue(d<e?null:h.data.EnterDateTime);d=h.data.AnsDateTime.getTime();this.down("#AnsDateTime").setValue(d<e?null:h.data.AnsDateTime);d=h.data.AnsOkDateTime.getTime();this.down("#AnsOkDateTime").setValue(d<e?null:h.data.AnsOkDateTime);d=h.data.ReadyDateTime.getTime();this.down("#ReadyDateTime").setValue(d<e?null:h.data.ReadyDateTime);d=h.data.ArrivalDateTime.getTime();this.down("#ArrivalDateTime").setValue(d<e?null:h.data.ArrivalDateTime);d=h.data.StartDateTime.getTime();this.down("#StartDateTime").setValue(d<e?null:h.data.StartDateTime);d=h.data.EndDateTime.getTime();this.down("#EndDateTime").setValue(d<e?null:h.data.EndDateTime);d=h.data.CloseDateTime.getTime();this.down("#CloseDateTime").setValue(d<e?null:h.data.CloseDateTime);d=h.data.InRecoveryDateTime.getTime();this.down("#InRecoveryDateTime").setValue(d<e?null:h.data.InRecoveryDateTime);d=h.data.OutRecoveryDateTime.getTime();this.down("#OutRecoveryDateTime").setValue(d<e?null:h.data.OutRecoveryDateTime);this.down("#RecoveryAnsDr").setValue(h.data.RecoveryAnsDr);if(!Ext.isEmpty(h.data.OpPartFlag)){console.log(h.data.OpPartFlag);this.down("#OpPartFlag"+h.data.OpPartFlag).check()}if(!Ext.isEmpty(h.data.DrSOpPart)){this.down("#DrSOpPart"+h.data.DrSOpPart).check()}if(!Ext.isEmpty(h.data.IsDelay)){this.down("#IsDelay").setValue(h.data.IsDelay);Ext.getCmp("NondelayRsn").setHidden(h.data.IsDelay!="1");Ext.getCmp("DelayRsn").setHidden(h.data.IsDelay!="2")}if(!Ext.isEmpty(h.data.NondelayRsn)){this.down("#NondelayRsn").setValue(h.data.NondelayRsn)}if(!Ext.isEmpty(h.data.UseAnti)){this.down("#UseAnti").setValue(h.data.UseAnti)}e=null;delete e;d=null;delete d}},scope:this});a=null;delete a},SaveOprTime:function(){if(Ext.getStore("sOprAntimData").isLoading()){return}var h=this.getRecord();var a="";var d=this.down("#OpPartFlagForm").getValues();if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.OpPartFlag)){a=d.OpPartFlag}var b="";d=this.down("#DrSOpPartForm").getValues();if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.DrSOpPart)){b=d.DrSOpPart}var f="";d=this.down("#UseAnti").getValue();if(!Ext.isEmpty(d)){f=d}var e={OprmstID:h.data.OprmstID,EnterDate:this.down("#EnterDateTime").getFormattedValue("Ymd"),EnterTime:this.down("#EnterDateTime").getFormattedValue("Hi"),AnsDate:this.down("#AnsDateTime").getFormattedValue("Ymd"),AnsTime:this.down("#AnsDateTime").getFormattedValue("Hi"),ReadyDate:this.down("#ReadyDateTime").getFormattedValue("Ymd"),ReadyTime:this.down("#ReadyDateTime").getFormattedValue("Hi"),ArrivalDate:this.down("#ArrivalDateTime").getFormattedValue("Ymd"),ArrivalTime:this.down("#ArrivalDateTime").getFormattedValue("Hi"),StartDate:this.down("#StartDateTime").getFormattedValue("Ymd"),StartTime:this.down("#StartDateTime").getFormattedValue("Hi"),EndDate:this.down("#EndDateTime").getFormattedValue("Ymd"),EndTime:this.down("#EndDateTime").getFormattedValue("Hi"),CloseDate:this.down("#CloseDateTime").getFormattedValue("Ymd"),CloseTime:this.down("#CloseDateTime").getFormattedValue("Hi"),AnsOkDate:this.down("#AnsOkDateTime").getFormattedValue("Ymd"),AnsOkTime:this.down("#AnsOkDateTime").getFormattedValue("Hi"),InRecoveryDate:this.down("#InRecoveryDateTime").getFormattedValue("Ymd"),InRecoveryTime:this.down("#InRecoveryDateTime").getFormattedValue("Hi"),OutRecoveryDate:this.down("#OutRecoveryDateTime").getFormattedValue("Ymd"),OutRecoveryTime:this.down("#OutRecoveryDateTime").getFormattedValue("Hi"),RecoveryAnsDr:this.down("#RecoveryAnsDr").getValue(),OpPartFlag:a,DrSOpPart:b,IsDelay:this.down("#IsDelay").getValue(),NondelayRsn:this.down("#NondelayRsn").getValue(),UseAnti:f};var g=this;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/Opr009MUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprmstID:h.data.OprmstID,Json:btoa(encodeURIComponent(JSON.stringify(e)))},success:function(j){g.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){}k=null;delete k;g=null;delete g},failure:function(){g.setMasked(false);g=null;delete g}});e=null;delete e;b=null;delete b;a=null;delete a;f=null;delete f;h=null;delete h},CreateAnsPanel:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",centered:false});var a=Ext.create("Ext.field.Select",{id:"RecoveryAnsDr",itemId:"RecoveryAnsDr",label:"恢復室麻醉醫師",height:"2.8em",labelWidth:"30%",width:"99%",options:[{text:"",value:""},{text:"彭文玲",value:"D0019"},{text:"曾祥宗",value:"D0029"},{text:"許哲彰",value:"000737"},{text:"黎乃良",value:"001129"},{text:"賴威儒",value:"002108"},{text:"趙怡芳",value:"003560"},{text:"陳鈺如",value:"003676"}],style:"float:left;font-size:16px;"});b.add(a);_setEvent=null;delete _setEvent;_clearEvent=null;delete _clearEvent;a=null;delete a;return b},CreateOprPartPanel:function(){return Ext.create("Ext.form.FieldSet",{width:"95%",height:"190px",scrollable:false,title:"★手術部位註記",layout:"fit",centered:false,items:[{xtype:"formpanel",itemId:"OpPartFlagForm",id:"OpPartFlagForm",scrollable:false,items:[{xtype:"radiofield",itemId:"OpPartFlag_1",name:"OpPartFlag",value:"",label:"",hidden:true},{xtype:"radiofield",itemId:"OpPartFlag0",name:"OpPartFlag",value:"0",label:"完成"},{xtype:"radiofield",itemId:"OpPartFlag1",name:"OpPartFlag",value:"1",label:"未完成"},{xtype:"radiofield",itemId:"OpPartFlag2",name:"OpPartFlag",value:"2",label:"不需執行"}]}]})},CreateDrSOprPartPanel:function(){return Ext.create("Ext.form.FieldSet",{width:"95%",height:"145px",scrollable:false,title:"★劃刀前與醫師口頭確認手術部位",centered:false,layout:"fit",items:[{xtype:"formpanel",itemId:"DrSOpPartForm",id:"DrSOpPartForm",scrollable:false,items:[{xtype:"radiofield",itemId:"DrSOpPart_1",name:"DrSOpPart",value:"",label:"",hidden:true},{xtype:"radiofield",itemId:"DrSOpPart0",name:"DrSOpPart",value:"0",label:"完成"},{xtype:"radiofield",itemId:"DrSOpPart1",name:"DrSOpPart",value:"1",label:"未完成"}]}]})},CreateIsDelayPanel:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",centered:false});var a=Ext.create("Ext.field.Select",{id:"IsDelay",itemId:"IsDelay",label:"接台狀態",height:"2.8em",labelWidth:"45",width:"99%",options:[{text:"",value:""},{text:"接台時間<=15分鐘",value:"1"},{text:"接台時間>15分鐘",value:"2"}],style:"float:left;font-size:16px;",listeners:{change:function(f,e,d){Ext.getCmp("NondelayRsn").setHidden(e!="1");Ext.getCmp("DelayRsn").setHidden(e!="2");if(e!="1"){Ext.getCmp("NondelayRsn").setValue(null)}}}});b.add(a);a=Ext.create("Ext.field.Select",{id:"NondelayRsn",itemId:"NondelayRsn",label:"接台原因",height:"2.8em",labelWidth:"45",width:"99%",hidden:true,options:[{text:"",value:""},{text:"當天第一台刀",value:"1"},{text:"手術續接下台",value:"2"}],style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.Button",{html:"<h1>延遲原因</h1>",id:"DelayRsn",itemId:"DelayRsn",record:this.getRecord(),margin:"5 5 5 5",style:"float:left;font-size:16px;",hidden:true,scope:this,listeners:{tap:function(f,g,d){if(!Ext.isEmpty(Ext.getCmp("_oprDelayRsnPanel"))){Ext.getCmp("_oprDelayRsnPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_oprDelayRsnPanel"))){var h=Ext.create("NisTRApp.view.OPR_DelayRsnPanel",{id:"_oprDelayRsnPanel",modal:true,centered:true,record:this.getRecord(),hideOnMaskTap:true,caller:this});this.overlay=Ext.Viewport.add(h);this.overlay.show();h=null;delete h}}}});b.add(a);_setEvent=null;delete _setEvent;_clearEvent=null;delete _clearEvent;a=null;delete a;return b},reset:function(){this.down("#EnterDateTime").setValue(null);this.down("#AnsDateTime").setValue(null);this.down("#AnsOkDateTime").setValue(null);this.down("#ReadyDateTime").setValue(null);this.down("#ArrivalDateTime").setValue(null);this.down("#StartDateTime").setValue(null);this.down("#EndDateTime").setValue(null);this.down("#CloseDateTime").setValue(null);this.down("#InRecoveryDateTime").setValue(null);this.down("#OutRecoveryDateTime").setValue(null);this.down("#RecoveryAnsDr").setValue(null);this.down("#OpPartFlag_1").check();this.down("#DrSOpPart_1").check();this.down("#IsDelay").setValue(null);Ext.getCmp("NondelayRsn").setHidden(true);Ext.getCmp("DelayRsn").setHidden(true);this.down("#NondelayRsn").setValue(null)},initialStore:function(){if(Ext.isEmpty(Ext.getStore("sOprAntimData"))){Ext.create("Ext.data.Store",{storeId:"sOprAntimData",model:"NisTRApp.model.OPR.AntimData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOpr009M.ashx",reader:{type:"json"}}})}if(Ext.isEmpty(Ext.getStore("sAntiRoutes"))){Ext.create("Ext.data.Store",{storeId:"sAntiRoutes",model:"NisTRApp.model.Sys.RouteEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryAntiRoutes.ashx",reader:{type:"json"}}})}if(Ext.getStore("sAntiRoutes").getCount()<=0){Ext.getStore("sAntiRoutes").load()}if(Ext.isEmpty(Ext.getStore("sAntiFreqs"))){Ext.create("Ext.data.Store",{storeId:"sAntiFreqs",model:"NisTRApp.model.Sys.FreqEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryAntiFreqs.ashx",reader:{type:"json"}}})}if(Ext.getStore("sAntiFreqs").getCount()<=0){Ext.getStore("sAntiFreqs").load()}if(Ext.isEmpty(Ext.getStore("sAntiCodes"))){Ext.create("Ext.data.Store",{storeId:"sAntiCodes",model:"NisTRApp.model.Sys.SysstdEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryAntiCodes.ashx",reader:{type:"json"}}})}if(Ext.isEmpty(Ext.getStore("sOprAntidData"))){Ext.create("Ext.data.Store",{storeId:"sOprAntidData",model:"NisTRApp.model.OPR.OprantidEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprAntid.ashx",reader:{type:"json"}}})}if(Ext.isEmpty(Ext.getStore("sOprAntidTempData"))){Ext.create("Ext.data.Store",{storeId:"sOprAntidTempData",model:"NisTRApp.model.OPR.AntidTempData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprAntidTemp.ashx",reader:{type:"json"}}})}},CreateAntiUseField:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",centered:false});var a=Ext.create("Ext.field.Select",{id:"UseAnti",itemId:"UseAnti",label:"抗生素使用狀況",height:"2.8em",labelWidth:"30%",width:"99%",options:[{text:"",value:""},{text:"cefazolin",value:"1"},{text:"cefmetazole",value:"2"},{text:"其它抗生素",value:"3"},{text:"病人已接受抗生素治療",value:"4"},{text:"局部手術不需預防性抗生素",value:"5"},{text:"醫師不使用",value:"6"}],style:"float:left;font-size:16px;"});b.add(a);_setEvent=null;delete _setEvent;_clearEvent=null;delete _clearEvent;a=null;delete a;return b},LoadAntidData:function(b){if(Ext.getStore("sOprAntidData").isLoading()){return}var a=Ext.getStore("sOprAntidData");a.getProxy().setExtraParams({OprmstID:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a},GenAntidGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"院內碼",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{CodeNO}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"CodeNO"},{text:"醫令名稱",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{CodeName}</span>',flex:1,width:200,hidden:false,editable:false,sortable:false,dataIndex:"CodeName"},{text:"劑量",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Dose}</span>',flex:1,width:60,hidden:false,editable:false,sortable:false,dataIndex:"Dose"},{text:"單位",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Unit}</span>',flex:1,width:60,hidden:false,editable:false,sortable:false,dataIndex:"Unit"},{text:"頻次",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Frequency}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"Frequency"},{text:"服法",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Route}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"Route"},{text:"執行日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{ExeDate}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"CodeNO"},{text:"執行時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{ExeTime}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"ExeTime"}]})},CreateAntid:function(){if(Ext.getStore("sOprAntidData").isLoading()){return}var l=this.getRecord();var e=this.down("#OPR009M_AntiCode").getValue();var f=this.down("#OPR009M_AntiBaseDose").getValue();var a=this.down("#OPR009M_AntiFreq").getValue();var j=this.down("#OPR009M_AntiRoute").getValue();var h=this.down("#OPR009M_AntiUnit").getValue();var d=this.down("#AntiExeDateTime").getFormattedValue("Ymd");var b=this.down("#AntiExeDateTime").getFormattedValue("Hi");var k={OprmstID:l.data.OprmstID,CodeNO:e,Dose:f,Frequency:a,Route:j,Unit:h,ExeDate:d,ExeTime:b};var g=this;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OprAntidUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprmstID:l.data.OprmstID,Json:btoa(encodeURIComponent(JSON.stringify(k)))},success:function(m){g.setMasked(false);var n=Ext.decode(m.responseText);NisTRApp.view.Misc.Alert(n.Message,(n.Success?800:0));if(n.Success){Ext.getStore("sOprAntidData").load()}n=null;delete n;g=null;delete g},failure:function(){g.setMasked(false);g=null;delete g}});k=null;delete k;e=null;delete e;f=null;delete f;a=null;delete a;j=null;delete j;h=null;delete h;d=null;delete d;b=null;delete b;l=null;delete l},LoadAntidTempData:function(b){if(Ext.getStore("sOprAntidTempData").isLoading()){return}var a=Ext.getStore("sOprAntidTempData");a.getProxy().setExtraParams({OprmstID:b});a.load({callback:function(e,d,f){},scope:this});a=null;delete a},GenAntidTempGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,baseCls:"x-grid",emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"術前/後",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{OpWhen}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"OpWhen"},{text:"院內碼",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{CodeNO}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"CodeNO"},{text:"醫令名稱",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{CodeName}</span>',flex:1,width:200,hidden:false,editable:false,sortable:false,dataIndex:"CodeName"},{text:"頻次",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Frequency}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"Frequency"},{text:"服法",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{Route}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"Route"},{text:"執行日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{ExeDate}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"CodeNO"},{text:"執行時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{ExeTime}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"ExeTime"},{text:"執行人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="font-size: 14px">{ProcName}</span>',flex:1,width:90,hidden:false,editable:false,sortable:false,dataIndex:"ProcName"}]})}});Ext.define("NisTRApp.view.OPR_FrmOprData",{extend:Ext.Panel,config:{layout:{type:"fit"},items:[{xtype:"toolbar",docked:"bottom"},{xtype:"panel",layout:{type:"fit"},items:[{xtype:"list",itemId:"OPRFOD_History",itemTpl:["<div>",'<span class="posted" style="color:black;"> 標題 : {Title} - {SubTitle}&nbsp;</span>',"</div>","<br>",'<div style="font-size:small;"> ',"<br>    ",'<span style="color:black;">執行時間: </span> <span style="color:red;">{[NisTRApp.view.DateUtil.FormDateFormat(values.MedicalDate)]}</span>','<span style="color:black;">  {UserName}</span>',"<br>    ","<br>    ",'<span style="color: black;">表單內容: &nbsp;&nbsp;</span>  <span style="color:blue;"><pre style="word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">{Html} </pre></span>',"</div>",""]}]},{xtype:"toolbar",docked:"top"}]}});Ext.define("NisTRApp.view.OPR_DelayRsnPanel",{extend:Ext.Panel,config:{centered:true,height:320,width:560,hideOnMaskTap:true,layout:{type:"fit"},modal:true,items:[{xtype:"list",itemId:"OPRDR_List",disableSelection:true,itemTpl:["<div>","    ","    <table>","    ","        <tr>",'            <td style="width:520px" >{ParValue}</td>','             <td style="width:40px">',"            ",'                 <tpl if= "OnSelect == &quot;Y&quot;">    ','                     <img id={ParID} src= "../_/img/checkbox-icon.png" alt="Smiley face" height="16" width="16">',"                </tpl>","                    ",'                <tpl if= "OnSelect != &quot;Y&quot;">    ','                    <img id={ParID} src= "../_/img/unchecked-checkbox-icon.png" alt="Smiley face" height="16" width="16">',"                </tpl>","             </td>","            ","        </tr>","    </table>","   ","</div>"],grouped:true},{xtype:"toolbar",docked:"bottom",itemId:"OPRDR_FootBar",items:[{xtype:"button",itemId:"OPRDR_CloseBtn",left:"10px",ui:"confirm",width:"90px",text:"關閉"},{xtype:"button",itemId:"OPRDR_SaveBtn",right:"10px",ui:"decline",width:"90px",text:"存檔"}]}],listeners:[{fn:"onOPRDR_ListItemTap",event:"itemtap",delegate:"#OPRDR_List"},{fn:"onOPRDR_CloseBtnTap",event:"tap",delegate:"#OPRDR_CloseBtn"},{fn:"onOPRDR_SaveBtnTap",event:"tap",delegate:"#OPRDR_SaveBtn"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelHide",event:"hide"}]},onOPRDR_ListItemTap:function(b,f,j,a,h,g){var d=Ext.fly(a.data.ParID);if(null==a.data.OnSelect||""==a.data.OnSelect){a.data.OnSelect="Y";d.dom.src="../_/img/checkbox-icon.png"}else{a.data.OnSelect="";d.dom.src="../_/img/unchecked-checkbox-icon.png"}delete d;return},onOPRDR_CloseBtnTap:function(b,d,a){this.destroy()},onOPRDR_SaveBtnTap:function(g,k,f){if(Ext.getStore("sOprDelayRsn").isLoading()){return}var a=[];var j=this.getRecord();var b=Ext.getStore("sOprDelayRsn");b.first();b.each(function(e){if(e.data.OnSelect=="Y"){a.push(e.data.ParID)}});var d={OprmstID:j.data.OprmstID,SelectList:a};var h=this;h.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OPR/action/OprDelayRsnUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprmstID:j.data.OprmstID,Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(e){h.setMasked(false);var l=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){}l=null;delete l;h=null;delete h},failure:function(){h.setMasked(false);h=null;delete h}});d=null;delete d;b=null;delete b;a=null;delete a},onPanelDestroy:function(a){if(Ext.getStore("sOprDelayRsn")!=null){Ext.getStore("sOprDelayRsn").removeAll();Ext.getStore("sOprDelayRsn").destroy()}this.removeAll(true,true)},onPanelHide:function(a,b){this.destroy()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)||Ext.isEmpty(this.getRecord().data.OprmstID)){Ext.Msg.alert("病人資料錯誤");return false}var a=this.getRecord();if(Ext.data.ModelManager.getModel("OprDelayRsnData")==null){Ext.define("OprDelayRsnData",{extend:Ext.data.Model,config:{fields:[{name:"ParID",type:"string"},{name:"ParValue",type:"string"},{name:"Code",type:"string"},{name:"No",type:"string"},{name:"OnSelect",type:"string"}]}})}if(Ext.isEmpty(Ext.getStore("sOprDelayRsn"))){Ext.create("Ext.data.Store",{storeId:"sOprDelayRsn",model:"OprDelayRsnData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OPR/search/QueryOprdelayRsn.ashx",reader:{type:"json"}},grouper:{groupFn:function(b){switch(b.get("Code")){case"A":result="A.醫師問題";break;case"B":result="B.手術室問題";break;case"C":result="C.病人問題";break;case"D":result="D.病房問題";break;case"E":result="E.麻醉科問題";break;case"F":result="F.供應室問題";break;default:result="";break}return result}}})}this.down("#OPRDR_List").setStore(Ext.getStore("sOprDelayRsn"));Ext.getStore("sOprDelayRsn").getProxy().setExtraParams({OprmstID:this.getRecord().data.OprmstID});Ext.getStore("sOprDelayRsn").load({callback:function(d,b,e){},scope:this})}});Ext.define("NisTRApp.view.CanvasPanel",{extend:Ext.field.Text,alias:"widget.CanvasPanel",config:{sigWidth:350,sigHeight:150,label:"Field",component:{xtype:"field",type:"text",fastFocus:true}},initCanvas:function(){this.bMouseIsDown=false;oCanvas=this.actionOverlayCanvas.element.dom.firstChild;if(oCanvas){this.oCanvas=oCanvas;oCanvas.setAttribute("width",this.width);oCanvas.setAttribute("height",this.height);this.oCtx=oCanvas.getContext("2d");this.oCtx.fillStyle="#FFFFFF";this.oCtx.fillRect(0,0,this.width,this.height)}HTMLCanvasElement.prototype.relMouseCoords=this.relMouseCoords},openCanvasSheet:function(){this.actionOverlay.show()},relMouseCoords:function(h){var g=0;var f=0;var b=0;var a=0;var d=this;do{g+=d.offsetLeft;f+=d.offsetTop}while(d=d.offsetParent);b=h.pageX-g;a=h.pageY-f;return{x:b,y:a}},canvasTouchStart:function(a){this.bMouseIsDown=true;coords=this.actionOverlayCanvas.element.dom.firstChild.relMouseCoords(a);this.iLastX=coords.x;this.iLastY=coords.y},canvasTouchEnd:function(){this.bMouseIsDown=false;this.iLastX=-1;this.iLastY=-1},canvasTouchMove:function(b){if(this.bMouseIsDown){b.stopPropagation();coords=this.actionOverlayCanvas.element.dom.firstChild.relMouseCoords(b);var a=coords.x;var d=coords.y;this.oCtx.beginPath();this.oCtx.moveTo(this.iLastX,this.iLastY);this.oCtx.lineTo(a,d);this.oCtx.strokeStyle="rgba(0,0,0, 1)";this.oCtx.lineWidth=2;this.oCtx.stroke();this.oCtx.closePath();this.iLastX=a;this.iLastY=d}},saveCanvas:function(){this.resetCanvas();this.actionOverlay.hide()},setValue:function(a){this.getComponent().setHtml('<div style="display:none"><img src="'+a+'" width="'+this.width+'"  height="'+this.height+'" /></div>');this.fieldValue=a},getValue:function(){return this.fieldValue},resetCanvas:function(){canvas=this.actionOverlayCanvas.element.dom.firstChild;c=canvas.getContext("2d");c.clearRect(0,0,canvas.width,canvas.height);c.beginPath();if(null!=this.getParent()){this.getParent().show()}this.show()},JPEGEncoder:function(m){var o=this;var F=Math.round;var N=Math.floor;var h=new Array(64);var M=new Array(64);var T=new Array(64);var aa=new Array(64);var D;var j;var s;var W;var L=new Array(65535);var n=new Array(65535);var R=new Array(64);var U=new Array(64);var k=[];var E=0;var a=7;var G=new Array(64);var e=new Array(64);var X=new Array(64);var f=new Array(256);var H=new Array(2048);var C;var Q=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var g=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var b=[0,1,2,3,4,5,6,7,8,9,10,11];var B=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var v=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var A=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var ab=[0,1,2,3,4,5,6,7,8,9,10,11];var p=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var x=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function O(aj){var ai=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var ah=0;ah<64;ah++){var am=N((ai[ah]*aj+50)/100);if(am<1){am=1}else{if(am>255){am=255}}h[Q[ah]]=am}var ak=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var ag=0;ag<64;ag++){var al=N((ak[ag]*aj+50)/100);if(al<1){al=1}else{if(al>255){al=255}}M[Q[ag]]=al}var af=[1,1.387039845,1.306562965,1.175875602,1,0.785694958,0.5411961,0.275899379];var ae=0;for(var an=0;an<8;an++){for(var ad=0;ad<8;ad++){T[ae]=(1/(h[Q[ae]]*af[an]*af[ad]*8));aa[ae]=(1/(M[Q[ae]]*af[an]*af[ad]*8));ae++}}}function K(ah,ai){var ag=0;var aj=0;var af=new Array();for(var ad=1;ad<=16;ad++){for(var ae=1;ae<=ah[ad];ae++){af[ai[aj]]=[];af[ai[aj]][0]=ag;af[ai[aj]][1]=ad;aj++;ag++}ag*=2}return af}function Z(){D=K(g,b);j=K(A,ab);s=K(B,v);W=K(p,x)}function y(){var ae=1;var ag=2;for(var ad=1;ad<=15;ad++){for(var af=ae;af<ag;af++){n[32767+af]=ad;L[32767+af]=[];L[32767+af][1]=ad;L[32767+af][0]=af}for(var ah=-(ag-1);ah<=-ae;ah++){n[32767+ah]=ad;L[32767+ah]=[];L[32767+ah][1]=ad;L[32767+ah][0]=ag-1+ah}ae<<=1;ag<<=1}}function Y(){for(var ad=0;ad<256;ad++){H[ad]=19595*ad;H[(ad+256)>>0]=38470*ad;H[(ad+512)>>0]=7471*ad+32768;H[(ad+768)>>0]=-11059*ad;H[(ad+1024)>>0]=-21709*ad;H[(ad+1280)>>0]=32768*ad+8421375;H[(ad+1536)>>0]=-27439*ad;H[(ad+1792)>>0]=-5329*ad}}function ac(ae){var af=ae[0];var ad=ae[1]-1;while(ad>=0){if(af&(1<<ad)){E|=(1<<a)}ad--;a--;if(a<0){if(E==255){u(255);u(0)}else{u(E)}a=7;E=0}}}function u(ad){k.push(f[ad])}function J(ad){u((ad>>8)&255);u((ad)&255)}function P(a1,ay){var aP,aO,aN,aM,aL,aJ,aI,aG;var aS=0;var aU;const ax=8;const aq=64;for(aU=0;aU<ax;++aU){aP=a1[aS];aO=a1[aS+1];aN=a1[aS+2];aM=a1[aS+3];aL=a1[aS+4];aJ=a1[aS+5];aI=a1[aS+6];aG=a1[aS+7];var a2=aP+aG;var aR=aP-aG;var a0=aO+aI;var aT=aO-aI;var aZ=aN+aJ;var aV=aN-aJ;var aY=aM+aL;var aW=aM-aL;var av=a2+aY;var ar=a2-aY;var au=a0+aZ;var at=a0-aZ;a1[aS]=av+au;a1[aS+4]=av-au;var aD=(at+ar)*0.707106781;a1[aS+2]=ar+aD;a1[aS+6]=ar-aD;av=aW+aV;au=aV+aT;at=aT+aR;var az=(av-at)*0.382683433;var aC=0.5411961*av+az;var aA=1.306562965*at+az;var aB=au*0.707106781;var an=aR+aB;var am=aR-aB;a1[aS+5]=am+aC;a1[aS+3]=am-aC;a1[aS+1]=an+aA;a1[aS+7]=an-aA;aS+=8}aS=0;for(aU=0;aU<ax;++aU){aP=a1[aS];aO=a1[aS+8];aN=a1[aS+16];aM=a1[aS+24];aL=a1[aS+32];aJ=a1[aS+40];aI=a1[aS+48];aG=a1[aS+56];var ap=aP+aG;var aw=aP-aG;var ak=aO+aI;var aE=aO-aI;var ah=aN+aJ;var aH=aN-aJ;var ae=aM+aL;var aX=aM-aL;var ao=ap+ae;var ad=ap-ae;var aj=ak+ah;var ag=ak-ah;a1[aS]=ao+aj;a1[aS+32]=ao-aj;var al=(ag+ad)*0.707106781;a1[aS+16]=ad+al;a1[aS+48]=ad-al;ao=aX+aH;aj=aH+aE;ag=aE+aw;var aQ=(ao-ag)*0.382683433;var ai=0.5411961*ao+aQ;var a4=1.306562965*ag+aQ;var af=aj*0.707106781;var a3=aw+af;var aF=aw-af;a1[aS+40]=aF+ai;a1[aS+24]=aF-ai;a1[aS+8]=a3+a4;a1[aS+56]=a3-a4;aS++}var aK;for(aU=0;aU<aq;++aU){aK=a1[aU]*ay[aU];R[aU]=(aK>0)?((aK+0.5)|0):((aK-0.5)|0)}return R}function V(){J(65504);J(16);u(74);u(70);u(73);u(70);u(0);u(1);u(1);u(0);J(1);J(1);u(0);u(0)}function I(ae,ad){J(65472);J(17);u(8);J(ad);J(ae);u(3);u(1);u(17);u(0);u(2);u(17);u(1);u(3);u(17);u(1)}function w(){J(65499);J(132);u(0);for(var ae=0;ae<64;ae++){u(h[ae])}u(1);for(var ad=0;ad<64;ad++){u(M[ad])}}function r(){J(65476);J(418);u(0);for(var ah=0;ah<16;ah++){u(g[ah+1])}for(var ag=0;ag<=11;ag++){u(b[ag])}u(16);for(var af=0;af<16;af++){u(B[af+1])}for(var ae=0;ae<=161;ae++){u(v[ae])}u(1);for(var ad=0;ad<16;ad++){u(A[ad+1])}for(var ak=0;ak<=11;ak++){u(ab[ak])}u(17);for(var aj=0;aj<16;aj++){u(p[aj+1])}for(var ai=0;ai<=161;ai++){u(x[ai])}}function q(){J(65498);J(12);u(3);u(1);u(0);u(2);u(17);u(3);u(17);u(0);u(63);u(0)}function l(ah,ad,an,at,ar){var aj=ar[0];var af=ar[240];var ag;const au=16;const ak=63;const ai=64;var av=P(ah,ad);for(var ao=0;ao<ai;++ao){U[Q[ao]]=av[ao]}var aq=U[0]-an;an=U[0];if(aq==0){ac(at[0])}else{ag=32767+aq;ac(at[n[ag]]);ac(L[ag])}var ae=63;for(;(ae>0)&&(U[ae]==0);ae--){}if(ae==0){ac(aj);return an}var ap=1;var ax;while(ap<=ae){var am=ap;for(;(U[ap]==0)&&(ap<=ae);++ap){}var al=ap-am;if(al>=au){ax=al>>4;for(var aw=1;aw<=ax;++aw){ac(af)}al=al&15}ag=32767+U[ap];ac(ar[(al<<4)+n[ag]]);ac(L[ag]);ap++}if(ae!=ak){ac(aj)}return an}function z(){var ae=String.fromCharCode;for(var ad=0;ad<256;ad++){f[ad]=ae(ad)}}this.encode=function(ar,am){var ae=new Date().getTime();if(am){d(am)}k=new Array();E=0;a=7;J(65496);V();w();I(ar.width,ar.height);r();q();var an=0;var au=0;var aq=0;E=0;a=7;this.encode.displayName="_encode_";var az=ar.data;var aw=ar.width;var ap=ar.height;var av=aw*4;var ad=aw*3;var al,ak=0;var ao,ay,aA;var af,at,ah,aj,ai;while(ak<ap){al=0;while(al<av){af=av*ak+al;at=af;ah=-1;aj=0;for(ai=0;ai<64;ai++){aj=ai>>3;ah=(ai&7)*4;at=af+(aj*av)+ah;if(ak+aj>=ap){at-=(av*(ak+1+aj-ap))}if(al+ah>=av){at-=((al+ah)-av+4)}ao=az[at++];ay=az[at++];aA=az[at++];G[ai]=((H[ao]+H[(ay+256)>>0]+H[(aA+512)>>0])>>16)-128;e[ai]=((H[(ao+768)>>0]+H[(ay+1024)>>0]+H[(aA+1280)>>0])>>16)-128;X[ai]=((H[(ao+1280)>>0]+H[(ay+1536)>>0]+H[(aA+1792)>>0])>>16)-128}an=l(G,T,an,D,s);au=l(e,aa,au,j,W);aq=l(X,aa,aq,j,W);al+=32}ak+=8}if(a>=0){var ax=[];ax[1]=a+1;ax[0]=(1<<(a+1))-1;ac(ax)}J(65497);var ag="data:image/jpeg;base64,"+btoa(k.join(""));k=[];return ag};function d(ae){if(ae<=0){ae=1}if(ae>100){ae=100}if(C==ae){return}var ad=0;if(ae<50){ad=Math.floor(5000/ae)}else{ad=Math.floor(200-ae*2)}O(ad);C=ae}function S(){var ae=new Date().getTime();if(!m){m=50}z();Z();y();Y();d(m);var ad=new Date().getTime()-ae}S()},initialize:function(){this.callParent();this.width=this.getSigWidth();this.height=this.getSigHeight();Ext.define("ux.signature.Canvas",{extend:Ext.Component,xtype:"signaturefieldcanvas",template:[{reference:"canvas",tag:"canvas",classList:[Ext.baseCSSPrefix+"canvas"]}]});this.on("painted",this.initCanvas,this);this.element.on("tap",this.openCanvasSheet,this);this.actionOverlayCanvas=Ext.create("ux.signature.Canvas",{});this.resetButton=Ext.create("Ext.Button",{text:"清除",ui:"normal"});this.saveButton=Ext.create("Ext.Button",{text:"關閉",ui:"confirm"});this.actionOverlay=Ext.create("Ext.Panel",{modal:true,hidden:true,hideOnMaskTap:true,showAnimation:{type:"popIn",duration:300,easing:"ease-out"},hideAnimation:{type:"popOut",duration:300,easing:"ease-out"},centered:true,items:[this.actionOverlayCanvas,{xtype:"toolbar",docked:"bottom",items:[{xtype:"spacer"},this.resetButton,this.saveButton,{xtype:"spacer"}]}]});Ext.Viewport.add(this.actionOverlay);this.actionOverlayCanvas.element.on("touchstart",this.canvasTouchStart,this);this.actionOverlayCanvas.element.on("touchend",this.canvasTouchEnd,this);this.actionOverlayCanvas.element.on("touchmove",this.canvasTouchMove,this);this.resetButton.element.on("tap",this.resetCanvas,this);this.saveButton.element.on("tap",this.saveCanvas,this);this.actionOverlayCanvas.setStyle("border:1px solid #000;height:"+this.height+"px;width:"+this.width+"px;margin-right:auto;margin-left:auto;margin-top:auto;margin-bottom:auto;");var a=HTMLCanvasElement.prototype.toDataURL;var b=new this.JPEGEncoder();HTMLCanvasElement.prototype.toDataURL=function(f){var e=a.apply(this,arguments);if(e.substr(0,6)=="data:,"){var d=b.encode(this.getContext("2d").getImageData(0,0,this.width,this.height),90);return d}else{return e}}}});Ext.define("NisTRApp.view.WorkList.CMS",{extend:Ext.Container,alias:"widget.WL_CMS",config:{initialFlag:true,html:'<div style="text-align:center;background-color:black;width:100%;height:1024px;"> 　<p style="color:white; font-size:36px;" ></p> </div>',layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}],items:[{xtype:"tabpanel",itemId:"WL_CMS_TabPanel",layout:{animation:false,type:"card"}}]},onContainerDestroy:function(a){this.removeGrobleStore();console.log("On Destroy :","WorkList.CMS");this.removeAll(true,true)},onContainerPainted:function(b,a){if(!Ext.getStore("sSysCaTypes").isLoading()&&Ext.getStore("sSysCaTypes").getCount()<=0){Ext.getStore("sSysCaTypes").load()}if(!Ext.getStore("sSysCaClassification").isLoading()&&Ext.getStore("sSysCaClassification").getCount()<=0){Ext.getStore("sSysCaClassification").load()}if(!Ext.getStore("sCmsCloseReason").isLoading()&&Ext.getStore("sCmsCloseReason").getCount()<=0){Ext.getStore("sCmsCloseReason").load()}if(!Ext.getStore("sCmsNurses").isLoading()&&Ext.getStore("sCmsNurses").getCount()<=0){Ext.getStore("sCmsNurses").load()}if(!Ext.getStore("sTreatmentCoses").isLoading()&&Ext.getStore("sTreatmentCoses").getCount()<=0){Ext.getStore("sTreatmentCoses").load()}if(!Ext.getStore("sSysTPItem").isLoading()&&Ext.getStore("sSysTPItem").getCount()<=0){Ext.getStore("sSysTPItem").load()}},initialize:function(){this.callParent();this.initialGrobleStore();var d=Ext.create("NisTRApp.view.WorkList.CMS.DiscoverPatients",{id:"_cmsDiscoverPatients",itemId:"_cmsDiscoverPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"疑似病人"});this.down("#WL_CMS_TabPanel").add(d);d=null;delete d;var j=Ext.create("NisTRApp.view.WorkList.CMS.InPatients",{id:"_cmsInPatients",itemId:"_cmsInPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"收案病人"});this.down("#WL_CMS_TabPanel").add(j);j=null;delete j;var g=Ext.create("NisTRApp.view.WorkList.CMS.RegPatients",{id:"_cmsRegPatients",itemId:"_cmsRegPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"我的門診病人"});this.down("#WL_CMS_TabPanel").add(g);g=null;delete g;var h=Ext.create("NisTRApp.view.WorkList.CMS.IpbPatients",{id:"_cmsIpbMyPatients",itemId:"_cmsIpbMyPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"我的住院病人"});this.down("#WL_CMS_TabPanel").add(h);h=null;delete h;var b=Ext.create("NisTRApp.view.WorkList.CMS.SearchPatients",{id:"_cmsSearchPatients",itemId:"_cmsSearchPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"病人查詢"});this.down("#WL_CMS_TabPanel").add(b);b=null;delete b;var f=Ext.create("NisTRApp.view.WorkList.CMS.MyInPatients",{id:"_cmsMInPatients",itemId:"_cmsMInPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"綜合查詢"});this.down("#WL_CMS_TabPanel").add(f);f=null;delete f;var a=Ext.create("NisTRApp.view.WorkList.CMS.Report",{id:"_cmsRepports",itemId:"_cmsRepports",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"報表"});this.down("#WL_CMS_TabPanel").add(a);var e=Ext.create("Ext.Button",{id:"_cmsLeadingBtn",itemId:"_cmsLeadingBtn",title:"領航申報清單",text:"點我啟動領航申報清單"});e.addListener("tap",function(l,m,k){NisTRApp.view.GridUtility.OpenCM("CMLIST",NisTRApp.view.SysUtility.GetUserID())},this);this.down("#WL_CMS_TabPanel").add(e)},initialGrobleStore:function(){if(Ext.data.ModelManager.getModel("mCmsFrmBaseData")==null){Ext.define("mCmsFrmBaseData",{extend:Ext.data.Model,config:{fields:[{name:"FrmCode",type:"string"},{name:"FrmKey",type:"string"},{name:"ExamType",type:"string"}]}})}if(Ext.data.ModelManager.getModel("mTreatmentCose")==null){Ext.define("mTreatmentCose",{extend:Ext.data.Model,config:{fields:[{name:"Code",type:"string"},{name:"Desc1",type:"string"},{name:"Item",type:"string"},{name:"SortSeq",type:"int"}]}})}if(Ext.getStore("sSysCaTypes")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.Sys.SyscatypeEntity",storeId:"sSysCaTypes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QuerySysCaType.ashx",reader:{type:"json"}}})}if(Ext.getStore("sSysCaTypes").getCount()<=0){Ext.getStore("sSysCaTypes").load()}if(Ext.getStore("sSysCaClassification")==null){Ext.create("Ext.data.Store",{fields:[{name:"TypeID",type:"string"},{name:"TypeName",type:"string"}],storeId:"sSysCaClassification",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QuerySysCaClassification.ashx",reader:{type:"json"}}})}if(Ext.getStore("sSysCaClassification").getCount()<=0){Ext.getStore("sSysCaClassification").load()}if(Ext.getStore("sCmsCloseReason")==null){Ext.create("Ext.data.Store",{fields:[{name:"CloseReason",type:"string"},{name:"CloseRemark",type:"string"}],storeId:"sCmsCloseReason",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryCmsCloseReasons.ashx",reader:{type:"json"}}})}if(Ext.getStore("sCmsCloseReason").getCount()<=0){Ext.getStore("sCmsCloseReason").load()}if(Ext.getStore("sSysClinc")==null){Ext.create("Ext.data.Store",{fields:[{name:"ClinCode",type:"string"},{name:"ClinName",type:"string"},{name:"Rang",type:"int"}],storeId:"sSysClinc",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QuerySysClinc.ashx",reader:{type:"json"}}})}if(Ext.getStore("sSysClinc").getCount()<=0){}if(Ext.getStore("sCmsNurses")==null){Ext.create("Ext.data.JsonStore",{fields:[{name:"EmpNO",type:"string"},{name:"NameCH",type:"string"}],storeId:"sCmsNurses",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryCMSNurse.ashx",reader:{type:"json"}}})}if(Ext.getStore("sCmsNurses").getCount()<=0){Ext.getStore("sCmsNurses").load()}if(Ext.getStore("sTreatmentCoses")==null){Ext.create("Ext.data.JsonStore",{model:"mTreatmentCose",storeId:"sTreatmentCoses",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryTreatmentCode.ashx",reader:{type:"json"}}})}if(Ext.getStore("sTreatmentCoses").getCount()<=0){Ext.getStore("sTreatmentCoses").load()}if(Ext.getStore("sSysTPItem")==null){Ext.create("Ext.data.Store",{fields:[{name:"ParID",type:"string"},{name:"ParValue",type:"string"},{name:"ParDesc",type:"string"}],storeId:"sSysTPItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QuerySysTPItem.ashx",reader:{type:"json"}}})}if(Ext.getStore("sSysTPItem").getCount()<=0){Ext.getStore("sSysTPItem").load()}if(Ext.isEmpty(Ext.data.ModelManager.getModel("mUrl"))){Ext.define("mUrl",{extend:Ext.data.Model,config:{fields:[{name:"UserID",type:"string"},{name:"ChartNO",type:"string"},{name:"URL",type:"string"}]},Get:function(a){Ext.callback(a.callback,a.scope,[a.scope,this,true,"success"])}})}},removeGrobleStore:function(){if(Ext.getStore("sSysClinc")!=null){Ext.getStore("sSysClinc").removeAll();Ext.getStore("sSysClinc").destroy()}if(Ext.getStore("sSysCaTypes")!=null){Ext.getStore("sSysCaTypes").removeAll();Ext.getStore("sSysCaTypes").destroy()}if(Ext.getStore("sCmsNurses")!=null){Ext.getStore("sCmsNurses").removeAll();Ext.getStore("sCmsNurses").destroy()}if(Ext.getStore("sTreatmentCoses")!=null){Ext.getStore("sTreatmentCoses").removeAll();Ext.getStore("sTreatmentCoses").destroy()}if(Ext.getStore("sSysCaClassification")!=null){Ext.getStore("sSysCaClassification").removeAll();Ext.getStore("sSysCaClassification").destroy()}if(Ext.getStore("sCmsCloseReason")!=null){Ext.getStore("sCmsCloseReason").removeAll();Ext.getStore("sCmsCloseReason").destroy()}}});Ext.define("NisTRApp.view.WorkList.CMS.DiscoverPatients",{extend:Ext.Container,alias:"widget.CMS_DiscoverPatients",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onCMS_DISP_DiscoverDatePickerChange",event:"change",delegate:"#CMS_DISP_DiscoverDatePicker"},{fn:"onCMS_DISP_CATypeFieldChange",event:"change",delegate:"#CMS_DISP_CATypeField"},{fn:"onCMS_DISP_PreBtnTap",event:"tap",delegate:"#CMS_DISP_PreBtn"},{fn:"onCMS_DISP_NextBtnTap",event:"tap",delegate:"#CMS_DISP_NextBtn"},{fn:"onCMS_DISP_AllBtnTap",event:"tap",delegate:"#CMS_DISP_AllBtn"},{fn:"onCMS_DISP_18BtnTap",event:"tap",delegate:"#CMS_DISP_18Btn"},{fn:"onCMS_DISP_RefreshBtnTap",event:"tap",delegate:"#CMS_DISP_RefreshBtn"},{fn:"onContainerPainted",event:"painted"}],items:[{xtype:"panel",itemId:"CMS_DISP_MainPanel",layout:{type:"fit"}},{xtype:"toolbar",docked:"bottom",itemId:"WL_CMS_DISP_Foot_ToolBar",items:[{xtype:"datepickerfield",itemId:"CMS_DISP_DiscoverDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"selectfield",itemId:"CMS_DISP_CATypeField",width:"25%",label:"癌別",labelWidth:"25%",displayField:"CaName",valueField:"CaID"},{xtype:"button",hidden:false,itemId:"CMS_DISP_PreBtn",ui:"confirm-back",width:"10%",text:"前一日"},{xtype:"button",hidden:false,itemId:"CMS_DISP_NextBtn",ui:"confirm-forward",width:"10%",text:"後一日"},{xtype:"segmentedbutton",hidden:false,itemId:"CMS_DISP_FnBtn",width:"20%",items:[{xtype:"button",flex:1,itemId:"CMS_DISP_AllBtn",text:"全部"},{xtype:"button",flex:1,itemId:"CMS_DISP_18Btn",text:"18以下"}]},{xtype:"button",itemId:"CMS_DISP_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"}]}]},onContainerDestroy:function(a){this.setInitialFlag(true);if(Ext.getStore("sCmsDiscoverPatients")!=null){Ext.getStore("sCmsDiscoverPatients").removeAll();Ext.getStore("sCmsDiscoverPatients").destroy()}console.log("On Destroy :","CMS_DiscoverPatients");this.removeAll(true,true)},onCMS_DISP_DiscoverDatePickerChange:function(d,a,e,b){Ext.getStore("sDISPCaTypes").removeAll();Ext.getStore("sDISPCaTypes").getProxy().setExtraParams({DiscoverDate:a});this.setMasked({xtype:"loadmask",message:"拼命載入中，請稍候..."});Ext.getStore("sDISPCaTypes").load({callback:function(g,f,h){this.setMasked(false)},scope:this})},onCMS_DISP_CATypeFieldChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#CMS_DISP_DiscoverDatePicker").getValue(),e)}},onCMS_DISP_PreBtnTap:function(b,d,a){this.down("#CMS_DISP_DiscoverDatePicker").setValue(Ext.Date.add(this.down("#CMS_DISP_DiscoverDatePicker").getValue(),Ext.Date.DAY,-1))},onCMS_DISP_NextBtnTap:function(b,d,a){this.down("#CMS_DISP_DiscoverDatePicker").setValue(Ext.Date.add(this.down("#CMS_DISP_DiscoverDatePicker").getValue(),Ext.Date.DAY,1))},onCMS_DISP_AllBtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMS_DISP_FnBtn"),b,"confirm-round","normal","","");var f=Ext.getStore("sCmsDiscoverPatients");if(!Ext.isEmpty(f)){f.clearFilter()}f=null;delete f},onCMS_DISP_18BtnTap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMS_DISP_FnBtn"),b,"confirm-round","normal","","");var f=Ext.getStore("sCmsDiscoverPatients");if(!Ext.isEmpty(f)){f.clearFilter();f.filterBy(function(e,g){return(e.data.Age<=18)},this)}f=null;delete f},onCMS_DISP_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#CMS_DISP_DiscoverDatePicker").getValue(),this.down("#CMS_DISP_CATypeField").getValue())},onContainerPainted:function(b,a){},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.getStore("sDISPCaTypes")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.Sys.SyscatypeEntity",storeId:"sDISPCaTypes",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QuerySysCaType.ashx",reader:{type:"json"}}})}this.down("#CMS_DISP_CATypeField").setStore(Ext.getStore("sDISPCaTypes"));if(Ext.data.ModelManager.getModel("mCancerDiscoverData")==null){Ext.define("mCancerDiscoverData",{extend:NisTRApp.model.CMS.CmsdatmData,config:{fields:[{name:"Rid",type:"string"},{name:"IcdhCode",type:"string"},{name:"DiagnosisDate",type:"string"},{name:"Suspect",type:"string"}]}})}if(Ext.getStore("sCmsDiscoverPatients")==null){Ext.create("Ext.data.Store",{model:"mCancerDiscoverData",storeId:"sCmsDiscoverPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryDiscoverPatients.ashx",reader:{type:"jsonHtmlDecode"}}})}this.down("#CMS_DISP_DiscoverDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.DAY,-1));var a=this;var d=Ext.getCmp("CMS_DiscoverPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenCMSDiscroverPatientGrid("CMS_DiscoverPatGrid","疑似病人",null,false);d.initialFlag=true;d.getTitleBar().hide();var e=Ext.getStore("sCmsDiscoverPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,d);this.down("#CMS_DISP_MainPanel").add(d);d.addListener("painted",NisTRApp.view.UserConfig.onPainted_DiscoverPatGrid,d);var b=d.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_DiscoverPatGrid,d);d=null;delete d;e=null;delete e}a=null;delete a;this.down("#CMS_DISP_AllBtn").fireEvent("tap",this.down("#CMS_DISP_AllBtn"),null,null);this.setInitialFlag(false)},LoadPatientList:function(b,a){if(Ext.getStore("sCmsDiscoverPatients").isLoading()){return}var d=Ext.getStore("sCmsDiscoverPatients");d.getProxy().setExtraParams({DiscoverDate:b,CAType:a});d.load();d=null;delete d}});Ext.define("NisTRApp.view.CMS.CmsdatmPanel",{extend:Ext.Panel,config:{initialFlag:true,stopDistroyEvent:false,centered:false,height:"100%",width:"100%",layout:{type:"fit"},modal:false,caller:{},successFn:{},items:[{xtype:"formpanel",height:"100%",itemId:"CMS_DATM_Main",layout:{type:"vbox"}},{xtype:"toolbar",docked:"bottom",itemId:"CMS_DATM_FootBar",items:[{xtype:"button",itemId:"CMS_DATM_CloseBtn",right:"10px",ui:"confirm",width:"90px",text:"關 閉"},{xtype:"button",itemId:"CMS_DATM_SaveBtn",left:"10px",right:"10px",ui:"decline",width:"90px",text:"存 檔"}]}],listeners:[{fn:"onCMS_DATM_CloseBtnTap",event:"tap",delegate:"#CMS_DATM_CloseBtn"},{fn:"onCMS_DATM_SaveBtnTap",event:"tap",delegate:"#CMS_DATM_SaveBtn"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelPainted",event:"painted"}]},onCMS_DATM_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onCMS_DATM_SaveBtnTap:function(b,f,a){var d=this.getRecord();if(!Ext.isEmpty(this.down("#CancerType").getValue())&&!Ext.isEmpty(d)&&!Ext.isEmpty(d.data.CmsID)&&(this.down("#CancerType").getValue()!=d.data.Cancer)){Ext.Msg.confirm("Confirm","是否修改癌別?",function(g,h,e){if(g=="no"){return}else{if(g=="yes"){this.SaveData()}}},this)}else{this.SaveData()}d=null;delete d},onPanelDestroy:function(a){Ext.getStore("sSysCaTypes").clearFilter();this.removeAll(true,true)},onPanelPainted:function(d,b){if(Ext.isEmpty($("#_GetConfirmHCodeBtn")[0])){var a=NisTRApp.view.SysUtility.tapEventName();var e=$('<img src="../_/img/Search2.png" id="_GetConfirmHCodeBtn" style="width:28px;height:28px;">');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.CreateClincPanel(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#GetConfirmHCodeDiv"));e=null;delete e;a=null;delete a}if(this.getInitialFlag()){this.setInitialFlag(false)}},initialize:function(){this.callParent();var a=this.getRecord();this.down("#CMS_DATM_Main").add(this.CreateCancerInfoField());this.down("#CMS_DATM_Main").add(this.CreateTraceField());this.down("#CMS_DATM_Main").add(this.CreateCmsInfoField());this.CreateStageField();this.down("#CMS_DATM_Main").add(this.CreateCloseField());if(Ext.getStore("sCmsDatmData")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.CmsdatmData",storeId:"sCmsDatmData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryCMSDatm.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.getStore("sSysTPItem").getCount()<=0){Ext.getStore("sSysTPItem").load()}if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)){this.applyData(a)}a=null;delete a},CreateConfirmField:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:"確診",layout:"fit",centered:false});var a=Ext.create("Ext.field.Select",{id:"ConfirmH",itemId:"ConfirmH",label:"院別",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"本院",value:"1"},{text:"它院",value:"2"}],style:"float:left;font-size:16px;",listeners:{change:function(j,h,g){}}});b.add(a);var e=function e(h,j,g){this.timeField.setValue(new Date())};var d=function d(h,j,g){this.timeField.setValue(null)};a=NisTRApp.view.DateUtil.CreatDateField("FirstContactDate","FirstContactDate","本院初診日","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("FirstContactDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("FirstContactDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=NisTRApp.view.DateUtil.CreatDateField("FirstDiagDateK","FirstDiagDateK","最初診斷日","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("FirstDiagDateKSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("FirstDiagDateKCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=NisTRApp.view.DateUtil.CreatDateField("FirstDiagDate","FirstDiagDate","它院最初診斷日","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("FirstDiagDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("FirstDiagDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=Ext.create("Ext.field.Text",{id:"ConfirmHCode",itemId:"ConfirmHCode",label:'<div id="GetConfirmHCodeDiv">單位醫事機構代碼</div>',labelWidth:"28%",width:"91%",style:"float:left;font-size:16px;",placeHolder:"點選放大鏡查詢",readOnly:true});b.add(a);b.add(this.CreateCloseBtn("ConfirmHCodeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));var f=Ext.create("Ext.field.Text",{id:"ConfirmHName",itemId:"ConfirmHName",label:"單位醫事機構名稱",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",placeHolder:"點選放大鏡查詢",readOnly:true});b.add(f);a.addListener("change",function(j,h,g){if(Ext.isEmpty(h)){this.setValue("")}},f);e=null;delete e;d=null;delete d;a=null;delete a;f=null;delete f;return b},CreateCloseBtn:function(f,b,e,a){var d=Ext.create("Ext.Button",{html:b,itemId:f,margin:"5 5 5 5",ui:"plain",style:"float:left;font-size:16px;",timeField:e}).addListener("tap",a);d.timeField=e;return d},CreateCancerInfoField:function(){var d=(!Ext.isEmpty(this.getRecord())&&!Ext.isEmpty(this.getRecord().data.CmsID));var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:"基本資料",layout:"fit",centered:false});var g=function g(j,k,h){this.timeField.setValue(new Date())};var f=function g(j,k,h){this.timeField.setValue(null)};var a=NisTRApp.view.DateUtil.CreatDateField("CmsInDate","CmsInDate","收案日期","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("CmsInDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,g));b.add(this.CreateCloseBtn("CmsInDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,f));a=Ext.create("Ext.field.Select",{id:"CmsFlag",itemId:"CmsFlag",label:"收案類別",labelWidth:"26%",width:"99%",options:[{text:"首發",value:"1"},{text:"復發",value:"2"}],style:"float:left;font-size:16px;"});b.add(a);var e=Ext.create("Ext.field.Select",{id:"CaClassification",itemId:"CaClassification",label:"癌分",labelWidth:"26%",width:"99%",displayField:"TypeName",valueField:"TypeID",style:"float:left;font-size:16px;",caTypeField:null,listeners:{change:function(k,j,h){if(!Ext.isEmpty(this.caTypeField)&&!Ext.isEmpty(j)){Ext.getStore("sSysCaTypes").filter("DefaultClassification",j)}else{Ext.getStore("sSysCaTypes").clearFilter()}}}});e.setStore(Ext.getStore("sSysCaClassification"));b.add(e);a=Ext.create("Ext.field.Select",{id:"CancerType",itemId:"CancerType",label:"癌別",labelWidth:"26%",width:"99%",displayField:"CaName",valueField:"CaID",style:"float:left;font-size:16px;",caClassificationField:null,listeners:{change:function(k,j,h){}}});a.setStore(Ext.getStore("sSysCaTypes"));b.add(a);a.setValue(this.getRecord().data.Cancer);e.caTypeField=a;e.setValue(this.getRecord().data.CaClassification);a=NisTRApp.view.DateUtil.CreatDateField("RecoverDate","RecoverDate","治療中復發(日期)","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("RecoverDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,g));b.add(this.CreateCloseBtn("RecoverDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,f));a=Ext.create("Ext.field.Select",{id:"PatKind",itemId:"PatKind",label:"病人分類",labelWidth:"26%",width:"99%",options:[{text:"",value:"0"},{text:"本院診斷,於外院接受首治療或是決定不治療",value:"1"},{text:"本院診斷,於本院接受全部或是部份首次療程",value:"2"},{text:"外院診斷,於本院接受全部或是部份療程",value:"3"},{text:"外院診斷並接受前首次療程,因癌症復發或是持續癌症問題於本院就診",value:"4"},{text:"外院診斷癌症並完成治療,僅至本院檢查.f/u及諮訽",value:"5"}],style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Select",{id:"InTreat",itemId:"InTreat",label:"是否留院治療",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"是",value:"Y"},{text:"否",value:"N"}],style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Select",{id:"NotInTreatReason",itemId:"NotInTreatReason",label:"沒有留院治療原因",labelWidth:"26%",width:"99%",scope:this,options:[{text:"",value:""},{text:"他院治療 (此選項已作廢，勿再選)",value:"1"},{text:"另類療法",value:"2"},{text:"拒絕治療",value:"3"},{text:"連絡不上",value:"4"},{text:"第二諮詢",value:"6"},{text:"醫師建議不留院治療",value:"7"},{text:"其他(請在備註說明)",value:"5"}],style:"float:left;font-size:16px;"});b.add(a);a.addListener("change",function(k,j,h){if(!this.getInitialFlag()&&j==="1"){Ext.Msg.alert("Confirm","此選項已作廢，請勿再選",null,this)}},this);a=Ext.create("Ext.field.Text",{id:"NotInTreatReasonTxt",itemId:"NotInTreatReasonTxt",label:"沒有留院治療原因其他說明",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",listeners:{keyup:function(j,k,h){}}});b.add(a);a=null;delete a;g=null;delete g;f=null;delete f;return b},CreateTraceField:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:"治療",layout:"fit",centered:false});var a=Ext.create("Ext.field.Select",{id:"ProcessWay",itemId:"ProcessWay",label:"處理方式",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"治療中",value:"1"},{text:"追蹤中",value:"6"},{text:"未治療",value:"0"}],style:"float:left;font-size:16px;"});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("TeamConsultDate","TeamConsultDate","團隊會診日期","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("TeamConsultDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("TeamConsultDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=Ext.create("Ext.field.Select",{id:"FTPItem",itemId:"FTPItem",label:"首治項目",labelWidth:"26%",width:"99%",displayField:"ParValue",valueField:"ParID",style:"float:left;font-size:16px;"});a.setStore(Ext.getStore("sSysTPItem"));b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("FTPEndDate","FTPEndDate","首治完成日期","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("FTPEndSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("FTPEndCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=NisTRApp.view.DateUtil.CreatDateField("ALLTPEndDate","ALLTPEndDate","所有治療完成日期","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("ALLTPEndSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(this.CreateCloseBtn("ALLTPEndCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));e=null;delete e;d=null;delete d;a=null;delete a;return b},CreateCmsInfoField:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:"個管",layout:"fit",centered:false});var a=Ext.create("Ext.field.Select",{id:"CmsSystem",itemId:"CmsSystem",label:"個管系統收案",labelWidth:"26%",hidden:true,width:"99%",options:[{text:"無",value:""},{text:"攝護腺癌個管",value:"PROSTATE"},{text:"腸癌個管",value:"CCM"},{text:"肝癌",value:"HCC"},{text:"臨床研究室填寫(除個管的癌症,但目前攝護腺癌&甲狀腺癌改由臨床研究室申報)",value:"CR"},{text:"乳癌",value:"BCC"},{text:"肺癌",value:"LUNG"},{text:"頭頸癌",value:"HN"},{text:"甲狀腺癌",value:"THYROID"}],style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Select",{id:"CmsUserID",itemId:"CmsUserID",label:"個管師",labelWidth:"26%",width:"99%",valueField:"EmpNO",displayField:"NameCH",style:"float:left;font-size:16px;"});a.setStore(Ext.getStore("sCmsNurses"));a.setValue(NisTRApp.view.SysUtility.GetUserID());b.add(a);a=null;delete a;return b},SaveData:function(){if(Ext.getStore("sCmsDatmData").isLoading()){return}if(Ext.isEmpty(this.down("#CancerType").getValue())){NisTRApp.view.Misc.Alert("癌別不可為空值",0);return false}if(Ext.isEmpty(this.down("#CmsInDate").getValue())){NisTRApp.view.Misc.Alert("收日不可為空",0);return false}var d=this.getRecord();var a={CmsID:d.data.CmsID,ChartNO:d.data.ChartNO,InDate:this.down("#CmsInDate").getFormattedValue("Ymd"),CmsFlag:this.down("#CmsFlag").getValue(),Cancer:this.down("#CancerType").getValue(),RecoverDate:this.down("#RecoverDate").getFormattedValue("Ymd"),PatKind:this.down("#PatKind").getValue(),InTreat:this.down("#InTreat").getValue(),NotInTreatReason:this.down("#NotInTreatReason").getValue(),NotInTreatReasonTxt:this.down("#NotInTreatReasonTxt").getValue(),TeamConsultDate:this.down("#TeamConsultDate").getFormattedValue("Ymd"),ProcessWay:this.down("#ProcessWay").getValue(),FTPItem:this.down("#FTPItem").getValue(),FTPEndDate:this.down("#FTPEndDate").getFormattedValue("Ymd"),ALLTPEndDate:this.down("#ALLTPEndDate").getFormattedValue("Ymd"),CmsSystem:this.down("#CmsSystem").getValue(),CmsUserID:this.down("#CmsUserID").getValue(),CaClassification:this.down("#CaClassification").getValue()};var b=this;b.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/action/CmsdatmUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),CmsID:d.data.CmsID,Json:btoa(encodeURIComponent(JSON.stringify(a)))},success:function(e){b.setMasked(false);var g=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){b.LoadData(g.CmsID);var f=b.getSuccessFn();if(!Ext.isEmpty(f)&&Ext.isFunction(f)){f(true,b.getCaller())}}g=null;delete g;b=null;delete b;f=null;delete f},failure:function(){b.setMasked(false);b=null;delete b}});a=null;delete a;d=null;delete d},LoadData:function(b){if(Ext.isEmpty(b)){return}if(Ext.getStore("sCmsDatmData").isLoading()){return}var a=Ext.getStore("sCmsDatmData");a.getProxy().setExtraParams({CmsID:b});a.load({callback:function(e,d,f){this.setRecord(e[0]);this.applyData(e[0])},scope:this});b=null;delete b;a=null;delete a},applyData:function(d){var b=null;var a=null;a=d.data.InDate;this.down("#CmsInDate").setValue(Ext.isEmpty(a)?null:NisTRApp.view.DateUtil.StrToDateTime(a));b=d.data.CaClassification;this.down("#CaClassification").setValue(Ext.isEmpty(b)?null:b);b=d.data.Cancer;this.down("#CancerType").setValue(Ext.isEmpty(b)?null:b);if(Ext.isEmpty(b)){this.down("#CancerType").setValue(null);b=d.data.Cancer;this.down("#CancerType").setValue(Ext.isEmpty(b)?null:b)}b=d.data.CmsFlag;this.down("#CmsFlag").setValue(Ext.isEmpty(b)?null:b);a=d.data.RecoverDate;this.down("#RecoverDate").setValue(Ext.isEmpty(a)?null:NisTRApp.view.DateUtil.StrToDateTime(a));b=d.data.PatKind;this.down("#PatKind").setValue(Ext.isEmpty(b)?null:b);b=d.data.InTreat;this.down("#InTreat").setValue(Ext.isEmpty(b)?null:b);b=d.data.NotTxReason;this.down("#NotInTreatReason").setValue(Ext.isEmpty(b)?null:b);b=d.data.NotTxReasonTxt;this.down("#NotInTreatReasonTxt").setValue(Ext.isEmpty(b)?null:b);a=d.data.TeamConsultDate;this.down("#TeamConsultDate").setValue(Ext.isEmpty(a)?null:NisTRApp.view.DateUtil.StrToDateTime(a));b=d.data.FTPItem;this.down("#FTPItem").setValue(Ext.isEmpty(b)?"":b);a=d.data.FTPEndDate;this.down("#FTPEndDate").setValue(Ext.isEmpty(a)?null:NisTRApp.view.DateUtil.StrToDateTime(a));a=d.data.ALLTPEndDate;this.down("#ALLTPEndDate").setValue(Ext.isEmpty(a)?null:NisTRApp.view.DateUtil.StrToDateTime(a));b=d.data.ProcessWay;this.down("#ProcessWay").setValue(Ext.isEmpty(b)?null:b);b=d.data.CmsSystem;this.down("#CmsSystem").setValue(Ext.isEmpty(b)?null:b);b=d.data.CmsUserID;b=Ext.isEmpty(b)?NisTRApp.view.SysUtility.GetUserID():b;this.down("#CmsUserID").setValue(Ext.isEmpty(b)?null:b);b=d.data.CmsID;this.down("#CmsCloseFieidSet").setHidden(Ext.isEmpty(b));b=d.data.CloseDate;this.down("#CmsUnClosedBtn").setHidden(Ext.isEmpty(b));this.down("#CmsCloseDate").setValue(Ext.isEmpty(b)?null:NisTRApp.view.DateUtil.StrToDateTime(b));b=d.data.CloseReason;this.down("#CmsCloseReason").setValue(b);this.down("#CmsCloseRemark").setHidden(!(!Ext.isEmpty(b)&&b=="99"));b=d.data.CloseRemark;this.down("#CmsCloseRemark").setValue(b);b=d.data.CStage;this.down("#CStage").setValue(Ext.isEmpty(b)?null:b);b=d.data.PStage;this.down("#PStage").setValue(Ext.isEmpty(b)?null:b);b=d.data.RStage;this.down("#RStage").setValue(Ext.isEmpty(b)?null:b);a=null;delete a;b=null;delete b},CreateCloseField:function(){var d=Ext.create("Ext.form.FieldSet",{itemId:"CmsCloseFieidSet",width:"95%",title:"結案",layout:"fit",hidden:true,centered:false});var g=function g(j,k,h){this.timeField.setValue(new Date())};var f=function f(j,k,h){this.timeField.setValue(null)};var a=NisTRApp.view.DateUtil.CreatDateField("CmsCloseDate","CmsCloseDate","結案日期","30%","85%",null);d.add(a);d.add(this.CreateCloseBtn("CmsCloseDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,g));d.add(this.CreateCloseBtn("CmsCloseCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,f));a.setValue(Ext.isEmpty(this.getRecord().data.CloseDate)?null:NisTRApp.view.DateUtil.StrToDateTime(this.getRecord().data.CloseDate));var e=Ext.create("Ext.field.Select",{id:"CmsCloseReason",itemId:"CmsCloseReason",label:"結案原因",labelWidth:"26%",width:"99%",displayField:"CloseRemark",valueField:"CloseReason",style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(k,j,h){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(j!="99")}}}});e.setStore(Ext.getStore("sCmsCloseReason"));d.add(e);e.setValue(this.getRecord().data.CloseReason);a=Ext.create("Ext.field.Text",{id:"CmsCloseRemark",itemId:"CmsCloseRemark",label:"說明",labelWidth:"26%",width:"99%",maxLength:64,hidden:true,placeHolder:"最多64字",style:"float:left;font-size:16px;"});d.add(a);a.setValue(this.getRecord().data.CloseRemark);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.CloseReason)&&this.getRecord().data.CloseReason=="99"));e.remarkField=a;var b=Ext.create("Ext.Button",{itemId:"CmsClosedBtn",ui:"decline",width:"120px",text:"結案存檔",margin:"5 5 5 5",hidden:false,}).addListener("tap",function(){if(Ext.isEmpty(this.down("#CmsCloseDate").getValue())){NisTRApp.view.Misc.Alert("結案日期不可為空值",0);return false}Ext.Msg.confirm("Confirm","是否結案?",function(j,k,h){if(j=="no"){return}else{if(j=="yes"){this.ClosedFn(2)}}},this)},this);d.add(b);var b=Ext.create("Ext.Button",{itemId:"CmsUnClosedBtn",ui:"decline",width:"120px",text:"取消結案",margin:"5 5 5 5",hidden:true}).addListener("tap",function(){Ext.Msg.confirm("Confirm","是否取消結案?",function(j,k,h){if(j=="no"){return}else{if(j=="yes"){this.ClosedFn(1)}}},this)},this);d.add(b);b.setHidden(Ext.isEmpty(this.getRecord().data.CloseDate));g=null;delete g;f=null;delete f;a=null;delete a;e=null;delete e;b=null;delete b;d.setHidden(Ext.isEmpty(this.getRecord().data.CmsID));return d},ClosedFn:function(a){if(Ext.getStore("sCmsDatmData").isLoading()){return}if(Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();var b={CmsID:e.data.CmsID,ChartNO:e.data.ChartNO,CloseReason:this.down("#CmsCloseReason").getValue(),CloseRemark:this.down("#CmsCloseRemark").getValue(),CloseDate:this.down("#CmsCloseDate").getFormattedValue("Ymd"),CloseUserID:NisTRApp.view.SysUtility.GetUserID()};var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/action/CmsClosed.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),CmsID:e.data.CmsID,CloseFlag:a,Json:btoa(encodeURIComponent(JSON.stringify(b)))},success:function(f){d.setMasked(false);var h=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){d.LoadData(h.CmsID);var g=d.getSuccessFn();if(!Ext.isEmpty(g)&&Ext.isFunction(g)){g(true,d.getCaller())}}h=null;delete h;d=null;delete d;g=null;delete g},failure:function(){d.setMasked(false);d=null;delete d}});b=null;delete b;e=null;delete e},CreateStageField:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:"期別",layout:"fit",centered:false});var a=Ext.create("Ext.field.Text",{id:"CStage",itemId:"CStage",label:"臨床",labelWidth:"25%",width:"85%",readOnly:true,placeHolder:"期別系統帶入",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{id:"PStage",itemId:"PStage",label:"病理",labelWidth:"25%",width:"85%",readOnly:true,placeHolder:"期別系統帶入",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{id:"RStage",itemId:"RStage",label:"復發",labelWidth:"25%",width:"85%",readOnly:true,placeHolder:"期別系統帶入",style:"float:left;font-size:16px;"});b.add(a);this.down("#CMS_DATM_Main").add(b);a=null;delete a},CreateClincPanel:function(a){NisTRApp.view.ClincSearchPanel.Create(a,function(d,b){if(!Ext.isEmpty(b)&&!Ext.isEmpty(d)){b.down("#ConfirmHCode").setValue(d.data.ClinCode);b.down("#ConfirmHName").setValue(d.data.ClinName)}})}});Ext.define("NisTRApp.view.WorkList.CMS.InPatients",{extend:Ext.Container,alias:"widget.CMS_InPatients",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_IPL_MainPanel",layout:{type:"fit"}},{xtype:"toolbar",docked:"bottom",itemId:"WL_CMS_IPL_Foot_ToolBar",items:[{xtype:"datepickerfield",itemId:"CMS_IPL_BegDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"CMS_IPL_EndDatePicker",width:"20%",label:"~",labelWidth:"15%",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",hidden:true,itemId:"CMS_IPL_PreBtn",ui:"confirm-back",width:"15%",text:"前一日"},{xtype:"button",hidden:true,itemId:"CMS_IPL_NextBtn",ui:"confirm-forward",width:"15%",text:"後一日"},{xtype:"segmentedbutton",hidden:false,itemId:"CMS_IPL_FnBtn",width:"30%",items:[{xtype:"button",flex:1,hidden:false,itemId:"CMS_IPL_AllBtn",text:"全部"},{xtype:"button",flex:1,hidden:false,itemId:"CMS_IPL_18UnderBtn",text:"18以下"}]},{xtype:"button",itemId:"CMS_IPL_RefreshBtn",right:"3px",ui:"decline",width:"6%",iconCls:"refresh"}]}],listeners:[{fn:"onCMS_IPL_InDatePickerChange",event:"change",delegate:"#CMS_IPL_BegDatePicker"},{fn:"onCMS_IPL_EndDatePickerChange",event:"change",delegate:"#CMS_IPL_EndDatePicker"},{fn:"onCMS_IPL_PreBtnTap",event:"tap",delegate:"#CMS_IPL_PreBtn"},{fn:"onCMS_IPL_NextBtnTap",event:"tap",delegate:"#CMS_IPL_NextBtn"},{fn:"onCMS_IPL_AllBtnTap",event:"tap",delegate:"#CMS_IPL_AllBtn"},{fn:"onCMS_IPL_18UnderBtnTap",event:"tap",delegate:"#CMS_IPL_18UnderBtn"},{fn:"onCMS_IPL_RefreshBtnTap",event:"tap",delegate:"#CMS_IPL_RefreshBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCMS_IPL_InDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#CMS_IPL_BegDatePicker").getValue(),this.down("#CMS_IPL_EndDatePicker").getValue(),"")}},onCMS_IPL_EndDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList(this.down("#CMS_IPL_BegDatePicker").getValue(),this.down("#CMS_IPL_EndDatePicker").getValue(),"")}},onCMS_IPL_PreBtnTap:function(b,d,a){this.down("#CMS_IPL_BegDatePicker").setValue(Ext.Date.add(this.down("#CMS_IPL_BegDatePicker").getValue(),Ext.Date.DAY,-1));this.down("#CMS_IPL_EndDatePicker").setValue(Ext.Date.add(this.down("#CMS_IPL_EndDatePicker").getValue(),Ext.Date.DAY,-1))},onCMS_IPL_NextBtnTap:function(b,d,a){this.down("#CMS_IPL_BegDatePicker").setValue(Ext.Date.add(this.down("#CMS_IPL_BegDatePicker").getValue(),Ext.Date.DAY,1));this.down("#CMS_IPL_EndDatePicker").setValue(Ext.Date.add(this.down("#CMS_IPL_EndDatePicker").getValue(),Ext.Date.DAY,1))},onCMS_IPL_AllBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#CMS_IPL_FnBtn"),d,"confirm-round","normal","","");var a=Ext.getStore("sCmsInPatients");if(!Ext.isEmpty(a)){a.clearFilter()}a=null;delete a},onCMS_IPL_18UnderBtnTap:function(d,f,b){NisTRApp.view.Misc.ButtonSelect(this.down("#CMS_IPL_FnBtn"),d,"confirm-round","normal","","");var a=Ext.getStore("sCmsInPatients");if(!Ext.isEmpty(a)){a.clearFilter();a.filterBy(function(e,g){return(e.data.Age<=18)},this)}a=null;delete a},onCMS_IPL_RefreshBtnTap:function(b,d,a){this.LoadPatientList(this.down("#CMS_IPL_BegDatePicker").getValue(),this.down("#CMS_IPL_EndDatePicker").getValue(),"")},onContainerDestroy:function(a){if(Ext.getStore("sCmsInPatients")!=null){Ext.getStore("sCmsInPatients").removeAll();Ext.getStore("sCmsInPatients").destroy()}console.log("On Destroy :","CMS_InPatients");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPatientList(this.down("#CMS_IPL_BegDatePicker").getValue(),this.down("#CMS_IPL_EndDatePicker").getValue(),"");this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.getStore("sCmsInPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.CmsdatmData",storeId:"sCmsInPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryCmsInPatients.ashx",reader:{type:"json"}}})}this.down("#CMS_IPL_BegDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.DAY,-3));this.down("#CMS_IPL_EndDatePicker").setValue(new Date());var a=this;var e=Ext.getCmp("CMS_InPatGrid");if(e==null){e=NisTRApp.view.GridUtility.GenCMSInPatientGrid("CMS_InPatGrid","個管病人",null,false);e.initialFlag=true;e.getTitleBar().hide();var d=Ext.getStore("sCmsInPatients");e.setStore(d);e.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,e);this.down("#CMS_IPL_MainPanel").add(e);e.addListener("painted",NisTRApp.view.UserConfig.onPainted_CmsInPatGrid,e);var b=e.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_CmsInPatGrid,e);e=null;delete e;d=null;delete d}a=null;delete a;this.down("#CMS_IPL_AllBtn").fireEvent("tap",this.down("#CMS_IPL_AllBtn"),null,null)},LoadPatientList:function(e,a,b){if(Ext.getStore("sCmsInPatients").isLoading()){return}var d=Ext.getStore("sCmsInPatients");d.getProxy().setExtraParams({BegDate:e,EndDate:a,CAType:b});d.load();d=null;delete d}});Ext.define("NisTRApp.view.CMS.CommonPanel",{extend:Ext.Container,statics:{Create:function(b,a){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});setTimeout(function(){Ext.Viewport.setMasked(false)},1500);setTimeout(function(){try{if(!Ext.isEmpty(Ext.getCmp("_cmsCommonPanel"))){Ext.getCmp("_cmsCommonPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_cmsCommonPanel"))){var f=Ext.create("NisTRApp.view.CMS.CommonPanel",{id:"_cmsCommonPanel",modal:true,centered:true,hideOnMaskTap:false,record:b,caller:a});Ext.Viewport.add(f);f.show();f=null;delete f}}catch(d){console.log(d)}},150);return}},config:{defaultPage:"MED",initialFlag:true,centered:true,height:"90%",width:"97%",layout:{type:"fit"},caller:{},items:[{xtype:"toolbar",cls:"commonPanel-toolbar",docked:"top",id:"CMSINFO_DATM_HeadBar",itemId:"CMSINFO_DATM_HeadBar",items:[{xtype:"label",html:"Common_INFO",itemId:"PatInfoLbl",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   生日.{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age}) &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        身份證號. {PatIdno} </span>","</td>","    ",'<td rowspan="2" align="left" width="240px">',' <span style="font-weight: bold;color:#FF0000; font-size: 18px;">',"   {CancerName}  &nbsp; ","  </span>","</td>","","</tr>","</table>"]},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"CMSINFO_CloseBtn",margin:"5 5 5 5",right:"1px",style:"float:left;font-size:16px;",ui:"plain",width:"60px",text:"MyButton16"}]},{xtype:"tabpanel",itemId:"CMSINFO_MainTabPanel",layout:{animation:false,type:"card"},tabBar:{docked:"top",scrollable:"horizontal"}},{xtype:"toolbar",docked:"bottom",id:"CMSINFOFnBar",itemId:"CMSINFOFnBar",items:[{xtype:"button",itemId:"CMSINFO_CloseBtn2",right:"5px",ui:"confirm",width:"20%",text:"關 閉"}]}],listeners:[{fn:"onCMSINFO_CloseBtnTap",event:"tap",delegate:"#CMSINFO_CloseBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerShow",event:"show"},{fn:"onCMSINFO_CloseBtn2Tap",event:"tap",delegate:"#CMSINFO_CloseBtn2"},{fn:"onContainerUpdatedata",event:"updatedata"}]},onCMSINFO_CloseBtnTap:function(b,d,a){this.destroy()},onContainerDestroy:function(a){if(Ext.getStore("sCmsDatmData")!=null){Ext.getStore("sCmsDatmData").removeAll();Ext.getStore("sCmsDatmData").destroy()}if(!Ext.isEmpty(Ext.getCmp("CMSINFO_DATM_HeadBar"))){Ext.getCmp("CMSINFO_DATM_HeadBar").destroy()}_HideCommonFnBar=null;delete _HideCommonFnBar;_ShowCommonFnBar=null;delete _ShowCommonFnBar;console.log("On Destroy :","CMS.CommonPanel");this.removeAll(true,true)},onContainerShow:function(a,b){var d=this.down("#CMSINFO_MainTabPanel").getActiveItem();d=null;delete d},onCMSINFO_CloseBtn2Tap:function(b,d,a){try{this.destroy()}catch(d){console.error(d);this.destroy()}},onContainerUpdatedata:function(a,d,b){if(!this.getInitialFlag()){if(!Ext.isEmpty(this.getRecord().data.CmsID)){this.initialInCase();this.down("#PatInfoLbl").setRecord(this.getRecord())}}},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.getStore("sCmsDatmData")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.CmsdatmData",storeId:"sCmsDatmData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryCMSDatm.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNo)){Ext.Msg.alert("CMS.CommonPanel 資料錯誤");return false}_ShowCommonFnBar=function(e,f){Ext.getCmp("CMSINFOFnBar").setHidden(false)};_HideCommonFnBar=function(e,f){Ext.getCmp("CMSINFOFnBar").setHidden(true)};this.down("#PatInfoLbl").setRecord(this.getRecord());if(Ext.isEmpty(this.down("#_medProfilePanel"))){var b=Ext.create("NisTRApp.view.MEDProfile",{itemId:"_medProfilePanel",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"基本資料",caller:this,stopDistroyEvent:true});this.down("#CMSINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_medProfilePanel").addListener("painted",_HideCommonFnBar,this.down("#_medProfilePanel"));this.down("#_medProfilePanel").down("#MEDP_MEDCloseBtn").addListener("tap",function(f){try{this.destroy()}catch(g){console.error(g);this.destroy()}},this);var a=function(h,f){try{if(!Ext.isEmpty(f)){if(!Ext.isEmpty(f.getCaller())){if(!Ext.isEmpty(f.getCaller().getStore())){f.getCaller().getStore().load()}}}}catch(g){console.log(g)}};if(Ext.isEmpty(this.down("#_cmsdatmPanel"))){var d=Ext.create("NisTRApp.view.CMS.CmsdatmPanel",{itemId:"_cmsdatmPanel",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"收案資料",caller:this,stopDistroyEvent:true,successFn:a});this.down("#CMSINFO_MainTabPanel").add(d);d=null;delete d}this.down("#_cmsdatmPanel").addListener("painted",_HideCommonFnBar,this.down("#_cmsdatmPanel"));this.down("#_cmsdatmPanel").down("#CMS_DATM_CloseBtn").addListener("tap",function(f){try{this.destroy()}catch(g){console.error(g);this.destroy()}},this);a=null;delete a;Ext.getStore("sCmsDatmData").addListener("load",function(g,f,j,e,h){this.setRecord(f[0])},this);if(!Ext.isEmpty(this.getRecord().data.CmsID)){this.initialInCase()}this.down("#CMSINFO_MainTabPanel").setActiveItem(1);this.setInitialFlag(false)},initialInCase:function(){var e=function(j,k){Ext.getCmp("CMSINFOFnBar").setHidden(false)};var d=function(j,k){Ext.getCmp("CMSINFOFnBar").setHidden(true)};if(Ext.isEmpty(this.down("#_cmsMaintain"))){var f=Ext.create("mCmsFrmBaseData",{FrmCode:"CMS_MAINTAIN",FrmKey:this.getRecord().data.CmsID,ExamType:"CMS_MAINTAIN"});var h=Ext.create("NisTRApp.view.CMS.ScheduleRemark",{id:"_cmsMaintain",itemId:"_cmsMaintain",record:this.getRecord(),schdRecord:f,height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"個案管理紀錄",caller:this,formId:"none",storeId:"sCmsMaintainSch",divId:"cmsMaintainSchContent",byForm:false,byCase:false});this.down("#CMSINFO_MainTabPanel").add(h);h=null;delete h}this.down("#_cmsMaintain").addListener("painted",d,this.down("#_cmsMaintain"));if(Ext.isEmpty(this.down("#_cmsWorkUp1"))){var b=Ext.create("NisTRApp.view.CMS.WorkUp",{itemId:"_cmsWorkUp1",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"WorkUp",caller:this});this.down("#CMSINFO_MainTabPanel").add(b);b=null;delete b}this.down("#_cmsWorkUp1").addListener("painted",d,this.down("#_cmsWorkUp1"));if(Ext.isEmpty(this.down("#_cmsTreatmentPlan"))){var g=Ext.create("NisTRApp.view.CMS.TreatmentPlan",{itemId:"_cmsTreatmentPlan",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"治療計畫",caller:this});this.down("#CMSINFO_MainTabPanel").add(g);g=null;delete g}this.down("#_cmsTreatmentPlan").addListener("painted",d,this.down("#_cmsTreatmentPlan"));if(Ext.isEmpty(this.down("#_cmsTreatment"))){var a=Ext.create("NisTRApp.view.CMS.Treatment",{itemId:"_cmsTreatment",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"治療",caller:this});this.down("#CMSINFO_MainTabPanel").add(a);a=null;delete a}this.down("#_cmsTreatment").addListener("painted",d,this.down("#_cmsTreatment"));e=null;delete e;d=null;delete d}});Ext.define("NisTRApp.view.MEDProfile",{extend:Ext.Container,config:{stopDistroyEvent:false,height:"100%",itemId:"COMMON_Medmedf1",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"formpanel",cls:"mediumfont",itemId:"MedfInfoPanel",items:[{xtype:"fieldset",itemId:"ChartExpireFieldSet",width:"80%",items:[{xtype:"checkboxfield",itemId:"ChartExpireCb",width:"50%",label:"死亡註記",name:"ChartExpire"}]},{xtype:"fieldset",layout:{type:"vbox"},title:"體重 (kg)",items:[{xtype:"textfield",itemId:"InpLast",label:"住院",readOnly:true},{xtype:"textfield",itemId:"OpdLast",label:"門診前次",readOnly:true},{xtype:"textfield",itemId:"OpdToday",label:"門診今天",readOnly:true}]},{xtype:"fieldset",title:"通訊資料",items:[{xtype:"textfield",label:"電話(宅)",name:"TelHome",readOnly:true},{xtype:"textfield",label:"電話(公)",name:"TelOffice",readOnly:true},{xtype:"textfield",label:"手機",name:"TelMobile",readOnly:true},{xtype:"textfield",label:"電子信箱",name:"Email",readOnly:true},{xtype:"textfield",label:"戶籍地址",name:"DomicileStr",readOnly:true},{xtype:"textfield",label:"通訊地址",name:"AddressStr",readOnly:true}]},{xtype:"fieldset",title:"個人資料",items:[{xtype:"textfield",label:"病歷號",name:"ChartNO",readOnly:true},{xtype:"textfield",label:"身份證號",name:"PatIdno",readOnly:true},{xtype:"textfield",label:"姓名",name:"PatName",readOnly:true},{xtype:"textfield",label:"Last Name",name:"LastName",readOnly:true},{xtype:"textfield",label:"First Name",name:"FirstName",readOnly:true},{xtype:"textfield",label:"性別",name:"SexStr",readOnly:true},{xtype:"textfield",label:"生日",name:"BirthdayStr",readOnly:true},{xtype:"textfield",label:"年齡",name:"Age",readOnly:true},{xtype:"textfield",label:"婚姻狀況",name:"MarriedStr",readOnly:true},{xtype:"textfield",label:"出身地",name:"DistrName",readOnly:true},{xtype:"textfield",label:"教育程度",name:"EducationStr",readOnly:true},{xtype:"textfield",label:"職業別",name:"OccupationName",readOnly:true},{xtype:"textfield",label:"公司行號",name:"OccComp",readOnly:true},{xtype:"textfield",label:"職稱",name:"OccTitle",readOnly:true}]},{xtype:"fieldset",title:"緊急聯絡人",items:[{xtype:"textfield",label:"姓名",name:"EmrName",readOnly:true},{xtype:"textfield",label:"關係",name:"EmrRel",readOnly:true},{xtype:"textfield",label:"聯絡人電話",name:"EmrTel",readOnly:true},{xtype:"textfield",label:"聯絡人手機",name:"EmrBb",readOnly:true},{xtype:"textfield",label:"聯絡地址",name:"EmrAddrStr",readOnly:true}]}]},{xtype:"toolbar",docked:"bottom",id:"",itemId:"MEDFnBar",items:[{xtype:"panel",hidden:false,itemId:"MEDP_BR_Panel",width:"75%",layout:{type:"hbox"},items:[{xtype:"button",itemId:"MEDP_BR_OneBtn",width:"20%",text:"1 張"},{xtype:"button",itemId:"MEDP_BR_FiveBtn",width:"25%",text:"5 張"},{xtype:"selectfield",itemId:"MEDP_BR_SiteField",width:"50%",label:"地點",displayField:"SiteName",valueField:"SiteName"}]},{xtype:"button",itemId:"MEDP_MEDCloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"}]}],listeners:[{fn:"onMEDP_BR_OneBtnTap",event:"tap",delegate:"#MEDP_BR_OneBtn"},{fn:"onMEDP_BR_FiveBtnTap",event:"tap",delegate:"#MEDP_BR_FiveBtn"},{fn:"onMEDP_MEDCloseBtnTap",event:"tap",delegate:"#MEDP_MEDCloseBtn"},{fn:"onCOMMON_Medmedf1Show",event:"show"},{fn:"onCOMMON_Medmedf1Destroy",event:"destroy"}]},onMEDP_BR_OneBtnTap:function(b,d,a){this.PrintBarcode(1)},onMEDP_BR_FiveBtnTap:function(b,d,a){this.PrintBarcode(5)},onMEDP_MEDCloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onCOMMON_Medmedf1Show:function(d,f){if(Ext.getStore("sBarcodePrinterSite").getCount()<=0){Ext.getStore("sBarcodePrinterSite").load({callback:function(l,k,n){var m=localStorage.getItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());if(!Ext.isEmpty(m)){this.down("#MEDP_BR_SiteField").setValue(m)}m=null;delete m},scope:this})}var b=function b(l,k){Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Search/PatientVitalSign_V.ashx",scope:this,method:"POST",params:{ChartNo:l},success:function(m){try{if(null==m||String.IsNull(m.responseText)){return}var p=Ext.decode(m.responseText);if(null==p||p.length<=0){p=null;delete p;return}p.forEach(function n(s,r,q){if(s.Type=="OPD_TODAY"){k.down("#OpdToday").setValue(s.Weight);k.down("#OpdToday").setLabel("門診今日  "+NisTRApp.view.TRUtility.BirthdayFormat(s.CreDate))}if(s.Type=="OPD"){k.down("#OpdLast").setValue(s.Weight);k.down("#OpdLast").setLabel("門診前次  "+NisTRApp.view.TRUtility.BirthdayFormat(s.CreDate))}if(s.Type=="INP"){k.down("#InpLast").setValue(s.Weight);k.down("#InpLast").setLabel("住院  "+NisTRApp.view.TRUtility.BirthdayFormat(s.CreDate))}});p=null;delete p;k=null;delete k}catch(o){console.error(o)}},failure:function(){}})};var g=this;g.down("#InpLast").setValue("");g.down("#OpdLast").setValue("");g.down("#OpdToday").setValue("");g.down("#InpLast").setLabel("住院  ");g.down("#OpdLast").setLabel("門診前次  ");g.down("#OpdToday").setLabel("門診今日  ");if(!Ext.isEmpty(this.getRecord())){var a=this.down("#MedfInfoPanel");a.reset();a.down("#ChartExpireCb").uncheck();a.down("#ChartExpireFieldSet").hide();var e=this.getRecord().data;var h=Ext.getStore("sMedmedf");var j=null;if(h.getCount()>0){j=h.getAt(0)}b(e.ChartNo,g);if((null==j||String.IsNull(j.data.ChartNo)||e.ChartNo!=j.data.ChartNo)&&!Ext.isEmpty(Ext.getStore("sMedmedf"))){h.getProxy().setExtraParams({ChartNo:e.ChartNo});g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.LOAD});h.load({callback:function(l,k,m){g.setMasked(false);if(null!=l&&null!=l[0]){a.setRecord(l[0]);if(!String.IsNull(l[0].data.ChartExpire)&&"Y"==l[0].data.ChartExpire){a.down("#ChartExpireCb").check();a.down("#ChartExpireFieldSet").show()}}a=null;delete a;g=null;delete g},scope:this})}else{a.setRecord(j);if(!String.IsNull(j.data.ChartExpire)&&"Y"==j.data.ChartExpire){a.down("#ChartExpireCb").check();a.down("#ChartExpireFieldSet").show()}a=null;delete a;g=null;delete g}e=null;delete e;j=null;delete j;h=null;delete h}else{Ext.Msg.alert(SYS_CONST.Error.ERROR,"");g=null;delete g;this.destroy()}b=null;delete b},onCOMMON_Medmedf1Destroy:function(a){if(!Ext.isEmpty(Ext.getStore("sBarcodePrinterSite"))){Ext.getStore("sBarcodePrinterSite").removeAll();Ext.getStore("sBarcodePrinterSite").destroy()}if(!Ext.isEmpty(Ext.getStore("sMedmedf"))){Ext.getStore("sMedmedf").removeAll();Ext.getStore("sMedmedf").destroy()}console.log("on destroy :","MEDProfile");this.removeAll()},initialize:function(){this.callParent();if(Ext.isEmpty(Ext.getStore("sBarcodePrinterSite"))){var a=Ext.create("Ext.data.Store",{storeId:"sBarcodePrinterSite",autoLoad:false,model:"NisTRApp.model.mBarcodePrinter",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},useDefaultXhrHeader:false,url:NisTRApp.view.SysUtility.AgentServer()+"/api/Search/QueryBarcodeSite.ashx",reader:{type:"json"}},sorters:[{direction:"Location",property:"Location"},{property:"Sequence",direction:"ASC"}]})}this.down("#MEDP_BR_SiteField").setStore(Ext.getStore("sBarcodePrinterSite"));if(Ext.isEmpty(Ext.getStore("sMedmedf"))){Ext.create("Ext.data.Store",{storeId:"sMedmedf",autoLoad:false,model:"NisTRApp.model.Med.MedmedfEntity",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryFullMedmedf.ashx",reader:{type:"json"}}})}},PrintBarcode:function(b){var g=this.getRecord();if(g==null){return}var a=this.down("#MEDP_BR_SiteField").getRecord();if(null==a){g=null;delete g;a=null;delete a;return}var f=localStorage.getItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());if(f!=a.data.SiteName){localStorage.removeItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID());localStorage.setItem("RSPBarcodeSiteSelect_"+NisTRApp.view.SysUtility.GetUserID(),a.data.SiteName)}try{Ext.Ajax.request({url:NisTRApp.view.SysUtility.AgentServer()+"/api/action/PrintBarcode.ashx",scope:this,useDefaultXhrHeader:false,method:"POST",params:{ChartNo:g.data.ChartNo,SiteName:a.data.SiteName,Cnt:b},success:function(e){NisTRApp.view.Misc.Alert("列印成功!",800)},failure:function(e){NisTRApp.view.Misc.Alert("列印失敗!請重新整理。")}})}catch(d){NisTRApp.view.Misc.Alert("列印失敗!請重新整理。")}g=null;delete g;a=null;delete a;f=null;delete f;return}});Ext.define("NisTRApp.view.WorkList.CMS.SearchPatients",{extend:Ext.Container,alias:"widget.CMS_SearchPatients",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_SPL_MainPanel",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"top",items:[{xtype:"textfield",itemId:"CMS_SPL_PatId",width:260,label:"病人ID",placeHolder:"病歷號或身分證號"},{xtype:"button",itemId:"CMS_SPL_QueryBtn",ui:"decline",width:"90px",text:"查詢"},{xtype:"label",html:"Common_INFO",itemId:"PatInfoLab",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   生日.{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age}) &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        身份證號. {PatIdno} </span>","</td>","","</tr>","</table>"],width:"360px"},{xtype:"button",itemId:"CMS_SPL_InCaleBtn",ui:"confirm",width:"120px",iconCls:"add",text:"新收案"}]},{xtype:"panel",flex:1.5,itemId:"CMS_SPL_MainPanel"}]}],listeners:[{fn:"onCMS_SPL_PatIdClearicontap",event:"clearicontap",delegate:"#CMS_SPL_PatId"},{fn:"onCMS_SPL_QueryBtnTap",event:"tap",delegate:"#CMS_SPL_QueryBtn"},{fn:"onCMS_SPL_InCaleBtnTap",event:"tap",delegate:"#CMS_SPL_InCaleBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCMS_SPL_PatIdClearicontap:function(b,d,a){Ext.getStore("sSPLPatient").removeAll();Ext.getStore("sCmsSearchPatients").removeAll();this.setRecord(null);this.down("#PatInfoLab").setHidden(true);this.down("#PatInfoLab").setHtml("");this.down("#CMS_SPL_InCaleBtn").setHidden(true)},onCMS_SPL_QueryBtnTap:function(b,d,a){this.LoadPatientList();this.LoadMed()},onCMS_SPL_InCaleBtnTap:function(f,g,d){if(Ext.getStore("sSPLPatient").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord().data;console.log(b);var a=Ext.create("NisTRApp.model.CMS.CmsdatmData",{ChartNO:b.ChartNO,PatIdno:b.PatIdNo,Sex:b.Sex,PatName:b.PatName,Birthday:b.Birthday,Age:b.Age,CmsID:"",Cancer:""});NisTRApp.view.CMS.CommonPanel.Create(a,this)},onContainerDestroy:function(a){if(Ext.getStore("sSPLPatient")!=null){Ext.getStore("sSPLPatient").removeAll();Ext.getStore("sSPLPatient").destroy()}if(Ext.getStore("sCmsSearchPatients")!=null){Ext.getStore("sCmsSearchPatients").removeAll();Ext.getStore("sCmsSearchPatients").destroy()}console.log("On Destroy :","CMS_SearchPatients");this.removeAll(true,true)},onContainerPainted:function(b,a){},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.isEmpty(Ext.getStore("sSPLPatient"))){Ext.create("Ext.data.Store",{storeId:"sSPLPatient",clearOnPageLoad:false,model:"NisTRApp.model.Reg.RegPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:40000,url:SYS_CONST.ApiRoot+"Search/QueryMedPatient.ashx",reader:{type:"json"}}})}this.down("#PatInfoLab").setHidden(true);this.down("#CMS_SPL_InCaleBtn").setHidden(true);Ext.getStore("sSPLPatient").addListener("load",function(g,f,j,e,h){if(!Ext.isEmpty(f)&&!Ext.isEmpty(f[0])&&!Ext.isEmpty(f[0].data.ChartNO)){this.setRecord(f[0]);this.down("#PatInfoLab").setRecord(f[0]);this.down("#PatInfoLab").setHidden(false);this.down("#CMS_SPL_InCaleBtn").setHidden(false)}else{this.setRecord(null);this.down("#PatInfoLab").setHidden(true);this.down("#PatInfoLab").setHtml("");this.down("#CMS_SPL_InCaleBtn").setHidden(true)}},this);if(Ext.getStore("sCmsSearchPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.CmsdatmData",storeId:"sCmsSearchPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:40000,url:SYS_CONST.ApiRoot+"CMS/search/QueryCmsDataByPat.ashx",reader:{type:"jsonHtmlDecode"}}})}var a=this;var d=Ext.getCmp("CMS_SearchPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenCMSInPatientGrid("CMS_SearchPatGrid","病人查詢",null,false);d.initialFlag=true;d.getTitleBar().hide();var b=Ext.getStore("sCmsSearchPatients");d.setStore(b);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,d);this.down("#CMS_SPL_MainPanel").add(d);d=null;delete d;b=null;delete b}this.down("#CMS_SPL_PatId").addListener("keyup",function(f,h,g){if(h.event.keyCode==13){this.down("#CMS_SPL_QueryBtn").fireEvent("tap")}},this);a=null;delete a;this.setInitialFlag(false)},LoadPatientList:function(){if(Ext.getStore("sCmsSearchPatients").isLoading()){return}if(Ext.isEmpty(this.down("#CMS_SPL_PatId").getValue())){Ext.getStore("sCmsSearchPatients").removeAll();return}var a=Ext.getStore("sCmsSearchPatients");var b=this.down("#CMS_SPL_PatId").getValue();a.removeAll();a.getProxy().setExtraParams({ChartNo:b});a.load();a=null;delete a;b=null;delete b},LoadMed:function(){if(Ext.getStore("sSPLPatient").isLoading()){return}if(Ext.isEmpty(this.down("#CMS_SPL_PatId").getValue())){NisTRApp.view.Misc.Alert("請輸入病人ID",800);Ext.getStore("sSPLPatient").removeAll();this.setRecord(null);this.down("#PatInfoLab").setHidden(true);this.down("#PatInfoLab").setHtml("");this.down("#CMS_SPL_InCaleBtn").setHidden(true);return}var b=this.down("#CMS_SPL_PatId").getValue();var a=Ext.getStore("sSPLPatient");a.removeAll();a.getProxy().setExtraParams({ChartNo:b});a.load();a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.WorkList.CMS.RegPatients",{extend:Ext.Container,alias:"widget.CMS_RegPatients",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_REG_MainPanel",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"bottom",itemId:"CMS_REG_Toolbar",items:[{xtype:"textfield",itemId:"CMS_REG_UserId",width:260,label:"員工編號",placeHolder:"員工編號"},{xtype:"datepickerfield",itemId:"CMS_REG_REGDatePicker",width:"22%",label:"日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"CMS_REG_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"panel",flex:1.5,itemId:"CMS_REG_MainPanel"}]}],listeners:[{fn:"onCMS_REG_REGDatePickerChange",event:"change",delegate:"#CMS_REG_REGDatePicker"},{fn:"onCMS_REG_QueryBtnTap",event:"tap",delegate:"#CMS_REG_QueryBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCMS_REG_REGDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){this.LoadPatientList()}},onCMS_REG_QueryBtnTap:function(b,d,a){this.LoadPatientList()},onContainerDestroy:function(a){if(Ext.getStore("sCmsRegPatients")!=null){Ext.getStore("sCmsRegPatients").removeAll();Ext.getStore("sCmsRegPatients").destroy()}console.log("On Destroy :","CMS_RegPatients");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPatientList();this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);this.down("#CMS_REG_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());this.down("#CMS_REG_REGDatePicker").setValue(new Date());this.initialStore();var a=this;var e=Ext.getCmp("CMS_RegPatGrid");if(e==null){e=NisTRApp.view.GridUtility.GenCMSRegPatientGrid("CMS_RegPatGrid","門診病人",null,false);e.initialFlag=true;e.getTitleBar().hide();var d=Ext.getStore("sCmsRegPatients");e.setStore(d);e.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,e);this.down("#CMS_REG_MainPanel").add(e);e.addListener("painted",NisTRApp.view.UserConfig.onPainted_CmsRegPatGrid,e);var b=e.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_CmsRegPatGrid,e);e=null;delete e;d=null;delete d}a=null;delete a},LoadPatientList:function(){if(Ext.getStore("sCmsRegPatients").isLoading()){return}if(Ext.isEmpty(this.down("#CMS_REG_UserId").getValue())){NisTRApp.view.Misc.Alert("請輸入員工編號",800);Ext.getStore("sCmsRegPatients").removeAll();return}var a=Ext.getStore("sCmsRegPatients");var e=this.down("#CMS_REG_UserId").getValue();var b=this.down("#CMS_REG_REGDatePicker").getValue();a.removeAll();a.getProxy().setExtraParams({UserID:e,RegDate:b});a.load();var d=Ext.getCmp("CMS_RegPatGrid").getMasked();if(!Ext.isEmpty(d)){d.setMessage("候診狀態計算中</br></br>請稍候... ")}a=null;delete a;e=null;delete e;b=null;delete b},initialStore:function(){if(Ext.data.ModelManager.getModel("mCmsRegData")==null){Ext.define("mCmsRegData",{extend:NisTRApp.model.CMS.CmsdatmData,config:{fields:[{name:"RegDate",type:"string"},{name:"Noon",type:"string"},{name:"HdeptCode",type:"string"},{name:"SectCode",type:"string"},{name:"RegNO",type:"string"},{name:"ArrivalTime",type:"string"},{name:"OrdInTime",type:"string"},{name:"OrdOutTime",type:"string"},{name:"OrdTmpTime",type:"string"},{name:"RegTypeName",type:"string"},{name:"HdeptName",type:"string"},{name:"DocName",type:"string"},{name:"DocNO",type:"string"},{name:"TimeS",type:"string"},{name:"RealTime",type:"string"},{name:"LateTime",type:"string"},{name:"SecondFrmCnt",type:"int"},{name:"FirstFrmCnt",type:"int"},{name:"RegInPerson",type:"string"},{name:"DispStatus",type:"string"},{convert:function(b,d){var a="Black";if(null!=d.data.OrdOutTime&&""!=d.data.OrdOutTime){a="Silver"}return a},name:"StyleColor",type:"string"},{convert:function(a,b){return NisTRApp.view.TRUtility.NoonTranToName(b.data.Noon)},name:"NoonStr",type:"string"},{convert:function(b,f){var a="White";try{switch(f.data.DispStatus){case"看診中":case"治療中看診":case"初診-看診中":case"初診-治療中看診":case"特診-看診中":case"特診-看診中":a="PaleGreen";break;case"已報到":case"特診-已報到":case"初診-已報到":case"治療中":a="OliveDrab";break;case"準備看診":case"初診-準備看診":case"特診-準備看診":a="MediumPurple";break;case"已報到-今日有檢查項目":case"特診-今日有檢查項目":case"初診-今日有檢查項目":a="Pink";break;case"已報到-回診報告已完成":a="PaleTurquoise";break;case"初診-未報到":case"特診-未報到":a="Tan";break;default:a=""}}catch(d){a=""}return a},name:"BgColor",type:"string"}]}})}if(Ext.getStore("sCmsRegPatients")==null){Ext.create("Ext.data.Store",{model:"mCmsRegData",storeId:"sCmsRegPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:60000,url:SYS_CONST.ApiRoot+"CMS/search/QueryCmsMyRegPat.ashx",reader:{type:"jsonHtmlDecode"}}})}}});Ext.define("NisTRApp.view.CMS.ClosePanel",{extend:Ext.Container,config:{initialFlag:true,stopDistroyEvent:false,height:"100%",width:"100%",layout:{type:"fit"},modal:true,caller:{},successFn:{},items:[{xtype:"formpanel",itemId:"CMS_CP_Main",layout:{type:"vbox"}},{xtype:"toolbar",docked:"bottom",itemId:"CMS_CP_FootBar",items:[{xtype:"button",itemId:"CMS_CP_CloseBtn",right:"10px",ui:"confirm",width:"90px",text:"關 閉"},{xtype:"button",itemId:"CMS_CP_SaveBtn",left:"10px",right:"10px",ui:"decline",width:"90px",text:"存 檔"},{xtype:"button",itemId:"CMS_CP_UnClosedBtn",left:"110px",right:"10px",ui:"decline",width:"90px",text:"取消結案"}]}],listeners:[{fn:"onCMS_CP_CloseBtnTap",event:"tap",delegate:"#CMS_CP_CloseBtn"},{fn:"onCMS_CP_SaveBtnTap",event:"tap",delegate:"#CMS_CP_SaveBtn"},{fn:"onCMS_CP_UnClosedBtnTap",event:"tap",delegate:"#CMS_CP_UnClosedBtn"},{fn:"onContainerDestroy",event:"destroy"}]},onCMS_CP_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onCMS_CP_SaveBtnTap:function(b,f,a){if(Ext.isEmpty(this.down("#CmsCloseDate").getValue())){NisTRApp.view.Misc.Alert("結案日期不可為空值",0);return false}var d=this.getRecord();Ext.Msg.confirm("Confirm","是否結案?",function(g,h,e){if(g=="no"){return}else{if(g=="yes"){this.Closed(2)}}},this);d=null;delete d},onCMS_CP_UnClosedBtnTap:function(b,f,a){var d=this.getRecord();Ext.Msg.confirm("Confirm","是否取消結案?",function(g,h,e){if(g=="no"){return}else{if(g=="yes"){this.Closed(1)}}},this);d=null;delete d},onContainerDestroy:function(a){console.log("On Destroy :","CMS.ClosePanel");this.removeAll(true,true)},initialize:function(){this.callParent();var a=this.getRecord();this.down("#CMS_CP_Main").add(this.CreateCloseField());a=null;delete a},CreateCloseField:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:" ",layout:"fit",centered:false});var f=function f(h,j,g){this.timeField.setValue(new Date())};var e=function f(h,j,g){this.timeField.setValue(null)};var a=NisTRApp.view.DateUtil.CreatDateField("CmsCloseDate","CmsCloseDate","結案日期","30%","85%",null);b.add(a);b.add(this.CreateCloseBtn("CmsCloseDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(this.CreateCloseBtn("CmsCloseCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));a.setValue(Ext.isEmpty(this.getRecord().data.CloseDate)?null:NisTRApp.view.DateUtil.StrToDateTime(this.getRecord().data.CloseDate));var d=Ext.create("Ext.field.Select",{id:"CmsCloseReason",itemId:"CmsCloseReason",label:"結案原因",labelWidth:"26%",width:"99%",displayField:"CloseRemark",valueField:"CloseReason",style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(j,h,g){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(h!="99")}}}});d.setStore(Ext.getStore("sCmsCloseReason"));b.add(d);d.setValue(this.getRecord().data.CloseReason);a=Ext.create("Ext.field.Text",{id:"CmsCloseRemark",itemId:"CmsCloseRemark",label:"說明",labelWidth:"26%",width:"99%",maxLength:64,hidden:true,placeHolder:"最多64字",style:"float:left;font-size:16px;"});b.add(a);a.setValue(this.getRecord().data.CloseRemark);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.CloseReason)&&this.getRecord().data.CloseReason=="99"));d.remarkField=a;f=null;delete f;e=null;delete e;a=null;delete a;d=null;delete d;return b},CreateCloseBtn:function(f,b,e,a){var d=Ext.create("Ext.Button",{html:b,itemId:f,margin:"5 5 5 5",ui:"plain",style:"float:left;font-size:16px;",timeField:e}).addListener("tap",a);d.timeField=e;return d},Closed:function(a){if(Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();var b={CmsID:e.data.CmsID,ChartNO:e.data.ChartNO,CloseReason:this.down("#CmsCloseReason").getValue(),CloseRemark:this.down("#CmsCloseRemark").getValue(),CloseDate:this.down("#CmsCloseDate").getFormattedValue("Ymd"),CloseUserID:NisTRApp.view.SysUtility.GetUserID()};var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/action/CmsClosed.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),CmsID:e.data.CmsID,CloseFlag:a,Json:btoa(encodeURIComponent(JSON.stringify(b)))},success:function(f){d.setMasked(false);var h=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){var g=d.getSuccessFn();if(!Ext.isEmpty(g)&&Ext.isFunction(g)){g(true,d.getCaller())}if(a==1){d.down("#CmsCloseDate").setValue(null);d.down("#CmsCloseReason").setValue(null);d.down("#CmsCloseRemark").setValue(null)}}h=null;delete h;d=null;delete d;g=null;delete g},failure:function(){d.setMasked(false);d=null;delete d}});b=null;delete b;e=null;delete e}});Ext.define("NisTRApp.view.CMS.WorkUp",{extend:Ext.Container,config:{stopDistroyEvent:true,initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"panel",itemId:"CMS_WK_Main"}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)||Ext.isEmpty(this.getRecord().data.CmsID)){Ext.Msg.alert("CMS.WorkUp 資料錯誤");return false}if(Ext.isEmpty(this.down("#_cmsWKLab"))){var a=Ext.create("NisTRApp.view.CMS.WorkUp.LAB",{itemId:"_cmsWKLab",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"檢驗",caller:this,stopDistroyEvent:true});this.down("#CMS_WK_Main").add(a);a=null;delete a}}});Ext.define("NisTRApp.view.CMS.TreatmentPlan",{extend:Ext.Container,config:{initialFlag:true,stopDistroyEvent:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"panel",itemId:"CMS_TP_Index",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"CMS_TP_TitleBar",items:[{xtype:"selectfield",itemId:"CMS_TP_ItemField",width:"27%",label:"首治項目",displayField:"ParValue",valueField:"ParID"},{xtype:"datepickerfield",itemId:"CMS_TP_FirstEndDate",width:"27%",label:"首治完成日",labelWidth:"39%",value:{year:2015,month:4,day:30},placeHolder:"請輸入日期",dateFormat:"Y/m/d",picker:{itemId:"CMS_TP_FirstEndDatePicker",useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2010,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"CMS_TP_AllFinishedDate",width:"29%",label:"所有治療完成日",labelWidth:"45%",value:{year:2015,month:4,day:30},placeHolder:"請輸入日期",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2010,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"CmsTP_DatMSaveBtn",ui:"decline",width:"7%",text:"存 檔"},{xtype:"button",itemId:"CmsTP_DatMDeleteBtn",ui:"confirm",width:"7%",iconCls:"refresh"}]},{xtype:"panel",html:"",itemId:"CMS_TP_Main",layout:{type:"fit"},items:[{xtype:"panel",hidden:false,itemId:"CMS_TP_Form",layout:{type:"hbox"},items:[{xtype:"panel",cls:["x-container","x-toolbar-dark","x-toolbar"],height:"100%",itemId:"Cms_TP_FormFnBtn",width:"10%",layout:{type:"vbox"},modal:false,scrollable:false,items:[{xtype:"button",itemId:"CmsTP_OPRBtn",margin:"5 5 15 5 ",badgeText:"",text:"新 增"}]},{xtype:"panel",itemId:"Cms_TP_FormGridPanel",width:"90%"}]},{xtype:"panel",height:"100%",hidden:true,itemId:"CMS_TP_Content",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_TP_ContentPanel"}]}]},{xtype:"toolbar",docked:"bottom",hidden:true,itemId:"CMS_TP_FnBar",items:[{xtype:"button",hidden:false,itemId:"CMS_TP_NewPlanBtn",left:"10px",ui:"decline",width:"150px",iconCls:"add",text:"新增計畫"},{xtype:"selectfield",hidden:false,itemId:"CMS_TP_PlanSelect",left:"170px",width:"750px",label:"選擇計畫",labelWidth:"15%",autoComplete:true,displayField:"DisplayStr",valueField:"PlanmID"}]}]}],listeners:[{fn:"onCmsTP_DatMSaveBtnTap",event:"tap",delegate:"#CmsTP_DatMSaveBtn"},{fn:"onCmsTP_DatMDeleteBtnTap",event:"tap",delegate:"#CmsTP_DatMDeleteBtn"},{fn:"onCmsTP_OPRBtnTap",event:"tap",delegate:"#CmsTP_OPRBtn"},{fn:"onCMS_TP_ContentHide",event:"hide",delegate:"#CMS_TP_Content"},{fn:"onCMS_TP_NewPlanBtnTap",event:"tap",delegate:"#CMS_TP_NewPlanBtn"},{fn:"onCMS_TP_PlanSelectChange",event:"change",delegate:"#CMS_TP_PlanSelect"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCmsTP_DatMSaveBtnTap:function(f,j,d){var h=this.getRecord();var a=this.down("#CMS_TP_Main").getRecord();var b={CmsID:h.data.CmsID,ChartNO:h.data.ChartNO,Item:this.down("#CMS_TP_ItemField").getValue(),FirstEndDate:this.down("#CMS_TP_FirstEndDate").getFormattedValue("Ymd"),AllFinishedDate:this.down("#CMS_TP_AllFinishedDate").getFormattedValue("Ymd"),PlanmID:a.data.PlanmID,Flag:0};var g=this;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),CmsID:h.data.CmsID,Json:btoa(encodeURIComponent(JSON.stringify(b)))},success:function(e){g.setMasked(false);var k=Ext.decode(e.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){}k=null;delete k;g=null;delete g;scFn=null;delete scFn},failure:function(){g.setMasked(false);g=null;delete g}});b=null;delete b;h=null;delete h},onCmsTP_DatMDeleteBtnTap:function(d,f,b){var a=this.down("#CMS_TP_Main").getRecord();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)&&!Ext.isEmpty(a.data.PlanmID)){this.LoadPlanD(a.data.PlanmID)}},onCmsTP_OPRBtnTap:function(b,d,a){this.OpenOprEdit()},onCMS_TP_ContentHide:function(a,b){this.down("#CMS_TP_ContentPanel").removeAll()},onCMS_TP_NewPlanBtnTap:function(d,f,b){if(!Ext.isEmpty(Ext.getCmp("_cmsTPHeaderCreater"))){Ext.getCmp("_cmsTPHeaderCreater").destroy()}if(Ext.isEmpty(Ext.getCmp("_cmsTPHeaderCreater"))){var a=Ext.create("NisTRApp.view.CMS.Treatment.HeaderCreater",{id:"_cmsTPHeaderCreater",modal:true,record:this.getRecord(),hideOnMaskTap:false,caller:this,});Ext.Viewport.add(a);a.show();a=null;delete a}},onCMS_TP_PlanSelectChange:function(a,e,b,d){},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sTPM"))){Ext.getStore("sTPM").removeAll();Ext.getStore("sTPM").destroy()}if(!Ext.isEmpty(Ext.getStore("sTPD"))){Ext.getStore("sTPD").removeAll();Ext.getStore("sTPD").destroy()}console.log("On Destroy :","CMS.TreatPlan");this.removeAll()},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPlanM();this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);this.initialStore();this.down("#CMS_TP_ItemField").setStore(Ext.getStore("sSysTPItem"));this.down("#CMS_TP_PlanSelect").setStore(Ext.getStore("sTPM"));this.down("#CMS_TP_FirstEndDate").setValue(null);this.down("#CMS_TP_AllFinishedDate").setValue(null);this.down("#CMS_TP_AllFinishedDate").getPicker().addListener("show",function(f){if(Ext.isEmpty(f.getToolbar().down("#zoreBtn"))){var e=Ext.create("Ext.Button",{itemId:"zoreBtn",text:"清除",align:"left",ui:"action",timeField:f}).addListener("tap",function(h,j,g){h.timeField.setValue(null);h.timeField.hide();h.timeField.fireEvent("change",h.timeField,null)});e.timeField=f;f.getToolbar().add(e);e=null;delete e}},this.down("#CMS_TP_AllFinishedDate"));this.down("#CMS_TP_FirstEndDate").getPicker().addListener("show",function(f){if(Ext.isEmpty(f.getToolbar().down("#zoreBtn"))){var e=Ext.create("Ext.Button",{itemId:"zoreBtn",text:"清除",align:"left",ui:"action",timeField:f}).addListener("tap",function(h,j,g){h.timeField.setValue(null);h.timeField.hide();h.timeField.fireEvent("change",h.timeField,null)});e.timeField=f;f.getToolbar().add(e);e=null;delete e}},this.down("#CMS_TP_FirstEndDate"));var a=this;var d=Ext.getCmp("CMS_PlanDGrid");if(d==null){d=this.GenPlanDGrid("CMS_PlanDGrid","個管病人",null,false);d.initialFlag=true;d.caller=this;d.getTitleBar().hide();var b=Ext.getStore("sTPD");d.setStore(b);d.addListener("itemtap",this.ItemSingleTapGrid,d);this.down("#Cms_TP_FormGridPanel").add(d);d=null;delete d;b=null;delete b}a=null;delete a},initialStore:function(){if(Ext.getStore("sTPM")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.TreatmentPlanMEntity",storeId:"sTPM",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatment.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.getStore("sTPD")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.TreatmentPlanDEntity",storeId:"sTPD",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatmentDetial.ashx",reader:{type:"jsonHtmlDecode"}}})}},LoadPlanM:function(){if(Ext.getStore("sTPM").isLoading()){return}var b=this.getRecord();var a=Ext.getStore("sTPM");a.getProxy().setExtraParams({CmsID:b.data.CmsID});a.removeAll();a.load({callback:function(e,d,f){if(!Ext.isEmpty(e)&&!Ext.isEmpty(e[0])&&!Ext.isEmpty(e[0].data)){this.selectPlanm(e[0])}},scope:this});b=null;delete b;a=null;delete a},UpdateHeader:function(e){if(Ext.isEmpty(e)||Ext.isEmpty(e.data)){return}this.down("#CMS_TP_Main").setRecord(e);var a=e.data;this.down("#CMS_TP_ItemField").setValue(a.Item);if(!Ext.isEmpty(a.FirstEndDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(a.FirstEndDate);this.down("#CMS_TP_FirstEndDate").setValue(b)}if(!Ext.isEmpty(a.AllFinishedDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(a.AllFinishedDate);this.down("#CMS_TP_AllFinishedDate").setValue(b)}},resetHeader:function(){this.down("#CMS_TP_ItemField").setValue("");this.down("#CMS_TP_FirstEndDate").setValue(null);this.down("#CMS_TP_AllFinishedDate").setValue(null)},selectPlanm:function(a){this.resetHeader();if(Ext.isEmpty(a)){return}this.down("#CMS_TP_Main").setRecord(a);this.UpdateHeader(a);this.LoadPlanD(a.data.PlanmID)},GenPlanDGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",caller:null,CmsRecord:null,emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無治療項目.</div>',columns:[{text:"備註",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<img id="REMARK_REMARK_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath(values.RemarkCnt)]}" alt="Smiley face" height="30" width="30">',{ImgPath:function(e){if(!Ext.isEmpty(e)&&e>0){return"FrmFinish.png"}else{return"FrmAdd.png"}}}),width:80,hidden:true,sortable:false},{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<img id="EDIT_SETTING_{KeyOne}" src="'+SYS_CONST.ImgRoot+'notes.png" alt="Smiley face" height="30" width="30">',width:60,hidden:false,sortable:false,flex:1},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DEL_CHECK_{KeyOne}">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"治療項目",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:200,tpl:'<span id="FN_ITEMNAMECH_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{ItemNameCH}</span>',flex:1,dataIndex:"ItemNameCH",hidden:false,editable:false,sortable:false},{text:"預計治療啟日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:120,tpl:'<span id="FN_PREBEGDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.PreBegDate)]}</span>',flex:1,dataIndex:"PreBegDate",hidden:false,editable:false,sortable:false},{text:"預計治療迄日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:120,tpl:'<span id="FN_PREEBDDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.PreEndDate)]}</span>',flex:1,dataIndex:"PreEndDate",hidden:false,editable:false,sortable:false},{text:"建檔人",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_CREUSERNAME_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{CreUserName}</span>',flex:1,dataIndex:"CreUserName",hidden:false,editable:false,sortable:false},{text:"建檔日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_CREDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.CreDate)]}</span>',flex:1,dataIndex:"CreDate",hidden:false,editable:false,sortable:false}]})},ActiveChange:function(b,a){this.down("#CmsTP_DatMSaveBtn").setHidden(a!="CMS_TP_Form");this.down("#CmsTP_DatMDeleteBtn").setHidden(a!="CMS_TP_Form");NisTRApp.view.Misc.PanelChange(b,a)},LoadPlanD:function(a){if(Ext.getStore("sTPD").isLoading()||Ext.isEmpty(a)){return}var d=this.getRecord();var b=Ext.getStore("sTPD");b.getProxy().setExtraParams({ChartNo:d.data.ChartNO,PlanmID:a});b.removeAll();b.load({callback:function(f,e,g){},scope:this});d=null;delete d;b=null;delete b},ItemSingleTapGrid:function(g,b,j,a,h,d){var g=this;var f=h.event.target.id.split("_");if(null==f||f.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"||h.event.target.nodeName=="BUTTON"){switch(f[0]){case"EDIT":g.caller.OpenOprEdit(a);break;case"DEL":g.caller.DelPland(a,g.caller,g);break;default:break}h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}f=null;delete f;g=null;delete g;return false},OpenOprEdit:function(b){var d=this.down("#CMS_TP_Main").getRecord();this.down("#CMS_TP_ContentPanel").removeAll();if(Ext.isEmpty(this.down("#_cmsTreatmentPlanOPR"))){var a=Ext.create("NisTRApp.view.CMS.TreatmentPlan.OPR",{itemId:"_cmsTreatmentPlanOPR",record:this.getRecord(),height:"100%",width:"100%",modal:false,title:"手術治療計畫",caller:this,planM:d,planD:b,backEvent:function(e,f){e.ActiveChange(e.down("#CMS_TP_Main"),"CMS_TP_Form");e.LoadPlanD(f.getPlanM().data.PlanmID)}});this.down("#CMS_TP_ContentPanel").add(a);if(!Ext.isEmpty(a)){a.fireEvent("show",a,null,null)}a=null;delete a}this.ActiveChange(this.down("#CMS_TP_Main"),"CMS_TP_Content")},DelPland:function(e,a,b){var d=a;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentDetialDelete.ashx",scope:a,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),PlandID:e.data.PlandID},success:function(f){d.setMasked(false);var g=Ext.decode(f.responseText);NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0));if(g.Success){e.destroy();b.refresh()}g=null;delete g;d=null;delete d;scFn=null;delete scFn},failure:function(){d.setMasked(false);d=null;delete d}});json=null;delete json;cmsRec=null;delete cmsRec}});Ext.define("NisTRApp.view.CMS.TreatmentPlan.OPR",{extend:Ext.Container,config:{initialFlag:true,changeFlag:true,layout:{type:"fit"},caller:{},successFn:{},planM:{},planD:{},backEvent:{},planOpr:{},items:[{xtype:"panel",itemId:"CMS_TP_OPR_Main",layout:{type:"hbox"},items:[{xtype:"formpanel",flex:1,height:"100%",itemId:"CMS_TP_OPR_MainForm",layout:{type:"vbox"}},{xtype:"panel",flex:1,itemId:"CMS_TP_OPR_Related"}]},{xtype:"toolbar",docked:"bottom",itemId:"CMS_TP_OPR_Footbar",items:[{xtype:"button",itemId:"CMS_TP_OPR_BackBtn",ui:"confirm-back",width:"120px",text:"回治療計畫"}]}],listeners:[{fn:"onCMS_TP_OPR_BackBtnTap",event:"tap",delegate:"#CMS_TP_OPR_BackBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCMS_TP_OPR_BackBtnTap:function(d,f,b){var a=this.getBackEvent();if(!Ext.isEmpty(a)&&Ext.isFunction(a)){a(this.getCaller(),this)}a=null;delete a;this.destroy()},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sOprPland"))){Ext.getStore("sOprPland").removeAll();Ext.getStore("sOprPland").destroy()}console.log("On Destroy :","CMS.TreatPlan.OPR");this.removeAll()},onContainerPainted:function(d,b){if(Ext.isEmpty($("#_cmsPlandSaveBtn")[0])){var e=$('<img src="../_/img/save01.png" id="_cmsPlandSaveBtn" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:this,callbackFn:this.SavePland},function(f){try{f.data.callbackFn(f.data.caller)}catch(f){console.log(f)}});e.appendTo($("#CmsOprPlanDTitleDiv"));e=null;delete e;a=null;delete a}if(Ext.isEmpty($("#_cmsPlandContracSaveBtn")[0])){var e=$('<img src="../_/img/save01.png" id="_cmsPlandContracSaveBtn" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:this,callbackFn:this.SaveOpr},function(f){try{f.data.callbackFn(f.data.caller)}catch(f){console.log(f)}});e.appendTo($("#CmsOprPlanDContracDiv"));e=null;delete e;a=null;delete a}},CreateField:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:'<div id="CmsOprPlanDTitleDiv">治療計畫</div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Checkbox",{id:"firstFlag",itemId:"firstFlag",label:"首次治療",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",checked:false,hidden:true});b.add(a);a=Ext.create("Ext.field.Select",{id:"tpOPRItem",itemId:"tpOPRItem",label:"治療項目",labelWidth:"26%",displayField:"ParValue",valueField:"ParID",width:"99%",style:"float:left;font-size:16px;",value:null});a.setStore(Ext.getStore("sSysTPItem"));b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("PreBegDate","PreBegDate","預計治療啟日","30%","85%",null);a.setHidden(true);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PreBegDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e).setHidden(true));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PreBegDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d).setHidden(true));a=NisTRApp.view.DateUtil.CreatDateField("PreEndDate","PreEndDate","預計治療迄日","30%","85%",null);a.setHidden(true);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PreEndDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e).setHidden(true));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PreEndDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d).setHidden(true));a=Ext.create("Ext.field.DatePicker",{itemId:"PreDate",label:"預計治療月",value:null,labelWidth:"30%",dateFormat:"Y/m",style:"float:left;font-size:16px;",width:"85%",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month"],yearFrom:2000,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}});a.setHidden(false);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PreDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e).setHidden(false));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PreDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d).setHidden(false));a=Ext.create("Ext.field.TextArea",{id:"purpose",itemId:"purpose",label:"治療目的",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",maxRows:12,maxLength:512,hidden:true});b.add(a);a=Ext.create("Ext.field.Select",{id:"PlanNTreatH",itemId:"PlanNTreatH",label:"院別",labelWidth:"26%",width:"99%",hidden:true,options:[{text:"",value:""},{text:"本院",value:"1"},{text:"它院",value:"2"},],style:"float:left;font-size:16px;",listeners:{change:function(h,g,f){}}});b.add(a);a=null;delete a;e=null;delete e;d=null;delete d;b.down("#tpOPRItem").addListener("change",function(h,j,f,g){this.down("#PreDate").setHidden(false);this.down("#PreDateSetBtn").setHidden(false);this.down("#PreDateCancelBtn").setHidden(false);this.down("#PreBegDate").setHidden(true);this.down("#PreBegDateSetBtn").setHidden(true);this.down("#PreBegDateCancelBtn").setHidden(true);this.down("#PreEndDate").setHidden(true);this.down("#PreEndDateSetBtn").setHidden(true);this.down("#PreEndDateCancelBtn").setHidden(true)},b);return b},CreateOprRptField:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"CmsOprContracFieldSet",width:"95%",title:'<div id="CmsOprPlanDContracDiv">手術治療追蹤</div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Text",{id:"OprmstIDTxt",itemId:"OprmstIDTxt",label:"手術流水號",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("OprmDate","OprmDate","手術日期","30%","85%",null);a.setReadOnly(true);b.add(a);a=Ext.create("Ext.field.Text",{id:"DrName",itemId:"DrName",label:"主治醫師",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefDiag_1",itemId:"BefDiag_1",label:"*術前診斷",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefDiagName1",itemId:"BefDiagName1",label:"術前診斷1",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefOper_1",itemId:"BefOper_1",label:"*預定術式",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefOperName1",itemId:"BefOperName1",label:"預定主術1",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefOperName2",itemId:"BefOperName2",label:"預定主術2",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=null;delete a;e=null;delete e;d=null;delete d;return b},initialize:function(){this.callParent();this.setInitialFlag(true);this.setChangeFlag(false);if(Ext.data.ModelManager.getModel("mCmsOprmstData")==null){Ext.define("mCmsOprmstData",{extend:NisTRApp.model.OPR.OprmstvEntity,config:{fields:[{name:"OprID",type:"string"},{name:"PlandID",type:"string"},{name:"DefaultID",type:"string"}]}})}if(Ext.getStore("sOprPland")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.TreatmentPlanDEntity",storeId:"sOprPland",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatmentDetial.ashx",reader:{type:"jsonHtmlDecode"}}})}this.down("#CMS_TP_OPR_MainForm").add(this.CreateField());this.PlandUpdate(this.getPlanD())},GenOprGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"關聯",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'<img id="IMPORT_PLANDID_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath(values.PlandID)]}" alt="Smiley face" height="25" width="25">',{ImgPath:function(e){if(!Ext.isEmpty(e)){return"checkbox-icon.png"}else{return"unchecked-checkbox-icon.png"}}}),width:80,hidden:false,sortable:false},{text:"手術日期",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{OprmDate}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DrName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"科別",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DeptName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"*術前診斷",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAG_SPAN",values.BefDiag_1, "14px", 12, values.StyleColor, "OPRPTBEFDIAG_IMG","handPoint.png","25","25" )]}'),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"術前診斷1",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAGNAME_SPAN",values.BefDiagName1, "14px", 14, values.StyleColor, "OPRPTBEFDIAGNAME_IMG","handPoint.png","25","25" )]}'),width:140,hidden:false,sortable:false,flex:1},{text:"*預定術式",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'<div id="OPRPTBEFOPR_DIV_{KeyOne}; width:98%;height:98%; margin: 1px 1px 1px 1px;">{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPR_SPAN",values.BefOper_1, "14px", 16, values.StyleColor, "OPRPTBEFOPR_IMG","handPoint.png","25","25" )]}</div>'),flex:1,width:140,hidden:false,editable:false,sortable:false},{text:"預定主術1",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME_SPAN",values.BefOperName1, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1},{text:"預定主術2",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME2_SPAN",values.BefOperName2, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1}]})},LoadOprmst:function(){if(Ext.getStore("sCmsOprmst").isLoading()){return}var d=this.getRecord();var a=this.getPlanD();var b=Ext.getStore("sCmsOprmst");b.getProxy().setExtraParams({ChartNo:d.data.ChartNO,PlandID:((Ext.isEmpty(a)||Ext.isEmpty(a.data))?"":a.data.PlandID)});b.removeAll();b.load({callback:function(f,e,g){this.setChangeFlag(false)},scope:this});d=null;delete d;b=null;delete b;a=null;delete a},ItemSingleTapGrid:function(g,b,j,a,h,d){var f=h.event.target.id.split("_");if(null==f||f.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"){switch(f[0]){case"OPRPTBEFOPR":NisTRApp.view.Misc.MsgShow(a.data.BefOper_1,"",2500);break;case"OPRPTBEFDIAG":NisTRApp.view.Misc.MsgShow(a.data.BefDiag_1,"",2500);break;case"OPRPTBEFDIAGNAME":NisTRApp.view.Misc.MsgShow(a.data.BefDiagName1,"",2500);break;case"OPRPTBEFOPRNAME":NisTRApp.view.Misc.MsgShow(a.data.BefOperName1,"",2500);break;case"OPRPTBEFOPRNAME2":NisTRApp.view.Misc.MsgShow(a.data.BefOperName2,"",2500);break;case"IMPORT":break;default:break}h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}f=null;delete f;g=null;delete g;_import=null;delete _import;return false},applyData:function(b){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.data)){var a=null;a=b.data.Item;if(!Ext.isEmpty(a)){this.down("#tpOPRItem").setValue(a)}a=b.data.PreBegDate;if(!Ext.isEmpty(a)){var e=NisTRApp.view.DateUtil.StrToDateTime(a);this.down("#PreDate").setValue(e);this.down("#PreBegDate").setValue(e)}a=b.data.PreEndDate;if(!Ext.isEmpty(a)){var e=NisTRApp.view.DateUtil.StrToDateTime(a);this.down("#PreEndDate").setValue(e)}a=b.data.Purpose;if(!Ext.isEmpty(a)){this.down("#purpose").setValue(a)}a=b.data.TreatH;if(!Ext.isEmpty(a)){this.down("#PlanNTreatH").setValue(a)}delete a;a=null}},resetData:function(){this.down("#tpOPRItem").setValue("");this.down("#PreDate").setValue(null);this.down("#PreBegDate").setValue(null);this.down("#PreEndDate").setValue(null);this.down("#purpose").setValue("");this.down("#purpose").setValue("");this.down("#PlanNTreatH").setValue("")},SavePland:function(e){if(Ext.isEmpty(e.down("#tpOPRItem").getValue())){NisTRApp.view.Misc.Alert("治療項目不可為空值",0);return false}var h=e.getRecord();var d=e.getPlanM();var a=e.getPlanD();var b=(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)&&!Ext.isEmpty(a.data.PlandID))?a.data.PlandID:"";var f={PlandID:b,PlanmID:d.data.PlanmID,ChartNO:h.data.ChartNO,Item:e.down("#tpOPRItem").getValue(),PreBegDate:e.down("#PreBegDate").getFormattedValue("Ymd"),PreEndDate:e.down("#PreEndDate").getFormattedValue("Ymd"),PreDate:e.down("#PreDate").getFormattedValue("Ymd"),Purpose:e.down("#purpose").getValue(),TreatH:e.down("#PlanNTreatH").getValue()};var g=e;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentDetialUpdate.ashx",scope:e,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),PlanmID:d.data.PlanmID,Json:btoa(encodeURIComponent(JSON.stringify(f)))},success:function(j){g.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){g.LoadPlanD(k.PlandID,k.PlanmID,k.ChartNO)}k=null;delete k;g=null;delete g;scFn=null;delete scFn},failure:function(){g.setMasked(false);g=null;delete g}});f=null;delete f;h=null;delete h},applyOprData:function(e){this.down("#OprmstIDTxt").setValue("");this.down("#OprmDate").setValue(null);this.down("#DrName").setValue("");this.down("#BefDiag_1").setValue("");this.down("#BefDiagName1").setValue("");this.down("#BefOper_1").setValue("");this.down("#BefOperName1").setValue("");this.down("#BefOperName2").setValue("");if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.data)){var a=e.data;this.down("#OprmstIDTxt").setValue(a.OprmstID);if(!Ext.isEmpty(a.OprmDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(a.OprmDate);this.down("#OprmDate").setValue(b)}this.down("#DrName").setValue(a.DrName);this.down("#BefDiag_1").setValue(a.BefDiag_1);this.down("#BefDiagName1").setValue(a.BefDiagName1);this.down("#BefOper_1").setValue(a.BefOper_1);this.down("#BefOperName1").setValue(a.BefOperName1);this.down("#BefOperName2").setValue(a.BefOperName2)}},LoadPlanD:function(d,a,e){if(Ext.getStore("sOprPland").isLoading()||Ext.isEmpty(d)){return}var b=Ext.getStore("sOprPland");b.getProxy().setExtraParams({PlanmID:a,ChartNo:e,PlandID:d});b.removeAll();b.load({callback:function(g,f,h){if(!Ext.isEmpty(g)&&!Ext.isEmpty(g[0])&&!Ext.isEmpty(g[0].data)){this.PlandUpdate(g[0])}},scope:this});b=null;delete b},PlandUpdate:function(b){this.setPlanD(b);this.resetData();var a=this.getPlanD();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)&&!Ext.isEmpty(a.data.PlandID)){this.applyData(a);this.down("#CMS_TP_OPR_Related").setHidden(true);this.LoadPlanOpr(a.data.PlandID,a.data.PlanmID,a.data.ChartNO)}else{this.down("#CMS_TP_OPR_Related").setHidden(true)}},SaveOpr:function(e){if(Ext.isEmpty(e.down("#OprmstIDTxt").getValue())){NisTRApp.view.Misc.Alert("請選擇手術記錄",0);return false}var h=e.getRecord();var d=e.getPlanM();var a=e.getPlanD();var b=(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)&&!Ext.isEmpty(a.data.PlandID))?a.data.PlandID:"";var f={PlandID:b,PlanmID:d.data.PlanmID,CmsID:h.data.CmsID,ChartNO:h.data.ChartNO,OprmstID:e.down("#OprmstIDTxt").getValue()};var g=e;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentOprUpdate.ashx",scope:e,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),PlandID:b,PlanmID:d.data.PlanmID,CmsID:h.data.CmsID,OprmstID:e.down("#OprmstIDTxt").getValue(),Json:btoa(encodeURIComponent(JSON.stringify(f)))},success:function(j){g.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){}k=null;delete k;g=null;delete g;scFn=null;delete scFn},failure:function(){g.setMasked(false);g=null;delete g}});f=null;delete f;h=null;delete h},LoadPlanOpr:function(b,a,d){}});Ext.define("NisTRApp.view.CMS.Treatment",{extend:Ext.Container,config:{initialFlag:true,stopDistroyEvent:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"tabpanel",itemId:"CMS_TREAT_Mian",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sTPM"))){Ext.getStore("sTreatmentItem").removeAll();Ext.getStore("sTreatmentItem").destroy()}console.log("On Destroy :","CMS.Treat");this.removeAll()},initialize:function(){this.callParent();this.initialStore();if(Ext.isEmpty(this.down("#_cmsTreatmentOpr"))){var b=Ext.create("NisTRApp.view.CMS.Treatment.OPR",{itemId:"_cmsTreatmentOpr",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"手術",caller:this});this.down("#CMS_TREAT_Mian").add(b);b=null;delete b}if(Ext.isEmpty(this.down("#_cmsTreatmentCHM"))){var f=Ext.create("NisTRApp.view.CMS.Treatment.CHM",{itemId:"_cmsTreatmentCHM",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"化療",caller:this});this.down("#CMS_TREAT_Mian").add(f);f=null;delete f}if(Ext.isEmpty(this.down("#_cmsTreatmentRT"))){var a=Ext.create("NisTRApp.view.CMS.Treatment.RT",{itemId:"_cmsTreatmentRT",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"放療",caller:this});this.down("#CMS_TREAT_Mian").add(a);a=null;delete a}if(Ext.isEmpty(this.down("#_cmsTreatmentHormone"))){var d=Ext.create("NisTRApp.view.CMS.Treatment.Hormone",{itemId:"_cmsTreatmentHormone",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"荷爾蒙",caller:this});this.down("#CMS_TREAT_Mian").add(d);d=null;delete d}if(Ext.isEmpty(this.down("#_cmsTreatmentStemCell"))){var e=Ext.create("NisTRApp.view.CMS.Treatment.StemCell",{itemId:"_cmsTreatmentStemCell",record:this.getRecord(),height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"幹細胞",caller:this});this.down("#CMS_TREAT_Mian").add(e);e=null;delete e}},initialStore:function(){}});Ext.define("NisTRApp.view.CMS.Treatment.OPR",{extend:Ext.Container,config:{initialFlag:true,stopDistroyEvent:true,updateFlag:false,height:"100%",width:"100%",layout:{type:"fit"},caller:{},treatOpr:{},items:[{xtype:"panel",itemId:"CmsTreatOprIndex",layout:{type:"fit"},items:[{xtype:"panel",itemId:"GridPanel",items:[{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"CreatBtn",right:"10px",ui:"decline",width:"120px",iconCls:"add",text:"新 增"},{xtype:"button",itemId:"RefreshBtn",ui:"decline",width:"120px",iconCls:"refresh",text:"重新整理"}]}]},{xtype:"panel",hidden:true,itemId:"FormPanel",layout:{type:"hbox"},items:[{xtype:"panel",flex:1,itemId:"FormEditPanel",layout:{type:"vbox"},scrollable:"vertical"},{xtype:"panel",flex:1,itemId:"FormGridPanel"},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"BackBtn",ui:"confirm-back",width:"120px",text:"回 上 頁"}]}]}]}],listeners:[{fn:"onCreatBtnTap",event:"tap",delegate:"#CreatBtn"},{fn:"onRefreshBtnTap",event:"tap",delegate:"#RefreshBtn"},{fn:"onBackBtnTap",event:"tap",delegate:"#BackBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCreatBtnTap:function(b,d,a){this.resetData();this.ActiveChange(this.down("#CmsTreatOprIndex"),"FormPanel");this.setTreatOpr(null);this.LoadOprmst(null)},onRefreshBtnTap:function(b,d,a){this.LoadData()},onBackBtnTap:function(b,d,a){if(this.getUpdateFlag()){this.LoadData()}this.setTreatOpr(null);this.ActiveChange(this.down("#CmsTreatOprIndex"),"GridPanel")},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sCmsOprmst"))){Ext.getStore("sCmsOprmst").removeAll();Ext.getStore("sCmsOprmst").destroy()}if(!Ext.isEmpty(Ext.getStore("sTreatOpr"))){Ext.getStore("sTreatOpr").removeAll();Ext.getStore("sTreatOpr").destroy()}console.log("On Destroy :","CMS.Treat.OPR");this.removeAll()},onContainerPainted:function(d,b){if(this.getInitialFlag()){this.LoadData();this.setInitialFlag(false)}if(Ext.isEmpty($("#_cmsTreatOprSaveBtn")[0])){var e=$('<img src="../_/img/save01.png" id="_cmsTreatOprSaveBtn" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:this,callbackFn:this.SaveOpr},function(f){try{f.data.callbackFn(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsTreatOprPlanDContracDiv"));e=$('<span style="float:right;" ><button align="right" id="_cmsTreatOprSaveBtn2" type="button">手術資料</button></span>');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:this,panel:this.down("#FormGridPanel")},function(f){try{if(!Ext.isEmpty(f.data.panel)){f.data.panel.setHidden(!f.data.panel.isHidden())}}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsTreatOprPlanDContracDiv"));e=null;delete e;a=null;delete a}opr=null;delete opr},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.data.ModelManager.getModel("mTreatOprData")==null){Ext.define("mTreatOprData",{extend:NisTRApp.model.OPR.OprmstvEntity,config:{idProperty:"OprID",fields:[{name:"OprID",type:"string"},{name:"CmsID",type:"string"},{name:"ModifyUserID",type:"string"},{name:"ModifyUserName",type:"string"},{name:"ModifyDate",type:"string"},{name:"ModifyTime",type:"string"},{name:"Remark",type:"string"}]}})}if(Ext.getStore("sTreatOpr")==null){Ext.create("Ext.data.Store",{model:"mTreatOprData",storeId:"sTreatOpr",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatOpr.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.data.ModelManager.getModel("mCmsOprmstData")==null){Ext.define("mCmsOprmstData",{extend:NisTRApp.model.OPR.OprmstvEntity,config:{fields:[{name:"OprID",type:"string"},{name:"CmsID",type:"string"},{name:"DefaultID",type:"string"},]}})}if(Ext.getStore("sCmsOprmst")==null){Ext.create("Ext.data.Store",{model:"mCmsOprmstData",storeId:"sCmsOprmst",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryOprmst.ashx",reader:{type:"jsonHtmlDecode"}}})}this.down("#FormEditPanel").add(this.CreateOprRptField());var a=this;var b=Ext.getCmp("CMS_TreatOprmstGrid");if(b==null){b=this.GenOprGrid("CMS_TreatOprmstGrid","TreatOprmstGrid",null,false);b.initialFlag=true;b.caller=this;b.getTitleBar().hide();var e=Ext.getStore("sCmsOprmst");b.setStore(e);b.addListener("itemtap",this.ItemSingleTapGrid,b);this.down("#FormGridPanel").add(b);b=null;delete b;e=null;delete e}var b=Ext.getCmp("CMS_TreatOprGrid");if(b==null){b=this.GenTreatOprGrid("CMS_TreatOprGrid","TreatOprGrid",null,false);b.initialFlag=true;b.caller=this;b.getTitleBar().hide();var d=Ext.getStore("sTreatOpr");b.setStore(d);b.addListener("itemtap",this.ItemSingleTapGrid,b);this.down("#GridPanel").add(b);b=null;delete b;d=null;delete d}a=null;delete a;this.UpdateTreatOpr(this.getTreatOpr())},ActiveChange:function(b,a){this.setUpdateFlag(false);NisTRApp.view.Misc.PanelChange(b,a)},CreateOprRptField:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"CmsOprContracFieldSet",width:"95%",title:'<div id="CmsTreatOprPlanDContracDiv">手術治療</div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Text",{itemId:"OprmstIDTxt",label:"手術流水號",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("OprmDate","OprmDate","手術日期","30%","85%",null);a.setReadOnly(true);b.add(a);a=Ext.create("Ext.field.Text",{itemId:"DrName",label:"主治醫師",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"BefDiag_1",label:"*術前診斷",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"BefDiagName1",label:"術前診斷1",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefOper_1",itemId:"BefOper_1",label:"*預定術式",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{id:"BefOperName1",itemId:"BefOperName1",label:"預定主術1",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"BefOperName2",label:"預定主術2",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",readOnly:true});b.add(a);a=Ext.create("Ext.field.TextArea",{itemId:"treatOprRemark",label:"Comment",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",maxRows:12,maxLength:512});b.add(a);a=null;delete a;e=null;delete e;d=null;delete d;return b},GenOprGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"關聯",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'<img id="IMPORTDATA_OPRMSTID_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath2(values.OprID)]}" alt="Smiley face" height="25" width="25">',{ImgPath2:function(e){if(!Ext.isEmpty(e)){return"checkbox-icon.png"}else{return"unchecked-checkbox-icon.png"}}}),width:80,hidden:false,sortable:false},{text:"手術日期",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{OprmDate}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DrName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"科別",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DeptName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"*術前診斷",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAG_SPAN",values.BefDiag_1, "14px", 12, values.StyleColor, "OPRPTBEFDIAG_IMG","handPoint.png","25","25" )]}'),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"術前診斷1",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAGNAME_SPAN",values.BefDiagName1, "14px", 14, values.StyleColor, "OPRPTBEFDIAGNAME_IMG","handPoint.png","25","25" )]}'),width:140,hidden:false,sortable:false,flex:1},{text:"*預定術式",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPR_SPAN",values.BefOper_1, "14px", 16, values.StyleColor, "OPRPTBEFOPR_IMG","handPoint.png","25","25" )]}'),flex:1,width:140,hidden:false,editable:false,sortable:false},{text:"預定主術1",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME_SPAN",values.BefOperName1, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1},{text:"預定主術2",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME2_SPAN",values.BefOperName2, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1}]})},ItemSingleTapGrid:function(l,g,h,d,j,k){var b=function b(e,n){e.caller.applyOprData(n);Ext.getStore("sCmsOprmst").each(function(q,o,p){q.data.OprID=""});n.data.OprID="check";e.refresh()};var f=function f(e,n){e.caller.resetData();e.caller.ActiveChange(e.caller.down("#CmsTreatOprIndex"),"FormPanel");e.caller.setTreatOpr(n);e.caller.applyOprData(n);e.caller.LoadOprmst(n)};var a=function a(e,n){Ext.Msg.confirm("Confirm","是否刪除記錄",function(p,r,o){if(p=="no"){return}else{if(p=="yes"){var q=e.caller;q.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentOprDelete.ashx",scope:e.caller,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),OprID:n.data.OprID,CmsID:n.data.CmsID},success:function(s){q.setMasked(false);var u=Ext.decode(s.responseText);NisTRApp.view.Misc.Alert(u.Message,(u.Success?800:0));if(u.Success){n.destroy();e.refresh()}u=null;delete u;q=null;delete q;scFn=null;delete scFn},failure:function(){q.setMasked(false);q=null;delete q}})}}},e.caller)};var m=j.event.target.id.split("_");if(null==m||m.length<=0){j.preventDefault();return false}if(j.event.target.nodeName=="IMG"||j.event.target.nodeName=="SPAN"||j.event.target.nodeName=="A"||j.event.target.nodeName=="BUTTON"){switch(m[0]){case"OPRPTBEFOPR":NisTRApp.view.Misc.MsgShow(d.data.BefOper_1,"",2500);break;case"OPRPTBEFDIAG":NisTRApp.view.Misc.MsgShow(d.data.BefDiag_1,"",2500);break;case"OPRPTBEFDIAGNAME":NisTRApp.view.Misc.MsgShow(d.data.BefDiagName1,"",2500);break;case"OPRPTBEFOPRNAME":NisTRApp.view.Misc.MsgShow(d.data.BefOperName1,"",2500);break;case"OPRPTBEFOPRNAME2":NisTRApp.view.Misc.MsgShow(d.data.BefOperName2,"",2500);break;case"IMPORTDATA":b(l,d);break;case"EDIT":f(l,d);break;case"DELETETREATOPR":a(l,d);break;default:break}j.preventDefault()}else{if(j.event.target.nodeName=="INPUT"){}}m=null;delete m;l=null;delete l;b=null;delete b;f=null;delete f;a=null;delete a;return false},LoadOprmst:function(a){if(Ext.getStore("sCmsOprmst").isLoading()){return}var d=this.getRecord();var b=Ext.getStore("sCmsOprmst");b.getProxy().setExtraParams({ChartNo:d.data.ChartNO,OprID:((Ext.isEmpty(a)||Ext.isEmpty(a.data)||Ext.isEmpty(a.data.OprID))?"":a.data.OprID)});b.removeAll();b.load({callback:function(f,e,g){},scope:this});d=null;delete d;b=null;delete b;pD=null;delete pD},UpdateTreatOpr:function(b){this.setTreatOpr(b);this.resetData();var a=this.getTreatOpr();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)&&!Ext.isEmpty(a.data.OprID)){this.applyOprData(a)}else{}},applyOprData:function(e){this.resetData();if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.data)){var a=e.data;this.down("#OprmstIDTxt").setValue(a.OprmstID);if(!Ext.isEmpty(a.OprmDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(a.OprmDate);this.down("#OprmDate").setValue(b)}this.down("#DrName").setValue(a.DrName);this.down("#BefDiag_1").setValue(a.BefDiag_1);this.down("#BefDiagName1").setValue(a.BefDiagName1);this.down("#BefOper_1").setValue(a.BefOper_1);this.down("#BefOperName1").setValue(a.BefOperName1);this.down("#BefOperName2").setValue(a.BefOperName2);this.down("#treatOprRemark").setValue(a.Remark)}},resetData:function(){this.down("#OprmstIDTxt").setValue("");this.down("#OprmDate").setValue(null);this.down("#DrName").setValue("");this.down("#BefDiag_1").setValue("");this.down("#BefDiagName1").setValue("");this.down("#BefOper_1").setValue("");this.down("#BefOperName1").setValue("");this.down("#BefOperName2").setValue("");this.down("#treatOprRemark").setValue("")},SaveOpr:function(a){if(Ext.isEmpty(a.down("#OprmstIDTxt").getValue())){NisTRApp.view.Misc.Alert("請選擇手術記錄",0);return false}a.setUpdateFlag(true);var g=a.getRecord();var f=a.getTreatOpr();var d=(!Ext.isEmpty(f)&&!Ext.isEmpty(f.data)&&!Ext.isEmpty(f.data.OprID))?f.data.OprID:"";var b={OprID:d,CmsID:g.data.CmsID,ChartNO:g.data.ChartNO,OprmstID:a.down("#OprmstIDTxt").getValue(),Remark:a.down("#treatOprRemark").getValue(),};var e=a;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentOprUpdate.ashx",scope:a,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),OprID:d,CmsID:g.data.CmsID,OprmstID:a.down("#OprmstIDTxt").getValue(),Json:btoa(encodeURIComponent(JSON.stringify(b)))},success:function(h){e.setMasked(false);var k=Ext.decode(h.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){var j=e.getTreatOpr();if(Ext.isEmpty(j)||Ext.isEmpty(j.data)||Ext.isEmpty(j.data.OprID)){j=Ext.create("mTreatOprData",{CmsID:k.CmsID,OprID:k.OprID});e.setTreatOpr(j)}j=null;delete j}k=null;delete k;e=null;delete e;scFn=null;delete scFn},failure:function(){e.setMasked(false);e=null;delete e}});b=null;delete b;f=null;delete f;g=null;delete g},GenTreatOprGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="EDIT_CHECK_{KeyOne}">編 輯</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DELETETREATOPR_CHECK_{KeyOne}" style="border:3px orange double;background-color:red;">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"編輯日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.ModifyDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.TimeFormat(values.ModifyTime)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {ModifyUserName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"手術日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.OprmDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DrName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"科別",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DeptName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"*術前診斷",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAG_SPAN",values.BefDiag_1, "14px", 12, values.StyleColor, "OPRPTBEFDIAG_IMG","handPoint.png","25","25" )]}'),flex:1,width:120,hidden:false,editable:false,sortable:false},{text:"術前診斷1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFDIAGNAME_SPAN",values.BefDiagName1, "14px", 14, values.StyleColor, "OPRPTBEFDIAGNAME_IMG","handPoint.png","25","25" )]}'),width:140,hidden:false,sortable:false,flex:1},{text:"*預定術式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPR_SPAN",values.BefOper_1, "14px", 16, values.StyleColor, "OPRPTBEFOPR_IMG","handPoint.png","25","25" )]}'),flex:1,width:160,hidden:false,editable:false,sortable:false},{text:"預定主術1",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME_SPAN",values.BefOperName1, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1},{text:"預定主術2",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"OPRPTBEFOPRNAME2_SPAN",values.BefOperName2, "14px", 16, values.StyleColor, "OPRPTBEFOPRNAME2_IMG","handPoint.png","25","25" )]}'),width:160,hidden:false,sortable:false,flex:1}]})},LoadData:function(){if(Ext.getStore("sTreatOpr").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sTreatOpr");a.getProxy().setExtraParams({ChartNo:b.data.ChartNO,CmsID:b.data.CmsID});a.removeAll();a.load({callback:function(e,d,f){},scope:this});b=null;delete b;a=null;delete a}});Ext.define("NisTRApp.view.CMS.Treatment.CHM",{extend:Ext.Container,statics:{DeleteTreatCmsdatm:function(d,b,a){Ext.Msg.confirm("Confirm","是否刪除記錄",function(f,h,e){if(f=="no"){return}else{if(f=="yes"){var g=b;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentChmdatmDelete.ashx",scope:b,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),ChmID:d.data.ChmID,Seq:d.data.Seq},success:function(j){g.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){this.LoadChmdatm()}k=null;delete k;g=null;delete g;scFn=null;delete scFn},failure:function(){g.setMasked(false);g=null;delete g}})}}},b)}},config:{initialFlag:true,stopDistroyEvent:true,updateFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},treatChm:{},items:[{xtype:"panel",itemId:"CmsTreatChmIndex",layout:{type:"fit"},items:[{xtype:"panel",itemId:"GridPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"RefreshBtn",ui:"decline",width:"120px",iconCls:"refresh",text:"重新整理"},{xtype:"button",itemId:"CreatBtn",right:"10px",ui:"decline",width:"120px",iconCls:"add",text:"新 增"}]}]},{xtype:"panel",hidden:true,itemId:"FormPanel",layout:{type:"hbox"},items:[{xtype:"panel",flex:1.1,itemId:"FormEditPanel",layout:{type:"vbox"},scrollable:"vertical"},{xtype:"panel",fnFlag:0,flex:1,hidden:true,itemId:"FormGridPanel"},{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"BackBtn",ui:"confirm-back",width:"120px",text:"回 上 頁"}]}]}]}],listeners:[{fn:"onRefreshBtnTap",event:"tap",delegate:"#RefreshBtn"},{fn:"onCreatBtnTap",event:"tap",delegate:"#CreatBtn"},{fn:"onBackBtnTap",event:"tap",delegate:"#BackBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRefreshBtnTap:function(b,d,a){this.LoadData()},onCreatBtnTap:function(b,d,a){this.CreatFormEditPanel(this,null)},onBackBtnTap:function(b,d,a){this.ActiveChange(this.down("#CmsTreatChmIndex"),"GridPanel");this.down("#FormEditPanel").removeAll();this.down("#FormGridPanel").removeAll(true,true);this.setTreatChm(null);if(this.getUpdateFlag()){this.setUpdateFlag(false);this.LoadData()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sTreatChmrpt"))){Ext.getStore("sTreatChmrpt").removeAll();Ext.getStore("sTreatChmrpt").destroy()}if(!Ext.isEmpty(Ext.getStore("sTreatChm"))){Ext.getStore("sTreatChm").removeAll();Ext.getStore("sTreatChm").destroy()}if(!Ext.isEmpty(Ext.getStore("sTreatChmdatm"))){Ext.getStore("sTreatChmdatm").removeAll();Ext.getStore("sTreatChmdatm").destroy()}_callChmdatmFn=null;delete _callChmdatmFn;console.log("On Destroy :","CMS.Treat.CHM");this.removeAll()},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadData();this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.data.ModelManager.getModel("mTreatChmrpt")==null){Ext.define("mTreatChmrpt",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"int"},{name:"InpNO",type:"string"},{name:"ProCode",type:"string"},{name:"ChmSeq",type:"string"},{name:"Source",type:"int"},{name:"ProName",type:"string"},{name:"Status",type:"string"},{name:"BegDate",type:"string"},{name:"BegTime",type:"string"},{name:"EndDate",type:"string"},{name:"AplDate",type:"string"},{name:"AplHdeptCode",type:"string"},{name:"AplHdeptName",type:"string"},{name:"AplDocNO",type:"string"},{name:"AplDocName",type:"string"},{name:"ArvlUserID",type:"string"},{name:"ArvlDate",type:"string"},{name:"ArvlTime",type:"string"},{name:"AgentCode",type:"string"},{name:"IcdhCode1",type:"string"},{name:"IcdhName1",type:"string"},{name:"IcdhName1E",type:"string"},{name:"ChmID",type:"string"},{name:"AgentCode",type:"string"},{name:"Seq",type:"int"},{convert:function(d,e){return e.data.ChartNO+"_"+e.data.ChartSeq+"_"+e.data.InpNO+"_"+e.data.ProCode+"_"+e.data.ChmSeq+"_"+e.data.ChmID+"_"+e.data.Seq+"_"+e.data.AgentCode},name:"KeyOne",type:"string"}],idProperty:"KeyOne"}})}if(Ext.getStore("sTreatChmrpt")==null){Ext.create("Ext.data.Store",{model:"mTreatChmrpt",storeId:"sTreatChmrpt",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryChmrpt.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.data.ModelManager.getModel("mTreatChm")==null){Ext.define("mTreatChm",{extend:Ext.data.Model,config:{fields:[{name:"CmsID",type:"string"},{name:"ChmID",type:"string"},{name:"Purpose",type:"string"},{name:"PurposeOther",type:"string"},{name:"PlanCycleBegDate",type:"string"},{name:"PlanCycleNumber",type:"string"},{name:"PlanCycleMonth",type:"string"},{name:"PlanCycleWeek",type:"string"},{name:"TreatCycleBegDate",type:"string"},{name:"TreatCycleEndDate",type:"string"},{name:"TreatCycleNumber",type:"string"},{name:"EndReason",type:"string"},{name:"EndReasonOther",type:"string"},{name:"ModifyUserID",type:"string"},{name:"ModifyUserName",type:"string"},{name:"ModifyDate",type:"string"},{name:"ModifyTime",type:"string"},{convert:function(d,e){return e.data.ChmID},name:"KeyOne",type:"string"},{convert:function(f,g){var d="";try{switch(g.data.Purpose){case"1":d="Neoadjuvant chemotherapy";break;case"2":d="Adjuvant chemotherapy";break;case"3":d="Chemotherapy";break;case"4":d="CCRT";break;case"5":d="Chemotherapy, NOS";break;case"6":d="Radiationtherapy";break;case"99":d=g.data.PurposeOther;break;default:d=""}return d}catch(e){return""}},name:"PurposeName",type:"string"}],idProperty:"KeyOne"}})}if(Ext.getStore("sTreatChm")==null){Ext.create("Ext.data.Store",{model:"mTreatChm",storeId:"sTreatChm",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatChm.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.data.ModelManager.getModel("mTreatChmdatmData")==null){Ext.define("mTreatChmdatmData",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"ChmID",type:"string"},{name:"CmsID",type:"string"}],hasMany:[{associatedName:"Records",associationKey:"Records",model:"mTreatChmdatmData",foreignKey:"Records",name:"Records"},{associationKey:"Records",primaryKey:"Seq",model:"mTreatChmrpt",name:"records"}]}})}if(Ext.getStore("sTreatChmdatm")==null){Ext.create("Ext.data.Store",{model:"mTreatChmdatmData",storeId:"sTreatChmdatm",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatChmdatm.ashx",reader:{type:"json"}}})}Ext.getStore("sTreatChmdatm").addListener("beforeload",function(e,d,f){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sTreatChmdatm").addListener("load",function(f,e,h,d,g){this.setMasked(false);this.RenderChmdatmTable(this,this.getRecord())},this);var b=Ext.getCmp("CMS_TreatCHMFrid");if(b==null){b=this.GenTreatChmGrid("CMS_TreatCHMFrid","TreatChmGrid",null,false);b.initialFlag=true;b.caller=this;b.getTitleBar().hide();var a=Ext.getStore("sTreatChm");b.setStore(a);b.addListener("itemtap",this.ItemSingleTapGrid,b);this.down("#GridPanel").add(b);b=null;delete b;a=null;delete a}myThis=null;delete myThis},ActiveChange:function(b,a){NisTRApp.view.Misc.PanelChange(b,a,this)},CreRptField:function(){var f=function f(h,j,g){this.timeField.setValue(new Date())};var e=function e(h,j,g){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"CmsCHMPlanFieldSet",width:"95%",title:'<div id="CmsCHMPlanContracDiv">Treatment Plan</div>',layout:"fit",centered:false});var d=Ext.create("Ext.field.Select",{itemId:"Purpose",label:"治療目的",labelWidth:"26%",width:"99%",style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(j,h,g){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(h!="99")}}}});d.setStore(Ext.getStore("sTreatmentItem"));b.add(d);var a=Ext.create("Ext.field.Text",{itemId:"PurposeOther",label:"治療目的其他",labelWidth:"26%",width:"99%",maxLength:64,hidden:true,placeHolder:"最多64字",style:"float:left;font-size:16px;"});b.add(a);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.Purpose)&&this.getRecord().data.Purpose=="99"));d.remarkField=a;a=NisTRApp.view.DateUtil.CreatDateField("PlanCycleBegDate","PlanCycleBegDate","First Cycle will Start Date ","50%","75%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PlanCycleBegDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("PlanCycleBegDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));a=Ext.create("Ext.field.Number",{itemId:"PlanCycleNumber",label:"Number",labelWidth:"26%",width:"99%",hidden:false,style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Number",{itemId:"PlanCycleMonth",label:"Month",labelWidth:"26%",width:"99%",hidden:false,style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Number",{itemId:"PlanCycleWeek",label:"Week",labelWidth:"26%",width:"99%",hidden:false,style:"float:left;font-size:16px;"});b.add(a);a=null;delete a;f=null;delete f;e=null;delete e;return b},CrePlanCHMItem:function(){return Ext.create("Ext.Label",{itemId:"PlanItems",width:"95%",html:'<div id="CmsTreatCHMPlanItemsDiv">Agent</div>',tpl:Ext.create("Ext.XTemplate",'<div id="_CmsTreatCHMPlanData" class="smallList" >','<table id="_CmsTreatCHMPlanTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",' <th colspan="3" style="text-align:left">Agent<span>&nbsp;&nbsp;&nbsp;&nbsp;<button style="width:150px" id="_CmsTreatCHMPlanNewBtn" type="button">新 增</button></span></th>          ',"        </tr>","        <tr>",'            <th width="16%"> </th>','            <th width="42%">Protocal</th>','            <th width="42%">Agent</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"                <tr>","     ",'                    <td width="16%" align="center" ><a name="delete" class="link-btn" formid="{FormID}" editionid="" openrecordid="{OpenRecordID}">刪 除</a></td>','                    <td width="42%" align="center">{AplDrName}</td>','                    <td width="42%"  align="center">{SysDate}</td>',"                </tr> ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="16%">    </th>','            <th width="42%">Protocal</th>','            <th width="42%">Agent</th>',"            </tr>","            </tfoot> ","            </table>","            </div>","")})},CreTreatField:function(){var f=function f(h,j,g){this.timeField.setValue(new Date())};var e=function e(h,j,g){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"CmsCHMTreatFieldSet",width:"95%",title:'<div id="CmsCHMTreatContracDiv">Treatment Cycle Information</div>',layout:"fit",centered:false});var d=Ext.create("Ext.field.Select",{itemId:"Purpose",label:"治療目的",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"Neoadjuvant chemotherapy",value:"1"},{text:"Adjuvant chemotherapy",value:"2"},{text:"Chemotherapy",value:"3"},{text:"CCRT",value:"4"},{text:"Chemotherapy, NOS",value:"5"},{text:"Others",value:"99"},],style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(j,h,g){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(h!="99");if(h!="99"){this.remarkField.setValue("")}}}}});b.add(d);var a=Ext.create("Ext.field.Text",{itemId:"PurposeOther",label:"治療目的其他",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,placeHolder:"最多128字",style:"float:left;font-size:16px;"});b.add(a);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.Purpose)&&this.getRecord().data.Purpose=="99"));d.remarkField=a;a=NisTRApp.view.DateUtil.CreatDateField("TreatCycleBegDate","TreatCycleBegDate","First Cycle Start Date","50%","75%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("TreatCycleBegDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("TreatCycleBegDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));a=NisTRApp.view.DateUtil.CreatDateField("TreatCycleEndDate","TreatCycleEndDate","Last Cycle Start Date","50%","75%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("TreatCycleEndDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("TreatCycleEndDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));a=Ext.create("Ext.field.Number",{itemId:"TreatCycleNumber",label:"Total cycle Number",labelWidth:"40%",width:"99%",hidden:false,style:"float:left;font-size:16px;"});b.add(a);d=Ext.create("Ext.field.Select",{itemId:"EndReason",label:"Reason Treatment Ended ",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"Treatment completed per protocol criteria",value:"1"},{text:"Disease progression, relapse during active treatment",value:"2"},{text:"Adverse event (side effects、complications)",value:"3"},{text:"Death on study",value:"4"},{text:"Patient withdrawal：refusal after beginning protocol therapy",value:"5"},{text:"Patient withdrawal：refusal prior beginning protocol therapy",value:"6"},{text:"Alternative therapy",value:"7"},{text:"Patient off-treatment for other complicating disease",value:"8"},{text:"Lost to follow-up",value:"9"},{text:"Disease progression before active treatment",value:"10"},{text:"Others",value:"99"},],style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(j,h,g){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(h!="99");if(h!="99"){this.remarkField.setValue("")}}}}});b.add(d);var a=Ext.create("Ext.field.Text",{itemId:"EndReasonOther",label:"其他",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,placeHolder:"最多128字",style:"float:left;font-size:16px;"});b.add(a);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.EndReason)&&this.getRecord().data.EndReason=="99"));d.remarkField=a;a=null;delete a;d=null;delete d;f=null;delete f;e=null;delete e;return b},CreTreatCHMItem:function(){return Ext.create("Ext.Label",{itemId:"TreatItems",width:"95%",html:'<div id="CmsTreatCHMTreatItemsDiv">Agent</div>',tpl:Ext.create("Ext.XTemplate",'<div id="_CmsTreatCHMTreatData" class="smallList" >','<table id="_CmsTreatCHMTreatTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",' <th colspan="4" style="text-align:left">Agent<span>&nbsp;&nbsp;&nbsp;&nbsp;<button style="width:150px" id="_CmsTreatCHMTreatNewBtn" type="button">ADD</button></span></th>          ',"        </tr>","        <tr>",'            <th width="15%"> </th>','            <th width="45%">Protocal</th>','            <th width="15%">Sequence</th>','            <th width="25%">BeginTime</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"                <tr>","     ",'                    <td width="15%" align="center" ><a name="chmdatmDelete" class="link-btn" keyone="{ChmID}_{Seq}" chmid="{ChmID}" seq="{Seq}">刪 除</a></td>','                    <td width="45%" align="center">{ProName}</td>','                    <td width="15%"  align="center">{ChmSeq}</td>','                    <td width="25%"  align="center"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.BegDate)]} {[NisTRApp.view.TRUtility.TimeFormat(values.BegTime)]}</td>',"                </tr> ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="15%"> </th>','            <th width="45%">Protocal</th>','            <th width="15%">Sequence</th>','            <th width="25%">BeginTime</th>',"            </tr>","            </tfoot> ","            </table>","            </div>","")})},CrePlanItem:function(e,a){var d=e.down("#FormGridPanel");if(d.fnFlag==a){d.fnFlag=a;d.setHidden(!d.isHidden());return}d.fnFlag=a;d.removeAll();if(d.fnFlag==2){var j=d.down("#QueryChmToolBar");if(!Ext.isEmpty(j)){j.destroy();j=null}if(Ext.isEmpty(j)){j=Ext.create("Ext.Toolbar",{itemId:"QueryChmToolBar",docked:"top"});j.add(NisTRApp.view.DateUtil.CreatDateField("ChmdatmBegDate","ChmdatmBegDate","啟日","45px","190px",null));j.add(NisTRApp.view.DateUtil.CreatDateField("ChmdatmEndDate","ChmdatmEndDate"," ~ ","25px","170px",null));j.down("#ChmdatmEndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));j.down("#ChmdatmBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-6));var h=Ext.create("Ext.Button",{itemId:"QueryChmBtn",width:"90px",text:"查詢"});j.add(h);h.addListener("tap",function(l,m,k){this.LoadChmrpt()},e);d.add(j)}var b=e;var g=Ext.getCmp("CMS_TreatCHMRecordGird");if(!Ext.isEmpty(g)){g.destroy();g=null}if(g==null){g=e.GenGrid("CMS_TreatCHMRecordGird","TreatChmdatmGrid",null,false);g.initialFlag=true;g.caller=e;g.getTitleBar().hide();var f=Ext.getStore("sTreatChmrpt");g.setStore(f);g.addListener("itemtap",e.ItemSingleTapGrid,g);d.add(g);g=null;delete g;f=null;delete f}f1=null;delete f1}if(d.isHidden()){e.LoadChmrpt()}d.setHidden(!d.isHidden());f1=null;delete f1;fieldSet=null;delete fieldSet;d=null;delete d},GenGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:" ",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"><a id="ADD_CHEMORPT_{KeyOne}" name="ADD_CHEMORPT" class="link-btn">ADD</a></span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"化療項目",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"PRONAME_SPAN",values.ProName, "14px", 16, values.StyleColor, "PRONAME_IMG","handPoint.png","25","25" )]}'),flex:1,width:180,hidden:false,editable:false,sortable:false},{text:"次數",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{ChmSeq}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"開始日期",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.BegDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"開始時間",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.TimeFormat(values.BegTime)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"申請醫師",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{AplDocName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"申請科別",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{AplHdeptName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"結束日期",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.EndDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"ICDH",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{IcdhCode1}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"ICDH_NAME",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"ICDHNAME1_SPAN",values.IcdhName1, "14px", 16, values.StyleColor, "ICDHNAME1_IMG","handPoint.png","25","25" )]}'),flex:1,width:180,hidden:false,editable:false,sortable:false}]})},LoadChmrpt:function(){if(Ext.getStore("sTreatChmrpt").isLoading()||Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();var b=Ext.getStore("sTreatChmrpt");var a=this.down("#ChmdatmEndDate").getValue();var d=this.down("#ChmdatmBegDate").getValue();b.getProxy().setExtraParams({ChartNo:e.data.ChartNO,BegDate:d,EndDate:a});b.removeAll();b.load({callback:function(g,f,h){},scope:this});e=null;delete e;b=null;delete b},ItemSingleTapGrid:function(l,g,h,d,j,k){var b=function b(e,n){e.caller.SaveTreatChmdatm(n,e.caller,null)};var f=function f(e,n){e.caller.CreatFormEditPanel(e.caller,n)};var a=function a(e,n){Ext.Msg.confirm("Confirm","是否刪除記錄",function(p,r,o){if(p=="no"){return}else{if(p=="yes"){var q=e.caller;q.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentChmDelete.ashx",scope:e.caller,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),ChmID:n.data.ChmID},success:function(s){q.setMasked(false);var u=Ext.decode(s.responseText);NisTRApp.view.Misc.Alert(u.Message,(u.Success?800:0));if(u.Success){n.destroy();e.refresh()}u=null;delete u;q=null;delete q;scFn=null;delete scFn},failure:function(){q.setMasked(false);q=null;delete q}})}}},e.caller)};var m=j.event.target.id.split("_");if(null==m||m.length<=0){j.preventDefault();return false}if(j.event.target.nodeName=="IMG"||j.event.target.nodeName=="SPAN"||j.event.target.nodeName=="A"||j.event.target.nodeName=="BUTTON"){switch(m[0]){case"PRONAME":NisTRApp.view.Misc.MsgShow(d.data.ProName,"",2500);break;case"ICDHNAME1":NisTRApp.view.Misc.MsgShow(d.data.IcdhName1,"",2500);break;case"ADD":b(l,d);break;case"EDIT":f(l,d);break;case"DELETETREATCHM":a(l,d);break;default:break}j.preventDefault()}else{if(j.event.target.nodeName=="INPUT"){}}m=null;delete m;l=null;delete l;b=null;delete b;f=null;delete f;a=null;delete a;return false},resetData:function(){},SaveChmrpt:function(b,a){b.setUpdateFlag(true);var f=b.getRecord();var h=b.getTreatChm();var g=(!Ext.isEmpty(h)&&!Ext.isEmpty(h.data)&&!Ext.isEmpty(h.data.ChmID))?h.data.ChmID:"";var d={ChmID:g,CmsID:f.data.CmsID,ChartNO:f.data.ChartNO,Purpose:b.down("#Purpose").getValue(),PurposeOther:b.down("#PurposeOther").getValue(),PlanCycleBegDate:"",PlanCycleNumber:"",PlanCycleMonth:"",PlanCycleWeek:"",TreatCycleBegDate:b.down("#TreatCycleBegDate").getFormattedValue("Ymd"),TreatCycleEndDate:b.down("#TreatCycleEndDate").getFormattedValue("Ymd"),TreatCycleNumber:b.down("#TreatCycleNumber").getValue(),EndReason:b.down("#EndReason").getValue(),EndReasonOther:b.down("#EndReasonOther").getValue(),};var e=b;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentChmUpdate.ashx",scope:b,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),ChmID:g,CmsID:f.data.CmsID,ChartNO:f.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(j){e.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){var l=e.getTreatChm();if(Ext.isEmpty(l)||Ext.isEmpty(l.data)||Ext.isEmpty(l.data.ChmID)){l=Ext.create("mTreatChm",{CmsID:k.CmsID,ChmID:k.ChmID});e.setTreatChm(l)}l=null;delete l}k=null;delete k;e=null;delete e;scFn=null;delete scFn},failure:function(){e.setMasked(false);e=null;delete e}});d=null;delete d;h=null;delete h;f=null;delete f},applyData:function(e){this.setTreatChm(e);if(!Ext.isEmpty(e)&&!Ext.isEmpty(e.data)){var a=e.data;this.down("#Purpose").setValue(a.Purpose);this.down("#PurposeOther").setValue(a.PurposeOther);if(!Ext.isEmpty(a.TreatCycleBegDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(a.TreatCycleBegDate);this.down("#TreatCycleBegDate").setValue(b)}if(!Ext.isEmpty(a.TreatCycleEndDate)){var b=NisTRApp.view.DateUtil.StrToDateTime(a.TreatCycleEndDate);this.down("#TreatCycleEndDate").setValue(b)}this.down("#TreatCycleNumber").setValue(a.TreatCycleNumber);this.down("#EndReason").setValue(a.EndReason);this.down("#EndReasonOther").setValue(a.EndReasonOther);this.LoadChmdatm()}},CreatFormEditPanel:function(b,e){b.down("#FormEditPanel").removeAll();b.down("#FormGridPanel").removeAll(true,true);b.setUpdateFlag(false);b.down("#FormGridPanel").fnFlag=0;b.down("#FormGridPanel").setHidden(true);b.down("#FormEditPanel").add(this.CreTreatField());lab=b.CreTreatCHMItem();b.down("#FormEditPanel").add(lab);lab.setRecord(b.getRecord());b.ActiveChange(b.down("#CmsTreatChmIndex"),"FormPanel");var a=NisTRApp.view.SysUtility.tapEventName();$("#_CmsTreatCHMTreatNewBtn").unbind(a);$("#_CmsTreatCHMTreatNewBtn").bind(a,{caller:b},function(f){try{f.data.caller.CrePlanItem(f.data.caller,2)}catch(f){console.log(f)}f.preventDefault();return false});if(Ext.isEmpty($("#_cmsTreatCHMPlanOprSaveBtn")[0])){var d=$('<img src="../_/img/save01.png" id="_cmsTreatCHMPlanOprSaveBtn" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();d.unbind(a);d.bind(a,{caller:b,callbackFn:b.SaveChmrpt},function(f){try{f.data.callbackFn(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});d.appendTo($("#CmsCHMTreatContracDiv"));d=null;delete d;a=null;delete a}if(!Ext.isEmpty(e)){b.applyData(e)}else{b.setTreatChm(null)}lab=null;delete lab;a=null;delete a},GenTreatChmGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="EDIT_CHECK_{KeyOne}">編 輯</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DELETETREATCHM_CHECK_{KeyOne}" style="border:3px orange double;background-color:red;">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"編輯日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.ModifyDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.TimeFormat(values.ModifyTime)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {ModifyUserName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"治療目的",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {PurposeName}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false},{text:"First Cycle Start Date",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.TreatCycleBegDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"Last Cycle Start Date",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.TreatCycleEndDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false}]})},LoadData:function(){if(Ext.getStore("sTreatChm").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sTreatChm");a.getProxy().setExtraParams({ChartNo:b.data.ChartNO,CmsID:b.data.CmsID});a.removeAll();a.load({callback:function(e,d,f){},scope:this});b=null;delete b;a=null;delete a},SaveTreatChmdatm:function(g,b,a){var f=b.getRecord();var j=b.getTreatChm();var h=(!Ext.isEmpty(j)&&!Ext.isEmpty(j.data)&&!Ext.isEmpty(j.data.ChmID))?j.data.ChmID:"";var d=g.data;d.ChmID=h;var e=b;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentChmdatmUpdate.ashx",scope:b,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),ChmID:h,CmsID:f.data.CmsID,ChartNO:f.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(k){e.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){var m=e.getTreatChm();if(Ext.isEmpty(m)||Ext.isEmpty(m.data)||Ext.isEmpty(m.data.ChmID)){m=Ext.create("mTreatChm",{CmsID:l.CmsID,ChmID:l.ChmID});e.setTreatChm(m)}e.LoadChmdatm();m=null;delete m}l=null;delete l;e=null;delete e;scFn=null;delete scFn},failure:function(){e.setMasked(false);e=null;delete e}});d=null;delete d;j=null;delete j;f=null;delete f},LoadChmdatm:function(){if(Ext.getStore("sTreatChmdatm").isLoading()||Ext.isEmpty(this.getRecord())){return}var e=this.getTreatChm();var d=(!Ext.isEmpty(e)&&!Ext.isEmpty(e.data)&&!Ext.isEmpty(e.data.ChmID))?e.data.ChmID:"";if(Ext.isEmpty(d)){return}var b=this.getRecord();var a=Ext.getStore("sTreatChmdatm");a.getProxy().setExtraParams({ChartNo:b.data.ChartNO,CmsID:b.data.CmsID,ChmID:d});a.removeAll();a.load({callback:function(g,f,h){},scope:this});b=null;delete b;a=null;delete a},RenderChmdatmTable:function(d,g){if(Ext.isEmpty(d)||Ext.isEmpty(d.down("#TreatItems"))){return false}b=function b(j,l,h,m){var k=Ext.getStore("sTreatChmdatm").getAt(0).records().find("Seq",$(j).attr("seq"));if(k>=0){m(Ext.getStore("sTreatChmdatm").getAt(0).records().getAt(k),l,h)}k=null;delete k};var f=Ext.getStore("sTreatChmdatm");d.down("#TreatItems").setHtml("");if(f.getCount()>0){if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.down("#TreatItems"))){d.down("#TreatItems").setHtml("");if(!Ext.isEmpty(f.getAt(0))){var e=d.down("#TreatItems").getTpl().apply(f.getAt(0).data);d.down("#TreatItems").setHtml(e);var a=NisTRApp.view.SysUtility.tapEventName();$("a[name='chmdatmDelete']").bind(a,function(){b(this,d,g,NisTRApp.view.CMS.Treatment.CHM.DeleteTreatCmsdatm)});$("#_CmsTreatCHMTreatNewBtn").bind(a,function(){d.CrePlanItem(d,2)});e=null;delete e;a=null;delete a}}}f=null;delete f}});Ext.define("NisTRApp.view.WorkList.CMS.MyInPatients",{extend:Ext.Container,alias:"widget.CMS_MyInPatients",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_MYINPT_MainPanel",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"top",itemId:"CMS_MYINPT_Toolbar",items:[{xtype:"selectfield",itemId:"CMS_MYINPT_UserId",width:265,label:"員工編號",displayField:"NameCH",valueField:"EmpNO"},{xtype:"textfield",hidden:true,itemId:"CMS_MYINPT_UserId1111",width:260,label:"員工編號",placeHolder:"員工編號"},{xtype:"selectfield",id:"",itemId:"CmsMyInPtCaClassification",label:"癌分",displayField:"TypeName",valueField:"TypeID"},{xtype:"selectfield",itemId:"CmsMyInPtCaType",label:"癌別",displayField:"CaName",valueField:"CaID"},{xtype:"button",itemId:"CMS_MYINPT_ClearBtn",ui:"confirm",width:"90px",text:"清除"},{xtype:"button",itemId:"CMS_MYINPT_QueryBtn",right:"10px",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"toolbar",docked:"top",itemId:"CMS_MYINPT_Toolbar2",items:[{xtype:"datepickerfield",itemId:"CMS_MYINPT_BegDatePicker",width:"26%",label:"收案日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"CMS_MYINPT_EndDatePicker",width:"20%",label:"~",labelWidth:"15%",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"selectfield",itemId:"CmsMyInPtProcessWay",label:"治療",options:[{text:"",value:""},{text:"治療中",value:"1"},{text:"追蹤中",value:"6"},{text:"未治療",value:"0"}]},{xtype:"selectfield",itemId:"CmsMyInPtInStatus",label:"狀態",options:[{text:"收案",value:"1"},{text:"結案",value:"2"}]}]},{xtype:"panel",flex:1.5,itemId:"CMS_MyInPt_MainPanel"}]}],listeners:[{fn:"onCmsMyInPtCaClassificationChange",event:"change",delegate:"#CmsMyInPtCaClassification"},{fn:"onCMS_MYINPT_ClearBtnTap",event:"tap",delegate:"#CMS_MYINPT_ClearBtn"},{fn:"onCMS_MYINPT_QueryBtnTap",event:"tap",delegate:"#CMS_MYINPT_QueryBtn"},{fn:"onCMS_REG_REGDatePickerChange",event:"change",delegate:"#CMS_MYINPT_BegDatePicker"},{fn:"onCMS_REG_REGDatePickerChange1",event:"change",delegate:"#CMS_MYINPT_EndDatePicker"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCmsMyInPtCaClassificationChange:function(a,e,b,d){},onCMS_MYINPT_ClearBtnTap:function(f,h,d){this.down("#CMS_MYINPT_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());this.down("#CmsMyInPtCaClassification").setValue("");this.down("#CmsMyInPtCaType").setValue("");this.down("#CMS_MYINPT_BegDatePicker").setValue("");this.down("#CMS_MYINPT_EndDatePicker").setValue("");this.down("#CmsMyInPtProcessWay").setValue("");this.down("#CmsMyInPtInStatus").setValue("1");this.down("#CMS_MYINPT_EndDatePicker").setValue(new Date());this.down("#CMS_MYINPT_BegDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));Ext.getStore("sCmsMyInPatients").removeAll();Ext.getStore("sSysCaClassification").clearFilter();Ext.getStore("sSysCaTypes").clearFilter();var a=this;var b=Ext.getCmp("CMS_MyInPatGrid");if(!Ext.isEmpty(b)){b.destroy();b=null}if(b==null){b=NisTRApp.view.GridUtility.GenCMSInPatientGrid("CMS_MyInPatGrid","個管病人",null,false);b.initialFlag=true;b.getTitleBar().hide();var g=Ext.getStore("sCmsMyInPatients");b.setStore(g);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,b);this.down("#CMS_MyInPt_MainPanel").add(b);b=null;delete b;g=null;delete g}a=null;delete a},onCMS_MYINPT_QueryBtnTap:function(b,d,a){this.LoadPatientList()},onCMS_REG_REGDatePickerChange:function(d,a,e,b){if(!this.getInitialFlag()){}},onCMS_REG_REGDatePickerChange1:function(d,a,e,b){if(!this.getInitialFlag()){}},onContainerDestroy:function(a){if(Ext.getStore("sCmsMyInPatients")!=null){Ext.getStore("sCmsMyInPatients").removeAll();Ext.getStore("sCmsMyInPatients").destroy()}console.log("On Destroy :","CMS_MyInPatients");this.removeAll(true,true)},onContainerPainted:function(b,a){if(!Ext.getStore("sSysCaClassification").isLoading()&&Ext.getStore("sSysCaClassification").getCount()<=0){Ext.getStore("sSysCaClassification").load();this.down("#CmsMyInPtCaClassification").setStore(Ext.getStore("sSysCaClassification"))}if(!Ext.getStore("sSysCaTypes").isLoading()&&Ext.getStore("sSysCaTypes").getCount()<=0){Ext.getStore("sSysCaTypes").load();this.down("#CmsMyInPtCaType").setStore(Ext.getStore("sSysCaTypes"))}if(this.getInitialFlag()){this.down("#CMS_MYINPT_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);this.down("#CMS_MYINPT_UserId").setStore(Ext.getStore("sCmsNurses"));this.down("#CMS_MYINPT_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());this.down("#CmsMyInPtCaClassification").setValue("");this.down("#CmsMyInPtCaType").setValue("");this.down("#CMS_MYINPT_BegDatePicker").setValue("");this.down("#CMS_MYINPT_EndDatePicker").setValue("");this.down("#CmsMyInPtProcessWay").setValue("");this.down("#CmsMyInPtInStatus").setValue("1");this.down("#CMS_MYINPT_EndDatePicker").setValue(new Date());this.down("#CMS_MYINPT_BegDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-3));this.initialStore();this.down("#CmsMyInPtCaClassification").setStore(Ext.getStore("sSysCaClassification"));this.down("#CmsMyInPtCaType").setStore(Ext.getStore("sSysCaTypes"));var a=this;var b=Ext.getCmp("CMS_MyInPatGrid");if(b==null){b=NisTRApp.view.GridUtility.GenCMSInPatientGrid("CMS_MyInPatGrid","個管病人",null,false);b.initialFlag=true;b.getTitleBar().hide();var d=Ext.getStore("sCmsMyInPatients");b.setStore(d);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,b);this.down("#CMS_MyInPt_MainPanel").add(b);b=null;delete b;d=null;delete d}a=null;delete a},LoadPatientList:function(){if(Ext.getStore("sCmsMyInPatients").isLoading()){return}var a=Ext.getStore("sCmsMyInPatients");a.removeAll();a.getProxy().setExtraParams({CAClassification:this.down("#CmsMyInPtCaClassification").getValue(),CAType:this.down("#CmsMyInPtCaType").getValue(),BegDate:this.down("#CMS_MYINPT_BegDatePicker").getFormattedValue("Ymd"),EndDate:this.down("#CMS_MYINPT_EndDatePicker").getFormattedValue("Ymd"),ProcessWay:this.down("#CmsMyInPtProcessWay").getValue(),InStatus:this.down("#CmsMyInPtInStatus").getValue(),UserID:this.down("#CMS_MYINPT_UserId").getValue()});a.load();a=null;delete a},initialStore:function(){if(Ext.getStore("sCmsMyInPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.CmsdatmData",storeId:"sCmsMyInPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:60000,url:SYS_CONST.ApiRoot+"CMS/search/SearchPatient.ashx",reader:{type:"jsonHtmlDecode"}}})}}});Ext.define("NisTRApp.view.CMS.Treatment.RT",{extend:Ext.Container,config:{initialFlag:true,stopDistroyEvent:true,updateFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},treatRT:{},items:[{xtype:"panel",itemId:"CmsTreatRTIndex",layout:{type:"fit"},items:[{xtype:"panel",itemId:"GridPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"RefreshBtn",ui:"decline",width:"120px",iconCls:"refresh",text:"重新整理"},{xtype:"button",itemId:"CreatBtn",right:"10px",ui:"decline",width:"120px",iconCls:"add",text:"新 增"}]}]},{xtype:"panel",hidden:true,itemId:"FormPanel",layout:{type:"hbox"},items:[{xtype:"panel",flex:1.1,itemId:"FormEditPanel",layout:{type:"vbox"},scrollable:"vertical"},{xtype:"panel",fnFlag:0,flex:1,hidden:true,itemId:"FormGridPanel"},{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"BackBtn",ui:"confirm-back",width:"120px",text:"回 上 頁"}]}]}]}],listeners:[{fn:"onRefreshBtnTap",event:"tap",delegate:"#RefreshBtn"},{fn:"onCreatBtnTap",event:"tap",delegate:"#CreatBtn"},{fn:"onBackBtnTap",event:"tap",delegate:"#BackBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRefreshBtnTap:function(b,d,a){this.LoadData()},onCreatBtnTap:function(b,d,a){this.CreatFormEditPanel(this,null)},onBackBtnTap:function(b,d,a){this.down("#FormEditPanel").removeAll();this.down("#FormGridPanel").removeAll(true,true);this.ActiveChange(this.down("#CmsTreatRTIndex"),"GridPanel");this.setTreatRT(null);if(this.getUpdateFlag()){this.setUpdateFlag(false);this.LoadData()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sTreatRT"))){Ext.getStore("sTreatRT").removeAll();Ext.getStore("sTreatRT").destroy()}if(!Ext.isEmpty(Ext.getStore("sTreatRTTXDetial"))){Ext.getStore("sTreatRTTXDetial").removeAll();Ext.getStore("sTreatRTTXDetial").destroy()}if(!Ext.isEmpty(Ext.getStore("sTreatRTTX"))){Ext.getStore("sTreatRTTX").removeAll();Ext.getStore("sTreatRTTX").destroy()}console.log("On Destroy :","CMS.Treat.RT");this.removeAll()},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadData();this.setInitialFlag(false)}},initialize:function(){this.callParent();this.InitialStore();var b=Ext.getCmp("CMS_TreatRTGrid");if(b==null){b=this.GenTreatRTGrid("CMS_TreatRTGrid","CMS_TreatRTGrid",null,false);b.initialFlag=true;b.caller=this;b.getTitleBar().hide();var a=Ext.getStore("sTreatRT");b.setStore(a);b.addListener("itemtap",this.ItemSingleTapGrid,b);this.down("#GridPanel").add(b);b=null;delete b;sTreatChm=null;delete sTreatChm}myThis=null;delete myThis},ActiveChange:function(b,a){NisTRApp.view.Misc.PanelChange(b,a,this)},CreatFormEditPanel:function(d,a){d.down("#FormEditPanel").removeAll();d.down("#FormGridPanel").removeAll(true,true);d.setUpdateFlag(false);d.down("#FormGridPanel").fnFlag=0;d.down("#FormGridPanel").setHidden(true);d.down("#FormEditPanel").add(this.CreTreatField());lab=d.CreTreatRTItem();d.down("#FormEditPanel").add(lab);lab.setRecord(d.getRecord());d.ActiveChange(d.down("#CmsTreatRTIndex"),"FormPanel");var b=NisTRApp.view.SysUtility.tapEventName();if(Ext.isEmpty($("#_cmsTreatRTSaveBtn")[0])){var e=$('<img src="../_/img/save01.png" id="_cmsTreatRTSaveBtn" style="width:28px;height:28px;">');e.unbind(b);e.bind(b,{caller:this,callbackFn:null},function(f){try{f.data.caller.SaveTreatRT(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsRTTreatContracDiv"));e=$('<span style="float:right;" ><button align="right" id="_cmsTreatRTSaveBtn2" type="button">放射治療記錄</button></span>');e.unbind(b);e.bind(b,{caller:d,panel:null},function(f){try{f.data.caller.CrePlanItem(f.data.caller,2)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsRTTreatContracDiv"));e=null;delete e;b=null;delete b}if(!Ext.isEmpty(a)){d.applyData(a)}else{d.setTreatRT(null)}b=null;delete b},GenTreatRTGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="EDIT_CHECK_{KeyOne}">編 輯</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DELETETREATRT_CHECK_{KeyOne}" style="border:3px orange double;background-color:red;">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"編輯日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.ModifyDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.TimeFormat(values.ModifyTime)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {ModifyUserName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"治療目的",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {PurposeName}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false},{text:"CourseID",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {CourseID}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"Plan",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {PlanSetupID}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"XRT Start Date",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.MinTxDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"XRT End Date",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.MaxTxDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"次數",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {FractionNO}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"Dose",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {Dose}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false}]})},ItemSingleTapGrid:function(k,f,g,b,h,j){var a=function a(e,n){e.caller.importRTTX(n,e.caller,null)};var d=function d(e,n){e.caller.CreatFormEditPanel(e.caller,n)};var l=function l(e,n){Ext.Msg.confirm("Confirm","是否刪除記錄",function(p,r,o){if(p=="no"){return}else{if(p=="yes"){var q=e.caller;q.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentRTDelete.ashx",scope:e.caller,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),RtID:n.data.RtID},success:function(s){q.setMasked(false);var u=Ext.decode(s.responseText);NisTRApp.view.Misc.Alert(u.Message,(u.Success?800:0));if(u.Success){n.destroy();e.refresh()}u=null;delete u;q=null;delete q;scFn=null;delete scFn},failure:function(){q.setMasked(false);q=null;delete q}})}}},e.caller)};var m=h.event.target.id.split("_");if(null==m||m.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"||h.event.target.nodeName=="BUTTON"){switch(m[0]){case"COURSEID":NisTRApp.view.Misc.MsgShow(b.data.CourseID,"",2500);break;case"PLANSETUPID":NisTRApp.view.Misc.MsgShow(b.data.PlanSetupID,"",2500);break;case"ADD":a(k,b);break;case"EDIT":d(k,b);break;case"DELETETREATRT":l(k,b);break;default:break}h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}m=null;delete m;k=null;delete k;a=null;delete a;d=null;delete d;l=null;delete l;return false},CreTreatField:function(){var f=function f(h,j,g){this.timeField.setValue(new Date())};var e=function e(h,j,g){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"CmsRTTreatFieldSet",width:"95%",title:'<div id="CmsRTTreatContracDiv">Treatment Information</div>',layout:"fit",centered:false});var d=Ext.create("Ext.field.Select",{itemId:"Purpose",label:"治療目的",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"CCRT",value:"4"},{text:"Radiationtherapy",value:"6"},{text:"Others",value:"99"},],style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(j,h,g){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(h!="99");if(h!="99"){this.remarkField.setValue("")}}}}});b.add(d);var a=Ext.create("Ext.field.Text",{itemId:"PurposeOther",label:"治療目的其他",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,placeHolder:"最多128字",style:"float:left;font-size:16px;"});b.add(a);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.Purpose)&&this.getRecord().data.Purpose=="99"));d.remarkField=a;a=Ext.create("Ext.field.Text",{itemId:"CourseID",label:"CourseID",labelWidth:"26%",width:"99%",maxLength:128,hidden:false,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"PlanSetupID",label:"Plan",labelWidth:"26%",width:"99%",maxLength:128,hidden:false,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("XRTStartDate","XRTStartDate","XRT Start Date","50%","75%",null);b.add(a);a.setReadOnly(false);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("XRTStartDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("XRTStartDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));a=NisTRApp.view.DateUtil.CreatDateField("XRTEndDate","XRTEndDate","XRT End Date","50%","75%",null);b.add(a);a.setReadOnly(false);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("XRTEndDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("XRTEndDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));a=Ext.create("Ext.field.Text",{itemId:"FractionNO",label:"次數",labelWidth:"26%",width:"99%",maxLength:24,hidden:false,readOnly:false,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"DocName",label:"醫師",labelWidth:"26%",width:"99%",maxLength:24,hidden:false,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"Dose",label:"Dose",labelWidth:"26%",width:"99%",maxLength:24,hidden:false,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);d=Ext.create("Ext.field.Select",{itemId:"EndReason",label:"Reason Treatment Ended ",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"Treatment completed per protocol criteria",value:"1"},{text:"Disease progression, relapse during active treatment",value:"2"},{text:"Adverse event (side effects、complications)",value:"3"},{text:"Death on study",value:"4"},{text:"Patient withdrawal：refusal after beginning protocol therapy",value:"5"},{text:"Patient withdrawal：refusal prior beginning protocol therapy",value:"6"},{text:"Alternative therapy",value:"7"},{text:"Patient off-treatment for other complicating disease",value:"8"},{text:"Lost to follow-up",value:"9"},{text:"Disease progression before active treatment",value:"10"},{text:"Others",value:"99"},],style:"float:left;font-size:16px;",remarkField:null,listeners:{change:function(j,h,g){if(!Ext.isEmpty(this.remarkField)){this.remarkField.setHidden(h!="99");if(h!="99"){this.remarkField.setValue("")}}}}});b.add(d);var a=Ext.create("Ext.field.Text",{itemId:"EndReasonOther",label:"其他",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,placeHolder:"最多128字",style:"float:left;font-size:16px;"});b.add(a);a.setHidden(!(!Ext.isEmpty(this.getRecord().data.EndReason)&&this.getRecord().data.EndReason=="99"));d.remarkField=a;a=null;delete a;d=null;delete d;f=null;delete f;e=null;delete e;return b},CrePlanItem:function(f,a){var d=f.down("#FormGridPanel");if(d.fnFlag==a){d.fnFlag=a;d.setHidden(!d.isHidden());return}d.fnFlag=a;d.removeAll();if(d.fnFlag==2){var j=d.down("#QueryRTToolBar");if(!Ext.isEmpty(j)){j.destroy();j=null}if(Ext.isEmpty(j)){j=Ext.create("Ext.Toolbar",{itemId:"QueryRTToolBar",docked:"top"});j.add(NisTRApp.view.DateUtil.CreatDateField("RTTXBegDate","RTTXBegDate","啟日","45px","190px",null));j.add(NisTRApp.view.DateUtil.CreatDateField("RTTXEndDate","RTTXEndDate"," ~ ","25px","170px",null));j.down("#RTTXEndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));j.down("#RTTXBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-6));var h=Ext.create("Ext.Button",{itemId:"QueryRTBtn",width:"90px",text:"查詢"});j.add(h);h.addListener("tap",function(l,m,k){this.LoadRTTX()},f);d.add(j)}var b=f;var g=Ext.getCmp("CMS_TreatRXTXRecordGird");if(!Ext.isEmpty(g)){g.destroy();g=null}if(g==null){g=f.GenGrid("CMS_TreatRXTXRecordGird","TreatRXTXGrid",null,false);g.initialFlag=true;g.caller=f;g.getTitleBar().hide();var e=Ext.getStore("sTreatRTTX");g.setStore(e);g.addListener("itemtap",f.ItemSingleTapGrid,g);d.add(g);g=null;delete g;e=null;delete e}f1=null;delete f1}if(d.isHidden()){f.LoadRTTX()}d.setHidden(!d.isHidden());f1=null;delete f1;fieldSet=null;delete fieldSet;d=null;delete d},LoadRTTX:function(){if(Ext.getStore("sTreatRTTX").isLoading()||Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();var b=Ext.getStore("sTreatRTTX");var a=this.down("#RTTXEndDate").getValue();var d=this.down("#RTTXBegDate").getValue();b.getProxy().setExtraParams({ChartNo:e.data.ChartNO,BegDate:d,EndDate:a});b.removeAll();b.load({callback:function(g,f,h){},scope:this});e=null;delete e;b=null;delete b},GenGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:" ",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"><a id="ADD_RTTX_{KeyOne}" name="ADD_RTTX" class="link-btn">IMPORT</a></span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"CourseID",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"COURSEID_SPAN",values.CourseID, "14px", 16, values.StyleColor, "COURSEID_IMG","handPoint.png","25","25" )]}'),flex:1,width:180,hidden:false,editable:false,sortable:false},{text:"Plan",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"PLANSETUPID_SPAN",values.PlanSetupID, "14px", 16, values.StyleColor, "PLANSETUPID_IMG","handPoint.png","25","25" )]}'),flex:1,width:150,hidden:false,editable:false,sortable:false},{text:"XRT Start Date",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.MinTxDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"XRT End Date",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.MaxTxDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"治療醫師",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DocName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"次數",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{FractionNO}</span>',flex:1,width:130,hidden:false,editable:false,sortable:false},{text:"Dose",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{Dose}</span>',flex:1,width:130,hidden:false,editable:false,sortable:false}]})},applyData:function(b){this.setTreatRT(b);if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.data)){var a=b.data;this.down("#Purpose").setValue(a.Purpose);this.down("#PurposeOther").setValue(a.PurposeOther);this.down("#EndReason").setValue(a.EndReason);this.down("#EndReasonOther").setValue(a.EndReasonOther);this.importRTTX(b,this)}},importRTTX:function(f,a){if(!Ext.isEmpty(f)&&!Ext.isEmpty(f.data)){var b=f.data;a.down("#CourseID").setValue(b.CourseID);a.down("#PlanSetupID").setValue(b.PlanSetupID);if(!Ext.isEmpty(b.MinTxDate)){var e=NisTRApp.view.DateUtil.StrToDateTime(b.MinTxDate);a.down("#XRTStartDate").setValue(e)}if(!Ext.isEmpty(b.MaxTxDate)){var e=NisTRApp.view.DateUtil.StrToDateTime(b.MaxTxDate);a.down("#XRTEndDate").setValue(e)}a.down("#FractionNO").setValue(b.FractionNO);a.down("#DocName").setValue(b.DocName);a.down("#Dose").setValue(b.Dose);a.LoadRTTXDetial(b.ChartNO,b.CourseID,b.PlanSetupID,a)}},LoadRTTXDetial:function(e,f,b,d){if(Ext.getStore("sTreatRTTXDetial").isLoading()||Ext.isEmpty(e)){return}var a=Ext.getStore("sTreatRTTXDetial");a.getProxy().setExtraParams({ChartNo:e,CourseID:f,PlanSetupID:b});a.removeAll();a.load({callback:function(h,g,j){},scope:d});a=null;delete a},CreTreatRTItem:function(){return Ext.create("Ext.Label",{itemId:"TreatItems",width:"95%",html:'<div id="CmsTreatRTTreatItemsDiv">Agent</div>',tpl:Ext.create("Ext.XTemplate",'<div id="_CmsTreatRTTreatData" class="smallList" >','<table id="_CmsTreatRTTreatTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",' <th colspan="6" style="text-align:left">Agent<span>&nbsp;&nbsp;&nbsp;&nbsp;</span></th>          ',"        </tr>","        <tr>",'            <th width="15%">次數</th>','            <th width="15%">日期</th>','            <th width="15%">Dose</th>','            <th width="15%">醫師</th>','            <th width="20%">Aim</th>','            <th width="20%">Planning Technique</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"                <tr>","     ",'                    <td width="15%" align="center">{FractionNO} / {NoOfFractions}</td>','                    <td width="15%" align="center"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.TxDate)]}</td>','                    <td width="15%" align="center">{DeliveredDose} / {RxDose}</td>','                    <td width="15%" align="center">{DocName}</td>','                    <td width="20%"  align="center">{IntentType}</td>','                    <td width="20%"  align="center">{Technique}</td>',"                </tr> ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="15%">次數</th>','            <th width="15%">日期</th>','            <th width="15%">Dose</th>','            <th width="15%">醫師</th>','            <th width="20%">Aim</th>','            <th width="20%">Planning Technique</th>',"            </tr>","            </tfoot> ","            </table>","            </div>","")})},InitialStore:function(){if(Ext.data.ModelManager.getModel("mTreatRTTX")==null){Ext.define("mTreatRTTX",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"CourseID",type:"string"},{name:"PlanSetupID",type:"string"},{name:"MaxFractionNO",type:"string"},{name:"NoOfFractions",type:"int"},{name:"DocNO",type:"string"},{name:"DocName",type:"string"},{name:"MaxRxDose",type:"string"},{name:"DeliveredDose",type:"string"},{name:"MinTxDate",type:"string"},{name:"MaxTxDate",type:"string"},{name:"XordNO",type:"string"},{name:"FractionNO",type:"string"},{name:"Dose",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.CourseID+"_"+b.data.PlanSetupID},name:"KeyOne",type:"string"}],idProperty:"KeyOne"}})}if(Ext.data.ModelManager.getModel("mTreatRTTXDetial")==null){Ext.define("mTreatRTTXDetial",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"CourseID",type:"string"},{name:"PlanSetupID",type:"string"},{name:"FractionNO",type:"string"},{name:"NoOfFractions",type:"int"},{name:"DocNO",type:"string"},{name:"DocName",type:"string"},{name:"RxDose",type:"string"},{name:"DeliveredDose",type:"string"},{name:"TxDate",type:"string"},{name:"XordNO",type:"string"},{name:"Technique",type:"string"},{name:"IntentType",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.CourseID+"_"+b.data.PlanSetupID},name:"KeyOne",type:"string"}],idProperty:"KeyOne"}})}if(Ext.data.ModelManager.getModel("mTreatRTTXDetials")==null){Ext.define("mTreatRTTXDetials",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"CourseID",type:"string"},{name:"PlanSetupID",type:"string"}],hasMany:[{associatedName:"Records",associationKey:"Records",model:"mTreatRTTXDetials",foreignKey:"Records",name:"Records"},{associationKey:"Records",primaryKey:"Seq",model:"mTreatRTTXDetial",name:"records"}]}})}if(Ext.getStore("sTreatRTTX")==null){Ext.create("Ext.data.Store",{model:"mTreatRTTX",storeId:"sTreatRTTX",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryRTTX.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.getStore("sTreatRTTXDetial")==null){Ext.create("Ext.data.Store",{model:"mTreatRTTXDetials",storeId:"sTreatRTTXDetial",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryRTTXDetial.ashx",reader:{type:"jsonHtmlDecode"}}})}Ext.getStore("sTreatRTTXDetial").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sTreatRTTXDetial").addListener("load",function(d,b,f,a,e){this.setMasked(false);this.RenderRTTXDetialTable(this,this.getRecord())},this);if(Ext.data.ModelManager.getModel("mTreatRT")==null){Ext.define("mTreatRT",{extend:Ext.data.Model,config:{fields:[{name:"MaxFractionNO",type:"string"},{name:"NoOfFractions",type:"int"},{name:"DocNO",type:"string"},{name:"DocName",type:"string"},{name:"MaxRxDose",type:"string"},{name:"DeliveredDose",type:"string"},{name:"MinTxDate",type:"string"},{name:"MaxTxDate",type:"string"},{name:"FractionNO",type:"string"},{name:"Dose",type:"string"},{name:"CmsID",type:"string"},{name:"ChartNO",type:"string"},{name:"RtID",type:"string"},{name:"Purpose",type:"string"},{name:"PurposeOther",type:"string"},{name:"CourseID",type:"string"},{name:"PlanSetupID",type:"string"},{name:"XRTStartDate",type:"string"},{name:"XRTEndDate",type:"string"},{name:"EndReason",type:"string"},{name:"EndReasonOther",type:"string"},{name:"ModifyUserID",type:"string"},{name:"ModifyUserName",type:"string"},{name:"ModifyDate",type:"string"},{name:"ModifyTime",type:"string"},{convert:function(a,b){return b.data.RtID},name:"KeyOne",type:"string"},{convert:function(d,e){var a="";try{switch(e.data.Purpose){case"1":a="Neoadjuvant chemotherapy";break;case"2":a="Adjuvant chemotherapy";break;case"3":a="Chemotherapy";break;case"4":a="CCRT";break;case"5":a="Chemotherapy, NOS";break;case"6":a="Radiationtherapy";break;case"99":a=e.data.PurposeOther;break;default:a=""}return a}catch(b){return""}},name:"PurposeName",type:"string"}],idProperty:"KeyOne"}})}if(Ext.getStore("sTreatRT")==null){Ext.create("Ext.data.Store",{model:"mTreatRT",storeId:"sTreatRT",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatRT.ashx",reader:{type:"jsonHtmlDecode"}}})}},RenderRTTXDetialTable:function(b,e){if(Ext.isEmpty(b)||Ext.isEmpty(b.down("#TreatItems"))){return false}var a=Ext.getStore("sTreatRTTXDetial");b.down("#TreatItems").setHtml("");if(a.getCount()>0){if(!Ext.isEmpty(b)&&!Ext.isEmpty(b.down("#TreatItems"))){b.down("#TreatItems").setHtml("");if(!Ext.isEmpty(a.getAt(0))){var d=b.down("#TreatItems").getTpl().apply(a.getAt(0).data);b.down("#TreatItems").setHtml(d);d=null;delete d}}}a=null;delete a},SaveTreatRT:function(d,a){d.setUpdateFlag(true);var h=d.getRecord();var b=d.getTreatRT();var g=(!Ext.isEmpty(b)&&!Ext.isEmpty(b.data)&&!Ext.isEmpty(b.data.RtID))?b.data.RtID:"";var e={RtID:g,CmsID:h.data.CmsID,ChartNO:h.data.ChartNO,Purpose:d.down("#Purpose").getValue(),PurposeOther:d.down("#PurposeOther").getValue(),CourseID:d.down("#CourseID").getValue(),PlanSetupID:d.down("#PlanSetupID").getValue(),XRTStartDate:d.down("#XRTStartDate").getFormattedValue("Ymd"),XRTEndDate:d.down("#XRTEndDate").getFormattedValue("Ymd"),EndReason:d.down("#EndReason").getValue(),EndReasonOther:d.down("#EndReasonOther").getValue(),FreqOfFracions:d.down("#FractionNO").getValue()};var f=d;f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentRTUpdate.ashx",scope:d,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),RtID:g,CmsID:h.data.CmsID,ChartNO:h.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(e)))},success:function(k){f.setMasked(false);var l=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){var j=f.getTreatRT();if(Ext.isEmpty(j)||Ext.isEmpty(j.data)||Ext.isEmpty(j.data.RtID)){j=Ext.create("mTreatRT",{CmsID:l.CmsID,RtID:l.ChmID});f.setTreatRT(j)}j=null;delete j}l=null;delete l;f=null;delete f;scFn=null;delete scFn},failure:function(){f.setMasked(false);f=null;delete f}});e=null;delete e;b=null;delete b;h=null;delete h},LoadData:function(){if(Ext.getStore("sTreatRT").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sTreatRT");a.getProxy().setExtraParams({ChartNo:b.data.ChartNO,CmsID:b.data.CmsID});a.removeAll();a.load({callback:function(e,d,f){},scope:this});b=null;delete b;a=null;delete a}});Ext.define("NisTRApp.view.WorkList.CMS.IpbPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_IPB_MainPanel",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"bottom",itemId:"CMS_IPB_Toolbar",items:[{xtype:"textfield",itemId:"CMS_IPB_UserId",width:260,label:"員工編號",placeHolder:"員工編號"},{xtype:"button",itemId:"CMS_IPB_QueryBtn",ui:"decline",width:"90px",text:"查詢"}]},{xtype:"panel",flex:1.5,itemId:"CMS_IPB_MainPanel"}]}],listeners:[{fn:"onCMS_IPB_QueryBtnTap",event:"tap",delegate:"#CMS_IPB_QueryBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCMS_IPB_QueryBtnTap:function(b,d,a){this.LoadPatientList()},onContainerDestroy:function(a){if(Ext.getStore("sCmsIpbPatients")!=null){Ext.getStore("sCmsIpbPatients").removeAll();Ext.getStore("sCmsIpbPatients").destroy()}console.log("On Destroy :","CMS_IpbPatients");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPatientList();this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);this.down("#CMS_IPB_UserId").setValue(NisTRApp.view.SysUtility.GetUserID());this.initialStore();var a=this;var d=Ext.getCmp("CMS_IPBPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenCMSIpbPatientGrid("CMS_IPBPatGrid","住院病人",null,false);d.initialFlag=true;d.getTitleBar().hide();var e=Ext.getStore("sCmsIpbPatients");d.setStore(e);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCMSDiscoverGrid,d);this.down("#CMS_IPB_MainPanel").add(d);d.addListener("painted",NisTRApp.view.UserConfig.onPainted_CmsIpbPatGrid,d);var b=d.down('button[text = "Done"]');b.addListener("tap",NisTRApp.view.UserConfig.onTap_CmsIpbPatGrid,d);d=null;delete d;e=null;delete e}a=null;delete a},LoadPatientList:function(){if(Ext.getStore("sCmsIpbPatients").isLoading()){return}if(Ext.isEmpty(this.down("#CMS_IPB_UserId").getValue())){NisTRApp.view.Misc.Alert("請輸入員工編號",800);Ext.getStore("sCmsIpbPatients").removeAll();return}var a=Ext.getStore("sCmsIpbPatients");var b=this.down("#CMS_IPB_UserId").getValue();a.removeAll();a.getProxy().setExtraParams({UserID:b});a.load();a=null;delete a;b=null;delete b},initialStore:function(){if(Ext.data.ModelManager.getModel("mCmsIpbData")==null){Ext.define("mCmsIpbData",{extend:NisTRApp.model.CMS.CmsdatmData,config:{fields:[{name:"NowStationNo",type:"string"},{name:"NowBedNo",type:"string"},{name:"DocName",type:"string"},]}})}if(Ext.getStore("sCmsIpbPatients")==null){Ext.create("Ext.data.Store",{model:"mCmsIpbData",storeId:"sCmsIpbPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/search/QueryCmsMyIpbPat.ashx",reader:{type:"jsonHtmlDecode"}}})}}});Ext.define("NisTRApp.view.CMS.Treatment.Hormone",{extend:Ext.Container,config:{initialFlag:true,stopDistroyEvent:true,updateFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},treatHormone:{},items:[{xtype:"panel",itemId:"CmsTreatHormoneIndex",layout:{type:"fit"},items:[{xtype:"panel",itemId:"GridPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"RefreshBtn",ui:"decline",width:"120px",iconCls:"refresh",text:"重新整理"},{xtype:"button",itemId:"CreatBtn",right:"10px",ui:"decline",width:"120px",iconCls:"add",text:"新 增"}]}]},{xtype:"panel",hidden:true,itemId:"FormPanel",layout:{type:"hbox"},items:[{xtype:"panel",flex:1.1,itemId:"FormEditPanel",layout:{type:"vbox"},scrollable:"vertical"},{xtype:"panel",fnFlag:0,flex:1,itemId:"FormGridPanel"},{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"BackBtn",ui:"confirm-back",width:"120px",text:"回 上 頁"}]}]}]}],listeners:[{fn:"onRefreshBtnTap",event:"tap",delegate:"#RefreshBtn"},{fn:"onCreatBtnTap",event:"tap",delegate:"#CreatBtn"},{fn:"onBackBtnTap",event:"tap",delegate:"#BackBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRefreshBtnTap:function(b,d,a){this.LoadData()},onCreatBtnTap:function(b,d,a){this.CreatFormEditPanel(this,null)},onBackBtnTap:function(b,d,a){this.down("#FormEditPanel").removeAll();this.down("#FormGridPanel").removeAll(true,true);this.ActiveChange(this.down("#CmsTreatHormoneIndex"),"GridPanel");this.setTreatHormone(null);if(this.getUpdateFlag()){this.setUpdateFlag(false);this.LoadData()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sTreatHormoneOrd"))){Ext.getStore("sTreatHormoneOrd").removeAll();Ext.getStore("sTreatHormoneOrd").destroy()}if(!Ext.isEmpty(Ext.getStore("sTreatHormone"))){Ext.getStore("sTreatHormone").removeAll();Ext.getStore("sTreatHormone").destroy()}console.log("On Destroy :","CMS.Treat.Hormone");this.removeAll()},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadData();this.setInitialFlag(false)}},CreatFormEditPanel:function(d,b){d.down("#FormEditPanel").removeAll();d.down("#FormGridPanel").removeAll(true,true);d.setUpdateFlag(false);d.down("#FormGridPanel").fnFlag=0;d.down("#FormGridPanel").setHidden(true);d.down("#FormEditPanel").add(this.CreTreatField());d.ActiveChange(d.down("#CmsTreatHormoneIndex"),"FormPanel");var a=NisTRApp.view.SysUtility.tapEventName();if(Ext.isEmpty($("#_cmsTreatHormoneSaveBtn")[0])){var e=$('<img src="../_/img/save01.png" id="_cmsTreatHormoneSaveBtn" style="width:28px;height:28px;">');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.SaveTreatHormone(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsHormoneTreatContracDiv"));e=$('<span style="float:right;" ><button align="right" id="_cmsTreatHormoneSaveBtn2" type="button">荷爾蒙用藥</button></span>');e.unbind(a);e.bind(a,{caller:d,panel:null},function(f){try{f.data.caller.CrePlanItem(f.data.caller,2)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsHormoneTreatContracDiv"));e=null;delete e;a=null;delete a}if(!Ext.isEmpty(b)){d.applyData(b)}else{d.setTreatHormone(null)}a=null;delete a},ActiveChange:function(b,a){NisTRApp.view.Misc.PanelChange(b,a,this)},CreTreatField:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"CmsCHMTreatFieldSet",width:"95%",title:'<div id="CmsHormoneTreatContracDiv">Treatment Cycle Information</div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Text",{itemId:"CodeNO",label:"CodeNO",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"DocNO",label:"DocNO",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"ChartSeq",label:"ChartSeq",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"InpNO",label:"InpNO",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"OrddRid",label:"OrddRid",labelWidth:"26%",width:"99%",maxLength:128,hidden:true,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"CodeName",label:"藥物名稱",labelWidth:"26%",width:"99%",maxLength:128,hidden:false,readOnly:true,placeHolder:"系統帶入，請點選",style:"float:left;font-size:16px;"});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("BegDate","BegDate","開始服用日期","50%","75%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("BegDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("BegDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=NisTRApp.view.DateUtil.CreatDateField("EndDate","EndDate","停止服用日期","50%","75%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("EndDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("EndDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=Ext.create("Ext.field.Text",{itemId:"ReasonOther",label:"其他說明",labelWidth:"26%",width:"99%",maxLength:128,hidden:false,placeHolder:"最多128字",style:"float:left;font-size:16px;"});b.add(a);a=null;delete a;e=null;delete e;d=null;delete d;return b},CrePlanItem:function(f,a){var d=f.down("#FormGridPanel");if(d.fnFlag==a){d.fnFlag=a;d.setHidden(!d.isHidden());return}d.fnFlag=a;d.removeAll();if(d.fnFlag==2){var j=d.down("#QueryHormoneToolBar");if(!Ext.isEmpty(j)){j.destroy();j=null}if(Ext.isEmpty(j)){j=Ext.create("Ext.Toolbar",{itemId:"QueryHormoneToolBar",docked:"top"});j.add(NisTRApp.view.DateUtil.CreatDateField("OrdBegDate","OrdBegDate","啟日","45px","190px",null));j.add(NisTRApp.view.DateUtil.CreatDateField("OrdEndDate","OrdEndDate"," ~ ","25px","170px",null));j.down("#OrdEndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));j.down("#OrdBegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-6));var h=Ext.create("Ext.Button",{itemId:"QueryHormoneBtn",width:"90px",text:"查詢"});j.add(h);h.addListener("tap",function(l,m,k){this.LoadHormoneOrd()},f);d.add(j)}var b=f;var g=Ext.getCmp("CMS_TreatHormoneRecordGird");if(!Ext.isEmpty(g)){g.destroy();g=null}if(g==null){g=f.GenOrdGrid("CMS_TreatHormoneRecordGird","TreatHormoneRecordGird",null,false);g.initialFlag=true;g.caller=f;g.getTitleBar().hide();var e=Ext.getStore("sTreatHormoneOrd");g.setStore(e);g.addListener("itemtap",f.ItemSingleTapGrid,g);d.add(g);g=null;delete g;e=null;delete e}f1=null;delete f1}if(d.isHidden()){f.LoadHormoneOrd()}d.setHidden(!d.isHidden());f1=null;delete f1;fieldSet=null;delete fieldSet;d=null;delete d},GenOrdGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"帶入",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'<img id="IMPORT_ORDDRID_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath2(values.Checked)]}" alt="Smiley face" height="25" width="25">',{ImgPath2:function(e){if(!Ext.isEmpty(e)){return"checkbox-icon.png"}else{return"unchecked-checkbox-icon.png"}}}),width:80,hidden:false,sortable:false},{text:"醫令代碼",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{CodeNO}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"醫令名稱",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:Ext.create("Ext.XTemplate",'{[NisTRApp.view.GridUtility.StrToImg(values.KeyOne,"CODENAME_SPAN",values.CodeName, "14px", 18, values.StyleColor, "CODENAME_IMG","handPoint.png","25","25" )]}'),width:180,hidden:false,sortable:false,flex:1},{text:OPR_CONST.DrName,xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{DocName}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"起始日",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{BegDate}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false},{text:"結束日",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{EndDate}</span>',flex:1,width:80,hidden:false,editable:false,sortable:false}]})},initialStore:function(){if(Ext.data.ModelManager.getModel("mTreatHormoneOrd")==null){Ext.define("mTreatHormoneOrd",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"int"},{name:"InpNO",type:"string"},{name:"AccDate",type:"string"},{name:"OrddRid",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"DocNO",type:"string"},{name:"DocName",type:"string"},{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},{name:"ReasonOther",type:"string"},{name:"Checked",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.ChartSeq+"_"+b.data.InpNO+"_"+b.data.OrddRid},name:"KeyOne",type:"string"}],idProperty:"KeyOne"}})}if(Ext.getStore("sTreatHormoneOrd")==null){Ext.create("Ext.data.Store",{model:"mTreatHormoneOrd",storeId:"sTreatHormoneOrd",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryHormoneOrd.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.data.ModelManager.getModel("mTreatHormone")==null){Ext.define("mTreatHormone",{extend:Ext.data.Model,config:{fields:[{name:"CmsID",type:"string"},{name:"HormoneID",type:"string"},{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"string"},{name:"InpNO",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"DocNO",type:"string"},{name:"DocName",type:"string"},{name:"OrddRid",type:"string"},{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},{name:"ReasonOther",type:"string"},{name:"ModifyUserID",type:"string"},{name:"ModifyUserName",type:"string"},{name:"ModifyDate",type:"string"},{name:"ModifyTime",type:"string"},{convert:function(a,b){return b.data.HormoneID},name:"KeyOne",type:"string"}],idProperty:"KeyOne"}})}if(Ext.getStore("sTreatHormone")==null){Ext.create("Ext.data.Store",{model:"mTreatHormone",storeId:"sTreatHormone",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryTreatHormone.ashx",reader:{type:"jsonHtmlDecode"}}})}},LoadHormoneOrd:function(){if(Ext.getStore("sTreatHormoneOrd").isLoading()||Ext.isEmpty(this.getRecord())){return}var e=this.getRecord();var b=Ext.getStore("sTreatHormoneOrd");var a=this.down("#OrdEndDate").getValue();var d=this.down("#OrdBegDate").getValue();b.getProxy().setExtraParams({ChartNo:e.data.ChartNO,BegDate:d,EndDate:a});b.removeAll();b.load({callback:function(g,f,h){},scope:this});e=null;delete e;b=null;delete b},initialize:function(){this.callParent();this.initialStore();var b=Ext.getCmp("CMS_TreatHormoneFrid");if(b==null){b=this.GenTreatHormoneGrid("CMS_TreatHormoneFrid","TreatHormoneFrid",null,false);b.initialFlag=true;b.caller=this;b.getTitleBar().hide();var a=Ext.getStore("sTreatHormone");b.setStore(a);b.addListener("itemtap",this.ItemSingleTapGrid,b);this.down("#GridPanel").add(b);b=null;delete b;a=null;delete a}myThis=null;delete myThis},ItemSingleTapGrid:function(l,g,h,d,j,k){var b=function b(e,n){e.caller.importHormoneOrd(n,e.caller,null);Ext.getStore("sTreatHormoneOrd").each(function(q,o,p){q.data.Checked=""});n.data.Checked="check";e.refresh()};var f=function f(e,n){e.caller.CreatFormEditPanel(e.caller,n)};var a=function a(e,n){Ext.Msg.confirm("Confirm","是否刪除記錄",function(p,r,o){if(p=="no"){return}else{if(p=="yes"){var q=e.caller;q.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentHormoneDelete.ashx",scope:e.caller,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),HormoneID:n.data.HormoneID},success:function(s){q.setMasked(false);var u=Ext.decode(s.responseText);NisTRApp.view.Misc.Alert(u.Message,(u.Success?800:0));if(u.Success){n.destroy();e.refresh()}u=null;delete u;q=null;delete q;scFn=null;delete scFn},failure:function(){q.setMasked(false);q=null;delete q}})}}},e.caller)};var m=j.event.target.id.split("_");if(null==m||m.length<=0){j.preventDefault();return false}if(j.event.target.nodeName=="IMG"||j.event.target.nodeName=="SPAN"||j.event.target.nodeName=="A"||j.event.target.nodeName=="BUTTON"){switch(m[0]){case"IMPORT":b(l,d);break;case"EDIT":f(l,d);break;case"DELETETREATHO":a(l,d);break;default:break}j.preventDefault()}else{if(j.event.target.nodeName=="INPUT"){}}m=null;delete m;l=null;delete l;b=null;delete b;f=null;delete f;a=null;delete a;return false},importHormoneOrd:function(f,a){if(!Ext.isEmpty(f)&&!Ext.isEmpty(f.data)){var b=f.data;a.down("#CodeName").setValue(b.CodeName);a.down("#CodeNO").setValue(b.CodeNO);a.down("#DocNO").setValue(b.DocNO);a.down("#OrddRid").setValue(b.OrddRid);a.down("#ChartSeq").setValue(b.ChartSeq);a.down("#InpNO").setValue(b.InpNO);a.down("#ReasonOther").setValue(b.ReasonOther);if(!Ext.isEmpty(b.BegDate)){var e=NisTRApp.view.DateUtil.StrToDateTime(b.BegDate);a.down("#BegDate").setValue(e)}if(!Ext.isEmpty(b.EndDate)){var e=NisTRApp.view.DateUtil.StrToDateTime(b.EndDate);a.down("#EndDate").setValue(e)}}},SaveTreatHormone:function(d,b){d.setUpdateFlag(true);var h=d.getRecord();var g=d.getTreatHormone();var a=(!Ext.isEmpty(g)&&!Ext.isEmpty(g.data)&&!Ext.isEmpty(g.data.HormoneID))?g.data.HormoneID:"";var e={HormoneID:a,CmsID:h.data.CmsID,ChartNO:h.data.ChartNO,ChartSeq:d.down("#ChartSeq").getValue(),InpNO:d.down("#InpNO").getValue(),OrddRid:d.down("#OrddRid").getValue(),DocNO:d.down("#DocNO").getValue(),CodeName:d.down("#CodeName").getValue(),CodeNO:d.down("#CodeNO").getValue(),BegDate:d.down("#BegDate").getFormattedValue("Ymd"),EndDate:d.down("#EndDate").getFormattedValue("Ymd"),ReasonOther:d.down("#ReasonOther").getValue()};var f=d;f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentHormoneUpdate.ashx",scope:d,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),HormoneID:a,CmsID:h.data.CmsID,ChartNO:h.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(e)))},success:function(j){f.setMasked(false);var l=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(l.Message,(l.Success?800:0));if(l.Success){var k=f.getTreatHormone();if(Ext.isEmpty(k)||Ext.isEmpty(k.data)||Ext.isEmpty(k.data.HormoneID)){k=Ext.create("mTreatHormone",{CmsID:l.CmsID,HormoneID:l.HormoneID});f.setTreatHormone(g)}k=null;delete k}l=null;delete l;f=null;delete f;scFn=null;delete scFn},failure:function(){f.setMasked(false);f=null;delete f}});e=null;delete e;g=null;delete g;h=null;delete h},GenTreatHormoneGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="EDIT_CHECK_{KeyOne}">編 輯</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DELETETREATHO_CHECK_{KeyOne}" style="border:3px orange double;background-color:red;">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"編輯日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.ModifyDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.TimeFormat(values.ModifyTime)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"編輯人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {ModifyUserName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"藥物名稱",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {CodeName}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false},{text:"開始服用日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.BegDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"停止服用日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.EndDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"其他說明",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {ReasonOther}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false}]})},applyData:function(a){this.setTreatHormone(a);if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)){this.importHormoneOrd(a,this)}},LoadData:function(){if(Ext.getStore("sTreatHormone").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sTreatHormone");a.getProxy().setExtraParams({ChartNo:b.data.ChartNO,CmsID:b.data.CmsID});a.removeAll();a.load({callback:function(e,d,f){},scope:this});b=null;delete b;a=null;delete a}});Ext.define("NisTRApp.view.WorkList.OUTP",{extend:Ext.Container,alias:"widget.WL_OUTP",config:{initialFlag:true,html:'<div style="text-align:center;background-color:black;width:100%;height:1024px;"> 　<p style="color:white; font-size:36px;" ></p> </div>',layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}],items:[{xtype:"tabpanel",itemId:"WL_OUTP_TabPanel",layout:{animation:false,type:"card"}}]},onContainerDestroy:function(a){this.removeGrobleStore();console.log("On Destroy :","WorkList.OUTP");this.removeAll(true,true)},onContainerPainted:function(b,a){},initialize:function(){this.callParent();this.initialGrobleStore();var d=Ext.create("NisTRApp.view.WorkList.OUTP.IpbInPatients",{id:"_outpIpbInPatients",itemId:"_outpIpbInPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"住院病人"});this.down("#WL_OUTP_TabPanel").add(d);d=null;delete d;var a=Ext.create("NisTRApp.view.WorkList.OUTP.IpbSearchPatients",{id:"_outpSchPatients",itemId:"_outpSchPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"收案病人"});this.down("#WL_OUTP_TabPanel").add(a);a=null;delete a;var b=Ext.create("NisTRApp.view.WorkList.OUTP.IpbPatients",{id:"_outpIpbPatients",itemId:"_outpIpbPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"病人查詢"});this.down("#WL_OUTP_TabPanel").add(b);b=null;delete b;var e=Ext.create("NisTRApp.view.WorkList.OUTP.Report",{id:"_outpReport",itemId:"_outpReport",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"報表"});this.down("#WL_OUTP_TabPanel").add(e);e=null;delete e},initialGrobleStore:function(){if(Ext.getStore("sCmsNurses")==null){Ext.create("Ext.data.JsonStore",{fields:[{name:"EmpNO",type:"string"},{name:"NameCH",type:"string"}],storeId:"sCmsNurses",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OUTP/search/QueryCMSNurse.ashx",reader:{type:"json"}}})}if(Ext.getStore("sCmsNurses").getCount()<=0){Ext.getStore("sCmsNurses").load()}if(Ext.getStore("sCmsClinc")==null){Ext.create("Ext.data.Store",{fields:[{name:"ClinCode",type:"string"},{name:"ClinName",type:"string"},{name:"Rang",type:"int"}],storeId:"sCmsClinc",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QuerySysClinc.ashx",reader:{type:"json"}}})}},removeGrobleStore:function(){if(Ext.getStore("sCmsNurses")!=null){Ext.getStore("sCmsNurses").removeAll();Ext.getStore("sCmsNurses").destroy()}if(Ext.getStore("sCmsClinc")!=null){Ext.getStore("sCmsClinc").removeAll();Ext.getStore("sCmsClinc").destroy()}}});Ext.define("NisTRApp.view.WorkList.OUTP.IpbPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onOUTP_IPB_PatIdClearicontap",event:"clearicontap",delegate:"#OUTP_IPB_PatId"},{fn:"onOUTP_IPB_QueryBtnTap",event:"tap",delegate:"#OUTP_IPB_QueryBtn"}],items:[{xtype:"panel",itemId:"OUTP_MainPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"ToolBar",items:[{xtype:"textfield",itemId:"OUTP_IPB_PatId",width:280,label:"病人ID",placeHolder:"病歷號或身分證號"},{xtype:"button",itemId:"OUTP_IPB_QueryBtn",ui:"decline",width:"90px",text:"查詢"},{xtype:"label",html:"Common_INFO",itemId:"PatInfoLab",tpl:["<table>","<tr>",'<td rowspan="2" align="left" width="40px">','	<img src="../_/img/{Sex}.png"  style="cursor:hand; vertical-align:middle;" >',"</td>","",'<td rowspan="1" align="left" width="100px">','      <span style="font-size: 16pt; font-weight: bold; color:#f6f6f6;"> {PatName}</span>'," </td>    ",'<td align="left" width="180px">',' <span style="font-weight: bold;color:#66ff00; font-size: 13px;">',"   生日.{[NisTRApp.view.TRUtility.BirthdayFormat(values.Birthday)]} ({Age}) &nbsp;","</span>",'  <br style="line-height:0.1;">','	<span style="font-weight:bold; color:#f6f6f6;font-size: 13px;">',"        身份證號. {PatIdno} </span>","</td>","","</tr>","</table>"],width:"360px"}]},{xtype:"panel",itemId:"OUTP_GridPanel",layout:{type:"fit"}}]}]},onContainerDestroy:function(a){if(Ext.getStore("sOSPLPatient")!=null){Ext.getStore("sOSPLPatient").removeAll();Ext.getStore("sOSPLPatient").destroy()}if(Ext.getStore("sCmsSearchOutpPatients")!=null){Ext.getStore("sCmsSearchOutpPatients").removeAll();Ext.getStore("sCmsSearchOutpPatients").destroy()}console.log("On Destroy :","OUTP.IpbPatients");this.removeAll(true,true)},onOUTP_IPB_PatIdClearicontap:function(b,d,a){if(Ext.getStore("sCmsSearchOutpPatients").isLoading()){return}Ext.getStore("sCmsSearchOutpPatients").removeAll();Ext.getStore("sOSPLPatient").removeAll();this.setRecord(null);this.down("#PatInfoLab").setHidden(true);this.down("#PatInfoLab").setHtml("");return},onOUTP_IPB_QueryBtnTap:function(b,d,a){this.LoadPatientList();this.LoadMed()},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.isEmpty(Ext.getStore("sOSPLPatient"))){Ext.create("Ext.data.Store",{storeId:"sOSPLPatient",clearOnPageLoad:false,model:"NisTRApp.model.Reg.RegPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryMedPatient.ashx",reader:{type:"json"}}})}this.down("#PatInfoLab").setHidden(true);Ext.getStore("sOSPLPatient").addListener("load",function(g,f,j,e,h){if(!Ext.isEmpty(f)&&!Ext.isEmpty(f[0])&&!Ext.isEmpty(f[0].data.ChartNO)){this.setRecord(f[0]);this.down("#PatInfoLab").setRecord(f[0]);this.down("#PatInfoLab").setHidden(false)}else{this.setRecord(null);this.down("#PatInfoLab").setHidden(true);this.down("#PatInfoLab").setHtml("")}},this);if(Ext.getStore("sCmsSearchOutpPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.OutpatData",storeId:"sCmsSearchOutpPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OUTP/search/QueryIpbByPat.ashx",reader:{type:"json"}}})}var b=this;var d=Ext.getCmp("CMS_OutpSearchPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenCmsOutpatGrid("CMS_OutpSearchPatGrid","病人查詢",null,true);d.initialFlag=true;d.getTitleBar().hide();var a=Ext.getStore("sCmsSearchOutpPatients");d.setStore(a);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCmsOutPatGrid,d);this.down("#OUTP_GridPanel").add(d);d=null;delete d;a=null;delete a}this.down("#OUTP_IPB_PatId").addListener("keyup",function(f,h,g){if(h.event.keyCode==13){this.down("#OUTP_IPB_QueryBtn").fireEvent("tap")}},this);b=null;delete b;this.setInitialFlag(false)},LoadMed:function(){if(Ext.getStore("sOSPLPatient").isLoading()){return}if(Ext.isEmpty(this.down("#OUTP_IPB_PatId").getValue())){NisTRApp.view.Misc.Alert("請輸入病人ID",800);Ext.getStore("sOSPLPatient").removeAll();this.setRecord(null);this.down("#PatInfoLab").setHidden(true);this.down("#PatInfoLab").setHtml("");return}var b=this.down("#OUTP_IPB_PatId").getValue();var a=Ext.getStore("sOSPLPatient");a.removeAll();a.getProxy().setExtraParams({ChartNo:b});a.load();a=null;delete a;b=null;delete b},LoadPatientList:function(){if(Ext.getStore("sCmsSearchOutpPatients").isLoading()){return}if(Ext.isEmpty(this.down("#OUTP_IPB_PatId").getValue())){Ext.getStore("sCmsSearchOutpPatients").removeAll();return}var a=Ext.getStore("sCmsSearchOutpPatients");var b=this.down("#OUTP_IPB_PatId").getValue();a.removeAll();a.getProxy().setExtraParams({Id:b});a.load();a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.OUTP.InCase",{extend:Ext.Container,config:{stopDistroyEvent:true,initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"panel",itemId:"OUTPIC_Main",layout:{type:"vbox"},scrollable:"vertical",items:[{xtype:"panel",itemId:"OUTPIC_MainPanel",layout:{type:"vbox"}},{xtype:"panel",itemId:"OUTPIC_ClosePanel",layout:{type:"vbox"}}]},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"OUTPIC_CloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"}]}],listeners:[{fn:"onOUTPIC_CloseBtnTap",event:"tap",delegate:"#OUTPIC_CloseBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onOUTPIC_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sCmsInpPatient"))){Ext.getStore("sCmsInpPatient").removeAll();Ext.getStore("sCmsInpPatient").destroy()}console.log("on destroy :","NisTRApp.view.OUTP.InCase");this.removeAll()},onContainerPainted:function(d,b){if(Ext.isEmpty($("#_cmsOutpInCaseSaveBtn")[0])){var a=NisTRApp.view.SysUtility.tapEventName();var e=$('<img src="../_/img/save01.png" id="_cmsOutpInCaseSaveBtn" style="width:28px;height:28px;">');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.SaveCmsData(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsOutpInCaseDiv"));var e=$('<img src="../_/img/save01.png" id="_cmsOutpPenddingCaseSaveBtn" style="width:28px;height:28px;">');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.PenddingCase(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsOutpPenddingCaseDiv"));e=$('<img src="../_/img/save01.png" id="_cmsOutpCloseCaseSaveBtn" style="width:28px;height:28px;">');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.CloseCase(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#CmsOutpCloseCaseDiv"));e=$('<span  ><button align="right" id="_cmsOutpMainCareTiteSyncBtn" type="button">同上</button></span>');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(g){try{if(!Ext.isEmpty(g.data.caller.down("#OUTPIC_MainPanel"))){var f=g.data.caller.down("#OUTPIC_MainPanel");f.down("#MainCare").setValue(f.down("#MainContact").getValue());f.down("#MainCareRel").setValue(f.down("#MainContactRel").getValue());f.down("#MainCareTel").setValue(f.down("#MainContactTel").getValue());f.down("#MainCareMobile").setValue(f.down("#MainContactMobile").getValue());f=null;delete f}}catch(g){console.log(g)}g.preventDefault();return false});e.appendTo($("#CmsOutpMainCareTiteDiv"));e=$('<img src="../_/img/Search2.png" id="_GetOrgClincPanelBtn" style="width:28px;height:28px;">');e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.CreateClincPanel(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#GetOrgCodeDiv"));e=$("#_cmsAADCancelBtn");e.unbind(a);e.bind(a,{caller:this,callbackFn:null},function(f){try{f.data.caller.AADCancel(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e=null;delete e;a=null;delete a}if(this.getInitialFlag()){this.LoadData();this.setInitialFlag(false)}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.Source)){Ext.Msg.alert("OUTP_InCase 病人資料錯誤");return false}if((this.getRecord().data.Source.Type==2)&&Ext.isEmpty(this.getRecord().data.InpNo)){Ext.Msg.alert("OUTP_InCase 住院病人資料錯誤");return false}if(this.getRecord().data.Source.Type!=2){Ext.Msg.alert("OUTP_InCase 不支援門診病人");return false}if(Ext.getStore("sCmsNurses").getCount()<=0){Ext.getStore("sCmsNurses").load()}this.setInitialFlag(true);if(Ext.getStore("sCmsInpPatient")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.InpPatient",storeId:"sCmsInpPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Inp/Search/QueryInpPatientJosn.ashx",reader:{type:"jsonHtmlDecode"}}})}Ext.getStore("sCmsInpPatient").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sCmsInpPatient").addListener("load",function(d,b,f,a,e){this.setMasked(false);if(!Ext.isEmpty(b)&&(b.length>0)){this.applyData(b[0])}else{Ext.Msg.alert("病人資料錯誤,請重新載入")}},this);this.down("#OUTPIC_MainPanel").add(this.CreateBaseFields());this.down("#OUTPIC_MainPanel").add(this.CreatePenddingFields());this.down("#OUTPIC_MainPanel").add(this.CreateAADFields());this.down("#OUTPIC_MainPanel").add(this.CreateInCaseFields());this.down("#OUTPIC_MainPanel").add(this.CreateTransInfoFields());this.down("#OUTPIC_ClosePanel").add(this.CreateClostFields())},CreateBaseFields:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:'<div id="CmsOutpBaseInfoDiv">基本資料</div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Text",{itemId:"StationNo",label:"目前床位",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"InDate",label:"入院日",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"PreOutDate",label:"預計出院日",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"OutDate",label:"實際出院日",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"DocName",label:"主治醫師",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"InpNO",label:"住院號",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"Birthday",label:"生日",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"ChartNO",label:"病歷流水號",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"OprDate",label:"手術日期",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"ReOprDate",label:"再手術日期",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"IcuDate",label:"ICU 日期",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"BmtDate",label:"BMT 日期",labelWidth:"23%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainIcdh",label:"主診斷",labelWidth:"15%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"PastHistory",label:"過去病史",labelWidth:"15%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"ReasonSummary",label:"住院目的",labelWidth:"15%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"NurMainCare",label:"聯絡人/電話",labelWidth:"15%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=null;delete a;e=null;delete e;d=null;delete d;return b},CreatePenddingFields:function(){var a=Ext.create("Ext.form.FieldSet",{itemId:"PendingFieldSet",width:"95%",title:" ",layout:"fit",centered:false,hidden:true});f1=Ext.create("Ext.field.Text",{itemId:"PendingFlag",label:'<div id="CmsOutpPenddingCaseDiv">不符合收案條件</div>',labelWidth:"99%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});a.add(f1);f1=null;delete f1;return a},CreateAADFields:function(){var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:'<div id="CmsAADpInCaseDiv">離院病人 <span> <button style=" align:right; display:inline;" id="_cmsAADCancelBtn" type="button">取消註記</button></span></div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Select",{itemId:"AADReason",label:"離院狀態",labelWidth:"26%",width:"45%",readOnly:true,options:[{text:"",value:""},{text:"轉院",value:"6"},{text:"一般自動出院",value:"5"},{text:"病危自動出院",value:"A"}],style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"AADRemark",label:"",labelWidth:"20px",width:"45%",style:"float:left;font-size:16px;",hidden:false,placeHolder:"請於〈離院追蹤記錄〉表單中填寫",readOnly:true});b.add(a);a=null;delete a;return b},CreateInCaseFields:function(){var f=function f(h,j,g){this.timeField.setValue(new Date())};var e=function e(h,j,g){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:'<div id="CmsOutpInCaseDiv">出院準備 </div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Select",{itemId:"MainIcdhCode",label:"主診斷代碼",labelWidth:"12.5%",width:"99%",placeHolder:"點選帶入(上傳國健局資料使用)",options:[{text:"",value:""}],style:"float:left;font-size:16px;"});b.add(a);a=Ext.create("Ext.field.Select",{itemId:"CmsUserID",label:"個管師",labelWidth:"26%",width:"48%",valueField:"EmpNO",displayField:"NameCH",style:"float:left;font-size:16px;"});a.setStore(Ext.getStore("sCmsNurses"));b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("CmsDate","CmsDate","收案日期","30%","32%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("CmsDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("CmsDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e));var d=Ext.create("Ext.field.Select",{itemId:"CmsSource",label:"收案來源",labelWidth:"12.5%",width:"99%",options:[{text:"",value:""},{text:"經會診",value:"1"},{text:"經篩選",value:"2"}],style:"float:left;font-size:16px;",listeners:{change:function(j,h,g){}}});b.add(d);a=NisTRApp.view.DateUtil.CreatDateField("ConsoultDate","ConsoultDate","會診日期","15%","80%",null);a.setHidden(true);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("ConsoultDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,f).setHidden(true));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("ConsoultDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,e).setHidden(true));d.addListener("change",function(j,h,g){this.setHidden(h!="1")},a);a=Ext.create("Ext.ux.field.Multiselect",{itemId:"RemainReason",label:"滯院原因",labelWidth:"13%",delimiter:",",placeHolder:"請輸入",mode:"MULTI",width:"99%",options:[{text:"治療未結束",value:"1"},{text:"經濟困難",value:"2"},{text:"照顧人力缺乏",value:"3"},{text:"法律糾紛",value:"4"},{text:"居家環境不利",value:"5"},{text:"機構因素",value:"6"}],style:"float:left;font-size:16px;",listeners:{change:function(j,h,g){}}});a.setValue(null);a.setHidden(true);b.add(a);d.addListener("change",function(j,h,g){this.setHidden(h!="2")},a);a=Ext.create("Ext.field.Text",{itemId:"Cooperation",label:"共照",labelWidth:"100%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);d=Ext.create("Ext.field.Checkbox",{itemId:"CooperationFlag",label:"共照註記",labelWidth:"60%",width:"20%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(d);a=Ext.create("Ext.field.Text",{itemId:"MainContactTitee",label:"主要聯絡人資訊",labelWidth:"100%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainContact",label:"性名",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainContactRel",label:"關係",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainContactTel",label:"電話",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainContactMobile",label:"手機",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainCareTite",label:'<div id="CmsOutpMainCareTiteDiv">主要照顧者資訊 </div>',labelWidth:"100%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainCare",label:"姓名",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainCareRel",label:"關係",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainCareTel",label:"電話",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"MainCareMobile",label:"手機",labelWidth:"20%",width:"50%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"ServiceRequestTitle",label:"服務需求",labelWidth:"100%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);d=Ext.create("Ext.ux.field.Multiselect",{itemId:"ServiceReq",label:"服務需求",labelWidth:"13%",delimiter:",",placeHolder:"請輸入",mode:"MULTI",width:"99%",hidden:false,options:[{text:"居家護理",value:"00"},{text:"居家服務",value:"01"},{text:"復健治療-其他",value:"02"},{text:"經濟補助",value:"03"},{text:"身心障礙手冊鑑定及申請",value:"04"},{text:"心理情緒困擾",value:"05"},{text:"家庭問題",value:"06"},{text:"老人保護及棄養問題",value:"07"},{text:"居家照顧能力/技巧不足",value:"08"},{text:"租借安全輔具",value:"09"},{text:"照顧者缺乏照顧動機",value:"10"},{text:"安寧照顧",value:"11"},{text:"行為/精神疾患",value:"12"},{text:"喘息服務",value:"13"},{text:"復健治療-OT",value:"14"},{text:"復健治療-PT",value:"15"},{text:"復健治療-RT",value:"16"},{text:"營養師",value:"17"},{text:"社區老人中心",value:"18"},{text:"養護機構",value:"19"},{text:"日間照護(顧)",value:"20"},{text:"植物人中心",value:"21"},{text:"安寧病房",value:"22"},{text:"護理之家",value:"23"},{text:"衛生所／健康服務中心",value:"24"},{text:"通報不轉介",value:"98"},{text:"其他",value:"99"}],style:"float:left;font-size:16px;",listeners:{change:function(j,h,g){}}});d.setValue(null);b.add(d);a=Ext.create("Ext.field.Text",{itemId:"ServiceReqOTH",label:"其他",labelWidth:"13%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",placeHolder:"最多50字",maxLength:50,readOnly:false});a.setHidden(true);b.add(a);d.addListener("change",function(j,h,g){if(!Ext.Array.contains(h,"99")){this.setValue("");this.setHidden(true)}else{this.setHidden(false)}},a);a=null;delete a;d=null;delete d;f=null;delete f;e=null;delete e;return b},CreateTransInfoFields:function(){var g=function g(j,k,h){this.timeField.setValue(new Date())};var f=function f(j,k,h){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{width:"95%",title:"<div>出院準備 轉介資訊</div>",layout:"fit",centered:false,hidden:false});var a=NisTRApp.view.DateUtil.CreatDateField("GetOrgTransDate","GetOrgTransDate","轉介日期","21%","80%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("GetOrgTransSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,g));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("GetOrgTransCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,f));var e=Ext.create("Ext.field.Select",{itemId:"GetCounty",label:"接案單位縣市",labelWidth:"17%",width:"99%",options:[{text:"",value:""},{text:"台北市",value:"01"},{text:"高雄市",value:"02"},{text:"基隆市",value:"11"},{text:"新竹市",value:"12"},{text:"台中市",value:"17"},{text:"台南市",value:"21"},{text:"嘉義市",value:"22"},{text:"新北市",value:"31"},{text:"桃園縣",value:"32"},{text:"新竹縣",value:"33"},{text:"宜蘭縣",value:"34"},{text:"苗栗縣",value:"35"},{text:"台中縣",value:"36"},{text:"彰化縣",value:"37"},{text:"南投縣",value:"38"},{text:"雲林縣",value:"39"},{text:"嘉義縣",value:"40"},{text:"台南縣",value:"41"},{text:"高雄縣",value:"42"},{text:"屏東縣",value:"43"},{text:"澎湖縣",value:"44"},{text:"花蓮縣",value:"45"},{text:"台東縣",value:"46"},{text:"金門縣",value:"90"},{text:"連江縣",value:"91"}],style:"float:left;font-size:16px;",listeners:{change:function(k,j,h){}}});b.add(e);a=Ext.create("Ext.field.Text",{itemId:"GetOrgCode",label:'<div id="GetOrgCodeDiv">接案單位代碼</div>',labelWidth:"20%",width:"86%",style:"float:left;font-size:16px;",hidden:false,value:"",placeHolder:"系統帶入",maxLength:12,readOnly:true});b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("GetOrgCodeCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,f));e=Ext.create("Ext.field.Text",{itemId:"GetOrgName",label:'<div id="GetOrgNameDiv">接案單位</div>',labelWidth:"17%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",placeHolder:"最多50字",maxLength:50,readOnly:false});b.add(e);a.addListener("change",function(k,j,h){if(Ext.isEmpty(j)){this.setValue("")}},e);a=Ext.create("Ext.field.Text",{itemId:"GetOrgTel",label:"接案單位電話",labelWidth:"17%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",placeHolder:"最多20字",maxLength:20,readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"GetOrgUser",label:"接案單位人員",labelWidth:"17%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",placeHolder:"最多20字",maxLength:20,readOnly:false});b.add(a);a=Ext.create("Ext.field.Text",{itemId:"GetOrgCallBack",label:"處理回覆",labelWidth:"100%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",readOnly:true});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("GetOrgResDate","GetOrgResDate","回覆日期","30%","80%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("GetOrgResDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,g));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("GetOrgResDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,f));var d=Ext.create("Ext.field.Checkbox",{itemId:"GetOrgServiceFlagN",label:"接案單位【無法】提供服務",labelWidth:"60%",width:"40%",style:"float:left;font-size:16px;",hidden:true,checked:false,readOnly:false});b.add(d);a.addListener("change",function(k,j,h){this.setHidden(Ext.isEmpty(j))},d);d=Ext.create("Ext.field.Text",{itemId:"GetOrgServiceDesc",label:"【無法】提供服務原因 <br> 或提供服務項目",labelWidth:"24%",width:"99%",style:"float:left;font-size:16px;",hidden:true,value:"",maxLength:250,placeHolder:"最多250字",readOnly:false});a.addListener("change",function(k,j,h){this.setHidden(Ext.isEmpty(j))},d);b.add(d);a=null;delete a;e=null;delete e;f2=null;delete f2;d=null;delete d;g=null;delete g;f=null;delete f;return b},CreateClostFields:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var a=Ext.create("Ext.form.FieldSet",{width:"95%",title:'<div id="CmsOutpCloseCaseDiv">出院準備 結案記錄 </div>',layout:"fit",centered:false});var b=Ext.create("Ext.field.Select",{itemId:"CloseReason",label:"結案原因",labelWidth:"13%",width:"99%",options:[{text:"",value:""},{text:"個案出院狀況穩定",value:"1"},{text:"個案再入院，因疾病因素",value:"2"},{text:"個案再入院，因出院準備不完善",value:"4"},{text:"個案死亡",value:"3"},{text:"其他",value:"99"}],style:"float:left;font-size:16px;",listeners:{change:function(h,g,f){}}});a.add(b);f1=Ext.create("Ext.field.Text",{itemId:"CloseRemark",label:"其他說明",labelWidth:"13%",width:"99%",style:"float:left;font-size:16px;",hidden:false,value:"",placeHolder:"請填寫原因",readOnly:false});f1.setValue("");f1.setHidden(true);a.add(f1);b.addListener("change",function(h,g,f){this.setHidden(g!="99")},f1);f1=NisTRApp.view.DateUtil.CreatDateField("CloseDate","CloseDate","結案日期","16%","80%",null);a.add(f1);a.add(NisTRApp.view.DateUtil.CreateCloseBtn("CloseDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',f1,e));a.add(NisTRApp.view.DateUtil.CreateCloseBtn("CloseDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',f1,d));f1=null;delete f1;b=null;delete b;e=null;delete e;d=null;delete d;return a},LoadData:function(){if(Ext.getStore("sCmsInpPatient").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=Ext.getStore("sCmsInpPatient");var b=this.getRecord();a.getProxy().setExtraParams({ChartNo:b.data.ChartNO,InpNo:b.data.InpNO});a.removeAll();a.load({callback:function(e,d,f){},scope:this});a=null;delete a},applyData:function(h){this.resetPanel();if(Ext.isEmpty(this.down("#OUTPIC_MainPanel"))){return}var g=this.down("#OUTPIC_MainPanel");if(!Ext.isEmpty(h.raw.Ipbinp)){var l,u,f,n;var d=h.getIpbinp().data;var q=h.data;u=NisTRApp.view.DateUtil.GetDayCount(d.INDate);if(""!=u){l=NisTRApp.view.TRUtility.BirthdayFormat(d.INDate)+" (day "+u+")"}else{l=""}n=(d.NowStationno=="02A"?NisTRApp.view.DateUtil.GetDayCount(d.TurnInDate):"");if(""!=n){f=NisTRApp.view.TRUtility.BirthdayFormat(d.TurnInDate)+" (day "+n+")"}else{f=""}g.down("#InDate").setValue(l);g.down("#StationNo").setValue(d.NowStationno+"-"+d.NowBedno);g.down("#ChartNO").setValue(q.ChartNo);g.down("#OutDate").setValue(NisTRApp.view.TRUtility.BirthdayFormat(d.OutDate));g.down("#PreOutDate").setValue(NisTRApp.view.TRUtility.BirthdayFormat(d.PreOutDate));g.down("#DocName").setValue("Dr."+d.NowDocName1+" / "+d.NowDocName2);g.down("#InpNO").setValue(q.InpNo);g.down("#IcuDate").setValue(f);g.down("#Birthday").setValue(NisTRApp.view.TRUtility.BirthdayFormat(q.Birthday)+" ("+q.Age+")");var r=0;var a=[];a.push({text:"",value:""});for(r=1;r<=20;r++){if(!Ext.isEmpty(d["IcdhCode"+r])){a.push({text:(d["IcdhCode"+r]+" - "+d["IcdhCodeName"+r]),value:d["IcdhCode"+r]})}}g.down("#MainIcdhCode").setOptions(a);g.down("#MainIcdhCode").setValue(q.MainIcdhCode);q=null;delete q;d=null;delete d;l=null;delete l;u=null;delete u;f=null;delete allergyStr;n=null;delete n;r=null;delete r;a=null;delete a}if(!Ext.isEmpty(h.raw.Nurdatm)){var p,o,e,k,m,v;var q=h.getNurdatm().data;p=NisTRApp.view.DateUtil.GetOpCount(q.OpDate);if(""!=p){k=(NisTRApp.view.TRUtility.BirthdayFormat(q.OpDate)+" (day "+p+")")}else{k=""}o=NisTRApp.view.DateUtil.GetOpCount(q.ReOpDate);if(""!=o){m=(NisTRApp.view.TRUtility.BirthdayFormat(q.ReOpDate)+" (day "+o+")")}else{m=""}e=NisTRApp.view.DateUtil.GetOpCount(q.BmtDate);if(""!=e){v=(NisTRApp.view.TRUtility.BirthdayFormat(q.BmtDate)+" (day "+e+")")}else{v=""}g.down("#OprDate").setValue(k);g.down("#ReOprDate").setValue(m);g.down("#BmtDate").setValue(v);g.down("#MainIcdh").setValue(q.Nurdiag);g.down("#PastHistory").setValue(q.Pasthistory);g.down("#ReasonSummary").setValue(q.IpbReason);g.down("#NurMainCare").setValue(q.EmrInfo);q=null;delete q;p=null;delete p;o=null;delete o;e=null;delete e;k=null;delete k;m=null;delete m;v=null;delete v}if(!Ext.isEmpty(h.raw.CmsOutpat)){var q=h.getCmsOutpat().data;var s=(String.IsNull(q.CmsUserID)&&q.Status=="0")?NisTRApp.view.SysUtility.GetUserID():q.CmsUserID;g.down("#CmsUserID").setValue(s);g.down("#PendingFieldSet").setHidden(!(Ext.isEmpty(q.Status)||q.Status=="0"||q.Status=="4"));var b=q.CmsDate;g.down("#CmsDate").setValue(Ext.isEmpty(b)?null:NisTRApp.view.DateUtil.StrToDateTime(b));this.down("#OUTPIC_ClosePanel").setHidden(Ext.isEmpty(b));g.down("#AADReason").setValue(q.AADReason);document.getElementById("_cmsAADCancelBtn").style.display=(Ext.isEmpty(q.AADReason)?"none":"inline");g.down("#CmsSource").setValue(q.CmsSource);b=q.ConsoultDate;g.down("#ConsoultDate").setValue(Ext.isEmpty(b)?null:NisTRApp.view.DateUtil.StrToDateTime(b));g.down("#RemainReason").setValue(q.RemainReason);g.down("#MainContact").setValue(q.MainContact);g.down("#MainContactRel").setValue(q.MainContactRel);g.down("#MainContactTel").setValue(q.MainContactTel);g.down("#MainContactMobile").setValue(q.MainContactMobile);if(Ext.isEmpty(q.MainContact)&&Ext.isEmpty(q.MainContactRel)&&Ext.isEmpty(q.MainContactTel)&&Ext.isEmpty(q.MainContactMobile)){g.down("#MainContact").setValue(h.data.EmrName);g.down("#MainContactRel").setValue(h.data.EmrRel);g.down("#MainContactTel").setValue(h.data.EmrTel);g.down("#MainContactMobile").setValue(h.data.EmrMobile)}if(!Ext.isEmpty(q.CooperationFlag)&&q.CooperationFlag){g.down("#CooperationFlag").check()}else{g.down("#CooperationFlag").uncheck()}g.down("#MainCare").setValue(q.MainCare);g.down("#MainCareRel").setValue(q.MainCareRel);g.down("#MainCareTel").setValue(q.MainCareTel);g.down("#MainCareMobile").setValue(q.MainCareMobile);g.down("#ServiceReq").setValue(q.ServiceReq);g.down("#ServiceReqOTH").setValue(q.ServiceReqOTH);g.down("#GetOrgTransDate").setValue(null);b=q.GetOrgTransDate;g.down("#GetOrgTransDate").setValue(Ext.isEmpty(b)?null:NisTRApp.view.DateUtil.StrToDateTime(b));g.down("#GetCounty").setValue(q.GetCounty);g.down("#GetOrgCode").setValue(q.GetOrgCode);g.down("#GetOrgName").setValue(q.GetOrgName);g.down("#GetOrgTel").setValue(q.GetOrgTel);g.down("#GetOrgUser").setValue(q.GetOrgUser);b=q.GetOrgResDate;g.down("#GetOrgResDate").setValue(Ext.isEmpty(b)?null:NisTRApp.view.DateUtil.StrToDateTime(b));g.down("#MainIcdhCode").setValue(q.MainIcdhCode);if(!Ext.isEmpty(q.GetOrgServiceFlag)&&q.GetOrgServiceFlag=="N"){g.down("#GetOrgServiceFlagN").check()}else{g.down("#GetOrgServiceFlagN").uncheck()}g.down("#GetOrgServiceDesc").setValue(q.GetOrgServiceDesc);if(!Ext.isEmpty(h.raw.CmsOutpat.CmsDate)){g=this.down("#OUTPIC_ClosePanel");g.down("#CloseReason").setValue(q.CloseReason);g.down("#CloseRemark").setValue(q.CloseRemark);b=q.CloseDate;g.down("#CloseDate").setValue(Ext.isEmpty(b)?null:NisTRApp.view.DateUtil.StrToDateTime(b))}b=null;delete b}g=null;delete g},resetPanel:function(){if(Ext.isEmpty(this.down("#OUTPIC_MainPanel"))){return}var a=this.down("#OUTPIC_MainPanel");a.down("#StationNo").setValue("");a.down("#InDate").setValue("");a.down("#PreOutDate").setValue("");a.down("#OutDate").setValue("");a.down("#DocName").setValue("");a.down("#InpNO").setValue("");a.down("#MainIcdh").setValue("");a.down("#PastHistory").setValue("");a.down("#ReasonSummary").setValue("");a.down("#NurMainCare").setValue("");a.down("#ChartNO").setValue("");a.down("#Birthday").setValue("");a.down("#ReOprDate").setValue("");a.down("#OprDate").setValue("");a.down("#IcuDate").setValue("");a.down("#BmtDate").setValue("");a.down("#MainIcdhCode").setValue("");a.down("#CmsUserID").setValue(null);a.down("#CmsDate").setValue(null);a.down("#CmsSource").setValue(null);a.down("#ConsoultDate").setValue(null);a.down("#RemainReason").setValue(null);a.down("#MainContact").setValue("");a.down("#MainContactRel").setValue("");a.down("#MainContactTel").setValue("");a.down("#MainContactMobile").setValue("");a.down("#MainCare").setValue("");a.down("#MainCareRel").setValue("");a.down("#MainCareTel").setValue("");a.down("#MainCareMobile").setValue("");a.down("#CooperationFlag").uncheck();a.down("#PendingFieldSet").setHidden(true);a.down("#ServiceReq").setValue(null);a.down("#ServiceReqOTH").setValue(null);a.down("#GetOrgTransDate").setValue(null);a.down("#GetCounty").setValue(null);a.down("#GetOrgCode").setValue("");a.down("#GetOrgName").setValue("");a.down("#GetOrgTel").setValue("");a.down("#GetOrgUser").setValue("");a.down("#GetOrgResDate").setValue(null);a.down("#GetOrgServiceFlagN").uncheck();a.down("#GetOrgServiceDesc").setValue("");a=null;delete a;if(Ext.isEmpty(this.down("#OUTPIC_ClosePanel"))){return}this.down("#OUTPIC_ClosePanel").setHidden(true);var a=this.down("#OUTPIC_ClosePanel");a.down("#CloseReason").setValue("");a.down("#CloseRemark").setValue("");a.down("#CloseDate").setValue(null);a=null;delete a},SaveCmsData:function(b){if(Ext.getStore("sCmsInpPatient").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=b.down("#OUTPIC_MainPanel");if(Ext.isEmpty(a.down("#CmsUserID").getValue())){NisTRApp.view.Misc.Alert("個管師不可為空值",0);return false}if(Ext.isEmpty(a.down("#CmsDate").getValue())){NisTRApp.view.Misc.Alert("收案日期不可為空",0);return false}if((a.down("#GetOrgServiceFlagN").isChecked()||!Ext.isEmpty(a.down("#GetOrgServiceDesc").getValue()))&&Ext.isEmpty(a.down("#GetOrgResDate").getValue())){NisTRApp.view.Misc.Alert("處理回覆日不可為空",0);return false}var f=b.getRecord();var d={InpNO:f.data.InpNO,ChartNO:f.data.ChartNO,CmsUserID:a.down("#CmsUserID").getValue(),CmsDate:a.down("#CmsDate").getFormattedValue("Ymd"),CmsSource:a.down("#CmsSource").getValue(),ConsoultDate:a.down("#ConsoultDate").getFormattedValue("Ymd"),RemainReason:(Ext.isEmpty(a.down("#RemainReason").getValue())?"":a.down("#RemainReason").getValue().toString()),MainContact:a.down("#MainContact").getValue(),MainContactRel:a.down("#MainContactRel").getValue(),MainContactTel:a.down("#MainContactTel").getValue(),MainContactMobile:a.down("#MainContactMobile").getValue(),MainCare:a.down("#MainCare").getValue(),MainCareRel:a.down("#MainCareRel").getValue(),MainCareTel:a.down("#MainCareTel").getValue(),MainCareMobile:a.down("#MainCareMobile").getValue(),CooperationFlag:a.down("#CooperationFlag").isChecked(),CooperationBegDate:"",CooperationEndDate:"",ServiceReq:(Ext.isEmpty(a.down("#ServiceReq").getValue())?"":a.down("#ServiceReq").getValue().toString()),ServiceReqOTH:a.down("#ServiceReqOTH").getValue(),GetOrgTransDate:a.down("#GetOrgTransDate").getFormattedValue("Ymd"),GetCounty:a.down("#GetCounty").getValue(),GetOrgCode:a.down("#GetOrgCode").getValue(),GetOrgName:a.down("#GetOrgName").getValue(),GetOrgTel:a.down("#GetOrgTel").getValue(),GetOrgUser:a.down("#GetOrgUser").getValue(),GetOrgResDate:a.down("#GetOrgResDate").getFormattedValue("Ymd"),GetOrgServiceFlag:a.down("#GetOrgServiceFlagN").isChecked(),GetOrgServiceDesc:a.down("#GetOrgServiceDesc").getValue(),MainIcdhCode:a.down("#MainIcdhCode").getValue()};var e=b;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OUTP/action/CmsOutpatUpdate.ashx",scope:b,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),InpNo:f.data.InpNO,ChartNo:f.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(g){e.setMasked(false);var h=Ext.decode(g.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){e.LoadData();if(!Ext.isEmpty(e.getCaller())&&!Ext.isEmpty(e.getCaller().getStore())){e.getCaller().getStore().load()}}h=null;delete h;e=null;delete e},failure:function(){e.setMasked(false);e=null;delete e}});d=null;delete d;f=null;delete f},CloseCase:function(b){if(Ext.getStore("sCmsInpPatient").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=b.down("#OUTPIC_ClosePanel");if(Ext.isEmpty(a.down("#CloseReason").getValue())){NisTRApp.view.Misc.Alert("結案原因不可為空",0);return false}if(Ext.isEmpty(a.down("#CloseDate").getValue())){NisTRApp.view.Misc.Alert("結案日期不可為空",0);return false}if((a.down("#CloseReason").getValue()=="99")&&Ext.isEmpty(a.down("#CloseRemark").getValue())){NisTRApp.view.Misc.Alert("其他說明不可為空值",0);return false}var f=b.getRecord();var d={InpNO:f.data.InpNO,ChartNO:f.data.ChartNO,CloseReason:a.down("#CloseReason").getValue(),CloseDate:a.down("#CloseDate").getFormattedValue("Ymd"),CloseRemark:a.down("#CloseRemark").getValue()};var e=b;e.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OUTP/action/CmsOutpatClosed.ashx",scope:b,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),InpNo:f.data.InpNO,ChartNo:f.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(d)))},success:function(g){e.setMasked(false);var h=Ext.decode(g.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0));if(h.Success){e.LoadData();if(!Ext.isEmpty(e.getCaller())&&!Ext.isEmpty(e.getCaller().getStore())){e.getCaller().getStore().load()}}h=null;delete h;e=null;delete e},failure:function(){e.setMasked(false);e=null;delete e}});d=null;delete d;f=null;delete f},CreateClincPanel:function(a){NisTRApp.view.ClincSearchPanel.Create(a,function(d,b){if(!Ext.isEmpty(b)&&!Ext.isEmpty(d)){b.down("#GetOrgCode").setValue(d.data.ClinCode);b.down("#GetOrgName").setValue(d.data.ClinName)}})},CreateGetMainIcdhPanel:function(b){var d=Ext.create("Ext.form.FieldSet",{width:"90%",centered:true,items:[{xtype:"datetimepickerfield",itemId:"VitalDate",name:"Vitaldate",label:"醫療日期",value:new Date(),width:"99%",labelWidth:"30%",autoCapitalize:true,dateTimeFormat:"Y-m-d H:i",picker:{ui:"dark",yearFrom:2013,yearTo:2020,minuteInterval:5,ampm:false,useTitles:true,doneButton:{ui:"confirm",text:"儲存"},cancelButton:{ui:"confirm",text:"取消"},slotOrder:["year","month","day","hour","minute"]}},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Height",itemId:"Height",maxValue:300,autoCapitalize:true,placeHolder:"請輸入(cm)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Weight",itemId:"Weight",autoCapitalize:true,placeHolder:"請輸入(kg)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",itemId:"Temperature",label:"Temp.",maxValue:99,autoCapitalize:true,placeHolder:"請輸入(度)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Pulse",itemId:"Pulse",autoCapitalize:true,placeHolder:"請輸入(次)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"Resp.",itemId:"Respiration",autoCapitalize:true,placeHolder:"請輸入(次)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"SpO2",itemId:"SpO2",autoCapitalize:true,placeHolder:"請輸入(%)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"SBP",itemId:"BPS",autoCapitalize:true,placeHolder:"請輸入(mmHg)"},{xtype:"numberfield",style:"width:50%;float:left;font-size:16px;",label:"DBP",itemId:"BPD",autoCapitalize:true,placeHolder:"請輸入(mmHg)"},{xtype:"selectfield",style:"width:50%;float:left;font-size:16px;",label:"疼痛指數",itemId:"Pain",autoCapitalize:true,placeHolder:"請選擇",options:[{text:"",value:""},{text:"Y",value:"Y"},{text:"N",value:"N"}],value:""},{labelWidth:"120px",xtype:"selectfield",itemId:"_tprRemark",label:"說明",placeHolder:"請輸入",options:[{text:"",value:""},{text:"拒絕",value:"拒絕"},{text:"病人未到",value:"病人未到"},{text:"無法測量",value:"無法測量"}],value:"",style:"width:50%;float:left;font-size:16px;"}]});var a=Ext.create("Ext.Toolbar",{docked:"bottom",xtype:"toolbar",items:[{xtype:"button",text:"取消",style:"width:20%",scope:this,right:"37%",ui:"confirm",hasDisabled:false,handler:function(e){if(this.getSuccess()){this.getSuccess()()}this.removeAll(true,true);this.destroy()}},{text:"資料儲存",style:"width:35%",itemId:"_vitalSignInputToolbarSave",xtype:"button",scope:this,right:"1%",ui:"confirm"}]});a.down("#_vitalSignInputToolbarSave").addListener("tap",function(j,k,l){var p=this.getPatInfo();var g=this.down("#Height").getValue();if(null!=g&&!REGEXP_CONST.Float.HEIGHT.test(g)){NisTRApp.view.Misc.MsgShow(REGEXP_CONST.Float.HEIGHT_STR,"提醒",2000);g=null;delete g;return}g=this.down("#Weight").getValue();if(null!=g&&!REGEXP_CONST.Float.WEIGHT.test(g)){NisTRApp.view.Misc.MsgShow(REGEXP_CONST.Float.WEIGHT_STR,"提醒",2000);g=null;delete g;return}g=null;delete g;var f="";if(this.down("#Temperature").getValue()!=null&&this.down("#Temperature").getValue()>=38){f+="體溫 ; "}if(this.down("#Pulse").getValue()!=null&&(this.down("#Pulse").getValue()>=120||this.down("#Pulse").getValue()<=60)){f+="脈搏 ; "}if(this.down("#Respiration").getValue()!=null&&(this.down("#Respiration").getValue()>=26||this.down("#Respiration").getValue()<=14)){f+="呼吸 ; "}if(this.down("#BPS").getValue()!=null&&(this.down("#BPS").getValue()>=160||this.down("#BPS").getValue()<=90)){f+="血壓 ; "}if(f!=""){f="下列數值異常，請再次確認並通知主治醫師\n"+f;Ext.Msg.show({title:"提示",message:f,wait:true});f=null;delete f}var m=this;m.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});var h=new Object();h.ChartNo=p.data.ChartNo;h.ChartSeq=p.data.ChartSeq;h.Temp=(this.down("#Temperature").getValue()==null?0:this.down("#Temperature").getValue());h.Pulse=(this.down("#Pulse").getValue()==null?0:this.down("#Pulse").getValue());h.Resp=(this.down("#Respiration").getValue()==null?0:this.down("#Respiration").getValue());h.Bps=(this.down("#BPS").getValue()==null?0:this.down("#BPS").getValue());h.Bpd=(this.down("#BPD").getValue()==null?0:this.down("#BPD").getValue());h.Spo2=(this.down("#SpO2").getValue()==null?0:this.down("#SpO2").getValue());h.Height=(this.down("#Height").getValue()==null?0:this.down("#Height").getValue());h.Weight=(this.down("#Weight").getValue()==null?0:this.down("#Weight").getValue());h.Remark=this.down("#_tprRemark").getValue();h.Pain=this.down("#Pain").getValue();h.CreDateTime=this.down("#VitalDate").getFormattedValue("Y-m-d H:i");h.UserID=NisTRApp.view.SysUtility.GetUserID();var n=JSON.stringify(h);var o=this.getSuccess();Ext.Ajax.request({url:"../api/action/VitalSignInput.ashx",scope:this,method:"POST",timeout:15000,params:{Json:n},success:function(e){if(m.getSuccess()){m.getSuccess()("Success")}m.setMasked(false);m.removeAll(true,true);m.destroy();m=null;delete m;o=null;delete o},failure:function(){m.setMasked(false);Ext.Msg.alert("存檔失敗");o=null;delete o}});n=null;delete n;h=null;delete h;p=null;delete p},this);d.down("#Height").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#Weight").focus()}},d.down("#Height"));d.down("#Weight").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#Temperature").focus()}},d.down("#Weight"));d.down("#Temperature").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#Pulse").focus()}},d.down("#Temperature"));d.down("#Pulse").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#Respiration").focus()}},d.down("#Pulse"));d.down("#Respiration").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#SpO2").focus()}},d.down("#Respiration"));d.down("#SpO2").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#BPS").focus()}},d.down("#SpO2"));d.down("#BPS").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#BPD").focus()}},d.down("#BPS"));d.down("#BPD").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#Pain").focus()}},d.down("#BPD"));d.down("#Pain").on("keyup",function(g,f){if(f.browserEvent.keyCode==13){d.down("#_tprRemark").focus()}},d.down("#Pain"));this.down("#OPD_VitalSignMaintPanel").add(d);this.down("#OPD_VitalSignMaintPanel").add(a);d.down("#VitalDate").setValue(new Date())},PenddingCase:function(b){if(Ext.getStore("sCmsInpPatient").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=b.down("#OUTPIC_MainPanel");var e=b.getRecord();if(!Ext.isEmpty(e.Status)&&e.Status=="1"){NisTRApp.view.Misc.Alert("已收案，如欲取消請通知資訊部",0);return false}if(!Ext.isEmpty(e.Status)&&e.Status=="2"){NisTRApp.view.Misc.Alert("已結案，如欲取消請通知資訊部",0);return false}var d=b;Ext.Msg.confirm("Confirm","是否確認取消?",function(g,h,f){if(g=="no"){return}else{if(g=="yes"){d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OUTP/action/CmsOutpatPendding.ashx",scope:b,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),InpNo:e.data.InpNO,ChartNo:e.data.ChartNO},success:function(j){d.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){d.LoadData();if(!Ext.isEmpty(d.getCaller())&&!Ext.isEmpty(d.getCaller().getStore())){d.getCaller().getStore().load()}}k=null;delete k;d=null;delete d},failure:function(){d.setMasked(false);d=null;delete d}});json=null;delete json;e=null;delete e}}},this)},AADCancel:function(b){if(Ext.getStore("sCmsInpPatient").isLoading()||Ext.isEmpty(this.getRecord())){return}var a=b.down("#OUTPIC_MainPanel");var e=b.getRecord();var d=b;Ext.Msg.confirm("Confirm","是否確認取消?",function(g,h,f){if(g=="no"){return}else{if(g=="yes"){d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OUTP/action/CmsAADCancel.ashx",scope:b,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),InpNo:e.data.InpNO,ChartNo:e.data.ChartNO},success:function(j){d.setMasked(false);var k=Ext.decode(j.responseText);NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0));if(k.Success){d.LoadData();if(!Ext.isEmpty(d.getCaller())&&!Ext.isEmpty(d.getCaller().getStore())){d.getCaller().getStore().load()}}k=null;delete k;d=null;delete d},failure:function(){d.setMasked(false);d=null;delete d}});json=null;delete json;e=null;delete e}}},this)}});Ext.define("NisTRApp.view.WorkList.OUTP.IpbInPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onWL_OUTP_IPL_StationChange",event:"change",delegate:"#WL_OUTP_IPL_Station"},{fn:"onOUTP_INPAT_RefrreshBtnTap",event:"tap",delegate:"#OUTP_INPAT_RefrreshBtn"},{fn:"onOUPT_IPL_AllBtnTap",event:"tap",delegate:"#OUPT_IPL_AllBtn"},{fn:"onOUPT_IPL_InCaseBtnTap",event:"tap",delegate:"#OUPT_IPL_InCaseBtn"},{fn:"onOUPT_IPL_Over7BtnTap",event:"tap",delegate:"#OUPT_IPL_Over7Btn"},{fn:"onContainerPainted",event:"painted"}],items:[{xtype:"panel",itemId:"OUTP_InMainPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"ToolBar",items:[{xtype:"selectfield",itemId:"WL_OUTP_IPL_Station",width:300,label:"護理站",displayField:"StationName",valueField:"DeptCode"},{xtype:"button",itemId:"OUTP_INPAT_RefrreshBtn",ui:"decline-round",width:"100px",iconCls:"refresh"}]},{xtype:"panel",itemId:"OUTP_InGridPanel",layout:{type:"fit"}},{xtype:"toolbar",docked:"bottom",itemId:"FootBar",items:[{xtype:"segmentedbutton",itemId:"OUTP_IPL_FnBtn",width:"70%",items:[{xtype:"button",flex:1,itemId:"OUPT_IPL_AllBtn",text:"ALL"},{xtype:"button",flex:1,itemId:"OUPT_IPL_InCaseBtn",text:"已收案"},{xtype:"button",flex:1,itemId:"OUPT_IPL_Over7Btn",text:"大於7日"}]}]}]}]},onContainerDestroy:function(a){if(Ext.getStore("sOutpInOatients")!=null){Ext.getStore("sOutpInOatients").removeAll();Ext.getStore("sOutpInOatients").destroy()}console.log("On Destroy :","OUTP.IpbInPatients");this.removeAll(true,true)},onWL_OUTP_IPL_StationChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadPatientList()}},onOUTP_INPAT_RefrreshBtnTap:function(b,d,a){this.LoadPatientList()},onOUPT_IPL_AllBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#OUTP_IPL_FnBtn"),b,"confirm-round","normal","","",false);var d=Ext.getStore("sOutpInOatients");if(!Ext.isEmpty(d)){d.clearFilter()}d=null;delete d},onOUPT_IPL_InCaseBtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#OUTP_IPL_FnBtn"),b,"confirm-round","normal","","",false);var d=Ext.getStore("sOutpInOatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(!Ext.isEmpty(e.data.CmsDate))},this)}d=null;delete d},onOUPT_IPL_Over7BtnTap:function(b,f,a){NisTRApp.view.Misc.ButtonSelect(this.down("#OUTP_IPL_FnBtn"),b,"confirm-round","normal","","",false);var d=Ext.getStore("sOutpInOatients");if(!Ext.isEmpty(d)){d.clearFilter();d.filterBy(function(e,g){return(e.data.InDays>=7)},this)}d=null;delete d},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadPatientList();this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);this.down("#WL_OUTP_IPL_Station").setStore(Ext.getStore("sWorkStationList"));if(Ext.getStore("sOutpInOatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.OutpatData",storeId:"sOutpInOatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OUTP/search/QueryIpbByStation.ashx",reader:{type:"json"}}})}var a=this;var b=Ext.getCmp("CMS_OutpInPatGrid");if(b==null){b=NisTRApp.view.GridUtility.GenCmsOutpatGrid("CMS_OutpInPatGrid","病人查詢",null,true);b.initialFlag=true;b.getTitleBar().hide();var d=Ext.getStore("sOutpInOatients");b.setStore(d);b.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCmsOutPatGrid,b);this.down("#OUTP_InGridPanel").add(b);b=null;delete b;d=null;delete d}a=null;delete a;this.down("#OUPT_IPL_AllBtn").fireEvent("tap",this.down("#OUPT_IPL_AllBtn"),null,null)},LoadPatientList:function(){var b=this.down("#WL_OUTP_IPL_Station").getValue();var a={DeptCode:b,UserID:NisTRApp.view.SysUtility.GetUserID()};NisTRApp.view.Misc.LoadData("sOutpInOatients",a,true);a=null;delete a;b=null;delete b}});Ext.define("NisTRApp.view.WorkList.OUTP.IpbSearchPatients",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onCMS_REG_REGDatePickerChange2",event:"change",delegate:"#OUTP_SCH_BegDatePicker"},{fn:"onCMS_REG_REGDatePickerChange11",event:"change",delegate:"#OUTP_SCH_EndDatePicker"},{fn:"onOUTP_SCH_ClearBtnTap",event:"tap",delegate:"#OUTP_SCH_ClearBtn"},{fn:"onOUTP_SCH_WaitBtnTap",event:"tap",delegate:"#OUTP_SCH_WaitBtn"},{fn:"onOUTP_SCH_QueryBtnTap",event:"tap",delegate:"#OUTP_SCH_QueryBtn"},{fn:"onOUTP_SCH_CmsStatusChange",event:"change",delegate:"#OUTP_SCH_CmsStatus"},{fn:"onOUTP_SCH_InpStatusTap",event:"tap",delegate:"#OUTP_SCH_InpStatus"},{fn:"onContainerPainted",event:"painted"}],items:[{xtype:"panel",itemId:"OUTP_SchMainPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"ToolBar",items:[{xtype:"selectfield",itemId:"OUTP_SCH_UserID",label:"個管師",displayField:"NameCH",valueField:"EmpNO"},{xtype:"datepickerfield",itemId:"OUTP_SCH_BegDatePicker",width:"26%",label:"收案日期",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"OUTP_SCH_EndDatePicker",width:"20%",label:"~",labelWidth:"15%",value:{year:2015,month:4,day:1},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2013,yearText:"年",yearTo:2020,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"button",itemId:"OUTP_SCH_ClearBtn",right:"180px",ui:"confirm",width:"80px",text:"收案病人"},{xtype:"button",itemId:"OUTP_SCH_WaitBtn",right:"90px",ui:"decline",width:"70px",text:"待收"},{xtype:"button",itemId:"OUTP_SCH_QueryBtn",right:"10px",ui:"decline",width:"70px",text:"查詢"}]},{xtype:"toolbar",docked:"top",itemId:"ToolBar2",items:[{xtype:"selectfield",itemId:"OUTP_SCH_CmsStatus",label:"收案狀態",labelWidth:"35%",options:[{text:"待收案",value:"0"},{text:"收案",value:"1"},{text:"結案",value:"2"},{text:"不符合收案條件",value:"4"},{text:"離院病人查詢",value:"5"}]},{xtype:"selectfield",itemId:"OUTP_SCH_InpStatus",label:"住院狀態",labelWidth:"35%",options:[{text:"",value:""},{text:"住院中",value:"1"},{text:"出院",value:"3"}]},{xtype:"selectfield",hidden:true,itemId:"OUTP_SCH_AADReason",label:"原因",options:[{text:"",value:""},{text:"轉院",value:"6"},{text:"一般自動出院",value:"5"},{text:"病危自動出院",value:"A"}]}]},{xtype:"panel",itemId:"OUTP_SchGridPanel",layout:{type:"fit"}}]}]},onContainerDestroy:function(a){if(Ext.getStore("sOutpSearchPatients")!=null){Ext.getStore("sOutpSearchPatients").removeAll();Ext.getStore("sOutpSearchPatients").destroy()}console.log("On Destroy :","OUTP.IpbPatients");this.removeAll(true,true)},onCMS_REG_REGDatePickerChange2:function(d,a,e,b){if(!this.getInitialFlag()){}},onCMS_REG_REGDatePickerChange11:function(d,a,e,b){if(!this.getInitialFlag()){}},onOUTP_SCH_ClearBtnTap:function(b,d,a){this.down("#OUTP_SCH_EndDatePicker").setValue(new Date());this.down("#OUTP_SCH_BegDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-1));this.down("#OUTP_SCH_UserID").setValue(NisTRApp.view.SysUtility.GetUserID());this.down("#OUTP_SCH_CmsStatus").setValue("1");this.down("#OUTP_SCH_InpStatus").setValue("");this.LoadPatientList()},onOUTP_SCH_WaitBtnTap:function(b,d,a){this.down("#OUTP_SCH_EndDatePicker").setValue(new Date());this.down("#OUTP_SCH_BegDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-1));this.down("#OUTP_SCH_UserID").setValue("");this.down("#OUTP_SCH_CmsStatus").setValue("0");this.down("#OUTP_SCH_InpStatus").setValue("");this.LoadPatientList()},onOUTP_SCH_QueryBtnTap:function(b,d,a){this.LoadPatientList()},onOUTP_SCH_CmsStatusChange:function(a,e,b,d){this.down("#OUTP_SCH_AADReason").setHidden(e!="5");this.down("#OUTP_SCH_UserID").setHidden(e=="5");this.down("#OUTP_SCH_AADReason").setValue("");if(e=="5"){this.down("#OUTP_SCH_UserID").setValue("")}},onOUTP_SCH_InpStatusTap:function(a){},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.down("#OUTP_SCH_UserID").setValue(NisTRApp.view.SysUtility.GetUserID());this.setInitialFlag(false)}},initialize:function(){this.callParent();this.setInitialFlag(true);if(Ext.getStore("sCmsNurses").getCount()<=0){Ext.getStore("sCmsNurses").load()}this.down("#OUTP_SCH_EndDatePicker").setValue(new Date());this.down("#OUTP_SCH_BegDatePicker").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-1));this.down("#OUTP_SCH_UserID").setStore(Ext.getStore("sCmsNurses"));if(Ext.getStore("sOutpSearchPatients")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.CMS.OutpatData",storeId:"sOutpSearchPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:50000,url:SYS_CONST.ApiRoot+"OUTP/search/SearchIpb.ashx",reader:{type:"json"}}})}var a=this;var d=Ext.getCmp("CMS_SearchOutpPatGrid");if(d==null){d=NisTRApp.view.GridUtility.GenCmsOutpatGrid("CMS_SearchOutpPatGrid","病人查詢",null,true);d.initialFlag=true;d.getTitleBar().hide();var b=Ext.getStore("sOutpSearchPatients");d.setStore(b);d.addListener("itemtap",NisTRApp.view.GridUtility.ItemSingleTapCmsOutPatGrid,d);this.down("#OUTP_SchGridPanel").add(d);d=null;delete d;b=null;delete b}a=null;delete a},LoadPatientList:function(){if(Ext.getStore("sOutpSearchPatients").isLoading()){return}var a=Ext.getStore("sOutpSearchPatients");a.removeAll();a.getProxy().setExtraParams({InpStatus:this.down("#OUTP_SCH_InpStatus").getValue(),CmsStatus:this.down("#OUTP_SCH_CmsStatus").getValue(),BegDate:this.down("#OUTP_SCH_BegDatePicker").getFormattedValue("Ymd"),EndDate:this.down("#OUTP_SCH_EndDatePicker").getFormattedValue("Ymd"),CmsUserID:this.down("#OUTP_SCH_UserID").getValue(),AADReason:this.down("#OUTP_SCH_AADReason").getValue()});a.load();a=null;delete a;id=null;delete id}});Ext.define("NisTRApp.view.OUTP.WorkList",{extend:Ext.Container,config:{stopDistroyEvent:false,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"list",itemId:"OUTPWK_List",emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無工作清單.</div>',itemTpl:Ext.create("Ext.XTemplate","<table >","<tr>",'<td id={ItemName} rowspan="1" align="left" width="220px">    {ItemName} </td>','<td width="10px" align="left">&nbsp;&nbsp;</td>  ',"    ",'<td rowspan="1" align="right" width="64px">',"    ",'     <img name="img" src={[this.FinishChk(values.IsFinished)]} style="width:40px;height:40px;">'," </td>",'<td rowspan="1" align="right" width="300px">',"    ","    <span>{DisplayMsg}</span>"," </td>    ","</tr>","     ","</table>","",{FinishChk:function(a){if(a){return"../_/img/FrmFinish.png"}else{return"../_/img/FrmAdd.png"}}})},{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"OUTPWK_CloseBtn",right:"5px",ui:"confirm",width:"20%",text:"關 閉"},{xtype:"button",itemId:"OUTPWK_RefershBtn",ui:"decline",width:"20%",text:"重 新 整 理"}]}],listeners:[{fn:"onRISWK_ListItemTap",event:"itemtap",delegate:"#OUTPWK_List"},{fn:"onRISWK_CloseBtnTap",event:"tap",delegate:"#OUTPWK_CloseBtn"},{fn:"onRISWK_RefershBtnTap",event:"tap",delegate:"#OUTPWK_RefershBtn"},{fn:"onContainerShow",event:"show"},{fn:"onContainerDestroy",event:"destroy"}]},onRISWK_ListItemTap:function(b,f,g,d,h,j){_outpWkFrmEdit_callback_event=function(m){try{if(!Ext.isEmpty(Ext.getStore("sOutpWorkingList"))){Ext.getStore("sOutpWorkingList").load()}if(null!=m&&undefined!=m&&"TempSave"==m){NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800)}else{if(!Ext.isEmpty(Ext.getCmp("_wklistFormPanel"))){Ext.getCmp("_wklistFormPanel").destroy()}}}catch(n){console.error("_outpWkFrmEdit_callback_event",n)}};var a=function a(m,r,n){if(Ext.getStore("sOutpWorkingList").isLoading()||Ext.isEmpty(r)||Ext.isEmpty(r.data.InpNO)||Ext.isEmpty(m)||Ext.isEmpty(m.data.ItemID)){return}var s=d.data.WorkType.split("_");if(Ext.isEmpty(s)||s.length<2){s=null;delete s;Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}var p,q,o;if(r.data.Source.Type==1){p="0";q=r.data.Source.Name;o=0}else{if(r.data.Source.Type==2){p=r.data.InpNO;q=r.data.Source.Name;o=0}else{Ext.Msg.alert("OpenFrmWkForm 病人資料錯誤");return}}if(s[1]=="RenderAssesment"){var e=NisTRApp.view.FormUtil.AssessmentAddr(s[1],m.data.ItemID,NisTRApp.view.SysUtility.GetUserID(),r.data.ChartNo,o,"","","_outpWkFrmEdit_callback_event","",p,q);NisTRApp.view.FormUtil.OpenWorkListForm(e,"_wklistFormPanel",n);e=null;delete e}else{if(s[1]=="RenderHeathTeach"){NisTRApp.view.TRUtility.OpenMainUI(r,SYS_CONST.PageDef.NurHealthTeach,n.getCaller());n.getCaller().destroy()}else{if(s[1]=="Notes"){NisTRApp.view.TRUtility.OpenMainUI(r,SYS_CONST.PageDef.NurNotes,n.getCaller());n.getCaller().destroy()}else{if(s[1]=="RenderPrepare"){NisTRApp.view.TRUtility.OpenMainUI(r,SYS_CONST.PageDef.NurPrepare,n.getCaller());n.getCaller().destroy()}}}}s=null;delete s;p=null;q=null;o=null;delete p;delete q;delete o;risInfo=null;delete risInfo};var k=this;if(h.event.target.nodeName=="IMG"){if(Ext.isEmpty(d.data.ItemID)||Ext.isEmpty(d.data.WorkType)){h.preventDefault();k=null;delete k;return false}var l=d.data.WorkType.split("_");if(l[0]=="FRM"){a(d,this.getRecord(),k)}else{if(l[0]=="CATH"){NisTRApp.view.TRUtility.OpenMainUI(this.getRecord(),SYS_CONST.PageDef.Cath,k.getCaller());k.getCaller().destroy()}}l=null;delete l}h.preventDefault();k=null;delete k;a=null;delete a;return false},onRISWK_CloseBtnTap:function(b,d,a){try{if(!this.getStopDistroyEvent()){this.destroy()}}catch(d){this.destroy()}},onRISWK_RefershBtnTap:function(b,d,a){this.LoadWorkList()},onContainerShow:function(a,b){if(Ext.getStore("sOutpWorkingList").getCount()<=0){this.LoadWorkList()}},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sOutpWorkingList"))){Ext.getStore("sOutpWorkingList").removeAll();Ext.getStore("sOutpWorkingList").destroy()}_outpWkFrmEdit_callback_event=null;delete _outpWkFrmEdit_callback_event;console.log("on destroy :","OUTP.WorkList");this.removeAll()},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.InpNO)){Ext.Msg.alert("RIS_WorkList 病人資料錯誤");return false}if(Ext.isEmpty(Ext.getStore("sOutpWorkingList"))){Ext.create("Ext.data.Store",{storeId:"sOutpWorkingList",autoLoad:false,model:"NisTRApp.model.mWorkingItem",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OUTP/search/QueryWorkingItem.ashx",reader:{type:"json"}}})}this.down("#OUTPWK_List").setStore(Ext.getStore("sOutpWorkingList"))},LoadWorkList:function(){if(Ext.getStore("sOutpWorkingList").isLoading()||Ext.isEmpty(this.getRecord())){return}var b=this.getRecord();var a=Ext.getStore("sOutpWorkingList");a.removeAll();a.getProxy().setExtraParams({InpNo:b.data.InpNO});a.load();a=null;delete a}});Ext.define("NisTRApp.view.ClincSearchPanel",{extend:Ext.Panel,statics:{Create:function(b,a){if(!Ext.isEmpty(Ext.getCmp("_clincSearchPanel"))){Ext.getCmp("_clincSearchPanel").destroy()}if(Ext.isEmpty(Ext.getCmp("_clincSearchPanel"))){var d=Ext.create("NisTRApp.view.ClincSearchPanel",{id:"_clincSearchPanel",modal:true,centered:true,hideOnMaskTap:false,height:"65%",width:"65%",caller:b,callBackFn:a});d.showBy(b,"cc-cc");commonPanel=null;delete d}parent=null;delete parent;patInfo=null;delete patInfo;wi=null;delete wi;he=null;delete he}},config:{centered:true,height:480,width:560,hideOnMaskTap:true,layout:{type:"fit"},modal:true,caller:{},callBackFn:{},items:[{xtype:"toolbar",docked:"top",itemId:"HeadBar",items:[{xtype:"searchfield",itemId:"clincKeyField",width:300,label:"",labelWidth:"1%",placeHolder:"請輸入名稱或代碼"},{xtype:"button",itemId:"QueryBtn",ui:"decline",width:"120px",iconCls:"refresh",text:"查 詢"},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"CloseBtn",margin:"5 5 5 5",right:"1px",style:"float:left;font-size:16px;",ui:"plain",width:"60px",text:"MyButton16"}]},{xtype:"panel",itemId:"MainPanel",layout:{type:"fit"},items:[{xtype:"list",itemId:"ClincList",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-top:10%; color:red; font-weight:bold;">無資料.</div>',itemTpl:["<div>",'	<table width="100%">',"        <tr>",'            <td width="55%">{ClinName}</td>','            <td width="35%">{ClinCode}</td>','            <td width="10%">','                <img id=IMPORT_{ClinCode} src= "../_/img/CursorClick.png" alt="Smiley face" height="26" width="26">',"            </td>","        </tr>","    </table>","</div>"]}]}],listeners:[{fn:"onQueryBtnTap",event:"tap",delegate:"#QueryBtn"},{fn:"onCloseBtnTap",event:"tap",delegate:"#CloseBtn"},{fn:"onClincListItemTap",event:"itemtap",delegate:"#ClincList"},{fn:"onPanelDestroy",event:"destroy"}]},onQueryBtnTap:function(b,d,a){this.LoadData()},onCloseBtnTap:function(b,d,a){try{this.destroy()}catch(d){console.error(d);this.destroy()}},onClincListItemTap:function(b,f,g,d,h,j){var a=function a(n,m){if(!Ext.isEmpty(m.getCallBackFn())&&Ext.isFunction(m.getCallBackFn())){var e=m.getCallBackFn();e(n,m.getCaller());e=null;delete e}};var k=this;var l=h.event.target.id.split("_");if(null==l||l.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"){switch(l[0]){case"IMPORT":a(d,k);try{this.destroy()}catch(h){}break;default:break}h.preventDefault()}l=null;delete l;k=null;delete k;a=null;delete a;return false},onPanelDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sSearchClinc"))){Ext.getStore("sSearchClinc").removeAll();Ext.getStore("sSearchClinc").destroy()}console.log("on destroy :","ClincSearchPanel");this.removeAll()},initialize:function(){this.callParent();if(Ext.getStore("sSearchClinc")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.mSysClinc",storeId:"sSearchClinc",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QuerySysClinc.ashx",reader:{type:"json"},timeout:8000,}})}this.down("#ClincList").setStore(Ext.getStore("sSearchClinc"));var a=this.down("#clincKeyField");a.setValue("");a.addListener("keyup",function(b,f,d){if(f.event.keyCode==13){this.down("#QueryBtn").fireEvent("tap");this.down("#clincKeyField").focus()}},this);a=null;delete a},LoadData:function(){if(Ext.getStore("sSearchClinc").isLoading()){return}var a=this.down("#clincKeyField").getValue();if(Ext.isEmpty(a)){return}var b=Ext.getStore("sSearchClinc");b.getProxy().setExtraParams({key:a});b.removeAll();b.load({callback:function(e,d,f){if(!Ext.isEmpty(e)&&e.length>0){if(e[0].data.ClinCode=="0"){e[0].destroy()}}},scope:this});b=null;delete b}});Ext.define("NisTRApp.view.ConsoultRecordPanel",{extend:Ext.Panel,statics:{OpenRpt:function(e,d,b){if((!Ext.isEmpty(e.data.EmrID))&&(e.data.Status=="3")){var a=String.format("{3}/Gateway/ws/EMR/EMRReport.ashx?ChartNo={0}&ProgDate={1}&ProgTime={2}",e.data.ChartNO,e.data.ProgDate,e.data.ProgTime,NisTRApp.view.SysUtility.SysServer());NisTRApp.view.ScrollablePanel.Create(a,"_wklistScrollablePanel",this);a=null;delete a}else{var a=String.format("{3}/Consult/Consult_03.asp?PAT_IDNO={0}&PROG_DATE={1}&PROG_TIME={2}&LOG_USER_ID={4}",e.data.ChartNO,e.data.ProgDate,e.data.ProgTime,NisTRApp.view.SysUtility.SysServer(),NisTRApp.view.SysUtility.GetUserID());NisTRApp.view.ScrollablePanel.Create(a,"_wklistScrollablePanel",this);a=null;delete a}}},config:{stopDistroyEvent:false,initialFlag:true,centered:false,height:"100%",width:"100%",layout:{type:"fit"},modal:false,caller:{},items:[{xtype:"panel",itemId:"MainPanel",tpl:Ext.create("Ext.XTemplate","",'<div id="_consoultActive" class="globalList" >','<table id="_consoultActiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","","        <tr>",'            <th width="10%">會診類別</th>','            <th width="15%">預計會診日</th>','            <th width="10%">提報人員</th>','            <th width="10%">提報醫師</th>','            <th width="15%">會診對象</th>','            <th width="10%">會診科別</th>','            <th width="10%">共照</th>','            <th width="10%">狀態</th>','			<th width="10%">內容</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"","                <tr>","                    ",'                    <td width="10%" align="center">{EmrType}</td>','                    <td width="15%" align="center">{[NisTRApp.view.TRUtility.BirthdayFormat(values.ConsDate)]} <br> {[NisTRApp.view.DateUtil.FormatRegTime(values.ConsTime)]}</td>','                    <td width="10%"  align="center">{UserName}</td>','                    <td width="10%"  align="center">{DocName}</td>','                    <td width="10%"  align="center">{ConsToName}</td>','                    <td width="10%"  align="center">{HdeptName}</td>','                    <td width="10%"  align="center">{[this.ShareCare(values)]}</td>','                    <td width="10%"  align="center">{StatusName}</td>','                    <td width="10%"  align="center"><a id="btnView" name="viewReport" class="link-btn" keyone="{ChartNO}{ProgDate}{ProgTime}" chartno="{ChartNO}" progdate="{ProgDate}" progtime="{ProgTime}" status="{Status}">View</a></td>                    ',"","                </tr>","            ","   ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="10%">會診類別</th>','            <th width="15%">預計會診日</th>','            <th width="10%">提報人員</th>','            <th width="10%">提報醫師</th>','            <th width="15%">會診對象</th>','            <th width="10%">會診科別</th>','            <th width="10%">共照</th>','            <th width="10%">狀態</th>','			<th width="10%">內容</th>',"","        </tr>      ","    </tfoot>    ","","</table>","    ","</div>","",{ShareCare:function(a){if(Ext.isEmpty(a.ShareCare)||a.ShareCare!="Y"){return""}else{return"<img src='../_/img/green_alert.gif' width='20' height='20' title='此會診有共照收案'>"}}}),layout:{type:"fit"},scrollable:"vertical"},{xtype:"toolbar",docked:"top",itemId:"HeadBar",items:[{xtype:"button",itemId:"QueryBtn",right:"90px",ui:"decline",width:"120px",iconCls:"refresh",text:"查 詢"},{xtype:"button",html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"CloseBtn",margin:"5 5 5 5",right:"1px",style:"float:left;font-size:16px;",ui:"plain",width:"60px",text:"MyButton16"}]}],listeners:[{fn:"onQueryBtnTap",event:"tap",delegate:"#QueryBtn"},{fn:"onCloseBtnTap",event:"tap",delegate:"#CloseBtn"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelPainted",event:"painted"}]},onQueryBtnTap:function(b,d,a){this.LoadData()},onCloseBtnTap:function(b,d,a){try{this.destroy()}catch(d){console.error(d);this.destroy()}},onPanelDestroy:function(a){if(Ext.getStore("sConsoultInfo")!=null){Ext.getStore("sConsoultInfo").removeAll();Ext.getStore("sConsoultInfo").destroy()}_callFn=null;delete _callFn;console.log("On Destroy","ConsoultRecordPanel");this.removeAll(true,true)},onPanelPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadData()}},initialize:function(){this.callParent();if(this.getStopDistroyEvent()){this.down("#CloseBtn").setHidden(true)}if(Ext.data.ModelManager.getModel("mConsoultRecord")==null){Ext.define("mConsoultRecord",{extend:Ext.data.Model,config:{fields:[{name:"EmrType",type:"string"},{name:"EmrID",type:"string"},{name:"ConsType",type:"string"},{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"int"},{name:"CSource",type:"string"},{name:"ProgDate",type:"string"},{name:"ProgTime",type:"string"},{name:"ConsDate",type:"string"},{name:"ConsTime",type:"string"},{name:"XordNO",type:"string"},{name:"UserName",type:"string"},{name:"DocName",type:"string"},{name:"ConsTo",type:"string"},{name:"ConsToName",type:"string"},{name:"HdeptName",type:"string"},{name:"StatusName",type:"string"},{name:"Status",type:"string"},{name:"ShareCare",type:"string"},{convert:function(a,b){return b.data.ChartNO+b.data.ProgDate+b.data.ProgTime},name:"KeyOne",type:"string"}]}})}if(Ext.data.ModelManager.getModel("mConsoultInfo")==null){Ext.define("mConsoultInfo",{extend:Ext.data.Model,config:{fields:[{name:"ChartNO",type:"string"}],hasMany:[{associatedName:"Records",associationKey:"Records",model:"mConsoultInfo",foreignKey:"Records",name:"Records"},{associationKey:"Records",primaryKey:"KeyOne",model:"mConsoultRecord",name:"records"}]}})}if(Ext.isEmpty(Ext.getStore("sConsoultInfo"))){Ext.create("Ext.data.Store",{storeId:"sConsoultInfo",model:"mConsoultInfo",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"Search/QueryConsoultRecord.ashx",reader:{type:"json"}}})}Ext.getStore("sConsoultInfo").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sConsoultInfo").addListener("load",function(d,b,f,a,e){this.RenderTable();this.setMasked(false)},this)},RenderTable:function(){if(Ext.isEmpty(this)||Ext.isEmpty(this.down("#MainPanel"))){return false}g=function g(h,k,l,m){var j=Ext.getStore("sConsoultInfo").getAt(0).records().find("KeyOne",$(h).attr("keyone"));if(j>=0){m(Ext.getStore("sConsoultInfo").getAt(0).records().getAt(j),k,l)}j=null;delete j};var f=Ext.getStore("sConsoultInfo");this.down("#MainPanel").setHtml("");if(f.getCount()>0){var d=this;var a=d.getRecord();if(!Ext.isEmpty(this)&&!Ext.isEmpty(this.down("#MainPanel"))){this.down("#MainPanel").setHtml("");if(!Ext.isEmpty(f.getAt(0))){var e=this.down("#MainPanel").getTpl().apply(f.getAt(0).data);this.down("#MainPanel").setHtml(e);var b=NisTRApp.view.SysUtility.tapEventName();$("a[name='viewReport']").bind(b,function(){g(this,d,a,NisTRApp.view.ConsoultRecordPanel.OpenRpt)});e=null;delete e;b=null;delete b}}}f=null;delete f},LoadData:function(){if(Ext.getStore("sConsoultInfo").isLoading()){return}var a=this.getRecord();var b=Ext.getStore("sConsoultInfo");b.removeAll();b.getProxy().setExtraParams({ChartNo:a.data.ChartNO});b.load();b=null;delete b;a=null;delete a}});Ext.define("NisTRApp.view.ScrollablePanel",{extend:Ext.Panel,statics:{Create:function(a,f,b){if(Ext.isEmpty(a)){Ext.Msg.alert("ScrollablePanel 表單網址錯誤");return}if(Ext.isEmpty(f)){f="_wklistScrollablePanel"}try{var d=Ext.getCmp(f);if(!Ext.isEmpty(d)){d.destroy()}if(Ext.isEmpty(d)){d=Ext.create("NisTRApp.view.ScrollablePanel",{id:f,centered:true,modal:true,url:a,height:NisTRApp.view.SysUtility.ClcHeight(95),width:NisTRApp.view.SysUtility.ClcWidth(95)})}if(!Ext.isEmpty(d)){Ext.Viewport.addListener("resize",function(h,e){this.setWidth(NisTRApp.view.SysUtility.ClcWidth(95));this.setHeight(NisTRApp.view.SysUtility.ClcHeight(95))},d);d.setCaller(b);d.setCloseFn(function(e){});Ext.Viewport.add(d);d.show()}d=null;delete d;a=null;delete a}catch(g){console.log(g)}}},config:{frameID:"ScrollableFrame",divID:"ScrollableDiv",classID:"ScrollableClass",height:"100%",width:"100%",url:{},callback:{},successFn:{},failedFn:{},caller:{},closeFn:{},loadedFn:{},items:[{xtype:"panel",height:"100%",html:'<div id="ScrollableDiv" style="height: 100%; width: 100%; line-height: 0; margin: 0; padding: 0; border: 0;"><iframe id="ScrollableFrame"  width="100%" height="100%" frameborder="0" style="overflow-y: scroll !important; -webkit-overflow-scrolling: touch !important;"></iframe></div>',itemId:"MainPanel",style:"overflow: auto; -webkit-overflow-scrolling: touch;",width:"100%"},{xtype:"toolbar",docked:"bottom",itemId:"ScrollableToolbar",items:[{xtype:"button",itemId:"Scrollable_FormBackBtn",ui:"confirm-back",width:"200px",text:"關 閉"},{xtype:"button",itemId:"Scrollable_FormRefresh",left:"",right:"10px",ui:"decline",width:"200px",text:"重 新 整 理"}]}],listeners:[{fn:"onScrollable_FormBackBtnTap",event:"tap",delegate:"#Scrollable_FormBackBtn"},{fn:"onScrollable_FormRefreshTap",event:"tap",delegate:"#Scrollable_FormRefresh"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelShow",event:"show"}]},onScrollable_FormBackBtnTap:function(d,f,b){var g=this.getCloseFn();var a=this.getCaller();g(a);this.destroy()},onScrollable_FormRefreshTap:function(b,f,a){try{this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});this.ResetContentDiv(this.down("#MainPanel"),this.getDivID(),this.getFrameID(),this.getClassID());var d=this;NisTRApp.view.Misc.createResizeFrameContent($("#"+this.getDivID()),this.getUrl(),this.getFrameID(),function(){if(!Ext.isEmpty(d)){d.setMasked(false);var e=d.getLoadedFn();if(!Ext.isEmpty(e)&&Ext.isFunction(e)){e(d.getDivID(),d.getFrameID(),d.getCaller())}e=null;delete e;d=null;delete d}Ext.Viewport.setMasked(false)})}catch(f){}},onPanelDestroy:function(a){this.ResetContentDiv(this.down("#MainPanel"),this.getDivID(),this.getFrameID(),this.getClassID());me=null;delete me;console.log("ScrollablePanel On Destroy");this.removeAll(true,true)},onPanelShow:function(a,b){console.log("ScrollablePanel Connect To:",this.getUrl());this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});this.ResetContentDiv(this.down("#MainPanel"),this.getDivID(),this.getFrameID(),this.getClassID());var d=this;NisTRApp.view.Misc.createResizeFrameContent($("#"+this.getDivID()),this.getUrl(),this.getFrameID(),function(){if(!Ext.isEmpty(d)){d.setMasked(false);var e=d.getLoadedFn();if(!Ext.isEmpty(e)&&Ext.isFunction(e)){e(d.getDivID(),d.getFrameID(),d.getCaller())}e=null;delete e;d=null;delete d}Ext.Viewport.setMasked(false)})},initialize:function(){this.callParent();if(Ext.isEmpty(this.getUrl())){Ext.Msg.alert("網址錯誤");return false}this.ResetContentDiv(this.down("#MainPanel"),this.getDivID(),this.getFrameID(),this.getClassID());return},ResetContentDiv:function(a,f,d,e){if($("#"+f)!=null&&$("#"+f)!=undefined){$("#"+f).find("iframe").remove();$("#"+f).empty()}if(null!=a&&undefined!=a){var b=String.format('<div id="{0}" class= "{2}" style="height: 100%; width: 100%; line-height: 0; margin: 0; padding: 0; border: 0;"><iframe id="{1}"  width="100%" height="100%" frameborder="0" style="overflow-y: scroll !important; -webkit-overflow-scrolling: touch !important;"></iframe></div>',f,d,(Ext.isEmpty(e)?"ScrollableClass":e));a.setHtml(b);b=null;delete b}}});Ext.define("NisTRApp.view.WorkList.OUTP.Report",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"MainTabPanel"}],listeners:[{fn:"onContainerDestroy",event:"destroy"}]},onContainerDestroy:function(a){console.log("On Destroy :","OUTP.Report");this.removeAll(true,true)},initialize:function(){this.callParent();var a=Ext.create("NisTRApp.view.WorkList.OUTP.Report.OINRPT",{id:"_outpRptOinRpt",itemId:"_outpRptOinRpt",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"申報清單"});this.down("#MainTabPanel").add(a);a=null;delete a;var b=Ext.create("NisTRApp.view.WorkList.OUTP.Report.Statistics",{id:"_outpRptOinStatic",itemId:"_outpRptOinStatic",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"統計資料"});this.down("#MainTabPanel").add(b);b=null;delete b;var d=Ext.create("NisTRApp.view.WorkList.OUTP.Report.ToExcel",{id:"_outpRptOinToExcel",itemId:"_outpRptOinToExcel",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"轉檔"});this.down("#MainTabPanel").add(d);d=null;delete d}});Ext.define("NisTRApp.view.WorkList.OUTP.Report.OINRPT",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"OINRPT_MainPanel",tpl:Ext.create("Ext.XTemplate","",'<div id="_cmsOinRptActive" class="smallList" >','<table id="_cmsOinRptActiveTable" style="width:100%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","","        <tr>",'            <th width="3%">No.</th>','            <th width="5%">性別</th>','            <th width="8%">病歷號</th>','            <th width="10%">病人姓名</th>','            <th width="9%">入院日</th>','            <th width="5%">護理站</th>','            <th width="6%">床號</th>','            <th width="7%">已拋醫令</th>','            <th width="9%">結案日</th>','			<th width="6%">共照註記</th>','            <th width="9%">出院日期</th>','            <th width="7%">出院時間</th>','            <th width="9%">收案日期</th>','            <th width="7%">個管師</th>',"        </tr>","    </thead>","","    <tbody>",'        <tpl for="Records">',"","                <tr>",'                    <td width="3%"  align="center">{[xindex]}</td>','                    <td width="5%"  align="center"><img id="OINRPT_SEX_{InpNO}" src="../_/img/{[this.sexstr(values)]}.png" alt="Smiley face" height="25" width="25"></td>','                    <td width="9%"  align="center"><a id="OINRPT_MainView1_{InpNO}" name="MainUIView" class="link-btn" keyone="{InpNO}">{ChartNO}</a></td>','                    <td width="10%" align="center"><a id="OINRPT_btnView1_{InpNO}" name="InCaseView" class="link-btn" keyone="{InpNO}">{PatName}</a></td>','                    <td width="9%"  align="center">{[NisTRApp.view.TRUtility.BirthdayFormat(values.InDate)]}</td>','                    <td width="5%"  align="center">{NowStationNO}</td>','                    <td width="6%"  align="center">{NowBedNO}</td>','                    <td width="7%"  align="center">{CodeNO}</td>','                    <td width="9%"  align="center"><span style="color:red;">{[NisTRApp.view.TRUtility.BirthdayFormat(values.CloseDate)]}</span></td>','                    <td width="6%"  align="center"><span style="color:green; font-weight: bold;">{CooperationFlag}</span></td>','                    <td width="8%" align="center">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutDate)]}</td>     ','					<td width="7%" align="center">{[NisTRApp.view.DateUtil.FormatRegTime(values.OutTime)]}</td>','                    <td width="9%" align="center">{[NisTRApp.view.TRUtility.BirthdayFormat(values.CmsDate)]}</td>','                    <td width="7%"  align="center"><a id="OINRPT_btnView2_{InpNO}" name="InCaseView" class="link-btn" keyone="{InpNO}" >{CmsUserName}</a></td> ',"                </tr>","            ","   ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="3%">No.</th>','            <th width="5%">性別</th>','            <th width="8%">病歷號</th>','            <th width="10%">病人姓名</th>','            <th width="9%">入院日</th>','            <th width="5%">護理站</th>','            <th width="6%">床號</th>','            <th width="7%">已拋醫令</th>','            <th width="9%">結案日</th>','			<th width="6%">共照註記</th>','            <th width="9%">出院日期</th>','            <th width="7%">出院時間</th>','            <th width="9%">收案日期</th>','            <th width="7%">個管師</th>',"","        </tr>      ","    </tfoot>    ","","</table>","    ","</div>",{sexstr:function(a){return a.Sex+((!String.IsNull(a.ChartExpire)&&a.ChartExpire=="Y")?"Death":"")}}),scrollable:"vertical"},{xtype:"toolbar",docked:"bottom",itemId:"OINRPT_ToolBar",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"420px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"OINRPT_BegDate",width:"55%",label:"出院日",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"OINRPT_EndDate",width:"45%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"OINRPT_RefreshBtn",right:"3px",ui:"decline",width:"80px",iconCls:"refresh"},{xtype:"button",itemId:"OINRPT_DownloadBtn",right:"103px",ui:"confirm-round",width:"120px",text:"下載Excel"}]}],listeners:[{fn:"onOINRPT_RefreshBtnTap",event:"tap",delegate:"#OINRPT_RefreshBtn"},{fn:"onOINRPT_DownloadBtnTap",event:"tap",delegate:"#OINRPT_DownloadBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onOINRPT_RefreshBtnTap:function(b,d,a){this.LoadData()},onOINRPT_DownloadBtnTap:function(b,f,a){if(Ext.os.deviceType!="Desktop"){NisTRApp.view.Misc.Alert("目前只支援Windows System",0);return}var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OUTP/action/CreateOinExcel.ashx",scope:this,method:"POST",params:{BegDate:this.down("#OINRPT_BegDate").getFormattedValue("Ymd"),EndDate:this.down("#OINRPT_EndDate").getFormattedValue("Ymd")},success:function(e){d.setMasked(false);var h=Ext.decode(e.responseText);if(h.Success&&!Ext.isEmpty(h.FilePath)&&!Ext.isEmpty(h.FileName)){if(Ext.os.deviceType=="Desktop"){var g=String.format("{0}action/DownloadFile.ashx?FilePath={1}&FileName={2}",SYS_CONST.ApiRoot,h.FilePath,h.FileName);window.open(g)}}else{NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0))}h=null;delete h;d=null;delete d},failure:function(){d.setMasked(false);d=null;delete d}});return},onContainerDestroy:function(a){if(Ext.getStore("sCmsOinRptInfo")!=null){Ext.getStore("sCmsOinRptInfo").removeAll();Ext.getStore("sCmsOinRptInfo").destroy()}_callOinRptFn=null;delete _callOinRptFn;console.log("On Destroy :","OUTP.Report.OINRPT");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadData()}this.down("#OINRPT_DownloadBtn").setHidden(Ext.os.deviceType!="Desktop")},initialize:function(){this.callParent();this.setInitialFlag(true);this.down("#OINRPT_DownloadBtn").setHidden(Ext.os.deviceType!="Desktop");var a=new Date();this.down("#OINRPT_BegDate").setValue(Ext.Date.getFirstDateOfMonth(a));this.down("#OINRPT_EndDate").setValue(Ext.Date.getLastDateOfMonth(a));a=null;delete a;if(Ext.data.ModelManager.getModel("mCmsOinRptData")==null){Ext.define("mCmsOinRptData",{extend:NisTRApp.model.CMS.OutpatData,config:{fields:[{name:"CloseFlag",type:"string"},{name:"CooperationFlag",type:"string"},{name:"CodeNO",type:"string"},{convert:function(b,d){return d.data.Sex+((!String.IsNull(d.data.ChartExpire)&&d.data.ChartExpire=="Y")?"Death":"")},name:"SexStr3",type:"string"}]}})}if(Ext.data.ModelManager.getModel("mCmsOinRptInfo")==null){Ext.define("mCmsOinRptInfo",{extend:Ext.data.Model,config:{fields:[{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},],hasMany:[{associatedName:"Records",associationKey:"Records",model:"mCmsOinRptInfo",foreignKey:"Records",name:"Records"},{associationKey:"Records",primaryKey:"KeyOne",model:"mCmsOinRptData",name:"records"}]}})}if(Ext.isEmpty(Ext.getStore("sCmsOinRptInfo"))){Ext.create("Ext.data.Store",{storeId:"sCmsOinRptInfo",model:"mCmsOinRptInfo",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"OUTP/search/QueryOinRpt.ashx",reader:{type:"json"}}})}Ext.getStore("sCmsOinRptInfo").addListener("beforeload",function(d,b,e){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sCmsOinRptInfo").addListener("load",function(e,d,g,b,f){this.RenderTable();this.setMasked(false)},this)},RenderTable:function(){if(Ext.isEmpty(this)||Ext.isEmpty(this.down("#OINRPT_MainPanel"))){return false}var a=function a(g,j,k){var h=Ext.getStore("sCmsOinRptInfo").getAt(0).records().find("InpNO",$(g).attr("keyone"));if(h>=0){k(Ext.getStore("sCmsOinRptInfo").getAt(0).records().getAt(h),j)}h=null;delete h};var b=Ext.getStore("sCmsOinRptInfo");this.down("#OINRPT_MainPanel").setHtml("");if(b.getCount()>0){var e=this;if(!Ext.isEmpty(this)&&!Ext.isEmpty(this.down("#OINRPT_MainPanel"))){this.down("#OINRPT_MainPanel").setHtml("");if(!Ext.isEmpty(b.getAt(0))){var f=this.down("#OINRPT_MainPanel").getTpl().apply(b.getAt(0).data);this.down("#OINRPT_MainPanel").setHtml(f);var d=NisTRApp.view.SysUtility.tapEventName();$("a[name='InCaseView']").bind(d,function(){a(this,e,e.OpenInCasePanel)});$("a[name='MainUIView']").bind(d,function(){a(this,e,e.OpenMainUI)});f=null;delete f;d=null;delete d}}}b=null;delete b},LoadData:function(){var a={BegDate:this.down("#OINRPT_BegDate").getFormattedValue("Ymd"),EndDate:this.down("#OINRPT_EndDate").getFormattedValue("Ymd")};NisTRApp.view.Misc.LoadData("sCmsOinRptInfo",a,true);a=null;delete a},OpenInCasePanel:function(b,a){NisTRApp.view.TRUtility.OpenCommonInfoPanel(b,a,"OUTPREPARE")},OpenMainUI:function(b,a){NisTRApp.view.TRUtility.OpenMainUI(b,SYS_CONST.PageDef.Profile,a)}});Ext.define("NisTRApp.view.WorkList.OUTP.Report.Statistics",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",itemId:"MainPanel",tpl:["",'<div id="_cmsStatisticsActive" class="smallList" >',"    ",'<table id="_cmsStatistics1Active" style="width:60%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="2" style="text-align:left">收案人數統計 </th>',"            ","        </tr>","        <tr>",'            <th width="10%">起日</th>','            <th width="10%">迄日</th>','            <th width="10%">待收案</th>','            <th width="10%">已收案</th>','            <th width="10%">結案</th>',"","        </tr>","    </thead>","    <tbody>","         ","                <tr>",'                    <td width="10%"  align="center">{Data1.BegDate}</td>','                    <td width="10%"  align="center">{Data1.EndDate}</td>','                    <td width="10%"  align="center"><span style="color:black;">{Data1.KCnt}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data1.InCaseCnt}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data1.CloseCnt}</span></td>',"                </tr>","    </tbody>","   ","</table>    ","    <h1><br></h1> "," ","","","",'<table id="_cmsStatistics2Active" style="width:80%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="2" style="text-align:left">出院後電訪追蹤 </th>',"            ","        </tr>","        <tr>",'            <th width="10%">起日</th>','            <th width="10%">迄日</th>','            <th width="10%">穩定</th>','            <th width="10%">入急診</th>','            <th width="10%">其他醫療機構</th>','			<th width="10%">再入院</th>','            <th width="10%">死亡</th>','            <th width="10%">其他</th>',"        </tr>","    </thead>","    <tbody>","         ","                <tr>",'                    <td width="10%"  align="center">{Data2.BegDate}</td>','                    <td width="10%"  align="center">{Data2.EndDate}</td>','                    <td width="10%"  align="center"><span style="color:black;">{Data2.Cnt1}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data2.Cnt2}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data2.Cnt3}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data2.Cnt4}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data2.Cnt5}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data2.Cnt6}</span></td>',"                </tr>","    </tbody>","   ","</table>    ","    <h1><br></h1>     ","    ",'<table id="_cmsStatistics3Active" style="width:80%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th   colspan="2" style="text-align:left">跨團隊照護追蹤統計 </th>',"            ","        </tr>","        <tr>",'            <th width="5%">No.</th>','            <th width="15%">標題</th>','            <th width="15%">說明</th>','            <th width="55%">項目</th>','            <th width="10%">次數</th>',"","        </tr>","    </thead>","","    <tbody>",'        <tpl for="Data3">',"","                <tr>",'                    <td width="3%"  align="center">{[xindex]}</td>','                    <td width="15%"  align="center"><span style="color:black;">{Title}</span></td>','                    <td width="15%"  align="center"><span style="color:black;">{PreText}</span></td>','                    <td width="55%"  align="center"><span style="color:black;">{Value}</span></td>','                    <td width="10%"  align="center"><span style="color:biue;">{Cnt}</span></td>',"","                </tr>","            ","   ","        </tpl>        ","   ","","        ","    </tbody>","    ","	<tfoot>","        <tr>",'            <th width="5%">No.</th>','            <th width="15%">標題</th>','            <th width="15%">說明</th>','            <th width="55%">項目</th>','            <th width="10%">次數</th>',"","        </tr>      ","    </tfoot>    ","","</table>","    <h1><br></h1> ","",'<table id="_cmsStatistics41Active" style="width:80%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th colspan="4" style="text-align:left">離院追蹤記錄-轉院 </th>',"            ","        </tr>","        <tr>",'            <th width="10%">起日</th>','            <th width="10%">迄日</th>','            <th width="10%">穩定</th>','            <th width="10%">入急診</th>','            <th width="10%">其他醫療機構</th>','			<th width="10%">再入院</th>','            <th width="10%">死亡</th>','            <th width="10%">其他</th>',"        </tr>","    </thead>","    <tbody>","         ","                <tr>",'                    <td width="10%"  align="center">{Data4.BegDate}</td>','                    <td width="10%"  align="center">{Data4.EndDate}</td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt11}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt12}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt13}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt14}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt15}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt16}</span></td>',"                </tr>","        ","    </tbody>","   ","</table>","    ","    ","    <h1><br></h1> ","",'<table id="_cmsStatistics42Active" style="width:80%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th colspan="4" style="text-align:left">離院追蹤記錄-一般自動出院 </th>',"            ","        </tr>","        <tr>",'            <th width="10%">起日</th>','            <th width="10%">迄日</th>','            <th width="10%">穩定</th>','            <th width="10%">入急診</th>','            <th width="10%">其他醫療機構</th>','			<th width="10%">再入院</th>','            <th width="10%">死亡</th>','            <th width="10%">其他</th>',"        </tr>","    </thead>","    <tbody>","         ","                <tr>",'                    <td width="10%"  align="center">{Data4.BegDate}</td>','                    <td width="10%"  align="center">{Data4.EndDate}</td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt21}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt22}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt23}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt24}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt25}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt26}</span></td>',"                </tr>","        ","    </tbody>","   ","</table>  ","    ","    <h1><br></h1> ","",'<table id="_cmsStatistics43Active" style="width:80%;margin:0 0 0 0;padding:0 0 0 0;" >',"	<thead>","        <tr>",'            <th colspan="4" style="text-align:left">離院追蹤記錄-病危自動出院 </th>',"            ","        </tr>","        <tr>",'            <th width="10%">起日</th>','            <th width="10%">迄日</th>','            <th width="10%">穩定</th>','            <th width="10%">入急診</th>','            <th width="10%">其他醫療機構</th>','			<th width="10%">再入院</th>','            <th width="10%">死亡</th>','            <th width="10%">其他</th>',"        </tr>","    </thead>","    <tbody>","         ","                <tr>",'                    <td width="10%"  align="center">{Data4.BegDate}</td>','                    <td width="10%"  align="center">{Data4.EndDate}</td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt31}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt32}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt33}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt34}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt35}</span></td>','                    <td width="10%"  align="center"><span style="color:black;">{Data4.Cnt36}</span></td>',"                </tr>","        ","    </tbody>","   ","</table>","    ","        ","    <h1><br></h1> ","</div>"],scrollable:"vertical"},{xtype:"toolbar",docked:"bottom",itemId:"ToolBar",items:[{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"420px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"BegDate",width:"55%",label:"出院日",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"EndDate",width:"45%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"RefreshBtn",right:"3px",ui:"decline",width:"80px",iconCls:"refresh"},{xtype:"button",itemId:"DownloadBtn",right:"103px",ui:"confirm-round",width:"120px",text:"下載Excel"}]}],listeners:[{fn:"onRefreshBtnTap",event:"tap",delegate:"#RefreshBtn"},{fn:"onDownloadBtnTap",event:"tap",delegate:"#DownloadBtn"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onRefreshBtnTap:function(b,d,a){this.LoadData()},onDownloadBtnTap:function(b,f,a){if(Ext.os.deviceType!="Desktop"){NisTRApp.view.Misc.Alert("目前只支援Windows System",0);return}var d=this;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"OUTP/action/CreateStatistics1Excel.ashx",scope:this,method:"POST",params:{BegDate:this.down("#BegDate").getFormattedValue("Ymd"),EndDate:this.down("#EndDate").getFormattedValue("Ymd")},success:function(e){d.setMasked(false);var h=Ext.decode(e.responseText);if(h.Success&&!Ext.isEmpty(h.FilePath)&&!Ext.isEmpty(h.FileName)){if(Ext.os.deviceType=="Desktop"){var g=String.format("{0}action/DownloadFile.ashx?FilePath={1}&FileName={2}",SYS_CONST.ApiRoot,h.FilePath,h.FileName);window.open(g)}}else{NisTRApp.view.Misc.Alert(h.Message,(h.Success?800:0))}h=null;delete h;d=null;delete d},failure:function(){d.setMasked(false);d=null;delete d}});return},onContainerDestroy:function(a){if(Ext.getStore("sCmsStatistics")!=null){Ext.getStore("sCmsStatistics").removeAll();Ext.getStore("sCmsStatistics").destroy()}console.log("On Destroy :","OUTP.Report.Statistics");this.removeAll(true,true)},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.setInitialFlag(false);this.LoadData()}this.down("#DownloadBtn").setHidden(Ext.os.deviceType!="Desktop")},initialize:function(){this.callParent();this.setInitialFlag(true);this.down("#DownloadBtn").setHidden(Ext.os.deviceType!="Desktop");var a=new Date();this.down("#BegDate").setValue(Ext.Date.getFirstDateOfMonth(a));this.down("#EndDate").setValue(Ext.Date.getLastDateOfMonth(a));a=null;delete a;if(Ext.data.ModelManager.getModel("mCmsStatistics1Data")==null){Ext.define("mCmsStatistics1Data",{extend:Ext.data.Model,config:{fields:[{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},{name:"KCnt",type:"int"},{name:"InCaseCnt",type:"int"},{name:"CloseCnt",type:"int"}]}})}if(Ext.data.ModelManager.getModel("mCmsStatistics2Data")==null){Ext.define("mCmsStatistics2Data",{extend:Ext.data.Model,config:{fields:[{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},{name:"Cnt1",type:"int"},{name:"Cnt2",type:"int"},{name:"Cnt3",type:"int"},{name:"Cnt4",type:"int"},{name:"Cnt5",type:"int"},{name:"Cnt6",type:"int"}]}})}if(Ext.data.ModelManager.getModel("mCmsStatistics3Data")==null){Ext.define("mCmsStatistics3Data",{extend:Ext.data.Model,config:{fields:[{name:"Title",type:"string"},{name:"PreText",type:"string"},{name:"Value",type:"string"},{name:"Cnt",type:"int"}]}})}if(Ext.data.ModelManager.getModel("mCmsStatistics4Data")==null){Ext.define("mCmsStatistics2Data",{extend:Ext.data.Model,config:{fields:[{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},{name:"Cnt1",type:"int"},{name:"Cnt11",type:"int"},{name:"Cnt12",type:"int"},{name:"Cnt13",type:"int"},{name:"Cnt14",type:"int"},{name:"Cnt15",type:"int"},{name:"Cnt16",type:"int"},{name:"Cnt2",type:"int"},{name:"Cnt21",type:"int"},{name:"Cnt22",type:"int"},{name:"Cnt23",type:"int"},{name:"Cnt24",type:"int"},{name:"Cnt25",type:"int"},{name:"Cnt26",type:"int"},{name:"Cnt3",type:"int"},{name:"Cnt31",type:"int"},{name:"Cnt32",type:"int"},{name:"Cnt33",type:"int"},{name:"Cnt34",type:"int"},{name:"Cnt35",type:"int"},{name:"Cnt36",type:"int"}]}})}if(Ext.data.ModelManager.getModel("mCmsStatistics")==null){Ext.define("mCmsStatistics",{extend:Ext.data.Model,config:{fields:[{name:"BegDate",type:"string"},{name:"EndDate",type:"string"},{name:"Data1",type:"Auto"},{name:"Data2",type:"Auto"},{name:"Data4",type:"Auto"}],hasMany:[{associatedName:"Data3",associationKey:"Data3",model:"mCmsStatistics",foreignKey:"Data3",name:"Data3"},{associationKey:"Data3",primaryKey:"KeyOne",model:"mCmsStatistics3Data",name:"data3"}]}})}if(Ext.isEmpty(Ext.getStore("sCmsStatistics"))){Ext.create("Ext.data.Store",{storeId:"sCmsStatistics",model:"mCmsStatistics",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:30000,url:SYS_CONST.ApiRoot+"OUTP/search/QueryStatistics1.ashx",reader:{type:"json"}}})}Ext.getStore("sCmsStatistics").addListener("beforeload",function(d,b,e){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sCmsStatistics").addListener("load",function(e,d,g,b,f){this.RenderTable();this.setMasked(false)},this)},RenderTable:function(){if(Ext.isEmpty(this)||Ext.isEmpty(this.down("#MainPanel"))){return false}var a=Ext.getStore("sCmsStatistics");this.down("#MainPanel").setHtml("");if(a.getCount()>0){var b=this;if(!Ext.isEmpty(this)&&!Ext.isEmpty(this.down("#MainPanel"))){this.down("#MainPanel").setHtml("");if(!Ext.isEmpty(a.getAt(0))){var d=this.down("#MainPanel").getTpl().apply(a.getAt(0).data);this.down("#MainPanel").setHtml(d);d=null;delete d}}}a=null;delete a},LoadData:function(){var a={BegDate:this.down("#BegDate").getFormattedValue("Ymd"),EndDate:this.down("#EndDate").getFormattedValue("Ymd")};NisTRApp.view.Misc.LoadData("sCmsStatistics",a,true);a=null;delete a},OpenInCasePanel:function(b,a){},OpenMainUI:function(b,a){}});Ext.define("NisTRApp.view.CMS.Treatment.StemCell",{extend:Ext.Container,config:{updateFlag:true,initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},treatStemCell:{},items:[{xtype:"panel",itemId:"CmsTreatStemCellIndex",layout:{type:"card"},items:[{xtype:"panel",hidden:false,itemId:"DataPanel",layout:{type:"fit"},items:[{xtype:"toolbar",docked:"bottom",itemId:"toolbar",items:[{xtype:"button",itemId:"RefreshBtn",ui:"decline",width:"120px",iconCls:"refresh",text:"重新整理"},{xtype:"button",itemId:"CreatBtn",right:"10px",ui:"decline",width:"120px",iconCls:"add",text:"新 增"}]}]},{xtype:"panel",hidden:true,itemId:"EditPanel",layout:{type:"vbox"},items:[{xtype:"toolbar",docked:"bottom",itemId:"toolbar1",items:[{xtype:"button",itemId:"BackBtn",ui:"confirm-back",width:"120px",text:"回 上 頁"}]}]}]}],listeners:[{fn:"onRefreshBtnTap",event:"tap",delegate:"#RefreshBtn"},{fn:"onCreatBtnTap",event:"tap",delegate:"#CreatBtn"},{fn:"onBackBtnTap",event:"tap",delegate:"#BackBtn"},{fn:"onContainerPainted",event:"painted"}]},onRefreshBtnTap:function(b,d,a){this.LoadData()},onCreatBtnTap:function(b,d,a){this.CreatFormEditPanel(this,null)},onBackBtnTap:function(b,d,a){this.down("#EditPanel").removeAll();this.down("#CmsTreatStemCellIndex").setActiveItem(0);this.setTreatStemCell(null);if(this.getUpdateFlag()){this.setUpdateFlag(false);this.LoadData()}},onContainerPainted:function(b,a){this.LoadData()},CreatFormEditPanel:function(d,b){d.down("#EditPanel").removeAll();d.setUpdateFlag(false);d.down("#EditPanel").add(this.CreTreatField());d.down("#CmsTreatStemCellIndex").setActiveItem(1);var a=NisTRApp.view.SysUtility.tapEventName();if(Ext.isEmpty($("#_StemCellOrdSaveBtn")[0])){var e=$('<img src="../_/img/save01.png" id="_StemCellOrdSaveBtn" style="width:28px;height:28px;">');var a=NisTRApp.view.SysUtility.tapEventName();e.unbind(a);e.bind(a,{caller:d,callbackFn:d.SaveStemCell},function(f){try{f.data.callbackFn(f.data.caller)}catch(f){console.log(f)}f.preventDefault();return false});e.appendTo($("#StemCellTreatContracDiv"));e=null;delete e;a=null;delete a}if(!Ext.isEmpty(b)){d.applyData(d,b)}else{d.setTreatStemCell(null)}a=null;delete a},CreTreatField:function(){var e=function e(g,h,f){this.timeField.setValue(new Date())};var d=function d(g,h,f){this.timeField.setValue(null)};var b=Ext.create("Ext.form.FieldSet",{itemId:"StemCellTreatFieldSet",width:"95%",title:'<div id="StemCellTreatContracDiv"><span>Treatment Information</span></div>',layout:"fit",centered:false});var a=Ext.create("Ext.field.Select",{itemId:"TransMethod",label:"移植方式",labelWidth:"26%",width:"99%",options:[{text:"",value:""},{text:"自體",value:"1"},{text:"異體-血親",value:"2"},{text:"異體-非血親",value:"3"},{text:"異體-半相合",value:"4"},{text:"異體-臍帶血",value:"5"}],style:"float:left;font-size:16px;"});b.add(a);a=NisTRApp.view.DateUtil.CreatDateField("TransDate","TransDate","移植日期","37%","70%",null);b.add(a);b.add(NisTRApp.view.DateUtil.CreateCloseBtn("TransDateSetBtn",'<img src="../_/img/labClock.png" style="width:30px;height:30px;"></img>',a,e));b.add(NisTRApp.view.DateUtil.CreateCloseBtn("TransDateCancelBtn",'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',a,d));a=Ext.create("Ext.field.Text",{itemId:"Remark",label:"說明",labelWidth:"26%",width:"99%",maxLength:128,hidden:false,placeHolder:"最多128字",style:"float:left;font-size:16px;"});b.add(a);a=null;delete a;e=null;delete e;d=null;delete d;return b},initialize:function(){this.callParent();this.initialStore();var a=Ext.getCmp("CMS_TreatStemCellGrid");if(a==null){a=this.GenTreatStemCellGrid("CMS_TreatStemCellGrid","CMS_TreatStemCellGrid",null,false);a.initialFlag=true;a.caller=this;a.getTitleBar().hide();var b=Ext.getStore("sTreatStemCell");a.setStore(b);a.addListener("itemtap",this.ItemSingleTapGrid,a);this.down("#DataPanel").add(a);a=null;delete a;b=null;delete b}},SaveStemCell:function(e,b){e.setUpdateFlag(true);var j=e.getRecord();var a=e.getTreatStemCell();var h=(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)&&!Ext.isEmpty(a.data.StemCellID))?a.data.StemCellID:"";var d=e.down("#TransMethod").getRecord();var f={StemCellID:h,CmsID:j.data.CmsID,ChartNO:j.data.ChartNO,TransDate:e.down("#TransDate").getFormattedValue("Ymd"),TransMethod:d.data.value,TransMethodOther:d.data.text,Remark:e.down("#Remark").getValue()};var g=e;g.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentStemCellUpdate.ashx",scope:e,method:"POST",params:{Flag:0,UserID:NisTRApp.view.SysUtility.GetUserID(),StemCellID:h,CmsID:j.data.CmsID,ChartNO:j.data.ChartNO,Json:btoa(encodeURIComponent(JSON.stringify(f)))},success:function(k){g.setMasked(false);var m=Ext.decode(k.responseText);NisTRApp.view.Misc.Alert(m.Message,(m.Success?800:0));if(m.Success){var l=g.getTreatStemCell();if(Ext.isEmpty(l)||Ext.isEmpty(l.data)||Ext.isEmpty(l.data.StemCellID)){l=Ext.create("mTreatStemCell",{CmsID:m.CmsID,StemCellID:m.StemCellID});g.setTreatStemCell(l)}l=null;delete l}m=null;delete m;g=null;delete g;scFn=null;delete scFn},failure:function(){g.setMasked(false);g=null;delete g}});j=null;a=null;cmscellIDRec=null;d=null;f=null},applyData:function(a,f){a.setTreatStemCell(f);if(!Ext.isEmpty(f)&&!Ext.isEmpty(f.data)){var b=f.data;a.down("#TransMethod").setValue(b.TransMethod);a.down("#Remark").setValue(b.Remark);if(!Ext.isEmpty(b.TransDate)){var e=NisTRApp.view.DateUtil.StrToDateTime(b.TransDate);a.down("#TransDate").setValue(e)}}},initialStore:function(){if(Ext.data.ModelManager.getModel("mTreatStemCell")==null){Ext.define("mTreatStemCell",{extend:Ext.data.Model,config:{fields:[{name:"StemCellID",type:"string"},{name:"ChartNO",type:"string"},{name:"TransDate",type:"string"},{name:"TransMethod",type:"string"},{name:"TransMethodOther",type:"string"},{name:"Remark",type:"string"},{name:"CreDate",type:"string"},{name:"CreTime",type:"string"},{name:"CreUserID",type:"string"},{name:"CreUserName",type:"string"},{name:"CmsID",type:"string"},{convert:function(a,b){return b.data.StemCellID},name:"KeyOne",type:"string"}],idProperty:"KeyOne"}})}if(Ext.getStore("sTreatStemCell")==null){Ext.create("Ext.data.Store",{model:"mTreatStemCell",storeId:"sTreatStemCell",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Treatment/QueryStemCell.ashx",reader:{type:"json"}}})}},GenTreatStemCellGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,store:{},title:b,inline:true,initialFalg:true,caller:{},emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">無資料.</div>',height:"100%",width:"100%",columns:[{text:"編輯",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="EDIT_CHECK_{KeyOne}">編 輯</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DELTREATSTEMCELL_CHECK_{KeyOne}" style="border:3px orange double;background-color:red;">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"移植方式",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {TransMethodOther}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false},{text:"移植日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.TransDate)]}</span>',flex:1,width:170,hidden:false,editable:false,sortable:false},{text:"說明",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {Remark}</span>',flex:1,width:250,hidden:false,editable:false,sortable:false},{text:"建檔日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.BirthdayFormat(values.CreDate)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"建檔時間",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {[NisTRApp.view.TRUtility.TimeFormat(values.CreTime)]}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false},{text:"建檔人員",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span style="color:{StyleColor}; font-size: 14px"> {CreUserName}</span>',flex:1,width:110,hidden:false,editable:false,sortable:false}]})},LoadData:function(){var b=this.getRecord();var a={ChartNo:b.data.ChartNO,CmsID:b.data.CmsID};NisTRApp.view.Misc.LoadData("sTreatStemCell",a,true);a=null;delete a;b=null},ItemSingleTapGrid:function(j,d,f,a,g,h){var b=function b(e,m){e.caller.CreatFormEditPanel(e.caller,m)};var l=function l(e,m){Ext.Msg.confirm("Confirm","是否刪除記錄",function(o,q,n){if(o=="no"){return}else{if(o=="yes"){var p=e.caller;p.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/Treatment/TreatmentStemCellDelete.ashx",scope:e.caller,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),StemCellID:m.data.StemCellID},success:function(r){p.setMasked(false);var s=Ext.decode(r.responseText);NisTRApp.view.Misc.Alert(s.Message,(s.Success?800:0));if(s.Success){m.destroy();e.refresh()}s=null;delete s;p=null;delete p;scFn=null;delete scFn},failure:function(){p.setMasked(false);p=null;delete p}})}}},e.caller)};var k=g.event.target.id.split("_");if(null==k||k.length<=0){g.preventDefault();return false}if(g.event.target.nodeName=="IMG"||g.event.target.nodeName=="SPAN"||g.event.target.nodeName=="A"||g.event.target.nodeName=="BUTTON"){switch(k[0]){case"EDIT":b(j,a);break;case"DELTREATSTEMCELL":l(j,a);break;default:break}g.preventDefault()}else{if(g.event.target.nodeName=="INPUT"){}}k=null;delete k;j=null;delete j;b=null;delete b;l=null;delete l;return false}});Ext.define("NisTRApp.view.WorkList.IPB",{extend:Ext.Container,alias:"widget.WL_IPB",config:{layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"WL_IPB_TabPanel",layout:{animation:false,type:"card"}}],listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onContainerDestroy:function(a){this.removeGrobleStore();console.log("On Destroy :","WorkList.IPB");this.removeAll(true,true)},onContainerPainted:function(b,a){},initialize:function(){this.callParent();this.initialGrobleStore();var b=Ext.create("NisTRApp.view.WorkList.IPB.InPatients",{id:"_IPBInPatients",itemId:"_IPBInPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"住院病人"});this.down("#WL_IPB_TabPanel").add(b);b=null;delete b;var a=Ext.create("NisTRApp.view.WorkList.IPB.OutPatients",{id:"_IPBOutPatients",itemId:"_IPBOutPatients",height:"100%",width:"100%",hideOnMaskTap:false,modal:false,title:"出院病人"});this.down("#WL_IPB_TabPanel").add(a);a=null;delete a},removeGrobleStore:function(){},initialGrobleStore:function(){}});Ext.define("NisTRApp.view.WorkList.IPB.OutPatients",{extend:Ext.Container,alias:"widget.WL_IPB_OUTPATIENTS",config:{initialFlag:true,layout:{type:"fit"},items:[{xtype:"tabpanel",itemId:"IPB_OUT_TabPanel"},{xtype:"toolbar",docked:"bottom",itemId:"WL_IPB_OUT_Foot_ToolBar"}],listeners:[{fn:"onContainerPainted",event:"painted"},{fn:"onContainerDestroy",event:"destroy"}]},onContainerPainted:function(b,a){},onContainerDestroy:function(a){console.log("On Destroy :","IPB_OutPatient");this.removeAll(true,true)},initialize:function(){this.callParent()},initialStore:function(){}});Ext.define("NisTRApp.view.WorkList.CMS.Report",{extend:Ext.Container,config:{layout:{type:"fit"},items:[{xtype:"toolbar",docked:"top",itemId:"FunctionBar",items:[{xtype:"selectfield",itemId:"ReportCase",width:"22%",label:"報 表",displayField:"DisplayName",valueField:"PK"},{xtype:"panel",itemId:"FnPanel1",width:"55%",layout:{type:"hbox"},items:[{xtype:"selectfield",itemId:"CancelKinds",width:"30%",label:"癌別",displayField:"TypeName",valueField:"TypeID"},{xtype:"datepickerfield",itemId:"BegDate",width:"35%",label:"日期",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"EndDate",width:"30%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"button",itemId:"QueryBtn",right:"2%",ui:"decline-round",width:"10%",text:"查 詢"},{xtype:"button",itemId:"ToExcelBtn",right:"14%",ui:"confirm-round",width:"10%",text:"下載EXCEL"}]},{xtype:"panel",html:'<div id="cmsrptdiv" class="BSList"  style="height:100%; width: 100 %;"></div>',itemId:"MainPanel",layout:{type:"vbox"},scrollable:"vertical"}],listeners:[{fn:"onReportCaseChange",event:"change",delegate:"#ReportCase"},{fn:"onCancelKindsChange",event:"change",delegate:"#CancelKinds"},{fn:"onBegDateChange",event:"change",delegate:"#BegDate"},{fn:"onEndDateChange",event:"change",delegate:"#EndDate"},{fn:"onQueryBtnTap",event:"tap",delegate:"#QueryBtn"},{fn:"onToExcelBtnTap",event:"tap",delegate:"#ToExcelBtn"},{fn:"onContainerShow",event:"show"}]},onReportCaseChange:function(a,e,b,d){},onCancelKindsChange:function(a,e,b,d){},onBegDateChange:function(d,a,e,b){},onEndDateChange:function(d,a,e,b){},onQueryBtnTap:function(b,d,a){this.setQueryData();this.LoadData()},onToExcelBtnTap:function(f,g,d){var h=this.down("#ReportCase").getRecord();for(var b=0;b<h.data.RptCnt;b++){var a="";if(b>0){a="_"+b}var j="#"+h.data.PK+a;if(!Ext.isEmpty($(j))){$(j).table2excel({name:"Excel Document Name",filename:h.data.DisplayName+a,fileext:".xls",exclude_img:true,exclude_links:true,exclude_inputs:true})}}},onContainerShow:function(a,b){},initialize:function(){this.callParent();this.down("#ToExcelBtn").setHidden((typeof Blob==="undefined")||(Ext.os.deviceType!="Desktop"));this.initialStore();this.down("#ReportCase").setStore(Ext.getStore("sReportOption"));this.down("#CancelKinds").setStore(Ext.getStore("sSysCaClassification"));this.down("#BegDate").setValue(new Date(2017,0,1));this.down("#EndDate").setValue(new Date(2017,11,31))},initialStore:function(){if(Ext.data.ModelManager.getModel("mReportOption")==null){Ext.define("mReportOption",{extend:Ext.data.Model,config:{idProperty:"PK",fields:[{name:"PK",type:"string"},{name:"DisplayName",type:"string"},{name:"panel",type:"string"},{name:"url",type:"string"},{name:"Cancer",type:"string"},{name:"BegDate",type:"date"},{name:"EndDate",type:"date"},{name:"Sort",type:"boolean"},{name:"RptCnt",type:"int"}]}})}if(Ext.getStore("sReportOption")==null){Ext.create("Ext.data.Store",{storeId:"sReportOption",model:"mReportOption",data:[{Sort:false,PK:"RPT1",DisplayName:"業務量",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/OneOne.ashx"),RptCnt:1},{Sort:false,PK:"RPT2",DisplayName:"基本統計",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/OneTwo.ashx"),RptCnt:1},{Sort:false,PK:"RPT3",DisplayName:"追蹤/治療",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/One3.ashx"),RptCnt:1},{Sort:false,PK:"RPT4",DisplayName:"治療完成率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three1.ashx"),RptCnt:1},{Sort:false,PK:"RPT5",DisplayName:"首次治療完成率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three2.ashx"),RptCnt:1},{Sort:true,PK:"RPT6",DisplayName:"未填寫名單",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three3.ashx"),RptCnt:1},{Sort:false,PK:"RPT7",DisplayName:"治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three4.ashx"),RptCnt:1},{Sort:false,PK:"RPT8",DisplayName:"應接受手術治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three5.ashx"),RptCnt:2},{Sort:false,PK:"RPT9",DisplayName:"應接受化療治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three6.ashx"),RptCnt:2},{Sort:false,PK:"RPT10",DisplayName:"應接受放療治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three7.ashx"),RptCnt:2},{Sort:false,PK:"RPT11",DisplayName:"應接受CCRT治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three8.ashx"),RptCnt:2},{Sort:false,PK:"RPT12",DisplayName:"應接受荷爾蒙治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three9.ashx"),RptCnt:2},{Sort:false,PK:"RPT13",DisplayName:"應接受幹細胞治療遵從率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three10.ashx"),RptCnt:2},{Sort:false,PK:"RPT14",DisplayName:"化療拒絕治療率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three11.ashx"),RptCnt:3},{Sort:false,PK:"RPT15",DisplayName:"放療拒絕治療率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three12.ashx"),RptCnt:3},{Sort:false,PK:"RPT20",DisplayName:"化療中斷治療率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three17.ashx"),RptCnt:3},{Sort:false,PK:"RPT21",DisplayName:"放療中斷治療率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three18.ashx"),RptCnt:3},{Sort:false,PK:"RPT16",DisplayName:"失聯率",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three13.ashx"),RptCnt:1},{Sort:false,PK:"RPT17",DisplayName:"結案人數原因",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three14.ashx"),RptCnt:2},{Sort:false,PK:"RPT18",DisplayName:"本院診斷未接受治療名單",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three15.ashx"),RptCnt:1},{Sort:true,PK:"RPT19",DisplayName:"收案超過30日無治療名單",panel:"1",url:(SYS_CONST.ApiRoot+"CMS/BS/Three16.ashx"),RptCnt:1}]})}},LoadData:function(){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1,indicator:false});$("#cmsrptdiv").empty();var a=this.down("#ReportCase").getRecord();Ext.Ajax.request({url:a.data.url,method:"POST",scope:this,params:a.data,success:function(b){this.setMasked(false);$("#cmsrptdiv").append(b.responseText);if(a.data.Sort){var d="#"+a.data.PK;$(d).tablesorter({widgets:["zebra","columns"],usNumberFormat:false,sortReset:true,sortRestart:true})}},failure:function(){$("#cmsrptdiv").empty();this.setMasked(false)}})},setQueryData:function(){var a=this.down("#ReportCase").getRecord();a.data.BegDate=this.down("#BegDate").getValue();a.data.endDate=this.down("#EndDate").getValue();a.data.Cancer=this.down("#CancelKinds").getValue();a=null}});Ext.define("NisTRApp.view.VitalSigns.EventLog",{extend:Ext.Container,alias:"widget.VitalSignsEventLog",config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},items:[{xtype:"panel",html:'<div id="calendar" class="wrapper"></div>',itemId:"MainPanel",styleHtmlContent:true,layout:{type:"fit"},scrollable:false}],listeners:[{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onContainerDestroy:function(a){},onContainerPainted:function(b,a){this.GenfullCalendar(this.getRecord());this.LoadData()},initialize:function(){this.callParent();this.initialStore()},GenfullCalendar:function(h){$("#calendar").fullCalendar("destroy");var e=new Date();var g=e.getDate();var a=e.getMonth();var j=e.getFullYear();var f=String.format("{0}-{1}-{2}",j,a+1,g);$("#calendar").fullCalendar({contentHeight:NisTRApp.view.SysUtility.ClcHeight(70),header:{left:"prev,next today",center:"title",right:"month"},defaultDate:f,defaultView:"month",selectable:true,selectHelper:true,editable:false,eventRender:function(k,d){$(this).css("width","80%");$(this).css("height","80%")},select:function(l,d,k){Ext.callback(this.Scoope.ShowEditPanel,this.Scoope,[l,d,k],200)},eventClick:function(l,k,d){console.log(2,l,k,d)},events:function(n,d,m){console.log(n,d);var k=$("#calendar").fullCalendar("getView").Patient||h;if(Ext.getStore("sChroniclesData").isLoading()||Ext.isEmpty(k)){return}var l=Ext.getStore("sChroniclesData");l.removeAll();l.getProxy().setExtraParams({ChartNo:k.data.ChartNO,InpNo:k.data.InpNO,BegDate:n,EndDate:d});l.load({callback:function(p,o,u){var s=[];for(var r=0;r<p.length;r++){var q=p[r].data;s.push({title:q.Topic+q.Content,start:new Date(q.StartDate.substr(0,4),q.StartDate.substr(4,2)-1,q.StartDate.substr(6,2)),id:q.GroupId,end:new Date(q.EndDate.substr(0,4),q.EndDate.substr(4,2)-1,q.EndDate.substr(6,2)),eventseq:q.EventSeq,grpdate:q.GrpDate,topic:q.Topic,content:q.Content})}m(s)},scope:this});l=null;delete l},eventBackgroundColor:"#E2E2E2",eventColor:"#378006"});var b=$("#calendar").fullCalendar("getView");b.Scoope=this;b.Patient=h;b.UserID=NisTRApp.view.SysUtility.GetUserID()},initialStore:function(){if(Ext.getStore("sChroniclesData")==null){Ext.create("Ext.data.Store",{model:"NisTRApp.model.VitalSigns.ChroniclesData",storeId:"sChroniclesData",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:60000,url:SYS_CONST.ApiRoot+"INP/search/PatientEvent.ashx",reader:{type:"json"}}})}Ext.getStore("sChroniclesData").addListener("beforeload",function(b,a,d){this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1})},this);Ext.getStore("sChroniclesData").addListener("load",function(d,b,f,a,e){this.setMasked(false)},this)},LoadData:function(){},ShowEditPanel:function(g,a,e){console.log(1,g,a,e,this.getRecord());var f=this.getRecord();var d=this;if(!Ext.isEmpty(Ext.getCmp("_EventLogEdit"))){Ext.getCmp("_EventLogEdit").destroy()}if(Ext.isEmpty(Ext.getCmp("_EventLogEdit"))){var b=Ext.create("NisTRApp.view.VitalSigns.EventLog.Edit",{id:"_EventLogEdit",record:f,successFn:null,evenRec:null,caller:d});d.overlay=Ext.Viewport.add(b);b=null;delete b}d.overlay.show()}});Ext.define("NisTRApp.view.VitalSigns.EventLog.Edit",{extend:Ext.Panel,config:{initialFlag:true,centered:true,height:"45%",itemId:"FooterBar",width:"50%",hideOnMaskTap:true,layout:{type:"fit"},modal:true,caller:{},successFn:{},evenRec:{},items:[{xtype:"toolbar",docked:"top",itemId:"HeaderBar",title:"事件"},{xtype:"panel",itemId:"MainPanel",layout:{type:"fit"},items:[{xtype:"fieldset",itemId:"MainSet",items:[{xtype:"datepickerfield",itemId:"EventStart",width:"100%",label:"事件起日",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"EventEnd",width:"100%",label:"事件起日",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2014,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"selectfield",itemId:"EventContent",label:"請選擇"},{xtype:"textfield",itemId:"EventContentText",label:"內容",placeHolder:"請輸入備血、輸血單位(__U)或其他備註"}]}]},{xtype:"toolbar",docked:"bottom",itemId:"FooterBar",items:[{xtype:"button",itemId:"SaveBtn",left:"2%",ui:"decline",width:"40%",text:"資料儲存"},{xtype:"button",itemId:"ClostBtn",right:"5%",ui:"confirm",width:"40%",text:"關閉"}]}],listeners:[{fn:"onClostBtnTap",event:"tap",delegate:"#ClostBtn"}]},onClostBtnTap:function(b,d,a){this.destroy()},initialize:function(){this.callParent()}});Ext.define("NisTRApp.view.WorkList.OUTP.Report.ToExcel",{extend:Ext.Container,config:{initialFlag:true,height:"100%",width:"100%",layout:{type:"fit"},listeners:[{fn:"onContainerDeactivate",event:"deactivate"},{fn:"onExcelUploadBtnTap",event:"tap",delegate:"#ExcelUploadBtn"}],items:[{xtype:"panel",itemId:"MainPanel",items:[{xtype:"fieldset",items:[{xtype:"filefield",itemId:"excelFileField",margin:"5 5 5 5",label:"請選擇Execl",name:"excel",accept:".xlsx,xls"},{xtype:"toolbar",docked:"bottom",margin:"10 10 10 10",ui:"plain",items:[{xtype:"button",centered:true,itemId:"ExcelUploadBtn",ui:"confirm",width:"30%",text:"上 傳"}]}]}]}]},onContainerDeactivate:function(b,a,e,d){},onExcelUploadBtnTap:function(d,h,b){if(Ext.os.deviceType!="Desktop"){NisTRApp.view.Misc.Alert("就說不支援ㄌ，還按！",1200);return}if(Ext.isEmpty(this.down("#excelFileField").getValue())||this.down("#excelFileField").getComponent().input.dom.files[0]==undefined||this.down("#excelFileField").getComponent().input.dom.files[0]==null){NisTRApp.view.Misc.Alert("請選擇檔案！",1200);return}var a=this.down("#excelFileField").getComponent().input.dom.files[0];if(a.type!="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"){NisTRApp.view.Misc.MsgShow("檔案格式不符<br>請選擇Excel 2007檔","注意",1500);return}var g=new FormData();g.append("File",a);g.append("DataType",a.type);var f=this;f.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});$.ajax({url:"../api/OUTP/action/OinUploadRpt.ashx",type:"POST",complete:function(){},xhrFields:{onprogress:function(e){}},progress:function(e){},beforeSend:function(j){},success:function(e){f.setMasked(false);var k=e;if(k.Success&&!Ext.isEmpty(k.FilePath)&&!Ext.isEmpty(k.FileName)){if(Ext.os.deviceType=="Desktop"){var j=String.format("{0}action/DownloadFile.ashx?FilePath={1}&FileName={2}",SYS_CONST.ApiRoot,k.FilePath,k.FileName);window.open(j)}}else{NisTRApp.view.Misc.Alert(k.Message,(k.Success?800:0))}k=null;delete k;f=null;delete f},error:function(j){},data:g,cache:false,contentType:false,processData:false});g=null;delete g},initialize:function(){this.callParent();if(Ext.os.deviceType=="Desktop"){this.down("#ExcelUploadBtn").setText("上 傳")}else{this.down("#ExcelUploadBtn").setText("不支援 IPAD")}}});Ext.define("NisTRApp.store.OPR.sOprInPatients",{extend:Ext.data.Store,config:{model:"NisTRApp.model.OPR.OprmstvEntity",storeId:"sOprInPatients",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:25000,url:"../api/OPR/search/QueryOprInPatients.ashx",reader:{type:"json"}}}});Ext.define("NisTRApp.store.OPR.sOprRooms",{extend:Ext.data.Store,config:{data:[{RoomID:"ALL",RoomName:"ALL",RoomIndex:-1},{RoomID:"0",RoomName:"ICU",RoomIndex:0},{RoomID:"R1",RoomName:"R1",RoomIndex:1},{RoomID:"R2",RoomName:"R2",RoomIndex:2},{RoomID:"R3",RoomName:"R3",RoomIndex:3},{RoomID:"R4",RoomName:"R4",RoomIndex:4},{RoomID:"R5",RoomName:"R5",RoomIndex:5},{RoomID:"R6",RoomName:"R6",RoomIndex:6},{RoomID:"R7",RoomName:"R7",RoomIndex:7},{RoomID:"R8",RoomName:"R8",RoomIndex:8},{RoomID:"R9",RoomName:"R9",RoomIndex:9},{RoomID:"R10",RoomName:"R10",RoomIndex:10}],model:"NisTRApp.model.OPR.OprRoom",storeId:"sOprRooms"}});Ext.define("NisTRApp.store.Reg.sRegPatient",{extend:Ext.data.Store,config:{model:"NisTRApp.model.Reg.RegPatient",storeId:"sRegPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:15000,url:"../api/Search/QueryRegPatient.ashx",reader:{type:"json"}}}});Ext.define("NisTRApp.store.Sys.sUserInfo",{extend:Ext.data.Store,config:{model:"NisTRApp.model.Sys.UserInfo",storeId:"sUserInfo",proxy:{type:"jsonp",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"//hisweb3.kfcc.intra/Portal/api/authentication/verify.ashx",callbackKey:"jsonpCallbackParam",reader:{type:"json"}},listeners:[{fn:"onJsonpstoreRefresh",event:"refresh"},{fn:"onJsonpstoreLoad",event:"load"}]},onJsonpstoreRefresh:function(a,d,b){var e=Ext.getStore("sUserInfoLocal");e.removeAll();e.getProxy().clear();if(!Ext.isEmpty(d.all)){if(!Ext.isEmpty(d.all[0].data.Token)){a.each(function(f){e.add(f);e.sync()})}}},onJsonpstoreLoad:function(d,b,f,a,e){}});Ext.define("NisTRApp.store.Sys.sUserInfoLocal",{extend:Ext.data.Store,config:{autoSync:true,model:"NisTRApp.model.Sys.UserInfoLocal",storeId:"sUserInfoLocal"}});Ext.define("NisTRApp.store.INP.sInpPatient",{extend:Ext.data.Store,config:{model:"NisTRApp.model.InpPatient",storeId:"sInpPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Inp/Search/QueryInpPatient.ashx",reader:{type:"json"}}}});Ext.define("NisTRApp.store.Sys.sUserConfig",{extend:Ext.data.Store,config:{model:"NisTRApp.model.mUserConfig",storeId:"sUserConfig",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/Search/QueryUserConfig.ashx",reader:{type:"json"}}}});Ext.define("NisTRApp.store.Phe.sPhePatient",{extend:Ext.data.Store,config:{model:"NisTRApp.model.Reg.RegPatient",storeId:"sPhePatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:15000,url:"../api/Search/QueryVirtualRegPatient.ashx",reader:{type:"json"}}}});Ext.define("NisTRApp.store.Sys.sTtempUserInfo",{extend:Ext.data.Store,config:{model:"NisTRApp.model.Sys.UserInfo",storeId:"sTtempUserInfo",proxy:{type:"jsonp",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:"../api/_/common/TakeUserInfo.ashx",callbackKey:"jsonpCallbackParam",reader:{type:"json"}}}});Ext.define("NisTRApp.store.Reg.VirtualPatient",{extend:Ext.data.Store,config:{model:"NisTRApp.model.Reg.RegPatient",storeId:"sVirtualPatient",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},timeout:15000,url:"../api/Search/QueryVirtualRegPatient.ashx",reader:{type:"json"}}}});Ext.Loader.setConfig({});Ext.application({FunctionType:{Name:"OPR",Description:"開刀房"},models:["OPR.OprmstvEntity","OPR.OprRoom","CMS.OutpatData","Sys.UserInfo","Reg.Regregm","Reg.RegPatient","Sys.UserInfoLocal","Note.WdisprognoteEntity","Profile.ptData","NUR.NurexamitemEntity","NUR.NurdatmEntity","PatientInfo","mHemdatv","mInpInfo","Inp.IpbinpEntity","InpPatient","Management.ConfirmOrder","mOPDVitalSignData","Patient.ActiveCatheterData","Form.ListItem","Form.OpenRecord","EMR.UnsignForm","Form.InitialRecordItem","OPR.ContactData","Form.NursingNotes","Note.NotesTempRecord","Form.FrmTemplateEntity","Med.MedmedfEntity","Reg.RegHistoryData","mWorkingItem","Ipo.IpovitalEntity","InpRecentBodyWeight","Sys.DrugTimeMapping","Management.HoursDrugInfo","Management.ActiveOrd","Management.ActiveOrds","PrintLocation","ORD.DruglogEntity","mNurScheduleEntity","Form.OpenRecords","EMR.FormRecord","Form.mNursingNotesHistory","Form.PrepareNewList","Form.PrepareOpenRecord","Sys.SysdrugnbEntity","Sys.SysstdEntity","Form.PrepareHistory","Sys.SystreatdEntity","Sys.SystprEntity","Sys.SystreatmEntity","VitalSigns.TimesDisplayInfo","VitalSigns.TprDailyData","VitalSigns.TprWeeklyData","VitalSigns.OptionTprItem","Ipo.IpomonitorEntity","Sys.SysparamEntity","Form.UnsignedFormPatData","EMR.UnsignedExcutionRecord","EMR.UnFinailPrepareFrmData","Nur.NurrefEntity","Patient.DrugLogData","Patient.DrugLogGroup","mUserConfig","RIS.SchuleData","Ris.RisLabSchData","RIS.ContactData","ENDO.SchuleData","ENDO.ContactData","IPB.mPatientData","IPB.mStationInfo","ENDO.HdhisexchangeEntity","ENDO.EndohxsheetEntity","Patient.Patient","OPR.AntimData","Sys.RouteEntity","Sys.FreqEntity","OPR.OprantidEntity","OPR.AntidTempData","Sys.SyscatypeEntity","CMS.CmsdatmData","mBarcodePrinter","CMS.NeuSchData","CMS.PathologySchData","CMS.ChemoSchData","CMS.TreatmentPlanMEntity","CMS.TreatmentPlanDEntity","mSysClinc","VitalSigns.ChroniclesData"],stores:["OPR.sOprInPatients","OPR.sOprRooms","Reg.sRegPatient","Sys.sUserInfo","Sys.sUserInfoLocal","INP.sInpPatient","Sys.sUserConfig","Phe.sPhePatient","Sys.sTtempUserInfo","Reg.VirtualPatient"],views:["WorkList","WorkList.OPR","WorkList.ACC","WorkList.MainPanel","WorkList.OPR.InPatientList","MainUI","OPD_PatInfoBar","WorkList.OPR.MyCarePatient","Profile.PtLab","Profile.PtRecord","Profile.PtExam","Profile.PtTreat","Profile","INP_PatInfoBar","Management","Management.OrderRecive","Management.OrderHistory","Allergy","VitalSigns","VitalSigns.VitalChart","VitalSigns.OPD_VitalChart","OPD_VitalSignInputPanel","Nur.Cath","NIS_FormPanel","Nur.OPD_Assessment","OPR_CareInfoPanel","PT_SettingPanel","OPR_MPL_CareContainer","OPR_MPL_FinishedCareContainer","OPR_MPL_QueryPatientsContainer","Nur.OPD_HealthTeach","NHT_PatientSign","Nur.OPD_Notes","Login","Nur.OPD_NotesEditPanel","CommonPanel","REG.RegHistory","OPR.WorkList","INP_VitalSignInputPanel","IDCNotifyPaenl","Nur.INP_Assessment","Management.OrderExcute","Management.FreqTimeSettingPanel","Management.OrderInfoPanel","Management.CallDrugPanel","Nur.INP_HealthProblem","Nur.INP_Notes","Nur.INP_NotesEditPanel","Nur.INP_HealthTeach","NHTINP_PatientSign","Nur.INP_Prepare","Nur.PrepareMapping","Nur.CathCreatePanel","Management.OrderCheckPanel","Management.NursingOrder","Management.NursingOrderCreatPanel","VitalSigns.MonitorView","VitalSigns.MonitorInput","VitalSigns.MonitorCreatePanel","VitalSigns.MonitorListSetting","VitalSigns.MonitorItemCreate","WorkList.EMR","Management.Druglog","Profile.Summary","Profile.ProfileDxItemPanel","Management.WdisNotePanel","Profile.Shift","WorkList.OPR.MyPatients","IPD.InpInformationPanel","WorkList.ENDO","Sys.SysInfoPanel","WorkList.RIS","OuterLink.ENDO.OprForm","WorkList.RIS.PatientList_B1","REG.ScheduleHistory","HrmView","WorkList.RIS.ContactPatient","RIS_ContactPanel","WorkList.RIS.CareContainer","WorkList.RIS.CareFinishedContainer","RIS.WorkList","WorkList.RIS.MyCarePatientsContainer","WorkList.RIS.QueryPatientsContainer","WorkList.RIS.ObservedPatient","WorkList.WB","VitalSigns.INP_PainScort","OUT_LINK_INP_PatInfoBar","WorkList.ENDO.InPatientList","ENDO.WorkList","WorkList.EDNO.CareContainer","ENDO.PatientStatus","WorkList.ENDO.ObservedPatient","WorkList.EDNO.CarePatients","WorkList.EDNO.CareFinishedPatients","WorkList.ENDO.MyPatients","ENDO_ContactPanel","WorkList.ENDO.QueryPatient","WorkList.IPB.InPatients","ENDO.SchdHistory","ReasonTempletePanel","ENDO.SechdDetails","WorkList.OPR.Report","OPR_RPT_ANTIMTRANSLOG","OPR_OPR009M","OPR_FrmOprData","OPR_DelayRsnPanel","CanvasPanel","WorkList.CMS","WorkList.CMS.DiscoverPatients","CMS.CmsdatmPanel","WorkList.CMS.InPatients","CMS.CommonPanel","MEDProfile","WorkList.CMS.SearchPatients","WorkList.CMS.RegPatients","CMS.ClosePanel","CMS.WorkUp","CMS.TreatmentPlan","CMS.TreatmentPlan.OPR","CMS.Treatment","CMS.Treatment.OPR","CMS.Treatment.CHM","WorkList.CMS.MyInPatients","CMS.Treatment.RT","WorkList.CMS.IpbPatients","CMS.Treatment.Hormone","WorkList.OUTP","WorkList.OUTP.IpbPatients","OUTP.InCase","WorkList.OUTP.IpbInPatients","WorkList.OUTP.IpbSearchPatients","OUTP.WorkList","ClincSearchPanel","ConsoultRecordPanel","ScrollablePanel","WorkList.OUTP.Report","WorkList.OUTP.Report.OINRPT","WorkList.OUTP.Report.Statistics","CMS.Treatment.StemCell","WorkList.IPB","WorkList.IPB.OutPatients","WorkList.CMS.Report","VitalSigns.EventLog","VitalSigns.EventLog.Edit","WorkList.OUTP.Report.ToExcel"],icon:"resources/icons/Icon.png",name:"NisTRApp",getFuncType:function(){return NisTRApp.view.SysUtility.NameToFunctionType(this.FunctionType.Name)},setFuncType:function(d){var b=function(k,g){var f=Ext.ComponentQuery.query(".container");for(var h in f){try{f[h].fireEvent("FunctionChange",f[h],k,g)}catch(j){}}f=null;delete f};var e=this.FunctionType;e=NisTRApp.view.SysUtility.NameToFunctionType(d.Name);if(e.Name!=this.FunctionType.Name){console.log("FN Change:",this.FunctionType,"to",e);var a=this.FunctionType;this.FunctionType=e;b(a,this.FunctionType);a=null;delete a}e=null;delete e;b=null;delete b},launch:function(){Ext.Msg.defaultAllowedConfig.showAnimation=false;NisTRApp.app.setFuncType(SYS_CONST.FunctionType.NULL);setTimeout(function(){var e=document.createElement("meta");e.setAttribute("name","format-detection");e.setAttribute("content","telephone=no");(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(e);e=null;delete e},100);var d=location.hash.replace(/^#/,"");var b=undefined;if(!Ext.isEmpty(d)){d=decodeURI(d)}if((d.indexOf("appid=")!=-1)&&d.indexOf("&")!=-1){var a=d.split("&");b={};b.ChartSeq=-1;$(a).each(function(){var e=this.split("=");switch(e[0].toLowerCase()){case"c":b.ChartNo=e[1];break;case"s":b.ChartSeq=parseInt(e[1],10);break;case"i":b.InpNo=(e[1]);break;case"tk":b.Token=e[1];break;case"appid":b.AppID=e[1];break;case"userid":b.UserID=e[1];break;case"system":b.System=e[1];break;case"pg":b.Page=e[1];break;case"spg":b.SubPage=e[1];break;default:b[e[0].toLowerCase()]=e[1];break}});a=null;delete a}d=null;delete d;NisTRApp.app.SystemStart(b)},SystemStart:function(a){console.log("%c NIS System Starting...! ","color: #F40000; font-size: 28px");try{if(!Ext.isEmpty(a)){NisTRApp.app.StartByUrl(a)}else{NisTRApp.app.DefaultStart()}}catch(b){console.error(b);NisTRApp.app.DefaultStart()}return},StartByUrl:function(a){Ext.Viewport.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});setTimeout(function(){Ext.Viewport.setMasked(false)},5000);if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.UserID)){var b=btoa(a.UserID.toUpperCase());var e=btoa("kfsyscc_token");var d=Ext.getStore("sTtempUserInfo");if(d.isLoading()){d=null;delete d;return}Ext.getStore("sTtempUserInfo").removeAll();d.getProxy().setUrl(SYS_CONST.ApiRoot+"_/common/TakeUserInfo.ashx");d.getProxy().setExtraParams({UserID:encodeURIComponent(b),AppID:"NisOutLink",Password:encodeURIComponent(e),Flag:"1"});d.load({callback:function(g,f,j){setTimeout(function(){Ext.Viewport.setMasked(false)},1200);if(j&&!Ext.isEmpty(g)&&g.length>0){try{result=g[0].data;if(Ext.isEmpty(result.Token)||Ext.isEmpty(result.UserID)){NisTRApp.view.SysUtility.RemoveUserInfo();Ext.Msg.alert(SYS_CONST.Warning.SCW3);console.log("LoginPage Error :</Br> 請檢查帳號密碼正確性!!");NisTRApp.app.DefaultStart();result=null;delete result;return false}else{if(!Ext.isEmpty(a.System)){switch(a.System){case"FORM":success=NisTRApp.view.URLAdapter.FORM.Link(a,g[0]);break;case"INP":success=NisTRApp.view.URLAdapter.INP.Link(a,g[0]);break;default:NisTRApp.view.SysUtility.RemoveUserInfo();NisTRApp.app.DefaultStart();break}}}result=null;delete result}catch(h){NisTRApp.view.SysUtility.RemoveUserInfo();alert(h);NisTRApp.app.DefaultStart();console.log("LoginPage Error : "+h);return false}}else{NisTRApp.view.SysUtility.RemoveUserInfo();Ext.Viewport.setMasked(false);Ext.Msg.alert(SYS_CONST.Warning.SCW4);NisTRApp.app.DefaultStart();return false}},scope:this});d=null;delete d}else{NisTRApp.view.SysUtility.RemoveUserInfo();NisTRApp.app.DefaultStart()}},DefaultStart:function(){if(NisTRApp.view.SysUtility.IsProtalDevice()){$.ajax({url:"../portal/entryPoint",complete:function(a){typeof(Portal)!="undefined"&&typeof(Portal.setOverrideEntryPoint)!="undefined"&&Portal.setOverrideEntryPoint(a.responseText)}})}NisTRApp.view.TRUtility.IniaialSysStore(null,false);Ext.getStore("sUserInfoLocal").load();if(NisTRApp.view.SysUtility.IsProtalDevice()){setTimeout(function(){NisTRApp.view.SysUtility.VerificationPortal(function(a,b){NisTRApp.view.UserConfig.LoadUserConfig(function(d,e){console.log("Verification Success");if(Ext.isEmpty(Ext.getCmp("WorkList"))){Ext.create("NisTRApp.view.WorkList",{id:"WorkList",fullscreen:true})}NisTRApp.app.setFuncType(NisTRApp.view.UserConfig.GetDefaultPage());Ext.getCmp("WorkList").setRecord(NisTRApp.view.SysUtility.GetUserInfo());Ext.Viewport.animateActiveItem(Ext.getCmp("WorkList"),{type:"slide",direction:"right"})})},function(a,b){console.log("Verification failed");if(Ext.isEmpty(Ext.getCmp("Login"))){Ext.create("NisTRApp.view.Login",{id:"Login",fullscreen:true})}Ext.Viewport.animateActiveItem(Ext.getCmp("Login"),{type:"slide",direction:"right"})})},200)}else{NisTRApp.view.SysUtility.Verification(function(a,b){NisTRApp.view.UserConfig.LoadUserConfig(function(d,e){console.log("Verification Success");if(Ext.isEmpty(Ext.getCmp("WorkList"))){Ext.create("NisTRApp.view.WorkList",{id:"WorkList",fullscreen:true})}NisTRApp.app.setFuncType(NisTRApp.view.UserConfig.GetDefaultPage());Ext.getCmp("WorkList").setRecord(NisTRApp.view.SysUtility.GetUserInfo());Ext.Viewport.animateActiveItem(Ext.getCmp("WorkList"),{type:"slide",direction:"right"})})},function(a,b){console.log("Verification failed");if(Ext.isEmpty(Ext.getCmp("Login"))){Ext.create("NisTRApp.view.Login",{id:"Login",fullscreen:true})}Ext.Viewport.animateActiveItem(Ext.getCmp("Login"),{type:"slide",direction:"right"})})}}});Ext.define("NisTRApp.view.CMS.ScheduleRemark",{extend:Ext.Panel,statics:{Create:function(g,e,d,k,l,j,a,h){var b="_cmsScheduleRemark";if(!Ext.isEmpty(Ext.getCmp(b))){Ext.getCmp(b).destroy()}if(Ext.isEmpty(Ext.getCmp(b))){var f=Ext.create("NisTRApp.view.CMS.ScheduleRemark",{id:b,modal:true,centered:true,record:g,schdRecord:e,hideOnMaskTap:false,height:"78%",width:"98%",title:"治療計畫",caller:d,formId:k,divId:j,storeId:l,closeFn:a,byForm:(Ext.isEmpty(h)?false:h)});Ext.Viewport.add(f);f.show();f=null;delete f}b=null;delete b;e=null;g=null;d=null;delete e;delete g;delete d},Create2:function(a,d,b,h,j,g){var f="_cmsScheduleRemark";if(!Ext.isEmpty(Ext.getCmp(f))){Ext.getCmp(f).destroy()}if(Ext.isEmpty(Ext.getCmp(f))){var e=Ext.create("NisTRApp.view.CMS.ScheduleRemark",{id:f,modal:true,centered:true,record:a,schdRecord:d,hideOnMaskTap:false,height:"78%",width:"98%",title:"治療計畫",caller:b,formId:h,divId:"",storeId:"",closeFn:j,byForm:(Ext.isEmpty(g)?false:g)});Ext.Viewport.add(e);e.show();e=null;delete e}f=null;delete f;d=null;a=null;b=null;delete d;delete a;delete b},StoreQueue:function(a){if(Ext.data.ModelManager.getModel("mCmsStoreMap")==null){Ext.define("mCmsStoreMap",{extend:Ext.data.Model,config:{fields:[{name:"StoreId",type:"string"}]}})}if(Ext.isEmpty(Ext.getStore("sCmsStoreMap"))){Ext.create("Ext.data.Store",{storeId:"sCmsStoreMap",model:"mCmsStoreMap"})}Ext.getStore("sCmsStoreMap").removeAll();var b=Ext.create("mCmsStoreMap",{StoreId:a});Ext.getStore("sCmsStoreMap").add(b);b=null;delete b;index=null;delete index}},config:{initialFlag:true,formId:"VECBN4UH2TNUVISSQIJVGNQU2A",storeId:"sCmsSchRemarkHistory",divId:"CmsSchRemarkFormContent",callbackFn:"_ReloadCmsSchData_callback_event",byForm:false,byCase:true,layout:{type:"fit"},caller:{},schdRecord:{},closeFn:{},items:[{xtype:"panel",itemId:"CMSSRK_Form",layout:{type:"hbox"},items:[{xtype:"panel",height:"100%",itemId:"CMSSRK_Edit",width:"60%",layout:{type:"vbox"},items:[{xtype:"panel",itemId:"CMSSRK_MaintainBar",items:[{xtype:"toolbar",docked:"top",hidden:false,itemId:"CMSSRK_MaintainBar1",scrollable:false,items:[{xtype:"button",itemId:"mybutton43",text:"訪視記錄"},{xtype:"button",itemId:"mybutton39",text:"診斷期間追蹤記錄"},{xtype:"button",itemId:"mybutton44",text:"轉介記錄"},{xtype:"button",itemId:"mybutton38",text:"追蹤異常記錄"}]},{xtype:"toolbar",docked:"top",hidden:false,itemId:"CMSSRK_MaintainBar2",scrollable:false,items:[{xtype:"button",itemId:"mybutton42",text:"化學治療異常記錄"},{xtype:"button",itemId:"mybutton40",text:"手術異常記錄"},{xtype:"button",itemId:"mybutton41",text:"放射線治療異常記錄"}]}]},{xtype:"toolbar",docked:"top",hidden:false,itemId:"CMSSRK_HeadBar",items:[{xtype:"label",html:"Common_INFO",itemId:"CMSPatInfoLbl",tpl:["",""]},{xtype:"button",hidden:true,html:'<img src="../_/img/Error.png" style="width:30px;height:30px;"></img>',itemId:"CMSSRK_CloseBtn1",margin:"5 5 5 5",right:"1px",style:"float:left;font-size:16px;",ui:"plain",width:"60px",text:"MyButton16"}]},{xtype:"panel",height:"100%",html:'<div id="CmsSchRemarkFormContent" style="width: 100% !important; height: 100% !important;"> </div>',itemId:"CMSSRK_FormPanel",width:"100%",layout:{type:"fit"}},{xtype:"toolbar",docked:"bottom",itemId:"CMSSRK_FootBar",items:[{xtype:"button",itemId:"CMSSRK_CloseBtn1",right:"5px",ui:"confirm",width:"20%",text:"關 閉"},{xtype:"button",itemId:"CMSSRK_ReflashBtn",ui:"decline",width:"20%",text:"重新整理"}]}]},{xtype:"panel",itemId:"CMSSRK_ListPanel",width:"40%",layout:{type:"fit"},items:[{xtype:"list",itemId:"CMSSRK_List",disableSelection:true,emptyText:'<div style="width:auto; text-align:center; padding-bottom:20%; color:red; font-weight:bold;">無資料.</div>',itemTpl:Ext.create("Ext.XTemplate","<table>","    <tr> ","",'        <td style="padding:0 0 10px 0; color:green; word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">','            <span style="color:black;">標題: &nbsp;&nbsp;</span> {Title}',"        </td>","    </tr>","    <tr>",'        <td style="padding:0 0 10px 0;">','		<span style="color:black;">記錄時間: </span> <span style="color:red;">{[this.MedicalDateFormat(values.MedicalDate)]}</span>','		<span style="color:black;">  {UserName}</span>',"        </td> ","    </tr>","    ","    <tr>",'        <td style="padding:0 0 5px 0;">','            <span style="color:black;">記錄內容: &nbsp;&nbsp;</span>  ',"        </td>","    </tr>","    <tr>",'        <td style="padding:0 0 5px 0; color:blue; font-size:14px; word-break: break-all;word-wrap: break-word;word-wrap: break-word; word-wrap: break-word;">',"        {Html} ","        </td>","    </tr>","    ","</table>","","","   ","","","","",{MedicalDateFormat:function(b){var a=b.toString();return a.substring(0,16).replace("T"," ")}}),plugins:[{autoPaging:true,loadMoreText:"下一頁",type:"listpaging"}]}]}]}],listeners:[{fn:"onMybutton43Tap",event:"tap",delegate:"#mybutton43"},{fn:"onMybutton39Tap",event:"tap",delegate:"#mybutton39"},{fn:"onMybutton44Tap",event:"tap",delegate:"#mybutton44"},{fn:"onMybutton38Tap",event:"tap",delegate:"#mybutton38"},{fn:"onMybutton42Tap",event:"tap",delegate:"#mybutton42"},{fn:"onMybutton40Tap",event:"tap",delegate:"#mybutton40"},{fn:"onMybutton41Tap",event:"tap",delegate:"#mybutton41"},{fn:"onCMSSRK_CloseBtn1Tap",event:"tap",delegate:"#CMSSRK_CloseBtn1"},{fn:"onCMSSRK_ReflashBtnTap",event:"tap",delegate:"#CMSSRK_ReflashBtn"},{fn:"onPanelDestroy",event:"destroy"},{fn:"onPanelPainted",event:"painted"}]},onMybutton43Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("UTKCJNNRTK7UBJ65TCAQS2ZK6U");this.LoadFrame()},onMybutton39Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("KX4MK34LUHCE5P6Q5FSUW3G4NQ");this.LoadFrame()},onMybutton44Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("G6JIPDNRA6DUHEJXBS74HU7N3U");this.LoadFrame()},onMybutton38Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("KR3EXNNZYYREXGJVQ75T5O6WBQ");this.LoadFrame()},onMybutton42Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("TQPSRKJRBTJURAFTWRKKAO4VYU");this.LoadFrame()},onMybutton40Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("UERRML67W4LUTNPW2E5DAK3Q5Y");this.LoadFrame()},onMybutton41Tap:function(b,d,a){NisTRApp.view.Misc.ButtonSelect(this.down("#CMSSRK_MaintainBar"),b,"confirm-round","normal","","");this.setFormId("KN7FBYZNNLCU5ANH4CB2WJDVDQ");this.LoadFrame()},onCMSSRK_CloseBtn1Tap:function(b,f,a){if(!Ext.isEmpty(this.getCloseFn())&&Ext.isFunction(this.getCloseFn())){var d=this.getCloseFn();d(this)}this.destroy()},onCMSSRK_ReflashBtnTap:function(b,d,a){this.LoadFrame()},onPanelDestroy:function(a){var b=this.getStoreId();NisTRApp.view.FormUtil.ResetContentDiv(this.getDivId(),this.down("#CMSSRK_FormPanel"));if(!Ext.isEmpty(Ext.getStore(b))){Ext.getStore(b).removeAll();Ext.getStore(b).destroy()}console.log("CMS.ScheduleRemark On Destroy");this.removeAll(true,true)},onPanelPainted:function(b,a){NisTRApp.view.CMS.ScheduleRemark.StoreQueue(this.getStoreId());if(this.getInitialFlag()){if(!Ext.isEmpty(this.getFormId())&&this.getFormId()!="none"){console.log("CMSSRK_FormPanel Connect To:",this.getUrl());this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv(this.getDivId(),this.down("#CMSSRK_FormPanel"));var d=this;NisTRApp.view.Misc.createFrameContent($("#"+this.getDivId()),this.getUrl(),this.getDivId()+"Iframe",function(){if(!Ext.isEmpty(d)){d.setMasked(false);d=null;delete d}Ext.Viewport.setMasked(false)})}this.LoadData(this.getRecord(),this.getSchdRecord());this.setInitialFlag(false)}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getDivId())){this.setDivId("CmsSchRemarkFormContent")}NisTRApp.view.FormUtil.ResetContentDiv(this.getDivId(),this.down("#CMSSRK_FormPanel"));if(Ext.isEmpty(this.getFormId())){this.setFormId("VECBN4UH2TNUVISSQIJVGNQU2A")}this.down("#CMSSRK_MaintainBar").setHidden(true);if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)||Ext.isEmpty(this.getRecord().data.CmsID)){Ext.Msg.alert("CMS.ScheduleRemark 資料錯誤");return false}if(Ext.isEmpty(this.getSchdRecord())||Ext.isEmpty(this.getSchdRecord().data)||Ext.isEmpty(this.getSchdRecord().data.ExamType)||Ext.isEmpty(this.getFormId())){Ext.Msg.alert("CMS.ScheduleRemark 資料錯誤");return false}_ReloadCmsSchData_callback_event=function(b){try{NisTRApp.view.Misc.Alert(SYS_CONST.Loadmask.SUCCESS,800);Ext.getStore("sCmsStoreMap").each(function(h,f,g){var e=h.get("StoreId");if(!Ext.isEmpty(Ext.getStore(e))){if(Ext.getStore(e).isLoading()){return}var j=Ext.getStore(e);j.removeAll();j.loadPage(1,null,this);j=null;delete j}})}catch(d){console.error("_ReloadCmsSchData_callback_event",d)}};if(this.getSchdRecord().data.ExamType=="WORKUP_LAB"){this.WorkUpLabTpl()}else{if(this.getSchdRecord().data.ExamType=="RIS"){this.RisSchTpl()}else{if(this.getSchdRecord().data.ExamType=="NEU"){this.NeuSchTpl()}else{if(this.getSchdRecord().data.ExamType=="PATHOLOGY"){this.PathologySchTpl()}else{if(this.getSchdRecord().data.ExamType=="OPR"){this.OprSchTpl()}else{if(this.getSchdRecord().data.ExamType=="CHEMO"){this.ChemoSchTpl()}else{if(this.getSchdRecord().data.ExamType=="CMS_TRACK"||this.getSchdRecord().data.ExamType=="CMS_MAINTAIN"){this.CmsMaintainTpl();this.down("#CMSSRK_HeadBar").setHidden(true);this.down("#CMSSRK_FootBar").down("#CMSSRK_CloseBtn1").setHidden(true)}}}}}}}if(Ext.isEmpty(this.getStoreId())){this.setStoreId("sCmsSchRemarkHistory")}var a=this.getStoreId();if(Ext.isEmpty(Ext.getStore(a))){Ext.create("Ext.data.Store",{storeId:a,model:"NisTRApp.model.EMR.FormRecord",pageSize:5,clearOnPageLoad:false,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/Search/CmsSchRemarkHistory.ashx",reader:{type:"jsonHtmlDecode",rootProperty:"MasterID"},sorters:{direction:"DESC",property:"MedicalDate"}}})}this.down("#CMSSRK_List").setStore(Ext.getStore(a));a=null;delete a},getUrl:function(){var e=this.getRecord();var b=this.getSchdRecord();var d=this.getFormId();var a=NisTRApp.view.FormUtil.CmsRemarkAddr("RenderCMSScheduleRemark",d,NisTRApp.view.SysUtility.GetUserID(),e.data.ChartNO,e.data.ChartSeq,"","","_ReloadCmsSchData_callback_event","new","0","CMS",b.data.FrmCode,b.data.FrmKey,e.data.CmsID,b.data.FrmItemName);e=null;delete e;b=null;delete b;d=null;delete d;return a},CerateScheduleRemark:function(){},RisSchTpl:function(){var a=new Ext.XTemplate("<table>","<tr>",'<td rowspan="2" align="left" width="180px"><span style="font-weight: bold;color:#f6f6f6; font-size: 18px;"> <p>{Examcname}</p></span></td>','<td rowspan="2" align="left" width="30px"></td>','<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">檢查狀態.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {Examstatus} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">檢查代碼.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {Examid}</span>',"</td>",'<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">預定檢查日.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {Preexamdate} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">實際檢查日.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {Realexamtxdate} </span>',"</td>","</tr>","</table>");var b=a.apply(this.getSchdRecord().data);this.down("#CMSPatInfoLbl").setHtml(b);b=null;delete b;a=null;delete a},NeuSchTpl:function(){var a=new Ext.XTemplate("<table>","<tr>",'<td rowspan="2" align="left" width="180px"><span style="font-weight: bold;color:#f6f6f6; font-size: 18px;"> <p>{DrugName}</p></span></td>','<td rowspan="2" align="left" width="30px"></td>','<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">檢查醫師.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {ChkDrName} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">檢查日期.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {SysDate}</span>',"</td>",'<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">醫師.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {AplDrName} </span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">報告日期.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {RptDate} &nbsp;</span>',"</td>","</tr>","</table>");var b=a.apply(this.getSchdRecord().data);this.down("#CMSPatInfoLbl").setHtml(b);b=null;delete b;a=null;delete a},WorkUpLabTpl:function(){var a=new Ext.XTemplate("<table>","<tr>",'<td rowspan="2" align="left" width="180px"><span style="font-weight: bold;color:rgb(244, 255, 182); font-size: 18px;"> <p>{CodeName}</p></span></td>','<td rowspan="2" align="left" width="30px"></td>','<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">醫令代碼.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {CodeNO} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">單號.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {Accessnum}</span>',"</td>",'<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">執行日.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {RealExamDate} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">報告日.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {RptDate} </span>',"</td>","</tr>","</table>");var b=a.apply(this.getSchdRecord().data);this.down("#CMSPatInfoLbl").setHtml(b);b=null;delete b;a=null;delete a},CmsMaintainTpl:function(){this.down("#CMSSRK_MaintainBar").setHidden(false)},LoadData:function(g,d){var h=this.getStoreId();if(Ext.getStore(h).isLoading()||Ext.isEmpty(g)){return}var e="";if(this.getByForm()){e=this.getFormId()}var b="";var a="";if(this.getByCase()){b=g.data.CmsID;a=d.data.FrmKey}var f=Ext.getStore(h);f.removeAll();f.getProxy().setExtraParams({FunctionType:"Remark",ChartNO:g.data.ChartNo,CmsID:b,RelatedCode:d.data.FrmCode,RelatedKey:a,FormID:e});f.loadPage(1,null,this);h=null;delete h;f=null;delete f},PathologySchTpl:function(){var a=new Ext.XTemplate("<table>","<tr>",'<td rowspan="2" align="left" width="180px"><span style="font-weight: bold;color:#f6f6f6; font-size: 18px;"> <p>{AccessnumName}</p></span></td>','<td rowspan="2" align="left" width="30px"></td>','<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">申請醫師.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {AplDrName} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">申請日期.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {PathoDate}</span>',"</td>",'<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">報告完成.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {StatusName} </span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">收件日期.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {SysDate} &nbsp;</span>',"</td>","</tr>","</table>");var b=a.apply(this.getSchdRecord().data);this.down("#CMSPatInfoLbl").setHtml(b);b=null;delete b;a=null;delete a},OprSchTpl:function(){var a=new Ext.XTemplate("<table>","<tr>",'<td rowspan="2" align="left" width="380px"><span style="font-weight: bold;color:#f6f6f6; font-size: 14px;"> <p>{BefOperName1}</p></span></td>','<td rowspan="2" align="left" width="20px"></td>','<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">醫師.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {DrName} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">手術日期.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {OprmDate}</span>',"</td>","</tr>","</table>");var b=a.apply(this.getSchdRecord().data);this.down("#CMSPatInfoLbl").setHtml(b);b=null;delete b;a=null;delete a},ChemoSchTpl:function(){var a=new Ext.XTemplate("<table>","<tr>",'<td rowspan="2" align="left" width="180px"><span style="font-weight: bold;color:#f6f6f6; font-size: 18px;"> <p>{ChemoName}</p></span></td>','<td rowspan="2" align="left" width="30px"></td>','<td align="left" width="160px">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">申請醫師.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {AplDocName} &nbsp;</span>','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">化療起日.</span>','<span style="font-weight:bold; color:#66ff00;font-size: 13px;"> {BegDate}</span>',"</td>",'<td align="left" width="160px">','<br style="line-height:0.1;">','<span style="font-weight: bold;color:#f6f6f6; font-size: 13px;">化療迄日.</span>','<span style="font-weight: bold;color:#66ff00; font-size: 13px;"> {EndDate} &nbsp;</span>',"</td>","</tr>","</table>");var b=a.apply(this.getSchdRecord().data);this.down("#CMSPatInfoLbl").setHtml(b);b=null;delete b;a=null;delete a},LoadFrame:function(){if(!Ext.isEmpty(this.getFormId())&&this.getFormId()!="none"){try{this.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});NisTRApp.view.FormUtil.ResetContentDiv(this.getDivId(),this.down("#CMSSRK_FormPanel"));var a=this;NisTRApp.view.Misc.createFrameContent($("#"+this.getDivId()),this.getUrl(),this.getDivId()+"Iframe",function(){if(!Ext.isEmpty(a)){a.setMasked(false);a=null;delete a}Ext.Viewport.setMasked(false)});this.LoadData(this.getRecord(),this.getSchdRecord())}catch(b){}}}});Ext.define("NisTRApp.view.CMS.WorkUp.LAB",{extend:Ext.Container,statics:{UpdateLabWK:function(e,f,b,a){if(Ext.isEmpty(e)||Ext.isEmpty(f)){return false}var d=b;d.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/WorkUp/LabWorkUpUpdate.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),CmsID:e.data.CmsID,Flag:a,Json:btoa(encodeURIComponent(JSON.stringify(f.data)))},success:function(g){d.setMasked(false);var h=Ext.decode(g.responseText);NisTRApp.view.Misc.Alert(h.Message,(h.Success?500:0));if(h.Success){if(a==1){f.destroy();d.refresh()}}h=null;delete h;d=null;delete d;scFn=null;delete scFn},failure:function(){d.setMasked(false);d=null;delete d}});e=null;delete e},SyncSchd:function(d,e,a){if(Ext.isEmpty(d)||Ext.isEmpty(e)){return false}var b=a;b.setMasked({xtype:"loadmask",message:SYS_CONST.Loadmask.PW1});Ext.Ajax.request({url:SYS_CONST.ApiRoot+"CMS/WorkUp/LabWorkUpSync.ashx",scope:this,method:"POST",params:{UserID:NisTRApp.view.SysUtility.GetUserID(),CmsID:d.data.CmsID,Json:btoa(encodeURIComponent(JSON.stringify(e.data)))},success:function(f){b.setMasked(false);var g=Ext.decode(f.responseText);if(g.Success){e.data.SysDate=g.SysDate;e.data.AplDate=g.AplDate;e.data.ReportDate=g.ReportDate;b.refresh()}else{NisTRApp.view.Misc.Alert(g.Message,(g.Success?800:0))}g=null;delete g;b=null;delete b;scFn=null;delete scFn},failure:function(){b.setMasked(false);b=null;delete b}});d=null;delete d},OpenLab:function(d,e,a){if(Ext.isEmpty(d)||Ext.isEmpty(e)){return false}var b={};b.ChartNo=d.data.ChartNO;b.TEAM=e.data.Team;b.Sysdate=e.data.SysDate;NisApp.view.NisPDFUtil.createProfileContent(null,"312",b);b=null;delete b}},config:{initialFlag:true,stopDistroyEvent:true,height:"100%",width:"100%",layout:{type:"fit"},caller:{},items:[{xtype:"panel",itemId:"CMS_WK_LAB_Index",layout:{type:"fit"},items:[{xtype:"panel",itemId:"CMS_WK_LAB_MainPanel",items:[{xtype:"toolbar",docked:"bottom",items:[{xtype:"panel",hidden:true,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"CmsWKLab_BegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2008,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"CmsWKLab_EndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2010,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"selectfield",hidden:false,itemId:"CmsWKLabWK_Kind",label:"類別",labelWidth:"20%",options:[{text:"ALL",value:"ALL"},{text:"檢驗",value:"02_C"},{text:"病理/細胞",value:"02_RN"},{text:"放診",value:"01"},{text:"核醫",value:"11"},{text:"肺功能",value:"08"},{text:"心超",value:"05_1"},{text:"心電圖",value:"05_2"},{text:"內視鏡",value:"04"},{text:"其它",value:"14"}]},{xtype:"button",itemId:"CmsWKQueryBen",ui:"decline",width:"90px",text:"查 詢"},{xtype:"button",itemId:"CMS_WK_LAB_SCHD_Btn",right:"10px",ui:"confirm-forward",width:"100px",text:"排程查詢"}]}]},{xtype:"panel",initialFlag:true,hidden:true,itemId:"CMS_WK_LAB_SchdPanel",items:[{xtype:"toolbar",docked:"bottom",items:[{xtype:"button",itemId:"CmsWKLab_BackMain",ui:"confirm-back",width:"140px",text:"回追蹤清單"},{xtype:"panel",hidden:false,margin:"0 0 0 20",width:"350px",layout:{type:"hbox"},items:[{xtype:"datepickerfield",itemId:"CmsWKLabSchd_BegDate",width:"47%",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2008,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}},{xtype:"datepickerfield",itemId:"CmsWKLabSchd_EndDate",width:"53%",label:"~",labelWidth:"20px",value:{year:2015,month:4,day:30},placeHolder:"yyyy/mm/dd",dateFormat:"Y/m/d",picker:{useTitles:true,dayText:"日",monthText:"月",slotOrder:["year","month","day"],yearFrom:2010,yearText:"年",yearTo:2025,doneButton:{html:"<h> 確 認  </h>",ui:"confirm"},cancelButton:{html:"<h> 取 消 </h>",ui:"confirm"}}}]},{xtype:"selectfield",itemId:"CmsWKLab_Kind",label:"類別",labelWidth:"20%",options:[{text:"ALL",value:"ALL"},{text:"檢驗",value:"02_C"},{text:"病理/細胞",value:"02_RN"},{text:"放診",value:"01"},{text:"核醫",value:"11"},{text:"肺功能",value:"08"},{text:"心超",value:"05_1"},{text:"心電圖",value:"05_2"},{text:"內視鏡",value:"04"},{text:"其它",value:"14"}]},{xtype:"button",itemId:"CmsWKSchdQueryBen",ui:"decline",width:"90px",text:"查 詢"}]}],listeners:[{fn:function(b,a){if(Ext.isEmpty(this.initialFlag)||this.initialFlag){this.getParent().getParent().LoadSchd();this.initialFlag=false}},event:"painted"}]}]}],listeners:[{fn:"onCmsWKLabWK_KindChange",event:"change",delegate:"#CmsWKLabWK_Kind"},{fn:"onCmsWKQueryBenTap",event:"tap",delegate:"#CmsWKQueryBen"},{fn:"onCMS_WK_LAB_SCHD_BtnTap",event:"tap",delegate:"#CMS_WK_LAB_SCHD_Btn"},{fn:"onCmsWKLab_BackMainTap",event:"tap",delegate:"#CmsWKLab_BackMain"},{fn:"onCmsWKLab_KindChange",event:"change",delegate:"#CmsWKLab_Kind"},{fn:"onCmsWKSchdQueryBenTap",event:"tap",delegate:"#CmsWKSchdQueryBen"},{fn:"onContainerDestroy",event:"destroy"},{fn:"onContainerPainted",event:"painted"}]},onCmsWKLabWK_KindChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadWorkUp()}},onCmsWKQueryBenTap:function(b,d,a){this.LoadWorkUp()},onCMS_WK_LAB_SCHD_BtnTap:function(b,d,a){this.ActiveChange(this.down("#CMS_WK_LAB_Index"),"CMS_WK_LAB_SchdPanel")},onCmsWKLab_BackMainTap:function(b,d,a){this.LoadWorkUp();this.ActiveChange(this.down("#CMS_WK_LAB_Index"),"CMS_WK_LAB_MainPanel")},onCmsWKLab_KindChange:function(a,e,b,d){if(!this.getInitialFlag()){this.LoadSchd()}},onCmsWKSchdQueryBenTap:function(b,d,a){this.LoadSchd()},onContainerDestroy:function(a){if(!Ext.isEmpty(Ext.getStore("sCmsWorkUpLab"))){Ext.getStore("sCmsWorkUpLab").removeAll();Ext.getStore("sCmsWorkUpLab").destroy()}if(!Ext.isEmpty(Ext.getStore("sCmsSchLab"))){Ext.getStore("sCmsSchLab").removeAll();Ext.getStore("sCmsSchLab").destroy()}console.log("On Destroy :","WorkUp.LAB");this.removeAll()},onContainerPainted:function(b,a){if(this.getInitialFlag()){this.LoadWorkUp();this.setInitialFlag(false)}},initialize:function(){this.callParent();if(Ext.isEmpty(this.getRecord())||Ext.isEmpty(this.getRecord().data)||Ext.isEmpty(this.getRecord().data.ChartNO)||Ext.isEmpty(this.getRecord().data.CmsID)){Ext.Msg.alert("CMS.WorkUp.LAB 資料錯誤");return false}this.setInitialFlag(true);this.initialStore();this.down("#CmsWKLab_EndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));this.down("#CmsWKLab_BegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-6));this.down("#CmsWKLabSchd_EndDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,6));this.down("#CmsWKLabSchd_BegDate").setValue(Ext.Date.add(new Date(),Ext.Date.MONTH,-6));var b=Ext.getCmp("CmsWKLabGrid");if(Ext.isEmpty(b)){b=this.GenGrid("CmsWKLabGrid","","");b.getTitleBar().hide();b.CmsRecord=this.getRecord();var a=Ext.getStore("sCmsWorkUpLab");b.setStore(a);b.addListener("itemtap",this.ItemSingleTapSchdGrid,b);this.down("#CMS_WK_LAB_MainPanel").add(b);a=null;delete a}b=null;delete b;this.down("#CMS_WK_LAB_MainPanel").setRecord(this.getRecord());var b=Ext.getCmp("CmsLabSchdGrid");if(Ext.isEmpty(b)){b=this.GenCmsSchHistoryGrid("CmsLabSchdGrid","","");b.getTitleBar().hide();b.CmsRecord=this.getRecord();var d=Ext.getStore("sCmsSchLab");b.setStore(d);b.addListener("itemtap",this.ItemSingleTapSchdGrid,b);this.down("#CMS_WK_LAB_SchdPanel").add(b);d=null;delete d}b=null;delete b;this.down("#CMS_WK_LAB_SchdPanel").setRecord(this.getRecord())},GenGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",CmsRecord:null,emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">查無排檢資料.</div>',columns:[{text:"排程",xtype:"gridheadergroup",cls:"gridMediumFont",hidden:false,items:[{text:"備註",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<img id="REMARK_REMARK_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath(values.RemarkCnt)]}" alt="Smiley face" height="30" width="30">',{ImgPath:function(e){if(!Ext.isEmpty(e)&&e>0){return"FrmFinish.png"}else{return"FrmAdd.png"}}}),width:80,hidden:false,sortable:false},{text:"異常",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:Ext.create("Ext.XTemplate",'<img id="ERROR_ERROR_{KeyOne}" src="'+SYS_CONST.ImgRoot+'{[this.ImgPath(values.ErrorCnt)]}" alt="Smiley face" height="30" width="30">',{ImgPath:function(e){if(!Ext.isEmpty(e)&&e>0){return"FrmFinish.png"}else{return"FrmAdd.png"}}}),width:80,hidden:false,sortable:false}]},{text:"刪除",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:90,tpl:'<button type="button" id="DEL_CHECK_{KeyOne}">刪 除</button>',flex:1,hidden:false,editable:false,sortable:false},{text:"醫令開立日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_APPLYDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.AccDate)]}</span>',flex:1,dataIndex:"AccDate",hidden:false,editable:false,sortable:true},{text:"開單日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_APPLYDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.ApplyDate)]}</span>',flex:1,dataIndex:"ApplyDate",hidden:false,editable:false,sortable:true},{text:"檢查名稱",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{CodeName}</span>',flex:1,width:280,dataIndex:"CodeName",editable:false,sortable:true},{text:"醫令",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:120,tpl:'<span id="FN_SYSDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{CodeNO}</span>',flex:1,dataIndex:"CodeNO",hidden:false,editable:false,sortable:true},{text:"排程日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_SCHDDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.SchdDate)]}</span>',flex:1,dataIndex:"SchdDate",hidden:false,editable:false,sortable:true},{text:"預作日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_PREEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.PreExamDate)]}</span>',flex:1,dataIndex:"PreExamDate",hidden:false,editable:false,sortable:true},{text:"檢查日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RealExamDate)]}</span>',flex:1,dataIndex:"RealExamDate",hidden:false,editable:false,sortable:true},{text:"報告日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_RPTDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RptDate)]}</span>',flex:1,dataIndex:"RptDate",hidden:false,editable:false,sortable:true},{text:"單號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:160,tpl:'<span id="FN_ACCESSNUM_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{Accessnum}</span>',flex:1,dataIndex:"Accessnum",hidden:false,editable:false,sortable:false},{text:"病理外片借閱進度",xtype:"gridheadergroup",cls:"gridMediumFont",itemId:"OutPathoField",hidden:false,items:[{text:"申請日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutPathoApplyDate)]}</span>',flex:1,dataIndex:"OutPathoApplyDate",hidden:false,editable:false,sortable:false},{text:"申請醫院",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="FN_STATUS_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{ClinName}</span>',flex:1,dataIndex:"ClinName",hidden:false,width:200,editable:false,sortable:false},{text:"寄出日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutPathoSendDate)]}</span>',flex:1,hidden:false,dataIndex:"OutPathoSendDate",editable:false,sortable:false},{text:"回片日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutPathoBackDate)]}</span>',flex:1,hidden:false,dataIndex:"OutPathoBackDate",editable:false,sortable:false}]}]})},ActiveChange:function(b,a){try{var d=b.items;if(null!=d){d.each(function(h,f,g){if(h.xtype=="panel"){if(h._itemId==a){h.setHidden(false)}else{h.setHidden(true)}}})}d=null;delete d}catch(e){}},GenCmsSchHistoryGrid:function(a,b,d){return Ext.create("Ext.grid.Grid",{id:a,title:b,store:{},inline:true,baseCls:"x-grid",height:"100%",width:"100%",CmsRecord:null,emptyText:'<div style="width:auto; text-align:center; padding-top:20%; color:red; font-weight:bold;">查無排檢資料.</div>',columns:[{text:"追蹤",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:120,tpl:'<button type="button" id="SELECT_CHECK_{KeyOne}">加入追蹤清單</button>',flex:1,dataIndex:"KeyOne",hidden:false,editable:false,sortable:false},{text:"醫令開立日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_APPLYDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.AccDate)]}</span>',flex:1,dataIndex:"AccDate",hidden:false,editable:false,sortable:true},{text:"開單日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_APPLYDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.ApplyDate)]}</span>',flex:1,dataIndex:"ApplyDate",hidden:false,editable:false,sortable:true},{text:"檢查名稱",xtype:"templatecolumn",align:"center",cls:"gridSmallFont",tpl:'<span style="color:{StyleColor}; font-size: 12px">{CodeName}</span>',flex:1,width:280,dataIndex:"CodeName",editable:false,sortable:true},{text:"醫令",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:120,tpl:'<span id="FN_SYSDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{CodeNO}</span>',flex:1,dataIndex:"CodeNO",hidden:false,editable:false,sortable:true},{text:"排程日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_SCHDDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.SchdDate)]}</span>',flex:1,dataIndex:"SchdDate",hidden:false,editable:false,sortable:false},{text:"預作日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_PREEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.PreExamDate)]}</span>',flex:1,dataIndex:"PreExamDate",hidden:false,editable:false,sortable:true},{text:"檢查日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RealExamDate)]}</span>',flex:1,dataIndex:"RealExamDate",hidden:false,editable:false,sortable:true},{text:"報告日",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_RPTDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.RptDate)]}</span>',flex:1,dataIndex:"RptDate",hidden:false,editable:false,sortable:true},{text:"單號",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:160,tpl:'<span id="FN_ACCESSNUM_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{Accessnum}</span>',flex:1,dataIndex:"Accessnum",hidden:false,editable:false,sortable:false},{text:"病理外片借閱進度",xtype:"gridheadergroup",cls:"gridNurBusinessFont",itemId:"OutPathoField",hidden:false,items:[{text:"申請日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutPathoApplyDate)]}</span>',flex:1,dataIndex:"OutPathoApplyDate",hidden:false,editable:false,sortable:false},{text:"申請醫院",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",tpl:'<span id="FN_STATUS_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{ClinName}</span>',flex:1,dataIndex:"ClinName",hidden:false,width:200,editable:false,sortable:false},{text:"寄出日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutPathoSendDate)]}</span>',flex:1,hidden:false,dataIndex:"OutPathoSendDate",editable:false,sortable:false},{text:"回片日期",xtype:"templatecolumn",align:"center",cls:"gridMediumFont",width:110,tpl:'<span id="FN_REALEXAMDATE_{KeyOne}" style="color:{StyleColor}; font-size: 14px">{[NisTRApp.view.TRUtility.BirthdayFormat(values.OutPathoBackDate)]}</span>',flex:1,hidden:false,dataIndex:"OutPathoBackDate",editable:false,sortable:false}]},]})},initialStore:function(){if(Ext.data.ModelManager.getModel("mCmsTraceData")==null){Ext.define("mCmsTraceData",{extend:Ext.data.Model,config:{fields:[{name:"InSource",type:"string"},{name:"MajorClass",type:"string"},{name:"MinorClass",type:"string"},{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"int"},{name:"RegDate",type:"string"},{name:"HdeptCode",type:"string"},{name:"DocNO",type:"string"},{name:"AccDate",type:"string"},{name:"PayKind1",type:"string"},{name:"OrddFlag",type:"string"},{name:"PayFlag",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"OrddRid",type:"string"},{name:"AccSeq",type:"string"},{name:"InpNO",type:"string"},{name:"Accessnum",type:"string"},{name:"ExamAccDate",type:"string"},{name:"SchdDate",type:"string"},{name:"ExamStatus",type:"string"},{name:"ExamStatusName",type:"string"},{name:"ExamStatusDisplayer",type:"string"},{name:"ExamRegDate",type:"string"},{name:"PreExamDate",type:"string"},{name:"RealExamDate",type:"string"},{name:"ApplyDate",type:"string"},{name:"ApplyDoc",type:"string"},{name:"ApplyDocName",type:"string"},{name:"RptDate",type:"string"},{name:"RptDocName",type:"string"},{name:"OutPathoApplyDate",type:"string"},{name:"OutPathoSendDate",type:"string"},{name:"OutPathoBackDate",type:"string"},{name:"ClinCode",type:"string"},{name:"ClinName",type:"string"},{convert:function(a,b){return b.data.MinorClass},name:"GroupID",type:"string"},{convert:function(a,b){return b.data.ChartNO+"_"+b.data.AccDate+"_"+b.data.CodeNO+"_"+b.data.OrddRid},name:"KeyOne",type:"string"}]}})}if(Ext.data.ModelManager.getModel("mCmsWebTraceD")==null){Ext.define("mCmsWebTraceD",{extend:Ext.data.Model,config:{fields:[{name:"WorkupID",type:"string"},{name:"ServiceID",type:"string"},{name:"MasterID",type:"string"},{name:"MajorClass",type:"string"},{name:"MinorClass",type:"string"},{name:"ChartNO",type:"string"},{name:"ChartSeq",type:"int"},{name:"HdeptCode",type:"string"},{name:"DocNO",type:"string"},{name:"AccDate",type:"string"},{name:"PayKind1",type:"string"},{name:"OrddFlag",type:"string"},{name:"PayFlag",type:"string"},{name:"CodeNO",type:"string"},{name:"CodeName",type:"string"},{name:"OrddRid",type:"string"},{name:"AccSeq",type:"string"},{name:"InpNO",type:"string"},{name:"Accessnum",type:"string"},{name:"ExamAccDate",type:"string"},{name:"SchdDate",type:"string"},{name:"ExamStatus",type:"string"},{name:"ExamStatusName",type:"string"},{name:"ExamStatusDisplayer",type:"string"},{name:"ExamRegDate",type:"string"},{name:"PreExamDate",type:"string"},{name:"RealExamDate",type:"string"},{name:"ApplyDate",type:"string"},{name:"ApplyDoc",type:"string"},{name:"ApplyDocName",type:"string"},{name:"RptDate",type:"string"},{name:"RptDocName",type:"string"},{name:"Remark",type:"string"},{name:"OutPathoApplyDate",type:"string"},{name:"OutPathoSendDate",type:"string"},{name:"OutPathoBackDate",type:"string"},{name:"ClinCode",type:"string"},{name:"ClinName",type:"string"},{name:"RemarkFormID",type:"string"},{name:"ErrorFormID",type:"string"},{name:"RemarkCnt",type:"int"},{name:"ErrorCnt",type:"int"},{convert:function(a,b){return b.data.WorkupID},name:"KeyOne",type:"string"},{convert:function(b,d){var a=d.data.CodeName;return a},name:"FrmItemName",type:"string"},{convert:function(a,b){return"WORKUP_LAB"},name:"ExamType",type:"string"},{convert:function(a,b){return"WORKUP"},name:"FrmCode",type:"string"},{convert:function(a,b){return b.data.WorkupID},name:"FrmKey",type:"string"}]}})}if(Ext.getStore("sCmsWorkUpLab")==null){Ext.create("Ext.data.Store",{model:"mCmsWebTraceD",storeId:"sCmsWorkUpLab",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/WorkUp/LabWorkUp.ashx",reader:{type:"jsonHtmlDecode"}}})}if(Ext.getStore("sCmsSchLab")==null){Ext.create("Ext.data.Store",{model:"mCmsTraceData",storeId:"sCmsSchLab",proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},url:SYS_CONST.ApiRoot+"CMS/WorkUp/LabSchData.ashx",reader:{type:"jsonHtmlDecode"}}})}},LoadWorkUp:function(){if(Ext.getStore("sCmsWorkUpLab").isLoading()){return}var b=this.getRecord();var a=Ext.getStore("sCmsWorkUpLab");a.getProxy().setExtraParams({CmsID:b.data.CmsID,ChartNO:b.data.ChartNO,MajorClass:this.down("#CmsWKLabWK_Kind").getValue(),BegDate:this.down("#CmsWKLab_BegDate").getValue(),EndDate:this.down("#CmsWKLab_EndDate").getValue()});a.removeAll();a.load({callback:function(e,d,f){},scope:this});b=null;delete b;a=null;delete a},LoadSchd:function(){if(Ext.getStore("sCmsSchLab").isLoading()){return}var b=this.getRecord();var a=Ext.getStore("sCmsSchLab");a.getProxy().setExtraParams({ChartNO:b.data.ChartNO,BegDate:this.down("#CmsWKLabSchd_BegDate").getValue(),EndDate:this.down("#CmsWKLabSchd_EndDate").getValue(),MajorClass:this.down("#CmsWKLab_Kind").getValue()});a.removeAll();a.load({callback:function(e,d,f){},scope:this});b=null;delete b;a=null;delete a},ItemSingleTapSchdGrid:function(g,b,j,a,h,d){var g=this;var f=h.event.target.id.split("_");if(null==f||f.length<=0){h.preventDefault();return false}if(h.event.target.nodeName=="IMG"||h.event.target.nodeName=="SPAN"||h.event.target.nodeName=="A"||h.event.target.nodeName=="BUTTON"){switch(f[0]){case"SELECT":NisTRApp.view.CMS.WorkUp.LAB.UpdateLabWK(g.CmsRecord,a,g,0);break;case"SYNC":NisTRApp.view.CMS.WorkUp.LAB.SyncSchd(g.CmsRecord,a,g);break;case"DEL":NisTRApp.view.CMS.WorkUp.LAB.UpdateLabWK(g.CmsRecord,a,g,1);break;case"REPORT":break;case"REMARK":NisTRApp.view.CMS.ScheduleRemark.Create2(g.CmsRecord,a,g,"KIRPMHSPD2JUZBTN2HG2Q5S7JQ",null,true);break;case"ERROR":NisTRApp.view.CMS.ScheduleRemark.Create2(g.CmsRecord,a,g,"XMBPF6YJE7AEVMOO4RBSAR6X4Q",null,true);break;default:break}h.preventDefault()}else{if(h.event.target.nodeName=="INPUT"){}}f=null;delete f;g=null;delete g;return false}});Ext.define("NisTRApp.view.InpMainUI",{extend:Ext.ux.slidenavigation.View,config:{fullscreen:true,slideSelector:"x-toolbar",containerSlideDelay:5,selectSlideDuration:100,itemMask:true,closeOnSelect:true,listPosition:"left",dragFlag:false,slideButtonDefaults:{selector:"toolbar"},list:{maxDrag:200,width:200,items:[{xtype:"toolbar",docked:"top",ui:"light",title:{title:'<font size="5"><H1>護理資訊系統</H1></font>',centered:true,width:170,left:0},hidden:true}]},defaults:{style:"background: #f6f6f6",xtype:"container"},items:[{title:'<img src="../_/img/profile.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">病人履歷</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(null==this.down("#INP_MainProfile")){if(null==Ext.getCmp("INP_MainProfile")||undefined==Ext.getCmp("INP_MainProfile")){Ext.create("NisTRApp.view.Profile",{id:"INP_MainProfile",itemId:"INP_MainProfile",maskOnOpen:false,patient:Ext.getCmp("MainUI").getPatient(),record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainProfile").setPatient(Ext.getCmp("MainUI").getPatient());Ext.getCmp("INP_MainProfile").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainProfile")])}console.log("INP_MainProfile INI")},event:"initialize"}]}]},{title:'<img src="../_/img/management.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">醫囑執行</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(null==this.down("#INP_MainManagement")){if(null==Ext.getCmp("INP_MainManagement")||undefined==Ext.getCmp("INP_MainManagement")){Ext.create("NisTRApp.view.Management",{id:"INP_MainManagement",itemId:"INP_MainManagement",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainManagement").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainManagement")])}console.log("INP_MainManagement INI")},event:"initialize"}]}]},{title:'<img id="AllergyTitleIMG" src="../_/img/allergy_icon2.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">過敏評估</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){a.removeAll(true,true)},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(null==this.down("#INP_MainAllergy")){if(null==Ext.getCmp("INP_MainAllergy")||undefined==Ext.getCmp("INP_MainAllergy")){Ext.create("NisTRApp.view.Allergy",{id:"INP_MainAllergy",itemId:"INP_MainAllergy",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainAllergy").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainAllergy")])}},event:"initialize"}]}]},{title:'<img src="../_/img/vitalsigns.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">生命徵象</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(null==this.down("#INP_MainVitalSigns")){if(null==Ext.getCmp("INP_MainVitalSigns")||undefined==Ext.getCmp("INP_MainVitalSigns")){Ext.create("NisTRApp.view.VitalSigns",{id:"INP_MainVitalSigns",itemId:"INP_MainVitalSigns",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainVitalSigns").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainVitalSigns")])}},event:"initialize"}]}]},{title:'<img src="../_/img/pipe.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">管路護理</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#INP_MainNurCath"))){if(Ext.isEmpty(Ext.getCmp("INP_MainNurCath"))){Ext.create("NisTRApp.view.Nur.Cath",{id:"INP_MainNurCath",itemId:"INP_MainNurCath",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainNurCath").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainNurCath")])}},event:"initialize"}]}]},{title:'<img src="../_/img/assessment.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">護理評估</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#INP_MainNurAssessment"))){if(Ext.isEmpty(Ext.getCmp("INP_MainNurAssessment"))){Ext.create("NisTRApp.view.Nur.INP_Assessment",{id:"INP_MainNurAssessment",itemId:"INP_MainNurAssessment",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainNurAssessment").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainNurAssessment")])}},event:"initialize"}]}]},{title:'<img src="../_/img/management2.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">健康問題</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#INP_MainNurHealthProblem"))){if(Ext.isEmpty(Ext.getCmp("INP_MainNurHealthProblem"))){Ext.create("NisTRApp.view.Nur.INP_HealthProblem",{id:"INP_MainNurHealthProblem",itemId:"INP_MainNurHealthProblem",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainNurHealthProblem").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainNurHealthProblem")])}},event:"initialize"}]}]},{title:'<img src="../_/img/notes.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">護理記錄</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#INP_MainNurNotes"))){if(Ext.isEmpty(Ext.getCmp("INP_MainNurNotes"))){Ext.create("NisTRApp.view.Nur.INP_Notes",{id:"INP_MainNurNotes",itemId:"INP_MainNurNotes",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainNurNotes").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainNurNotes")])}},event:"initialize"}]}]},{title:'<img src="../_/img/healthTeach.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">衛教指導</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#INP_MainNurHealthTeach"))){if(Ext.isEmpty(Ext.getCmp("INP_MainNurHealthTeach"))){Ext.create("NisTRApp.view.Nur.INP_HealthTeach",{id:"INP_MainNurHealthTeach",itemId:"INP_MainNurHealthTeach",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainNurHealthTeach").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainNurHealthTeach")])}},event:"initialize"}]}]},{title:'<img id="PrepareTitleIMG" src="../_/img/teach.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">排程作業</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#INP_MainNurPrepare"))){if(Ext.isEmpty(Ext.getCmp("INP_MainNurPrepare"))){Ext.create("NisTRApp.view.Nur.INP_Prepare",{id:"INP_MainNurPrepare",itemId:"INP_MainNurPrepare",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("INP_MainNurPrepare").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("INP_MainNurPrepare")])}},event:"initialize"}]}]}]},initConfig:function(){this.callParent();console.log("InpMainUI Initial");this.addListener("FunctionChange",function(d,f,e){console.log("InpMainUI FunctionChange // DOTO")},this);this.addListener("updatedata",function(d,f,e){console.log("InpMainUI Patient In",f);b(this);a(this)},this);this.addListener("painted",function(e,d){},this);function b(e){var d=e.getRecord();if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.data)){var f=d.data;if(f.Allergy==-1&&undefined!=$("#AllergyTitleIMG")&&null!=$("#AllergyTitleIMG")){$("#AllergyTitleIMG").attr("src","../_/img/yellow_alert.gif")}else{$("#AllergyTitleIMG").attr("src","../_/img/allergy_icon2.png")}f=null}d=null}function a(f){var d=f.getRecord();if(!Ext.isEmpty(d)&&!Ext.isEmpty(d.data)&&!Ext.isEmpty(d.data.InpNO)){var g=d.data;try{Ext.Ajax.request({url:SYS_CONST.ApiRoot+"Inp/Form/PrepareListChk.ashx",scope:f,method:"POST",params:{InpNo:g.InpNo},success:function(e){var j=Ext.decode(e.responseText);if(j.HasPrepare==true){$("#PrepareTitleIMG").attr("src","../_/img/yellow_alert.gif")}else{if(j.NewRecord==true){$("#PrepareTitleIMG").attr("src","../_/img/yellow_alert.gif")}}j=null;delete j},failure:function(){}})}catch(h){}g=null}d=null}}});Ext.define("NisTRApp.view.OpdMainUI",{extend:Ext.ux.slidenavigation.View,config:{fullscreen:true,slideSelector:"x-toolbar",containerSlideDelay:5,selectSlideDuration:100,itemMask:true,closeOnSelect:true,listPosition:"left",dragFlag:false,slideButtonDefaults:{selector:"toolbar"},list:{maxDrag:200,width:200,items:[{xtype:"toolbar",docked:"top",ui:"light",title:{title:'<font size="5"><H1>護理資訊系統</H1></font>',centered:true,width:170,left:0},hidden:true}]},defaults:{style:"background: #f6f6f6",xtype:"container"},items:[{title:'<img src="../_/img/profile.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">病人履歷</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainProfile"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainProfile"))){Ext.create("NisTRApp.view.Profile",{id:"OPD_MainProfile",itemId:"OPD_MainProfile",maskOnOpen:false,patient:Ext.getCmp("MainUI").getPatient(),record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainProfile").setPatient(Ext.getCmp("MainUI").getPatient());Ext.getCmp("OPD_MainProfile").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainProfile")])}},event:"initialize"}]}]},{title:'<img id="AllergyTitleIMG" src="../_/img/allergy_icon2.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">過敏評估</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){a.removeAll(true,true)},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainAllergy"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainAllergy"))){Ext.create("NisTRApp.view.Allergy",{id:"OPD_MainAllergy",itemId:"OPD_MainAllergy",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainAllergy").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainAllergy")])}},event:"initialize"}]}]},{title:'<img src="../_/img/vitalsigns.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">生命徵象</span>',group:"護理執行",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainVitalSigns"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainVitalSigns"))){Ext.create("NisTRApp.view.VitalSigns",{id:"OPD_MainVitalSigns",itemId:"OPD_MainVitalSigns",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainVitalSigns").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainVitalSigns")])}},event:"initialize"}]}]},{title:'<img src="../_/img/pipe.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">管路護理</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainNurCath"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainNurCath"))){Ext.create("NisTRApp.view.Nur.Cath",{id:"OPD_MainNurCath",itemId:"OPD_MainNurCath",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainNurCath").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainNurCath")])}},event:"initialize"}]}]},{title:'<img src="../_/img/assessment.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">護理評估</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainNurAssessment"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainNurAssessment"))){Ext.create("NisTRApp.view.Nur.OPD_Assessment",{id:"OPD_MainNurAssessment",itemId:"OPD_MainNurAssessment",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainNurAssessment").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainNurAssessment")])}},event:"initialize"}]}]},{title:'<img src="../_/img/notes.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">護理記錄</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainNurNotes"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainNurNotes"))){Ext.create("NisTRApp.view.Nur.OPD_Notes",{id:"OPD_MainNurNotes",itemId:"OPD_MainNurNotes",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainNurNotes").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainNurNotes")])}},event:"initialize"}]}]},{title:'<img src="../_/img/healthTeach.png" align="middle" width="32" height="32"> <span style="font-size:1.5em;">衛教指導</span>',group:"護理記錄",items:[{xtype:"container",height:"100%",width:"100%",height:"100%",layout:{type:"vbox"},items:[],listeners:[{fn:function(b,a){},event:"painted"},{fn:function(a,e,b,d){},event:"remove"},{fn:function(a,b){},event:"BackToList"},{fn:function(a,b){},event:"SysLogout"},{fn:function(){if(Ext.isEmpty(this.down("#OPD_MainNurHealthTeach"))){if(Ext.isEmpty(Ext.getCmp("OPD_MainNurHealthTeach"))){Ext.create("NisTRApp.view.Nur.OPD_HealthTeach",{id:"OPD_MainNurHealthTeach",itemId:"OPD_MainNurHealthTeach",maskOnOpen:false,record:Ext.getCmp("MainUI").getPatient()})}else{Ext.getCmp("OPD_MainNurHealthTeach").setRecord(Ext.getCmp("MainUI").getPatient())}this.add([Ext.getCmp("OPD_MainNurHealthTeach")])}},event:"initialize"}]}]}]},initConfig:function(){this.callParent();this.addListener("FunctionChange",function(a,d,b){console.log("OpdMainUI FunctionChange // DOTO")},this);this.addListener("updatedata",function(a,d,b){console.log("OpdMainUI Patient In",d)},this);this.addListener("painted",function(e,d){var a=this.getRecord();if(!Ext.isEmpty(a)&&!Ext.isEmpty(a.data)){var b=a.data;if(b.Allergy==-1&&undefined!=$("#AllergyTitleIMG")&&null!=$("#AllergyTitleIMG")){$("#AllergyTitleIMG").attr("src","../_/img/yellow_alert.gif")}else{$("#AllergyTitleIMG").attr("src","../_/img/allergy_icon2.png")}b=null}a=null},this)}});Ext.define("NisTRApp.view.Profile.PastHistoryItemPanel",{extend:Ext.Panel,config:{height:320,width:320,hideOnMaskTap:true,layout:{type:"fit"},modal:true,field:{},caller:{},items:[{xtype:"list",itemId:"ItemList",itemTpl:["<Div>{name}</Div>"]}],listeners:[{fn:"onItemListItemTap",event:"itemtap",delegate:"#ItemList"},{fn:"onPanelHide",event:"hide"},{fn:"onPanelDestroy",event:"destroy"}]},onItemListItemTap:function(b,f,k,a,j,g){if(!Ext.isEmpty(this.getField())){var h=this.getField();var d=h.getValue();if(Ext.isEmpty(d)){h.setValue(a.data.name)}else{h.setValue(d+"; "+a.data.name)}h=null;delete h;d=null;delete d}},onPanelHide:function(a,b){this.destroy()},onPanelDestroy:function(a){this.removeAll(true,true)},initialize:function(){this.callParent();if(Ext.data.ModelManager.getModel("Options")==null){Ext.define("Options",{extend:Ext.data.Model,config:{fields:[{name:"name",type:"string"},{name:"id",type:"int"}]}})}if(Ext.getStore("sPastHistoryItem")==null){Ext.create("Ext.data.Store",{storeId:"sPastHistoryItem",clearOnPageLoad:false,model:"Options",data:[{name:"無",id:1},{name:"Adjustment disorder",id:2},{name:"Anxiety",id:3},{name:"Asthma",id:4},{name:"BTI",id:5},{name:"CAD",id:6},{name:"Depression",id:7},{name:"COPD",id:8},{name:"CRF",id:9},{name:"DM",id:10},{name:"DU",id:11},{name:"Esophageal varices",id:12},{name:"Gall stone",id:13},{name:"GERD",id:14},{name:"GU",id:15},{name:"HTN",id:16},{name:"CRF",id:17},{name:"DM",id:18},{name:"DU",id:19},{name:"Esophageal varices",id:20},{name:"(+)HBV",id:21},{name:"(+)HCV",id:22},{name:"Hydronephrosis",id:23},{name:"Hyperthyroidism",id:24},{name:"Liver cirrhosis",id:25},{name:"Renal insufficiency",id:26},{name:"Renal stone",id:27},{name:"Stroke",id:28}]})}this.down("#ItemList").setStore(Ext.getStore("sPastHistoryItem"))}});